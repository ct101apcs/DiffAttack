
******Attack based on Diffusion, Attacked Dataset: imagenet_compatible*********
Loading pipeline components...:   0%|          | 0/6 [00:00<?, ?it/s]Loading pipeline components...:  50%|█████     | 3/6 [00:00<00:00, 21.68it/s]Loading pipeline components...: 100%|██████████| 6/6 [00:00<00:00,  6.72it/s]Loading pipeline components...: 100%|██████████| 6/6 [00:00<00:00,  7.50it/s]

Accuracy on benign examples: 100.0%
gt_label: 388 pred_label: 388 pred_clean_logit 0.9997747540473938
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:01<00:28,  1.59s/it]DDIM_inverse:  21%|██        | 4/19 [00:01<00:05,  2.92it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:01<00:02,  5.49it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:02<00:01,  6.76it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:02<00:00,  8.61it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:02<00:00,  9.87it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:02<00:00, 11.58it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00, 13.88it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.26it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:03<00:14,  3.58s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.08s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.63s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3646
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:03<?, ?it/s, atk: -0.001 ent: -5.229 str: 0.000 loss: -5.230]Iterations:   3%|▎         | 1/30 [00:08<04:04,  8.43s/it, atk: -0.001 ent: -5.229 str: 0.000 loss: -5.230]Iterations:   3%|▎         | 1/30 [00:08<04:04,  8.43s/it, atk: -0.001 ent: -5.311 str: 0.000 loss: -5.312]Iterations:   7%|▋         | 2/30 [00:09<01:49,  3.93s/it, atk: -0.001 ent: -5.311 str: 0.000 loss: -5.312]Iterations:   7%|▋         | 2/30 [00:09<01:49,  3.93s/it, atk: -0.002 ent: -5.363 str: 0.000 loss: -5.365]Iterations:  10%|█         | 3/30 [00:09<01:04,  2.37s/it, atk: -0.002 ent: -5.363 str: 0.000 loss: -5.365]Iterations:  10%|█         | 3/30 [00:10<01:04,  2.37s/it, atk: -0.002 ent: -5.409 str: 0.000 loss: -5.412]Iterations:  13%|█▎        | 4/30 [00:10<00:42,  1.64s/it, atk: -0.002 ent: -5.409 str: 0.000 loss: -5.412]Iterations:  13%|█▎        | 4/30 [00:10<00:42,  1.64s/it, atk: -0.003 ent: -5.451 str: 0.000 loss: -5.454]Iterations:  17%|█▋        | 5/30 [00:10<00:31,  1.26s/it, atk: -0.003 ent: -5.451 str: 0.000 loss: -5.454]Iterations:  17%|█▋        | 5/30 [00:11<00:31,  1.26s/it, atk: -0.003 ent: -5.489 str: 0.000 loss: -5.492]Iterations:  20%|██        | 6/30 [00:11<00:23,  1.00it/s, atk: -0.003 ent: -5.489 str: 0.000 loss: -5.492]Iterations:  20%|██        | 6/30 [00:11<00:23,  1.00it/s, atk: -0.003 ent: -5.520 str: 0.000 loss: -5.523]Iterations:  23%|██▎       | 7/30 [00:11<00:19,  1.19it/s, atk: -0.003 ent: -5.520 str: 0.000 loss: -5.523]Iterations:  23%|██▎       | 7/30 [00:12<00:19,  1.19it/s, atk: -0.006 ent: -5.540 str: 0.000 loss: -5.546]Iterations:  27%|██▋       | 8/30 [00:12<00:17,  1.26it/s, atk: -0.006 ent: -5.540 str: 0.000 loss: -5.546]Iterations:  27%|██▋       | 8/30 [00:12<00:17,  1.26it/s, atk: -0.007 ent: -5.573 str: 0.000 loss: -5.581]Iterations:  30%|███       | 9/30 [00:13<00:16,  1.30it/s, atk: -0.007 ent: -5.573 str: 0.000 loss: -5.581]Iterations:  30%|███       | 9/30 [00:13<00:16,  1.30it/s, atk: -0.009 ent: -5.596 str: 0.000 loss: -5.605]Iterations:  33%|███▎      | 10/30 [00:13<00:13,  1.47it/s, atk: -0.009 ent: -5.596 str: 0.000 loss: -5.605]Iterations:  33%|███▎      | 10/30 [00:14<00:13,  1.47it/s, atk: -0.010 ent: -5.616 str: 0.000 loss: -5.626]Iterations:  37%|███▋      | 11/30 [00:14<00:12,  1.58it/s, atk: -0.010 ent: -5.616 str: 0.000 loss: -5.626]Iterations:  37%|███▋      | 11/30 [00:14<00:12,  1.58it/s, atk: -0.013 ent: -5.634 str: 0.000 loss: -5.647]Iterations:  40%|████      | 12/30 [00:14<00:11,  1.57it/s, atk: -0.013 ent: -5.634 str: 0.000 loss: -5.647]Iterations:  40%|████      | 12/30 [00:15<00:11,  1.57it/s, atk: -0.021 ent: -5.653 str: 0.000 loss: -5.674]Iterations:  43%|████▎     | 13/30 [00:15<00:10,  1.64it/s, atk: -0.021 ent: -5.653 str: 0.000 loss: -5.674]Iterations:  43%|████▎     | 13/30 [00:15<00:10,  1.64it/s, atk: -0.038 ent: -5.670 str: 0.000 loss: -5.708]Iterations:  47%|████▋     | 14/30 [00:15<00:09,  1.73it/s, atk: -0.038 ent: -5.670 str: 0.000 loss: -5.708]Iterations:  47%|████▋     | 14/30 [00:16<00:09,  1.73it/s, atk: -0.071 ent: -5.684 str: 0.000 loss: -5.755]Iterations:  50%|█████     | 15/30 [00:16<00:08,  1.81it/s, atk: -0.071 ent: -5.684 str: 0.000 loss: -5.755]Iterations:  50%|█████     | 15/30 [00:16<00:08,  1.81it/s, atk: -0.149 ent: -5.694 str: 0.000 loss: -5.843]Iterations:  53%|█████▎    | 16/30 [00:16<00:07,  1.81it/s, atk: -0.149 ent: -5.694 str: 0.000 loss: -5.843]Iterations:  53%|█████▎    | 16/30 [00:17<00:07,  1.81it/s, atk: -0.339 ent: -5.700 str: 0.000 loss: -6.038]Iterations:  57%|█████▋    | 17/30 [00:17<00:07,  1.66it/s, atk: -0.339 ent: -5.700 str: 0.000 loss: -6.038]Iterations:  57%|█████▋    | 17/30 [00:17<00:07,  1.66it/s, atk: -0.727 ent: -5.699 str: 0.000 loss: -6.425]Iterations:  60%|██████    | 18/30 [00:18<00:06,  1.73it/s, atk: -0.727 ent: -5.699 str: 0.000 loss: -6.425]Iterations:  60%|██████    | 18/30 [00:18<00:06,  1.73it/s, atk: -1.464 ent: -5.691 str: 0.000 loss: -7.155]Iterations:  63%|██████▎   | 19/30 [00:18<00:06,  1.78it/s, atk: -1.464 ent: -5.691 str: 0.000 loss: -7.155]Iterations:  63%|██████▎   | 19/30 [00:19<00:06,  1.78it/s, atk: -2.690 ent: -5.693 str: 0.000 loss: -8.384]Iterations:  67%|██████▋   | 20/30 [00:19<00:05,  1.82it/s, atk: -2.690 ent: -5.693 str: 0.000 loss: -8.384]Iterations:  67%|██████▋   | 20/30 [00:19<00:05,  1.82it/s, atk: -5.682 ent: -5.686 str: 0.000 loss: -11.368]Iterations:  70%|███████   | 21/30 [00:19<00:04,  1.84it/s, atk: -5.682 ent: -5.686 str: 0.000 loss: -11.368]Iterations:  70%|███████   | 21/30 [00:20<00:04,  1.84it/s, atk: -10.091 ent: -5.676 str: 0.000 loss: -15.767]Iterations:  73%|███████▎  | 22/30 [00:20<00:04,  1.88it/s, atk: -10.091 ent: -5.676 str: 0.000 loss: -15.767]Iterations:  73%|███████▎  | 22/30 [00:20<00:04,  1.88it/s, atk: -15.675 ent: -5.675 str: 0.000 loss: -21.349]Iterations:  77%|███████▋  | 23/30 [00:20<00:03,  1.87it/s, atk: -15.675 ent: -5.675 str: 0.000 loss: -21.349]Iterations:  77%|███████▋  | 23/30 [00:21<00:03,  1.87it/s, atk: -22.106 ent: -5.663 str: 0.000 loss: -27.769]Iterations:  80%|████████  | 24/30 [00:21<00:03,  1.88it/s, atk: -22.106 ent: -5.663 str: 0.000 loss: -27.769]Iterations:  80%|████████  | 24/30 [00:21<00:03,  1.88it/s, atk: -29.261 ent: -5.656 str: 0.000 loss: -34.917]Iterations:  83%|████████▎ | 25/30 [00:21<00:02,  1.86it/s, atk: -29.261 ent: -5.656 str: 0.000 loss: -34.917]Iterations:  83%|████████▎ | 25/30 [00:22<00:02,  1.86it/s, atk: -37.177 ent: -5.658 str: 0.000 loss: -42.835]Iterations:  87%|████████▋ | 26/30 [00:22<00:02,  1.78it/s, atk: -37.177 ent: -5.658 str: 0.000 loss: -42.835]Iterations:  87%|████████▋ | 26/30 [00:22<00:02,  1.78it/s, atk: -41.783 ent: -5.658 str: 0.000 loss: -47.440]Iterations:  90%|█████████ | 27/30 [00:23<00:01,  1.78it/s, atk: -41.783 ent: -5.658 str: 0.000 loss: -47.440]Iterations:  90%|█████████ | 27/30 [00:23<00:01,  1.78it/s, atk: -50.176 ent: -5.651 str: 0.000 loss: -55.828]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.76it/s, atk: -50.176 ent: -5.651 str: 0.000 loss: -55.828]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.76it/s, atk: -55.201 ent: -5.644 str: 0.000 loss: -60.845]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.71it/s, atk: -55.201 ent: -5.644 str: 0.000 loss: -60.845]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.71it/s, atk: -60.993 ent: -5.642 str: 0.000 loss: -66.634]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.75it/s, atk: -60.993 ent: -5.642 str: 0.000 loss: -66.634]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.21it/s, atk: -60.993 ent: -5.642 str: 0.000 loss: -66.634]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([297], device='cuda:0') tensor(0.9950, device='cuda:0')
after_true: tensor([388], device='cuda:0') tensor(0.0014, device='cuda:0')
L1: [3137.7375]	L2: [20.118454]	Linf: [0.5372549]

Accuracy on benign examples: 100.0%
gt_label: 576 pred_label: 576 pred_clean_logit 0.9990403056144714
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.49it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.42it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 23.87it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 24.20it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.71it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.15it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.99s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.63s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.62s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4771
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.131 ent: -4.903 str: 0.000 loss: -5.034]Iterations:   3%|▎         | 1/30 [00:00<00:28,  1.01it/s, atk: -0.131 ent: -4.903 str: 0.000 loss: -5.034]Iterations:   3%|▎         | 1/30 [00:01<00:28,  1.01it/s, atk: -0.767 ent: -4.901 str: 0.000 loss: -5.668]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.43it/s, atk: -0.767 ent: -4.901 str: 0.000 loss: -5.668]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.43it/s, atk: -4.139 ent: -4.900 str: 0.000 loss: -9.039]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.63it/s, atk: -4.139 ent: -4.900 str: 0.000 loss: -9.039]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.63it/s, atk: -14.787 ent: -4.898 str: 0.000 loss: -19.685]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -14.787 ent: -4.898 str: 0.000 loss: -19.685]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -28.992 ent: -4.898 str: 0.000 loss: -33.890]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.72it/s, atk: -28.992 ent: -4.898 str: 0.000 loss: -33.890]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.72it/s, atk: -43.903 ent: -4.897 str: 0.000 loss: -48.800]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.74it/s, atk: -43.903 ent: -4.897 str: 0.000 loss: -48.800]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.74it/s, atk: -51.358 ent: -4.897 str: 0.000 loss: -56.255]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.74it/s, atk: -51.358 ent: -4.897 str: 0.000 loss: -56.255]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.74it/s, atk: -62.260 ent: -4.895 str: 0.000 loss: -67.156]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.72it/s, atk: -62.260 ent: -4.895 str: 0.000 loss: -67.156]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.72it/s, atk: -71.907 ent: -4.894 str: 0.000 loss: -76.801]Iterations:  30%|███       | 9/30 [00:05<00:12,  1.74it/s, atk: -71.907 ent: -4.894 str: 0.000 loss: -76.801]Iterations:  30%|███       | 9/30 [00:05<00:12,  1.74it/s, atk: -81.081 ent: -4.892 str: 0.000 loss: -85.973]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.66it/s, atk: -81.081 ent: -4.892 str: 0.000 loss: -85.973]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.66it/s, atk: -88.187 ent: -4.891 str: 0.000 loss: -93.078]Iterations:  37%|███▋      | 11/30 [00:06<00:11,  1.70it/s, atk: -88.187 ent: -4.891 str: 0.000 loss: -93.078]Iterations:  37%|███▋      | 11/30 [00:06<00:11,  1.70it/s, atk: -97.172 ent: -4.890 str: 0.000 loss: -102.062]Iterations:  40%|████      | 12/30 [00:07<00:10,  1.76it/s, atk: -97.172 ent: -4.890 str: 0.000 loss: -102.062]Iterations:  40%|████      | 12/30 [00:07<00:10,  1.76it/s, atk: -106.558 ent: -4.889 str: 0.000 loss: -111.448]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.78it/s, atk: -106.558 ent: -4.889 str: 0.000 loss: -111.448]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.78it/s, atk: -114.996 ent: -4.888 str: 0.000 loss: -119.884]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.77it/s, atk: -114.996 ent: -4.888 str: 0.000 loss: -119.884]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.77it/s, atk: -124.560 ent: -4.888 str: 0.000 loss: -129.448]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.79it/s, atk: -124.560 ent: -4.888 str: 0.000 loss: -129.448]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.79it/s, atk: -132.781 ent: -4.888 str: 0.000 loss: -137.669]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.77it/s, atk: -132.781 ent: -4.888 str: 0.000 loss: -137.669]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.77it/s, atk: -141.172 ent: -4.888 str: 0.000 loss: -146.061]Iterations:  57%|█████▋    | 17/30 [00:09<00:07,  1.78it/s, atk: -141.172 ent: -4.888 str: 0.000 loss: -146.061]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.78it/s, atk: -149.938 ent: -4.888 str: 0.000 loss: -154.827]Iterations:  60%|██████    | 18/30 [00:10<00:07,  1.71it/s, atk: -149.938 ent: -4.888 str: 0.000 loss: -154.827]Iterations:  60%|██████    | 18/30 [00:10<00:07,  1.71it/s, atk: -157.161 ent: -4.889 str: 0.000 loss: -162.050]Iterations:  63%|██████▎   | 19/30 [00:11<00:06,  1.72it/s, atk: -157.161 ent: -4.889 str: 0.000 loss: -162.050]Iterations:  63%|██████▎   | 19/30 [00:11<00:06,  1.72it/s, atk: -163.126 ent: -4.889 str: 0.000 loss: -168.015]Iterations:  67%|██████▋   | 20/30 [00:11<00:06,  1.56it/s, atk: -163.126 ent: -4.889 str: 0.000 loss: -168.015]Iterations:  67%|██████▋   | 20/30 [00:12<00:06,  1.56it/s, atk: -170.113 ent: -4.888 str: 0.000 loss: -175.001]Iterations:  70%|███████   | 21/30 [00:12<00:05,  1.63it/s, atk: -170.113 ent: -4.888 str: 0.000 loss: -175.001]Iterations:  70%|███████   | 21/30 [00:12<00:05,  1.63it/s, atk: -176.842 ent: -4.888 str: 0.000 loss: -181.730]Iterations:  73%|███████▎  | 22/30 [00:13<00:04,  1.67it/s, atk: -176.842 ent: -4.888 str: 0.000 loss: -181.730]Iterations:  73%|███████▎  | 22/30 [00:13<00:04,  1.67it/s, atk: -185.917 ent: -4.888 str: 0.000 loss: -190.805]Iterations:  77%|███████▋  | 23/30 [00:13<00:04,  1.62it/s, atk: -185.917 ent: -4.888 str: 0.000 loss: -190.805]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.62it/s, atk: -193.083 ent: -4.887 str: 0.000 loss: -197.970]Iterations:  80%|████████  | 24/30 [00:14<00:03,  1.66it/s, atk: -193.083 ent: -4.887 str: 0.000 loss: -197.970]Iterations:  80%|████████  | 24/30 [00:14<00:03,  1.66it/s, atk: -199.248 ent: -4.886 str: 0.000 loss: -204.134]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.72it/s, atk: -199.248 ent: -4.886 str: 0.000 loss: -204.134]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  1.72it/s, atk: -205.165 ent: -4.884 str: 0.000 loss: -210.049]Iterations:  87%|████████▋ | 26/30 [00:15<00:02,  1.65it/s, atk: -205.165 ent: -4.884 str: 0.000 loss: -210.049]Iterations:  87%|████████▋ | 26/30 [00:15<00:02,  1.65it/s, atk: -210.728 ent: -4.883 str: 0.000 loss: -215.611]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  1.69it/s, atk: -210.728 ent: -4.883 str: 0.000 loss: -215.611]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  1.69it/s, atk: -218.016 ent: -4.882 str: 0.000 loss: -222.899]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.74it/s, atk: -218.016 ent: -4.882 str: 0.000 loss: -222.899]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.74it/s, atk: -224.247 ent: -4.882 str: 0.000 loss: -229.129]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  1.75it/s, atk: -224.247 ent: -4.882 str: 0.000 loss: -229.129]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  1.75it/s, atk: -230.197 ent: -4.881 str: 0.000 loss: -235.078]Iterations: 100%|██████████| 30/30 [00:17<00:00,  1.67it/s, atk: -230.197 ent: -4.881 str: 0.000 loss: -235.078]Iterations: 100%|██████████| 30/30 [00:17<00:00,  1.68it/s, atk: -230.197 ent: -4.881 str: 0.000 loss: -235.078]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([525], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([576], device='cuda:0') tensor(5.5409e-11, device='cuda:0')
L1: [3361.541]	L2: [23.103052]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 326 pred_label: 326 pred_clean_logit 0.8779584765434265
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.67it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 10.77it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.75it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.33it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.17it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.80it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 11.45it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.80it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.96it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.74it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.55s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.67s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.83s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:02,  2.01s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.02s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5356
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.157 ent: -9.656 str: 0.000 loss: -10.813]Iterations:   3%|▎         | 1/30 [00:01<00:31,  1.09s/it, atk: -1.157 ent: -9.656 str: 0.000 loss: -10.813]Iterations:   3%|▎         | 1/30 [00:01<00:31,  1.09s/it, atk: -2.418 ent: -9.666 str: 0.000 loss: -12.083]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -2.418 ent: -9.666 str: 0.000 loss: -12.083]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -4.811 ent: -9.663 str: 0.000 loss: -14.475]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.24it/s, atk: -4.811 ent: -9.663 str: 0.000 loss: -14.475]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.24it/s, atk: -5.498 ent: -9.667 str: 0.000 loss: -15.166]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.46it/s, atk: -5.498 ent: -9.667 str: 0.000 loss: -15.166]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.46it/s, atk: -6.362 ent: -9.676 str: 0.000 loss: -16.038]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.58it/s, atk: -6.362 ent: -9.676 str: 0.000 loss: -16.038]Iterations:  17%|█▋        | 5/30 [00:04<00:15,  1.58it/s, atk: -8.931 ent: -9.675 str: 0.000 loss: -18.606]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.52it/s, atk: -8.931 ent: -9.675 str: 0.000 loss: -18.606]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.52it/s, atk: -12.080 ent: -9.666 str: 0.000 loss: -21.746]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -12.080 ent: -9.666 str: 0.000 loss: -21.746]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -15.893 ent: -9.660 str: 0.000 loss: -25.553]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.46it/s, atk: -15.893 ent: -9.660 str: 0.000 loss: -25.553]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -20.305 ent: -9.664 str: 0.000 loss: -29.969]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.57it/s, atk: -20.305 ent: -9.664 str: 0.000 loss: -29.969]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.57it/s, atk: -24.360 ent: -9.675 str: 0.000 loss: -34.035]Iterations:  33%|███▎      | 10/30 [00:06<00:11,  1.67it/s, atk: -24.360 ent: -9.675 str: 0.000 loss: -34.035]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.67it/s, atk: -29.439 ent: -9.679 str: 0.000 loss: -39.118]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.61it/s, atk: -29.439 ent: -9.679 str: 0.000 loss: -39.118]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.61it/s, atk: -34.135 ent: -9.677 str: 0.000 loss: -43.812]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.67it/s, atk: -34.135 ent: -9.677 str: 0.000 loss: -43.812]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.67it/s, atk: -38.066 ent: -9.679 str: 0.000 loss: -47.745]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.71it/s, atk: -38.066 ent: -9.679 str: 0.000 loss: -47.745]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.71it/s, atk: -41.644 ent: -9.681 str: 0.000 loss: -51.325]Iterations:  47%|████▋     | 14/30 [00:09<00:08,  1.78it/s, atk: -41.644 ent: -9.681 str: 0.000 loss: -51.325]Iterations:  47%|████▋     | 14/30 [00:09<00:08,  1.78it/s, atk: -45.806 ent: -9.677 str: 0.000 loss: -55.483]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.83it/s, atk: -45.806 ent: -9.677 str: 0.000 loss: -55.483]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.83it/s, atk: -50.481 ent: -9.677 str: 0.000 loss: -60.158]Iterations:  53%|█████▎    | 16/30 [00:10<00:07,  1.84it/s, atk: -50.481 ent: -9.677 str: 0.000 loss: -60.158]Iterations:  53%|█████▎    | 16/30 [00:10<00:07,  1.84it/s, atk: -55.508 ent: -9.674 str: 0.000 loss: -65.182]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.74it/s, atk: -55.508 ent: -9.674 str: 0.000 loss: -65.182]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.74it/s, atk: -59.159 ent: -9.672 str: 0.000 loss: -68.830]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.71it/s, atk: -59.159 ent: -9.672 str: 0.000 loss: -68.830]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.71it/s, atk: -62.086 ent: -9.674 str: 0.000 loss: -71.759]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.63it/s, atk: -62.086 ent: -9.674 str: 0.000 loss: -71.759]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.63it/s, atk: -66.542 ent: -9.678 str: 0.000 loss: -76.221]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.76it/s, atk: -66.542 ent: -9.678 str: 0.000 loss: -76.221]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.76it/s, atk: -70.637 ent: -9.678 str: 0.000 loss: -80.316]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.62it/s, atk: -70.637 ent: -9.678 str: 0.000 loss: -80.316]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.62it/s, atk: -73.414 ent: -9.680 str: 0.000 loss: -83.094]Iterations:  73%|███████▎  | 22/30 [00:13<00:04,  1.64it/s, atk: -73.414 ent: -9.680 str: 0.000 loss: -83.094]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.64it/s, atk: -76.053 ent: -9.674 str: 0.000 loss: -85.727]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.68it/s, atk: -76.053 ent: -9.674 str: 0.000 loss: -85.727]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.68it/s, atk: -79.472 ent: -9.671 str: 0.000 loss: -89.142]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.67it/s, atk: -79.472 ent: -9.671 str: 0.000 loss: -89.142]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.67it/s, atk: -82.493 ent: -9.670 str: 0.000 loss: -92.163]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  1.69it/s, atk: -82.493 ent: -9.670 str: 0.000 loss: -92.163]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  1.69it/s, atk: -84.524 ent: -9.670 str: 0.000 loss: -94.195]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.71it/s, atk: -84.524 ent: -9.670 str: 0.000 loss: -94.195]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.71it/s, atk: -87.958 ent: -9.669 str: 0.000 loss: -97.627]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  1.72it/s, atk: -87.958 ent: -9.669 str: 0.000 loss: -97.627]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.72it/s, atk: -91.080 ent: -9.669 str: 0.000 loss: -100.749]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.54it/s, atk: -91.080 ent: -9.669 str: 0.000 loss: -100.749]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.54it/s, atk: -94.333 ent: -9.669 str: 0.000 loss: -104.002]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.60it/s, atk: -94.333 ent: -9.669 str: 0.000 loss: -104.002]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.60it/s, atk: -97.416 ent: -9.669 str: 0.000 loss: -107.085]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.60it/s, atk: -97.416 ent: -9.669 str: 0.000 loss: -107.085]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.60it/s, atk: -97.416 ent: -9.669 str: 0.000 loss: -107.085]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([322], device='cuda:0') tensor(0.9990, device='cuda:0')
after_true: tensor([326], device='cuda:0') tensor(4.4293e-05, device='cuda:0')
L1: [4111.6157]	L2: [27.411804]	Linf: [0.78431374]

Accuracy on benign examples: 100.0%
gt_label: 137 pred_label: 137 pred_clean_logit 0.9772308468818665
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  4.77it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.13it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.57it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.79it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 14.15it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.22it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 15.60it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 17.30it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.37it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.72s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.77s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.72s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4822
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.163 ent: -7.307 str: 0.000 loss: -7.470]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.66s/it, atk: -0.163 ent: -7.307 str: 0.000 loss: -7.470]Iterations:   3%|▎         | 1/30 [00:02<00:48,  1.66s/it, atk: -2.817 ent: -7.274 str: 0.000 loss: -10.091]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -2.817 ent: -7.274 str: 0.000 loss: -10.091]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -6.192 ent: -7.287 str: 0.000 loss: -13.479]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.16it/s, atk: -6.192 ent: -7.287 str: 0.000 loss: -13.479]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.16it/s, atk: -10.229 ent: -7.279 str: 0.000 loss: -17.508]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.22it/s, atk: -10.229 ent: -7.279 str: 0.000 loss: -17.508]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.22it/s, atk: -19.940 ent: -7.279 str: 0.000 loss: -27.219]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.39it/s, atk: -19.940 ent: -7.279 str: 0.000 loss: -27.219]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.39it/s, atk: -31.302 ent: -7.278 str: 0.000 loss: -38.580]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.53it/s, atk: -31.302 ent: -7.278 str: 0.000 loss: -38.580]Iterations:  20%|██        | 6/30 [00:05<00:15,  1.53it/s, atk: -37.357 ent: -7.282 str: 0.000 loss: -44.639]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.59it/s, atk: -37.357 ent: -7.282 str: 0.000 loss: -44.639]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.59it/s, atk: -46.471 ent: -7.276 str: 0.000 loss: -53.748]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.60it/s, atk: -46.471 ent: -7.276 str: 0.000 loss: -53.748]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.60it/s, atk: -58.693 ent: -7.275 str: 0.000 loss: -65.969]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.56it/s, atk: -58.693 ent: -7.275 str: 0.000 loss: -65.969]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.56it/s, atk: -68.826 ent: -7.273 str: 0.000 loss: -76.099]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.57it/s, atk: -68.826 ent: -7.273 str: 0.000 loss: -76.099]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.57it/s, atk: -79.079 ent: -7.272 str: 0.000 loss: -86.350]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.61it/s, atk: -79.079 ent: -7.272 str: 0.000 loss: -86.350]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.61it/s, atk: -89.920 ent: -7.271 str: 0.000 loss: -97.191]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.68it/s, atk: -89.920 ent: -7.271 str: 0.000 loss: -97.191]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.68it/s, atk: -98.138 ent: -7.269 str: 0.000 loss: -105.407]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.40it/s, atk: -98.138 ent: -7.269 str: 0.000 loss: -105.407]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.40it/s, atk: -108.658 ent: -7.266 str: 0.000 loss: -115.925]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -108.658 ent: -7.266 str: 0.000 loss: -115.925]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -116.906 ent: -7.264 str: 0.000 loss: -124.170]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.52it/s, atk: -116.906 ent: -7.264 str: 0.000 loss: -124.170]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -125.955 ent: -7.261 str: 0.000 loss: -133.216]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.44it/s, atk: -125.955 ent: -7.261 str: 0.000 loss: -133.216]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.44it/s, atk: -132.002 ent: -7.259 str: 0.000 loss: -139.261]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.53it/s, atk: -132.002 ent: -7.259 str: 0.000 loss: -139.261]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.53it/s, atk: -140.347 ent: -7.259 str: 0.000 loss: -147.606]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.56it/s, atk: -140.347 ent: -7.259 str: 0.000 loss: -147.606]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.56it/s, atk: -146.304 ent: -7.258 str: 0.000 loss: -153.562]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.65it/s, atk: -146.304 ent: -7.258 str: 0.000 loss: -153.562]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.65it/s, atk: -152.581 ent: -7.257 str: 0.000 loss: -159.838]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.72it/s, atk: -152.581 ent: -7.257 str: 0.000 loss: -159.838]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.72it/s, atk: -157.999 ent: -7.256 str: 0.000 loss: -165.255]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.73it/s, atk: -157.999 ent: -7.256 str: 0.000 loss: -165.255]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.73it/s, atk: -163.972 ent: -7.254 str: 0.000 loss: -171.226]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.58it/s, atk: -163.972 ent: -7.254 str: 0.000 loss: -171.226]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.58it/s, atk: -169.660 ent: -7.253 str: 0.000 loss: -176.913]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.60it/s, atk: -169.660 ent: -7.253 str: 0.000 loss: -176.913]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.60it/s, atk: -175.206 ent: -7.251 str: 0.000 loss: -182.457]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.67it/s, atk: -175.206 ent: -7.251 str: 0.000 loss: -182.457]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.67it/s, atk: -181.860 ent: -7.249 str: 0.000 loss: -189.109]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.56it/s, atk: -181.860 ent: -7.249 str: 0.000 loss: -189.109]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -188.157 ent: -7.247 str: 0.000 loss: -195.403]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.64it/s, atk: -188.157 ent: -7.247 str: 0.000 loss: -195.403]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.64it/s, atk: -194.671 ent: -7.246 str: 0.000 loss: -201.917]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.50it/s, atk: -194.671 ent: -7.246 str: 0.000 loss: -201.917]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.50it/s, atk: -200.008 ent: -7.245 str: 0.000 loss: -207.253]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.59it/s, atk: -200.008 ent: -7.245 str: 0.000 loss: -207.253]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.59it/s, atk: -205.544 ent: -7.243 str: 0.000 loss: -212.787]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.63it/s, atk: -205.544 ent: -7.243 str: 0.000 loss: -212.787]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.63it/s, atk: -209.120 ent: -7.242 str: 0.000 loss: -216.362]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.68it/s, atk: -209.120 ent: -7.242 str: 0.000 loss: -216.362]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.51it/s, atk: -209.120 ent: -7.242 str: 0.000 loss: -216.362]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([357], device='cuda:0') tensor(0.8622, device='cuda:0')
after_true: tensor([137], device='cuda:0') tensor(4.6061e-10, device='cuda:0')
L1: [3400.3848]	L2: [22.691662]	Linf: [0.8039216]

Accuracy on benign examples: 100.0%
gt_label: 90 pred_label: 90 pred_clean_logit 0.9998136162757874
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.20it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.90it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.11it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 20.60it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 22.48it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 22.07it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.43it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.97it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.40s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.37s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3148
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.005 ent: -8.540 str: 0.000 loss: -8.545]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.33s/it, atk: -0.005 ent: -8.540 str: 0.000 loss: -8.545]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.33s/it, atk: -0.007 ent: -8.625 str: 0.000 loss: -8.632]Iterations:   7%|▋         | 2/30 [00:01<00:23,  1.17it/s, atk: -0.007 ent: -8.625 str: 0.000 loss: -8.632]Iterations:   7%|▋         | 2/30 [00:02<00:23,  1.17it/s, atk: -0.011 ent: -8.694 str: 0.000 loss: -8.706]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.34it/s, atk: -0.011 ent: -8.694 str: 0.000 loss: -8.706]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.34it/s, atk: -0.021 ent: -8.753 str: 0.000 loss: -8.774]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -0.021 ent: -8.753 str: 0.000 loss: -8.774]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -0.023 ent: -8.805 str: 0.000 loss: -8.828]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.46it/s, atk: -0.023 ent: -8.805 str: 0.000 loss: -8.828]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.46it/s, atk: -0.044 ent: -8.840 str: 0.000 loss: -8.884]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.52it/s, atk: -0.044 ent: -8.840 str: 0.000 loss: -8.884]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.52it/s, atk: -0.093 ent: -8.869 str: 0.000 loss: -8.962]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.53it/s, atk: -0.093 ent: -8.869 str: 0.000 loss: -8.962]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.53it/s, atk: -0.228 ent: -8.889 str: 0.000 loss: -9.117]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.63it/s, atk: -0.228 ent: -8.889 str: 0.000 loss: -9.117]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.63it/s, atk: -0.599 ent: -8.905 str: 0.000 loss: -9.504]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.61it/s, atk: -0.599 ent: -8.905 str: 0.000 loss: -9.504]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.61it/s, atk: -1.379 ent: -8.912 str: 0.000 loss: -10.291]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.62it/s, atk: -1.379 ent: -8.912 str: 0.000 loss: -10.291]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.62it/s, atk: -3.284 ent: -8.916 str: 0.000 loss: -12.200]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.69it/s, atk: -3.284 ent: -8.916 str: 0.000 loss: -12.200]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.69it/s, atk: -6.023 ent: -8.913 str: 0.000 loss: -14.936]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.41it/s, atk: -6.023 ent: -8.913 str: 0.000 loss: -14.936]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.41it/s, atk: -9.701 ent: -8.905 str: 0.000 loss: -18.605]Iterations:  43%|████▎     | 13/30 [00:08<00:11,  1.51it/s, atk: -9.701 ent: -8.905 str: 0.000 loss: -18.605]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.51it/s, atk: -13.665 ent: -8.900 str: 0.000 loss: -22.565]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.55it/s, atk: -13.665 ent: -8.900 str: 0.000 loss: -22.565]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.55it/s, atk: -18.419 ent: -8.904 str: 0.000 loss: -27.323]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -18.419 ent: -8.904 str: 0.000 loss: -27.323]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -23.695 ent: -8.902 str: 0.000 loss: -32.597]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.66it/s, atk: -23.695 ent: -8.902 str: 0.000 loss: -32.597]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.66it/s, atk: -29.613 ent: -8.900 str: 0.000 loss: -38.513]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.74it/s, atk: -29.613 ent: -8.900 str: 0.000 loss: -38.513]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.74it/s, atk: -34.720 ent: -8.899 str: 0.000 loss: -43.620]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.67it/s, atk: -34.720 ent: -8.899 str: 0.000 loss: -43.620]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.67it/s, atk: -39.904 ent: -8.899 str: 0.000 loss: -48.803]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.74it/s, atk: -39.904 ent: -8.899 str: 0.000 loss: -48.803]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.74it/s, atk: -44.967 ent: -8.899 str: 0.000 loss: -53.866]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.78it/s, atk: -44.967 ent: -8.899 str: 0.000 loss: -53.866]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.78it/s, atk: -49.822 ent: -8.898 str: 0.000 loss: -58.720]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.74it/s, atk: -49.822 ent: -8.898 str: 0.000 loss: -58.720]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.74it/s, atk: -54.461 ent: -8.896 str: 0.000 loss: -63.358]Iterations:  73%|███████▎  | 22/30 [00:13<00:04,  1.74it/s, atk: -54.461 ent: -8.896 str: 0.000 loss: -63.358]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.74it/s, atk: -59.112 ent: -8.895 str: 0.000 loss: -68.006]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.61it/s, atk: -59.112 ent: -8.895 str: 0.000 loss: -68.006]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.61it/s, atk: -64.213 ent: -8.893 str: 0.000 loss: -73.106]Iterations:  80%|████████  | 24/30 [00:15<00:04,  1.35it/s, atk: -64.213 ent: -8.893 str: 0.000 loss: -73.106]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.35it/s, atk: -68.405 ent: -8.892 str: 0.000 loss: -77.297]Iterations:  83%|████████▎ | 25/30 [00:16<00:04,  1.19it/s, atk: -68.405 ent: -8.892 str: 0.000 loss: -77.297]Iterations:  83%|████████▎ | 25/30 [00:17<00:04,  1.19it/s, atk: -72.768 ent: -8.891 str: 0.000 loss: -81.659]Iterations:  87%|████████▋ | 26/30 [00:17<00:03,  1.10it/s, atk: -72.768 ent: -8.891 str: 0.000 loss: -81.659]Iterations:  87%|████████▋ | 26/30 [00:18<00:03,  1.10it/s, atk: -77.059 ent: -8.889 str: 0.000 loss: -85.948]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.04it/s, atk: -77.059 ent: -8.889 str: 0.000 loss: -85.948]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.04it/s, atk: -81.309 ent: -8.888 str: 0.000 loss: -90.197]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.01it/s, atk: -81.309 ent: -8.888 str: 0.000 loss: -90.197]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.01it/s, atk: -85.812 ent: -8.887 str: 0.000 loss: -94.699]Iterations:  97%|█████████▋| 29/30 [00:21<00:01,  1.02s/it, atk: -85.812 ent: -8.887 str: 0.000 loss: -94.699]Iterations:  97%|█████████▋| 29/30 [00:21<00:01,  1.02s/it, atk: -90.493 ent: -8.886 str: 0.000 loss: -99.379]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.11s/it, atk: -90.493 ent: -8.886 str: 0.000 loss: -99.379]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -90.493 ent: -8.886 str: 0.000 loss: -99.379]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([88], device='cuda:0') tensor(0.9969, device='cuda:0')
after_true: tensor([90], device='cuda:0') tensor(7.4283e-05, device='cuda:0')
L1: [3296.941]	L2: [21.621878]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 981 pred_label: 981 pred_clean_logit 0.9665315747261047
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.66it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.02it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.79it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 12.04it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 12.37it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 12.16it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 11.97it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 11.31it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 11.76it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.01it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.82it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.68s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.85s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:04,  2.05s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.33s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5406
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.405 ent: -4.969 str: 0.000 loss: -5.374]Iterations:   3%|▎         | 1/30 [00:01<00:55,  1.93s/it, atk: -0.405 ent: -4.969 str: 0.000 loss: -5.374]Iterations:   3%|▎         | 1/30 [00:02<00:55,  1.93s/it, atk: -0.921 ent: -4.965 str: 0.000 loss: -5.886]Iterations:   7%|▋         | 2/30 [00:02<00:39,  1.42s/it, atk: -0.921 ent: -4.965 str: 0.000 loss: -5.886]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -1.979 ent: -4.965 str: 0.000 loss: -6.944]Iterations:  10%|█         | 3/30 [00:04<00:34,  1.28s/it, atk: -1.979 ent: -4.965 str: 0.000 loss: -6.944]Iterations:  10%|█         | 3/30 [00:04<00:34,  1.28s/it, atk: -3.595 ent: -4.963 str: 0.000 loss: -8.557]Iterations:  13%|█▎        | 4/30 [00:05<00:31,  1.20s/it, atk: -3.595 ent: -4.963 str: 0.000 loss: -8.557]Iterations:  13%|█▎        | 4/30 [00:05<00:31,  1.20s/it, atk: -5.957 ent: -4.961 str: 0.000 loss: -10.917]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.15s/it, atk: -5.957 ent: -4.961 str: 0.000 loss: -10.917]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.15s/it, atk: -8.732 ent: -4.959 str: 0.000 loss: -13.690]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.12s/it, atk: -8.732 ent: -4.959 str: 0.000 loss: -13.690]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.12s/it, atk: -12.368 ent: -4.958 str: 0.000 loss: -17.326]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -12.368 ent: -4.958 str: 0.000 loss: -17.326]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -16.584 ent: -4.956 str: 0.000 loss: -21.540]Iterations:  27%|██▋       | 8/30 [00:09<00:24,  1.09s/it, atk: -16.584 ent: -4.956 str: 0.000 loss: -21.540]Iterations:  27%|██▋       | 8/30 [00:10<00:24,  1.09s/it, atk: -21.754 ent: -4.956 str: 0.000 loss: -26.710]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.08s/it, atk: -21.754 ent: -4.956 str: 0.000 loss: -26.710]Iterations:  30%|███       | 9/30 [00:11<00:22,  1.08s/it, atk: -27.351 ent: -4.957 str: 0.000 loss: -32.308]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.07s/it, atk: -27.351 ent: -4.957 str: 0.000 loss: -32.308]Iterations:  33%|███▎      | 10/30 [00:12<00:21,  1.07s/it, atk: -32.809 ent: -4.956 str: 0.000 loss: -37.765]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -32.809 ent: -4.956 str: 0.000 loss: -37.765]Iterations:  37%|███▋      | 11/30 [00:13<00:20,  1.07s/it, atk: -38.111 ent: -4.956 str: 0.000 loss: -43.067]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -38.111 ent: -4.956 str: 0.000 loss: -43.067]Iterations:  40%|████      | 12/30 [00:14<00:19,  1.07s/it, atk: -42.965 ent: -4.955 str: 0.000 loss: -47.921]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.07s/it, atk: -42.965 ent: -4.955 str: 0.000 loss: -47.921]Iterations:  43%|████▎     | 13/30 [00:15<00:18,  1.07s/it, atk: -47.686 ent: -4.955 str: 0.000 loss: -52.641]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.07s/it, atk: -47.686 ent: -4.955 str: 0.000 loss: -52.641]Iterations:  47%|████▋     | 14/30 [00:16<00:17,  1.07s/it, atk: -52.210 ent: -4.955 str: 0.000 loss: -57.165]Iterations:  50%|█████     | 15/30 [00:16<00:15,  1.07s/it, atk: -52.210 ent: -4.955 str: 0.000 loss: -57.165]Iterations:  50%|█████     | 15/30 [00:17<00:15,  1.07s/it, atk: -57.019 ent: -4.953 str: 0.000 loss: -61.972]Iterations:  53%|█████▎    | 16/30 [00:17<00:14,  1.06s/it, atk: -57.019 ent: -4.953 str: 0.000 loss: -61.972]Iterations:  53%|█████▎    | 16/30 [00:18<00:14,  1.06s/it, atk: -62.591 ent: -4.952 str: 0.000 loss: -67.543]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.06s/it, atk: -62.591 ent: -4.952 str: 0.000 loss: -67.543]Iterations:  57%|█████▋    | 17/30 [00:19<00:13,  1.06s/it, atk: -67.495 ent: -4.952 str: 0.000 loss: -72.447]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.06s/it, atk: -67.495 ent: -4.952 str: 0.000 loss: -72.447]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.06s/it, atk: -71.472 ent: -4.952 str: 0.000 loss: -76.424]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.06s/it, atk: -71.472 ent: -4.952 str: 0.000 loss: -76.424]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.06s/it, atk: -75.895 ent: -4.952 str: 0.000 loss: -80.847]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.06s/it, atk: -75.895 ent: -4.952 str: 0.000 loss: -80.847]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.06s/it, atk: -79.495 ent: -4.952 str: 0.000 loss: -84.446]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.06s/it, atk: -79.495 ent: -4.952 str: 0.000 loss: -84.446]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.06s/it, atk: -82.892 ent: -4.951 str: 0.000 loss: -87.843]Iterations:  73%|███████▎  | 22/30 [00:24<00:07,  1.02it/s, atk: -82.892 ent: -4.951 str: 0.000 loss: -87.843]Iterations:  73%|███████▎  | 22/30 [00:24<00:07,  1.02it/s, atk: -86.354 ent: -4.950 str: 0.000 loss: -91.303]Iterations:  77%|███████▋  | 23/30 [00:24<00:05,  1.20it/s, atk: -86.354 ent: -4.950 str: 0.000 loss: -91.303]Iterations:  77%|███████▋  | 23/30 [00:24<00:05,  1.20it/s, atk: -90.562 ent: -4.949 str: 0.000 loss: -95.512]Iterations:  80%|████████  | 24/30 [00:24<00:04,  1.37it/s, atk: -90.562 ent: -4.949 str: 0.000 loss: -95.512]Iterations:  80%|████████  | 24/30 [00:25<00:04,  1.37it/s, atk: -94.866 ent: -4.948 str: 0.000 loss: -99.814]Iterations:  83%|████████▎ | 25/30 [00:25<00:03,  1.51it/s, atk: -94.866 ent: -4.948 str: 0.000 loss: -99.814]Iterations:  83%|████████▎ | 25/30 [00:25<00:03,  1.51it/s, atk: -98.757 ent: -4.948 str: 0.000 loss: -103.704]Iterations:  87%|████████▋ | 26/30 [00:25<00:02,  1.66it/s, atk: -98.757 ent: -4.948 str: 0.000 loss: -103.704]Iterations:  87%|████████▋ | 26/30 [00:26<00:02,  1.66it/s, atk: -103.737 ent: -4.947 str: 0.000 loss: -108.684]Iterations:  90%|█████████ | 27/30 [00:26<00:01,  1.76it/s, atk: -103.737 ent: -4.947 str: 0.000 loss: -108.684]Iterations:  90%|█████████ | 27/30 [00:26<00:01,  1.76it/s, atk: -109.600 ent: -4.946 str: 0.000 loss: -114.546]Iterations:  93%|█████████▎| 28/30 [00:26<00:01,  1.84it/s, atk: -109.600 ent: -4.946 str: 0.000 loss: -114.546]Iterations:  93%|█████████▎| 28/30 [00:27<00:01,  1.84it/s, atk: -114.298 ent: -4.945 str: 0.000 loss: -119.243]Iterations:  97%|█████████▋| 29/30 [00:27<00:00,  1.86it/s, atk: -114.298 ent: -4.945 str: 0.000 loss: -119.243]Iterations:  97%|█████████▋| 29/30 [00:27<00:00,  1.86it/s, atk: -117.769 ent: -4.945 str: 0.000 loss: -122.714]Iterations: 100%|██████████| 30/30 [00:27<00:00,  1.91it/s, atk: -117.769 ent: -4.945 str: 0.000 loss: -122.714]Iterations: 100%|██████████| 30/30 [00:27<00:00,  1.07it/s, atk: -117.769 ent: -4.945 str: 0.000 loss: -122.714]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([902], device='cuda:0') tensor(0.9575, device='cuda:0')
after_true: tensor([981], device='cuda:0') tensor(5.3010e-06, device='cuda:0')
L1: [2697.9062]	L2: [18.100233]	Linf: [0.65882355]

Accuracy on benign examples: 100.0%
gt_label: 9 pred_label: 9 pred_clean_logit 0.999969482421875
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 28.02it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.46it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 27.24it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 27.25it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 27.22it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 27.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 27.26it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.25it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.15it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.06it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.09s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.09s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3019
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.001 ent: -2.822 str: 0.000 loss: -2.823]Iterations:   3%|▎         | 1/30 [00:00<00:27,  1.06it/s, atk: -0.001 ent: -2.822 str: 0.000 loss: -2.823]Iterations:   3%|▎         | 1/30 [00:01<00:27,  1.06it/s, atk: -0.002 ent: -2.866 str: 0.000 loss: -2.868]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.44it/s, atk: -0.002 ent: -2.866 str: 0.000 loss: -2.868]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.44it/s, atk: -0.004 ent: -2.893 str: 0.000 loss: -2.896]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.68it/s, atk: -0.004 ent: -2.893 str: 0.000 loss: -2.896]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.68it/s, atk: -0.005 ent: -2.913 str: 0.000 loss: -2.918]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -0.005 ent: -2.913 str: 0.000 loss: -2.918]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -0.009 ent: -2.932 str: 0.000 loss: -2.941]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.87it/s, atk: -0.009 ent: -2.932 str: 0.000 loss: -2.941]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.87it/s, atk: -0.031 ent: -2.946 str: 0.000 loss: -2.977]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -0.031 ent: -2.946 str: 0.000 loss: -2.977]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -0.064 ent: -2.951 str: 0.000 loss: -3.015]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -0.064 ent: -2.951 str: 0.000 loss: -3.015]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.93it/s, atk: -0.876 ent: -2.946 str: 0.000 loss: -3.822]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -0.876 ent: -2.946 str: 0.000 loss: -3.822]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -2.879 ent: -2.946 str: 0.000 loss: -5.824]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.98it/s, atk: -2.879 ent: -2.946 str: 0.000 loss: -5.824]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.98it/s, atk: -9.328 ent: -2.943 str: 0.000 loss: -12.271]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.89it/s, atk: -9.328 ent: -2.943 str: 0.000 loss: -12.271]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.89it/s, atk: -26.797 ent: -2.940 str: 0.000 loss: -29.737]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -26.797 ent: -2.940 str: 0.000 loss: -29.737]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -37.722 ent: -2.940 str: 0.000 loss: -40.661]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -37.722 ent: -2.940 str: 0.000 loss: -40.661]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -56.623 ent: -2.936 str: 0.000 loss: -59.559]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.98it/s, atk: -56.623 ent: -2.936 str: 0.000 loss: -59.559]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.98it/s, atk: -69.522 ent: -2.935 str: 0.000 loss: -72.458]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.99it/s, atk: -69.522 ent: -2.935 str: 0.000 loss: -72.458]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.99it/s, atk: -83.716 ent: -2.934 str: 0.000 loss: -86.651]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.00it/s, atk: -83.716 ent: -2.934 str: 0.000 loss: -86.651]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.00it/s, atk: -101.115 ent: -2.934 str: 0.000 loss: -104.048]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  2.00it/s, atk: -101.115 ent: -2.934 str: 0.000 loss: -104.048]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  2.00it/s, atk: -116.017 ent: -2.933 str: 0.000 loss: -118.950]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.01it/s, atk: -116.017 ent: -2.933 str: 0.000 loss: -118.950]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.01it/s, atk: -124.489 ent: -2.933 str: 0.000 loss: -127.421]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.01it/s, atk: -124.489 ent: -2.933 str: 0.000 loss: -127.421]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.01it/s, atk: -138.041 ent: -2.930 str: 0.000 loss: -140.972]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -138.041 ent: -2.930 str: 0.000 loss: -140.972]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -149.476 ent: -2.928 str: 0.000 loss: -152.404]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.89it/s, atk: -149.476 ent: -2.928 str: 0.000 loss: -152.404]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.89it/s, atk: -158.965 ent: -2.927 str: 0.000 loss: -161.892]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.91it/s, atk: -158.965 ent: -2.927 str: 0.000 loss: -161.892]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.91it/s, atk: -169.716 ent: -2.926 str: 0.000 loss: -172.642]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.95it/s, atk: -169.716 ent: -2.926 str: 0.000 loss: -172.642]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.95it/s, atk: -180.442 ent: -2.923 str: 0.000 loss: -183.364]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -180.442 ent: -2.923 str: 0.000 loss: -183.364]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -189.594 ent: -2.920 str: 0.000 loss: -192.514]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -189.594 ent: -2.920 str: 0.000 loss: -192.514]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -198.597 ent: -2.919 str: 0.000 loss: -201.516]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.85it/s, atk: -198.597 ent: -2.919 str: 0.000 loss: -201.516]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.85it/s, atk: -207.192 ent: -2.917 str: 0.000 loss: -210.110]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.85it/s, atk: -207.192 ent: -2.917 str: 0.000 loss: -210.110]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.85it/s, atk: -214.194 ent: -2.915 str: 0.000 loss: -217.109]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.90it/s, atk: -214.194 ent: -2.915 str: 0.000 loss: -217.109]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.90it/s, atk: -219.777 ent: -2.911 str: 0.000 loss: -222.688]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -219.777 ent: -2.911 str: 0.000 loss: -222.688]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.91it/s, atk: -223.208 ent: -2.911 str: 0.000 loss: -226.119]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.93it/s, atk: -223.208 ent: -2.911 str: 0.000 loss: -226.119]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.93it/s, atk: -231.232 ent: -2.909 str: 0.000 loss: -234.141]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.96it/s, atk: -231.232 ent: -2.909 str: 0.000 loss: -234.141]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -231.232 ent: -2.909 str: 0.000 loss: -234.141]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([348], device='cuda:0') tensor(0.9113, device='cuda:0')
after_true: tensor([9], device='cuda:0') tensor(4.6478e-11, device='cuda:0')
L1: [2812.945]	L2: [18.079433]	Linf: [0.5411765]

Accuracy on benign examples: 100.0%
gt_label: 471 pred_label: 471 pred_clean_logit 0.9412399530410767
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.15it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.43it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 20.54it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 21.81it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 22.48it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 23.73it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.82it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.95it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.06s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:02,  1.00it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.06s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.14s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.17s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3915
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.208 ent: -2.607 str: 0.000 loss: -6.815]Iterations:   3%|▎         | 1/30 [00:01<00:45,  1.58s/it, atk: -4.208 ent: -2.607 str: 0.000 loss: -6.815]Iterations:   3%|▎         | 1/30 [00:01<00:45,  1.58s/it, atk: -1.170 ent: -2.615 str: 0.000 loss: -3.784]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -1.170 ent: -2.615 str: 0.000 loss: -3.784]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -3.368 ent: -2.624 str: 0.000 loss: -5.992]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.36it/s, atk: -3.368 ent: -2.624 str: 0.000 loss: -5.992]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.36it/s, atk: -3.723 ent: -2.620 str: 0.000 loss: -6.343]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.56it/s, atk: -3.723 ent: -2.620 str: 0.000 loss: -6.343]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.56it/s, atk: -5.576 ent: -2.627 str: 0.000 loss: -8.202]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.69it/s, atk: -5.576 ent: -2.627 str: 0.000 loss: -8.202]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.69it/s, atk: -9.152 ent: -2.633 str: 0.000 loss: -11.785]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.78it/s, atk: -9.152 ent: -2.633 str: 0.000 loss: -11.785]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.78it/s, atk: -14.464 ent: -2.633 str: 0.000 loss: -17.097]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.85it/s, atk: -14.464 ent: -2.633 str: 0.000 loss: -17.097]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.85it/s, atk: -16.540 ent: -2.629 str: 0.000 loss: -19.169]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.90it/s, atk: -16.540 ent: -2.629 str: 0.000 loss: -19.169]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.90it/s, atk: -23.933 ent: -2.624 str: 0.000 loss: -26.558]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -23.933 ent: -2.624 str: 0.000 loss: -26.558]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -31.565 ent: -2.624 str: 0.000 loss: -34.189]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.97it/s, atk: -31.565 ent: -2.624 str: 0.000 loss: -34.189]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.97it/s, atk: -40.280 ent: -2.625 str: 0.000 loss: -42.905]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -40.280 ent: -2.625 str: 0.000 loss: -42.905]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -49.397 ent: -2.624 str: 0.000 loss: -52.020]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.99it/s, atk: -49.397 ent: -2.624 str: 0.000 loss: -52.020]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.99it/s, atk: -57.383 ent: -2.622 str: 0.000 loss: -60.005]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.96it/s, atk: -57.383 ent: -2.622 str: 0.000 loss: -60.005]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.96it/s, atk: -63.285 ent: -2.623 str: 0.000 loss: -65.908]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.98it/s, atk: -63.285 ent: -2.623 str: 0.000 loss: -65.908]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.98it/s, atk: -72.324 ent: -2.622 str: 0.000 loss: -74.946]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -72.324 ent: -2.622 str: 0.000 loss: -74.946]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -76.636 ent: -2.619 str: 0.000 loss: -79.255]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  2.00it/s, atk: -76.636 ent: -2.619 str: 0.000 loss: -79.255]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  2.00it/s, atk: -82.758 ent: -2.616 str: 0.000 loss: -85.374]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.99it/s, atk: -82.758 ent: -2.616 str: 0.000 loss: -85.374]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.99it/s, atk: -89.817 ent: -2.612 str: 0.000 loss: -92.429]Iterations:  60%|██████    | 18/30 [00:10<00:06,  2.00it/s, atk: -89.817 ent: -2.612 str: 0.000 loss: -92.429]Iterations:  60%|██████    | 18/30 [00:10<00:06,  2.00it/s, atk: -87.232 ent: -2.612 str: 0.000 loss: -89.844]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.01it/s, atk: -87.232 ent: -2.612 str: 0.000 loss: -89.844]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.01it/s, atk: -94.952 ent: -2.609 str: 0.000 loss: -97.561]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.02it/s, atk: -94.952 ent: -2.609 str: 0.000 loss: -97.561]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.02it/s, atk: -107.878 ent: -2.610 str: 0.000 loss: -110.488]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.02it/s, atk: -107.878 ent: -2.610 str: 0.000 loss: -110.488]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.02it/s, atk: -109.626 ent: -2.609 str: 0.000 loss: -112.235]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.02it/s, atk: -109.626 ent: -2.609 str: 0.000 loss: -112.235]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.02it/s, atk: -117.124 ent: -2.608 str: 0.000 loss: -119.732]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -117.124 ent: -2.608 str: 0.000 loss: -119.732]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -124.787 ent: -2.609 str: 0.000 loss: -127.396]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.99it/s, atk: -124.787 ent: -2.609 str: 0.000 loss: -127.396]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.99it/s, atk: -129.775 ent: -2.608 str: 0.000 loss: -132.383]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -129.775 ent: -2.608 str: 0.000 loss: -132.383]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -135.205 ent: -2.608 str: 0.000 loss: -137.813]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.99it/s, atk: -135.205 ent: -2.608 str: 0.000 loss: -137.813]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.99it/s, atk: -140.905 ent: -2.607 str: 0.000 loss: -143.512]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -140.905 ent: -2.607 str: 0.000 loss: -143.512]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -146.810 ent: -2.606 str: 0.000 loss: -149.416]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  2.00it/s, atk: -146.810 ent: -2.606 str: 0.000 loss: -149.416]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  2.00it/s, atk: -152.879 ent: -2.605 str: 0.000 loss: -155.483]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -152.879 ent: -2.605 str: 0.000 loss: -155.483]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -157.991 ent: -2.604 str: 0.000 loss: -160.595]Iterations: 100%|██████████| 30/30 [00:16<00:00,  2.01it/s, atk: -157.991 ent: -2.604 str: 0.000 loss: -160.595]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.87it/s, atk: -157.991 ent: -2.604 str: 0.000 loss: -160.595]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([671], device='cuda:0') tensor(0.9801, device='cuda:0')
after_true: tensor([471], device='cuda:0') tensor(7.2900e-08, device='cuda:0')
L1: [2732.474]	L2: [18.570827]	Linf: [0.64705884]

Accuracy on benign examples: 100.0%
gt_label: 303 pred_label: 303 pred_clean_logit 0.7173724174499512
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.16it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.31it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.66it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.27it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.71it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.32it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.42it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.03s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.07s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.11s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.26s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4759
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -6.434 ent: -10.572 str: 0.000 loss: -17.006]Iterations:   3%|▎         | 1/30 [00:00<00:27,  1.05it/s, atk: -6.434 ent: -10.572 str: 0.000 loss: -17.006]Iterations:   3%|▎         | 1/30 [00:01<00:27,  1.05it/s, atk: -10.615 ent: -10.484 str: 0.000 loss: -21.099]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.46it/s, atk: -10.615 ent: -10.484 str: 0.000 loss: -21.099]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.46it/s, atk: -16.514 ent: -10.467 str: 0.000 loss: -26.981]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.49it/s, atk: -16.514 ent: -10.467 str: 0.000 loss: -26.981]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.49it/s, atk: -20.298 ent: -10.479 str: 0.000 loss: -30.777]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.63it/s, atk: -20.298 ent: -10.479 str: 0.000 loss: -30.777]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.63it/s, atk: -25.196 ent: -10.477 str: 0.000 loss: -35.673]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -25.196 ent: -10.477 str: 0.000 loss: -35.673]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -21.311 ent: -10.451 str: 0.000 loss: -31.761]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.83it/s, atk: -21.311 ent: -10.451 str: 0.000 loss: -31.761]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.83it/s, atk: -27.515 ent: -10.447 str: 0.000 loss: -37.963]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.89it/s, atk: -27.515 ent: -10.447 str: 0.000 loss: -37.963]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.89it/s, atk: -33.519 ent: -10.447 str: 0.000 loss: -43.966]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.88it/s, atk: -33.519 ent: -10.447 str: 0.000 loss: -43.966]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.88it/s, atk: -38.918 ent: -10.449 str: 0.000 loss: -49.367]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -38.918 ent: -10.449 str: 0.000 loss: -49.367]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -44.257 ent: -10.454 str: 0.000 loss: -54.711]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -44.257 ent: -10.454 str: 0.000 loss: -54.711]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -45.489 ent: -10.452 str: 0.000 loss: -55.942]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.97it/s, atk: -45.489 ent: -10.452 str: 0.000 loss: -55.942]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.97it/s, atk: -47.753 ent: -10.444 str: 0.000 loss: -58.197]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -47.753 ent: -10.444 str: 0.000 loss: -58.197]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -52.358 ent: -10.447 str: 0.000 loss: -62.805]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.96it/s, atk: -52.358 ent: -10.447 str: 0.000 loss: -62.805]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.96it/s, atk: -56.484 ent: -10.453 str: 0.000 loss: -66.937]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -56.484 ent: -10.453 str: 0.000 loss: -66.937]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -59.423 ent: -10.452 str: 0.000 loss: -69.875]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.00it/s, atk: -59.423 ent: -10.452 str: 0.000 loss: -69.875]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.00it/s, atk: -62.955 ent: -10.453 str: 0.000 loss: -73.409]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -62.955 ent: -10.453 str: 0.000 loss: -73.409]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -67.776 ent: -10.459 str: 0.000 loss: -78.235]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -67.776 ent: -10.459 str: 0.000 loss: -78.235]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -74.984 ent: -10.459 str: 0.000 loss: -85.442]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -74.984 ent: -10.459 str: 0.000 loss: -85.442]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -78.660 ent: -10.465 str: 0.000 loss: -89.125]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.99it/s, atk: -78.660 ent: -10.465 str: 0.000 loss: -89.125]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.99it/s, atk: -84.365 ent: -10.471 str: 0.000 loss: -94.836]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -84.365 ent: -10.471 str: 0.000 loss: -94.836]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -90.449 ent: -10.468 str: 0.000 loss: -100.917]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -90.449 ent: -10.468 str: 0.000 loss: -100.917]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -95.896 ent: -10.469 str: 0.000 loss: -106.364]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  2.00it/s, atk: -95.896 ent: -10.469 str: 0.000 loss: -106.364]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  2.00it/s, atk: -99.912 ent: -10.472 str: 0.000 loss: -110.384]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -99.912 ent: -10.472 str: 0.000 loss: -110.384]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -106.113 ent: -10.476 str: 0.000 loss: -116.589]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -106.113 ent: -10.476 str: 0.000 loss: -116.589]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -110.512 ent: -10.486 str: 0.000 loss: -120.998]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -110.512 ent: -10.486 str: 0.000 loss: -120.998]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -113.740 ent: -10.489 str: 0.000 loss: -124.229]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.96it/s, atk: -113.740 ent: -10.489 str: 0.000 loss: -124.229]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.96it/s, atk: -118.346 ent: -10.491 str: 0.000 loss: -128.837]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.94it/s, atk: -118.346 ent: -10.491 str: 0.000 loss: -128.837]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.94it/s, atk: -122.041 ent: -10.491 str: 0.000 loss: -132.531]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.96it/s, atk: -122.041 ent: -10.491 str: 0.000 loss: -132.531]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.96it/s, atk: -125.414 ent: -10.487 str: 0.000 loss: -135.901]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.98it/s, atk: -125.414 ent: -10.487 str: 0.000 loss: -135.901]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.98it/s, atk: -129.463 ent: -10.480 str: 0.000 loss: -139.943]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -129.463 ent: -10.480 str: 0.000 loss: -139.943]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -129.463 ent: -10.480 str: 0.000 loss: -139.943]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([300], device='cuda:0') tensor(0.9922, device='cuda:0')
after_true: tensor([303], device='cuda:0') tensor(1.5960e-06, device='cuda:0')
L1: [2531.5217]	L2: [17.026073]	Linf: [0.5372549]

Accuracy on benign examples: 100.0%
gt_label: 967 pred_label: 967 pred_clean_logit 0.9989633560180664
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.78it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 23.28it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 24.91it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 25.53it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.84it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 26.20it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.13s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.01s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.07s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.26s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.23s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3828
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.006 ent: -2.675 str: 0.000 loss: -2.680]Iterations:   3%|▎         | 1/30 [00:01<00:44,  1.55s/it, atk: -0.006 ent: -2.675 str: 0.000 loss: -2.680]Iterations:   3%|▎         | 1/30 [00:01<00:44,  1.55s/it, atk: -0.008 ent: -2.695 str: 0.000 loss: -2.703]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.008 ent: -2.695 str: 0.000 loss: -2.703]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.010 ent: -2.710 str: 0.000 loss: -2.721]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.20it/s, atk: -0.010 ent: -2.710 str: 0.000 loss: -2.721]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.20it/s, atk: -0.013 ent: -2.724 str: 0.000 loss: -2.737]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.40it/s, atk: -0.013 ent: -2.724 str: 0.000 loss: -2.737]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.40it/s, atk: -0.023 ent: -2.734 str: 0.000 loss: -2.757]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.55it/s, atk: -0.023 ent: -2.734 str: 0.000 loss: -2.757]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.55it/s, atk: -0.033 ent: -2.745 str: 0.000 loss: -2.778]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.67it/s, atk: -0.033 ent: -2.745 str: 0.000 loss: -2.778]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.67it/s, atk: -0.063 ent: -2.754 str: 0.000 loss: -2.817]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.75it/s, atk: -0.063 ent: -2.754 str: 0.000 loss: -2.817]Iterations:  23%|██▎       | 7/30 [00:05<00:13,  1.75it/s, atk: -0.112 ent: -2.755 str: 0.000 loss: -2.867]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.81it/s, atk: -0.112 ent: -2.755 str: 0.000 loss: -2.867]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.81it/s, atk: -0.247 ent: -2.765 str: 0.000 loss: -3.012]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.86it/s, atk: -0.247 ent: -2.765 str: 0.000 loss: -3.012]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.86it/s, atk: -0.454 ent: -2.770 str: 0.000 loss: -3.224]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.85it/s, atk: -0.454 ent: -2.770 str: 0.000 loss: -3.224]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.85it/s, atk: -0.957 ent: -2.771 str: 0.000 loss: -3.728]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.87it/s, atk: -0.957 ent: -2.771 str: 0.000 loss: -3.728]Iterations:  37%|███▋      | 11/30 [00:07<00:10,  1.87it/s, atk: -1.958 ent: -2.769 str: 0.000 loss: -4.727]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.88it/s, atk: -1.958 ent: -2.769 str: 0.000 loss: -4.727]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.88it/s, atk: -3.238 ent: -2.768 str: 0.000 loss: -6.006]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.93it/s, atk: -3.238 ent: -2.768 str: 0.000 loss: -6.006]Iterations:  43%|████▎     | 13/30 [00:08<00:08,  1.93it/s, atk: -6.900 ent: -2.766 str: 0.000 loss: -9.666]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.93it/s, atk: -6.900 ent: -2.766 str: 0.000 loss: -9.666]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.93it/s, atk: -11.097 ent: -2.764 str: 0.000 loss: -13.862]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -11.097 ent: -2.764 str: 0.000 loss: -13.862]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.96it/s, atk: -20.962 ent: -2.759 str: 0.000 loss: -23.721]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.98it/s, atk: -20.962 ent: -2.759 str: 0.000 loss: -23.721]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.98it/s, atk: -28.841 ent: -2.756 str: 0.000 loss: -31.597]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.99it/s, atk: -28.841 ent: -2.756 str: 0.000 loss: -31.597]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.99it/s, atk: -39.669 ent: -2.753 str: 0.000 loss: -42.422]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.99it/s, atk: -39.669 ent: -2.753 str: 0.000 loss: -42.422]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.99it/s, atk: -48.481 ent: -2.750 str: 0.000 loss: -51.230]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -48.481 ent: -2.750 str: 0.000 loss: -51.230]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.00it/s, atk: -57.825 ent: -2.747 str: 0.000 loss: -60.573]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.01it/s, atk: -57.825 ent: -2.747 str: 0.000 loss: -60.573]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.01it/s, atk: -68.023 ent: -2.745 str: 0.000 loss: -70.768]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.01it/s, atk: -68.023 ent: -2.745 str: 0.000 loss: -70.768]Iterations:  70%|███████   | 21/30 [00:12<00:04,  2.01it/s, atk: -75.852 ent: -2.743 str: 0.000 loss: -78.595]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.92it/s, atk: -75.852 ent: -2.743 str: 0.000 loss: -78.595]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.92it/s, atk: -83.883 ent: -2.740 str: 0.000 loss: -86.622]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -83.883 ent: -2.740 str: 0.000 loss: -86.622]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.94it/s, atk: -92.115 ent: -2.737 str: 0.000 loss: -94.852]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.98it/s, atk: -92.115 ent: -2.737 str: 0.000 loss: -94.852]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.98it/s, atk: -99.271 ent: -2.735 str: 0.000 loss: -102.006]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.95it/s, atk: -99.271 ent: -2.735 str: 0.000 loss: -102.006]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.95it/s, atk: -106.316 ent: -2.733 str: 0.000 loss: -109.049]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -106.316 ent: -2.733 str: 0.000 loss: -109.049]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -113.713 ent: -2.731 str: 0.000 loss: -116.444]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.98it/s, atk: -113.713 ent: -2.731 str: 0.000 loss: -116.444]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.98it/s, atk: -121.166 ent: -2.728 str: 0.000 loss: -123.894]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -121.166 ent: -2.728 str: 0.000 loss: -123.894]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -128.392 ent: -2.726 str: 0.000 loss: -131.118]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.98it/s, atk: -128.392 ent: -2.726 str: 0.000 loss: -131.118]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.98it/s, atk: -135.388 ent: -2.723 str: 0.000 loss: -138.111]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.88it/s, atk: -135.388 ent: -2.723 str: 0.000 loss: -138.111]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.81it/s, atk: -135.388 ent: -2.723 str: 0.000 loss: -138.111]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([935], device='cuda:0') tensor(0.9955, device='cuda:0')
after_true: tensor([967], device='cuda:0') tensor(6.6556e-07, device='cuda:0')
L1: [1749.3333]	L2: [13.144805]	Linf: [0.5803922]

Accuracy on benign examples: 100.0%
gt_label: 450 pred_label: 450 pred_clean_logit 0.998499870300293
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 25.70it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 24.87it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.60it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.97it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.13it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.88it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.11s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.21s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.39s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.45s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.38s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4262
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.016 ent: -4.924 str: 0.000 loss: -4.939]Iterations:   3%|▎         | 1/30 [00:00<00:24,  1.21it/s, atk: -0.016 ent: -4.924 str: 0.000 loss: -4.939]Iterations:   3%|▎         | 1/30 [00:01<00:24,  1.21it/s, atk: -0.105 ent: -4.958 str: 0.000 loss: -5.064]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.55it/s, atk: -0.105 ent: -4.958 str: 0.000 loss: -5.064]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.55it/s, atk: -0.916 ent: -4.960 str: 0.000 loss: -5.876]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.74it/s, atk: -0.916 ent: -4.960 str: 0.000 loss: -5.876]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.74it/s, atk: -3.244 ent: -4.958 str: 0.000 loss: -8.202]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.83it/s, atk: -3.244 ent: -4.958 str: 0.000 loss: -8.202]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.83it/s, atk: -9.323 ent: -4.953 str: 0.000 loss: -14.276]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.89it/s, atk: -9.323 ent: -4.953 str: 0.000 loss: -14.276]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.89it/s, atk: -19.773 ent: -4.949 str: 0.000 loss: -24.722]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -19.773 ent: -4.949 str: 0.000 loss: -24.722]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -31.477 ent: -4.944 str: 0.000 loss: -36.421]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.91it/s, atk: -31.477 ent: -4.944 str: 0.000 loss: -36.421]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.91it/s, atk: -44.926 ent: -4.940 str: 0.000 loss: -49.866]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.70it/s, atk: -44.926 ent: -4.940 str: 0.000 loss: -49.866]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.70it/s, atk: -58.700 ent: -4.937 str: 0.000 loss: -63.637]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.78it/s, atk: -58.700 ent: -4.937 str: 0.000 loss: -63.637]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.78it/s, atk: -73.886 ent: -4.935 str: 0.000 loss: -78.821]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.85it/s, atk: -73.886 ent: -4.935 str: 0.000 loss: -78.821]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.85it/s, atk: -90.736 ent: -4.934 str: 0.000 loss: -95.670]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.88it/s, atk: -90.736 ent: -4.934 str: 0.000 loss: -95.670]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.88it/s, atk: -107.689 ent: -4.932 str: 0.000 loss: -112.621]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.91it/s, atk: -107.689 ent: -4.932 str: 0.000 loss: -112.621]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.91it/s, atk: -126.791 ent: -4.931 str: 0.000 loss: -131.722]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.87it/s, atk: -126.791 ent: -4.931 str: 0.000 loss: -131.722]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.87it/s, atk: -146.585 ent: -4.930 str: 0.000 loss: -151.515]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.83it/s, atk: -146.585 ent: -4.930 str: 0.000 loss: -151.515]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.83it/s, atk: -164.563 ent: -4.929 str: 0.000 loss: -169.492]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.86it/s, atk: -164.563 ent: -4.929 str: 0.000 loss: -169.492]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.86it/s, atk: -182.178 ent: -4.927 str: 0.000 loss: -187.104]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.91it/s, atk: -182.178 ent: -4.927 str: 0.000 loss: -187.104]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.91it/s, atk: -195.500 ent: -4.926 str: 0.000 loss: -200.425]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -195.500 ent: -4.926 str: 0.000 loss: -200.425]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -210.715 ent: -4.925 str: 0.000 loss: -215.640]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.73it/s, atk: -210.715 ent: -4.925 str: 0.000 loss: -215.640]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.73it/s, atk: -226.124 ent: -4.926 str: 0.000 loss: -231.049]Iterations:  63%|██████▎   | 19/30 [00:10<00:06,  1.80it/s, atk: -226.124 ent: -4.926 str: 0.000 loss: -231.049]Iterations:  63%|██████▎   | 19/30 [00:10<00:06,  1.80it/s, atk: -240.051 ent: -4.925 str: 0.000 loss: -244.975]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.84it/s, atk: -240.051 ent: -4.925 str: 0.000 loss: -244.975]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.84it/s, atk: -254.040 ent: -4.925 str: 0.000 loss: -258.965]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.89it/s, atk: -254.040 ent: -4.925 str: 0.000 loss: -258.965]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.89it/s, atk: -267.661 ent: -4.926 str: 0.000 loss: -272.587]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.90it/s, atk: -267.661 ent: -4.926 str: 0.000 loss: -272.587]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.90it/s, atk: -279.970 ent: -4.924 str: 0.000 loss: -284.894]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.84it/s, atk: -279.970 ent: -4.924 str: 0.000 loss: -284.894]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.84it/s, atk: -294.411 ent: -4.924 str: 0.000 loss: -299.335]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.83it/s, atk: -294.411 ent: -4.924 str: 0.000 loss: -299.335]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.83it/s, atk: -306.280 ent: -4.922 str: 0.000 loss: -311.202]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.87it/s, atk: -306.280 ent: -4.922 str: 0.000 loss: -311.202]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.87it/s, atk: -318.186 ent: -4.921 str: 0.000 loss: -323.107]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.91it/s, atk: -318.186 ent: -4.921 str: 0.000 loss: -323.107]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.91it/s, atk: -330.630 ent: -4.919 str: 0.000 loss: -335.549]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.92it/s, atk: -330.630 ent: -4.919 str: 0.000 loss: -335.549]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.92it/s, atk: -343.901 ent: -4.918 str: 0.000 loss: -348.819]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.95it/s, atk: -343.901 ent: -4.918 str: 0.000 loss: -348.819]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.95it/s, atk: -353.381 ent: -4.916 str: 0.000 loss: -358.297]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -353.381 ent: -4.916 str: 0.000 loss: -358.297]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -364.853 ent: -4.914 str: 0.000 loss: -369.767]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.98it/s, atk: -364.853 ent: -4.914 str: 0.000 loss: -369.767]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.86it/s, atk: -364.853 ent: -4.914 str: 0.000 loss: -369.767]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([731], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([450], device='cuda:0') tensor(5.1359e-17, device='cuda:0')
L1: [2864.1885]	L2: [20.682598]	Linf: [0.7529412]

Accuracy on benign examples: 0.0%
gt_label: 326 pred_label: 989 pred_clean_logit 0.09430213272571564
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.94it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.82it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.94it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.38it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.50it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.92it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.36it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.28s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.37s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.33s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.41s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.45s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5897
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:03<?, ?it/s, atk: -14.141 ent: -10.097 str: 0.000 loss: -24.238]Iterations:   3%|▎         | 1/30 [00:03<01:39,  3.44s/it, atk: -14.141 ent: -10.097 str: 0.000 loss: -24.238]Iterations:   3%|▎         | 1/30 [00:03<01:39,  3.44s/it, atk: -33.191 ent: -10.047 str: 0.000 loss: -43.239]Iterations:   7%|▋         | 2/30 [00:03<00:47,  1.70s/it, atk: -33.191 ent: -10.047 str: 0.000 loss: -43.239]Iterations:   7%|▋         | 2/30 [00:04<00:47,  1.70s/it, atk: -45.389 ent: -10.080 str: 0.000 loss: -55.469]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.22s/it, atk: -45.389 ent: -10.080 str: 0.000 loss: -55.469]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.22s/it, atk: -52.534 ent: -10.090 str: 0.000 loss: -62.624]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.07it/s, atk: -52.534 ent: -10.090 str: 0.000 loss: -62.624]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.07it/s, atk: -61.868 ent: -10.099 str: 0.000 loss: -71.967]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.28it/s, atk: -61.868 ent: -10.099 str: 0.000 loss: -71.967]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.28it/s, atk: -69.866 ent: -10.084 str: 0.000 loss: -79.950]Iterations:  20%|██        | 6/30 [00:06<00:16,  1.46it/s, atk: -69.866 ent: -10.084 str: 0.000 loss: -79.950]Iterations:  20%|██        | 6/30 [00:06<00:16,  1.46it/s, atk: -76.691 ent: -10.073 str: 0.000 loss: -86.764]Iterations:  23%|██▎       | 7/30 [00:06<00:14,  1.61it/s, atk: -76.691 ent: -10.073 str: 0.000 loss: -86.764]Iterations:  23%|██▎       | 7/30 [00:06<00:14,  1.61it/s, atk: -82.205 ent: -10.067 str: 0.000 loss: -92.271]Iterations:  27%|██▋       | 8/30 [00:07<00:12,  1.72it/s, atk: -82.205 ent: -10.067 str: 0.000 loss: -92.271]Iterations:  27%|██▋       | 8/30 [00:07<00:12,  1.72it/s, atk: -91.423 ent: -10.063 str: 0.000 loss: -101.486]Iterations:  30%|███       | 9/30 [00:07<00:11,  1.79it/s, atk: -91.423 ent: -10.063 str: 0.000 loss: -101.486]Iterations:  30%|███       | 9/30 [00:07<00:11,  1.79it/s, atk: -101.891 ent: -10.061 str: 0.000 loss: -111.952]Iterations:  33%|███▎      | 10/30 [00:08<00:10,  1.85it/s, atk: -101.891 ent: -10.061 str: 0.000 loss: -111.952]Iterations:  33%|███▎      | 10/30 [00:08<00:10,  1.85it/s, atk: -110.031 ent: -10.060 str: 0.000 loss: -120.091]Iterations:  37%|███▋      | 11/30 [00:08<00:09,  1.90it/s, atk: -110.031 ent: -10.060 str: 0.000 loss: -120.091]Iterations:  37%|███▋      | 11/30 [00:08<00:09,  1.90it/s, atk: -114.698 ent: -10.059 str: 0.000 loss: -124.757]Iterations:  40%|████      | 12/30 [00:09<00:09,  1.92it/s, atk: -114.698 ent: -10.059 str: 0.000 loss: -124.757]Iterations:  40%|████      | 12/30 [00:09<00:09,  1.92it/s, atk: -123.410 ent: -10.064 str: 0.000 loss: -133.473]Iterations:  43%|████▎     | 13/30 [00:09<00:09,  1.87it/s, atk: -123.410 ent: -10.064 str: 0.000 loss: -133.473]Iterations:  43%|████▎     | 13/30 [00:09<00:09,  1.87it/s, atk: -130.137 ent: -10.066 str: 0.000 loss: -140.202]Iterations:  47%|████▋     | 14/30 [00:10<00:08,  1.91it/s, atk: -130.137 ent: -10.066 str: 0.000 loss: -140.202]Iterations:  47%|████▋     | 14/30 [00:10<00:08,  1.91it/s, atk: -136.361 ent: -10.066 str: 0.000 loss: -146.427]Iterations:  50%|█████     | 15/30 [00:10<00:07,  1.95it/s, atk: -136.361 ent: -10.066 str: 0.000 loss: -146.427]Iterations:  50%|█████     | 15/30 [00:10<00:07,  1.95it/s, atk: -142.423 ent: -10.065 str: 0.000 loss: -152.488]Iterations:  53%|█████▎    | 16/30 [00:11<00:07,  1.96it/s, atk: -142.423 ent: -10.065 str: 0.000 loss: -152.488]Iterations:  53%|█████▎    | 16/30 [00:11<00:07,  1.96it/s, atk: -148.732 ent: -10.063 str: 0.000 loss: -158.795]Iterations:  57%|█████▋    | 17/30 [00:11<00:06,  1.99it/s, atk: -148.732 ent: -10.063 str: 0.000 loss: -158.795]Iterations:  57%|█████▋    | 17/30 [00:11<00:06,  1.99it/s, atk: -154.381 ent: -10.063 str: 0.000 loss: -164.444]Iterations:  60%|██████    | 18/30 [00:12<00:05,  2.01it/s, atk: -154.381 ent: -10.063 str: 0.000 loss: -164.444]Iterations:  60%|██████    | 18/30 [00:12<00:05,  2.01it/s, atk: -159.715 ent: -10.064 str: 0.000 loss: -169.779]Iterations:  63%|██████▎   | 19/30 [00:12<00:05,  2.01it/s, atk: -159.715 ent: -10.064 str: 0.000 loss: -169.779]Iterations:  63%|██████▎   | 19/30 [00:12<00:05,  2.01it/s, atk: -164.975 ent: -10.066 str: 0.000 loss: -175.041]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.99it/s, atk: -164.975 ent: -10.066 str: 0.000 loss: -175.041]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.99it/s, atk: -169.648 ent: -10.067 str: 0.000 loss: -179.715]Iterations:  70%|███████   | 21/30 [00:13<00:04,  2.01it/s, atk: -169.648 ent: -10.067 str: 0.000 loss: -179.715]Iterations:  70%|███████   | 21/30 [00:13<00:04,  2.01it/s, atk: -175.884 ent: -10.067 str: 0.000 loss: -185.951]Iterations:  73%|███████▎  | 22/30 [00:14<00:03,  2.01it/s, atk: -175.884 ent: -10.067 str: 0.000 loss: -185.951]Iterations:  73%|███████▎  | 22/30 [00:14<00:03,  2.01it/s, atk: -182.064 ent: -10.066 str: 0.000 loss: -192.130]Iterations:  77%|███████▋  | 23/30 [00:14<00:03,  2.03it/s, atk: -182.064 ent: -10.066 str: 0.000 loss: -192.130]Iterations:  77%|███████▋  | 23/30 [00:14<00:03,  2.03it/s, atk: -186.836 ent: -10.066 str: 0.000 loss: -196.902]Iterations:  80%|████████  | 24/30 [00:15<00:02,  2.04it/s, atk: -186.836 ent: -10.066 str: 0.000 loss: -196.902]Iterations:  80%|████████  | 24/30 [00:15<00:02,  2.04it/s, atk: -191.687 ent: -10.067 str: 0.000 loss: -201.754]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  2.04it/s, atk: -191.687 ent: -10.067 str: 0.000 loss: -201.754]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  2.04it/s, atk: -197.006 ent: -10.067 str: 0.000 loss: -207.073]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  2.00it/s, atk: -197.006 ent: -10.067 str: 0.000 loss: -207.073]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  2.00it/s, atk: -202.829 ent: -10.066 str: 0.000 loss: -212.895]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  2.01it/s, atk: -202.829 ent: -10.066 str: 0.000 loss: -212.895]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  2.01it/s, atk: -209.057 ent: -10.066 str: 0.000 loss: -219.123]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.99it/s, atk: -209.057 ent: -10.066 str: 0.000 loss: -219.123]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.99it/s, atk: -214.686 ent: -10.064 str: 0.000 loss: -224.750]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  2.01it/s, atk: -214.686 ent: -10.064 str: 0.000 loss: -224.750]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  2.01it/s, atk: -219.827 ent: -10.063 str: 0.000 loss: -229.890]Iterations: 100%|██████████| 30/30 [00:18<00:00,  2.02it/s, atk: -219.827 ent: -10.063 str: 0.000 loss: -229.890]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.66it/s, atk: -219.827 ent: -10.063 str: 0.000 loss: -229.890]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([989], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([326], device='cuda:0') tensor(1.9729e-10, device='cuda:0')
L1: [3307.4707]	L2: [23.295618]	Linf: [0.79607844]

Accuracy on benign examples: 100.0%
gt_label: 579 pred_label: 579 pred_clean_logit 0.995306670665741
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.86it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.50it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 23.47it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 23.96it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.99it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.64it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.77it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.05it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:03,  1.00s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.12s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.15s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6647
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.026 ent: -5.067 str: 0.000 loss: -5.093]Iterations:   3%|▎         | 1/30 [00:00<00:17,  1.61it/s, atk: -0.026 ent: -5.067 str: 0.000 loss: -5.093]Iterations:   3%|▎         | 1/30 [00:00<00:17,  1.61it/s, atk: -0.075 ent: -5.097 str: 0.000 loss: -5.172]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.80it/s, atk: -0.075 ent: -5.097 str: 0.000 loss: -5.172]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.80it/s, atk: -0.695 ent: -5.104 str: 0.000 loss: -5.800]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.88it/s, atk: -0.695 ent: -5.104 str: 0.000 loss: -5.800]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.88it/s, atk: -3.731 ent: -5.109 str: 0.000 loss: -8.841]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.84it/s, atk: -3.731 ent: -5.109 str: 0.000 loss: -8.841]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.84it/s, atk: -10.799 ent: -5.104 str: 0.000 loss: -15.903]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.90it/s, atk: -10.799 ent: -5.104 str: 0.000 loss: -15.903]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.90it/s, atk: -16.146 ent: -5.094 str: 0.000 loss: -21.240]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -16.146 ent: -5.094 str: 0.000 loss: -21.240]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -22.832 ent: -5.089 str: 0.000 loss: -27.921]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -22.832 ent: -5.089 str: 0.000 loss: -27.921]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.93it/s, atk: -28.148 ent: -5.089 str: 0.000 loss: -33.237]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -28.148 ent: -5.089 str: 0.000 loss: -33.237]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -32.967 ent: -5.079 str: 0.000 loss: -38.046]Iterations:  30%|███       | 9/30 [00:04<00:11,  1.90it/s, atk: -32.967 ent: -5.079 str: 0.000 loss: -38.046]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -36.707 ent: -5.071 str: 0.000 loss: -41.779]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.91it/s, atk: -36.707 ent: -5.071 str: 0.000 loss: -41.779]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.91it/s, atk: -40.898 ent: -5.065 str: 0.000 loss: -45.963]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -40.898 ent: -5.065 str: 0.000 loss: -45.963]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.92it/s, atk: -44.311 ent: -5.063 str: 0.000 loss: -49.374]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.85it/s, atk: -44.311 ent: -5.063 str: 0.000 loss: -49.374]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.85it/s, atk: -48.197 ent: -5.064 str: 0.000 loss: -53.261]Iterations:  43%|████▎     | 13/30 [00:06<00:09,  1.88it/s, atk: -48.197 ent: -5.064 str: 0.000 loss: -53.261]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.88it/s, atk: -50.748 ent: -5.065 str: 0.000 loss: -55.813]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.92it/s, atk: -50.748 ent: -5.065 str: 0.000 loss: -55.813]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.92it/s, atk: -53.013 ent: -5.064 str: 0.000 loss: -58.078]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.96it/s, atk: -53.013 ent: -5.064 str: 0.000 loss: -58.078]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -54.893 ent: -5.067 str: 0.000 loss: -59.960]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.97it/s, atk: -54.893 ent: -5.067 str: 0.000 loss: -59.960]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.97it/s, atk: -58.404 ent: -5.070 str: 0.000 loss: -63.473]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.01it/s, atk: -58.404 ent: -5.070 str: 0.000 loss: -63.473]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.01it/s, atk: -60.758 ent: -5.073 str: 0.000 loss: -65.831]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.02it/s, atk: -60.758 ent: -5.073 str: 0.000 loss: -65.831]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.02it/s, atk: -62.745 ent: -5.074 str: 0.000 loss: -67.820]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.03it/s, atk: -62.745 ent: -5.074 str: 0.000 loss: -67.820]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.03it/s, atk: -65.043 ent: -5.073 str: 0.000 loss: -70.116]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.04it/s, atk: -65.043 ent: -5.073 str: 0.000 loss: -70.116]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.04it/s, atk: -67.573 ent: -5.071 str: 0.000 loss: -72.645]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.00it/s, atk: -67.573 ent: -5.071 str: 0.000 loss: -72.645]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.00it/s, atk: -69.344 ent: -5.073 str: 0.000 loss: -74.417]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.01it/s, atk: -69.344 ent: -5.073 str: 0.000 loss: -74.417]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.01it/s, atk: -71.114 ent: -5.073 str: 0.000 loss: -76.188]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.99it/s, atk: -71.114 ent: -5.073 str: 0.000 loss: -76.188]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.99it/s, atk: -72.614 ent: -5.073 str: 0.000 loss: -77.688]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.01it/s, atk: -72.614 ent: -5.073 str: 0.000 loss: -77.688]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.01it/s, atk: -73.971 ent: -5.074 str: 0.000 loss: -79.045]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.02it/s, atk: -73.971 ent: -5.074 str: 0.000 loss: -79.045]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.02it/s, atk: -76.030 ent: -5.074 str: 0.000 loss: -81.103]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.02it/s, atk: -76.030 ent: -5.074 str: 0.000 loss: -81.103]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.02it/s, atk: -77.457 ent: -5.073 str: 0.000 loss: -82.530]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  2.03it/s, atk: -77.457 ent: -5.073 str: 0.000 loss: -82.530]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.03it/s, atk: -78.543 ent: -5.075 str: 0.000 loss: -83.618]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.03it/s, atk: -78.543 ent: -5.075 str: 0.000 loss: -83.618]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.03it/s, atk: -78.177 ent: -5.077 str: 0.000 loss: -83.254]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  2.03it/s, atk: -78.177 ent: -5.077 str: 0.000 loss: -83.254]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.03it/s, atk: -80.182 ent: -5.080 str: 0.000 loss: -85.262]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.02it/s, atk: -80.182 ent: -5.080 str: 0.000 loss: -85.262]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.96it/s, atk: -80.182 ent: -5.080 str: 0.000 loss: -85.262]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([532], device='cuda:0') tensor(0.3043, device='cuda:0')
after_true: tensor([579], device='cuda:0') tensor(0.0003, device='cuda:0')
L1: [1549.1255]	L2: [13.063623]	Linf: [0.7372549]

Accuracy on benign examples: 100.0%
gt_label: 974 pred_label: 974 pred_clean_logit 0.9437032341957092
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.54it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 24.01it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 25.10it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 25.63it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.71it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 24.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.91it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.11it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.01it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.21s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.42s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.29s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5214
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.763 ent: -4.726 str: 0.000 loss: -6.489]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -1.763 ent: -4.726 str: 0.000 loss: -6.489]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -2.974 ent: -4.710 str: 0.000 loss: -7.684]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -2.974 ent: -4.710 str: 0.000 loss: -7.684]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -9.666 ent: -4.713 str: 0.000 loss: -14.379]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -9.666 ent: -4.713 str: 0.000 loss: -14.379]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -17.225 ent: -4.706 str: 0.000 loss: -21.930]Iterations:  13%|█▎        | 4/30 [00:04<00:27,  1.07s/it, atk: -17.225 ent: -4.706 str: 0.000 loss: -21.930]Iterations:  13%|█▎        | 4/30 [00:04<00:27,  1.07s/it, atk: -25.708 ent: -4.701 str: 0.000 loss: -30.409]Iterations:  17%|█▋        | 5/30 [00:05<00:26,  1.07s/it, atk: -25.708 ent: -4.701 str: 0.000 loss: -30.409]Iterations:  17%|█▋        | 5/30 [00:05<00:26,  1.07s/it, atk: -32.256 ent: -4.697 str: 0.000 loss: -36.952]Iterations:  20%|██        | 6/30 [00:06<00:25,  1.07s/it, atk: -32.256 ent: -4.697 str: 0.000 loss: -36.952]Iterations:  20%|██        | 6/30 [00:06<00:25,  1.07s/it, atk: -36.525 ent: -4.693 str: 0.000 loss: -41.218]Iterations:  23%|██▎       | 7/30 [00:07<00:24,  1.07s/it, atk: -36.525 ent: -4.693 str: 0.000 loss: -41.218]Iterations:  23%|██▎       | 7/30 [00:08<00:24,  1.07s/it, atk: -43.957 ent: -4.696 str: 0.000 loss: -48.653]Iterations:  27%|██▋       | 8/30 [00:08<00:23,  1.07s/it, atk: -43.957 ent: -4.696 str: 0.000 loss: -48.653]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.07s/it, atk: -54.109 ent: -4.699 str: 0.000 loss: -58.807]Iterations:  30%|███       | 9/30 [00:09<00:22,  1.07s/it, atk: -54.109 ent: -4.699 str: 0.000 loss: -58.807]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.07s/it, atk: -65.039 ent: -4.700 str: 0.000 loss: -69.739]Iterations:  33%|███▎      | 10/30 [00:10<00:21,  1.07s/it, atk: -65.039 ent: -4.700 str: 0.000 loss: -69.739]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.07s/it, atk: -72.495 ent: -4.702 str: 0.000 loss: -77.197]Iterations:  37%|███▋      | 11/30 [00:11<00:20,  1.07s/it, atk: -72.495 ent: -4.702 str: 0.000 loss: -77.197]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -84.337 ent: -4.703 str: 0.000 loss: -89.040]Iterations:  40%|████      | 12/30 [00:12<00:19,  1.07s/it, atk: -84.337 ent: -4.703 str: 0.000 loss: -89.040]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -96.240 ent: -4.704 str: 0.000 loss: -100.945]Iterations:  43%|████▎     | 13/30 [00:13<00:18,  1.07s/it, atk: -96.240 ent: -4.704 str: 0.000 loss: -100.945]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.07s/it, atk: -102.205 ent: -4.704 str: 0.000 loss: -106.909]Iterations:  47%|████▋     | 14/30 [00:14<00:17,  1.07s/it, atk: -102.205 ent: -4.704 str: 0.000 loss: -106.909]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.07s/it, atk: -91.641 ent: -4.705 str: 0.000 loss: -96.346]  Iterations:  50%|█████     | 15/30 [00:16<00:16,  1.07s/it, atk: -91.641 ent: -4.705 str: 0.000 loss: -96.346]Iterations:  50%|█████     | 15/30 [00:16<00:16,  1.07s/it, atk: -113.703 ent: -4.703 str: 0.000 loss: -118.406]Iterations:  53%|█████▎    | 16/30 [00:17<00:15,  1.07s/it, atk: -113.703 ent: -4.703 str: 0.000 loss: -118.406]Iterations:  53%|█████▎    | 16/30 [00:17<00:15,  1.07s/it, atk: -119.757 ent: -4.701 str: 0.000 loss: -124.458]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.07s/it, atk: -119.757 ent: -4.701 str: 0.000 loss: -124.458]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.07s/it, atk: -128.999 ent: -4.701 str: 0.000 loss: -133.700]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.07s/it, atk: -128.999 ent: -4.701 str: 0.000 loss: -133.700]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.07s/it, atk: -125.028 ent: -4.705 str: 0.000 loss: -129.733]Iterations:  63%|██████▎   | 19/30 [00:20<00:11,  1.08s/it, atk: -125.028 ent: -4.705 str: 0.000 loss: -129.733]Iterations:  63%|██████▎   | 19/30 [00:20<00:11,  1.08s/it, atk: -137.328 ent: -4.706 str: 0.000 loss: -142.034]Iterations:  67%|██████▋   | 20/30 [00:21<00:10,  1.08s/it, atk: -137.328 ent: -4.706 str: 0.000 loss: -142.034]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.08s/it, atk: -134.323 ent: -4.703 str: 0.000 loss: -139.026]Iterations:  70%|███████   | 21/30 [00:22<00:09,  1.08s/it, atk: -134.323 ent: -4.703 str: 0.000 loss: -139.026]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.08s/it, atk: -138.815 ent: -4.700 str: 0.000 loss: -143.515]Iterations:  73%|███████▎  | 22/30 [00:23<00:08,  1.07s/it, atk: -138.815 ent: -4.700 str: 0.000 loss: -143.515]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -133.307 ent: -4.699 str: 0.000 loss: -138.006]Iterations:  77%|███████▋  | 23/30 [00:24<00:07,  1.08s/it, atk: -133.307 ent: -4.699 str: 0.000 loss: -138.006]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.08s/it, atk: -138.960 ent: -4.699 str: 0.000 loss: -143.659]Iterations:  80%|████████  | 24/30 [00:25<00:06,  1.07s/it, atk: -138.960 ent: -4.699 str: 0.000 loss: -143.659]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -145.771 ent: -4.697 str: 0.000 loss: -150.469]Iterations:  83%|████████▎ | 25/30 [00:26<00:05,  1.07s/it, atk: -145.771 ent: -4.697 str: 0.000 loss: -150.469]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.07s/it, atk: -154.860 ent: -4.695 str: 0.000 loss: -159.555]Iterations:  87%|████████▋ | 26/30 [00:27<00:04,  1.07s/it, atk: -154.860 ent: -4.695 str: 0.000 loss: -159.555]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.07s/it, atk: -159.842 ent: -4.694 str: 0.000 loss: -164.536]Iterations:  90%|█████████ | 27/30 [00:28<00:03,  1.08s/it, atk: -159.842 ent: -4.694 str: 0.000 loss: -164.536]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.08s/it, atk: -162.499 ent: -4.693 str: 0.000 loss: -167.192]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.08s/it, atk: -162.499 ent: -4.693 str: 0.000 loss: -167.192]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.08s/it, atk: -166.892 ent: -4.691 str: 0.000 loss: -171.583]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.08s/it, atk: -166.892 ent: -4.691 str: 0.000 loss: -171.583]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.08s/it, atk: -170.102 ent: -4.690 str: 0.000 loss: -174.792]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.08s/it, atk: -170.102 ent: -4.690 str: 0.000 loss: -174.792]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.07s/it, atk: -170.102 ent: -4.690 str: 0.000 loss: -174.792]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([913], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([974], device='cuda:0') tensor(2.7249e-08, device='cuda:0')
L1: [2052.8157]	L2: [14.070125]	Linf: [0.53333336]

Accuracy on benign examples: 100.0%
gt_label: 624 pred_label: 624 pred_clean_logit 0.940534770488739
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.44it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.43it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.44it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.81it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.59it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.32it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.30it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.21it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.27it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.51it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.70s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.85s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:04,  2.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.48s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.27s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4882
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.806 ent: -2.616 str: 0.000 loss: -4.422]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.04s/it, atk: -1.806 ent: -2.616 str: 0.000 loss: -4.422]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.04s/it, atk: -5.073 ent: -2.609 str: 0.000 loss: -7.683]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -5.073 ent: -2.609 str: 0.000 loss: -7.683]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -10.361 ent: -2.610 str: 0.000 loss: -12.971]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -10.361 ent: -2.610 str: 0.000 loss: -12.971]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -14.590 ent: -2.608 str: 0.000 loss: -17.198]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.03s/it, atk: -14.590 ent: -2.608 str: 0.000 loss: -17.198]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.03s/it, atk: -19.309 ent: -2.608 str: 0.000 loss: -21.917]Iterations:  17%|█▋        | 5/30 [00:04<00:22,  1.10it/s, atk: -19.309 ent: -2.608 str: 0.000 loss: -21.917]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -22.610 ent: -2.609 str: 0.000 loss: -25.219]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -22.610 ent: -2.609 str: 0.000 loss: -25.219]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -24.826 ent: -2.609 str: 0.000 loss: -27.435]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -24.826 ent: -2.609 str: 0.000 loss: -27.435]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -26.474 ent: -2.609 str: 0.000 loss: -29.083]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -26.474 ent: -2.609 str: 0.000 loss: -29.083]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -28.273 ent: -2.609 str: 0.000 loss: -30.882]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.63it/s, atk: -28.273 ent: -2.609 str: 0.000 loss: -30.882]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.63it/s, atk: -31.277 ent: -2.610 str: 0.000 loss: -33.887]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.70it/s, atk: -31.277 ent: -2.610 str: 0.000 loss: -33.887]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.70it/s, atk: -34.369 ent: -2.610 str: 0.000 loss: -36.979]Iterations:  37%|███▋      | 11/30 [00:08<00:10,  1.74it/s, atk: -34.369 ent: -2.610 str: 0.000 loss: -36.979]Iterations:  37%|███▋      | 11/30 [00:08<00:10,  1.74it/s, atk: -36.493 ent: -2.611 str: 0.000 loss: -39.103]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.79it/s, atk: -36.493 ent: -2.611 str: 0.000 loss: -39.103]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.79it/s, atk: -38.686 ent: -2.611 str: 0.000 loss: -41.297]Iterations:  43%|████▎     | 13/30 [00:09<00:09,  1.81it/s, atk: -38.686 ent: -2.611 str: 0.000 loss: -41.297]Iterations:  43%|████▎     | 13/30 [00:09<00:09,  1.81it/s, atk: -41.306 ent: -2.611 str: 0.000 loss: -43.917]Iterations:  47%|████▋     | 14/30 [00:09<00:08,  1.82it/s, atk: -41.306 ent: -2.611 str: 0.000 loss: -43.917]Iterations:  47%|████▋     | 14/30 [00:09<00:08,  1.82it/s, atk: -43.208 ent: -2.610 str: 0.000 loss: -45.818]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.84it/s, atk: -43.208 ent: -2.610 str: 0.000 loss: -45.818]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.84it/s, atk: -45.783 ent: -2.610 str: 0.000 loss: -48.392]Iterations:  53%|█████▎    | 16/30 [00:10<00:07,  1.81it/s, atk: -45.783 ent: -2.610 str: 0.000 loss: -48.392]Iterations:  53%|█████▎    | 16/30 [00:11<00:07,  1.81it/s, atk: -48.069 ent: -2.609 str: 0.000 loss: -50.678]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.74it/s, atk: -48.069 ent: -2.609 str: 0.000 loss: -50.678]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.74it/s, atk: -49.917 ent: -2.609 str: 0.000 loss: -52.526]Iterations:  60%|██████    | 18/30 [00:11<00:06,  1.75it/s, atk: -49.917 ent: -2.609 str: 0.000 loss: -52.526]Iterations:  60%|██████    | 18/30 [00:12<00:06,  1.75it/s, atk: -51.832 ent: -2.608 str: 0.000 loss: -54.440]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.74it/s, atk: -51.832 ent: -2.608 str: 0.000 loss: -54.440]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.74it/s, atk: -53.574 ent: -2.608 str: 0.000 loss: -56.182]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.72it/s, atk: -53.574 ent: -2.608 str: 0.000 loss: -56.182]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.72it/s, atk: -55.253 ent: -2.608 str: 0.000 loss: -57.861]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.74it/s, atk: -55.253 ent: -2.608 str: 0.000 loss: -57.861]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.74it/s, atk: -57.029 ent: -2.607 str: 0.000 loss: -59.636]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.78it/s, atk: -57.029 ent: -2.607 str: 0.000 loss: -59.636]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.78it/s, atk: -58.593 ent: -2.607 str: 0.000 loss: -61.200]Iterations:  77%|███████▋  | 23/30 [00:14<00:03,  1.83it/s, atk: -58.593 ent: -2.607 str: 0.000 loss: -61.200]Iterations:  77%|███████▋  | 23/30 [00:15<00:03,  1.83it/s, atk: -60.224 ent: -2.606 str: 0.000 loss: -62.830]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.75it/s, atk: -60.224 ent: -2.606 str: 0.000 loss: -62.830]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.75it/s, atk: -61.655 ent: -2.605 str: 0.000 loss: -64.260]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  1.82it/s, atk: -61.655 ent: -2.605 str: 0.000 loss: -64.260]Iterations:  83%|████████▎ | 25/30 [00:16<00:02,  1.82it/s, atk: -62.878 ent: -2.605 str: 0.000 loss: -65.483]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.84it/s, atk: -62.878 ent: -2.605 str: 0.000 loss: -65.483]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.84it/s, atk: -64.439 ent: -2.605 str: 0.000 loss: -67.044]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  1.88it/s, atk: -64.439 ent: -2.605 str: 0.000 loss: -67.044]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.88it/s, atk: -66.079 ent: -2.605 str: 0.000 loss: -68.684]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.85it/s, atk: -66.079 ent: -2.605 str: 0.000 loss: -68.684]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.85it/s, atk: -67.732 ent: -2.605 str: 0.000 loss: -70.337]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  1.89it/s, atk: -67.732 ent: -2.605 str: 0.000 loss: -70.337]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.89it/s, atk: -69.149 ent: -2.605 str: 0.000 loss: -71.753]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.88it/s, atk: -69.149 ent: -2.605 str: 0.000 loss: -71.753]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.62it/s, atk: -69.149 ent: -2.605 str: 0.000 loss: -71.753]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([454], device='cuda:0') tensor(0.9980, device='cuda:0')
after_true: tensor([624], device='cuda:0') tensor(0.0008, device='cuda:0')
L1: [3206.047]	L2: [23.117588]	Linf: [0.8901961]

Accuracy on benign examples: 100.0%
gt_label: 17 pred_label: 17 pred_clean_logit 0.9593225717544556
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 22.52it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 24.69it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 22.29it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.13it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 22.42it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.82it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 22.80it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.32s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.20s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.27s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.31s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.40s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.34s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2112
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.195 ent: -2.689 str: 0.000 loss: -3.884]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.06s/it, atk: -1.195 ent: -2.689 str: 0.000 loss: -3.884]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.06s/it, atk: -3.882 ent: -2.700 str: 0.000 loss: -6.582]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.36it/s, atk: -3.882 ent: -2.700 str: 0.000 loss: -6.582]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.36it/s, atk: -9.671 ent: -2.713 str: 0.000 loss: -12.385]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.56it/s, atk: -9.671 ent: -2.713 str: 0.000 loss: -12.385]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.56it/s, atk: -13.853 ent: -2.720 str: 0.000 loss: -16.573]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.62it/s, atk: -13.853 ent: -2.720 str: 0.000 loss: -16.573]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.62it/s, atk: -26.037 ent: -2.727 str: 0.000 loss: -28.764]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -26.037 ent: -2.727 str: 0.000 loss: -28.764]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -34.169 ent: -2.722 str: 0.000 loss: -36.891]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.82it/s, atk: -34.169 ent: -2.722 str: 0.000 loss: -36.891]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.82it/s, atk: -43.266 ent: -2.715 str: 0.000 loss: -45.981]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.83it/s, atk: -43.266 ent: -2.715 str: 0.000 loss: -45.981]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.83it/s, atk: -51.121 ent: -2.708 str: 0.000 loss: -53.829]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.90it/s, atk: -51.121 ent: -2.708 str: 0.000 loss: -53.829]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.90it/s, atk: -59.844 ent: -2.705 str: 0.000 loss: -62.550]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.91it/s, atk: -59.844 ent: -2.705 str: 0.000 loss: -62.550]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.91it/s, atk: -66.311 ent: -2.701 str: 0.000 loss: -69.012]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.83it/s, atk: -66.311 ent: -2.701 str: 0.000 loss: -69.012]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.83it/s, atk: -74.687 ent: -2.698 str: 0.000 loss: -77.385]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.88it/s, atk: -74.687 ent: -2.698 str: 0.000 loss: -77.385]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.88it/s, atk: -70.960 ent: -2.702 str: 0.000 loss: -73.662]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.90it/s, atk: -70.960 ent: -2.702 str: 0.000 loss: -73.662]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.90it/s, atk: -77.587 ent: -2.701 str: 0.000 loss: -80.289]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -77.587 ent: -2.701 str: 0.000 loss: -80.289]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -82.680 ent: -2.701 str: 0.000 loss: -85.381]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.94it/s, atk: -82.680 ent: -2.701 str: 0.000 loss: -85.381]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.94it/s, atk: -89.410 ent: -2.701 str: 0.000 loss: -92.111]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -89.410 ent: -2.701 str: 0.000 loss: -92.111]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -95.318 ent: -2.700 str: 0.000 loss: -98.017]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.98it/s, atk: -95.318 ent: -2.700 str: 0.000 loss: -98.017]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.98it/s, atk: -101.696 ent: -2.699 str: 0.000 loss: -104.395]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -101.696 ent: -2.699 str: 0.000 loss: -104.395]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -105.895 ent: -2.704 str: 0.000 loss: -108.598]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.95it/s, atk: -105.895 ent: -2.704 str: 0.000 loss: -108.598]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.95it/s, atk: -113.072 ent: -2.695 str: 0.000 loss: -115.767]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -113.072 ent: -2.695 str: 0.000 loss: -115.767]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -120.095 ent: -2.693 str: 0.000 loss: -122.788]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -120.095 ent: -2.693 str: 0.000 loss: -122.788]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.95it/s, atk: -126.625 ent: -2.691 str: 0.000 loss: -129.316]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.83it/s, atk: -126.625 ent: -2.691 str: 0.000 loss: -129.316]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.83it/s, atk: -133.531 ent: -2.688 str: 0.000 loss: -136.219]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.86it/s, atk: -133.531 ent: -2.688 str: 0.000 loss: -136.219]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.86it/s, atk: -138.647 ent: -2.685 str: 0.000 loss: -141.332]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.79it/s, atk: -138.647 ent: -2.685 str: 0.000 loss: -141.332]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.79it/s, atk: -144.168 ent: -2.685 str: 0.000 loss: -146.853]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.81it/s, atk: -144.168 ent: -2.685 str: 0.000 loss: -146.853]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.81it/s, atk: -148.143 ent: -2.693 str: 0.000 loss: -150.835]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.86it/s, atk: -148.143 ent: -2.693 str: 0.000 loss: -150.835]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.86it/s, atk: -150.175 ent: -2.703 str: 0.000 loss: -152.877]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.92it/s, atk: -150.175 ent: -2.703 str: 0.000 loss: -152.877]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.92it/s, atk: -152.668 ent: -2.705 str: 0.000 loss: -155.373]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.91it/s, atk: -152.668 ent: -2.705 str: 0.000 loss: -155.373]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.91it/s, atk: -158.539 ent: -2.704 str: 0.000 loss: -161.243]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.93it/s, atk: -158.539 ent: -2.704 str: 0.000 loss: -161.243]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.93it/s, atk: -165.102 ent: -2.701 str: 0.000 loss: -167.803]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -165.102 ent: -2.701 str: 0.000 loss: -167.803]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.94it/s, atk: -168.023 ent: -2.697 str: 0.000 loss: -170.720]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.96it/s, atk: -168.023 ent: -2.697 str: 0.000 loss: -170.720]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -168.023 ent: -2.697 str: 0.000 loss: -170.720]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([839], device='cuda:0') tensor(0.9802, device='cuda:0')
after_true: tensor([17], device='cuda:0') tensor(2.8207e-08, device='cuda:0')
L1: [2622.063]	L2: [23.617605]	Linf: [0.9372549]

Accuracy on benign examples: 0.0%
gt_label: 663 pred_label: 698 pred_clean_logit 0.2333168238401413
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.12it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 21.94it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 24.16it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 25.14it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 24.94it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.00it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.19it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.12it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.00it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.07s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.09s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4619
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -15.696 ent: -2.607 str: 0.000 loss: -18.303]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.46s/it, atk: -15.696 ent: -2.607 str: 0.000 loss: -18.303]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.46s/it, atk: -21.858 ent: -2.610 str: 0.000 loss: -24.468]Iterations:   7%|▋         | 2/30 [00:01<00:24,  1.13it/s, atk: -21.858 ent: -2.610 str: 0.000 loss: -24.468]Iterations:   7%|▋         | 2/30 [00:02<00:24,  1.13it/s, atk: -26.783 ent: -2.608 str: 0.000 loss: -29.391]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.41it/s, atk: -26.783 ent: -2.608 str: 0.000 loss: -29.391]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.41it/s, atk: -26.851 ent: -2.593 str: 0.000 loss: -29.444]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.61it/s, atk: -26.851 ent: -2.593 str: 0.000 loss: -29.444]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.61it/s, atk: -30.557 ent: -2.589 str: 0.000 loss: -33.146]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -30.557 ent: -2.589 str: 0.000 loss: -33.146]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -35.377 ent: -2.580 str: 0.000 loss: -37.957]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.84it/s, atk: -35.377 ent: -2.580 str: 0.000 loss: -37.957]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.84it/s, atk: -40.051 ent: -2.584 str: 0.000 loss: -42.635]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.90it/s, atk: -40.051 ent: -2.584 str: 0.000 loss: -42.635]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.90it/s, atk: -45.209 ent: -2.584 str: 0.000 loss: -47.793]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -45.209 ent: -2.584 str: 0.000 loss: -47.793]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.94it/s, atk: -50.793 ent: -2.578 str: 0.000 loss: -53.371]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -50.793 ent: -2.578 str: 0.000 loss: -53.371]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -54.233 ent: -2.574 str: 0.000 loss: -56.807]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.98it/s, atk: -54.233 ent: -2.574 str: 0.000 loss: -56.807]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.98it/s, atk: -57.217 ent: -2.581 str: 0.000 loss: -59.797]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -57.217 ent: -2.581 str: 0.000 loss: -59.797]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -58.649 ent: -2.582 str: 0.000 loss: -61.231]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.01it/s, atk: -58.649 ent: -2.582 str: 0.000 loss: -61.231]Iterations:  40%|████      | 12/30 [00:07<00:08,  2.01it/s, atk: -63.470 ent: -2.580 str: 0.000 loss: -66.050]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.01it/s, atk: -63.470 ent: -2.580 str: 0.000 loss: -66.050]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.01it/s, atk: -68.124 ent: -2.578 str: 0.000 loss: -70.702]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.02it/s, atk: -68.124 ent: -2.578 str: 0.000 loss: -70.702]Iterations:  47%|████▋     | 14/30 [00:08<00:07,  2.02it/s, atk: -71.472 ent: -2.577 str: 0.000 loss: -74.048]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.02it/s, atk: -71.472 ent: -2.577 str: 0.000 loss: -74.048]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.02it/s, atk: -75.008 ent: -2.577 str: 0.000 loss: -77.586]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.03it/s, atk: -75.008 ent: -2.577 str: 0.000 loss: -77.586]Iterations:  53%|█████▎    | 16/30 [00:09<00:06,  2.03it/s, atk: -80.965 ent: -2.577 str: 0.000 loss: -83.542]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.03it/s, atk: -80.965 ent: -2.577 str: 0.000 loss: -83.542]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.03it/s, atk: -86.673 ent: -2.577 str: 0.000 loss: -89.250]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.03it/s, atk: -86.673 ent: -2.577 str: 0.000 loss: -89.250]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.03it/s, atk: -90.929 ent: -2.576 str: 0.000 loss: -93.505]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.02it/s, atk: -90.929 ent: -2.576 str: 0.000 loss: -93.505]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.02it/s, atk: -94.998 ent: -2.576 str: 0.000 loss: -97.574]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.03it/s, atk: -94.998 ent: -2.576 str: 0.000 loss: -97.574]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.03it/s, atk: -99.683 ent: -2.576 str: 0.000 loss: -102.258]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.03it/s, atk: -99.683 ent: -2.576 str: 0.000 loss: -102.258]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.03it/s, atk: -103.384 ent: -2.576 str: 0.000 loss: -105.960]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.03it/s, atk: -103.384 ent: -2.576 str: 0.000 loss: -105.960]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.03it/s, atk: -107.279 ent: -2.576 str: 0.000 loss: -109.855]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.03it/s, atk: -107.279 ent: -2.576 str: 0.000 loss: -109.855]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.03it/s, atk: -112.319 ent: -2.576 str: 0.000 loss: -114.895]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.03it/s, atk: -112.319 ent: -2.576 str: 0.000 loss: -114.895]Iterations:  80%|████████  | 24/30 [00:13<00:02,  2.03it/s, atk: -115.176 ent: -2.577 str: 0.000 loss: -117.753]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.04it/s, atk: -115.176 ent: -2.577 str: 0.000 loss: -117.753]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.04it/s, atk: -119.992 ent: -2.576 str: 0.000 loss: -122.568]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.04it/s, atk: -119.992 ent: -2.576 str: 0.000 loss: -122.568]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.04it/s, atk: -124.169 ent: -2.576 str: 0.000 loss: -126.745]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.03it/s, atk: -124.169 ent: -2.576 str: 0.000 loss: -126.745]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.03it/s, atk: -127.771 ent: -2.577 str: 0.000 loss: -130.348]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.04it/s, atk: -127.771 ent: -2.577 str: 0.000 loss: -130.348]Iterations:  93%|█████████▎| 28/30 [00:15<00:00,  2.04it/s, atk: -131.232 ent: -2.575 str: 0.000 loss: -133.807]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -131.232 ent: -2.575 str: 0.000 loss: -133.807]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -134.311 ent: -2.574 str: 0.000 loss: -136.885]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.99it/s, atk: -134.311 ent: -2.574 str: 0.000 loss: -136.885]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -134.311 ent: -2.574 str: 0.000 loss: -136.885]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([873], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([663], device='cuda:0') tensor(9.5430e-07, device='cuda:0')
L1: [2110.8706]	L2: [13.783911]	Linf: [0.8235294]

Accuracy on benign examples: 100.0%
gt_label: 967 pred_label: 967 pred_clean_logit 0.9904599189758301
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 23.15it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.27it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.14it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.11it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.36it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 22.60it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.78it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.12it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.09it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.02it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.12s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.22s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.13s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4934
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.055 ent: -2.604 str: 0.000 loss: -2.658]Iterations:   3%|▎         | 1/30 [00:00<00:24,  1.16it/s, atk: -0.055 ent: -2.604 str: 0.000 loss: -2.658]Iterations:   3%|▎         | 1/30 [00:01<00:24,  1.16it/s, atk: -0.180 ent: -2.612 str: 0.000 loss: -2.792]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.42it/s, atk: -0.180 ent: -2.612 str: 0.000 loss: -2.792]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.42it/s, atk: -0.289 ent: -2.616 str: 0.000 loss: -2.906]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.65it/s, atk: -0.289 ent: -2.616 str: 0.000 loss: -2.906]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.65it/s, atk: -0.571 ent: -2.616 str: 0.000 loss: -3.187]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -0.571 ent: -2.616 str: 0.000 loss: -3.187]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -1.142 ent: -2.617 str: 0.000 loss: -3.759]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.87it/s, atk: -1.142 ent: -2.617 str: 0.000 loss: -3.759]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.87it/s, atk: -2.187 ent: -2.620 str: 0.000 loss: -4.807]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.91it/s, atk: -2.187 ent: -2.620 str: 0.000 loss: -4.807]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.91it/s, atk: -3.554 ent: -2.615 str: 0.000 loss: -6.169]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.92it/s, atk: -3.554 ent: -2.615 str: 0.000 loss: -6.169]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.92it/s, atk: -6.782 ent: -2.615 str: 0.000 loss: -9.397]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.89it/s, atk: -6.782 ent: -2.615 str: 0.000 loss: -9.397]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.89it/s, atk: -10.895 ent: -2.615 str: 0.000 loss: -13.510]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.93it/s, atk: -10.895 ent: -2.615 str: 0.000 loss: -13.510]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -15.871 ent: -2.614 str: 0.000 loss: -18.486]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.92it/s, atk: -15.871 ent: -2.614 str: 0.000 loss: -18.486]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.92it/s, atk: -21.803 ent: -2.614 str: 0.000 loss: -24.417]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -21.803 ent: -2.614 str: 0.000 loss: -24.417]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -28.078 ent: -2.615 str: 0.000 loss: -30.693]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -28.078 ent: -2.615 str: 0.000 loss: -30.693]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -38.197 ent: -2.614 str: 0.000 loss: -40.810]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.98it/s, atk: -38.197 ent: -2.614 str: 0.000 loss: -40.810]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.98it/s, atk: -47.582 ent: -2.612 str: 0.000 loss: -50.194]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.99it/s, atk: -47.582 ent: -2.612 str: 0.000 loss: -50.194]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.99it/s, atk: -56.146 ent: -2.612 str: 0.000 loss: -58.758]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.99it/s, atk: -56.146 ent: -2.612 str: 0.000 loss: -58.758]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.99it/s, atk: -64.382 ent: -2.613 str: 0.000 loss: -66.995]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -64.382 ent: -2.613 str: 0.000 loss: -66.995]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -70.788 ent: -2.612 str: 0.000 loss: -73.401]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.02it/s, atk: -70.788 ent: -2.612 str: 0.000 loss: -73.401]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.02it/s, atk: -76.342 ent: -2.611 str: 0.000 loss: -78.953]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.00it/s, atk: -76.342 ent: -2.611 str: 0.000 loss: -78.953]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.00it/s, atk: -83.485 ent: -2.610 str: 0.000 loss: -86.096]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -83.485 ent: -2.610 str: 0.000 loss: -86.096]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -90.917 ent: -2.610 str: 0.000 loss: -93.527]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -90.917 ent: -2.610 str: 0.000 loss: -93.527]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -99.094 ent: -2.609 str: 0.000 loss: -101.703]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -99.094 ent: -2.609 str: 0.000 loss: -101.703]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -105.765 ent: -2.609 str: 0.000 loss: -108.373]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -105.765 ent: -2.609 str: 0.000 loss: -108.373]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -113.001 ent: -2.610 str: 0.000 loss: -115.610]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.90it/s, atk: -113.001 ent: -2.610 str: 0.000 loss: -115.610]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.90it/s, atk: -119.538 ent: -2.610 str: 0.000 loss: -122.148]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.87it/s, atk: -119.538 ent: -2.610 str: 0.000 loss: -122.148]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.87it/s, atk: -127.182 ent: -2.610 str: 0.000 loss: -129.793]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -127.182 ent: -2.610 str: 0.000 loss: -129.793]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -133.374 ent: -2.611 str: 0.000 loss: -135.986]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.89it/s, atk: -133.374 ent: -2.611 str: 0.000 loss: -135.986]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.89it/s, atk: -139.124 ent: -2.612 str: 0.000 loss: -141.736]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.53it/s, atk: -139.124 ent: -2.612 str: 0.000 loss: -141.736]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.53it/s, atk: -143.926 ent: -2.613 str: 0.000 loss: -146.539]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.45it/s, atk: -143.926 ent: -2.613 str: 0.000 loss: -146.539]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.45it/s, atk: -149.459 ent: -2.613 str: 0.000 loss: -152.072]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.59it/s, atk: -149.459 ent: -2.613 str: 0.000 loss: -152.072]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.59it/s, atk: -155.268 ent: -2.612 str: 0.000 loss: -157.879]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.65it/s, atk: -155.268 ent: -2.612 str: 0.000 loss: -157.879]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.82it/s, atk: -155.268 ent: -2.612 str: 0.000 loss: -157.879]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([849], device='cuda:0') tensor(0.9990, device='cuda:0')
after_true: tensor([967], device='cuda:0') tensor(1.1264e-07, device='cuda:0')
L1: [1438.8942]	L2: [10.272693]	Linf: [0.6745098]

Accuracy on benign examples: 100.0%
gt_label: 425 pred_label: 425 pred_clean_logit 0.9987727999687195
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 23.86it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.18it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.56it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.60it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.11it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.41it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.02it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.01s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.11s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.20s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4274
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.053 ent: -2.760 str: 0.000 loss: -2.814]Iterations:   3%|▎         | 1/30 [00:00<00:21,  1.33it/s, atk: -0.053 ent: -2.760 str: 0.000 loss: -2.814]Iterations:   3%|▎         | 1/30 [00:01<00:21,  1.33it/s, atk: -0.126 ent: -2.762 str: 0.000 loss: -2.888]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.67it/s, atk: -0.126 ent: -2.762 str: 0.000 loss: -2.888]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.67it/s, atk: -0.415 ent: -2.765 str: 0.000 loss: -3.180]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.80it/s, atk: -0.415 ent: -2.765 str: 0.000 loss: -3.180]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.80it/s, atk: -0.820 ent: -2.766 str: 0.000 loss: -3.586]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.89it/s, atk: -0.820 ent: -2.766 str: 0.000 loss: -3.586]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.89it/s, atk: -1.979 ent: -2.762 str: 0.000 loss: -4.741]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.92it/s, atk: -1.979 ent: -2.762 str: 0.000 loss: -4.741]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.92it/s, atk: -2.831 ent: -2.763 str: 0.000 loss: -5.593]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.95it/s, atk: -2.831 ent: -2.763 str: 0.000 loss: -5.593]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.95it/s, atk: -4.351 ent: -2.765 str: 0.000 loss: -7.116]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.89it/s, atk: -4.351 ent: -2.765 str: 0.000 loss: -7.116]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.89it/s, atk: -3.504 ent: -2.759 str: 0.000 loss: -6.263]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -3.504 ent: -2.759 str: 0.000 loss: -6.263]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -5.293 ent: -2.754 str: 0.000 loss: -8.047]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.96it/s, atk: -5.293 ent: -2.754 str: 0.000 loss: -8.047]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.96it/s, atk: -8.972 ent: -2.752 str: 0.000 loss: -11.724]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.94it/s, atk: -8.972 ent: -2.752 str: 0.000 loss: -11.724]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.94it/s, atk: -12.713 ent: -2.750 str: 0.000 loss: -15.462]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.98it/s, atk: -12.713 ent: -2.750 str: 0.000 loss: -15.462]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.98it/s, atk: -16.996 ent: -2.748 str: 0.000 loss: -19.744]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.98it/s, atk: -16.996 ent: -2.748 str: 0.000 loss: -19.744]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.98it/s, atk: -21.153 ent: -2.746 str: 0.000 loss: -23.899]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.97it/s, atk: -21.153 ent: -2.746 str: 0.000 loss: -23.899]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -25.027 ent: -2.746 str: 0.000 loss: -27.772]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -25.027 ent: -2.746 str: 0.000 loss: -27.772]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -29.343 ent: -2.745 str: 0.000 loss: -32.088]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.97it/s, atk: -29.343 ent: -2.745 str: 0.000 loss: -32.088]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -31.870 ent: -2.742 str: 0.000 loss: -34.611]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -31.870 ent: -2.742 str: 0.000 loss: -34.611]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -34.478 ent: -2.743 str: 0.000 loss: -37.221]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.00it/s, atk: -34.478 ent: -2.743 str: 0.000 loss: -37.221]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.00it/s, atk: -37.383 ent: -2.742 str: 0.000 loss: -40.125]Iterations:  60%|██████    | 18/30 [00:09<00:06,  2.00it/s, atk: -37.383 ent: -2.742 str: 0.000 loss: -40.125]Iterations:  60%|██████    | 18/30 [00:09<00:06,  2.00it/s, atk: -39.089 ent: -2.745 str: 0.000 loss: -41.834]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.00it/s, atk: -39.089 ent: -2.745 str: 0.000 loss: -41.834]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -42.052 ent: -2.745 str: 0.000 loss: -44.797]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.01it/s, atk: -42.052 ent: -2.745 str: 0.000 loss: -44.797]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.01it/s, atk: -43.755 ent: -2.741 str: 0.000 loss: -46.497]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.00it/s, atk: -43.755 ent: -2.741 str: 0.000 loss: -46.497]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.00it/s, atk: -45.994 ent: -2.739 str: 0.000 loss: -48.733]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.87it/s, atk: -45.994 ent: -2.739 str: 0.000 loss: -48.733]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.87it/s, atk: -48.702 ent: -2.738 str: 0.000 loss: -51.439]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.85it/s, atk: -48.702 ent: -2.738 str: 0.000 loss: -51.439]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.85it/s, atk: -52.118 ent: -2.737 str: 0.000 loss: -54.854]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.93it/s, atk: -52.118 ent: -2.737 str: 0.000 loss: -54.854]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.93it/s, atk: -55.511 ent: -2.736 str: 0.000 loss: -58.246]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.96it/s, atk: -55.511 ent: -2.736 str: 0.000 loss: -58.246]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.96it/s, atk: -58.870 ent: -2.735 str: 0.000 loss: -61.605]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -58.870 ent: -2.735 str: 0.000 loss: -61.605]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -61.363 ent: -2.735 str: 0.000 loss: -64.098]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.95it/s, atk: -61.363 ent: -2.735 str: 0.000 loss: -64.098]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -66.010 ent: -2.735 str: 0.000 loss: -68.745]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -66.010 ent: -2.735 str: 0.000 loss: -68.745]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -68.756 ent: -2.735 str: 0.000 loss: -71.491]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.87it/s, atk: -68.756 ent: -2.735 str: 0.000 loss: -71.491]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.87it/s, atk: -71.462 ent: -2.736 str: 0.000 loss: -74.198]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -71.462 ent: -2.736 str: 0.000 loss: -74.198]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.93it/s, atk: -71.462 ent: -2.736 str: 0.000 loss: -74.198]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([497], device='cuda:0') tensor(0.9685, device='cuda:0')
after_true: tensor([425], device='cuda:0') tensor(0.0005, device='cuda:0')
L1: [2806.7688]	L2: [18.281773]	Linf: [0.6784314]

Accuracy on benign examples: 100.0%
gt_label: 652 pred_label: 652 pred_clean_logit 0.7001620531082153
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 26.17it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.26it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.32it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.13it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.40it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.94it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.18it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.06it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.05it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.09s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.16s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.26s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.17s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4191
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -3.124 ent: -5.080 str: 0.000 loss: -8.204]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -3.124 ent: -5.080 str: 0.000 loss: -8.204]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -40.803 ent: -5.059 str: 0.000 loss: -45.862]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.28it/s, atk: -40.803 ent: -5.059 str: 0.000 loss: -45.862]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.28it/s, atk: -57.528 ent: -5.046 str: 0.000 loss: -62.574]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.51it/s, atk: -57.528 ent: -5.046 str: 0.000 loss: -62.574]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.51it/s, atk: -71.844 ent: -5.046 str: 0.000 loss: -76.890]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.63it/s, atk: -71.844 ent: -5.046 str: 0.000 loss: -76.890]Iterations:  13%|█▎        | 4/30 [00:03<00:15,  1.63it/s, atk: -81.170 ent: -5.046 str: 0.000 loss: -86.216]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.76it/s, atk: -81.170 ent: -5.046 str: 0.000 loss: -86.216]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.76it/s, atk: -94.664 ent: -5.040 str: 0.000 loss: -99.704]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.82it/s, atk: -94.664 ent: -5.040 str: 0.000 loss: -99.704]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.82it/s, atk: -101.933 ent: -5.036 str: 0.000 loss: -106.969]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.88it/s, atk: -101.933 ent: -5.036 str: 0.000 loss: -106.969]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.88it/s, atk: -109.739 ent: -5.033 str: 0.000 loss: -114.772]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.87it/s, atk: -109.739 ent: -5.033 str: 0.000 loss: -114.772]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.87it/s, atk: -115.972 ent: -5.033 str: 0.000 loss: -121.004]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -115.972 ent: -5.033 str: 0.000 loss: -121.004]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -122.497 ent: -5.033 str: 0.000 loss: -127.530]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -122.497 ent: -5.033 str: 0.000 loss: -127.530]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.95it/s, atk: -129.633 ent: -5.032 str: 0.000 loss: -134.665]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.97it/s, atk: -129.633 ent: -5.032 str: 0.000 loss: -134.665]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.97it/s, atk: -135.244 ent: -5.030 str: 0.000 loss: -140.274]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -135.244 ent: -5.030 str: 0.000 loss: -140.274]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.96it/s, atk: -141.216 ent: -5.028 str: 0.000 loss: -146.244]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -141.216 ent: -5.028 str: 0.000 loss: -146.244]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -147.237 ent: -5.026 str: 0.000 loss: -152.263]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.93it/s, atk: -147.237 ent: -5.026 str: 0.000 loss: -152.263]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.93it/s, atk: -153.972 ent: -5.026 str: 0.000 loss: -158.998]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -153.972 ent: -5.026 str: 0.000 loss: -158.998]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -162.801 ent: -5.026 str: 0.000 loss: -167.827]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.96it/s, atk: -162.801 ent: -5.026 str: 0.000 loss: -167.827]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -171.645 ent: -5.025 str: 0.000 loss: -176.670]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -171.645 ent: -5.025 str: 0.000 loss: -176.670]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -179.336 ent: -5.025 str: 0.000 loss: -184.361]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -179.336 ent: -5.025 str: 0.000 loss: -184.361]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.98it/s, atk: -185.993 ent: -5.026 str: 0.000 loss: -191.020]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -185.993 ent: -5.026 str: 0.000 loss: -191.020]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -194.354 ent: -5.028 str: 0.000 loss: -199.381]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.99it/s, atk: -194.354 ent: -5.028 str: 0.000 loss: -199.381]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.99it/s, atk: -202.704 ent: -5.029 str: 0.000 loss: -207.733]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -202.704 ent: -5.029 str: 0.000 loss: -207.733]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -210.350 ent: -5.030 str: 0.000 loss: -215.380]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.99it/s, atk: -210.350 ent: -5.030 str: 0.000 loss: -215.380]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.99it/s, atk: -219.322 ent: -5.028 str: 0.000 loss: -224.351]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -219.322 ent: -5.028 str: 0.000 loss: -224.351]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -226.638 ent: -5.028 str: 0.000 loss: -231.666]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -226.638 ent: -5.028 str: 0.000 loss: -231.666]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.96it/s, atk: -235.279 ent: -5.027 str: 0.000 loss: -240.305]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -235.279 ent: -5.027 str: 0.000 loss: -240.305]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -241.924 ent: -5.026 str: 0.000 loss: -246.951]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.99it/s, atk: -241.924 ent: -5.026 str: 0.000 loss: -246.951]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.99it/s, atk: -250.613 ent: -5.026 str: 0.000 loss: -255.640]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -250.613 ent: -5.026 str: 0.000 loss: -255.640]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -258.814 ent: -5.026 str: 0.000 loss: -263.840]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.00it/s, atk: -258.814 ent: -5.026 str: 0.000 loss: -263.840]Iterations:  93%|█████████▎| 28/30 [00:15<00:00,  2.00it/s, atk: -265.887 ent: -5.027 str: 0.000 loss: -270.914]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -265.887 ent: -5.027 str: 0.000 loss: -270.914]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -273.100 ent: -5.027 str: 0.000 loss: -278.127]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.99it/s, atk: -273.100 ent: -5.027 str: 0.000 loss: -278.127]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.89it/s, atk: -273.100 ent: -5.027 str: 0.000 loss: -278.127]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([733], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([652], device='cuda:0') tensor(6.8261e-13, device='cuda:0')
L1: [2969.1018]	L2: [22.943918]	Linf: [0.8509804]

Accuracy on benign examples: 0.0%
gt_label: 464 pred_label: 844 pred_clean_logit 0.06738900393247604
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.14it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.96it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 21.81it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 23.45it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.39it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.22it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.66it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.21s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.10s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.11s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.18s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.30s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.23s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4067
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -23.746 ent: -2.673 str: 0.000 loss: -26.419]Iterations:   3%|▎         | 1/30 [00:00<00:22,  1.31it/s, atk: -23.746 ent: -2.673 str: 0.000 loss: -26.419]Iterations:   3%|▎         | 1/30 [00:01<00:22,  1.31it/s, atk: -36.782 ent: -2.670 str: 0.000 loss: -39.452]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.63it/s, atk: -36.782 ent: -2.670 str: 0.000 loss: -39.452]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.63it/s, atk: -49.210 ent: -2.670 str: 0.000 loss: -51.880]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.79it/s, atk: -49.210 ent: -2.670 str: 0.000 loss: -51.880]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.79it/s, atk: -56.935 ent: -2.669 str: 0.000 loss: -59.604]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -56.935 ent: -2.669 str: 0.000 loss: -59.604]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -66.238 ent: -2.669 str: 0.000 loss: -68.906]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.90it/s, atk: -66.238 ent: -2.669 str: 0.000 loss: -68.906]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.90it/s, atk: -73.528 ent: -2.663 str: 0.000 loss: -76.191]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -73.528 ent: -2.663 str: 0.000 loss: -76.191]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -76.378 ent: -2.664 str: 0.000 loss: -79.042]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.90it/s, atk: -76.378 ent: -2.664 str: 0.000 loss: -79.042]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.90it/s, atk: -79.337 ent: -2.666 str: 0.000 loss: -82.003]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -79.337 ent: -2.666 str: 0.000 loss: -82.003]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -86.276 ent: -2.664 str: 0.000 loss: -88.940]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.92it/s, atk: -86.276 ent: -2.664 str: 0.000 loss: -88.940]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.92it/s, atk: -89.808 ent: -2.660 str: 0.000 loss: -92.468]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -89.808 ent: -2.660 str: 0.000 loss: -92.468]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -96.113 ent: -2.664 str: 0.000 loss: -98.777]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.98it/s, atk: -96.113 ent: -2.664 str: 0.000 loss: -98.777]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.98it/s, atk: -98.928 ent: -2.664 str: 0.000 loss: -101.593]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -98.928 ent: -2.664 str: 0.000 loss: -101.593]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -102.381 ent: -2.664 str: 0.000 loss: -105.045]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.97it/s, atk: -102.381 ent: -2.664 str: 0.000 loss: -105.045]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -106.023 ent: -2.664 str: 0.000 loss: -108.687]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -106.023 ent: -2.664 str: 0.000 loss: -108.687]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -109.933 ent: -2.664 str: 0.000 loss: -112.597]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.96it/s, atk: -109.933 ent: -2.664 str: 0.000 loss: -112.597]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -113.835 ent: -2.663 str: 0.000 loss: -116.498]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.95it/s, atk: -113.835 ent: -2.663 str: 0.000 loss: -116.498]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.95it/s, atk: -118.068 ent: -2.662 str: 0.000 loss: -120.730]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.87it/s, atk: -118.068 ent: -2.662 str: 0.000 loss: -120.730]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.87it/s, atk: -121.366 ent: -2.661 str: 0.000 loss: -124.027]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.81it/s, atk: -121.366 ent: -2.661 str: 0.000 loss: -124.027]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.81it/s, atk: -124.468 ent: -2.661 str: 0.000 loss: -127.128]Iterations:  63%|██████▎   | 19/30 [00:10<00:06,  1.82it/s, atk: -124.468 ent: -2.661 str: 0.000 loss: -127.128]Iterations:  63%|██████▎   | 19/30 [00:10<00:06,  1.82it/s, atk: -127.815 ent: -2.661 str: 0.000 loss: -130.476]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.87it/s, atk: -127.815 ent: -2.661 str: 0.000 loss: -130.476]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.87it/s, atk: -130.469 ent: -2.661 str: 0.000 loss: -133.130]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.92it/s, atk: -130.469 ent: -2.661 str: 0.000 loss: -133.130]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.92it/s, atk: -133.114 ent: -2.662 str: 0.000 loss: -135.776]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.93it/s, atk: -133.114 ent: -2.662 str: 0.000 loss: -135.776]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.93it/s, atk: -136.202 ent: -2.662 str: 0.000 loss: -138.864]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.93it/s, atk: -136.202 ent: -2.662 str: 0.000 loss: -138.864]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.93it/s, atk: -138.771 ent: -2.663 str: 0.000 loss: -141.434]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -138.771 ent: -2.663 str: 0.000 loss: -141.434]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -141.240 ent: -2.663 str: 0.000 loss: -143.903]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -141.240 ent: -2.663 str: 0.000 loss: -143.903]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -143.814 ent: -2.663 str: 0.000 loss: -146.477]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.96it/s, atk: -143.814 ent: -2.663 str: 0.000 loss: -146.477]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.96it/s, atk: -146.437 ent: -2.663 str: 0.000 loss: -149.100]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -146.437 ent: -2.663 str: 0.000 loss: -149.100]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -149.230 ent: -2.662 str: 0.000 loss: -151.892]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.95it/s, atk: -149.230 ent: -2.662 str: 0.000 loss: -151.892]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.95it/s, atk: -151.913 ent: -2.662 str: 0.000 loss: -154.575]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -151.913 ent: -2.662 str: 0.000 loss: -154.575]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -154.252 ent: -2.661 str: 0.000 loss: -156.913]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -154.252 ent: -2.661 str: 0.000 loss: -156.913]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.91it/s, atk: -154.252 ent: -2.661 str: 0.000 loss: -156.913]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([844], device='cuda:0') tensor(0.9895, device='cuda:0')
after_true: tensor([464], device='cuda:0') tensor(1.5530e-07, device='cuda:0')
L1: [2024.8629]	L2: [14.037513]	Linf: [0.75686276]

Accuracy on benign examples: 100.0%
gt_label: 809 pred_label: 809 pred_clean_logit 0.9425541162490845
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 25.84it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.89it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.76it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.69it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.09it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.05it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.04it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:03,  1.00s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.04s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.30s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.20s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4963
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.067 ent: -5.282 str: 0.000 loss: -6.349]Iterations:   3%|▎         | 1/30 [00:00<00:21,  1.32it/s, atk: -1.067 ent: -5.282 str: 0.000 loss: -6.349]Iterations:   3%|▎         | 1/30 [00:01<00:21,  1.32it/s, atk: -3.734 ent: -5.262 str: 0.000 loss: -8.996]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.67it/s, atk: -3.734 ent: -5.262 str: 0.000 loss: -8.996]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.67it/s, atk: -11.202 ent: -5.271 str: 0.000 loss: -16.473]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.73it/s, atk: -11.202 ent: -5.271 str: 0.000 loss: -16.473]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.73it/s, atk: -22.692 ent: -5.266 str: 0.000 loss: -27.958]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.83it/s, atk: -22.692 ent: -5.266 str: 0.000 loss: -27.958]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.83it/s, atk: -32.054 ent: -5.261 str: 0.000 loss: -37.314]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.85it/s, atk: -32.054 ent: -5.261 str: 0.000 loss: -37.314]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.85it/s, atk: -39.929 ent: -5.263 str: 0.000 loss: -45.191]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.89it/s, atk: -39.929 ent: -5.263 str: 0.000 loss: -45.191]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.89it/s, atk: -49.631 ent: -5.255 str: 0.000 loss: -54.886]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.91it/s, atk: -49.631 ent: -5.255 str: 0.000 loss: -54.886]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.91it/s, atk: -58.222 ent: -5.246 str: 0.000 loss: -63.468]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -58.222 ent: -5.246 str: 0.000 loss: -63.468]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -66.940 ent: -5.246 str: 0.000 loss: -72.185]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.94it/s, atk: -66.940 ent: -5.246 str: 0.000 loss: -72.185]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -74.213 ent: -5.246 str: 0.000 loss: -79.459]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -74.213 ent: -5.246 str: 0.000 loss: -79.459]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -80.779 ent: -5.241 str: 0.000 loss: -86.021]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.94it/s, atk: -80.779 ent: -5.241 str: 0.000 loss: -86.021]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -87.091 ent: -5.239 str: 0.000 loss: -92.329]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -87.091 ent: -5.239 str: 0.000 loss: -92.329]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -92.331 ent: -5.239 str: 0.000 loss: -97.569]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.94it/s, atk: -92.331 ent: -5.239 str: 0.000 loss: -97.569]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -98.553 ent: -5.233 str: 0.000 loss: -103.786]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -98.553 ent: -5.233 str: 0.000 loss: -103.786]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -103.164 ent: -5.228 str: 0.000 loss: -108.392]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.97it/s, atk: -103.164 ent: -5.228 str: 0.000 loss: -108.392]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -107.259 ent: -5.228 str: 0.000 loss: -112.487]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.98it/s, atk: -107.259 ent: -5.228 str: 0.000 loss: -112.487]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.98it/s, atk: -106.969 ent: -5.229 str: 0.000 loss: -112.198]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.98it/s, atk: -106.969 ent: -5.229 str: 0.000 loss: -112.198]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.98it/s, atk: -114.171 ent: -5.223 str: 0.000 loss: -119.394]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -114.171 ent: -5.223 str: 0.000 loss: -119.394]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -118.758 ent: -5.222 str: 0.000 loss: -123.980]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.93it/s, atk: -118.758 ent: -5.222 str: 0.000 loss: -123.980]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -124.017 ent: -5.224 str: 0.000 loss: -129.241]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -124.017 ent: -5.224 str: 0.000 loss: -129.241]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -127.721 ent: -5.224 str: 0.000 loss: -132.945]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.98it/s, atk: -127.721 ent: -5.224 str: 0.000 loss: -132.945]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -132.204 ent: -5.224 str: 0.000 loss: -137.427]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -132.204 ent: -5.224 str: 0.000 loss: -137.427]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -137.015 ent: -5.223 str: 0.000 loss: -142.238]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.98it/s, atk: -137.015 ent: -5.223 str: 0.000 loss: -142.238]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -141.833 ent: -5.225 str: 0.000 loss: -147.058]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.93it/s, atk: -141.833 ent: -5.225 str: 0.000 loss: -147.058]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.93it/s, atk: -146.021 ent: -5.225 str: 0.000 loss: -151.246]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -146.021 ent: -5.225 str: 0.000 loss: -151.246]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -150.275 ent: -5.223 str: 0.000 loss: -155.498]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -150.275 ent: -5.223 str: 0.000 loss: -155.498]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -154.251 ent: -5.221 str: 0.000 loss: -159.473]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -154.251 ent: -5.221 str: 0.000 loss: -159.473]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -158.520 ent: -5.222 str: 0.000 loss: -163.742]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.96it/s, atk: -158.520 ent: -5.222 str: 0.000 loss: -163.742]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.96it/s, atk: -162.474 ent: -5.222 str: 0.000 loss: -167.696]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -162.474 ent: -5.222 str: 0.000 loss: -167.696]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -166.816 ent: -5.222 str: 0.000 loss: -172.038]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -166.816 ent: -5.222 str: 0.000 loss: -172.038]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.93it/s, atk: -166.816 ent: -5.222 str: 0.000 loss: -172.038]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([666], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([809], device='cuda:0') tensor(3.8302e-08, device='cuda:0')
L1: [1335.2784]	L2: [8.343983]	Linf: [0.3607843]

Accuracy on benign examples: 100.0%
gt_label: 107 pred_label: 107 pred_clean_logit 0.9727927446365356
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.04it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.39it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.17it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.82it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.27it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.52it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.16it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.08it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:03,  1.00s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.12s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.23s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.22s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4867
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.790 ent: -2.709 str: 0.000 loss: -3.499]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.11it/s, atk: -0.790 ent: -2.709 str: 0.000 loss: -3.499]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.11it/s, atk: -4.358 ent: -2.708 str: 0.000 loss: -7.066]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.51it/s, atk: -4.358 ent: -2.708 str: 0.000 loss: -7.066]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.51it/s, atk: -7.470 ent: -2.700 str: 0.000 loss: -10.170]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.66it/s, atk: -7.470 ent: -2.700 str: 0.000 loss: -10.170]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.66it/s, atk: -7.228 ent: -2.695 str: 0.000 loss: -9.923] Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.77it/s, atk: -7.228 ent: -2.695 str: 0.000 loss: -9.923]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.77it/s, atk: -9.730 ent: -2.693 str: 0.000 loss: -12.422]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.71it/s, atk: -9.730 ent: -2.693 str: 0.000 loss: -12.422]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.71it/s, atk: -13.937 ent: -2.692 str: 0.000 loss: -16.629]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.79it/s, atk: -13.937 ent: -2.692 str: 0.000 loss: -16.629]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.79it/s, atk: -18.528 ent: -2.687 str: 0.000 loss: -21.216]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.83it/s, atk: -18.528 ent: -2.687 str: 0.000 loss: -21.216]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.83it/s, atk: -24.263 ent: -2.687 str: 0.000 loss: -26.949]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.88it/s, atk: -24.263 ent: -2.687 str: 0.000 loss: -26.949]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.88it/s, atk: -34.643 ent: -2.683 str: 0.000 loss: -37.326]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -34.643 ent: -2.683 str: 0.000 loss: -37.326]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -38.712 ent: -2.683 str: 0.000 loss: -41.395]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.92it/s, atk: -38.712 ent: -2.683 str: 0.000 loss: -41.395]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.92it/s, atk: -41.955 ent: -2.680 str: 0.000 loss: -44.635]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -41.955 ent: -2.680 str: 0.000 loss: -44.635]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -55.685 ent: -2.682 str: 0.000 loss: -58.368]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.93it/s, atk: -55.685 ent: -2.682 str: 0.000 loss: -58.368]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.93it/s, atk: -64.609 ent: -2.683 str: 0.000 loss: -67.292]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -64.609 ent: -2.683 str: 0.000 loss: -67.292]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -73.853 ent: -2.684 str: 0.000 loss: -76.537]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.92it/s, atk: -73.853 ent: -2.684 str: 0.000 loss: -76.537]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.92it/s, atk: -85.221 ent: -2.682 str: 0.000 loss: -87.903]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.94it/s, atk: -85.221 ent: -2.682 str: 0.000 loss: -87.903]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.94it/s, atk: -88.151 ent: -2.681 str: 0.000 loss: -90.832]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.96it/s, atk: -88.151 ent: -2.681 str: 0.000 loss: -90.832]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.96it/s, atk: -96.947 ent: -2.681 str: 0.000 loss: -99.628]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -96.947 ent: -2.681 str: 0.000 loss: -99.628]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -104.279 ent: -2.684 str: 0.000 loss: -106.963]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -104.279 ent: -2.684 str: 0.000 loss: -106.963]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -115.554 ent: -2.686 str: 0.000 loss: -118.240]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -115.554 ent: -2.686 str: 0.000 loss: -118.240]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -122.269 ent: -2.688 str: 0.000 loss: -124.957]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -122.269 ent: -2.688 str: 0.000 loss: -124.957]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.97it/s, atk: -124.507 ent: -2.684 str: 0.000 loss: -127.191]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -124.507 ent: -2.684 str: 0.000 loss: -127.191]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -125.975 ent: -2.681 str: 0.000 loss: -128.655]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.87it/s, atk: -125.975 ent: -2.681 str: 0.000 loss: -128.655]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.87it/s, atk: -132.348 ent: -2.678 str: 0.000 loss: -135.027]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.91it/s, atk: -132.348 ent: -2.678 str: 0.000 loss: -135.027]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.91it/s, atk: -143.663 ent: -2.678 str: 0.000 loss: -146.341]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.93it/s, atk: -143.663 ent: -2.678 str: 0.000 loss: -146.341]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.93it/s, atk: -154.484 ent: -2.678 str: 0.000 loss: -157.162]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -154.484 ent: -2.678 str: 0.000 loss: -157.162]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -166.307 ent: -2.678 str: 0.000 loss: -168.985]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.84it/s, atk: -166.307 ent: -2.678 str: 0.000 loss: -168.985]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.84it/s, atk: -177.083 ent: -2.678 str: 0.000 loss: -179.761]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.84it/s, atk: -177.083 ent: -2.678 str: 0.000 loss: -179.761]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.84it/s, atk: -184.832 ent: -2.678 str: 0.000 loss: -187.510]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.83it/s, atk: -184.832 ent: -2.678 str: 0.000 loss: -187.510]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.83it/s, atk: -191.897 ent: -2.679 str: 0.000 loss: -194.576]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.83it/s, atk: -191.897 ent: -2.679 str: 0.000 loss: -194.576]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.83it/s, atk: -198.739 ent: -2.679 str: 0.000 loss: -201.418]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -198.739 ent: -2.679 str: 0.000 loss: -201.418]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.86it/s, atk: -198.739 ent: -2.679 str: 0.000 loss: -201.418]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([194], device='cuda:0') tensor(0.9988, device='cuda:0')
after_true: tensor([107], device='cuda:0') tensor(1.0702e-09, device='cuda:0')
L1: [2210.5176]	L2: [15.665394]	Linf: [0.74509805]

Accuracy on benign examples: 100.0%
gt_label: 672 pred_label: 672 pred_clean_logit 0.7955347895622253
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 24.49it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.78it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.28it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.18it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.22it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.92it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.16it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.14it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.02it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.07s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.35s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.22s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5911
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -5.260 ent: -5.112 str: 0.000 loss: -10.372]Iterations:   3%|▎         | 1/30 [00:00<00:21,  1.32it/s, atk: -5.260 ent: -5.112 str: 0.000 loss: -10.372]Iterations:   3%|▎         | 1/30 [00:01<00:21,  1.32it/s, atk: -34.460 ent: -5.109 str: 0.000 loss: -39.570]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.67it/s, atk: -34.460 ent: -5.109 str: 0.000 loss: -39.570]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.67it/s, atk: -58.563 ent: -5.107 str: 0.000 loss: -63.670]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.80it/s, atk: -58.563 ent: -5.107 str: 0.000 loss: -63.670]Iterations:  10%|█         | 3/30 [00:02<00:14,  1.80it/s, atk: -82.104 ent: -5.105 str: 0.000 loss: -87.209]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.86it/s, atk: -82.104 ent: -5.105 str: 0.000 loss: -87.209]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.86it/s, atk: -96.541 ent: -5.100 str: 0.000 loss: -101.641]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.90it/s, atk: -96.541 ent: -5.100 str: 0.000 loss: -101.641]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.90it/s, atk: -104.509 ent: -5.096 str: 0.000 loss: -109.605]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.94it/s, atk: -104.509 ent: -5.096 str: 0.000 loss: -109.605]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.94it/s, atk: -114.045 ent: -5.093 str: 0.000 loss: -119.138]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.87it/s, atk: -114.045 ent: -5.093 str: 0.000 loss: -119.138]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.87it/s, atk: -123.681 ent: -5.091 str: 0.000 loss: -128.773]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -123.681 ent: -5.091 str: 0.000 loss: -128.773]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -133.544 ent: -5.090 str: 0.000 loss: -138.634]Iterations:  30%|███       | 9/30 [00:04<00:11,  1.90it/s, atk: -133.544 ent: -5.090 str: 0.000 loss: -138.634]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -142.185 ent: -5.089 str: 0.000 loss: -147.274]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -142.185 ent: -5.089 str: 0.000 loss: -147.274]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -150.176 ent: -5.089 str: 0.000 loss: -155.265]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.96it/s, atk: -150.176 ent: -5.089 str: 0.000 loss: -155.265]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -158.383 ent: -5.089 str: 0.000 loss: -163.472]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -158.383 ent: -5.089 str: 0.000 loss: -163.472]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -165.697 ent: -5.088 str: 0.000 loss: -170.785]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.01it/s, atk: -165.697 ent: -5.088 str: 0.000 loss: -170.785]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.01it/s, atk: -171.740 ent: -5.088 str: 0.000 loss: -176.828]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.03it/s, atk: -171.740 ent: -5.088 str: 0.000 loss: -176.828]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.03it/s, atk: -176.797 ent: -5.088 str: 0.000 loss: -181.885]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.01it/s, atk: -176.797 ent: -5.088 str: 0.000 loss: -181.885]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.01it/s, atk: -182.150 ent: -5.088 str: 0.000 loss: -187.238]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  2.00it/s, atk: -182.150 ent: -5.088 str: 0.000 loss: -187.238]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  2.00it/s, atk: -187.661 ent: -5.088 str: 0.000 loss: -192.749]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.01it/s, atk: -187.661 ent: -5.088 str: 0.000 loss: -192.749]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.01it/s, atk: -193.513 ent: -5.088 str: 0.000 loss: -198.601]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -193.513 ent: -5.088 str: 0.000 loss: -198.601]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -198.506 ent: -5.087 str: 0.000 loss: -203.593]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.01it/s, atk: -198.506 ent: -5.087 str: 0.000 loss: -203.593]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.01it/s, atk: -203.789 ent: -5.085 str: 0.000 loss: -208.874]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.02it/s, atk: -203.789 ent: -5.085 str: 0.000 loss: -208.874]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.02it/s, atk: -208.773 ent: -5.084 str: 0.000 loss: -213.857]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.00it/s, atk: -208.773 ent: -5.084 str: 0.000 loss: -213.857]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.00it/s, atk: -213.895 ent: -5.084 str: 0.000 loss: -218.979]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.02it/s, atk: -213.895 ent: -5.084 str: 0.000 loss: -218.979]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.02it/s, atk: -218.701 ent: -5.084 str: 0.000 loss: -223.785]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.98it/s, atk: -218.701 ent: -5.084 str: 0.000 loss: -223.785]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -222.747 ent: -5.085 str: 0.000 loss: -227.833]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -222.747 ent: -5.085 str: 0.000 loss: -227.833]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -225.997 ent: -5.086 str: 0.000 loss: -231.083]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.00it/s, atk: -225.997 ent: -5.086 str: 0.000 loss: -231.083]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.00it/s, atk: -230.287 ent: -5.085 str: 0.000 loss: -235.372]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.01it/s, atk: -230.287 ent: -5.085 str: 0.000 loss: -235.372]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.01it/s, atk: -236.564 ent: -5.084 str: 0.000 loss: -241.648]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  2.02it/s, atk: -236.564 ent: -5.084 str: 0.000 loss: -241.648]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.02it/s, atk: -239.333 ent: -5.083 str: 0.000 loss: -244.416]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.03it/s, atk: -239.333 ent: -5.083 str: 0.000 loss: -244.416]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.03it/s, atk: -244.320 ent: -5.082 str: 0.000 loss: -249.402]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  2.04it/s, atk: -244.320 ent: -5.082 str: 0.000 loss: -249.402]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.04it/s, atk: -247.202 ent: -5.082 str: 0.000 loss: -252.284]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.04it/s, atk: -247.202 ent: -5.082 str: 0.000 loss: -252.284]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -247.202 ent: -5.082 str: 0.000 loss: -252.284]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([484], device='cuda:0') tensor(0.9962, device='cuda:0')
after_true: tensor([672], device='cuda:0') tensor(1.1734e-11, device='cuda:0')
L1: [3278.4277]	L2: [21.944126]	Linf: [0.62352943]

Accuracy on benign examples: 100.0%
gt_label: 253 pred_label: 253 pred_clean_logit 0.8919956684112549
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.41it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.19it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 27.15it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 27.13it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 27.10it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 27.12it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 27.14it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.24it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.16it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.03it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.07s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.18s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.08s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3407
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.177 ent: -7.662 str: 0.000 loss: -9.839]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.82s/it, atk: -2.177 ent: -7.662 str: 0.000 loss: -9.839]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.82s/it, atk: -11.021 ent: -7.659 str: 0.000 loss: -18.680]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.04s/it, atk: -11.021 ent: -7.659 str: 0.000 loss: -18.680]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.04s/it, atk: -36.761 ent: -7.638 str: 0.000 loss: -44.399]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.26it/s, atk: -36.761 ent: -7.638 str: 0.000 loss: -44.399]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.26it/s, atk: -46.569 ent: -7.609 str: 0.000 loss: -54.178]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.49it/s, atk: -46.569 ent: -7.609 str: 0.000 loss: -54.178]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.49it/s, atk: -62.304 ent: -7.601 str: 0.000 loss: -69.906]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.65it/s, atk: -62.304 ent: -7.601 str: 0.000 loss: -69.906]Iterations:  17%|█▋        | 5/30 [00:04<00:15,  1.65it/s, atk: -68.533 ent: -7.590 str: 0.000 loss: -76.123]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.72it/s, atk: -68.533 ent: -7.590 str: 0.000 loss: -76.123]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.72it/s, atk: -78.010 ent: -7.594 str: 0.000 loss: -85.604]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.81it/s, atk: -78.010 ent: -7.594 str: 0.000 loss: -85.604]Iterations:  23%|██▎       | 7/30 [00:05<00:12,  1.81it/s, atk: -78.677 ent: -7.580 str: 0.000 loss: -86.257]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.84it/s, atk: -78.677 ent: -7.580 str: 0.000 loss: -86.257]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.84it/s, atk: -91.513 ent: -7.590 str: 0.000 loss: -99.103]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -91.513 ent: -7.590 str: 0.000 loss: -99.103]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.90it/s, atk: -94.030 ent: -7.591 str: 0.000 loss: -101.620]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.94it/s, atk: -94.030 ent: -7.591 str: 0.000 loss: -101.620]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.94it/s, atk: -95.854 ent: -7.592 str: 0.000 loss: -103.446]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -95.854 ent: -7.592 str: 0.000 loss: -103.446]Iterations:  37%|███▋      | 11/30 [00:07<00:09,  1.93it/s, atk: -101.247 ent: -7.590 str: 0.000 loss: -108.837]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.96it/s, atk: -101.247 ent: -7.590 str: 0.000 loss: -108.837]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.96it/s, atk: -105.772 ent: -7.587 str: 0.000 loss: -113.359]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.91it/s, atk: -105.772 ent: -7.587 str: 0.000 loss: -113.359]Iterations:  43%|████▎     | 13/30 [00:08<00:08,  1.91it/s, atk: -110.748 ent: -7.583 str: 0.000 loss: -118.331]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.94it/s, atk: -110.748 ent: -7.583 str: 0.000 loss: -118.331]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.94it/s, atk: -116.547 ent: -7.579 str: 0.000 loss: -124.126]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -116.547 ent: -7.579 str: 0.000 loss: -124.126]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.97it/s, atk: -122.955 ent: -7.573 str: 0.000 loss: -130.528]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.99it/s, atk: -122.955 ent: -7.573 str: 0.000 loss: -130.528]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.99it/s, atk: -128.600 ent: -7.569 str: 0.000 loss: -136.169]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.00it/s, atk: -128.600 ent: -7.569 str: 0.000 loss: -136.169]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  2.00it/s, atk: -133.724 ent: -7.565 str: 0.000 loss: -141.289]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.02it/s, atk: -133.724 ent: -7.565 str: 0.000 loss: -141.289]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.02it/s, atk: -138.548 ent: -7.561 str: 0.000 loss: -146.109]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.02it/s, atk: -138.548 ent: -7.561 str: 0.000 loss: -146.109]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.02it/s, atk: -144.458 ent: -7.560 str: 0.000 loss: -152.019]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.03it/s, atk: -144.458 ent: -7.560 str: 0.000 loss: -152.019]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.03it/s, atk: -148.520 ent: -7.560 str: 0.000 loss: -156.080]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.01it/s, atk: -148.520 ent: -7.560 str: 0.000 loss: -156.080]Iterations:  70%|███████   | 21/30 [00:12<00:04,  2.01it/s, atk: -153.985 ent: -7.561 str: 0.000 loss: -161.546]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.02it/s, atk: -153.985 ent: -7.561 str: 0.000 loss: -161.546]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.02it/s, atk: -158.512 ent: -7.560 str: 0.000 loss: -166.073]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.03it/s, atk: -158.512 ent: -7.560 str: 0.000 loss: -166.073]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  2.03it/s, atk: -162.868 ent: -7.560 str: 0.000 loss: -170.427]Iterations:  80%|████████  | 24/30 [00:13<00:02,  2.03it/s, atk: -162.868 ent: -7.560 str: 0.000 loss: -170.427]Iterations:  80%|████████  | 24/30 [00:13<00:02,  2.03it/s, atk: -167.638 ent: -7.559 str: 0.000 loss: -175.198]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.00it/s, atk: -167.638 ent: -7.559 str: 0.000 loss: -175.198]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  2.00it/s, atk: -171.945 ent: -7.559 str: 0.000 loss: -179.504]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.01it/s, atk: -171.945 ent: -7.559 str: 0.000 loss: -179.504]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.01it/s, atk: -175.724 ent: -7.558 str: 0.000 loss: -183.281]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.02it/s, atk: -175.724 ent: -7.558 str: 0.000 loss: -183.281]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  2.02it/s, atk: -178.815 ent: -7.556 str: 0.000 loss: -186.371]Iterations:  93%|█████████▎| 28/30 [00:15<00:00,  2.04it/s, atk: -178.815 ent: -7.556 str: 0.000 loss: -186.371]Iterations:  93%|█████████▎| 28/30 [00:15<00:00,  2.04it/s, atk: -182.813 ent: -7.556 str: 0.000 loss: -190.369]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.04it/s, atk: -182.813 ent: -7.556 str: 0.000 loss: -190.369]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  2.04it/s, atk: -183.080 ent: -7.551 str: 0.000 loss: -190.630]Iterations: 100%|██████████| 30/30 [00:16<00:00,  2.04it/s, atk: -183.080 ent: -7.551 str: 0.000 loss: -190.630]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -183.080 ent: -7.551 str: 0.000 loss: -190.630]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([173], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([253], device='cuda:0') tensor(6.7973e-09, device='cuda:0')
L1: [3090.6277]	L2: [20.378256]	Linf: [0.78431374]

Accuracy on benign examples: 100.0%
gt_label: 853 pred_label: 853 pred_clean_logit 0.9964038133621216
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.10it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.13it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.10it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 24.59it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.49it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.87it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.50it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.23it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.13it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.02it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.08s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.23s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.12s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4542
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.060 ent: -4.967 str: 0.000 loss: -5.027]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.15s/it, atk: -0.060 ent: -4.967 str: 0.000 loss: -5.027]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.15s/it, atk: -0.108 ent: -4.973 str: 0.000 loss: -5.081]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.30it/s, atk: -0.108 ent: -4.973 str: 0.000 loss: -5.081]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.30it/s, atk: -0.365 ent: -4.968 str: 0.000 loss: -5.333]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.53it/s, atk: -0.365 ent: -4.968 str: 0.000 loss: -5.333]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.53it/s, atk: -0.663 ent: -4.963 str: 0.000 loss: -5.625]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.70it/s, atk: -0.663 ent: -4.963 str: 0.000 loss: -5.625]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.70it/s, atk: -1.371 ent: -4.968 str: 0.000 loss: -6.338]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.78it/s, atk: -1.371 ent: -4.968 str: 0.000 loss: -6.338]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.78it/s, atk: -3.295 ent: -4.968 str: 0.000 loss: -8.263]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.86it/s, atk: -3.295 ent: -4.968 str: 0.000 loss: -8.263]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.86it/s, atk: -4.828 ent: -4.967 str: 0.000 loss: -9.795]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.92it/s, atk: -4.828 ent: -4.967 str: 0.000 loss: -9.795]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.92it/s, atk: -6.859 ent: -4.957 str: 0.000 loss: -11.816]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -6.859 ent: -4.957 str: 0.000 loss: -11.816]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -12.600 ent: -4.958 str: 0.000 loss: -17.558]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.91it/s, atk: -12.600 ent: -4.958 str: 0.000 loss: -17.558]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.91it/s, atk: -14.550 ent: -4.960 str: 0.000 loss: -19.510]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.89it/s, atk: -14.550 ent: -4.960 str: 0.000 loss: -19.510]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.89it/s, atk: -27.614 ent: -4.959 str: 0.000 loss: -32.572]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -27.614 ent: -4.959 str: 0.000 loss: -32.572]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -35.277 ent: -4.959 str: 0.000 loss: -40.236]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -35.277 ent: -4.959 str: 0.000 loss: -40.236]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.94it/s, atk: -45.788 ent: -4.959 str: 0.000 loss: -50.747]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -45.788 ent: -4.959 str: 0.000 loss: -50.747]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -49.648 ent: -4.958 str: 0.000 loss: -54.606]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -49.648 ent: -4.958 str: 0.000 loss: -54.606]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -58.196 ent: -4.957 str: 0.000 loss: -63.153]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -58.196 ent: -4.957 str: 0.000 loss: -63.153]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -65.834 ent: -4.955 str: 0.000 loss: -70.789]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.96it/s, atk: -65.834 ent: -4.955 str: 0.000 loss: -70.789]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -71.913 ent: -4.955 str: 0.000 loss: -76.867]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -71.913 ent: -4.955 str: 0.000 loss: -76.867]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -79.497 ent: -4.954 str: 0.000 loss: -84.451]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -79.497 ent: -4.954 str: 0.000 loss: -84.451]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.96it/s, atk: -86.782 ent: -4.954 str: 0.000 loss: -91.736]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -86.782 ent: -4.954 str: 0.000 loss: -91.736]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -93.928 ent: -4.953 str: 0.000 loss: -98.881]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -93.928 ent: -4.953 str: 0.000 loss: -98.881]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.96it/s, atk: -102.562 ent: -4.952 str: 0.000 loss: -107.514]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -102.562 ent: -4.952 str: 0.000 loss: -107.514]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -109.644 ent: -4.951 str: 0.000 loss: -114.595]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -109.644 ent: -4.951 str: 0.000 loss: -114.595]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.98it/s, atk: -118.673 ent: -4.950 str: 0.000 loss: -123.623]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -118.673 ent: -4.950 str: 0.000 loss: -123.623]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -124.883 ent: -4.949 str: 0.000 loss: -129.832]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.94it/s, atk: -124.883 ent: -4.949 str: 0.000 loss: -129.832]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -130.761 ent: -4.949 str: 0.000 loss: -135.710]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -130.761 ent: -4.949 str: 0.000 loss: -135.710]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -141.770 ent: -4.949 str: 0.000 loss: -146.718]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -141.770 ent: -4.949 str: 0.000 loss: -146.718]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.97it/s, atk: -152.344 ent: -4.947 str: 0.000 loss: -157.292]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -152.344 ent: -4.947 str: 0.000 loss: -157.292]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -158.721 ent: -4.947 str: 0.000 loss: -163.668]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.93it/s, atk: -158.721 ent: -4.947 str: 0.000 loss: -163.668]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.93it/s, atk: -165.731 ent: -4.947 str: 0.000 loss: -170.678]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -165.731 ent: -4.947 str: 0.000 loss: -170.678]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -170.180 ent: -4.947 str: 0.000 loss: -175.127]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.00it/s, atk: -170.180 ent: -4.947 str: 0.000 loss: -175.127]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.89it/s, atk: -170.180 ent: -4.947 str: 0.000 loss: -175.127]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([517], device='cuda:0') tensor(0.4169, device='cuda:0')
after_true: tensor([853], device='cuda:0') tensor(1.7560e-08, device='cuda:0')
L1: [3801.6274]	L2: [25.515425]	Linf: [0.84313726]

Accuracy on benign examples: 100.0%
gt_label: 972 pred_label: 972 pred_clean_logit 0.8038078546524048
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 23.73it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.86it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.76it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.39it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.66it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 23.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.18s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.12s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.12s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.30s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.23s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4732
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -5.606 ent: -2.534 str: 0.000 loss: -8.140]Iterations:   3%|▎         | 1/30 [00:00<00:27,  1.06it/s, atk: -5.606 ent: -2.534 str: 0.000 loss: -8.140]Iterations:   3%|▎         | 1/30 [00:01<00:27,  1.06it/s, atk: -8.875 ent: -2.518 str: 0.000 loss: -11.393]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.48it/s, atk: -8.875 ent: -2.518 str: 0.000 loss: -11.393]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.48it/s, atk: -12.613 ent: -2.511 str: 0.000 loss: -15.124]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.62it/s, atk: -12.613 ent: -2.511 str: 0.000 loss: -15.124]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.62it/s, atk: -15.982 ent: -2.504 str: 0.000 loss: -18.487]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.75it/s, atk: -15.982 ent: -2.504 str: 0.000 loss: -18.487]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.75it/s, atk: -19.651 ent: -2.502 str: 0.000 loss: -22.153]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.84it/s, atk: -19.651 ent: -2.502 str: 0.000 loss: -22.153]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.84it/s, atk: -26.192 ent: -2.502 str: 0.000 loss: -28.694]Iterations:  20%|██        | 6/30 [00:03<00:14,  1.71it/s, atk: -26.192 ent: -2.502 str: 0.000 loss: -28.694]Iterations:  20%|██        | 6/30 [00:03<00:14,  1.71it/s, atk: -37.382 ent: -2.499 str: 0.000 loss: -39.881]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.80it/s, atk: -37.382 ent: -2.499 str: 0.000 loss: -39.881]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.80it/s, atk: -43.687 ent: -2.498 str: 0.000 loss: -46.185]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.84it/s, atk: -43.687 ent: -2.498 str: 0.000 loss: -46.185]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.84it/s, atk: -43.648 ent: -2.496 str: 0.000 loss: -46.144]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -43.648 ent: -2.496 str: 0.000 loss: -46.144]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -46.200 ent: -2.495 str: 0.000 loss: -48.695]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -46.200 ent: -2.495 str: 0.000 loss: -48.695]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -52.337 ent: -2.492 str: 0.000 loss: -54.829]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -52.337 ent: -2.492 str: 0.000 loss: -54.829]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -54.795 ent: -2.490 str: 0.000 loss: -57.285]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -54.795 ent: -2.490 str: 0.000 loss: -57.285]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -58.357 ent: -2.489 str: 0.000 loss: -60.846]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -58.357 ent: -2.489 str: 0.000 loss: -60.846]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -64.014 ent: -2.490 str: 0.000 loss: -66.504]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.94it/s, atk: -64.014 ent: -2.490 str: 0.000 loss: -66.504]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.94it/s, atk: -70.272 ent: -2.491 str: 0.000 loss: -72.762]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -70.272 ent: -2.491 str: 0.000 loss: -72.762]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -76.887 ent: -2.491 str: 0.000 loss: -79.378]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -76.887 ent: -2.491 str: 0.000 loss: -79.378]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -83.379 ent: -2.490 str: 0.000 loss: -85.869]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -83.379 ent: -2.490 str: 0.000 loss: -85.869]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -89.256 ent: -2.488 str: 0.000 loss: -91.744]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.95it/s, atk: -89.256 ent: -2.488 str: 0.000 loss: -91.744]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.95it/s, atk: -93.730 ent: -2.487 str: 0.000 loss: -96.217]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -93.730 ent: -2.487 str: 0.000 loss: -96.217]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -95.752 ent: -2.487 str: 0.000 loss: -98.239]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -95.752 ent: -2.487 str: 0.000 loss: -98.239]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -99.529 ent: -2.487 str: 0.000 loss: -102.016]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -99.529 ent: -2.487 str: 0.000 loss: -102.016]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -103.409 ent: -2.487 str: 0.000 loss: -105.896]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.94it/s, atk: -103.409 ent: -2.487 str: 0.000 loss: -105.896]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -107.112 ent: -2.486 str: 0.000 loss: -109.599]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -107.112 ent: -2.486 str: 0.000 loss: -109.599]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -110.209 ent: -2.487 str: 0.000 loss: -112.696]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.89it/s, atk: -110.209 ent: -2.487 str: 0.000 loss: -112.696]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.89it/s, atk: -111.506 ent: -2.487 str: 0.000 loss: -113.993]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.95it/s, atk: -111.506 ent: -2.487 str: 0.000 loss: -113.993]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.95it/s, atk: -118.503 ent: -2.487 str: 0.000 loss: -120.990]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.96it/s, atk: -118.503 ent: -2.487 str: 0.000 loss: -120.990]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.96it/s, atk: -123.048 ent: -2.487 str: 0.000 loss: -125.535]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.96it/s, atk: -123.048 ent: -2.487 str: 0.000 loss: -125.535]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.96it/s, atk: -127.603 ent: -2.488 str: 0.000 loss: -130.091]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.75it/s, atk: -127.603 ent: -2.488 str: 0.000 loss: -130.091]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.75it/s, atk: -130.691 ent: -2.488 str: 0.000 loss: -133.179]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.83it/s, atk: -130.691 ent: -2.488 str: 0.000 loss: -133.179]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.83it/s, atk: -134.241 ent: -2.488 str: 0.000 loss: -136.730]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.84it/s, atk: -134.241 ent: -2.488 str: 0.000 loss: -136.730]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.87it/s, atk: -134.241 ent: -2.488 str: 0.000 loss: -136.730]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([609], device='cuda:0') tensor(0.9973, device='cuda:0')
after_true: tensor([972], device='cuda:0') tensor(9.9644e-07, device='cuda:0')
L1: [2954.498]	L2: [20.865585]	Linf: [0.8235294]

Accuracy on benign examples: 100.0%
gt_label: 703 pred_label: 703 pred_clean_logit 0.7603355646133423
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.93it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.09it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.48it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 24.53it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 21.87it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 23.58it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.23it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.04it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.04s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.16s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5528
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -6.171 ent: -5.147 str: 0.000 loss: -11.318]Iterations:   3%|▎         | 1/30 [00:00<00:19,  1.52it/s, atk: -6.171 ent: -5.147 str: 0.000 loss: -11.318]Iterations:   3%|▎         | 1/30 [00:00<00:19,  1.52it/s, atk: -26.832 ent: -5.112 str: 0.000 loss: -31.944]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.79it/s, atk: -26.832 ent: -5.112 str: 0.000 loss: -31.944]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.79it/s, atk: -33.636 ent: -5.099 str: 0.000 loss: -38.735]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.90it/s, atk: -33.636 ent: -5.099 str: 0.000 loss: -38.735]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.90it/s, atk: -45.160 ent: -5.093 str: 0.000 loss: -50.252]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.95it/s, atk: -45.160 ent: -5.093 str: 0.000 loss: -50.252]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.95it/s, atk: -43.535 ent: -5.085 str: 0.000 loss: -48.620]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -43.535 ent: -5.085 str: 0.000 loss: -48.620]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -51.583 ent: -5.085 str: 0.000 loss: -56.669]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.96it/s, atk: -51.583 ent: -5.085 str: 0.000 loss: -56.669]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.96it/s, atk: -61.237 ent: -5.087 str: 0.000 loss: -66.325]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.98it/s, atk: -61.237 ent: -5.087 str: 0.000 loss: -66.325]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.98it/s, atk: -69.869 ent: -5.086 str: 0.000 loss: -74.955]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.99it/s, atk: -69.869 ent: -5.086 str: 0.000 loss: -74.955]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.99it/s, atk: -78.613 ent: -5.087 str: 0.000 loss: -83.699]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.93it/s, atk: -78.613 ent: -5.087 str: 0.000 loss: -83.699]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -88.563 ent: -5.088 str: 0.000 loss: -93.651]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.92it/s, atk: -88.563 ent: -5.088 str: 0.000 loss: -93.651]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.92it/s, atk: -100.555 ent: -5.086 str: 0.000 loss: -105.641]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.95it/s, atk: -100.555 ent: -5.086 str: 0.000 loss: -105.641]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.95it/s, atk: -112.613 ent: -5.085 str: 0.000 loss: -117.699]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.97it/s, atk: -112.613 ent: -5.085 str: 0.000 loss: -117.699]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.97it/s, atk: -125.404 ent: -5.086 str: 0.000 loss: -130.490]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.94it/s, atk: -125.404 ent: -5.086 str: 0.000 loss: -130.490]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -136.498 ent: -5.086 str: 0.000 loss: -141.584]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -136.498 ent: -5.086 str: 0.000 loss: -141.584]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -147.241 ent: -5.084 str: 0.000 loss: -152.325]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.94it/s, atk: -147.241 ent: -5.084 str: 0.000 loss: -152.325]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.94it/s, atk: -158.849 ent: -5.082 str: 0.000 loss: -163.931]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -158.849 ent: -5.082 str: 0.000 loss: -163.931]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -167.570 ent: -5.081 str: 0.000 loss: -172.651]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.95it/s, atk: -167.570 ent: -5.081 str: 0.000 loss: -172.651]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -177.117 ent: -5.080 str: 0.000 loss: -182.197]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -177.117 ent: -5.080 str: 0.000 loss: -182.197]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -185.803 ent: -5.077 str: 0.000 loss: -190.880]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.97it/s, atk: -185.803 ent: -5.077 str: 0.000 loss: -190.880]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -194.979 ent: -5.075 str: 0.000 loss: -200.054]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -194.979 ent: -5.075 str: 0.000 loss: -200.054]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -202.555 ent: -5.073 str: 0.000 loss: -207.628]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.99it/s, atk: -202.555 ent: -5.073 str: 0.000 loss: -207.628]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -210.135 ent: -5.072 str: 0.000 loss: -215.206]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.01it/s, atk: -210.135 ent: -5.072 str: 0.000 loss: -215.206]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.01it/s, atk: -220.088 ent: -5.071 str: 0.000 loss: -225.159]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.00it/s, atk: -220.088 ent: -5.071 str: 0.000 loss: -225.159]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.00it/s, atk: -227.845 ent: -5.070 str: 0.000 loss: -232.916]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -227.845 ent: -5.070 str: 0.000 loss: -232.916]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -234.622 ent: -5.071 str: 0.000 loss: -239.693]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.98it/s, atk: -234.622 ent: -5.071 str: 0.000 loss: -239.693]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -243.588 ent: -5.071 str: 0.000 loss: -248.659]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.99it/s, atk: -243.588 ent: -5.071 str: 0.000 loss: -248.659]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.99it/s, atk: -249.790 ent: -5.070 str: 0.000 loss: -254.860]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  2.00it/s, atk: -249.790 ent: -5.070 str: 0.000 loss: -254.860]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.00it/s, atk: -258.249 ent: -5.069 str: 0.000 loss: -263.318]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -258.249 ent: -5.069 str: 0.000 loss: -263.318]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -263.871 ent: -5.069 str: 0.000 loss: -268.940]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.94it/s, atk: -263.871 ent: -5.069 str: 0.000 loss: -268.940]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -269.281 ent: -5.069 str: 0.000 loss: -274.350]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -269.281 ent: -5.069 str: 0.000 loss: -274.350]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.95it/s, atk: -269.281 ent: -5.069 str: 0.000 loss: -274.350]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([423], device='cuda:0') tensor(0.9830, device='cuda:0')
after_true: tensor([703], device='cuda:0') tensor(1.0069e-12, device='cuda:0')
L1: [3365.2903]	L2: [23.599972]	Linf: [0.75686276]

Accuracy on benign examples: 100.0%
gt_label: 107 pred_label: 107 pred_clean_logit 0.9928026795387268
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.44it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 22.94it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 24.65it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 25.40it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.28it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.04it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.08it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.02it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.12s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2377
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.218 ent: -2.721 str: 0.000 loss: -3.938]Iterations:   3%|▎         | 1/30 [00:00<00:25,  1.13it/s, atk: -1.218 ent: -2.721 str: 0.000 loss: -3.938]Iterations:   3%|▎         | 1/30 [00:01<00:25,  1.13it/s, atk: -1.493 ent: -2.711 str: 0.000 loss: -4.204]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.49it/s, atk: -1.493 ent: -2.711 str: 0.000 loss: -4.204]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.49it/s, atk: -3.988 ent: -2.705 str: 0.000 loss: -6.693]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.68it/s, atk: -3.988 ent: -2.705 str: 0.000 loss: -6.693]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.68it/s, atk: -7.971 ent: -2.697 str: 0.000 loss: -10.668]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -7.971 ent: -2.697 str: 0.000 loss: -10.668]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -12.929 ent: -2.698 str: 0.000 loss: -15.627]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.82it/s, atk: -12.929 ent: -2.698 str: 0.000 loss: -15.627]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.82it/s, atk: -18.025 ent: -2.694 str: 0.000 loss: -20.718]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.86it/s, atk: -18.025 ent: -2.694 str: 0.000 loss: -20.718]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.86it/s, atk: -22.343 ent: -2.688 str: 0.000 loss: -25.030]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.89it/s, atk: -22.343 ent: -2.688 str: 0.000 loss: -25.030]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.89it/s, atk: -23.282 ent: -2.689 str: 0.000 loss: -25.971]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.89it/s, atk: -23.282 ent: -2.689 str: 0.000 loss: -25.971]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.89it/s, atk: -29.272 ent: -2.688 str: 0.000 loss: -31.960]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.88it/s, atk: -29.272 ent: -2.688 str: 0.000 loss: -31.960]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.88it/s, atk: -33.650 ent: -2.685 str: 0.000 loss: -36.335]Iterations:  33%|███▎      | 10/30 [00:05<00:12,  1.59it/s, atk: -33.650 ent: -2.685 str: 0.000 loss: -36.335]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.59it/s, atk: -36.687 ent: -2.685 str: 0.000 loss: -39.372]Iterations:  37%|███▋      | 11/30 [00:06<00:12,  1.55it/s, atk: -36.687 ent: -2.685 str: 0.000 loss: -39.372]Iterations:  37%|███▋      | 11/30 [00:06<00:12,  1.55it/s, atk: -40.470 ent: -2.685 str: 0.000 loss: -43.154]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.63it/s, atk: -40.470 ent: -2.685 str: 0.000 loss: -43.154]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.63it/s, atk: -42.928 ent: -2.684 str: 0.000 loss: -45.613]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.70it/s, atk: -42.928 ent: -2.684 str: 0.000 loss: -45.613]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.70it/s, atk: -42.722 ent: -2.683 str: 0.000 loss: -45.405]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.69it/s, atk: -42.722 ent: -2.683 str: 0.000 loss: -45.405]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.69it/s, atk: -48.004 ent: -2.684 str: 0.000 loss: -50.688]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.77it/s, atk: -48.004 ent: -2.684 str: 0.000 loss: -50.688]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.77it/s, atk: -48.899 ent: -2.683 str: 0.000 loss: -51.582]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.82it/s, atk: -48.899 ent: -2.683 str: 0.000 loss: -51.582]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.82it/s, atk: -50.917 ent: -2.685 str: 0.000 loss: -53.602]Iterations:  57%|█████▋    | 17/30 [00:09<00:07,  1.81it/s, atk: -50.917 ent: -2.685 str: 0.000 loss: -53.602]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.81it/s, atk: -52.814 ent: -2.686 str: 0.000 loss: -55.500]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.86it/s, atk: -52.814 ent: -2.686 str: 0.000 loss: -55.500]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.86it/s, atk: -55.737 ent: -2.688 str: 0.000 loss: -58.424]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.87it/s, atk: -55.737 ent: -2.688 str: 0.000 loss: -58.424]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  1.87it/s, atk: -58.290 ent: -2.689 str: 0.000 loss: -60.979]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.90it/s, atk: -58.290 ent: -2.689 str: 0.000 loss: -60.979]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.90it/s, atk: -59.873 ent: -2.691 str: 0.000 loss: -62.564]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.94it/s, atk: -59.873 ent: -2.691 str: 0.000 loss: -62.564]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.94it/s, atk: -62.338 ent: -2.691 str: 0.000 loss: -65.029]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.90it/s, atk: -62.338 ent: -2.691 str: 0.000 loss: -65.029]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.90it/s, atk: -65.667 ent: -2.688 str: 0.000 loss: -68.355]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.95it/s, atk: -65.667 ent: -2.688 str: 0.000 loss: -68.355]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.95it/s, atk: -68.340 ent: -2.687 str: 0.000 loss: -71.026]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -68.340 ent: -2.687 str: 0.000 loss: -71.026]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -70.712 ent: -2.685 str: 0.000 loss: -73.397]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.96it/s, atk: -70.712 ent: -2.685 str: 0.000 loss: -73.397]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.96it/s, atk: -73.035 ent: -2.685 str: 0.000 loss: -75.720]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -73.035 ent: -2.685 str: 0.000 loss: -75.720]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -74.845 ent: -2.686 str: 0.000 loss: -77.531]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -74.845 ent: -2.686 str: 0.000 loss: -77.531]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.97it/s, atk: -76.757 ent: -2.686 str: 0.000 loss: -79.443]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -76.757 ent: -2.686 str: 0.000 loss: -79.443]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -78.954 ent: -2.686 str: 0.000 loss: -81.640]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -78.954 ent: -2.686 str: 0.000 loss: -81.640]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  2.00it/s, atk: -81.187 ent: -2.686 str: 0.000 loss: -83.873]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.98it/s, atk: -81.187 ent: -2.686 str: 0.000 loss: -83.873]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.83it/s, atk: -81.187 ent: -2.686 str: 0.000 loss: -83.873]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([983], device='cuda:0') tensor(0.8495, device='cuda:0')
after_true: tensor([107], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [1026.361]	L2: [9.208832]	Linf: [0.87058824]

Accuracy on benign examples: 100.0%
gt_label: 963 pred_label: 963 pred_clean_logit 0.7317131757736206
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 24.54it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.66it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.84it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.69it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.66it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.86it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.54it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.18it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.12it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.00it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.12s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.12s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6450
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -6.236 ent: -2.623 str: 0.000 loss: -8.859]Iterations:   3%|▎         | 1/30 [00:00<00:27,  1.07it/s, atk: -6.236 ent: -2.623 str: 0.000 loss: -8.859]Iterations:   3%|▎         | 1/30 [00:01<00:27,  1.07it/s, atk: -21.094 ent: -2.594 str: 0.000 loss: -23.688]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.49it/s, atk: -21.094 ent: -2.594 str: 0.000 loss: -23.688]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.49it/s, atk: -39.122 ent: -2.579 str: 0.000 loss: -41.701]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.70it/s, atk: -39.122 ent: -2.579 str: 0.000 loss: -41.701]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.70it/s, atk: -49.198 ent: -2.585 str: 0.000 loss: -51.783]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.82it/s, atk: -49.198 ent: -2.585 str: 0.000 loss: -51.783]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.82it/s, atk: -53.061 ent: -2.584 str: 0.000 loss: -55.645]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.86it/s, atk: -53.061 ent: -2.584 str: 0.000 loss: -55.645]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.86it/s, atk: -66.672 ent: -2.583 str: 0.000 loss: -69.254]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.85it/s, atk: -66.672 ent: -2.583 str: 0.000 loss: -69.254]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.85it/s, atk: -88.254 ent: -2.579 str: 0.000 loss: -90.833]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.87it/s, atk: -88.254 ent: -2.579 str: 0.000 loss: -90.833]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.87it/s, atk: -103.283 ent: -2.576 str: 0.000 loss: -105.858]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -103.283 ent: -2.576 str: 0.000 loss: -105.858]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -107.923 ent: -2.574 str: 0.000 loss: -110.497]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.95it/s, atk: -107.923 ent: -2.574 str: 0.000 loss: -110.497]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.95it/s, atk: -129.581 ent: -2.573 str: 0.000 loss: -132.154]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.97it/s, atk: -129.581 ent: -2.573 str: 0.000 loss: -132.154]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.97it/s, atk: -132.986 ent: -2.574 str: 0.000 loss: -135.560]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.98it/s, atk: -132.986 ent: -2.574 str: 0.000 loss: -135.560]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.98it/s, atk: -142.762 ent: -2.572 str: 0.000 loss: -145.333]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.00it/s, atk: -142.762 ent: -2.572 str: 0.000 loss: -145.333]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.00it/s, atk: -145.132 ent: -2.570 str: 0.000 loss: -147.702]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.01it/s, atk: -145.132 ent: -2.570 str: 0.000 loss: -147.702]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.01it/s, atk: -153.913 ent: -2.569 str: 0.000 loss: -156.482]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -153.913 ent: -2.569 str: 0.000 loss: -156.482]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -161.734 ent: -2.569 str: 0.000 loss: -164.302]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.00it/s, atk: -161.734 ent: -2.569 str: 0.000 loss: -164.302]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.00it/s, atk: -171.209 ent: -2.569 str: 0.000 loss: -173.777]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -171.209 ent: -2.569 str: 0.000 loss: -173.777]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -177.157 ent: -2.569 str: 0.000 loss: -179.726]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.96it/s, atk: -177.157 ent: -2.569 str: 0.000 loss: -179.726]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -179.001 ent: -2.568 str: 0.000 loss: -181.569]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -179.001 ent: -2.568 str: 0.000 loss: -181.569]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -175.086 ent: -2.568 str: 0.000 loss: -177.654]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.00it/s, atk: -175.086 ent: -2.568 str: 0.000 loss: -177.654]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -189.263 ent: -2.565 str: 0.000 loss: -191.828]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.93it/s, atk: -189.263 ent: -2.565 str: 0.000 loss: -191.828]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.93it/s, atk: -200.097 ent: -2.564 str: 0.000 loss: -202.661]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -200.097 ent: -2.564 str: 0.000 loss: -202.661]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -204.699 ent: -2.563 str: 0.000 loss: -207.262]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -204.699 ent: -2.563 str: 0.000 loss: -207.262]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -210.394 ent: -2.562 str: 0.000 loss: -212.956]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.02it/s, atk: -210.394 ent: -2.562 str: 0.000 loss: -212.956]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.02it/s, atk: -186.455 ent: -2.562 str: 0.000 loss: -189.016]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.03it/s, atk: -186.455 ent: -2.562 str: 0.000 loss: -189.016]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.03it/s, atk: -201.566 ent: -2.561 str: 0.000 loss: -204.127]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -201.566 ent: -2.561 str: 0.000 loss: -204.127]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -207.359 ent: -2.561 str: 0.000 loss: -209.921]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  2.00it/s, atk: -207.359 ent: -2.561 str: 0.000 loss: -209.921]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  2.00it/s, atk: -215.377 ent: -2.561 str: 0.000 loss: -217.938]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -215.377 ent: -2.561 str: 0.000 loss: -217.938]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -225.289 ent: -2.561 str: 0.000 loss: -227.850]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.97it/s, atk: -225.289 ent: -2.561 str: 0.000 loss: -227.850]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.97it/s, atk: -229.464 ent: -2.561 str: 0.000 loss: -232.025]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -229.464 ent: -2.561 str: 0.000 loss: -232.025]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -235.438 ent: -2.561 str: 0.000 loss: -237.998]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.01it/s, atk: -235.438 ent: -2.561 str: 0.000 loss: -237.998]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.93it/s, atk: -235.438 ent: -2.561 str: 0.000 loss: -237.998]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([937], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([963], device='cuda:0') tensor(2.8346e-11, device='cuda:0')
L1: [3383.8823]	L2: [22.86541]	Linf: [0.77254903]

Accuracy on benign examples: 100.0%
gt_label: 353 pred_label: 353 pred_clean_logit 0.9863053560256958
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 28.11it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.56it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 27.23it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 27.16it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.41it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.41it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.02it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.05it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.10s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.13s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5004
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.115 ent: -5.099 str: 0.000 loss: -5.215]Iterations:   3%|▎         | 1/30 [00:00<00:25,  1.12it/s, atk: -0.115 ent: -5.099 str: 0.000 loss: -5.215]Iterations:   3%|▎         | 1/30 [00:01<00:25,  1.12it/s, atk: -0.217 ent: -5.100 str: 0.000 loss: -5.317]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -0.217 ent: -5.100 str: 0.000 loss: -5.317]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -0.408 ent: -5.105 str: 0.000 loss: -5.513]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.73it/s, atk: -0.408 ent: -5.105 str: 0.000 loss: -5.513]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.73it/s, atk: -0.602 ent: -5.103 str: 0.000 loss: -5.704]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.70it/s, atk: -0.602 ent: -5.103 str: 0.000 loss: -5.704]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.70it/s, atk: -1.002 ent: -5.098 str: 0.000 loss: -6.101]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -1.002 ent: -5.098 str: 0.000 loss: -6.101]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -1.780 ent: -5.098 str: 0.000 loss: -6.878]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.83it/s, atk: -1.780 ent: -5.098 str: 0.000 loss: -6.878]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.83it/s, atk: -2.993 ent: -5.094 str: 0.000 loss: -8.087]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.89it/s, atk: -2.993 ent: -5.094 str: 0.000 loss: -8.087]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.89it/s, atk: -3.993 ent: -5.095 str: 0.000 loss: -9.088]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -3.993 ent: -5.095 str: 0.000 loss: -9.088]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -5.312 ent: -5.086 str: 0.000 loss: -10.398]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.97it/s, atk: -5.312 ent: -5.086 str: 0.000 loss: -10.398]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.97it/s, atk: -8.130 ent: -5.091 str: 0.000 loss: -13.221]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  2.00it/s, atk: -8.130 ent: -5.091 str: 0.000 loss: -13.221]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  2.00it/s, atk: -10.203 ent: -5.093 str: 0.000 loss: -15.296]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.99it/s, atk: -10.203 ent: -5.093 str: 0.000 loss: -15.296]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -12.541 ent: -5.090 str: 0.000 loss: -17.632]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.01it/s, atk: -12.541 ent: -5.090 str: 0.000 loss: -17.632]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.01it/s, atk: -15.082 ent: -5.091 str: 0.000 loss: -20.172]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.02it/s, atk: -15.082 ent: -5.091 str: 0.000 loss: -20.172]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.02it/s, atk: -17.682 ent: -5.089 str: 0.000 loss: -22.771]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.03it/s, atk: -17.682 ent: -5.089 str: 0.000 loss: -22.771]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.03it/s, atk: -20.443 ent: -5.087 str: 0.000 loss: -25.530]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.04it/s, atk: -20.443 ent: -5.087 str: 0.000 loss: -25.530]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.04it/s, atk: -23.255 ent: -5.084 str: 0.000 loss: -28.338]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.04it/s, atk: -23.255 ent: -5.084 str: 0.000 loss: -28.338]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.04it/s, atk: -26.643 ent: -5.083 str: 0.000 loss: -31.726]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.05it/s, atk: -26.643 ent: -5.083 str: 0.000 loss: -31.726]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.05it/s, atk: -29.184 ent: -5.081 str: 0.000 loss: -34.264]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.05it/s, atk: -29.184 ent: -5.081 str: 0.000 loss: -34.264]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.05it/s, atk: -32.674 ent: -5.079 str: 0.000 loss: -37.753]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.03it/s, atk: -32.674 ent: -5.079 str: 0.000 loss: -37.753]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.03it/s, atk: -35.117 ent: -5.074 str: 0.000 loss: -40.191]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.06it/s, atk: -35.117 ent: -5.074 str: 0.000 loss: -40.191]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.06it/s, atk: -37.725 ent: -5.075 str: 0.000 loss: -42.800]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.05it/s, atk: -37.725 ent: -5.075 str: 0.000 loss: -42.800]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.05it/s, atk: -40.786 ent: -5.072 str: 0.000 loss: -45.858]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.04it/s, atk: -40.786 ent: -5.072 str: 0.000 loss: -45.858]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.04it/s, atk: -43.933 ent: -5.073 str: 0.000 loss: -49.006]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.91it/s, atk: -43.933 ent: -5.073 str: 0.000 loss: -49.006]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.91it/s, atk: -46.555 ent: -5.075 str: 0.000 loss: -51.630]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.88it/s, atk: -46.555 ent: -5.075 str: 0.000 loss: -51.630]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.88it/s, atk: -48.995 ent: -5.071 str: 0.000 loss: -54.066]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.89it/s, atk: -48.995 ent: -5.071 str: 0.000 loss: -54.066]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.89it/s, atk: -52.087 ent: -5.071 str: 0.000 loss: -57.158]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.91it/s, atk: -52.087 ent: -5.071 str: 0.000 loss: -57.158]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.91it/s, atk: -54.524 ent: -5.070 str: 0.000 loss: -59.594]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.88it/s, atk: -54.524 ent: -5.070 str: 0.000 loss: -59.594]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.88it/s, atk: -56.547 ent: -5.068 str: 0.000 loss: -61.615]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.92it/s, atk: -56.547 ent: -5.068 str: 0.000 loss: -61.615]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.92it/s, atk: -58.868 ent: -5.070 str: 0.000 loss: -63.937]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.93it/s, atk: -58.868 ent: -5.070 str: 0.000 loss: -63.937]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.93it/s, atk: -61.180 ent: -5.066 str: 0.000 loss: -66.245]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.88it/s, atk: -61.180 ent: -5.066 str: 0.000 loss: -66.245]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.92it/s, atk: -61.180 ent: -5.066 str: 0.000 loss: -66.245]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([352], device='cuda:0') tensor(0.9981, device='cuda:0')
after_true: tensor([353], device='cuda:0') tensor(0.0018, device='cuda:0')
L1: [2031.2277]	L2: [13.635407]	Linf: [0.5058824]

Accuracy on benign examples: 100.0%
gt_label: 605 pred_label: 605 pred_clean_logit 0.8832379579544067
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.94it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 14.70it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.53it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 21.17it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 23.00it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.07it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.90it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 22.35it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.11it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.06it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:02,  1.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.14s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.15s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3368
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -2.144 ent: -2.767 str: 0.000 loss: -4.910]Iterations:   3%|▎         | 1/30 [00:00<00:25,  1.15it/s, atk: -2.144 ent: -2.767 str: 0.000 loss: -4.910]Iterations:   3%|▎         | 1/30 [00:01<00:25,  1.15it/s, atk: -6.598 ent: -2.761 str: 0.000 loss: -9.359]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.54it/s, atk: -6.598 ent: -2.761 str: 0.000 loss: -9.359]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.54it/s, atk: -20.279 ent: -2.758 str: 0.000 loss: -23.037]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.72it/s, atk: -20.279 ent: -2.758 str: 0.000 loss: -23.037]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.72it/s, atk: -32.252 ent: -2.753 str: 0.000 loss: -35.004]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.77it/s, atk: -32.252 ent: -2.753 str: 0.000 loss: -35.004]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.77it/s, atk: -43.266 ent: -2.744 str: 0.000 loss: -46.010]Iterations:  17%|█▋        | 5/30 [00:02<00:14,  1.74it/s, atk: -43.266 ent: -2.744 str: 0.000 loss: -46.010]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -54.084 ent: -2.738 str: 0.000 loss: -56.822]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.78it/s, atk: -54.084 ent: -2.738 str: 0.000 loss: -56.822]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.78it/s, atk: -62.504 ent: -2.736 str: 0.000 loss: -65.240]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -62.504 ent: -2.736 str: 0.000 loss: -65.240]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -72.858 ent: -2.734 str: 0.000 loss: -75.592]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -72.858 ent: -2.734 str: 0.000 loss: -75.592]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -84.933 ent: -2.733 str: 0.000 loss: -87.666]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -84.933 ent: -2.733 str: 0.000 loss: -87.666]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -93.378 ent: -2.734 str: 0.000 loss: -96.112]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.94it/s, atk: -93.378 ent: -2.734 str: 0.000 loss: -96.112]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.94it/s, atk: -101.976 ent: -2.735 str: 0.000 loss: -104.712]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -101.976 ent: -2.735 str: 0.000 loss: -104.712]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -109.606 ent: -2.736 str: 0.000 loss: -112.342]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -109.606 ent: -2.736 str: 0.000 loss: -112.342]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -118.042 ent: -2.737 str: 0.000 loss: -120.779]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -118.042 ent: -2.737 str: 0.000 loss: -120.779]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -123.848 ent: -2.737 str: 0.000 loss: -126.585]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -123.848 ent: -2.737 str: 0.000 loss: -126.585]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -132.398 ent: -2.737 str: 0.000 loss: -135.135]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -132.398 ent: -2.737 str: 0.000 loss: -135.135]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -139.239 ent: -2.737 str: 0.000 loss: -141.976]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -139.239 ent: -2.737 str: 0.000 loss: -141.976]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -145.768 ent: -2.737 str: 0.000 loss: -148.505]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -145.768 ent: -2.737 str: 0.000 loss: -148.505]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -150.925 ent: -2.736 str: 0.000 loss: -153.661]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -150.925 ent: -2.736 str: 0.000 loss: -153.661]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -155.227 ent: -2.735 str: 0.000 loss: -157.962]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -155.227 ent: -2.735 str: 0.000 loss: -157.962]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -161.032 ent: -2.734 str: 0.000 loss: -163.766]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.99it/s, atk: -161.032 ent: -2.734 str: 0.000 loss: -163.766]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.99it/s, atk: -166.350 ent: -2.734 str: 0.000 loss: -169.083]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -166.350 ent: -2.734 str: 0.000 loss: -169.083]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -171.636 ent: -2.733 str: 0.000 loss: -174.369]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -171.636 ent: -2.733 str: 0.000 loss: -174.369]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -176.917 ent: -2.732 str: 0.000 loss: -179.649]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -176.917 ent: -2.732 str: 0.000 loss: -179.649]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -181.755 ent: -2.731 str: 0.000 loss: -184.486]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -181.755 ent: -2.731 str: 0.000 loss: -184.486]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -186.752 ent: -2.729 str: 0.000 loss: -189.481]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -186.752 ent: -2.729 str: 0.000 loss: -189.481]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -191.731 ent: -2.728 str: 0.000 loss: -194.459]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.96it/s, atk: -191.731 ent: -2.728 str: 0.000 loss: -194.459]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.96it/s, atk: -196.103 ent: -2.727 str: 0.000 loss: -198.830]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -196.103 ent: -2.727 str: 0.000 loss: -198.830]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -200.899 ent: -2.727 str: 0.000 loss: -203.626]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -200.899 ent: -2.727 str: 0.000 loss: -203.626]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -205.862 ent: -2.726 str: 0.000 loss: -208.588]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -205.862 ent: -2.726 str: 0.000 loss: -208.588]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -209.986 ent: -2.725 str: 0.000 loss: -212.710]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.01it/s, atk: -209.986 ent: -2.725 str: 0.000 loss: -212.710]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.92it/s, atk: -209.986 ent: -2.725 str: 0.000 loss: -212.710]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([419], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([605], device='cuda:0') tensor(5.2384e-10, device='cuda:0')
L1: [1866.9883]	L2: [14.599433]	Linf: [0.7607843]

Accuracy on benign examples: 100.0%
gt_label: 759 pred_label: 759 pred_clean_logit 0.9964136481285095
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 26.79it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 22.87it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.48it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.20it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.44it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 23.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.37it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.06it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.04it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.05s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.16s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.16s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5176
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.027 ent: -5.243 str: 0.000 loss: -5.270]Iterations:   3%|▎         | 1/30 [00:00<00:18,  1.53it/s, atk: -0.027 ent: -5.243 str: 0.000 loss: -5.270]Iterations:   3%|▎         | 1/30 [00:00<00:18,  1.53it/s, atk: -0.060 ent: -5.241 str: 0.000 loss: -5.301]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.81it/s, atk: -0.060 ent: -5.241 str: 0.000 loss: -5.301]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.81it/s, atk: -0.136 ent: -5.263 str: 0.000 loss: -5.399]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.91it/s, atk: -0.136 ent: -5.263 str: 0.000 loss: -5.399]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.91it/s, atk: -0.215 ent: -5.281 str: 0.000 loss: -5.496]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.96it/s, atk: -0.215 ent: -5.281 str: 0.000 loss: -5.496]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.96it/s, atk: -0.217 ent: -5.304 str: 0.000 loss: -5.521]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -0.217 ent: -5.304 str: 0.000 loss: -5.521]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -0.288 ent: -5.325 str: 0.000 loss: -5.613]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.93it/s, atk: -0.288 ent: -5.325 str: 0.000 loss: -5.613]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.93it/s, atk: -0.436 ent: -5.329 str: 0.000 loss: -5.765]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.97it/s, atk: -0.436 ent: -5.329 str: 0.000 loss: -5.765]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.97it/s, atk: -0.567 ent: -5.332 str: 0.000 loss: -5.899]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.98it/s, atk: -0.567 ent: -5.332 str: 0.000 loss: -5.899]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.98it/s, atk: -0.749 ent: -5.335 str: 0.000 loss: -6.084]Iterations:  30%|███       | 9/30 [00:04<00:10,  2.00it/s, atk: -0.749 ent: -5.335 str: 0.000 loss: -6.084]Iterations:  30%|███       | 9/30 [00:04<00:10,  2.00it/s, atk: -0.990 ent: -5.337 str: 0.000 loss: -6.327]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -0.990 ent: -5.337 str: 0.000 loss: -6.327]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -1.250 ent: -5.338 str: 0.000 loss: -6.588]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.02it/s, atk: -1.250 ent: -5.338 str: 0.000 loss: -6.588]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.02it/s, atk: -1.506 ent: -5.337 str: 0.000 loss: -6.843]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.02it/s, atk: -1.506 ent: -5.337 str: 0.000 loss: -6.843]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.02it/s, atk: -1.740 ent: -5.338 str: 0.000 loss: -7.078]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.02it/s, atk: -1.740 ent: -5.338 str: 0.000 loss: -7.078]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.02it/s, atk: -1.961 ent: -5.336 str: 0.000 loss: -7.297]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.03it/s, atk: -1.961 ent: -5.336 str: 0.000 loss: -7.297]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.03it/s, atk: -2.356 ent: -5.335 str: 0.000 loss: -7.691]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.03it/s, atk: -2.356 ent: -5.335 str: 0.000 loss: -7.691]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.03it/s, atk: -2.792 ent: -5.334 str: 0.000 loss: -8.126]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.03it/s, atk: -2.792 ent: -5.334 str: 0.000 loss: -8.126]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.03it/s, atk: -3.408 ent: -5.336 str: 0.000 loss: -8.744]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.03it/s, atk: -3.408 ent: -5.336 str: 0.000 loss: -8.744]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.03it/s, atk: -3.960 ent: -5.338 str: 0.000 loss: -9.299]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.02it/s, atk: -3.960 ent: -5.338 str: 0.000 loss: -9.299]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.02it/s, atk: -4.428 ent: -5.340 str: 0.000 loss: -9.768]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.03it/s, atk: -4.428 ent: -5.340 str: 0.000 loss: -9.768]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.03it/s, atk: -4.870 ent: -5.341 str: 0.000 loss: -10.211]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.02it/s, atk: -4.870 ent: -5.341 str: 0.000 loss: -10.211]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.02it/s, atk: -6.114 ent: -5.333 str: 0.000 loss: -11.447]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.03it/s, atk: -6.114 ent: -5.333 str: 0.000 loss: -11.447]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.03it/s, atk: -7.060 ent: -5.326 str: 0.000 loss: -12.386]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.03it/s, atk: -7.060 ent: -5.326 str: 0.000 loss: -12.386]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.03it/s, atk: -7.962 ent: -5.322 str: 0.000 loss: -13.283]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.03it/s, atk: -7.962 ent: -5.322 str: 0.000 loss: -13.283]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.03it/s, atk: -8.642 ent: -5.319 str: 0.000 loss: -13.961]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.02it/s, atk: -8.642 ent: -5.319 str: 0.000 loss: -13.961]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.02it/s, atk: -10.200 ent: -5.317 str: 0.000 loss: -15.517]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.00it/s, atk: -10.200 ent: -5.317 str: 0.000 loss: -15.517]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.00it/s, atk: -11.066 ent: -5.317 str: 0.000 loss: -16.382]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.00it/s, atk: -11.066 ent: -5.317 str: 0.000 loss: -16.382]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.00it/s, atk: -12.472 ent: -5.315 str: 0.000 loss: -17.787]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.99it/s, atk: -12.472 ent: -5.315 str: 0.000 loss: -17.787]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.99it/s, atk: -13.198 ent: -5.313 str: 0.000 loss: -18.511]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -13.198 ent: -5.313 str: 0.000 loss: -18.511]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -14.823 ent: -5.312 str: 0.000 loss: -20.135]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.85it/s, atk: -14.823 ent: -5.312 str: 0.000 loss: -20.135]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.85it/s, atk: -16.253 ent: -5.311 str: 0.000 loss: -21.563]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.91it/s, atk: -16.253 ent: -5.311 str: 0.000 loss: -21.563]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -16.253 ent: -5.311 str: 0.000 loss: -21.563]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([622], device='cuda:0') tensor(0.7915, device='cuda:0')
after_true: tensor([759], device='cuda:0') tensor(0.1914, device='cuda:0')
L1: [3034.1802]	L2: [22.90451]	Linf: [0.8039216]

Accuracy on benign examples: 100.0%
gt_label: 982 pred_label: 982 pred_clean_logit 0.8840263485908508
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:05,  3.32it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.33it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.02it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.30it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 20.94it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 21.83it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 23.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.63it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.04it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.02it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.07s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.18s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.31s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.21s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4388
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -4.153 ent: -2.581 str: 0.000 loss: -6.735]Iterations:   3%|▎         | 1/30 [00:00<00:23,  1.24it/s, atk: -4.153 ent: -2.581 str: 0.000 loss: -6.735]Iterations:   3%|▎         | 1/30 [00:01<00:23,  1.24it/s, atk: -11.511 ent: -2.553 str: 0.000 loss: -14.065]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.61it/s, atk: -11.511 ent: -2.553 str: 0.000 loss: -14.065]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.61it/s, atk: -18.958 ent: -2.553 str: 0.000 loss: -21.511]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.69it/s, atk: -18.958 ent: -2.553 str: 0.000 loss: -21.511]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.69it/s, atk: -28.833 ent: -2.552 str: 0.000 loss: -31.385]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.81it/s, atk: -28.833 ent: -2.552 str: 0.000 loss: -31.385]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.81it/s, atk: -38.796 ent: -2.549 str: 0.000 loss: -41.344]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.85it/s, atk: -38.796 ent: -2.549 str: 0.000 loss: -41.344]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.85it/s, atk: -46.840 ent: -2.548 str: 0.000 loss: -49.388]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.79it/s, atk: -46.840 ent: -2.548 str: 0.000 loss: -49.388]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.79it/s, atk: -55.847 ent: -2.547 str: 0.000 loss: -58.393]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.86it/s, atk: -55.847 ent: -2.547 str: 0.000 loss: -58.393]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -63.140 ent: -2.545 str: 0.000 loss: -65.685]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.90it/s, atk: -63.140 ent: -2.545 str: 0.000 loss: -65.685]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.90it/s, atk: -69.555 ent: -2.544 str: 0.000 loss: -72.098]Iterations:  30%|███       | 9/30 [00:04<00:11,  1.90it/s, atk: -69.555 ent: -2.544 str: 0.000 loss: -72.098]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -77.609 ent: -2.542 str: 0.000 loss: -80.151]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -77.609 ent: -2.542 str: 0.000 loss: -80.151]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -85.452 ent: -2.541 str: 0.000 loss: -87.992]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.96it/s, atk: -85.452 ent: -2.541 str: 0.000 loss: -87.992]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -93.312 ent: -2.539 str: 0.000 loss: -95.851]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -93.312 ent: -2.539 str: 0.000 loss: -95.851]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -101.026 ent: -2.538 str: 0.000 loss: -103.564]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.96it/s, atk: -101.026 ent: -2.538 str: 0.000 loss: -103.564]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.96it/s, atk: -108.752 ent: -2.536 str: 0.000 loss: -111.287]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -108.752 ent: -2.536 str: 0.000 loss: -111.287]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -116.339 ent: -2.534 str: 0.000 loss: -118.873]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -116.339 ent: -2.534 str: 0.000 loss: -118.873]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -123.927 ent: -2.533 str: 0.000 loss: -126.460]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.95it/s, atk: -123.927 ent: -2.533 str: 0.000 loss: -126.460]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.95it/s, atk: -132.974 ent: -2.533 str: 0.000 loss: -135.507]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -132.974 ent: -2.533 str: 0.000 loss: -135.507]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -140.214 ent: -2.533 str: 0.000 loss: -142.747]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -140.214 ent: -2.533 str: 0.000 loss: -142.747]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -147.987 ent: -2.531 str: 0.000 loss: -150.519]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -147.987 ent: -2.531 str: 0.000 loss: -150.519]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -154.469 ent: -2.530 str: 0.000 loss: -156.999]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -154.469 ent: -2.530 str: 0.000 loss: -156.999]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -160.365 ent: -2.531 str: 0.000 loss: -162.896]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -160.365 ent: -2.531 str: 0.000 loss: -162.896]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -165.505 ent: -2.530 str: 0.000 loss: -168.035]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -165.505 ent: -2.530 str: 0.000 loss: -168.035]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -171.196 ent: -2.529 str: 0.000 loss: -173.725]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -171.196 ent: -2.529 str: 0.000 loss: -173.725]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -176.661 ent: -2.529 str: 0.000 loss: -179.190]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -176.661 ent: -2.529 str: 0.000 loss: -179.190]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -181.362 ent: -2.529 str: 0.000 loss: -183.891]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -181.362 ent: -2.529 str: 0.000 loss: -183.891]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -186.524 ent: -2.528 str: 0.000 loss: -189.052]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -186.524 ent: -2.528 str: 0.000 loss: -189.052]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -191.246 ent: -2.527 str: 0.000 loss: -193.773]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -191.246 ent: -2.527 str: 0.000 loss: -193.773]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -196.627 ent: -2.527 str: 0.000 loss: -199.154]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -196.627 ent: -2.527 str: 0.000 loss: -199.154]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -200.827 ent: -2.527 str: 0.000 loss: -203.354]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -200.827 ent: -2.527 str: 0.000 loss: -203.354]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -204.690 ent: -2.526 str: 0.000 loss: -207.216]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.00it/s, atk: -204.690 ent: -2.526 str: 0.000 loss: -207.216]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.93it/s, atk: -204.690 ent: -2.526 str: 0.000 loss: -207.216]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([414], device='cuda:0') tensor(0.9986, device='cuda:0')
after_true: tensor([982], device='cuda:0') tensor(8.3927e-10, device='cuda:0')
L1: [2535.298]	L2: [17.469498]	Linf: [0.6117647]

Accuracy on benign examples: 100.0%
gt_label: 483 pred_label: 483 pred_clean_logit 0.9729788303375244
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.67it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 22.39it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.77it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.07it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.18it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.87it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.49it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.93s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.35s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.24s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.33s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.36s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.37s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4947
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.235 ent: -2.553 str: 0.000 loss: -2.788]Iterations:   3%|▎         | 1/30 [00:00<00:16,  1.76it/s, atk: -0.235 ent: -2.553 str: 0.000 loss: -2.788]Iterations:   3%|▎         | 1/30 [00:00<00:16,  1.76it/s, atk: -0.524 ent: -2.546 str: 0.000 loss: -3.070]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.85it/s, atk: -0.524 ent: -2.546 str: 0.000 loss: -3.070]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.85it/s, atk: -1.321 ent: -2.539 str: 0.000 loss: -3.860]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.92it/s, atk: -1.321 ent: -2.539 str: 0.000 loss: -3.860]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.92it/s, atk: -2.197 ent: -2.534 str: 0.000 loss: -4.732]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.91it/s, atk: -2.197 ent: -2.534 str: 0.000 loss: -4.732]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.91it/s, atk: -3.103 ent: -2.531 str: 0.000 loss: -5.634]Iterations:  17%|█▋        | 5/30 [00:02<00:14,  1.71it/s, atk: -3.103 ent: -2.531 str: 0.000 loss: -5.634]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.71it/s, atk: -4.214 ent: -2.531 str: 0.000 loss: -6.746]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.80it/s, atk: -4.214 ent: -2.531 str: 0.000 loss: -6.746]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.80it/s, atk: -8.521 ent: -2.531 str: 0.000 loss: -11.052]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.86it/s, atk: -8.521 ent: -2.531 str: 0.000 loss: -11.052]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -11.391 ent: -2.528 str: 0.000 loss: -13.920]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.92it/s, atk: -11.391 ent: -2.528 str: 0.000 loss: -13.920]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.92it/s, atk: -14.411 ent: -2.529 str: 0.000 loss: -16.940]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.95it/s, atk: -14.411 ent: -2.529 str: 0.000 loss: -16.940]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.95it/s, atk: -20.662 ent: -2.529 str: 0.000 loss: -23.190]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.97it/s, atk: -20.662 ent: -2.529 str: 0.000 loss: -23.190]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.97it/s, atk: -27.874 ent: -2.528 str: 0.000 loss: -30.402]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.93it/s, atk: -27.874 ent: -2.528 str: 0.000 loss: -30.402]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -33.837 ent: -2.526 str: 0.000 loss: -36.363]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -33.837 ent: -2.526 str: 0.000 loss: -36.363]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -39.709 ent: -2.525 str: 0.000 loss: -42.234]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.97it/s, atk: -39.709 ent: -2.525 str: 0.000 loss: -42.234]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -48.292 ent: -2.523 str: 0.000 loss: -50.815]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.91it/s, atk: -48.292 ent: -2.523 str: 0.000 loss: -50.815]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.91it/s, atk: -52.953 ent: -2.523 str: 0.000 loss: -55.476]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.93it/s, atk: -52.953 ent: -2.523 str: 0.000 loss: -55.476]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -60.906 ent: -2.523 str: 0.000 loss: -63.429]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.91it/s, atk: -60.906 ent: -2.523 str: 0.000 loss: -63.429]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.91it/s, atk: -70.016 ent: -2.519 str: 0.000 loss: -72.535]Iterations:  57%|█████▋    | 17/30 [00:09<00:07,  1.70it/s, atk: -70.016 ent: -2.519 str: 0.000 loss: -72.535]Iterations:  57%|█████▋    | 17/30 [00:09<00:07,  1.70it/s, atk: -73.590 ent: -2.515 str: 0.000 loss: -76.105]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.79it/s, atk: -73.590 ent: -2.515 str: 0.000 loss: -76.105]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.79it/s, atk: -79.193 ent: -2.512 str: 0.000 loss: -81.705]Iterations:  63%|██████▎   | 19/30 [00:10<00:06,  1.83it/s, atk: -79.193 ent: -2.512 str: 0.000 loss: -81.705]Iterations:  63%|██████▎   | 19/30 [00:10<00:06,  1.83it/s, atk: -86.035 ent: -2.512 str: 0.000 loss: -88.547]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.86it/s, atk: -86.035 ent: -2.512 str: 0.000 loss: -88.547]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.86it/s, atk: -93.087 ent: -2.513 str: 0.000 loss: -95.600]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.91it/s, atk: -93.087 ent: -2.513 str: 0.000 loss: -95.600]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.91it/s, atk: -98.822 ent: -2.515 str: 0.000 loss: -101.337]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.90it/s, atk: -98.822 ent: -2.515 str: 0.000 loss: -101.337]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.90it/s, atk: -105.867 ent: -2.517 str: 0.000 loss: -108.384]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -105.867 ent: -2.517 str: 0.000 loss: -108.384]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -113.413 ent: -2.516 str: 0.000 loss: -115.930]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.92it/s, atk: -113.413 ent: -2.516 str: 0.000 loss: -115.930]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.92it/s, atk: -117.236 ent: -2.516 str: 0.000 loss: -119.752]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.96it/s, atk: -117.236 ent: -2.516 str: 0.000 loss: -119.752]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.96it/s, atk: -122.505 ent: -2.514 str: 0.000 loss: -125.020]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -122.505 ent: -2.514 str: 0.000 loss: -125.020]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.95it/s, atk: -127.049 ent: -2.513 str: 0.000 loss: -129.562]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -127.049 ent: -2.513 str: 0.000 loss: -129.562]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -131.970 ent: -2.513 str: 0.000 loss: -134.482]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.97it/s, atk: -131.970 ent: -2.513 str: 0.000 loss: -134.482]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.97it/s, atk: -136.433 ent: -2.512 str: 0.000 loss: -138.945]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -136.433 ent: -2.512 str: 0.000 loss: -138.945]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -140.837 ent: -2.511 str: 0.000 loss: -143.348]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.91it/s, atk: -140.837 ent: -2.511 str: 0.000 loss: -143.348]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -140.837 ent: -2.511 str: 0.000 loss: -143.348]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([649], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([483], device='cuda:0') tensor(4.9506e-07, device='cuda:0')
L1: [3443.702]	L2: [22.583006]	Linf: [0.77254903]

Accuracy on benign examples: 100.0%
gt_label: 733 pred_label: 733 pred_clean_logit 0.9869242906570435
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.94it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.45it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.69it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.63it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.55it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.52it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.69it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.10s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.07s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.09s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.35s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.25s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3244
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.116 ent: -2.905 str: 0.000 loss: -3.020]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.08it/s, atk: -0.116 ent: -2.905 str: 0.000 loss: -3.020]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.08it/s, atk: -0.294 ent: -2.902 str: 0.000 loss: -3.195]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.47it/s, atk: -0.294 ent: -2.902 str: 0.000 loss: -3.195]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.47it/s, atk: -0.427 ent: -2.898 str: 0.000 loss: -3.325]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.63it/s, atk: -0.427 ent: -2.898 str: 0.000 loss: -3.325]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.63it/s, atk: -0.708 ent: -2.897 str: 0.000 loss: -3.605]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.73it/s, atk: -0.708 ent: -2.897 str: 0.000 loss: -3.605]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.73it/s, atk: -1.099 ent: -2.893 str: 0.000 loss: -3.992]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.82it/s, atk: -1.099 ent: -2.893 str: 0.000 loss: -3.992]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.82it/s, atk: -1.779 ent: -2.891 str: 0.000 loss: -4.670]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.82it/s, atk: -1.779 ent: -2.891 str: 0.000 loss: -4.670]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.82it/s, atk: -2.948 ent: -2.889 str: 0.000 loss: -5.837]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.74it/s, atk: -2.948 ent: -2.889 str: 0.000 loss: -5.837]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.74it/s, atk: -4.453 ent: -2.887 str: 0.000 loss: -7.340]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.81it/s, atk: -4.453 ent: -2.887 str: 0.000 loss: -7.340]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.81it/s, atk: -6.464 ent: -2.885 str: 0.000 loss: -9.349]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.87it/s, atk: -6.464 ent: -2.885 str: 0.000 loss: -9.349]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.87it/s, atk: -8.539 ent: -2.883 str: 0.000 loss: -11.421]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.85it/s, atk: -8.539 ent: -2.883 str: 0.000 loss: -11.421]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.85it/s, atk: -11.396 ent: -2.879 str: 0.000 loss: -14.275]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.90it/s, atk: -11.396 ent: -2.879 str: 0.000 loss: -14.275]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.90it/s, atk: -13.034 ent: -2.879 str: 0.000 loss: -15.914]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.92it/s, atk: -13.034 ent: -2.879 str: 0.000 loss: -15.914]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.92it/s, atk: -15.415 ent: -2.878 str: 0.000 loss: -18.294]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.85it/s, atk: -15.415 ent: -2.878 str: 0.000 loss: -18.294]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.85it/s, atk: -18.089 ent: -2.876 str: 0.000 loss: -20.964]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.92it/s, atk: -18.089 ent: -2.876 str: 0.000 loss: -20.964]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.92it/s, atk: -21.178 ent: -2.873 str: 0.000 loss: -24.051]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.92it/s, atk: -21.178 ent: -2.873 str: 0.000 loss: -24.051]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.92it/s, atk: -24.185 ent: -2.874 str: 0.000 loss: -27.059]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.90it/s, atk: -24.185 ent: -2.874 str: 0.000 loss: -27.059]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.90it/s, atk: -27.615 ent: -2.875 str: 0.000 loss: -30.490]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -27.615 ent: -2.875 str: 0.000 loss: -30.490]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -30.809 ent: -2.876 str: 0.000 loss: -33.685]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -30.809 ent: -2.876 str: 0.000 loss: -33.685]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.94it/s, atk: -34.036 ent: -2.877 str: 0.000 loss: -36.913]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -34.036 ent: -2.877 str: 0.000 loss: -36.913]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -37.758 ent: -2.876 str: 0.000 loss: -40.634]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.94it/s, atk: -37.758 ent: -2.876 str: 0.000 loss: -40.634]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.94it/s, atk: -40.883 ent: -2.875 str: 0.000 loss: -43.758]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.81it/s, atk: -40.883 ent: -2.875 str: 0.000 loss: -43.758]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.81it/s, atk: -43.252 ent: -2.874 str: 0.000 loss: -46.126]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.87it/s, atk: -43.252 ent: -2.874 str: 0.000 loss: -46.126]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.87it/s, atk: -46.594 ent: -2.871 str: 0.000 loss: -49.465]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.89it/s, atk: -46.594 ent: -2.871 str: 0.000 loss: -49.465]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.89it/s, atk: -50.042 ent: -2.867 str: 0.000 loss: -52.909]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.90it/s, atk: -50.042 ent: -2.867 str: 0.000 loss: -52.909]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.90it/s, atk: -45.621 ent: -2.857 str: 0.000 loss: -48.478]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.92it/s, atk: -45.621 ent: -2.857 str: 0.000 loss: -48.478]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.92it/s, atk: -54.846 ent: -2.865 str: 0.000 loss: -57.711]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.94it/s, atk: -54.846 ent: -2.865 str: 0.000 loss: -57.711]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.94it/s, atk: -56.536 ent: -2.864 str: 0.000 loss: -59.400]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.93it/s, atk: -56.536 ent: -2.864 str: 0.000 loss: -59.400]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.93it/s, atk: -59.336 ent: -2.863 str: 0.000 loss: -62.199]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.94it/s, atk: -59.336 ent: -2.863 str: 0.000 loss: -62.199]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.94it/s, atk: -61.515 ent: -2.861 str: 0.000 loss: -64.377]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.79it/s, atk: -61.515 ent: -2.861 str: 0.000 loss: -64.377]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.79it/s, atk: -63.212 ent: -2.861 str: 0.000 loss: -66.073]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.50it/s, atk: -63.212 ent: -2.861 str: 0.000 loss: -66.073]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.80it/s, atk: -63.212 ent: -2.861 str: 0.000 loss: -66.073]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([829], device='cuda:0') tensor(0.6729, device='cuda:0')
after_true: tensor([733], device='cuda:0') tensor(0.0014, device='cuda:0')
L1: [3088.7097]	L2: [22.594393]	Linf: [0.8039216]

Accuracy on benign examples: 100.0%
gt_label: 560 pred_label: 560 pred_clean_logit 0.9729340076446533
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.60it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.52it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.88it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.67it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.19it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.31it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.25it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.24it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.24it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.82s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:04,  2.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.48s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.27s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4735
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.605 ent: -5.402 str: 0.000 loss: -6.007]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.12s/it, atk: -0.605 ent: -5.402 str: 0.000 loss: -6.007]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.12s/it, atk: -2.890 ent: -5.393 str: 0.000 loss: -8.283]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.50s/it, atk: -2.890 ent: -5.393 str: 0.000 loss: -8.283]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.50s/it, atk: -11.140 ent: -5.370 str: 0.000 loss: -16.510]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.30s/it, atk: -11.140 ent: -5.370 str: 0.000 loss: -16.510]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.30s/it, atk: -23.674 ent: -5.375 str: 0.000 loss: -29.049]Iterations:  13%|█▎        | 4/30 [00:05<00:31,  1.21s/it, atk: -23.674 ent: -5.375 str: 0.000 loss: -29.049]Iterations:  13%|█▎        | 4/30 [00:05<00:31,  1.21s/it, atk: -36.881 ent: -5.375 str: 0.000 loss: -42.256]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.16s/it, atk: -36.881 ent: -5.375 str: 0.000 loss: -42.256]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.16s/it, atk: -46.366 ent: -5.380 str: 0.000 loss: -51.746]Iterations:  20%|██        | 6/30 [00:07<00:27,  1.13s/it, atk: -46.366 ent: -5.380 str: 0.000 loss: -51.746]Iterations:  20%|██        | 6/30 [00:08<00:27,  1.13s/it, atk: -51.730 ent: -5.380 str: 0.000 loss: -57.110]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.11s/it, atk: -51.730 ent: -5.380 str: 0.000 loss: -57.110]Iterations:  23%|██▎       | 7/30 [00:09<00:25,  1.11s/it, atk: -57.328 ent: -5.412 str: 0.000 loss: -62.740]Iterations:  27%|██▋       | 8/30 [00:09<00:24,  1.09s/it, atk: -57.328 ent: -5.412 str: 0.000 loss: -62.740]Iterations:  27%|██▋       | 8/30 [00:10<00:24,  1.09s/it, atk: -69.645 ent: -5.409 str: 0.000 loss: -75.053]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.09s/it, atk: -69.645 ent: -5.409 str: 0.000 loss: -75.053]Iterations:  30%|███       | 9/30 [00:11<00:22,  1.09s/it, atk: -73.089 ent: -5.395 str: 0.000 loss: -78.484]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.09s/it, atk: -73.089 ent: -5.395 str: 0.000 loss: -78.484]Iterations:  33%|███▎      | 10/30 [00:12<00:21,  1.09s/it, atk: -82.466 ent: -5.394 str: 0.000 loss: -87.860]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.08s/it, atk: -82.466 ent: -5.394 str: 0.000 loss: -87.860]Iterations:  37%|███▋      | 11/30 [00:13<00:20,  1.08s/it, atk: -91.384 ent: -5.388 str: 0.000 loss: -96.773]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.08s/it, atk: -91.384 ent: -5.388 str: 0.000 loss: -96.773]Iterations:  40%|████      | 12/30 [00:14<00:19,  1.08s/it, atk: -96.862 ent: -5.380 str: 0.000 loss: -102.242]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.07s/it, atk: -96.862 ent: -5.380 str: 0.000 loss: -102.242]Iterations:  43%|████▎     | 13/30 [00:15<00:18,  1.07s/it, atk: -98.131 ent: -5.382 str: 0.000 loss: -103.514]Iterations:  47%|████▋     | 14/30 [00:16<00:17,  1.07s/it, atk: -98.131 ent: -5.382 str: 0.000 loss: -103.514]Iterations:  47%|████▋     | 14/30 [00:16<00:17,  1.07s/it, atk: -101.469 ent: -5.389 str: 0.000 loss: -106.858]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.07s/it, atk: -101.469 ent: -5.389 str: 0.000 loss: -106.858]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.07s/it, atk: -101.299 ent: -5.388 str: 0.000 loss: -106.687]Iterations:  53%|█████▎    | 16/30 [00:18<00:14,  1.07s/it, atk: -101.299 ent: -5.388 str: 0.000 loss: -106.687]Iterations:  53%|█████▎    | 16/30 [00:18<00:14,  1.07s/it, atk: -107.091 ent: -5.386 str: 0.000 loss: -112.477]Iterations:  57%|█████▋    | 17/30 [00:19<00:13,  1.07s/it, atk: -107.091 ent: -5.386 str: 0.000 loss: -112.477]Iterations:  57%|█████▋    | 17/30 [00:19<00:13,  1.07s/it, atk: -110.426 ent: -5.386 str: 0.000 loss: -115.812]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.07s/it, atk: -110.426 ent: -5.386 str: 0.000 loss: -115.812]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.07s/it, atk: -115.830 ent: -5.384 str: 0.000 loss: -121.215]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -115.830 ent: -5.384 str: 0.000 loss: -121.215]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -121.788 ent: -5.381 str: 0.000 loss: -127.169]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.07s/it, atk: -121.788 ent: -5.381 str: 0.000 loss: -127.169]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.07s/it, atk: -124.665 ent: -5.385 str: 0.000 loss: -130.050]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.07s/it, atk: -124.665 ent: -5.385 str: 0.000 loss: -130.050]Iterations:  70%|███████   | 21/30 [00:24<00:09,  1.07s/it, atk: -128.392 ent: -5.385 str: 0.000 loss: -133.777]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -128.392 ent: -5.385 str: 0.000 loss: -133.777]Iterations:  73%|███████▎  | 22/30 [00:25<00:08,  1.07s/it, atk: -134.369 ent: -5.381 str: 0.000 loss: -139.751]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -134.369 ent: -5.381 str: 0.000 loss: -139.751]Iterations:  77%|███████▋  | 23/30 [00:26<00:07,  1.07s/it, atk: -140.962 ent: -5.378 str: 0.000 loss: -146.340]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -140.962 ent: -5.378 str: 0.000 loss: -146.340]Iterations:  80%|████████  | 24/30 [00:27<00:06,  1.07s/it, atk: -147.468 ent: -5.376 str: 0.000 loss: -152.844]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.07s/it, atk: -147.468 ent: -5.376 str: 0.000 loss: -152.844]Iterations:  83%|████████▎ | 25/30 [00:28<00:05,  1.07s/it, atk: -152.020 ent: -5.374 str: 0.000 loss: -157.395]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.07s/it, atk: -152.020 ent: -5.374 str: 0.000 loss: -157.395]Iterations:  87%|████████▋ | 26/30 [00:29<00:04,  1.07s/it, atk: -156.383 ent: -5.370 str: 0.000 loss: -161.752]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.07s/it, atk: -156.383 ent: -5.370 str: 0.000 loss: -161.752]Iterations:  90%|█████████ | 27/30 [00:30<00:03,  1.07s/it, atk: -163.732 ent: -5.374 str: 0.000 loss: -169.105]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.07s/it, atk: -163.732 ent: -5.374 str: 0.000 loss: -169.105]Iterations:  93%|█████████▎| 28/30 [00:31<00:02,  1.07s/it, atk: -169.153 ent: -5.374 str: 0.000 loss: -174.528]Iterations:  97%|█████████▋| 29/30 [00:32<00:01,  1.07s/it, atk: -169.153 ent: -5.374 str: 0.000 loss: -174.528]Iterations:  97%|█████████▋| 29/30 [00:32<00:01,  1.07s/it, atk: -175.213 ent: -5.378 str: 0.000 loss: -180.591]Iterations: 100%|██████████| 30/30 [00:33<00:00,  1.07s/it, atk: -175.213 ent: -5.378 str: 0.000 loss: -180.591]Iterations: 100%|██████████| 30/30 [00:33<00:00,  1.10s/it, atk: -175.213 ent: -5.378 str: 0.000 loss: -180.591]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([746], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([560], device='cuda:0') tensor(2.4766e-08, device='cuda:0')
L1: [4055.4316]	L2: [29.766005]	Linf: [0.9490196]

Accuracy on benign examples: 100.0%
gt_label: 483 pred_label: 483 pred_clean_logit 0.9668422937393188
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.10it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.17it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.63it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.82it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 22.30it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 23.88it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.81it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.85it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.22it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.15it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.05it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.08s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.10s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5940
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.144 ent: -2.597 str: 0.000 loss: -2.740]Iterations:   3%|▎         | 1/30 [00:01<00:54,  1.88s/it, atk: -0.144 ent: -2.597 str: 0.000 loss: -2.740]Iterations:   3%|▎         | 1/30 [00:02<00:54,  1.88s/it, atk: -0.657 ent: -2.608 str: 0.000 loss: -3.265]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -0.657 ent: -2.608 str: 0.000 loss: -3.265]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -0.889 ent: -2.593 str: 0.000 loss: -3.482]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.23it/s, atk: -0.889 ent: -2.593 str: 0.000 loss: -3.482]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.23it/s, atk: -2.037 ent: -2.582 str: 0.000 loss: -4.619]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -2.037 ent: -2.582 str: 0.000 loss: -4.619]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -5.148 ent: -2.583 str: 0.000 loss: -7.732]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.59it/s, atk: -5.148 ent: -2.583 str: 0.000 loss: -7.732]Iterations:  17%|█▋        | 5/30 [00:04<00:15,  1.59it/s, atk: -8.638 ent: -2.581 str: 0.000 loss: -11.219]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.71it/s, atk: -8.638 ent: -2.581 str: 0.000 loss: -11.219]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.71it/s, atk: -14.871 ent: -2.585 str: 0.000 loss: -17.456]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.75it/s, atk: -14.871 ent: -2.585 str: 0.000 loss: -17.456]Iterations:  23%|██▎       | 7/30 [00:05<00:13,  1.75it/s, atk: -23.353 ent: -2.584 str: 0.000 loss: -25.937]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.83it/s, atk: -23.353 ent: -2.584 str: 0.000 loss: -25.937]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.83it/s, atk: -31.304 ent: -2.585 str: 0.000 loss: -33.889]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.86it/s, atk: -31.304 ent: -2.585 str: 0.000 loss: -33.889]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.86it/s, atk: -36.083 ent: -2.588 str: 0.000 loss: -38.671]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.91it/s, atk: -36.083 ent: -2.588 str: 0.000 loss: -38.671]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.91it/s, atk: -43.957 ent: -2.584 str: 0.000 loss: -46.541]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -43.957 ent: -2.584 str: 0.000 loss: -46.541]Iterations:  37%|███▋      | 11/30 [00:07<00:09,  1.94it/s, atk: -51.531 ent: -2.582 str: 0.000 loss: -54.112]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.95it/s, atk: -51.531 ent: -2.582 str: 0.000 loss: -54.112]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.95it/s, atk: -58.519 ent: -2.582 str: 0.000 loss: -61.100]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.89it/s, atk: -58.519 ent: -2.582 str: 0.000 loss: -61.100]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.89it/s, atk: -62.223 ent: -2.583 str: 0.000 loss: -64.806]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -62.223 ent: -2.583 str: 0.000 loss: -64.806]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -68.141 ent: -2.584 str: 0.000 loss: -70.724]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.97it/s, atk: -68.141 ent: -2.584 str: 0.000 loss: -70.724]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.97it/s, atk: -72.730 ent: -2.583 str: 0.000 loss: -75.313]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -72.730 ent: -2.583 str: 0.000 loss: -75.313]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -79.439 ent: -2.582 str: 0.000 loss: -82.021]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.00it/s, atk: -79.439 ent: -2.582 str: 0.000 loss: -82.021]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  2.00it/s, atk: -83.551 ent: -2.582 str: 0.000 loss: -86.133]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.01it/s, atk: -83.551 ent: -2.582 str: 0.000 loss: -86.133]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.01it/s, atk: -89.557 ent: -2.581 str: 0.000 loss: -92.139]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -89.557 ent: -2.581 str: 0.000 loss: -92.139]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.00it/s, atk: -93.438 ent: -2.579 str: 0.000 loss: -96.017]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.99it/s, atk: -93.438 ent: -2.579 str: 0.000 loss: -96.017]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.99it/s, atk: -99.229 ent: -2.578 str: 0.000 loss: -101.807]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.87it/s, atk: -99.229 ent: -2.578 str: 0.000 loss: -101.807]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.87it/s, atk: -105.167 ent: -2.576 str: 0.000 loss: -107.744]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.93it/s, atk: -105.167 ent: -2.576 str: 0.000 loss: -107.744]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.93it/s, atk: -111.325 ent: -2.575 str: 0.000 loss: -113.900]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.82it/s, atk: -111.325 ent: -2.575 str: 0.000 loss: -113.900]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.82it/s, atk: -116.869 ent: -2.576 str: 0.000 loss: -119.444]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.87it/s, atk: -116.869 ent: -2.576 str: 0.000 loss: -119.444]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.87it/s, atk: -120.697 ent: -2.575 str: 0.000 loss: -123.273]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.90it/s, atk: -120.697 ent: -2.575 str: 0.000 loss: -123.273]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.90it/s, atk: -125.639 ent: -2.576 str: 0.000 loss: -128.215]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.95it/s, atk: -125.639 ent: -2.576 str: 0.000 loss: -128.215]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.95it/s, atk: -130.251 ent: -2.576 str: 0.000 loss: -132.827]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.98it/s, atk: -130.251 ent: -2.576 str: 0.000 loss: -132.827]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.98it/s, atk: -135.046 ent: -2.576 str: 0.000 loss: -137.621]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.97it/s, atk: -135.046 ent: -2.576 str: 0.000 loss: -137.621]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.97it/s, atk: -138.232 ent: -2.576 str: 0.000 loss: -140.808]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.96it/s, atk: -138.232 ent: -2.576 str: 0.000 loss: -140.808]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.96it/s, atk: -144.166 ent: -2.577 str: 0.000 loss: -146.743]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.96it/s, atk: -144.166 ent: -2.577 str: 0.000 loss: -146.743]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.79it/s, atk: -144.166 ent: -2.577 str: 0.000 loss: -146.743]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([873], device='cuda:0') tensor(0.9991, device='cuda:0')
after_true: tensor([483], device='cuda:0') tensor(3.8878e-07, device='cuda:0')
L1: [2615.5725]	L2: [18.941753]	Linf: [0.87058824]

Accuracy on benign examples: 100.0%
gt_label: 560 pred_label: 560 pred_clean_logit 0.6252910494804382
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.56it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 24.33it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.18it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.11it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.50it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.45it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.09it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.17s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.08s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.14s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.30s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.23s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4569
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -6.501 ent: -5.075 str: 0.000 loss: -11.577]Iterations:   3%|▎         | 1/30 [00:00<00:24,  1.16it/s, atk: -6.501 ent: -5.075 str: 0.000 loss: -11.577]Iterations:   3%|▎         | 1/30 [00:01<00:24,  1.16it/s, atk: -11.172 ent: -5.073 str: 0.000 loss: -16.245]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -11.172 ent: -5.073 str: 0.000 loss: -16.245]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -18.240 ent: -5.075 str: 0.000 loss: -23.315]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.70it/s, atk: -18.240 ent: -5.075 str: 0.000 loss: -23.315]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.70it/s, atk: -29.800 ent: -5.069 str: 0.000 loss: -34.869]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.82it/s, atk: -29.800 ent: -5.069 str: 0.000 loss: -34.869]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.82it/s, atk: -45.148 ent: -5.070 str: 0.000 loss: -50.217]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.88it/s, atk: -45.148 ent: -5.070 str: 0.000 loss: -50.217]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.88it/s, atk: -48.548 ent: -5.063 str: 0.000 loss: -53.611]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.88it/s, atk: -48.548 ent: -5.063 str: 0.000 loss: -53.611]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.88it/s, atk: -76.759 ent: -5.067 str: 0.000 loss: -81.827]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.90it/s, atk: -76.759 ent: -5.067 str: 0.000 loss: -81.827]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.90it/s, atk: -70.646 ent: -5.068 str: 0.000 loss: -75.715]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -70.646 ent: -5.068 str: 0.000 loss: -75.715]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -91.219 ent: -5.066 str: 0.000 loss: -96.285]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.95it/s, atk: -91.219 ent: -5.066 str: 0.000 loss: -96.285]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.95it/s, atk: -111.238 ent: -5.066 str: 0.000 loss: -116.304]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -111.238 ent: -5.066 str: 0.000 loss: -116.304]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -121.962 ent: -5.065 str: 0.000 loss: -127.027]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.91it/s, atk: -121.962 ent: -5.065 str: 0.000 loss: -127.027]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.91it/s, atk: -135.206 ent: -5.064 str: 0.000 loss: -140.270]Iterations:  40%|████      | 12/30 [00:06<00:10,  1.74it/s, atk: -135.206 ent: -5.064 str: 0.000 loss: -140.270]Iterations:  40%|████      | 12/30 [00:06<00:10,  1.74it/s, atk: -148.699 ent: -5.062 str: 0.000 loss: -153.761]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.81it/s, atk: -148.699 ent: -5.062 str: 0.000 loss: -153.761]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.81it/s, atk: -160.092 ent: -5.061 str: 0.000 loss: -165.153]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.87it/s, atk: -160.092 ent: -5.061 str: 0.000 loss: -165.153]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.87it/s, atk: -167.901 ent: -5.061 str: 0.000 loss: -172.962]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.89it/s, atk: -167.901 ent: -5.061 str: 0.000 loss: -172.962]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.89it/s, atk: -176.172 ent: -5.060 str: 0.000 loss: -181.232]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -176.172 ent: -5.060 str: 0.000 loss: -181.232]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -185.193 ent: -5.059 str: 0.000 loss: -190.253]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -185.193 ent: -5.059 str: 0.000 loss: -190.253]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -193.352 ent: -5.059 str: 0.000 loss: -198.411]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -193.352 ent: -5.059 str: 0.000 loss: -198.411]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.98it/s, atk: -201.504 ent: -5.058 str: 0.000 loss: -206.562]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -201.504 ent: -5.058 str: 0.000 loss: -206.562]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -208.626 ent: -5.058 str: 0.000 loss: -213.683]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -208.626 ent: -5.058 str: 0.000 loss: -213.683]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -214.318 ent: -5.057 str: 0.000 loss: -219.375]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -214.318 ent: -5.057 str: 0.000 loss: -219.375]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -220.477 ent: -5.056 str: 0.000 loss: -225.533]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -220.477 ent: -5.056 str: 0.000 loss: -225.533]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -227.457 ent: -5.055 str: 0.000 loss: -232.513]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.00it/s, atk: -227.457 ent: -5.055 str: 0.000 loss: -232.513]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.00it/s, atk: -234.708 ent: -5.054 str: 0.000 loss: -239.761]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.97it/s, atk: -234.708 ent: -5.054 str: 0.000 loss: -239.761]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.97it/s, atk: -241.622 ent: -5.053 str: 0.000 loss: -246.675]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.95it/s, atk: -241.622 ent: -5.053 str: 0.000 loss: -246.675]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.95it/s, atk: -245.227 ent: -5.053 str: 0.000 loss: -250.280]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.92it/s, atk: -245.227 ent: -5.053 str: 0.000 loss: -250.280]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.92it/s, atk: -252.219 ent: -5.052 str: 0.000 loss: -257.272]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.91it/s, atk: -252.219 ent: -5.052 str: 0.000 loss: -257.272]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.91it/s, atk: -257.166 ent: -5.052 str: 0.000 loss: -262.218]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.94it/s, atk: -257.166 ent: -5.052 str: 0.000 loss: -262.218]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.94it/s, atk: -261.347 ent: -5.052 str: 0.000 loss: -266.400]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -261.347 ent: -5.052 str: 0.000 loss: -266.400]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -266.755 ent: -5.052 str: 0.000 loss: -271.808]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.89it/s, atk: -266.755 ent: -5.052 str: 0.000 loss: -271.808]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.89it/s, atk: -266.755 ent: -5.052 str: 0.000 loss: -271.808]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([667], device='cuda:0') tensor(0.9260, device='cuda:0')
after_true: tensor([560], device='cuda:0') tensor(1.5023e-12, device='cuda:0')
L1: [5773.1963]	L2: [36.606228]	Linf: [0.85490197]

Accuracy on benign examples: 100.0%
gt_label: 565 pred_label: 565 pred_clean_logit 0.8437702059745789
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.60it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.48it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 21.08it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 23.06it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 24.06it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 25.40it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.92it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.64it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.22s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.27s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.36s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4627
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.931 ent: -4.854 str: 0.000 loss: -5.784]Iterations:   3%|▎         | 1/30 [00:00<00:17,  1.65it/s, atk: -0.931 ent: -4.854 str: 0.000 loss: -5.784]Iterations:   3%|▎         | 1/30 [00:00<00:17,  1.65it/s, atk: -3.239 ent: -4.849 str: 0.000 loss: -8.087]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.86it/s, atk: -3.239 ent: -4.849 str: 0.000 loss: -8.087]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.86it/s, atk: -9.182 ent: -4.840 str: 0.000 loss: -14.022]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.92it/s, atk: -9.182 ent: -4.840 str: 0.000 loss: -14.022]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.92it/s, atk: -16.686 ent: -4.836 str: 0.000 loss: -21.522]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.92it/s, atk: -16.686 ent: -4.836 str: 0.000 loss: -21.522]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.92it/s, atk: -20.828 ent: -4.835 str: 0.000 loss: -25.663]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -20.828 ent: -4.835 str: 0.000 loss: -25.663]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -26.026 ent: -4.832 str: 0.000 loss: -30.858]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.95it/s, atk: -26.026 ent: -4.832 str: 0.000 loss: -30.858]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.95it/s, atk: -29.387 ent: -4.830 str: 0.000 loss: -34.217]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.94it/s, atk: -29.387 ent: -4.830 str: 0.000 loss: -34.217]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.94it/s, atk: -33.645 ent: -4.830 str: 0.000 loss: -38.475]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -33.645 ent: -4.830 str: 0.000 loss: -38.475]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -38.902 ent: -4.829 str: 0.000 loss: -43.731]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.93it/s, atk: -38.902 ent: -4.829 str: 0.000 loss: -43.731]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.93it/s, atk: -43.801 ent: -4.827 str: 0.000 loss: -48.628]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -43.801 ent: -4.827 str: 0.000 loss: -48.628]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -48.292 ent: -4.828 str: 0.000 loss: -53.119]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -48.292 ent: -4.828 str: 0.000 loss: -53.119]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -52.422 ent: -4.827 str: 0.000 loss: -57.249]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.97it/s, atk: -52.422 ent: -4.827 str: 0.000 loss: -57.249]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.97it/s, atk: -56.408 ent: -4.826 str: 0.000 loss: -61.234]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.94it/s, atk: -56.408 ent: -4.826 str: 0.000 loss: -61.234]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -60.774 ent: -4.826 str: 0.000 loss: -65.600]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.88it/s, atk: -60.774 ent: -4.826 str: 0.000 loss: -65.600]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.88it/s, atk: -65.810 ent: -4.826 str: 0.000 loss: -70.636]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.91it/s, atk: -65.810 ent: -4.826 str: 0.000 loss: -70.636]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.91it/s, atk: -68.937 ent: -4.826 str: 0.000 loss: -73.764]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.89it/s, atk: -68.937 ent: -4.826 str: 0.000 loss: -73.764]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.89it/s, atk: -75.195 ent: -4.826 str: 0.000 loss: -80.022]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.92it/s, atk: -75.195 ent: -4.826 str: 0.000 loss: -80.022]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.92it/s, atk: -77.300 ent: -4.825 str: 0.000 loss: -82.125]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.93it/s, atk: -77.300 ent: -4.825 str: 0.000 loss: -82.125]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.93it/s, atk: -82.640 ent: -4.825 str: 0.000 loss: -87.465]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.94it/s, atk: -82.640 ent: -4.825 str: 0.000 loss: -87.465]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.94it/s, atk: -86.384 ent: -4.826 str: 0.000 loss: -91.210]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -86.384 ent: -4.826 str: 0.000 loss: -91.210]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -90.237 ent: -4.827 str: 0.000 loss: -95.064]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.95it/s, atk: -90.237 ent: -4.827 str: 0.000 loss: -95.064]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.95it/s, atk: -93.736 ent: -4.825 str: 0.000 loss: -98.561]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.94it/s, atk: -93.736 ent: -4.825 str: 0.000 loss: -98.561]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.94it/s, atk: -98.162 ent: -4.824 str: 0.000 loss: -102.986]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.94it/s, atk: -98.162 ent: -4.824 str: 0.000 loss: -102.986]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -101.499 ent: -4.824 str: 0.000 loss: -106.322]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.95it/s, atk: -101.499 ent: -4.824 str: 0.000 loss: -106.322]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.95it/s, atk: -104.441 ent: -4.823 str: 0.000 loss: -109.264]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.93it/s, atk: -104.441 ent: -4.823 str: 0.000 loss: -109.264]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -108.102 ent: -4.824 str: 0.000 loss: -112.927]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.94it/s, atk: -108.102 ent: -4.824 str: 0.000 loss: -112.927]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.94it/s, atk: -111.169 ent: -4.825 str: 0.000 loss: -115.994]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.90it/s, atk: -111.169 ent: -4.825 str: 0.000 loss: -115.994]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.90it/s, atk: -114.597 ent: -4.825 str: 0.000 loss: -119.421]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.87it/s, atk: -114.597 ent: -4.825 str: 0.000 loss: -119.421]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.87it/s, atk: -118.125 ent: -4.824 str: 0.000 loss: -122.950]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.84it/s, atk: -118.125 ent: -4.824 str: 0.000 loss: -122.950]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.84it/s, atk: -122.359 ent: -4.823 str: 0.000 loss: -127.182]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.88it/s, atk: -122.359 ent: -4.823 str: 0.000 loss: -127.182]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.92it/s, atk: -122.359 ent: -4.823 str: 0.000 loss: -127.182]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([829], device='cuda:0') tensor(0.9718, device='cuda:0')
after_true: tensor([565], device='cuda:0') tensor(3.5685e-06, device='cuda:0')
L1: [2745.0195]	L2: [17.94659]	Linf: [0.58431375]

Accuracy on benign examples: 100.0%
gt_label: 718 pred_label: 718 pred_clean_logit 0.9973540306091309
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.41it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.86it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.12it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.86it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.01it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.20it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.06s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.01it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.33s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  2.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.84s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4114
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.041 ent: -2.614 str: 0.000 loss: -2.654]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.73s/it, atk: -0.041 ent: -2.614 str: 0.000 loss: -2.654]Iterations:   3%|▎         | 1/30 [00:02<00:50,  1.73s/it, atk: -0.069 ent: -2.614 str: 0.000 loss: -2.682]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.35s/it, atk: -0.069 ent: -2.614 str: 0.000 loss: -2.682]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -0.097 ent: -2.629 str: 0.000 loss: -2.726]Iterations:  10%|█         | 3/30 [00:03<00:32,  1.22s/it, atk: -0.097 ent: -2.629 str: 0.000 loss: -2.726]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.22s/it, atk: -0.249 ent: -2.639 str: 0.000 loss: -2.888]Iterations:  13%|█▎        | 4/30 [00:04<00:30,  1.16s/it, atk: -0.249 ent: -2.639 str: 0.000 loss: -2.888]Iterations:  13%|█▎        | 4/30 [00:05<00:30,  1.16s/it, atk: -0.360 ent: -2.642 str: 0.000 loss: -3.003]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.14s/it, atk: -0.360 ent: -2.642 str: 0.000 loss: -3.003]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.14s/it, atk: -0.635 ent: -2.647 str: 0.000 loss: -3.282]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.12s/it, atk: -0.635 ent: -2.647 str: 0.000 loss: -3.282]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.12s/it, atk: -0.814 ent: -2.649 str: 0.000 loss: -3.462]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -0.814 ent: -2.649 str: 0.000 loss: -3.462]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -1.067 ent: -2.645 str: 0.000 loss: -3.711]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.09s/it, atk: -1.067 ent: -2.645 str: 0.000 loss: -3.711]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.09s/it, atk: -1.452 ent: -2.654 str: 0.000 loss: -4.106]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.09s/it, atk: -1.452 ent: -2.654 str: 0.000 loss: -4.106]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.09s/it, atk: -2.036 ent: -2.657 str: 0.000 loss: -4.692]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.08s/it, atk: -2.036 ent: -2.657 str: 0.000 loss: -4.692]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.08s/it, atk: -2.735 ent: -2.656 str: 0.000 loss: -5.390]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.08s/it, atk: -2.735 ent: -2.656 str: 0.000 loss: -5.390]Iterations:  37%|███▋      | 11/30 [00:13<00:20,  1.08s/it, atk: -3.547 ent: -2.656 str: 0.000 loss: -6.203]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -3.547 ent: -2.656 str: 0.000 loss: -6.203]Iterations:  40%|████      | 12/30 [00:14<00:19,  1.07s/it, atk: -3.495 ent: -2.665 str: 0.000 loss: -6.160]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.07s/it, atk: -3.495 ent: -2.665 str: 0.000 loss: -6.160]Iterations:  43%|████▎     | 13/30 [00:15<00:18,  1.07s/it, atk: -4.855 ent: -2.659 str: 0.000 loss: -7.514]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.07s/it, atk: -4.855 ent: -2.659 str: 0.000 loss: -7.514]Iterations:  47%|████▋     | 14/30 [00:16<00:17,  1.07s/it, atk: -6.125 ent: -2.659 str: 0.000 loss: -8.783]Iterations:  50%|█████     | 15/30 [00:16<00:16,  1.07s/it, atk: -6.125 ent: -2.659 str: 0.000 loss: -8.783]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.07s/it, atk: -7.033 ent: -2.657 str: 0.000 loss: -9.691]Iterations:  53%|█████▎    | 16/30 [00:17<00:14,  1.07s/it, atk: -7.033 ent: -2.657 str: 0.000 loss: -9.691]Iterations:  53%|█████▎    | 16/30 [00:18<00:14,  1.07s/it, atk: -8.591 ent: -2.660 str: 0.000 loss: -11.251]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.07s/it, atk: -8.591 ent: -2.660 str: 0.000 loss: -11.251]Iterations:  57%|█████▋    | 17/30 [00:19<00:13,  1.07s/it, atk: -9.798 ent: -2.660 str: 0.000 loss: -12.458]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.07s/it, atk: -9.798 ent: -2.660 str: 0.000 loss: -12.458]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.07s/it, atk: -11.392 ent: -2.660 str: 0.000 loss: -14.052]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -11.392 ent: -2.660 str: 0.000 loss: -14.052]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -13.043 ent: -2.655 str: 0.000 loss: -15.698]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.07s/it, atk: -13.043 ent: -2.655 str: 0.000 loss: -15.698]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.07s/it, atk: -12.803 ent: -2.661 str: 0.000 loss: -15.464]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.07s/it, atk: -12.803 ent: -2.661 str: 0.000 loss: -15.464]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.07s/it, atk: -16.959 ent: -2.657 str: 0.000 loss: -19.616]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -16.959 ent: -2.657 str: 0.000 loss: -19.616]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -18.973 ent: -2.660 str: 0.000 loss: -21.633]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -18.973 ent: -2.660 str: 0.000 loss: -21.633]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -21.630 ent: -2.661 str: 0.000 loss: -24.291]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -21.630 ent: -2.661 str: 0.000 loss: -24.291]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -25.160 ent: -2.660 str: 0.000 loss: -27.821]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.08s/it, atk: -25.160 ent: -2.660 str: 0.000 loss: -27.821]Iterations:  83%|████████▎ | 25/30 [00:28<00:05,  1.08s/it, atk: -29.033 ent: -2.660 str: 0.000 loss: -31.693]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.09s/it, atk: -29.033 ent: -2.660 str: 0.000 loss: -31.693]Iterations:  87%|████████▋ | 26/30 [00:29<00:04,  1.09s/it, atk: -32.672 ent: -2.662 str: 0.000 loss: -35.334]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.08s/it, atk: -32.672 ent: -2.662 str: 0.000 loss: -35.334]Iterations:  90%|█████████ | 27/30 [00:30<00:03,  1.08s/it, atk: -35.650 ent: -2.665 str: 0.000 loss: -38.316]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.08s/it, atk: -35.650 ent: -2.665 str: 0.000 loss: -38.316]Iterations:  93%|█████████▎| 28/30 [00:31<00:02,  1.08s/it, atk: -39.643 ent: -2.664 str: 0.000 loss: -42.308]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.07s/it, atk: -39.643 ent: -2.664 str: 0.000 loss: -42.308]Iterations:  97%|█████████▋| 29/30 [00:32<00:01,  1.07s/it, atk: -44.132 ent: -2.663 str: 0.000 loss: -46.794]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.07s/it, atk: -44.132 ent: -2.663 str: 0.000 loss: -46.794]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.09s/it, atk: -44.132 ent: -2.663 str: 0.000 loss: -46.794]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([821], device='cuda:0') tensor(0.9893, device='cuda:0')
after_true: tensor([718], device='cuda:0') tensor(0.0085, device='cuda:0')
L1: [2689.2827]	L2: [20.012548]	Linf: [0.8666667]

Accuracy on benign examples: 100.0%
gt_label: 305 pred_label: 305 pred_clean_logit 0.9543598294258118
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.31it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.96it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.65it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.41it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.47it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.20it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.20it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.32it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 11.93it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.26it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.65s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.82s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:04,  2.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.09s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.90s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2604
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.394 ent: -5.240 str: 0.000 loss: -5.634]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.73s/it, atk: -0.394 ent: -5.240 str: 0.000 loss: -5.634]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.73s/it, atk: -0.769 ent: -5.246 str: 0.000 loss: -6.015]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.02s/it, atk: -0.769 ent: -5.246 str: 0.000 loss: -6.015]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.02s/it, atk: -1.065 ent: -5.215 str: 0.000 loss: -6.280]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.29it/s, atk: -1.065 ent: -5.215 str: 0.000 loss: -6.280]Iterations:  10%|█         | 3/30 [00:03<00:20,  1.29it/s, atk: -2.399 ent: -5.222 str: 0.000 loss: -7.620]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.51it/s, atk: -2.399 ent: -5.222 str: 0.000 loss: -7.620]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.51it/s, atk: -4.722 ent: -5.209 str: 0.000 loss: -9.931]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.67it/s, atk: -4.722 ent: -5.209 str: 0.000 loss: -9.931]Iterations:  17%|█▋        | 5/30 [00:04<00:14,  1.67it/s, atk: -5.505 ent: -5.202 str: 0.000 loss: -10.708]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.73it/s, atk: -5.505 ent: -5.202 str: 0.000 loss: -10.708]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.73it/s, atk: -9.972 ent: -5.197 str: 0.000 loss: -15.169]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.81it/s, atk: -9.972 ent: -5.197 str: 0.000 loss: -15.169]Iterations:  23%|██▎       | 7/30 [00:05<00:12,  1.81it/s, atk: -17.681 ent: -5.197 str: 0.000 loss: -22.878]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -17.681 ent: -5.197 str: 0.000 loss: -22.878]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -23.297 ent: -5.194 str: 0.000 loss: -28.491]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.91it/s, atk: -23.297 ent: -5.194 str: 0.000 loss: -28.491]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.91it/s, atk: -36.155 ent: -5.194 str: 0.000 loss: -41.350]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.94it/s, atk: -36.155 ent: -5.194 str: 0.000 loss: -41.350]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.94it/s, atk: -46.363 ent: -5.188 str: 0.000 loss: -51.551]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.91it/s, atk: -46.363 ent: -5.188 str: 0.000 loss: -51.551]Iterations:  37%|███▋      | 11/30 [00:07<00:09,  1.91it/s, atk: -55.121 ent: -5.188 str: 0.000 loss: -60.309]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.89it/s, atk: -55.121 ent: -5.188 str: 0.000 loss: -60.309]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.89it/s, atk: -63.386 ent: -5.193 str: 0.000 loss: -68.579]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.93it/s, atk: -63.386 ent: -5.193 str: 0.000 loss: -68.579]Iterations:  43%|████▎     | 13/30 [00:08<00:08,  1.93it/s, atk: -72.214 ent: -5.194 str: 0.000 loss: -77.408]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.91it/s, atk: -72.214 ent: -5.194 str: 0.000 loss: -77.408]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.91it/s, atk: -78.997 ent: -5.195 str: 0.000 loss: -84.192]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.91it/s, atk: -78.997 ent: -5.195 str: 0.000 loss: -84.192]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.91it/s, atk: -83.712 ent: -5.195 str: 0.000 loss: -88.907]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.98it/s, atk: -83.712 ent: -5.195 str: 0.000 loss: -88.907]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.98it/s, atk: -89.028 ent: -5.193 str: 0.000 loss: -94.221]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.00it/s, atk: -89.028 ent: -5.193 str: 0.000 loss: -94.221]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  2.00it/s, atk: -95.096 ent: -5.190 str: 0.000 loss: -100.286]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.01it/s, atk: -95.096 ent: -5.190 str: 0.000 loss: -100.286]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.01it/s, atk: -100.945 ent: -5.187 str: 0.000 loss: -106.132]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.00it/s, atk: -100.945 ent: -5.187 str: 0.000 loss: -106.132]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.00it/s, atk: -106.438 ent: -5.185 str: 0.000 loss: -111.624]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.98it/s, atk: -106.438 ent: -5.185 str: 0.000 loss: -111.624]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.98it/s, atk: -110.443 ent: -5.185 str: 0.000 loss: -115.628]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.00it/s, atk: -110.443 ent: -5.185 str: 0.000 loss: -115.628]Iterations:  70%|███████   | 21/30 [00:12<00:04,  2.00it/s, atk: -114.296 ent: -5.183 str: 0.000 loss: -119.479]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -114.296 ent: -5.183 str: 0.000 loss: -119.479]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -118.853 ent: -5.180 str: 0.000 loss: -124.033]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -118.853 ent: -5.180 str: 0.000 loss: -124.033]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.97it/s, atk: -123.282 ent: -5.177 str: 0.000 loss: -128.460]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.99it/s, atk: -123.282 ent: -5.177 str: 0.000 loss: -128.460]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.99it/s, atk: -129.238 ent: -5.178 str: 0.000 loss: -134.416]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -129.238 ent: -5.178 str: 0.000 loss: -134.416]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.97it/s, atk: -132.681 ent: -5.179 str: 0.000 loss: -137.860]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.99it/s, atk: -132.681 ent: -5.179 str: 0.000 loss: -137.860]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.99it/s, atk: -137.617 ent: -5.179 str: 0.000 loss: -142.796]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.01it/s, atk: -137.617 ent: -5.179 str: 0.000 loss: -142.796]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  2.01it/s, atk: -141.228 ent: -5.176 str: 0.000 loss: -146.405]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.99it/s, atk: -141.228 ent: -5.176 str: 0.000 loss: -146.405]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.99it/s, atk: -144.989 ent: -5.175 str: 0.000 loss: -150.164]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -144.989 ent: -5.175 str: 0.000 loss: -150.164]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.99it/s, atk: -149.127 ent: -5.175 str: 0.000 loss: -154.301]Iterations: 100%|██████████| 30/30 [00:16<00:00,  2.01it/s, atk: -149.127 ent: -5.175 str: 0.000 loss: -154.301]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.83it/s, atk: -149.127 ent: -5.175 str: 0.000 loss: -154.301]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([302], device='cuda:0') tensor(0.6926, device='cuda:0')
after_true: tensor([305], device='cuda:0') tensor(2.4947e-07, device='cuda:0')
L1: [2123.2158]	L2: [13.740455]	Linf: [0.49803922]

Accuracy on benign examples: 100.0%
gt_label: 483 pred_label: 483 pred_clean_logit 0.983611524105072
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.60it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.37it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 27.21it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 27.13it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.99it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.96it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 27.05it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.14it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.07it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.00it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.09s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.11s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6090
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.129 ent: -2.738 str: 0.000 loss: -2.867]Iterations:   3%|▎         | 1/30 [00:01<00:55,  1.93s/it, atk: -0.129 ent: -2.738 str: 0.000 loss: -2.867]Iterations:   3%|▎         | 1/30 [00:02<00:55,  1.93s/it, atk: -0.202 ent: -2.733 str: 0.000 loss: -2.935]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -0.202 ent: -2.733 str: 0.000 loss: -2.935]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -1.335 ent: -2.739 str: 0.000 loss: -4.074]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.24it/s, atk: -1.335 ent: -2.739 str: 0.000 loss: -4.074]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.24it/s, atk: -2.708 ent: -2.733 str: 0.000 loss: -5.442]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.45it/s, atk: -2.708 ent: -2.733 str: 0.000 loss: -5.442]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.45it/s, atk: -5.261 ent: -2.728 str: 0.000 loss: -7.989]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.62it/s, atk: -5.261 ent: -2.728 str: 0.000 loss: -7.989]Iterations:  17%|█▋        | 5/30 [00:04<00:15,  1.62it/s, atk: -9.163 ent: -2.731 str: 0.000 loss: -11.894]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.74it/s, atk: -9.163 ent: -2.731 str: 0.000 loss: -11.894]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.74it/s, atk: -12.615 ent: -2.731 str: 0.000 loss: -15.346]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.84it/s, atk: -12.615 ent: -2.731 str: 0.000 loss: -15.346]Iterations:  23%|██▎       | 7/30 [00:05<00:12,  1.84it/s, atk: -16.291 ent: -2.727 str: 0.000 loss: -19.018]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.90it/s, atk: -16.291 ent: -2.727 str: 0.000 loss: -19.018]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.90it/s, atk: -18.990 ent: -2.728 str: 0.000 loss: -21.718]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -18.990 ent: -2.728 str: 0.000 loss: -21.718]Iterations:  30%|███       | 9/30 [00:06<00:10,  1.94it/s, atk: -22.375 ent: -2.730 str: 0.000 loss: -25.105]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.97it/s, atk: -22.375 ent: -2.730 str: 0.000 loss: -25.105]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.97it/s, atk: -25.874 ent: -2.724 str: 0.000 loss: -28.598]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.95it/s, atk: -25.874 ent: -2.724 str: 0.000 loss: -28.598]Iterations:  37%|███▋      | 11/30 [00:07<00:09,  1.95it/s, atk: -26.823 ent: -2.721 str: 0.000 loss: -29.544]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.98it/s, atk: -26.823 ent: -2.721 str: 0.000 loss: -29.544]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.98it/s, atk: -31.854 ent: -2.721 str: 0.000 loss: -34.576]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.98it/s, atk: -31.854 ent: -2.721 str: 0.000 loss: -34.576]Iterations:  43%|████▎     | 13/30 [00:08<00:08,  1.98it/s, atk: -34.578 ent: -2.722 str: 0.000 loss: -37.300]Iterations:  47%|████▋     | 14/30 [00:08<00:07,  2.00it/s, atk: -34.578 ent: -2.722 str: 0.000 loss: -37.300]Iterations:  47%|████▋     | 14/30 [00:08<00:07,  2.00it/s, atk: -37.971 ent: -2.722 str: 0.000 loss: -40.693]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.02it/s, atk: -37.971 ent: -2.722 str: 0.000 loss: -40.693]Iterations:  50%|█████     | 15/30 [00:09<00:07,  2.02it/s, atk: -40.790 ent: -2.721 str: 0.000 loss: -43.511]Iterations:  53%|█████▎    | 16/30 [00:09<00:06,  2.03it/s, atk: -40.790 ent: -2.721 str: 0.000 loss: -43.511]Iterations:  53%|█████▎    | 16/30 [00:09<00:06,  2.03it/s, atk: -42.733 ent: -2.722 str: 0.000 loss: -45.456]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.03it/s, atk: -42.733 ent: -2.722 str: 0.000 loss: -45.456]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  2.03it/s, atk: -46.520 ent: -2.724 str: 0.000 loss: -49.243]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.04it/s, atk: -46.520 ent: -2.724 str: 0.000 loss: -49.243]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.04it/s, atk: -48.041 ent: -2.725 str: 0.000 loss: -50.766]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.03it/s, atk: -48.041 ent: -2.725 str: 0.000 loss: -50.766]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.03it/s, atk: -51.196 ent: -2.726 str: 0.000 loss: -53.923]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.03it/s, atk: -51.196 ent: -2.726 str: 0.000 loss: -53.923]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.03it/s, atk: -53.562 ent: -2.727 str: 0.000 loss: -56.290]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.04it/s, atk: -53.562 ent: -2.727 str: 0.000 loss: -56.290]Iterations:  70%|███████   | 21/30 [00:12<00:04,  2.04it/s, atk: -55.926 ent: -2.726 str: 0.000 loss: -58.652]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.04it/s, atk: -55.926 ent: -2.726 str: 0.000 loss: -58.652]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.04it/s, atk: -58.012 ent: -2.725 str: 0.000 loss: -60.738]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.05it/s, atk: -58.012 ent: -2.725 str: 0.000 loss: -60.738]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  2.05it/s, atk: -60.487 ent: -2.725 str: 0.000 loss: -63.211]Iterations:  80%|████████  | 24/30 [00:13<00:02,  2.05it/s, atk: -60.487 ent: -2.725 str: 0.000 loss: -63.211]Iterations:  80%|████████  | 24/30 [00:13<00:02,  2.05it/s, atk: -62.382 ent: -2.724 str: 0.000 loss: -65.106]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.05it/s, atk: -62.382 ent: -2.724 str: 0.000 loss: -65.106]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.05it/s, atk: -63.847 ent: -2.726 str: 0.000 loss: -66.573]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.03it/s, atk: -63.847 ent: -2.726 str: 0.000 loss: -66.573]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.03it/s, atk: -65.493 ent: -2.726 str: 0.000 loss: -68.220]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.05it/s, atk: -65.493 ent: -2.726 str: 0.000 loss: -68.220]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.05it/s, atk: -67.571 ent: -2.726 str: 0.000 loss: -70.296]Iterations:  93%|█████████▎| 28/30 [00:15<00:00,  2.04it/s, atk: -67.571 ent: -2.726 str: 0.000 loss: -70.296]Iterations:  93%|█████████▎| 28/30 [00:15<00:00,  2.04it/s, atk: -69.521 ent: -2.726 str: 0.000 loss: -72.246]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.04it/s, atk: -69.521 ent: -2.726 str: 0.000 loss: -72.246]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.04it/s, atk: -71.681 ent: -2.726 str: 0.000 loss: -74.408]Iterations: 100%|██████████| 30/30 [00:16<00:00,  2.02it/s, atk: -71.681 ent: -2.726 str: 0.000 loss: -74.408]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -71.681 ent: -2.726 str: 0.000 loss: -74.408]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([468], device='cuda:0') tensor(0.1107, device='cuda:0')
after_true: tensor([483], device='cuda:0') tensor(0.0007, device='cuda:0')
L1: [2589.851]	L2: [16.403883]	Linf: [0.5686275]

Accuracy on benign examples: 0.0%
gt_label: 972 pred_label: 825 pred_clean_logit 0.13704359531402588
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 26.16it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.63it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.00it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.15it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.24it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.32it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.18it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.17it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.02it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.07s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.29s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3621
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -12.011 ent: -2.597 str: 0.000 loss: -14.608]Iterations:   3%|▎         | 1/30 [00:00<00:16,  1.81it/s, atk: -12.011 ent: -2.597 str: 0.000 loss: -14.608]Iterations:   3%|▎         | 1/30 [00:00<00:16,  1.81it/s, atk: -18.871 ent: -2.588 str: 0.000 loss: -21.460]Iterations:   7%|▋         | 2/30 [00:01<00:14,  1.94it/s, atk: -18.871 ent: -2.588 str: 0.000 loss: -21.460]Iterations:   7%|▋         | 2/30 [00:01<00:14,  1.94it/s, atk: -34.203 ent: -2.588 str: 0.000 loss: -36.791]Iterations:  10%|█         | 3/30 [00:01<00:13,  1.97it/s, atk: -34.203 ent: -2.588 str: 0.000 loss: -36.791]Iterations:  10%|█         | 3/30 [00:01<00:13,  1.97it/s, atk: -53.469 ent: -2.581 str: 0.000 loss: -56.050]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.98it/s, atk: -53.469 ent: -2.581 str: 0.000 loss: -56.050]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.98it/s, atk: -70.808 ent: -2.582 str: 0.000 loss: -73.390]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.97it/s, atk: -70.808 ent: -2.582 str: 0.000 loss: -73.390]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.97it/s, atk: -78.134 ent: -2.580 str: 0.000 loss: -80.714]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.99it/s, atk: -78.134 ent: -2.580 str: 0.000 loss: -80.714]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.99it/s, atk: -91.778 ent: -2.576 str: 0.000 loss: -94.355]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  2.01it/s, atk: -91.778 ent: -2.576 str: 0.000 loss: -94.355]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  2.01it/s, atk: -100.769 ent: -2.575 str: 0.000 loss: -103.344]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.99it/s, atk: -100.769 ent: -2.575 str: 0.000 loss: -103.344]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.99it/s, atk: -109.651 ent: -2.575 str: 0.000 loss: -112.225]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.96it/s, atk: -109.651 ent: -2.575 str: 0.000 loss: -112.225]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.96it/s, atk: -121.572 ent: -2.574 str: 0.000 loss: -124.146]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.98it/s, atk: -121.572 ent: -2.574 str: 0.000 loss: -124.146]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.98it/s, atk: -132.150 ent: -2.573 str: 0.000 loss: -134.723]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -132.150 ent: -2.573 str: 0.000 loss: -134.723]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -135.516 ent: -2.573 str: 0.000 loss: -138.088]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -135.516 ent: -2.573 str: 0.000 loss: -138.088]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -144.549 ent: -2.572 str: 0.000 loss: -147.121]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.98it/s, atk: -144.549 ent: -2.572 str: 0.000 loss: -147.121]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.98it/s, atk: -152.759 ent: -2.572 str: 0.000 loss: -155.332]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  2.00it/s, atk: -152.759 ent: -2.572 str: 0.000 loss: -155.332]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  2.00it/s, atk: -160.681 ent: -2.571 str: 0.000 loss: -163.252]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.00it/s, atk: -160.681 ent: -2.571 str: 0.000 loss: -163.252]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.00it/s, atk: -158.517 ent: -2.570 str: 0.000 loss: -161.086]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  2.00it/s, atk: -158.517 ent: -2.570 str: 0.000 loss: -161.086]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  2.00it/s, atk: -168.325 ent: -2.569 str: 0.000 loss: -170.895]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.94it/s, atk: -168.325 ent: -2.569 str: 0.000 loss: -170.895]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.94it/s, atk: -167.099 ent: -2.570 str: 0.000 loss: -169.668]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.93it/s, atk: -167.099 ent: -2.570 str: 0.000 loss: -169.668]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.93it/s, atk: -177.923 ent: -2.568 str: 0.000 loss: -180.491]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.99it/s, atk: -177.923 ent: -2.568 str: 0.000 loss: -180.491]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.99it/s, atk: -181.548 ent: -2.567 str: 0.000 loss: -184.115]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  2.00it/s, atk: -181.548 ent: -2.567 str: 0.000 loss: -184.115]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  2.00it/s, atk: -188.277 ent: -2.566 str: 0.000 loss: -190.844]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.97it/s, atk: -188.277 ent: -2.566 str: 0.000 loss: -190.844]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.97it/s, atk: -192.536 ent: -2.565 str: 0.000 loss: -195.101]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -192.536 ent: -2.565 str: 0.000 loss: -195.101]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.98it/s, atk: -197.522 ent: -2.565 str: 0.000 loss: -200.087]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.00it/s, atk: -197.522 ent: -2.565 str: 0.000 loss: -200.087]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.00it/s, atk: -200.941 ent: -2.565 str: 0.000 loss: -203.506]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.00it/s, atk: -200.941 ent: -2.565 str: 0.000 loss: -203.506]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.00it/s, atk: -204.245 ent: -2.565 str: 0.000 loss: -206.810]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.01it/s, atk: -204.245 ent: -2.565 str: 0.000 loss: -206.810]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.01it/s, atk: -208.976 ent: -2.565 str: 0.000 loss: -211.541]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.01it/s, atk: -208.976 ent: -2.565 str: 0.000 loss: -211.541]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.01it/s, atk: -212.762 ent: -2.566 str: 0.000 loss: -215.329]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.98it/s, atk: -212.762 ent: -2.566 str: 0.000 loss: -215.329]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.98it/s, atk: -215.905 ent: -2.566 str: 0.000 loss: -218.471]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.98it/s, atk: -215.905 ent: -2.566 str: 0.000 loss: -218.471]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.98it/s, atk: -219.008 ent: -2.566 str: 0.000 loss: -221.574]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.99it/s, atk: -219.008 ent: -2.566 str: 0.000 loss: -221.574]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.99it/s, atk: -222.013 ent: -2.565 str: 0.000 loss: -224.578]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -222.013 ent: -2.565 str: 0.000 loss: -224.578]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -222.013 ent: -2.565 str: 0.000 loss: -224.578]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([825], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([972], device='cuda:0') tensor(1.7676e-10, device='cuda:0')
L1: [3773.334]	L2: [23.911774]	Linf: [0.6509804]

Accuracy on benign examples: 100.0%
gt_label: 770 pred_label: 770 pred_clean_logit 0.7595577836036682
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.22it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 21.88it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.40it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 24.69it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.32it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.60it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.57it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.13it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.06it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:02,  1.01s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.11s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.34s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.20s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6765
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -2.325 ent: -5.641 str: 0.000 loss: -7.967]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.18s/it, atk: -2.325 ent: -5.641 str: 0.000 loss: -7.967]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.18s/it, atk: -5.326 ent: -5.623 str: 0.000 loss: -10.949]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.29it/s, atk: -5.326 ent: -5.623 str: 0.000 loss: -10.949]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.29it/s, atk: -11.784 ent: -5.624 str: 0.000 loss: -17.408]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.55it/s, atk: -11.784 ent: -5.624 str: 0.000 loss: -17.408]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.55it/s, atk: -16.456 ent: -5.627 str: 0.000 loss: -22.083]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.69it/s, atk: -16.456 ent: -5.627 str: 0.000 loss: -22.083]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.69it/s, atk: -23.898 ent: -5.619 str: 0.000 loss: -29.517]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.76it/s, atk: -23.898 ent: -5.619 str: 0.000 loss: -29.517]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.76it/s, atk: -27.385 ent: -5.612 str: 0.000 loss: -32.998]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.79it/s, atk: -27.385 ent: -5.612 str: 0.000 loss: -32.998]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.79it/s, atk: -32.108 ent: -5.610 str: 0.000 loss: -37.719]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.85it/s, atk: -32.108 ent: -5.610 str: 0.000 loss: -37.719]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.85it/s, atk: -38.346 ent: -5.610 str: 0.000 loss: -43.956]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.90it/s, atk: -38.346 ent: -5.610 str: 0.000 loss: -43.956]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.90it/s, atk: -46.054 ent: -5.609 str: 0.000 loss: -51.663]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -46.054 ent: -5.609 str: 0.000 loss: -51.663]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.94it/s, atk: -51.752 ent: -5.606 str: 0.000 loss: -57.358]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -51.752 ent: -5.606 str: 0.000 loss: -57.358]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.95it/s, atk: -57.424 ent: -5.603 str: 0.000 loss: -63.026]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -57.424 ent: -5.603 str: 0.000 loss: -63.026]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.94it/s, atk: -64.900 ent: -5.599 str: 0.000 loss: -70.498]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -64.900 ent: -5.599 str: 0.000 loss: -70.498]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.95it/s, atk: -72.741 ent: -5.596 str: 0.000 loss: -78.336]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.93it/s, atk: -72.741 ent: -5.596 str: 0.000 loss: -78.336]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.93it/s, atk: -79.021 ent: -5.593 str: 0.000 loss: -84.614]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -79.021 ent: -5.593 str: 0.000 loss: -84.614]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -86.240 ent: -5.592 str: 0.000 loss: -91.832]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.95it/s, atk: -86.240 ent: -5.592 str: 0.000 loss: -91.832]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.95it/s, atk: -91.186 ent: -5.591 str: 0.000 loss: -96.778]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -91.186 ent: -5.591 str: 0.000 loss: -96.778]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.94it/s, atk: -98.259 ent: -5.589 str: 0.000 loss: -103.849]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -98.259 ent: -5.589 str: 0.000 loss: -103.849]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -103.773 ent: -5.587 str: 0.000 loss: -109.360]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -103.773 ent: -5.587 str: 0.000 loss: -109.360]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.94it/s, atk: -111.233 ent: -5.587 str: 0.000 loss: -116.820]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -111.233 ent: -5.587 str: 0.000 loss: -116.820]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -116.531 ent: -5.585 str: 0.000 loss: -122.117]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -116.531 ent: -5.585 str: 0.000 loss: -122.117]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.97it/s, atk: -121.656 ent: -5.585 str: 0.000 loss: -127.240]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.90it/s, atk: -121.656 ent: -5.585 str: 0.000 loss: -127.240]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.90it/s, atk: -125.631 ent: -5.584 str: 0.000 loss: -131.215]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.84it/s, atk: -125.631 ent: -5.584 str: 0.000 loss: -131.215]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.84it/s, atk: -130.254 ent: -5.582 str: 0.000 loss: -135.836]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.89it/s, atk: -130.254 ent: -5.582 str: 0.000 loss: -135.836]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.89it/s, atk: -134.301 ent: -5.581 str: 0.000 loss: -139.882]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.88it/s, atk: -134.301 ent: -5.581 str: 0.000 loss: -139.882]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.88it/s, atk: -137.933 ent: -5.580 str: 0.000 loss: -143.512]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.84it/s, atk: -137.933 ent: -5.580 str: 0.000 loss: -143.512]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.84it/s, atk: -141.447 ent: -5.578 str: 0.000 loss: -147.025]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.86it/s, atk: -141.447 ent: -5.578 str: 0.000 loss: -147.025]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.86it/s, atk: -145.432 ent: -5.577 str: 0.000 loss: -151.009]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.89it/s, atk: -145.432 ent: -5.577 str: 0.000 loss: -151.009]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.89it/s, atk: -149.864 ent: -5.578 str: 0.000 loss: -155.441]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.89it/s, atk: -149.864 ent: -5.578 str: 0.000 loss: -155.441]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.89it/s, atk: -153.915 ent: -5.578 str: 0.000 loss: -159.493]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.92it/s, atk: -153.915 ent: -5.578 str: 0.000 loss: -159.493]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.92it/s, atk: -157.650 ent: -5.577 str: 0.000 loss: -163.227]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.89it/s, atk: -157.650 ent: -5.577 str: 0.000 loss: -163.227]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -157.650 ent: -5.577 str: 0.000 loss: -163.227]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([774], device='cuda:0') tensor(0.9968, device='cuda:0')
after_true: tensor([770], device='cuda:0') tensor(9.5875e-08, device='cuda:0')
L1: [2331.055]	L2: [17.28201]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 570 pred_label: 570 pred_clean_logit 0.9132158160209656
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 26.64it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.59it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.40it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.56it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.47it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.89it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.16it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.10it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.06it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:02,  1.01s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.14s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.14s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2589
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.349 ent: -5.403 str: 0.000 loss: -6.752]Iterations:   3%|▎         | 1/30 [00:00<00:21,  1.34it/s, atk: -1.349 ent: -5.403 str: 0.000 loss: -6.752]Iterations:   3%|▎         | 1/30 [00:01<00:21,  1.34it/s, atk: -6.609 ent: -5.384 str: 0.000 loss: -11.993]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.64it/s, atk: -6.609 ent: -5.384 str: 0.000 loss: -11.993]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.64it/s, atk: -10.822 ent: -5.363 str: 0.000 loss: -16.185]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.76it/s, atk: -10.822 ent: -5.363 str: 0.000 loss: -16.185]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.76it/s, atk: -21.366 ent: -5.355 str: 0.000 loss: -26.721]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -21.366 ent: -5.355 str: 0.000 loss: -26.721]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -32.874 ent: -5.353 str: 0.000 loss: -38.227]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.87it/s, atk: -32.874 ent: -5.353 str: 0.000 loss: -38.227]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.87it/s, atk: -38.381 ent: -5.351 str: 0.000 loss: -43.732]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -38.381 ent: -5.351 str: 0.000 loss: -43.732]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -44.108 ent: -5.352 str: 0.000 loss: -49.460]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -44.108 ent: -5.352 str: 0.000 loss: -49.460]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.93it/s, atk: -49.902 ent: -5.352 str: 0.000 loss: -55.254]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -49.902 ent: -5.352 str: 0.000 loss: -55.254]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -55.950 ent: -5.354 str: 0.000 loss: -61.304]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.92it/s, atk: -55.950 ent: -5.354 str: 0.000 loss: -61.304]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.92it/s, atk: -62.411 ent: -5.356 str: 0.000 loss: -67.767]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -62.411 ent: -5.356 str: 0.000 loss: -67.767]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -69.747 ent: -5.358 str: 0.000 loss: -75.105]Iterations:  37%|███▋      | 11/30 [00:05<00:10,  1.86it/s, atk: -69.747 ent: -5.358 str: 0.000 loss: -75.105]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.86it/s, atk: -78.769 ent: -5.358 str: 0.000 loss: -84.126]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.90it/s, atk: -78.769 ent: -5.358 str: 0.000 loss: -84.126]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.90it/s, atk: -89.073 ent: -5.358 str: 0.000 loss: -94.431]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.90it/s, atk: -89.073 ent: -5.358 str: 0.000 loss: -94.431]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.90it/s, atk: -101.484 ent: -5.357 str: 0.000 loss: -106.841]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.83it/s, atk: -101.484 ent: -5.357 str: 0.000 loss: -106.841]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.83it/s, atk: -113.955 ent: -5.353 str: 0.000 loss: -119.308]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.89it/s, atk: -113.955 ent: -5.353 str: 0.000 loss: -119.308]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.89it/s, atk: -125.966 ent: -5.348 str: 0.000 loss: -131.314]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -125.966 ent: -5.348 str: 0.000 loss: -131.314]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -137.849 ent: -5.345 str: 0.000 loss: -143.194]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -137.849 ent: -5.345 str: 0.000 loss: -143.194]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -150.670 ent: -5.339 str: 0.000 loss: -156.009]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.93it/s, atk: -150.670 ent: -5.339 str: 0.000 loss: -156.009]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.93it/s, atk: -163.013 ent: -5.335 str: 0.000 loss: -168.348]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -163.013 ent: -5.335 str: 0.000 loss: -168.348]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -178.107 ent: -5.333 str: 0.000 loss: -183.440]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -178.107 ent: -5.333 str: 0.000 loss: -183.440]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -192.295 ent: -5.331 str: 0.000 loss: -197.627]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -192.295 ent: -5.331 str: 0.000 loss: -197.627]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -204.371 ent: -5.330 str: 0.000 loss: -209.700]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.93it/s, atk: -204.371 ent: -5.330 str: 0.000 loss: -209.700]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.93it/s, atk: -217.506 ent: -5.329 str: 0.000 loss: -222.835]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.95it/s, atk: -217.506 ent: -5.329 str: 0.000 loss: -222.835]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.95it/s, atk: -232.630 ent: -5.329 str: 0.000 loss: -237.959]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -232.630 ent: -5.329 str: 0.000 loss: -237.959]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -247.150 ent: -5.325 str: 0.000 loss: -252.475]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.94it/s, atk: -247.150 ent: -5.325 str: 0.000 loss: -252.475]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.94it/s, atk: -258.770 ent: -5.323 str: 0.000 loss: -264.092]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -258.770 ent: -5.323 str: 0.000 loss: -264.092]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -276.350 ent: -5.323 str: 0.000 loss: -281.673]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.94it/s, atk: -276.350 ent: -5.323 str: 0.000 loss: -281.673]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.94it/s, atk: -280.026 ent: -5.323 str: 0.000 loss: -285.348]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.88it/s, atk: -280.026 ent: -5.323 str: 0.000 loss: -285.348]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.88it/s, atk: -301.862 ent: -5.320 str: 0.000 loss: -307.182]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -301.862 ent: -5.320 str: 0.000 loss: -307.182]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -314.491 ent: -5.318 str: 0.000 loss: -319.809]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.95it/s, atk: -314.491 ent: -5.318 str: 0.000 loss: -319.809]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.91it/s, atk: -314.491 ent: -5.318 str: 0.000 loss: -319.809]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([934], device='cuda:0') tensor(0.9992, device='cuda:0')
after_true: tensor([570], device='cuda:0') tensor(6.2633e-15, device='cuda:0')
L1: [2516.6746]	L2: [17.953327]	Linf: [0.62352943]

Accuracy on benign examples: 100.0%
gt_label: 323 pred_label: 323 pred_clean_logit 0.9840669631958008
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 25.91it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.84it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 14.81it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.80it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.52it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 21.05it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.05it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.04it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.14s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.1860
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.057 ent: -3.532 str: 0.000 loss: -3.588]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.08it/s, atk: -0.057 ent: -3.532 str: 0.000 loss: -3.588]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.08it/s, atk: -0.101 ent: -3.516 str: 0.000 loss: -3.616]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.46it/s, atk: -0.101 ent: -3.516 str: 0.000 loss: -3.616]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.46it/s, atk: -0.204 ent: -3.522 str: 0.000 loss: -3.726]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.70it/s, atk: -0.204 ent: -3.522 str: 0.000 loss: -3.726]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.70it/s, atk: -0.222 ent: -3.515 str: 0.000 loss: -3.736]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.82it/s, atk: -0.222 ent: -3.515 str: 0.000 loss: -3.736]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.82it/s, atk: -0.402 ent: -3.530 str: 0.000 loss: -3.932]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.89it/s, atk: -0.402 ent: -3.530 str: 0.000 loss: -3.932]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.89it/s, atk: -0.645 ent: -3.537 str: 0.000 loss: -4.183]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -0.645 ent: -3.537 str: 0.000 loss: -4.183]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -1.024 ent: -3.542 str: 0.000 loss: -4.566]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.96it/s, atk: -1.024 ent: -3.542 str: 0.000 loss: -4.566]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.96it/s, atk: -1.382 ent: -3.542 str: 0.000 loss: -4.925]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -1.382 ent: -3.542 str: 0.000 loss: -4.925]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -1.893 ent: -3.532 str: 0.000 loss: -5.425]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.98it/s, atk: -1.893 ent: -3.532 str: 0.000 loss: -5.425]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.98it/s, atk: -1.682 ent: -3.548 str: 0.000 loss: -5.230]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -1.682 ent: -3.548 str: 0.000 loss: -5.230]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -2.271 ent: -3.542 str: 0.000 loss: -5.814]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -2.271 ent: -3.542 str: 0.000 loss: -5.814]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.92it/s, atk: -2.920 ent: -3.528 str: 0.000 loss: -6.448]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -2.920 ent: -3.528 str: 0.000 loss: -6.448]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -3.351 ent: -3.526 str: 0.000 loss: -6.877]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.95it/s, atk: -3.351 ent: -3.526 str: 0.000 loss: -6.877]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -4.340 ent: -3.528 str: 0.000 loss: -7.868]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -4.340 ent: -3.528 str: 0.000 loss: -7.868]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -5.163 ent: -3.532 str: 0.000 loss: -8.694]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.99it/s, atk: -5.163 ent: -3.532 str: 0.000 loss: -8.694]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.99it/s, atk: -5.753 ent: -3.541 str: 0.000 loss: -9.294]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.00it/s, atk: -5.753 ent: -3.541 str: 0.000 loss: -9.294]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.00it/s, atk: -6.840 ent: -3.541 str: 0.000 loss: -10.381]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.01it/s, atk: -6.840 ent: -3.541 str: 0.000 loss: -10.381]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.01it/s, atk: -8.143 ent: -3.535 str: 0.000 loss: -11.678]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -8.143 ent: -3.535 str: 0.000 loss: -11.678]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -8.819 ent: -3.533 str: 0.000 loss: -12.352]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.87it/s, atk: -8.819 ent: -3.533 str: 0.000 loss: -12.352]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.87it/s, atk: -10.009 ent: -3.533 str: 0.000 loss: -13.542]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.91it/s, atk: -10.009 ent: -3.533 str: 0.000 loss: -13.542]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.91it/s, atk: -10.580 ent: -3.536 str: 0.000 loss: -14.116]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.92it/s, atk: -10.580 ent: -3.536 str: 0.000 loss: -14.116]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.92it/s, atk: -11.918 ent: -3.532 str: 0.000 loss: -15.450]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.90it/s, atk: -11.918 ent: -3.532 str: 0.000 loss: -15.450]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.90it/s, atk: -13.482 ent: -3.533 str: 0.000 loss: -17.016]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.93it/s, atk: -13.482 ent: -3.533 str: 0.000 loss: -17.016]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.93it/s, atk: -14.767 ent: -3.536 str: 0.000 loss: -18.303]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -14.767 ent: -3.536 str: 0.000 loss: -18.303]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -15.389 ent: -3.535 str: 0.000 loss: -18.924]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.99it/s, atk: -15.389 ent: -3.535 str: 0.000 loss: -18.924]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.99it/s, atk: -16.926 ent: -3.533 str: 0.000 loss: -20.460]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -16.926 ent: -3.533 str: 0.000 loss: -20.460]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -18.715 ent: -3.530 str: 0.000 loss: -22.245]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -18.715 ent: -3.530 str: 0.000 loss: -22.245]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -20.060 ent: -3.528 str: 0.000 loss: -23.589]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.97it/s, atk: -20.060 ent: -3.528 str: 0.000 loss: -23.589]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.97it/s, atk: -22.017 ent: -3.531 str: 0.000 loss: -25.548]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -22.017 ent: -3.531 str: 0.000 loss: -25.548]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -23.632 ent: -3.531 str: 0.000 loss: -27.164]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -23.632 ent: -3.531 str: 0.000 loss: -27.164]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.92it/s, atk: -23.632 ent: -3.531 str: 0.000 loss: -27.164]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([984], device='cuda:0') tensor(0.7505, device='cuda:0')
after_true: tensor([323], device='cuda:0') tensor(0.0800, device='cuda:0')
L1: [4903.0317]	L2: [36.239563]	Linf: [0.99215686]

Accuracy on benign examples: 100.0%
gt_label: 815 pred_label: 815 pred_clean_logit 0.9486068487167358
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.57it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.84it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.06it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.20it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.21it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.56it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.04it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.02it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.15s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.26s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.17s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4689
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.297 ent: -5.393 str: 0.000 loss: -5.690]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -0.297 ent: -5.393 str: 0.000 loss: -5.690]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -1.273 ent: -5.365 str: 0.000 loss: -6.638]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.39it/s, atk: -1.273 ent: -5.365 str: 0.000 loss: -6.638]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.39it/s, atk: -6.409 ent: -5.362 str: 0.000 loss: -11.771]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.61it/s, atk: -6.409 ent: -5.362 str: 0.000 loss: -11.771]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.61it/s, atk: -19.951 ent: -5.366 str: 0.000 loss: -25.317]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.77it/s, atk: -19.951 ent: -5.366 str: 0.000 loss: -25.317]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.77it/s, atk: -26.067 ent: -5.384 str: 0.000 loss: -31.451]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.81it/s, atk: -26.067 ent: -5.384 str: 0.000 loss: -31.451]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.81it/s, atk: -31.594 ent: -5.388 str: 0.000 loss: -36.982]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -31.594 ent: -5.388 str: 0.000 loss: -36.982]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -45.495 ent: -5.388 str: 0.000 loss: -50.883]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.94it/s, atk: -45.495 ent: -5.388 str: 0.000 loss: -50.883]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.94it/s, atk: -54.945 ent: -5.386 str: 0.000 loss: -60.331]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -54.945 ent: -5.386 str: 0.000 loss: -60.331]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -59.876 ent: -5.380 str: 0.000 loss: -65.257]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.98it/s, atk: -59.876 ent: -5.380 str: 0.000 loss: -65.257]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.98it/s, atk: -64.438 ent: -5.376 str: 0.000 loss: -69.813]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -64.438 ent: -5.376 str: 0.000 loss: -69.813]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -65.401 ent: -5.370 str: 0.000 loss: -70.771]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -65.401 ent: -5.370 str: 0.000 loss: -70.771]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -70.930 ent: -5.367 str: 0.000 loss: -76.298]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.98it/s, atk: -70.930 ent: -5.367 str: 0.000 loss: -76.298]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.98it/s, atk: -76.598 ent: -5.365 str: 0.000 loss: -81.963]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -76.598 ent: -5.365 str: 0.000 loss: -81.963]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.94it/s, atk: -82.113 ent: -5.361 str: 0.000 loss: -87.474]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -82.113 ent: -5.361 str: 0.000 loss: -87.474]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -86.683 ent: -5.357 str: 0.000 loss: -92.041]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -86.683 ent: -5.357 str: 0.000 loss: -92.041]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -90.675 ent: -5.358 str: 0.000 loss: -96.033]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -90.675 ent: -5.358 str: 0.000 loss: -96.033]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -94.898 ent: -5.358 str: 0.000 loss: -100.256]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -94.898 ent: -5.358 str: 0.000 loss: -100.256]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -96.849 ent: -5.360 str: 0.000 loss: -102.209]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -96.849 ent: -5.360 str: 0.000 loss: -102.209]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -101.199 ent: -5.361 str: 0.000 loss: -106.560]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -101.199 ent: -5.361 str: 0.000 loss: -106.560]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -102.625 ent: -5.360 str: 0.000 loss: -107.985]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.99it/s, atk: -102.625 ent: -5.360 str: 0.000 loss: -107.985]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.99it/s, atk: -105.853 ent: -5.362 str: 0.000 loss: -111.214]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -105.853 ent: -5.362 str: 0.000 loss: -111.214]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -108.878 ent: -5.363 str: 0.000 loss: -114.240]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.01it/s, atk: -108.878 ent: -5.363 str: 0.000 loss: -114.240]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.01it/s, atk: -112.763 ent: -5.360 str: 0.000 loss: -118.123]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -112.763 ent: -5.360 str: 0.000 loss: -118.123]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.97it/s, atk: -117.014 ent: -5.357 str: 0.000 loss: -122.371]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.92it/s, atk: -117.014 ent: -5.357 str: 0.000 loss: -122.371]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.92it/s, atk: -120.465 ent: -5.354 str: 0.000 loss: -125.820]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.69it/s, atk: -120.465 ent: -5.354 str: 0.000 loss: -125.820]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.69it/s, atk: -123.958 ent: -5.354 str: 0.000 loss: -129.313]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.80it/s, atk: -123.958 ent: -5.354 str: 0.000 loss: -129.313]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.80it/s, atk: -129.019 ent: -5.353 str: 0.000 loss: -134.372]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.86it/s, atk: -129.019 ent: -5.353 str: 0.000 loss: -134.372]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.86it/s, atk: -132.410 ent: -5.351 str: 0.000 loss: -137.761]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -132.410 ent: -5.351 str: 0.000 loss: -137.761]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.91it/s, atk: -134.899 ent: -5.349 str: 0.000 loss: -140.249]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -134.899 ent: -5.349 str: 0.000 loss: -140.249]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.94it/s, atk: -137.616 ent: -5.347 str: 0.000 loss: -142.963]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -137.616 ent: -5.347 str: 0.000 loss: -142.963]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.89it/s, atk: -137.616 ent: -5.347 str: 0.000 loss: -142.963]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([583], device='cuda:0') tensor(0.6493, device='cuda:0')
after_true: tensor([815], device='cuda:0') tensor(6.4548e-07, device='cuda:0')
L1: [4266.416]	L2: [26.939053]	Linf: [0.7058824]

Accuracy on benign examples: 100.0%
gt_label: 961 pred_label: 961 pred_clean_logit 0.983132004737854
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  4.53it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.78it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.55it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 20.50it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 22.24it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 23.90it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.08it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.60it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.74s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.97s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.45s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.22s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3885
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.288 ent: -2.564 str: 0.000 loss: -2.852]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.17s/it, atk: -0.288 ent: -2.564 str: 0.000 loss: -2.852]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.17s/it, atk: -2.877 ent: -2.566 str: 0.000 loss: -5.443]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.10s/it, atk: -2.877 ent: -2.566 str: 0.000 loss: -5.443]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.10s/it, atk: -5.414 ent: -2.568 str: 0.000 loss: -7.981]Iterations:  10%|█         | 3/30 [00:03<00:32,  1.22s/it, atk: -5.414 ent: -2.568 str: 0.000 loss: -7.981]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.22s/it, atk: -11.268 ent: -2.565 str: 0.000 loss: -13.833]Iterations:  13%|█▎        | 4/30 [00:04<00:30,  1.15s/it, atk: -11.268 ent: -2.565 str: 0.000 loss: -13.833]Iterations:  13%|█▎        | 4/30 [00:05<00:30,  1.15s/it, atk: -18.269 ent: -2.564 str: 0.000 loss: -20.833]Iterations:  17%|█▋        | 5/30 [00:05<00:28,  1.12s/it, atk: -18.269 ent: -2.564 str: 0.000 loss: -20.833]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.12s/it, atk: -25.244 ent: -2.565 str: 0.000 loss: -27.809]Iterations:  20%|██        | 6/30 [00:06<00:26,  1.10s/it, atk: -25.244 ent: -2.565 str: 0.000 loss: -27.809]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.10s/it, atk: -31.771 ent: -2.565 str: 0.000 loss: -34.336]Iterations:  23%|██▎       | 7/30 [00:07<00:25,  1.10s/it, atk: -31.771 ent: -2.565 str: 0.000 loss: -34.336]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -37.531 ent: -2.563 str: 0.000 loss: -40.095]Iterations:  27%|██▋       | 8/30 [00:08<00:23,  1.09s/it, atk: -37.531 ent: -2.563 str: 0.000 loss: -40.095]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.09s/it, atk: -42.028 ent: -2.562 str: 0.000 loss: -44.591]Iterations:  30%|███       | 9/30 [00:09<00:22,  1.08s/it, atk: -42.028 ent: -2.562 str: 0.000 loss: -44.591]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.08s/it, atk: -47.049 ent: -2.562 str: 0.000 loss: -49.611]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.08s/it, atk: -47.049 ent: -2.562 str: 0.000 loss: -49.611]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.08s/it, atk: -51.748 ent: -2.562 str: 0.000 loss: -54.310]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -51.748 ent: -2.562 str: 0.000 loss: -54.310]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -55.794 ent: -2.561 str: 0.000 loss: -58.355]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -55.794 ent: -2.561 str: 0.000 loss: -58.355]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -59.876 ent: -2.560 str: 0.000 loss: -62.436]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.08s/it, atk: -59.876 ent: -2.560 str: 0.000 loss: -62.436]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.08s/it, atk: -63.720 ent: -2.559 str: 0.000 loss: -66.278]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.07s/it, atk: -63.720 ent: -2.559 str: 0.000 loss: -66.278]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.07s/it, atk: -67.215 ent: -2.558 str: 0.000 loss: -69.773]Iterations:  50%|█████     | 15/30 [00:16<00:16,  1.07s/it, atk: -67.215 ent: -2.558 str: 0.000 loss: -69.773]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.07s/it, atk: -70.351 ent: -2.557 str: 0.000 loss: -72.908]Iterations:  53%|█████▎    | 16/30 [00:17<00:15,  1.08s/it, atk: -70.351 ent: -2.557 str: 0.000 loss: -72.908]Iterations:  53%|█████▎    | 16/30 [00:18<00:15,  1.08s/it, atk: -73.030 ent: -2.556 str: 0.000 loss: -75.586]Iterations:  57%|█████▋    | 17/30 [00:18<00:14,  1.08s/it, atk: -73.030 ent: -2.556 str: 0.000 loss: -75.586]Iterations:  57%|█████▋    | 17/30 [00:19<00:14,  1.08s/it, atk: -75.379 ent: -2.555 str: 0.000 loss: -77.934]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.08s/it, atk: -75.379 ent: -2.555 str: 0.000 loss: -77.934]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.08s/it, atk: -77.665 ent: -2.554 str: 0.000 loss: -80.219]Iterations:  63%|██████▎   | 19/30 [00:20<00:11,  1.07s/it, atk: -77.665 ent: -2.554 str: 0.000 loss: -80.219]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -79.632 ent: -2.553 str: 0.000 loss: -82.185]Iterations:  67%|██████▋   | 20/30 [00:21<00:10,  1.09s/it, atk: -79.632 ent: -2.553 str: 0.000 loss: -82.185]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.09s/it, atk: -81.517 ent: -2.552 str: 0.000 loss: -84.069]Iterations:  70%|███████   | 21/30 [00:22<00:09,  1.08s/it, atk: -81.517 ent: -2.552 str: 0.000 loss: -84.069]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.08s/it, atk: -83.490 ent: -2.551 str: 0.000 loss: -86.041]Iterations:  73%|███████▎  | 22/30 [00:23<00:08,  1.08s/it, atk: -83.490 ent: -2.551 str: 0.000 loss: -86.041]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.08s/it, atk: -85.421 ent: -2.551 str: 0.000 loss: -87.972]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -85.421 ent: -2.551 str: 0.000 loss: -87.972]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -87.216 ent: -2.550 str: 0.000 loss: -89.766]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.09s/it, atk: -87.216 ent: -2.550 str: 0.000 loss: -89.766]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.09s/it, atk: -88.981 ent: -2.550 str: 0.000 loss: -91.531]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.08s/it, atk: -88.981 ent: -2.550 str: 0.000 loss: -91.531]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.08s/it, atk: -90.799 ent: -2.549 str: 0.000 loss: -93.349]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.09s/it, atk: -90.799 ent: -2.549 str: 0.000 loss: -93.349]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.09s/it, atk: -92.518 ent: -2.549 str: 0.000 loss: -95.067]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.07s/it, atk: -92.518 ent: -2.549 str: 0.000 loss: -95.067]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.07s/it, atk: -94.030 ent: -2.549 str: 0.000 loss: -96.579]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.07s/it, atk: -94.030 ent: -2.549 str: 0.000 loss: -96.579]Iterations:  93%|█████████▎| 28/30 [00:31<00:02,  1.07s/it, atk: -95.310 ent: -2.549 str: 0.000 loss: -97.859]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.07s/it, atk: -95.310 ent: -2.549 str: 0.000 loss: -97.859]Iterations:  97%|█████████▋| 29/30 [00:32<00:01,  1.07s/it, atk: -96.938 ent: -2.549 str: 0.000 loss: -99.486]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.08s/it, atk: -96.938 ent: -2.549 str: 0.000 loss: -99.486]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.09s/it, atk: -96.938 ent: -2.549 str: 0.000 loss: -99.486]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([825], device='cuda:0') tensor(0.1317, device='cuda:0')
after_true: tensor([961], device='cuda:0') tensor(5.3803e-05, device='cuda:0')
L1: [1789.7137]	L2: [11.924636]	Linf: [0.46274513]

Accuracy on benign examples: 0.0%
gt_label: 538 pred_label: 884 pred_clean_logit 0.3732817471027374
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.21it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.80it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 10.79it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 11.15it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 11.83it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 11.99it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 11.98it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 12.05it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 12.01it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.24it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.50it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.85s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.91s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3961
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -9.296 ent: -2.534 str: 0.000 loss: -11.831]Iterations:   3%|▎         | 1/30 [00:00<00:21,  1.36it/s, atk: -9.296 ent: -2.534 str: 0.000 loss: -11.831]Iterations:   3%|▎         | 1/30 [00:01<00:21,  1.36it/s, atk: -12.807 ent: -2.535 str: 0.000 loss: -15.342]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.61it/s, atk: -12.807 ent: -2.535 str: 0.000 loss: -15.342]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.61it/s, atk: -16.133 ent: -2.533 str: 0.000 loss: -18.666]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.76it/s, atk: -16.133 ent: -2.533 str: 0.000 loss: -18.666]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.76it/s, atk: -19.136 ent: -2.531 str: 0.000 loss: -21.667]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -19.136 ent: -2.531 str: 0.000 loss: -21.667]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -21.836 ent: -2.530 str: 0.000 loss: -24.366]Iterations:  17%|█▋        | 5/30 [00:02<00:14,  1.78it/s, atk: -21.836 ent: -2.530 str: 0.000 loss: -24.366]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.78it/s, atk: -24.149 ent: -2.529 str: 0.000 loss: -26.677]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.80it/s, atk: -24.149 ent: -2.529 str: 0.000 loss: -26.677]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.80it/s, atk: -26.729 ent: -2.528 str: 0.000 loss: -29.257]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.90it/s, atk: -26.729 ent: -2.528 str: 0.000 loss: -29.257]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.90it/s, atk: -29.174 ent: -2.528 str: 0.000 loss: -31.702]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -29.174 ent: -2.528 str: 0.000 loss: -31.702]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -31.383 ent: -2.528 str: 0.000 loss: -33.911]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.92it/s, atk: -31.383 ent: -2.528 str: 0.000 loss: -33.911]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.92it/s, atk: -33.314 ent: -2.529 str: 0.000 loss: -35.843]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -33.314 ent: -2.529 str: 0.000 loss: -35.843]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -35.439 ent: -2.528 str: 0.000 loss: -37.967]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.86it/s, atk: -35.439 ent: -2.528 str: 0.000 loss: -37.967]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.86it/s, atk: -37.286 ent: -2.528 str: 0.000 loss: -39.814]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.88it/s, atk: -37.286 ent: -2.528 str: 0.000 loss: -39.814]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.88it/s, atk: -39.114 ent: -2.528 str: 0.000 loss: -41.642]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -39.114 ent: -2.528 str: 0.000 loss: -41.642]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -40.787 ent: -2.527 str: 0.000 loss: -43.314]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -40.787 ent: -2.527 str: 0.000 loss: -43.314]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -42.339 ent: -2.527 str: 0.000 loss: -44.866]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -42.339 ent: -2.527 str: 0.000 loss: -44.866]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -43.806 ent: -2.526 str: 0.000 loss: -46.332]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -43.806 ent: -2.526 str: 0.000 loss: -46.332]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -45.408 ent: -2.526 str: 0.000 loss: -47.934]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -45.408 ent: -2.526 str: 0.000 loss: -47.934]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -47.101 ent: -2.525 str: 0.000 loss: -49.626]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -47.101 ent: -2.525 str: 0.000 loss: -49.626]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -48.622 ent: -2.524 str: 0.000 loss: -51.146]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -48.622 ent: -2.524 str: 0.000 loss: -51.146]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -50.071 ent: -2.524 str: 0.000 loss: -52.594]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -50.071 ent: -2.524 str: 0.000 loss: -52.594]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -51.426 ent: -2.523 str: 0.000 loss: -53.949]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.85it/s, atk: -51.426 ent: -2.523 str: 0.000 loss: -53.949]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.85it/s, atk: -52.943 ent: -2.523 str: 0.000 loss: -55.466]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.91it/s, atk: -52.943 ent: -2.523 str: 0.000 loss: -55.466]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.91it/s, atk: -54.529 ent: -2.523 str: 0.000 loss: -57.052]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.93it/s, atk: -54.529 ent: -2.523 str: 0.000 loss: -57.052]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.93it/s, atk: -55.998 ent: -2.523 str: 0.000 loss: -58.522]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.95it/s, atk: -55.998 ent: -2.523 str: 0.000 loss: -58.522]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.95it/s, atk: -57.466 ent: -2.523 str: 0.000 loss: -59.989]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -57.466 ent: -2.523 str: 0.000 loss: -59.989]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -58.758 ent: -2.523 str: 0.000 loss: -61.281]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -58.758 ent: -2.523 str: 0.000 loss: -61.281]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -60.069 ent: -2.523 str: 0.000 loss: -62.592]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -60.069 ent: -2.523 str: 0.000 loss: -62.592]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -61.324 ent: -2.522 str: 0.000 loss: -63.846]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  2.00it/s, atk: -61.324 ent: -2.522 str: 0.000 loss: -63.846]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  2.00it/s, atk: -62.705 ent: -2.522 str: 0.000 loss: -65.226]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -62.705 ent: -2.522 str: 0.000 loss: -65.226]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -63.996 ent: -2.521 str: 0.000 loss: -66.517]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.01it/s, atk: -63.996 ent: -2.521 str: 0.000 loss: -66.517]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.91it/s, atk: -63.996 ent: -2.521 str: 0.000 loss: -66.517]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([884], device='cuda:0') tensor(0.9360, device='cuda:0')
after_true: tensor([538], device='cuda:0') tensor(0.0015, device='cuda:0')
L1: [3569.6587]	L2: [21.143906]	Linf: [0.4901961]

Accuracy on benign examples: 100.0%
gt_label: 113 pred_label: 113 pred_clean_logit 0.9990886449813843
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:04,  3.70it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.87it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.81it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.44it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.09it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.19it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 20.14it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.03s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.07s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.15s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.42s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.29s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2889
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.035 ent: -2.667 str: 0.000 loss: -2.702]Iterations:   3%|▎         | 1/30 [00:00<00:25,  1.12it/s, atk: -0.035 ent: -2.667 str: 0.000 loss: -2.702]Iterations:   3%|▎         | 1/30 [00:01<00:25,  1.12it/s, atk: -0.091 ent: -2.692 str: 0.000 loss: -2.782]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.49it/s, atk: -0.091 ent: -2.692 str: 0.000 loss: -2.782]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.49it/s, atk: -0.651 ent: -2.701 str: 0.000 loss: -3.352]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.70it/s, atk: -0.651 ent: -2.701 str: 0.000 loss: -3.352]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.70it/s, atk: -0.988 ent: -2.693 str: 0.000 loss: -3.681]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -0.988 ent: -2.693 str: 0.000 loss: -3.681]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -1.741 ent: -2.693 str: 0.000 loss: -4.434]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.86it/s, atk: -1.741 ent: -2.693 str: 0.000 loss: -4.434]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.86it/s, atk: -6.081 ent: -2.691 str: 0.000 loss: -8.772]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.86it/s, atk: -6.081 ent: -2.691 str: 0.000 loss: -8.772]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.86it/s, atk: -9.253 ent: -2.685 str: 0.000 loss: -11.938]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -9.253 ent: -2.685 str: 0.000 loss: -11.938]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.93it/s, atk: -18.948 ent: -2.688 str: 0.000 loss: -21.636]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -18.948 ent: -2.688 str: 0.000 loss: -21.636]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -23.463 ent: -2.688 str: 0.000 loss: -26.150]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.97it/s, atk: -23.463 ent: -2.688 str: 0.000 loss: -26.150]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.97it/s, atk: -34.483 ent: -2.691 str: 0.000 loss: -37.174]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -34.483 ent: -2.691 str: 0.000 loss: -37.174]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.96it/s, atk: -38.009 ent: -2.686 str: 0.000 loss: -40.695]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.98it/s, atk: -38.009 ent: -2.686 str: 0.000 loss: -40.695]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.98it/s, atk: -47.324 ent: -2.688 str: 0.000 loss: -50.012]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -47.324 ent: -2.688 str: 0.000 loss: -50.012]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -52.218 ent: -2.694 str: 0.000 loss: -54.912]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.00it/s, atk: -52.218 ent: -2.694 str: 0.000 loss: -54.912]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.00it/s, atk: -59.263 ent: -2.694 str: 0.000 loss: -61.957]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -59.263 ent: -2.694 str: 0.000 loss: -61.957]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -65.293 ent: -2.697 str: 0.000 loss: -67.990]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.93it/s, atk: -65.293 ent: -2.697 str: 0.000 loss: -67.990]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -72.509 ent: -2.695 str: 0.000 loss: -75.205]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -72.509 ent: -2.695 str: 0.000 loss: -75.205]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -72.708 ent: -2.689 str: 0.000 loss: -75.397]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -72.708 ent: -2.689 str: 0.000 loss: -75.397]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -77.898 ent: -2.688 str: 0.000 loss: -80.587]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -77.898 ent: -2.688 str: 0.000 loss: -80.587]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -81.497 ent: -2.689 str: 0.000 loss: -84.185]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.99it/s, atk: -81.497 ent: -2.689 str: 0.000 loss: -84.185]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.99it/s, atk: -86.605 ent: -2.690 str: 0.000 loss: -89.295]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -86.605 ent: -2.690 str: 0.000 loss: -89.295]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -92.263 ent: -2.691 str: 0.000 loss: -94.953]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -92.263 ent: -2.691 str: 0.000 loss: -94.953]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -98.779 ent: -2.693 str: 0.000 loss: -101.472]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -98.779 ent: -2.693 str: 0.000 loss: -101.472]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.96it/s, atk: -105.548 ent: -2.695 str: 0.000 loss: -108.242]Iterations:  77%|███████▋  | 23/30 [00:12<00:04,  1.67it/s, atk: -105.548 ent: -2.695 str: 0.000 loss: -108.242]Iterations:  77%|███████▋  | 23/30 [00:12<00:04,  1.67it/s, atk: -112.295 ent: -2.697 str: 0.000 loss: -114.992]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.72it/s, atk: -112.295 ent: -2.697 str: 0.000 loss: -114.992]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.72it/s, atk: -119.146 ent: -2.698 str: 0.000 loss: -121.844]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.80it/s, atk: -119.146 ent: -2.698 str: 0.000 loss: -121.844]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.80it/s, atk: -126.536 ent: -2.699 str: 0.000 loss: -129.235]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.86it/s, atk: -126.536 ent: -2.699 str: 0.000 loss: -129.235]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.86it/s, atk: -133.753 ent: -2.701 str: 0.000 loss: -136.454]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.87it/s, atk: -133.753 ent: -2.701 str: 0.000 loss: -136.454]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.87it/s, atk: -141.305 ent: -2.703 str: 0.000 loss: -144.008]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.91it/s, atk: -141.305 ent: -2.703 str: 0.000 loss: -144.008]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.91it/s, atk: -147.369 ent: -2.705 str: 0.000 loss: -150.074]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.89it/s, atk: -147.369 ent: -2.705 str: 0.000 loss: -150.074]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.89it/s, atk: -152.486 ent: -2.707 str: 0.000 loss: -155.193]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.92it/s, atk: -152.486 ent: -2.707 str: 0.000 loss: -155.193]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.88it/s, atk: -152.486 ent: -2.707 str: 0.000 loss: -155.193]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([126], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([113], device='cuda:0') tensor(1.5111e-07, device='cuda:0')
L1: [2071.8748]	L2: [13.400206]	Linf: [0.5568627]

Accuracy on benign examples: 0.0%
gt_label: 877 pred_label: 424 pred_clean_logit 0.09430965781211853
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 26.83it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.33it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.29it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.07it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.02it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.93it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.27s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.18s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.36s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.30s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4873
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -24.978 ent: -7.643 str: 0.000 loss: -32.621]Iterations:   3%|▎         | 1/30 [00:01<00:36,  1.26s/it, atk: -24.978 ent: -7.643 str: 0.000 loss: -32.621]Iterations:   3%|▎         | 1/30 [00:01<00:36,  1.26s/it, atk: -30.729 ent: -7.652 str: 0.000 loss: -38.380]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.22it/s, atk: -30.729 ent: -7.652 str: 0.000 loss: -38.380]Iterations:   7%|▋         | 2/30 [00:02<00:22,  1.22it/s, atk: -34.984 ent: -7.643 str: 0.000 loss: -42.627]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.47it/s, atk: -34.984 ent: -7.643 str: 0.000 loss: -42.627]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.47it/s, atk: -39.709 ent: -7.640 str: 0.000 loss: -47.348]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.62it/s, atk: -39.709 ent: -7.640 str: 0.000 loss: -47.348]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.62it/s, atk: -43.570 ent: -7.638 str: 0.000 loss: -51.208]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.73it/s, atk: -43.570 ent: -7.638 str: 0.000 loss: -51.208]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.73it/s, atk: -47.358 ent: -7.634 str: 0.000 loss: -54.993]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.82it/s, atk: -47.358 ent: -7.634 str: 0.000 loss: -54.993]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.82it/s, atk: -51.086 ent: -7.629 str: 0.000 loss: -58.716]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.85it/s, atk: -51.086 ent: -7.629 str: 0.000 loss: -58.716]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.85it/s, atk: -56.272 ent: -7.624 str: 0.000 loss: -63.896]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.85it/s, atk: -56.272 ent: -7.624 str: 0.000 loss: -63.896]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.85it/s, atk: -61.288 ent: -7.618 str: 0.000 loss: -68.906]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.85it/s, atk: -61.288 ent: -7.618 str: 0.000 loss: -68.906]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.85it/s, atk: -65.366 ent: -7.611 str: 0.000 loss: -72.977]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.88it/s, atk: -65.366 ent: -7.611 str: 0.000 loss: -72.977]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.88it/s, atk: -69.116 ent: -7.606 str: 0.000 loss: -76.722]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.86it/s, atk: -69.116 ent: -7.606 str: 0.000 loss: -76.722]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.86it/s, atk: -73.126 ent: -7.603 str: 0.000 loss: -80.729]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.89it/s, atk: -73.126 ent: -7.603 str: 0.000 loss: -80.729]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.89it/s, atk: -76.843 ent: -7.601 str: 0.000 loss: -84.444]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.90it/s, atk: -76.843 ent: -7.601 str: 0.000 loss: -84.444]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.90it/s, atk: -80.840 ent: -7.600 str: 0.000 loss: -88.440]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.94it/s, atk: -80.840 ent: -7.600 str: 0.000 loss: -88.440]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.94it/s, atk: -85.107 ent: -7.600 str: 0.000 loss: -92.708]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.94it/s, atk: -85.107 ent: -7.600 str: 0.000 loss: -92.708]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.94it/s, atk: -89.386 ent: -7.601 str: 0.000 loss: -96.987]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -89.386 ent: -7.601 str: 0.000 loss: -96.987]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -93.506 ent: -7.600 str: 0.000 loss: -101.106]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -93.506 ent: -7.600 str: 0.000 loss: -101.106]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.94it/s, atk: -98.015 ent: -7.598 str: 0.000 loss: -105.613]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.91it/s, atk: -98.015 ent: -7.598 str: 0.000 loss: -105.613]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.91it/s, atk: -101.188 ent: -7.596 str: 0.000 loss: -108.785]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.87it/s, atk: -101.188 ent: -7.596 str: 0.000 loss: -108.785]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.87it/s, atk: -105.569 ent: -7.595 str: 0.000 loss: -113.164]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.83it/s, atk: -105.569 ent: -7.595 str: 0.000 loss: -113.164]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.83it/s, atk: -109.741 ent: -7.595 str: 0.000 loss: -117.336]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.85it/s, atk: -109.741 ent: -7.595 str: 0.000 loss: -117.336]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.85it/s, atk: -115.275 ent: -7.594 str: 0.000 loss: -122.869]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.80it/s, atk: -115.275 ent: -7.594 str: 0.000 loss: -122.869]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.80it/s, atk: -119.476 ent: -7.594 str: 0.000 loss: -127.070]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.85it/s, atk: -119.476 ent: -7.594 str: 0.000 loss: -127.070]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.85it/s, atk: -124.227 ent: -7.593 str: 0.000 loss: -131.821]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.89it/s, atk: -124.227 ent: -7.593 str: 0.000 loss: -131.821]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.89it/s, atk: -131.047 ent: -7.592 str: 0.000 loss: -138.639]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.73it/s, atk: -131.047 ent: -7.592 str: 0.000 loss: -138.639]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.73it/s, atk: -137.269 ent: -7.591 str: 0.000 loss: -144.860]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.80it/s, atk: -137.269 ent: -7.591 str: 0.000 loss: -144.860]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.80it/s, atk: -142.977 ent: -7.591 str: 0.000 loss: -150.568]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.81it/s, atk: -142.977 ent: -7.591 str: 0.000 loss: -150.568]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.81it/s, atk: -148.935 ent: -7.591 str: 0.000 loss: -156.526]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.58it/s, atk: -148.935 ent: -7.591 str: 0.000 loss: -156.526]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.58it/s, atk: -154.445 ent: -7.591 str: 0.000 loss: -162.036]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.30it/s, atk: -154.445 ent: -7.591 str: 0.000 loss: -162.036]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  1.30it/s, atk: -160.283 ent: -7.590 str: 0.000 loss: -167.873]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.15it/s, atk: -160.283 ent: -7.590 str: 0.000 loss: -167.873]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.66it/s, atk: -160.283 ent: -7.590 str: 0.000 loss: -167.873]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([571], device='cuda:0') tensor(0.9994, device='cuda:0')
after_true: tensor([877], device='cuda:0') tensor(6.8082e-08, device='cuda:0')
L1: [2946.7961]	L2: [20.54411]	Linf: [0.6431373]

Accuracy on benign examples: 100.0%
gt_label: 821 pred_label: 821 pred_clean_logit 0.9936226010322571
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.17it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.42it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.15it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.09it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 11.08it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 11.84it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.13it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.05it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.05it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.12it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.91s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.93s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.09s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.29s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.32s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4832
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.066 ent: -7.499 str: 0.000 loss: -7.565]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.21s/it, atk: -0.066 ent: -7.499 str: 0.000 loss: -7.565]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.21s/it, atk: -0.064 ent: -7.481 str: 0.000 loss: -7.544]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -0.064 ent: -7.481 str: 0.000 loss: -7.544]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -0.121 ent: -7.519 str: 0.000 loss: -7.640]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.10s/it, atk: -0.121 ent: -7.519 str: 0.000 loss: -7.640]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.10s/it, atk: -0.201 ent: -7.528 str: 0.000 loss: -7.729]Iterations:  13%|█▎        | 4/30 [00:04<00:28,  1.09s/it, atk: -0.201 ent: -7.528 str: 0.000 loss: -7.729]Iterations:  13%|█▎        | 4/30 [00:05<00:28,  1.09s/it, atk: -0.390 ent: -7.514 str: 0.000 loss: -7.904]Iterations:  17%|█▋        | 5/30 [00:05<00:27,  1.09s/it, atk: -0.390 ent: -7.514 str: 0.000 loss: -7.904]Iterations:  17%|█▋        | 5/30 [00:06<00:27,  1.09s/it, atk: -0.600 ent: -7.498 str: 0.000 loss: -8.098]Iterations:  20%|██        | 6/30 [00:06<00:26,  1.09s/it, atk: -0.600 ent: -7.498 str: 0.000 loss: -8.098]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.09s/it, atk: -1.005 ent: -7.489 str: 0.000 loss: -8.495]Iterations:  23%|██▎       | 7/30 [00:07<00:24,  1.08s/it, atk: -1.005 ent: -7.489 str: 0.000 loss: -8.495]Iterations:  23%|██▎       | 7/30 [00:08<00:24,  1.08s/it, atk: -1.673 ent: -7.495 str: 0.000 loss: -9.168]Iterations:  27%|██▋       | 8/30 [00:08<00:23,  1.08s/it, atk: -1.673 ent: -7.495 str: 0.000 loss: -9.168]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.08s/it, atk: -2.794 ent: -7.496 str: 0.000 loss: -10.290]Iterations:  30%|███       | 9/30 [00:09<00:22,  1.08s/it, atk: -2.794 ent: -7.496 str: 0.000 loss: -10.290]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.08s/it, atk: -4.149 ent: -7.497 str: 0.000 loss: -11.646]Iterations:  33%|███▎      | 10/30 [00:10<00:21,  1.07s/it, atk: -4.149 ent: -7.497 str: 0.000 loss: -11.646]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.07s/it, atk: -6.405 ent: -7.498 str: 0.000 loss: -13.903]Iterations:  37%|███▋      | 11/30 [00:11<00:20,  1.07s/it, atk: -6.405 ent: -7.498 str: 0.000 loss: -13.903]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -8.278 ent: -7.491 str: 0.000 loss: -15.769]Iterations:  40%|████      | 12/30 [00:12<00:19,  1.06s/it, atk: -8.278 ent: -7.491 str: 0.000 loss: -15.769]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.06s/it, atk: -12.013 ent: -7.485 str: 0.000 loss: -19.498]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.06s/it, atk: -12.013 ent: -7.485 str: 0.000 loss: -19.498]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.06s/it, atk: -15.707 ent: -7.481 str: 0.000 loss: -23.188]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.06s/it, atk: -15.707 ent: -7.481 str: 0.000 loss: -23.188]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.06s/it, atk: -19.079 ent: -7.484 str: 0.000 loss: -26.563]Iterations:  50%|█████     | 15/30 [00:16<00:15,  1.06s/it, atk: -19.079 ent: -7.484 str: 0.000 loss: -26.563]Iterations:  50%|█████     | 15/30 [00:16<00:15,  1.06s/it, atk: -22.490 ent: -7.483 str: 0.000 loss: -29.973]Iterations:  53%|█████▎    | 16/30 [00:17<00:14,  1.06s/it, atk: -22.490 ent: -7.483 str: 0.000 loss: -29.973]Iterations:  53%|█████▎    | 16/30 [00:17<00:14,  1.06s/it, atk: -26.354 ent: -7.481 str: 0.000 loss: -33.834]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.07s/it, atk: -26.354 ent: -7.481 str: 0.000 loss: -33.834]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.07s/it, atk: -30.395 ent: -7.481 str: 0.000 loss: -37.876]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.07s/it, atk: -30.395 ent: -7.481 str: 0.000 loss: -37.876]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.07s/it, atk: -35.078 ent: -7.479 str: 0.000 loss: -42.557]Iterations:  63%|██████▎   | 19/30 [00:20<00:11,  1.07s/it, atk: -35.078 ent: -7.479 str: 0.000 loss: -42.557]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -39.376 ent: -7.474 str: 0.000 loss: -46.850]Iterations:  67%|██████▋   | 20/30 [00:21<00:10,  1.07s/it, atk: -39.376 ent: -7.474 str: 0.000 loss: -46.850]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.07s/it, atk: -42.959 ent: -7.473 str: 0.000 loss: -50.433]Iterations:  70%|███████   | 21/30 [00:22<00:09,  1.07s/it, atk: -42.959 ent: -7.473 str: 0.000 loss: -50.433]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.07s/it, atk: -46.282 ent: -7.471 str: 0.000 loss: -53.753]Iterations:  73%|███████▎  | 22/30 [00:23<00:08,  1.07s/it, atk: -46.282 ent: -7.471 str: 0.000 loss: -53.753]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -50.468 ent: -7.474 str: 0.000 loss: -57.943]Iterations:  77%|███████▋  | 23/30 [00:24<00:07,  1.07s/it, atk: -50.468 ent: -7.474 str: 0.000 loss: -57.943]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -54.612 ent: -7.473 str: 0.000 loss: -62.085]Iterations:  80%|████████  | 24/30 [00:25<00:06,  1.07s/it, atk: -54.612 ent: -7.473 str: 0.000 loss: -62.085]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -58.621 ent: -7.470 str: 0.000 loss: -66.091]Iterations:  83%|████████▎ | 25/30 [00:26<00:05,  1.07s/it, atk: -58.621 ent: -7.470 str: 0.000 loss: -66.091]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.07s/it, atk: -62.898 ent: -7.469 str: 0.000 loss: -70.367]Iterations:  87%|████████▋ | 26/30 [00:27<00:04,  1.07s/it, atk: -62.898 ent: -7.469 str: 0.000 loss: -70.367]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.07s/it, atk: -65.321 ent: -7.467 str: 0.000 loss: -72.788]Iterations:  90%|█████████ | 27/30 [00:28<00:03,  1.07s/it, atk: -65.321 ent: -7.467 str: 0.000 loss: -72.788]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.07s/it, atk: -67.750 ent: -7.465 str: 0.000 loss: -75.215]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.07s/it, atk: -67.750 ent: -7.465 str: 0.000 loss: -75.215]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.07s/it, atk: -71.519 ent: -7.464 str: 0.000 loss: -78.983]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.06s/it, atk: -71.519 ent: -7.464 str: 0.000 loss: -78.983]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.06s/it, atk: -75.220 ent: -7.465 str: 0.000 loss: -82.684]Iterations: 100%|██████████| 30/30 [00:31<00:00,  1.12it/s, atk: -75.220 ent: -7.465 str: 0.000 loss: -82.684]Iterations: 100%|██████████| 30/30 [00:31<00:00,  1.05s/it, atk: -75.220 ent: -7.465 str: 0.000 loss: -82.684]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([914], device='cuda:0') tensor(0.5223, device='cuda:0')
after_true: tensor([821], device='cuda:0') tensor(0.0004, device='cuda:0')
L1: [2096.7646]	L2: [15.159716]	Linf: [0.6627451]

Accuracy on benign examples: 100.0%
gt_label: 366 pred_label: 366 pred_clean_logit 0.9991255402565002
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.48it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.24it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 21.91it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 23.58it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 24.61it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.35it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.73it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.06it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.05it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:02,  1.02s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.10s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.22s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.13s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4873
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.020 ent: -2.590 str: 0.000 loss: -2.610]Iterations:   3%|▎         | 1/30 [00:01<00:32,  1.11s/it, atk: -0.020 ent: -2.590 str: 0.000 loss: -2.610]Iterations:   3%|▎         | 1/30 [00:01<00:32,  1.11s/it, atk: -0.049 ent: -2.628 str: 0.000 loss: -2.677]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.33it/s, atk: -0.049 ent: -2.628 str: 0.000 loss: -2.677]Iterations:   7%|▋         | 2/30 [00:02<00:21,  1.33it/s, atk: -0.213 ent: -2.632 str: 0.000 loss: -2.846]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.25it/s, atk: -0.213 ent: -2.632 str: 0.000 loss: -2.846]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.25it/s, atk: -0.728 ent: -2.631 str: 0.000 loss: -3.359]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -0.728 ent: -2.631 str: 0.000 loss: -3.359]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -2.075 ent: -2.627 str: 0.000 loss: -4.701]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.57it/s, atk: -2.075 ent: -2.627 str: 0.000 loss: -4.701]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.57it/s, atk: -7.947 ent: -2.621 str: 0.000 loss: -10.568]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.70it/s, atk: -7.947 ent: -2.621 str: 0.000 loss: -10.568]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.70it/s, atk: -11.730 ent: -2.620 str: 0.000 loss: -14.350]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.79it/s, atk: -11.730 ent: -2.620 str: 0.000 loss: -14.350]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.79it/s, atk: -27.004 ent: -2.615 str: 0.000 loss: -29.619]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.82it/s, atk: -27.004 ent: -2.615 str: 0.000 loss: -29.619]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.82it/s, atk: -40.335 ent: -2.611 str: 0.000 loss: -42.946]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.86it/s, atk: -40.335 ent: -2.611 str: 0.000 loss: -42.946]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.86it/s, atk: -50.134 ent: -2.612 str: 0.000 loss: -52.746]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.90it/s, atk: -50.134 ent: -2.612 str: 0.000 loss: -52.746]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.90it/s, atk: -61.862 ent: -2.611 str: 0.000 loss: -64.473]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -61.862 ent: -2.611 str: 0.000 loss: -64.473]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -74.835 ent: -2.610 str: 0.000 loss: -77.445]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.83it/s, atk: -74.835 ent: -2.610 str: 0.000 loss: -77.445]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.83it/s, atk: -88.036 ent: -2.611 str: 0.000 loss: -90.647]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.85it/s, atk: -88.036 ent: -2.611 str: 0.000 loss: -90.647]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.85it/s, atk: -102.814 ent: -2.613 str: 0.000 loss: -105.427]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.89it/s, atk: -102.814 ent: -2.613 str: 0.000 loss: -105.427]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.89it/s, atk: -117.976 ent: -2.612 str: 0.000 loss: -120.588]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.88it/s, atk: -117.976 ent: -2.612 str: 0.000 loss: -120.588]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.88it/s, atk: -130.146 ent: -2.611 str: 0.000 loss: -132.757]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.90it/s, atk: -130.146 ent: -2.611 str: 0.000 loss: -132.757]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.90it/s, atk: -146.608 ent: -2.613 str: 0.000 loss: -149.221]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.93it/s, atk: -146.608 ent: -2.613 str: 0.000 loss: -149.221]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.93it/s, atk: -159.599 ent: -2.613 str: 0.000 loss: -162.212]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.96it/s, atk: -159.599 ent: -2.613 str: 0.000 loss: -162.212]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.96it/s, atk: -170.676 ent: -2.607 str: 0.000 loss: -173.284]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.91it/s, atk: -170.676 ent: -2.607 str: 0.000 loss: -173.284]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  1.91it/s, atk: -179.439 ent: -2.607 str: 0.000 loss: -182.046]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.93it/s, atk: -179.439 ent: -2.607 str: 0.000 loss: -182.046]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.93it/s, atk: -190.794 ent: -2.609 str: 0.000 loss: -193.402]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.95it/s, atk: -190.794 ent: -2.609 str: 0.000 loss: -193.402]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.95it/s, atk: -200.793 ent: -2.607 str: 0.000 loss: -203.400]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.90it/s, atk: -200.793 ent: -2.607 str: 0.000 loss: -203.400]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.90it/s, atk: -211.342 ent: -2.603 str: 0.000 loss: -213.945]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -211.342 ent: -2.603 str: 0.000 loss: -213.945]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.94it/s, atk: -222.016 ent: -2.604 str: 0.000 loss: -224.620]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -222.016 ent: -2.604 str: 0.000 loss: -224.620]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -229.649 ent: -2.607 str: 0.000 loss: -232.256]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.96it/s, atk: -229.649 ent: -2.607 str: 0.000 loss: -232.256]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.96it/s, atk: -236.116 ent: -2.605 str: 0.000 loss: -238.721]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -236.116 ent: -2.605 str: 0.000 loss: -238.721]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -243.029 ent: -2.601 str: 0.000 loss: -245.630]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -243.029 ent: -2.601 str: 0.000 loss: -245.630]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.97it/s, atk: -249.782 ent: -2.599 str: 0.000 loss: -252.381]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.90it/s, atk: -249.782 ent: -2.599 str: 0.000 loss: -252.381]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.90it/s, atk: -257.723 ent: -2.600 str: 0.000 loss: -260.323]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.91it/s, atk: -257.723 ent: -2.600 str: 0.000 loss: -260.323]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.91it/s, atk: -259.355 ent: -2.598 str: 0.000 loss: -261.952]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.94it/s, atk: -259.355 ent: -2.598 str: 0.000 loss: -261.952]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.82it/s, atk: -259.355 ent: -2.598 str: 0.000 loss: -261.952]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([181], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([366], device='cuda:0') tensor(2.1546e-12, device='cuda:0')
L1: [1966.3097]	L2: [12.447976]	Linf: [0.40784314]

Accuracy on benign examples: 100.0%
gt_label: 762 pred_label: 762 pred_clean_logit 0.6063629388809204
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.46it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.68it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.17it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 24.25it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 24.88it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.27it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.02it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.13it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.10it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.04s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.35s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.21s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3843
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -8.489 ent: -2.522 str: 0.000 loss: -11.011]Iterations:   3%|▎         | 1/30 [00:00<00:20,  1.39it/s, atk: -8.489 ent: -2.522 str: 0.000 loss: -11.011]Iterations:   3%|▎         | 1/30 [00:00<00:20,  1.39it/s, atk: -15.848 ent: -2.530 str: 0.000 loss: -18.378]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.70it/s, atk: -15.848 ent: -2.530 str: 0.000 loss: -18.378]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.70it/s, atk: -22.033 ent: -2.533 str: 0.000 loss: -24.566]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.81it/s, atk: -22.033 ent: -2.533 str: 0.000 loss: -24.566]Iterations:  10%|█         | 3/30 [00:02<00:14,  1.81it/s, atk: -26.420 ent: -2.534 str: 0.000 loss: -28.954]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.86it/s, atk: -26.420 ent: -2.534 str: 0.000 loss: -28.954]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.86it/s, atk: -33.116 ent: -2.534 str: 0.000 loss: -35.651]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.92it/s, atk: -33.116 ent: -2.534 str: 0.000 loss: -35.651]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.92it/s, atk: -38.382 ent: -2.534 str: 0.000 loss: -40.916]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.96it/s, atk: -38.382 ent: -2.534 str: 0.000 loss: -40.916]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.96it/s, atk: -43.520 ent: -2.534 str: 0.000 loss: -46.055]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.99it/s, atk: -43.520 ent: -2.534 str: 0.000 loss: -46.055]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.99it/s, atk: -49.615 ent: -2.533 str: 0.000 loss: -52.148]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  2.00it/s, atk: -49.615 ent: -2.533 str: 0.000 loss: -52.148]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  2.00it/s, atk: -55.764 ent: -2.531 str: 0.000 loss: -58.296]Iterations:  30%|███       | 9/30 [00:04<00:11,  1.83it/s, atk: -55.764 ent: -2.531 str: 0.000 loss: -58.296]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.83it/s, atk: -60.624 ent: -2.530 str: 0.000 loss: -63.155]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.88it/s, atk: -60.624 ent: -2.530 str: 0.000 loss: -63.155]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.88it/s, atk: -66.353 ent: -2.530 str: 0.000 loss: -68.883]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.92it/s, atk: -66.353 ent: -2.530 str: 0.000 loss: -68.883]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.92it/s, atk: -72.075 ent: -2.529 str: 0.000 loss: -74.604]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.85it/s, atk: -72.075 ent: -2.529 str: 0.000 loss: -74.604]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.85it/s, atk: -77.670 ent: -2.529 str: 0.000 loss: -80.199]Iterations:  43%|████▎     | 13/30 [00:06<00:09,  1.89it/s, atk: -77.670 ent: -2.529 str: 0.000 loss: -80.199]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.89it/s, atk: -82.590 ent: -2.528 str: 0.000 loss: -85.118]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.93it/s, atk: -82.590 ent: -2.528 str: 0.000 loss: -85.118]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.93it/s, atk: -87.062 ent: -2.527 str: 0.000 loss: -89.589]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.94it/s, atk: -87.062 ent: -2.527 str: 0.000 loss: -89.589]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.94it/s, atk: -90.966 ent: -2.526 str: 0.000 loss: -93.492]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.97it/s, atk: -90.966 ent: -2.526 str: 0.000 loss: -93.492]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.97it/s, atk: -95.510 ent: -2.526 str: 0.000 loss: -98.036]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.99it/s, atk: -95.510 ent: -2.526 str: 0.000 loss: -98.036]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.99it/s, atk: -99.160 ent: -2.526 str: 0.000 loss: -101.686]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -99.160 ent: -2.526 str: 0.000 loss: -101.686]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -103.093 ent: -2.526 str: 0.000 loss: -105.619]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.98it/s, atk: -103.093 ent: -2.526 str: 0.000 loss: -105.619]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.98it/s, atk: -107.496 ent: -2.525 str: 0.000 loss: -110.021]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.00it/s, atk: -107.496 ent: -2.525 str: 0.000 loss: -110.021]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.00it/s, atk: -112.355 ent: -2.524 str: 0.000 loss: -114.879]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.00it/s, atk: -112.355 ent: -2.524 str: 0.000 loss: -114.879]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.00it/s, atk: -116.405 ent: -2.523 str: 0.000 loss: -118.928]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.95it/s, atk: -116.405 ent: -2.523 str: 0.000 loss: -118.928]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.95it/s, atk: -119.646 ent: -2.523 str: 0.000 loss: -122.169]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.95it/s, atk: -119.646 ent: -2.523 str: 0.000 loss: -122.169]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.95it/s, atk: -123.289 ent: -2.523 str: 0.000 loss: -125.812]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.95it/s, atk: -123.289 ent: -2.523 str: 0.000 loss: -125.812]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.95it/s, atk: -125.765 ent: -2.523 str: 0.000 loss: -128.288]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.98it/s, atk: -125.765 ent: -2.523 str: 0.000 loss: -128.288]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.98it/s, atk: -129.017 ent: -2.524 str: 0.000 loss: -131.541]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.00it/s, atk: -129.017 ent: -2.524 str: 0.000 loss: -131.541]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.00it/s, atk: -131.849 ent: -2.524 str: 0.000 loss: -134.373]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  2.01it/s, atk: -131.849 ent: -2.524 str: 0.000 loss: -134.373]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.01it/s, atk: -134.148 ent: -2.524 str: 0.000 loss: -136.672]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.02it/s, atk: -134.148 ent: -2.524 str: 0.000 loss: -136.672]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.02it/s, atk: -137.259 ent: -2.524 str: 0.000 loss: -139.783]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  2.03it/s, atk: -137.259 ent: -2.524 str: 0.000 loss: -139.783]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.03it/s, atk: -140.930 ent: -2.525 str: 0.000 loss: -143.455]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.03it/s, atk: -140.930 ent: -2.525 str: 0.000 loss: -143.455]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.94it/s, atk: -140.930 ent: -2.525 str: 0.000 loss: -143.455]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([498], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([762], device='cuda:0') tensor(7.0593e-07, device='cuda:0')
L1: [3259.0312]	L2: [21.83551]	Linf: [0.6666667]

Accuracy on benign examples: 100.0%
gt_label: 752 pred_label: 752 pred_clean_logit 0.7263683080673218
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.27it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 21.17it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.63it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 24.74it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.07it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.58it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.56it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.19it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.09it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:02,  1.02s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.12s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.14s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2328
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -9.340 ent: -2.666 str: 0.000 loss: -12.007]Iterations:   3%|▎         | 1/30 [00:01<00:39,  1.35s/it, atk: -9.340 ent: -2.666 str: 0.000 loss: -12.007]Iterations:   3%|▎         | 1/30 [00:01<00:39,  1.35s/it, atk: -25.017 ent: -2.656 str: 0.000 loss: -27.673]Iterations:   7%|▋         | 2/30 [00:01<00:23,  1.18it/s, atk: -25.017 ent: -2.656 str: 0.000 loss: -27.673]Iterations:   7%|▋         | 2/30 [00:02<00:23,  1.18it/s, atk: -37.488 ent: -2.646 str: 0.000 loss: -40.134]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.45it/s, atk: -37.488 ent: -2.646 str: 0.000 loss: -40.134]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.45it/s, atk: -43.434 ent: -2.644 str: 0.000 loss: -46.078]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -43.434 ent: -2.644 str: 0.000 loss: -46.078]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -50.381 ent: -2.641 str: 0.000 loss: -53.023]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.54it/s, atk: -50.381 ent: -2.641 str: 0.000 loss: -53.023]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.54it/s, atk: -55.923 ent: -2.639 str: 0.000 loss: -58.562]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.57it/s, atk: -55.923 ent: -2.639 str: 0.000 loss: -58.562]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.57it/s, atk: -62.290 ent: -2.636 str: 0.000 loss: -64.927]Iterations:  23%|██▎       | 7/30 [00:04<00:13,  1.69it/s, atk: -62.290 ent: -2.636 str: 0.000 loss: -64.927]Iterations:  23%|██▎       | 7/30 [00:05<00:13,  1.69it/s, atk: -67.929 ent: -2.635 str: 0.000 loss: -70.564]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.70it/s, atk: -67.929 ent: -2.635 str: 0.000 loss: -70.564]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.70it/s, atk: -73.350 ent: -2.634 str: 0.000 loss: -75.984]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.77it/s, atk: -73.350 ent: -2.634 str: 0.000 loss: -75.984]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.77it/s, atk: -78.850 ent: -2.634 str: 0.000 loss: -81.484]Iterations:  33%|███▎      | 10/30 [00:06<00:11,  1.81it/s, atk: -78.850 ent: -2.634 str: 0.000 loss: -81.484]Iterations:  33%|███▎      | 10/30 [00:06<00:11,  1.81it/s, atk: -84.804 ent: -2.633 str: 0.000 loss: -87.437]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.80it/s, atk: -84.804 ent: -2.633 str: 0.000 loss: -87.437]Iterations:  37%|███▋      | 11/30 [00:07<00:10,  1.80it/s, atk: -90.693 ent: -2.635 str: 0.000 loss: -93.327]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.86it/s, atk: -90.693 ent: -2.635 str: 0.000 loss: -93.327]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.86it/s, atk: -97.351 ent: -2.634 str: 0.000 loss: -99.985]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.81it/s, atk: -97.351 ent: -2.634 str: 0.000 loss: -99.985]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.81it/s, atk: -104.982 ent: -2.633 str: 0.000 loss: -107.615]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.78it/s, atk: -104.982 ent: -2.633 str: 0.000 loss: -107.615]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.78it/s, atk: -109.586 ent: -2.634 str: 0.000 loss: -112.220]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.80it/s, atk: -109.586 ent: -2.634 str: 0.000 loss: -112.220]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.80it/s, atk: -115.534 ent: -2.631 str: 0.000 loss: -118.165]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.86it/s, atk: -115.534 ent: -2.631 str: 0.000 loss: -118.165]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.86it/s, atk: -119.462 ent: -2.630 str: 0.000 loss: -122.092]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.91it/s, atk: -119.462 ent: -2.630 str: 0.000 loss: -122.092]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.91it/s, atk: -124.231 ent: -2.630 str: 0.000 loss: -126.861]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.93it/s, atk: -124.231 ent: -2.630 str: 0.000 loss: -126.861]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.93it/s, atk: -128.376 ent: -2.631 str: 0.000 loss: -131.007]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  1.91it/s, atk: -128.376 ent: -2.631 str: 0.000 loss: -131.007]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  1.91it/s, atk: -132.500 ent: -2.631 str: 0.000 loss: -135.131]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.91it/s, atk: -132.500 ent: -2.631 str: 0.000 loss: -135.131]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.91it/s, atk: -136.040 ent: -2.630 str: 0.000 loss: -138.670]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.94it/s, atk: -136.040 ent: -2.630 str: 0.000 loss: -138.670]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.94it/s, atk: -139.610 ent: -2.628 str: 0.000 loss: -142.237]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -139.610 ent: -2.628 str: 0.000 loss: -142.237]Iterations:  73%|███████▎  | 22/30 [00:13<00:04,  1.94it/s, atk: -142.650 ent: -2.627 str: 0.000 loss: -145.276]Iterations:  77%|███████▋  | 23/30 [00:13<00:04,  1.74it/s, atk: -142.650 ent: -2.627 str: 0.000 loss: -145.276]Iterations:  77%|███████▋  | 23/30 [00:13<00:04,  1.74it/s, atk: -146.200 ent: -2.627 str: 0.000 loss: -148.827]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.80it/s, atk: -146.200 ent: -2.627 str: 0.000 loss: -148.827]Iterations:  80%|████████  | 24/30 [00:14<00:03,  1.80it/s, atk: -149.718 ent: -2.627 str: 0.000 loss: -152.345]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.86it/s, atk: -149.718 ent: -2.627 str: 0.000 loss: -152.345]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.86it/s, atk: -153.667 ent: -2.627 str: 0.000 loss: -156.295]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.88it/s, atk: -153.667 ent: -2.627 str: 0.000 loss: -156.295]Iterations:  87%|████████▋ | 26/30 [00:15<00:02,  1.88it/s, atk: -157.083 ent: -2.627 str: 0.000 loss: -159.710]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.92it/s, atk: -157.083 ent: -2.627 str: 0.000 loss: -159.710]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.92it/s, atk: -161.253 ent: -2.626 str: 0.000 loss: -163.878]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.75it/s, atk: -161.253 ent: -2.626 str: 0.000 loss: -163.878]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.75it/s, atk: -164.488 ent: -2.625 str: 0.000 loss: -167.113]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.58it/s, atk: -164.488 ent: -2.625 str: 0.000 loss: -167.113]Iterations:  97%|█████████▋| 29/30 [00:17<00:00,  1.58it/s, atk: -168.617 ent: -2.624 str: 0.000 loss: -171.241]Iterations: 100%|██████████| 30/30 [00:17<00:00,  1.64it/s, atk: -168.617 ent: -2.624 str: 0.000 loss: -171.241]Iterations: 100%|██████████| 30/30 [00:17<00:00,  1.72it/s, atk: -168.617 ent: -2.624 str: 0.000 loss: -171.241]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([615], device='cuda:0') tensor(0.9991, device='cuda:0')
after_true: tensor([752], device='cuda:0') tensor(3.5459e-08, device='cuda:0')
L1: [2138.8433]	L2: [15.512712]	Linf: [0.6039216]

Accuracy on benign examples: 100.0%
gt_label: 759 pred_label: 759 pred_clean_logit 0.9951437711715698
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.58it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.66it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.42it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.44it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.35it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 21.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.07s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.03s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.13s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.23s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4655
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.027 ent: -5.172 str: 0.000 loss: -5.199]Iterations:   3%|▎         | 1/30 [00:00<00:20,  1.39it/s, atk: -0.027 ent: -5.172 str: 0.000 loss: -5.199]Iterations:   3%|▎         | 1/30 [00:01<00:20,  1.39it/s, atk: -0.072 ent: -5.197 str: 0.000 loss: -5.269]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -0.072 ent: -5.197 str: 0.000 loss: -5.269]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -0.313 ent: -5.195 str: 0.000 loss: -5.508]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.66it/s, atk: -0.313 ent: -5.195 str: 0.000 loss: -5.508]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.66it/s, atk: -0.949 ent: -5.196 str: 0.000 loss: -6.145]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -0.949 ent: -5.196 str: 0.000 loss: -6.145]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -1.276 ent: -5.196 str: 0.000 loss: -6.472]Iterations:  17%|█▋        | 5/30 [00:02<00:14,  1.76it/s, atk: -1.276 ent: -5.196 str: 0.000 loss: -6.472]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.76it/s, atk: -2.801 ent: -5.202 str: 0.000 loss: -8.004]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.85it/s, atk: -2.801 ent: -5.202 str: 0.000 loss: -8.004]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.85it/s, atk: -4.850 ent: -5.196 str: 0.000 loss: -10.045]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -4.850 ent: -5.196 str: 0.000 loss: -10.045]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -11.714 ent: -5.195 str: 0.000 loss: -16.909]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.86it/s, atk: -11.714 ent: -5.195 str: 0.000 loss: -16.909]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.86it/s, atk: -18.406 ent: -5.196 str: 0.000 loss: -23.602]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.92it/s, atk: -18.406 ent: -5.196 str: 0.000 loss: -23.602]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.92it/s, atk: -32.194 ent: -5.188 str: 0.000 loss: -37.383]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.94it/s, atk: -32.194 ent: -5.188 str: 0.000 loss: -37.383]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.94it/s, atk: -44.221 ent: -5.185 str: 0.000 loss: -49.406]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -44.221 ent: -5.185 str: 0.000 loss: -49.406]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -57.755 ent: -5.175 str: 0.000 loss: -62.930]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.93it/s, atk: -57.755 ent: -5.175 str: 0.000 loss: -62.930]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.93it/s, atk: -58.263 ent: -5.170 str: 0.000 loss: -63.433]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -58.263 ent: -5.170 str: 0.000 loss: -63.433]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -67.301 ent: -5.172 str: 0.000 loss: -72.473]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.94it/s, atk: -67.301 ent: -5.172 str: 0.000 loss: -72.473]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.94it/s, atk: -70.778 ent: -5.170 str: 0.000 loss: -75.948]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -70.778 ent: -5.170 str: 0.000 loss: -75.948]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -84.626 ent: -5.168 str: 0.000 loss: -89.794]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -84.626 ent: -5.168 str: 0.000 loss: -89.794]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.94it/s, atk: -94.623 ent: -5.164 str: 0.000 loss: -99.787]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.87it/s, atk: -94.623 ent: -5.164 str: 0.000 loss: -99.787]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.87it/s, atk: -101.374 ent: -5.164 str: 0.000 loss: -106.538]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.87it/s, atk: -101.374 ent: -5.164 str: 0.000 loss: -106.538]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.87it/s, atk: -113.870 ent: -5.157 str: 0.000 loss: -119.027]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.91it/s, atk: -113.870 ent: -5.157 str: 0.000 loss: -119.027]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.91it/s, atk: -123.693 ent: -5.154 str: 0.000 loss: -128.847]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.93it/s, atk: -123.693 ent: -5.154 str: 0.000 loss: -128.847]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.93it/s, atk: -134.464 ent: -5.157 str: 0.000 loss: -139.620]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.91it/s, atk: -134.464 ent: -5.157 str: 0.000 loss: -139.620]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.91it/s, atk: -142.372 ent: -5.159 str: 0.000 loss: -147.531]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.89it/s, atk: -142.372 ent: -5.159 str: 0.000 loss: -147.531]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.89it/s, atk: -150.228 ent: -5.160 str: 0.000 loss: -155.388]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.85it/s, atk: -150.228 ent: -5.160 str: 0.000 loss: -155.388]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.85it/s, atk: -158.592 ent: -5.161 str: 0.000 loss: -163.753]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.88it/s, atk: -158.592 ent: -5.161 str: 0.000 loss: -163.753]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.88it/s, atk: -166.886 ent: -5.161 str: 0.000 loss: -172.046]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.90it/s, atk: -166.886 ent: -5.161 str: 0.000 loss: -172.046]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.90it/s, atk: -175.128 ent: -5.161 str: 0.000 loss: -180.289]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.68it/s, atk: -175.128 ent: -5.161 str: 0.000 loss: -180.289]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.68it/s, atk: -182.557 ent: -5.161 str: 0.000 loss: -187.718]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.79it/s, atk: -182.557 ent: -5.161 str: 0.000 loss: -187.718]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.79it/s, atk: -188.969 ent: -5.162 str: 0.000 loss: -194.131]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.85it/s, atk: -188.969 ent: -5.162 str: 0.000 loss: -194.131]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.85it/s, atk: -195.070 ent: -5.158 str: 0.000 loss: -200.227]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.85it/s, atk: -195.070 ent: -5.158 str: 0.000 loss: -200.227]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.85it/s, atk: -201.208 ent: -5.158 str: 0.000 loss: -206.366]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.84it/s, atk: -201.208 ent: -5.158 str: 0.000 loss: -206.366]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -201.208 ent: -5.158 str: 0.000 loss: -206.366]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([704], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([759], device='cuda:0') tensor(1.6590e-09, device='cuda:0')
L1: [2759.337]	L2: [19.834846]	Linf: [0.6823529]

Accuracy on benign examples: 0.0%
gt_label: 743 pred_label: 652 pred_clean_logit 0.07121586054563522
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.99it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.08it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.31it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.28it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.42it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.64it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.85it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.35s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.28s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.37s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.32s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3078
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -19.930 ent: -2.528 str: 0.000 loss: -22.458]Iterations:   3%|▎         | 1/30 [00:00<00:23,  1.26it/s, atk: -19.930 ent: -2.528 str: 0.000 loss: -22.458]Iterations:   3%|▎         | 1/30 [00:01<00:23,  1.26it/s, atk: -23.375 ent: -2.524 str: 0.000 loss: -25.899]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.52it/s, atk: -23.375 ent: -2.524 str: 0.000 loss: -25.899]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.52it/s, atk: -32.071 ent: -2.519 str: 0.000 loss: -34.591]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.73it/s, atk: -32.071 ent: -2.519 str: 0.000 loss: -34.591]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.73it/s, atk: -39.436 ent: -2.516 str: 0.000 loss: -41.952]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -39.436 ent: -2.516 str: 0.000 loss: -41.952]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -45.646 ent: -2.514 str: 0.000 loss: -48.160]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.87it/s, atk: -45.646 ent: -2.514 str: 0.000 loss: -48.160]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.87it/s, atk: -50.616 ent: -2.513 str: 0.000 loss: -53.129]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.91it/s, atk: -50.616 ent: -2.513 str: 0.000 loss: -53.129]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.91it/s, atk: -54.979 ent: -2.512 str: 0.000 loss: -57.491]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.95it/s, atk: -54.979 ent: -2.512 str: 0.000 loss: -57.491]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.95it/s, atk: -60.197 ent: -2.512 str: 0.000 loss: -62.709]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.96it/s, atk: -60.197 ent: -2.512 str: 0.000 loss: -62.709]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.96it/s, atk: -65.039 ent: -2.512 str: 0.000 loss: -67.551]Iterations:  30%|███       | 9/30 [00:04<00:10,  2.00it/s, atk: -65.039 ent: -2.512 str: 0.000 loss: -67.551]Iterations:  30%|███       | 9/30 [00:05<00:10,  2.00it/s, atk: -69.030 ent: -2.512 str: 0.000 loss: -71.542]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -69.030 ent: -2.512 str: 0.000 loss: -71.542]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -73.633 ent: -2.512 str: 0.000 loss: -76.145]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.01it/s, atk: -73.633 ent: -2.512 str: 0.000 loss: -76.145]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  2.01it/s, atk: -78.380 ent: -2.512 str: 0.000 loss: -80.892]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -78.380 ent: -2.512 str: 0.000 loss: -80.892]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.96it/s, atk: -83.574 ent: -2.511 str: 0.000 loss: -86.085]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.95it/s, atk: -83.574 ent: -2.511 str: 0.000 loss: -86.085]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -88.325 ent: -2.511 str: 0.000 loss: -90.837]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -88.325 ent: -2.511 str: 0.000 loss: -90.837]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.96it/s, atk: -92.716 ent: -2.511 str: 0.000 loss: -95.227]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.99it/s, atk: -92.716 ent: -2.511 str: 0.000 loss: -95.227]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.99it/s, atk: -98.014 ent: -2.511 str: 0.000 loss: -100.525]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.98it/s, atk: -98.014 ent: -2.511 str: 0.000 loss: -100.525]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.98it/s, atk: -103.969 ent: -2.511 str: 0.000 loss: -106.479]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.00it/s, atk: -103.969 ent: -2.511 str: 0.000 loss: -106.479]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.00it/s, atk: -110.313 ent: -2.510 str: 0.000 loss: -112.824]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.92it/s, atk: -110.313 ent: -2.510 str: 0.000 loss: -112.824]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.92it/s, atk: -115.770 ent: -2.509 str: 0.000 loss: -118.280]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.96it/s, atk: -115.770 ent: -2.509 str: 0.000 loss: -118.280]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -121.857 ent: -2.510 str: 0.000 loss: -124.367]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -121.857 ent: -2.510 str: 0.000 loss: -124.367]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -127.581 ent: -2.509 str: 0.000 loss: -130.090]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.97it/s, atk: -127.581 ent: -2.509 str: 0.000 loss: -130.090]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -131.059 ent: -2.509 str: 0.000 loss: -133.568]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -131.059 ent: -2.509 str: 0.000 loss: -133.568]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.96it/s, atk: -135.237 ent: -2.509 str: 0.000 loss: -137.745]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.99it/s, atk: -135.237 ent: -2.509 str: 0.000 loss: -137.745]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.99it/s, atk: -139.086 ent: -2.509 str: 0.000 loss: -141.595]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -139.086 ent: -2.509 str: 0.000 loss: -141.595]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -143.345 ent: -2.509 str: 0.000 loss: -145.854]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.97it/s, atk: -143.345 ent: -2.509 str: 0.000 loss: -145.854]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -148.175 ent: -2.509 str: 0.000 loss: -150.684]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -148.175 ent: -2.509 str: 0.000 loss: -150.684]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -152.386 ent: -2.509 str: 0.000 loss: -154.895]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.98it/s, atk: -152.386 ent: -2.509 str: 0.000 loss: -154.895]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -156.197 ent: -2.510 str: 0.000 loss: -158.706]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.98it/s, atk: -156.197 ent: -2.510 str: 0.000 loss: -158.706]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.98it/s, atk: -161.168 ent: -2.510 str: 0.000 loss: -163.678]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.90it/s, atk: -161.168 ent: -2.510 str: 0.000 loss: -163.678]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.90it/s, atk: -166.020 ent: -2.510 str: 0.000 loss: -168.531]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.87it/s, atk: -166.020 ent: -2.510 str: 0.000 loss: -168.531]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.92it/s, atk: -166.020 ent: -2.510 str: 0.000 loss: -168.531]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([562], device='cuda:0') tensor(0.9992, device='cuda:0')
after_true: tensor([743], device='cuda:0') tensor(3.8508e-08, device='cuda:0')
L1: [3965.8667]	L2: [27.76892]	Linf: [0.8392157]

Accuracy on benign examples: 0.0%
gt_label: 893 pred_label: 608 pred_clean_logit 0.16459323465824127
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 25.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.86it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.82it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.64it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.62it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.79it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.02it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.02it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.09s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.34s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.23s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4880
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -25.231 ent: -2.653 str: 0.000 loss: -27.884]Iterations:   3%|▎         | 1/30 [00:00<00:19,  1.47it/s, atk: -25.231 ent: -2.653 str: 0.000 loss: -27.884]Iterations:   3%|▎         | 1/30 [00:00<00:19,  1.47it/s, atk: -35.868 ent: -2.665 str: 0.000 loss: -38.533]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.68it/s, atk: -35.868 ent: -2.665 str: 0.000 loss: -38.533]Iterations:   7%|▋         | 2/30 [00:01<00:16,  1.68it/s, atk: -46.237 ent: -2.657 str: 0.000 loss: -48.894]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.78it/s, atk: -46.237 ent: -2.657 str: 0.000 loss: -48.894]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.78it/s, atk: -54.469 ent: -2.658 str: 0.000 loss: -57.127]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.81it/s, atk: -54.469 ent: -2.658 str: 0.000 loss: -57.127]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.81it/s, atk: -59.569 ent: -2.644 str: 0.000 loss: -62.214]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.88it/s, atk: -59.569 ent: -2.644 str: 0.000 loss: -62.214]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.88it/s, atk: -71.530 ent: -2.647 str: 0.000 loss: -74.177]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -71.530 ent: -2.647 str: 0.000 loss: -74.177]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.92it/s, atk: -79.212 ent: -2.641 str: 0.000 loss: -81.853]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.92it/s, atk: -79.212 ent: -2.641 str: 0.000 loss: -81.853]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.92it/s, atk: -81.331 ent: -2.635 str: 0.000 loss: -83.966]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -81.331 ent: -2.635 str: 0.000 loss: -83.966]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -90.873 ent: -2.632 str: 0.000 loss: -93.505]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.93it/s, atk: -90.873 ent: -2.632 str: 0.000 loss: -93.505]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.93it/s, atk: -95.061 ent: -2.637 str: 0.000 loss: -97.698]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -95.061 ent: -2.637 str: 0.000 loss: -97.698]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.95it/s, atk: -102.597 ent: -2.638 str: 0.000 loss: -105.234]Iterations:  37%|███▋      | 11/30 [00:05<00:10,  1.87it/s, atk: -102.597 ent: -2.638 str: 0.000 loss: -105.234]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.87it/s, atk: -105.008 ent: -2.641 str: 0.000 loss: -107.649]Iterations:  40%|████      | 12/30 [00:06<00:11,  1.53it/s, atk: -105.008 ent: -2.641 str: 0.000 loss: -107.649]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.53it/s, atk: -107.620 ent: -2.643 str: 0.000 loss: -110.263]Iterations:  43%|████▎     | 13/30 [00:07<00:10,  1.64it/s, atk: -107.620 ent: -2.643 str: 0.000 loss: -110.263]Iterations:  43%|████▎     | 13/30 [00:07<00:10,  1.64it/s, atk: -104.208 ent: -2.640 str: 0.000 loss: -106.849]Iterations:  47%|████▋     | 14/30 [00:07<00:09,  1.73it/s, atk: -104.208 ent: -2.640 str: 0.000 loss: -106.849]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.73it/s, atk: -106.576 ent: -2.630 str: 0.000 loss: -109.206]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.82it/s, atk: -106.576 ent: -2.630 str: 0.000 loss: -109.206]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.82it/s, atk: -101.233 ent: -2.616 str: 0.000 loss: -103.850]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.87it/s, atk: -101.233 ent: -2.616 str: 0.000 loss: -103.850]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.87it/s, atk: -105.135 ent: -2.612 str: 0.000 loss: -107.747]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.91it/s, atk: -105.135 ent: -2.612 str: 0.000 loss: -107.747]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.91it/s, atk: -113.595 ent: -2.613 str: 0.000 loss: -116.208]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.91it/s, atk: -113.595 ent: -2.613 str: 0.000 loss: -116.208]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.91it/s, atk: -119.776 ent: -2.616 str: 0.000 loss: -122.392]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.94it/s, atk: -119.776 ent: -2.616 str: 0.000 loss: -122.392]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.94it/s, atk: -120.769 ent: -2.617 str: 0.000 loss: -123.386]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -120.769 ent: -2.617 str: 0.000 loss: -123.386]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.95it/s, atk: -122.460 ent: -2.617 str: 0.000 loss: -125.077]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.94it/s, atk: -122.460 ent: -2.617 str: 0.000 loss: -125.077]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.94it/s, atk: -126.949 ent: -2.620 str: 0.000 loss: -129.569]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.94it/s, atk: -126.949 ent: -2.620 str: 0.000 loss: -129.569]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -128.385 ent: -2.618 str: 0.000 loss: -131.003]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -128.385 ent: -2.618 str: 0.000 loss: -131.003]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -132.351 ent: -2.617 str: 0.000 loss: -134.968]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -132.351 ent: -2.617 str: 0.000 loss: -134.968]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.96it/s, atk: -135.396 ent: -2.616 str: 0.000 loss: -138.012]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -135.396 ent: -2.616 str: 0.000 loss: -138.012]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -138.087 ent: -2.617 str: 0.000 loss: -140.704]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.95it/s, atk: -138.087 ent: -2.617 str: 0.000 loss: -140.704]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.95it/s, atk: -142.021 ent: -2.614 str: 0.000 loss: -144.635]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.92it/s, atk: -142.021 ent: -2.614 str: 0.000 loss: -144.635]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.92it/s, atk: -143.905 ent: -2.610 str: 0.000 loss: -146.515]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.94it/s, atk: -143.905 ent: -2.610 str: 0.000 loss: -146.515]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.94it/s, atk: -147.911 ent: -2.607 str: 0.000 loss: -150.518]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.92it/s, atk: -147.911 ent: -2.607 str: 0.000 loss: -150.518]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.92it/s, atk: -149.062 ent: -2.603 str: 0.000 loss: -151.665]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.95it/s, atk: -149.062 ent: -2.603 str: 0.000 loss: -151.665]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.87it/s, atk: -149.062 ent: -2.603 str: 0.000 loss: -151.665]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([871], device='cuda:0') tensor(0.6584, device='cuda:0')
after_true: tensor([893], device='cuda:0') tensor(3.0622e-07, device='cuda:0')
L1: [2583.5803]	L2: [19.839401]	Linf: [0.85490197]

Accuracy on benign examples: 100.0%
gt_label: 49 pred_label: 49 pred_clean_logit 0.9979532957077026
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 23.86it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 24.80it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.22it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.77it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.98it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.11it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.74it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.23s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.08s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.15s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.22s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.33s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.26s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5594
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.092 ent: -5.561 str: 0.000 loss: -5.653]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.40s/it, atk: -0.092 ent: -5.561 str: 0.000 loss: -5.653]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.40s/it, atk: -0.344 ent: -5.547 str: 0.000 loss: -5.891]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -0.344 ent: -5.547 str: 0.000 loss: -5.891]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -1.037 ent: -5.549 str: 0.000 loss: -6.586]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.36it/s, atk: -1.037 ent: -5.549 str: 0.000 loss: -6.586]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.36it/s, atk: -1.787 ent: -5.547 str: 0.000 loss: -7.334]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.57it/s, atk: -1.787 ent: -5.547 str: 0.000 loss: -7.334]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.57it/s, atk: -4.666 ent: -5.540 str: 0.000 loss: -10.205]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.70it/s, atk: -4.666 ent: -5.540 str: 0.000 loss: -10.205]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.70it/s, atk: -6.408 ent: -5.539 str: 0.000 loss: -11.947]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.76it/s, atk: -6.408 ent: -5.539 str: 0.000 loss: -11.947]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.76it/s, atk: -9.779 ent: -5.542 str: 0.000 loss: -15.321]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.84it/s, atk: -9.779 ent: -5.542 str: 0.000 loss: -15.321]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.84it/s, atk: -12.881 ent: -5.534 str: 0.000 loss: -18.416]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -12.881 ent: -5.534 str: 0.000 loss: -18.416]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -17.619 ent: -5.538 str: 0.000 loss: -23.156]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.91it/s, atk: -17.619 ent: -5.538 str: 0.000 loss: -23.156]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.91it/s, atk: -21.360 ent: -5.538 str: 0.000 loss: -26.899]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.95it/s, atk: -21.360 ent: -5.538 str: 0.000 loss: -26.899]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.95it/s, atk: -26.882 ent: -5.535 str: 0.000 loss: -32.417]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -26.882 ent: -5.535 str: 0.000 loss: -32.417]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -31.976 ent: -5.533 str: 0.000 loss: -37.510]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.97it/s, atk: -31.976 ent: -5.533 str: 0.000 loss: -37.510]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.97it/s, atk: -36.571 ent: -5.534 str: 0.000 loss: -42.104]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.99it/s, atk: -36.571 ent: -5.534 str: 0.000 loss: -42.104]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.99it/s, atk: -41.283 ent: -5.533 str: 0.000 loss: -46.817]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.99it/s, atk: -41.283 ent: -5.533 str: 0.000 loss: -46.817]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.99it/s, atk: -44.452 ent: -5.534 str: 0.000 loss: -49.986]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -44.452 ent: -5.534 str: 0.000 loss: -49.986]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.98it/s, atk: -48.021 ent: -5.532 str: 0.000 loss: -53.553]Iterations:  53%|█████▎    | 16/30 [00:09<00:06,  2.02it/s, atk: -48.021 ent: -5.532 str: 0.000 loss: -53.553]Iterations:  53%|█████▎    | 16/30 [00:09<00:06,  2.02it/s, atk: -52.452 ent: -5.534 str: 0.000 loss: -57.986]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.03it/s, atk: -52.452 ent: -5.534 str: 0.000 loss: -57.986]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.03it/s, atk: -56.170 ent: -5.534 str: 0.000 loss: -61.705]Iterations:  60%|██████    | 18/30 [00:09<00:05,  2.03it/s, atk: -56.170 ent: -5.534 str: 0.000 loss: -61.705]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.03it/s, atk: -58.364 ent: -5.533 str: 0.000 loss: -63.897]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.04it/s, atk: -58.364 ent: -5.533 str: 0.000 loss: -63.897]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.04it/s, atk: -59.463 ent: -5.527 str: 0.000 loss: -64.991]Iterations:  67%|██████▋   | 20/30 [00:10<00:04,  2.04it/s, atk: -59.463 ent: -5.527 str: 0.000 loss: -64.991]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.04it/s, atk: -65.309 ent: -5.524 str: 0.000 loss: -70.833]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.02it/s, atk: -65.309 ent: -5.524 str: 0.000 loss: -70.833]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.02it/s, atk: -67.927 ent: -5.519 str: 0.000 loss: -73.446]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.02it/s, atk: -67.927 ent: -5.519 str: 0.000 loss: -73.446]Iterations:  73%|███████▎  | 22/30 [00:12<00:03,  2.02it/s, atk: -71.897 ent: -5.516 str: 0.000 loss: -77.413]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.03it/s, atk: -71.897 ent: -5.516 str: 0.000 loss: -77.413]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.03it/s, atk: -76.125 ent: -5.513 str: 0.000 loss: -81.638]Iterations:  80%|████████  | 24/30 [00:12<00:03,  2.00it/s, atk: -76.125 ent: -5.513 str: 0.000 loss: -81.638]Iterations:  80%|████████  | 24/30 [00:13<00:03,  2.00it/s, atk: -79.260 ent: -5.512 str: 0.000 loss: -84.771]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.01it/s, atk: -79.260 ent: -5.512 str: 0.000 loss: -84.771]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.01it/s, atk: -83.116 ent: -5.511 str: 0.000 loss: -88.627]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.02it/s, atk: -83.116 ent: -5.511 str: 0.000 loss: -88.627]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.02it/s, atk: -86.131 ent: -5.512 str: 0.000 loss: -91.643]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -86.131 ent: -5.512 str: 0.000 loss: -91.643]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.99it/s, atk: -88.653 ent: -5.521 str: 0.000 loss: -94.174]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.99it/s, atk: -88.653 ent: -5.521 str: 0.000 loss: -94.174]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.99it/s, atk: -91.526 ent: -5.523 str: 0.000 loss: -97.049]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -91.526 ent: -5.523 str: 0.000 loss: -97.049]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -93.861 ent: -5.522 str: 0.000 loss: -99.383]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -93.861 ent: -5.522 str: 0.000 loss: -99.383]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.88it/s, atk: -93.861 ent: -5.522 str: 0.000 loss: -99.383]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([50], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([49], device='cuda:0') tensor(6.3172e-05, device='cuda:0')
L1: [5014.2354]	L2: [32.210995]	Linf: [0.7921569]

Accuracy on benign examples: 100.0%
gt_label: 22 pred_label: 22 pred_clean_logit 0.7572193741798401
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 28.12it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.37it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.63it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 24.24it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.12it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 25.70it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.83it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.18it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.11it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.01it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.07s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.10s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4332
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.274 ent: -5.741 str: 0.000 loss: -7.015]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.62s/it, atk: -1.274 ent: -5.741 str: 0.000 loss: -7.015]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.62s/it, atk: -8.758 ent: -5.739 str: 0.000 loss: -14.497]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -8.758 ent: -5.739 str: 0.000 loss: -14.497]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -13.360 ent: -5.746 str: 0.000 loss: -19.106]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.32it/s, atk: -13.360 ent: -5.746 str: 0.000 loss: -19.106]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.32it/s, atk: -26.212 ent: -5.742 str: 0.000 loss: -31.953]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.54it/s, atk: -26.212 ent: -5.742 str: 0.000 loss: -31.953]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.54it/s, atk: -39.043 ent: -5.738 str: 0.000 loss: -44.781]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.68it/s, atk: -39.043 ent: -5.738 str: 0.000 loss: -44.781]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.68it/s, atk: -49.654 ent: -5.735 str: 0.000 loss: -55.390]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.78it/s, atk: -49.654 ent: -5.735 str: 0.000 loss: -55.390]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.78it/s, atk: -56.659 ent: -5.734 str: 0.000 loss: -62.392]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.84it/s, atk: -56.659 ent: -5.734 str: 0.000 loss: -62.392]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.84it/s, atk: -62.728 ent: -5.727 str: 0.000 loss: -68.455]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -62.728 ent: -5.727 str: 0.000 loss: -68.455]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -67.638 ent: -5.721 str: 0.000 loss: -73.359]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.85it/s, atk: -67.638 ent: -5.721 str: 0.000 loss: -73.359]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.85it/s, atk: -72.822 ent: -5.718 str: 0.000 loss: -78.540]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.89it/s, atk: -72.822 ent: -5.718 str: 0.000 loss: -78.540]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.89it/s, atk: -77.316 ent: -5.714 str: 0.000 loss: -83.030]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -77.316 ent: -5.714 str: 0.000 loss: -83.030]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -81.061 ent: -5.706 str: 0.000 loss: -86.767]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.94it/s, atk: -81.061 ent: -5.706 str: 0.000 loss: -86.767]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.94it/s, atk: -87.014 ent: -5.705 str: 0.000 loss: -92.719]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -87.014 ent: -5.705 str: 0.000 loss: -92.719]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -91.917 ent: -5.710 str: 0.000 loss: -97.627]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -91.917 ent: -5.710 str: 0.000 loss: -97.627]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -97.001 ent: -5.707 str: 0.000 loss: -102.708]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.96it/s, atk: -97.001 ent: -5.707 str: 0.000 loss: -102.708]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.96it/s, atk: -97.835 ent: -5.701 str: 0.000 loss: -103.536]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -97.835 ent: -5.701 str: 0.000 loss: -103.536]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.96it/s, atk: -104.717 ent: -5.701 str: 0.000 loss: -110.417]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.96it/s, atk: -104.717 ent: -5.701 str: 0.000 loss: -110.417]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.96it/s, atk: -106.229 ent: -5.706 str: 0.000 loss: -111.934]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.98it/s, atk: -106.229 ent: -5.706 str: 0.000 loss: -111.934]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.98it/s, atk: -110.105 ent: -5.705 str: 0.000 loss: -115.810]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.98it/s, atk: -110.105 ent: -5.705 str: 0.000 loss: -115.810]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  1.98it/s, atk: -112.584 ent: -5.702 str: 0.000 loss: -118.286]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.99it/s, atk: -112.584 ent: -5.702 str: 0.000 loss: -118.286]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.99it/s, atk: -116.367 ent: -5.702 str: 0.000 loss: -122.069]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.95it/s, atk: -116.367 ent: -5.702 str: 0.000 loss: -122.069]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.95it/s, atk: -120.212 ent: -5.707 str: 0.000 loss: -125.918]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -120.212 ent: -5.707 str: 0.000 loss: -125.918]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.94it/s, atk: -124.276 ent: -5.711 str: 0.000 loss: -129.987]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.94it/s, atk: -124.276 ent: -5.711 str: 0.000 loss: -129.987]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.94it/s, atk: -127.515 ent: -5.714 str: 0.000 loss: -133.229]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.95it/s, atk: -127.515 ent: -5.714 str: 0.000 loss: -133.229]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.95it/s, atk: -130.520 ent: -5.716 str: 0.000 loss: -136.237]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.89it/s, atk: -130.520 ent: -5.716 str: 0.000 loss: -136.237]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.89it/s, atk: -132.457 ent: -5.716 str: 0.000 loss: -138.173]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.87it/s, atk: -132.457 ent: -5.716 str: 0.000 loss: -138.173]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.87it/s, atk: -135.084 ent: -5.715 str: 0.000 loss: -140.799]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.90it/s, atk: -135.084 ent: -5.715 str: 0.000 loss: -140.799]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.90it/s, atk: -138.196 ent: -5.715 str: 0.000 loss: -143.911]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.94it/s, atk: -138.196 ent: -5.715 str: 0.000 loss: -143.911]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.94it/s, atk: -140.947 ent: -5.714 str: 0.000 loss: -146.661]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -140.947 ent: -5.714 str: 0.000 loss: -146.661]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.97it/s, atk: -143.212 ent: -5.711 str: 0.000 loss: -148.923]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.99it/s, atk: -143.212 ent: -5.711 str: 0.000 loss: -148.923]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.83it/s, atk: -143.212 ent: -5.711 str: 0.000 loss: -148.923]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([23], device='cuda:0') tensor(0.9994, device='cuda:0')
after_true: tensor([22], device='cuda:0') tensor(4.3562e-07, device='cuda:0')
L1: [2773.4514]	L2: [19.497969]	Linf: [0.6745098]

Accuracy on benign examples: 100.0%
gt_label: 825 pred_label: 825 pred_clean_logit 0.9859597682952881
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.09it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 27.02it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 27.08it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 27.05it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 27.03it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.85it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.99it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.20s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.64s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.92s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:02,  2.18s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.18s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4331
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.173 ent: -4.831 str: 0.000 loss: -5.004]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.61s/it, atk: -0.173 ent: -4.831 str: 0.000 loss: -5.004]Iterations:   3%|▎         | 1/30 [00:02<00:46,  1.61s/it, atk: -0.312 ent: -4.831 str: 0.000 loss: -5.143]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.29s/it, atk: -0.312 ent: -4.831 str: 0.000 loss: -5.143]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.29s/it, atk: -0.539 ent: -4.834 str: 0.000 loss: -5.373]Iterations:  10%|█         | 3/30 [00:03<00:32,  1.19s/it, atk: -0.539 ent: -4.834 str: 0.000 loss: -5.373]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -1.042 ent: -4.832 str: 0.000 loss: -5.875]Iterations:  13%|█▎        | 4/30 [00:04<00:29,  1.14s/it, atk: -1.042 ent: -4.832 str: 0.000 loss: -5.875]Iterations:  13%|█▎        | 4/30 [00:05<00:29,  1.14s/it, atk: -1.928 ent: -4.831 str: 0.000 loss: -6.759]Iterations:  17%|█▋        | 5/30 [00:05<00:27,  1.12s/it, atk: -1.928 ent: -4.831 str: 0.000 loss: -6.759]Iterations:  17%|█▋        | 5/30 [00:06<00:27,  1.12s/it, atk: -2.855 ent: -4.826 str: 0.000 loss: -7.681]Iterations:  20%|██        | 6/30 [00:06<00:26,  1.10s/it, atk: -2.855 ent: -4.826 str: 0.000 loss: -7.681]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.10s/it, atk: -5.630 ent: -4.825 str: 0.000 loss: -10.455]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.09s/it, atk: -5.630 ent: -4.825 str: 0.000 loss: -10.455]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.09s/it, atk: -9.118 ent: -4.826 str: 0.000 loss: -13.944]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.08s/it, atk: -9.118 ent: -4.826 str: 0.000 loss: -13.944]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.08s/it, atk: -13.785 ent: -4.827 str: 0.000 loss: -18.613]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.08s/it, atk: -13.785 ent: -4.827 str: 0.000 loss: -18.613]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.08s/it, atk: -17.186 ent: -4.826 str: 0.000 loss: -22.013]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.07s/it, atk: -17.186 ent: -4.826 str: 0.000 loss: -22.013]Iterations:  33%|███▎      | 10/30 [00:11<00:21,  1.07s/it, atk: -19.631 ent: -4.824 str: 0.000 loss: -24.456]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -19.631 ent: -4.824 str: 0.000 loss: -24.456]Iterations:  37%|███▋      | 11/30 [00:12<00:20,  1.07s/it, atk: -25.741 ent: -4.822 str: 0.000 loss: -30.562]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -25.741 ent: -4.822 str: 0.000 loss: -30.562]Iterations:  40%|████      | 12/30 [00:13<00:19,  1.07s/it, atk: -28.597 ent: -4.818 str: 0.000 loss: -33.416]Iterations:  43%|████▎     | 13/30 [00:14<00:18,  1.07s/it, atk: -28.597 ent: -4.818 str: 0.000 loss: -33.416]Iterations:  43%|████▎     | 13/30 [00:15<00:18,  1.07s/it, atk: -31.617 ent: -4.819 str: 0.000 loss: -36.436]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.07s/it, atk: -31.617 ent: -4.819 str: 0.000 loss: -36.436]Iterations:  47%|████▋     | 14/30 [00:16<00:17,  1.07s/it, atk: -37.980 ent: -4.818 str: 0.000 loss: -42.798]Iterations:  50%|█████     | 15/30 [00:16<00:16,  1.07s/it, atk: -37.980 ent: -4.818 str: 0.000 loss: -42.798]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.07s/it, atk: -35.895 ent: -4.821 str: 0.000 loss: -40.716]Iterations:  53%|█████▎    | 16/30 [00:17<00:14,  1.07s/it, atk: -35.895 ent: -4.821 str: 0.000 loss: -40.716]Iterations:  53%|█████▎    | 16/30 [00:18<00:14,  1.07s/it, atk: -34.520 ent: -4.821 str: 0.000 loss: -39.342]Iterations:  57%|█████▋    | 17/30 [00:18<00:13,  1.07s/it, atk: -34.520 ent: -4.821 str: 0.000 loss: -39.342]Iterations:  57%|█████▋    | 17/30 [00:19<00:13,  1.07s/it, atk: -35.237 ent: -4.821 str: 0.000 loss: -40.058]Iterations:  60%|██████    | 18/30 [00:19<00:12,  1.07s/it, atk: -35.237 ent: -4.821 str: 0.000 loss: -40.058]Iterations:  60%|██████    | 18/30 [00:20<00:12,  1.07s/it, atk: -36.234 ent: -4.821 str: 0.000 loss: -41.054]Iterations:  63%|██████▎   | 19/30 [00:20<00:11,  1.07s/it, atk: -36.234 ent: -4.821 str: 0.000 loss: -41.054]Iterations:  63%|██████▎   | 19/30 [00:21<00:11,  1.07s/it, atk: -37.448 ent: -4.820 str: 0.000 loss: -42.268]Iterations:  67%|██████▋   | 20/30 [00:21<00:10,  1.07s/it, atk: -37.448 ent: -4.820 str: 0.000 loss: -42.268]Iterations:  67%|██████▋   | 20/30 [00:22<00:10,  1.07s/it, atk: -38.801 ent: -4.820 str: 0.000 loss: -43.621]Iterations:  70%|███████   | 21/30 [00:22<00:09,  1.07s/it, atk: -38.801 ent: -4.820 str: 0.000 loss: -43.621]Iterations:  70%|███████   | 21/30 [00:23<00:09,  1.07s/it, atk: -40.715 ent: -4.820 str: 0.000 loss: -45.535]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -40.715 ent: -4.820 str: 0.000 loss: -45.535]Iterations:  73%|███████▎  | 22/30 [00:24<00:08,  1.07s/it, atk: -43.705 ent: -4.820 str: 0.000 loss: -48.525]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -43.705 ent: -4.820 str: 0.000 loss: -48.525]Iterations:  77%|███████▋  | 23/30 [00:25<00:07,  1.07s/it, atk: -46.621 ent: -4.819 str: 0.000 loss: -51.440]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -46.621 ent: -4.819 str: 0.000 loss: -51.440]Iterations:  80%|████████  | 24/30 [00:26<00:06,  1.07s/it, atk: -50.358 ent: -4.818 str: 0.000 loss: -55.177]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.07s/it, atk: -50.358 ent: -4.818 str: 0.000 loss: -55.177]Iterations:  83%|████████▎ | 25/30 [00:27<00:05,  1.07s/it, atk: -52.822 ent: -4.817 str: 0.000 loss: -57.640]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.08s/it, atk: -52.822 ent: -4.817 str: 0.000 loss: -57.640]Iterations:  87%|████████▋ | 26/30 [00:28<00:04,  1.08s/it, atk: -55.203 ent: -4.817 str: 0.000 loss: -60.020]Iterations:  90%|█████████ | 27/30 [00:29<00:03,  1.08s/it, atk: -55.203 ent: -4.817 str: 0.000 loss: -60.020]Iterations:  90%|█████████ | 27/30 [00:30<00:03,  1.08s/it, atk: -57.845 ent: -4.816 str: 0.000 loss: -62.661]Iterations:  93%|█████████▎| 28/30 [00:30<00:02,  1.07s/it, atk: -57.845 ent: -4.816 str: 0.000 loss: -62.661]Iterations:  93%|█████████▎| 28/30 [00:31<00:02,  1.07s/it, atk: -60.353 ent: -4.816 str: 0.000 loss: -65.169]Iterations:  97%|█████████▋| 29/30 [00:31<00:01,  1.07s/it, atk: -60.353 ent: -4.816 str: 0.000 loss: -65.169]Iterations:  97%|█████████▋| 29/30 [00:32<00:01,  1.07s/it, atk: -62.556 ent: -4.815 str: 0.000 loss: -67.372]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.07s/it, atk: -62.556 ent: -4.815 str: 0.000 loss: -67.372]Iterations: 100%|██████████| 30/30 [00:32<00:00,  1.09s/it, atk: -62.556 ent: -4.815 str: 0.000 loss: -67.372]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([663], device='cuda:0') tensor(0.1461, device='cuda:0')
after_true: tensor([825], device='cuda:0') tensor(0.0015, device='cuda:0')
L1: [4125.828]	L2: [25.429928]	Linf: [0.60784316]

Accuracy on benign examples: 0.0%
gt_label: 476 pred_label: 731 pred_clean_logit 0.02025333233177662
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.32it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.36it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 12.40it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 12.41it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 12.37it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 12.40it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 12.32it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 12.21it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 12.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.79it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.04it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.81s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.85s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.55s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.45s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3646
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -60.386 ent: -2.602 str: 0.000 loss: -62.988]Iterations:   3%|▎         | 1/30 [00:00<00:27,  1.04it/s, atk: -60.386 ent: -2.602 str: 0.000 loss: -62.988]Iterations:   3%|▎         | 1/30 [00:01<00:27,  1.04it/s, atk: -79.124 ent: -2.611 str: 0.000 loss: -81.735]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.47it/s, atk: -79.124 ent: -2.611 str: 0.000 loss: -81.735]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.47it/s, atk: -90.305 ent: -2.611 str: 0.000 loss: -92.916]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.67it/s, atk: -90.305 ent: -2.611 str: 0.000 loss: -92.916]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.67it/s, atk: -100.217 ent: -2.608 str: 0.000 loss: -102.825]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.80it/s, atk: -100.217 ent: -2.608 str: 0.000 loss: -102.825]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.80it/s, atk: -107.635 ent: -2.605 str: 0.000 loss: -110.239]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.83it/s, atk: -107.635 ent: -2.605 str: 0.000 loss: -110.239]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.83it/s, atk: -115.792 ent: -2.601 str: 0.000 loss: -118.394]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.88it/s, atk: -115.792 ent: -2.601 str: 0.000 loss: -118.394]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.88it/s, atk: -123.600 ent: -2.599 str: 0.000 loss: -126.199]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.88it/s, atk: -123.600 ent: -2.599 str: 0.000 loss: -126.199]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.88it/s, atk: -129.984 ent: -2.596 str: 0.000 loss: -132.580]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.92it/s, atk: -129.984 ent: -2.596 str: 0.000 loss: -132.580]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.92it/s, atk: -135.058 ent: -2.594 str: 0.000 loss: -137.652]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.95it/s, atk: -135.058 ent: -2.594 str: 0.000 loss: -137.652]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.95it/s, atk: -140.579 ent: -2.594 str: 0.000 loss: -143.173]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -140.579 ent: -2.594 str: 0.000 loss: -143.173]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -146.138 ent: -2.594 str: 0.000 loss: -148.732]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -146.138 ent: -2.594 str: 0.000 loss: -148.732]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -151.123 ent: -2.593 str: 0.000 loss: -153.716]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -151.123 ent: -2.593 str: 0.000 loss: -153.716]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.95it/s, atk: -156.374 ent: -2.591 str: 0.000 loss: -158.966]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -156.374 ent: -2.591 str: 0.000 loss: -158.966]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -161.584 ent: -2.590 str: 0.000 loss: -164.174]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -161.584 ent: -2.590 str: 0.000 loss: -164.174]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -166.038 ent: -2.588 str: 0.000 loss: -168.626]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.99it/s, atk: -166.038 ent: -2.588 str: 0.000 loss: -168.626]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.99it/s, atk: -163.787 ent: -2.586 str: 0.000 loss: -166.372]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -163.787 ent: -2.586 str: 0.000 loss: -166.372]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -164.266 ent: -2.584 str: 0.000 loss: -166.850]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.98it/s, atk: -164.266 ent: -2.584 str: 0.000 loss: -166.850]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.98it/s, atk: -172.325 ent: -2.583 str: 0.000 loss: -174.908]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -172.325 ent: -2.583 str: 0.000 loss: -174.908]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.99it/s, atk: -179.531 ent: -2.584 str: 0.000 loss: -182.115]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -179.531 ent: -2.584 str: 0.000 loss: -182.115]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.93it/s, atk: -184.591 ent: -2.584 str: 0.000 loss: -187.175]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -184.591 ent: -2.584 str: 0.000 loss: -187.175]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -187.642 ent: -2.584 str: 0.000 loss: -190.226]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -187.642 ent: -2.584 str: 0.000 loss: -190.226]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.96it/s, atk: -192.209 ent: -2.584 str: 0.000 loss: -194.794]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.95it/s, atk: -192.209 ent: -2.584 str: 0.000 loss: -194.794]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.95it/s, atk: -198.032 ent: -2.585 str: 0.000 loss: -200.616]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -198.032 ent: -2.585 str: 0.000 loss: -200.616]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -204.828 ent: -2.583 str: 0.000 loss: -207.411]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -204.828 ent: -2.583 str: 0.000 loss: -207.411]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -211.496 ent: -2.582 str: 0.000 loss: -214.078]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.00it/s, atk: -211.496 ent: -2.582 str: 0.000 loss: -214.078]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.00it/s, atk: -218.387 ent: -2.582 str: 0.000 loss: -220.968]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.93it/s, atk: -218.387 ent: -2.582 str: 0.000 loss: -220.968]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.93it/s, atk: -224.155 ent: -2.582 str: 0.000 loss: -226.737]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.94it/s, atk: -224.155 ent: -2.582 str: 0.000 loss: -226.737]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.94it/s, atk: -229.832 ent: -2.582 str: 0.000 loss: -232.414]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.96it/s, atk: -229.832 ent: -2.582 str: 0.000 loss: -232.414]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.96it/s, atk: -235.934 ent: -2.581 str: 0.000 loss: -238.515]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.95it/s, atk: -235.934 ent: -2.581 str: 0.000 loss: -238.515]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.95it/s, atk: -241.797 ent: -2.580 str: 0.000 loss: -244.377]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.94it/s, atk: -241.797 ent: -2.580 str: 0.000 loss: -244.377]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.91it/s, atk: -241.797 ent: -2.580 str: 0.000 loss: -244.377]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([792], device='cuda:0') tensor(0.9942, device='cuda:0')
after_true: tensor([476], device='cuda:0') tensor(1.6004e-11, device='cuda:0')
L1: [2586.9414]	L2: [19.038261]	Linf: [0.7058824]

Accuracy on benign examples: 100.0%
gt_label: 458 pred_label: 458 pred_clean_logit 0.9997076392173767
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.85it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 23.74it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 25.09it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 25.74it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 26.13it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 25.56it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.37it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.12it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.00it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.04s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.16s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.29s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3489
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.007 ent: -2.584 str: 0.000 loss: -2.591]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.93s/it, atk: -0.007 ent: -2.584 str: 0.000 loss: -2.591]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.93s/it, atk: -0.018 ent: -2.588 str: 0.000 loss: -2.606]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -0.018 ent: -2.588 str: 0.000 loss: -2.606]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -0.031 ent: -2.591 str: 0.000 loss: -2.622]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.15it/s, atk: -0.031 ent: -2.591 str: 0.000 loss: -2.622]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.15it/s, atk: -0.065 ent: -2.596 str: 0.000 loss: -2.662]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.38it/s, atk: -0.065 ent: -2.596 str: 0.000 loss: -2.662]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.38it/s, atk: -0.183 ent: -2.600 str: 0.000 loss: -2.783]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.56it/s, atk: -0.183 ent: -2.600 str: 0.000 loss: -2.783]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.56it/s, atk: -0.531 ent: -2.598 str: 0.000 loss: -3.128]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.68it/s, atk: -0.531 ent: -2.598 str: 0.000 loss: -3.128]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.68it/s, atk: -0.538 ent: -2.595 str: 0.000 loss: -3.133]Iterations:  23%|██▎       | 7/30 [00:05<00:13,  1.75it/s, atk: -0.538 ent: -2.595 str: 0.000 loss: -3.133]Iterations:  23%|██▎       | 7/30 [00:05<00:13,  1.75it/s, atk: -1.110 ent: -2.595 str: 0.000 loss: -3.705]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.78it/s, atk: -1.110 ent: -2.595 str: 0.000 loss: -3.705]Iterations:  27%|██▋       | 8/30 [00:05<00:12,  1.78it/s, atk: -2.487 ent: -2.595 str: 0.000 loss: -5.082]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.85it/s, atk: -2.487 ent: -2.595 str: 0.000 loss: -5.082]Iterations:  30%|███       | 9/30 [00:06<00:11,  1.85it/s, atk: -4.907 ent: -2.592 str: 0.000 loss: -7.499]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.88it/s, atk: -4.907 ent: -2.592 str: 0.000 loss: -7.499]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.88it/s, atk: -7.951 ent: -2.588 str: 0.000 loss: -10.539]Iterations:  37%|███▋      | 11/30 [00:07<00:09,  1.92it/s, atk: -7.951 ent: -2.588 str: 0.000 loss: -10.539]Iterations:  37%|███▋      | 11/30 [00:07<00:09,  1.92it/s, atk: -10.502 ent: -2.585 str: 0.000 loss: -13.087]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.95it/s, atk: -10.502 ent: -2.585 str: 0.000 loss: -13.087]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.95it/s, atk: -16.761 ent: -2.584 str: 0.000 loss: -19.345]Iterations:  43%|████▎     | 13/30 [00:08<00:08,  1.95it/s, atk: -16.761 ent: -2.584 str: 0.000 loss: -19.345]Iterations:  43%|████▎     | 13/30 [00:08<00:08,  1.95it/s, atk: -22.242 ent: -2.583 str: 0.000 loss: -24.824]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -22.242 ent: -2.583 str: 0.000 loss: -24.824]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.95it/s, atk: -27.704 ent: -2.583 str: 0.000 loss: -30.287]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.96it/s, atk: -27.704 ent: -2.583 str: 0.000 loss: -30.287]Iterations:  50%|█████     | 15/30 [00:09<00:07,  1.96it/s, atk: -36.165 ent: -2.584 str: 0.000 loss: -38.749]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.95it/s, atk: -36.165 ent: -2.584 str: 0.000 loss: -38.749]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.95it/s, atk: -38.964 ent: -2.583 str: 0.000 loss: -41.548]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.96it/s, atk: -38.964 ent: -2.583 str: 0.000 loss: -41.548]Iterations:  57%|█████▋    | 17/30 [00:10<00:06,  1.96it/s, atk: -47.288 ent: -2.581 str: 0.000 loss: -49.869]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.00it/s, atk: -47.288 ent: -2.581 str: 0.000 loss: -49.869]Iterations:  60%|██████    | 18/30 [00:10<00:05,  2.00it/s, atk: -54.982 ent: -2.580 str: 0.000 loss: -57.561]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.01it/s, atk: -54.982 ent: -2.580 str: 0.000 loss: -57.561]Iterations:  63%|██████▎   | 19/30 [00:11<00:05,  2.01it/s, atk: -62.122 ent: -2.580 str: 0.000 loss: -64.703]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.01it/s, atk: -62.122 ent: -2.580 str: 0.000 loss: -64.703]Iterations:  67%|██████▋   | 20/30 [00:11<00:04,  2.01it/s, atk: -71.608 ent: -2.579 str: 0.000 loss: -74.187]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.96it/s, atk: -71.608 ent: -2.579 str: 0.000 loss: -74.187]Iterations:  70%|███████   | 21/30 [00:12<00:04,  1.96it/s, atk: -77.939 ent: -2.578 str: 0.000 loss: -80.517]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.98it/s, atk: -77.939 ent: -2.578 str: 0.000 loss: -80.517]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.98it/s, atk: -84.096 ent: -2.579 str: 0.000 loss: -86.674]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.97it/s, atk: -84.096 ent: -2.579 str: 0.000 loss: -86.674]Iterations:  77%|███████▋  | 23/30 [00:13<00:03,  1.97it/s, atk: -91.146 ent: -2.580 str: 0.000 loss: -93.726]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.98it/s, atk: -91.146 ent: -2.580 str: 0.000 loss: -93.726]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.98it/s, atk: -94.722 ent: -2.578 str: 0.000 loss: -97.300]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.96it/s, atk: -94.722 ent: -2.578 str: 0.000 loss: -97.300]Iterations:  83%|████████▎ | 25/30 [00:14<00:02,  1.96it/s, atk: -102.662 ent: -2.578 str: 0.000 loss: -105.240]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -102.662 ent: -2.578 str: 0.000 loss: -105.240]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.98it/s, atk: -112.366 ent: -2.578 str: 0.000 loss: -114.944]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.99it/s, atk: -112.366 ent: -2.578 str: 0.000 loss: -114.944]Iterations:  90%|█████████ | 27/30 [00:15<00:01,  1.99it/s, atk: -120.106 ent: -2.576 str: 0.000 loss: -122.682]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.96it/s, atk: -120.106 ent: -2.576 str: 0.000 loss: -122.682]Iterations:  93%|█████████▎| 28/30 [00:16<00:01,  1.96it/s, atk: -126.896 ent: -2.573 str: 0.000 loss: -129.470]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.94it/s, atk: -126.896 ent: -2.573 str: 0.000 loss: -129.470]Iterations:  97%|█████████▋| 29/30 [00:16<00:00,  1.94it/s, atk: -133.883 ent: -2.572 str: 0.000 loss: -136.455]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.96it/s, atk: -133.883 ent: -2.572 str: 0.000 loss: -136.455]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.79it/s, atk: -133.883 ent: -2.572 str: 0.000 loss: -136.455]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([640], device='cuda:0') tensor(0.9991, device='cuda:0')
after_true: tensor([458], device='cuda:0') tensor(7.5948e-07, device='cuda:0')
L1: [2996.0942]	L2: [18.406315]	Linf: [0.56078434]

Accuracy on benign examples: 100.0%
gt_label: 470 pred_label: 470 pred_clean_logit 0.9973229765892029
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.33it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 22.99it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 24.53it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 25.13it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.76it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 26.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.44it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.13it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:03,  1.01s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.10s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.27s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3666
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.199 ent: -2.580 str: 0.000 loss: -2.779]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.04s/it, atk: -0.199 ent: -2.580 str: 0.000 loss: -2.779]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.04s/it, atk: -0.947 ent: -2.578 str: 0.000 loss: -3.526]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.37it/s, atk: -0.947 ent: -2.578 str: 0.000 loss: -3.526]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.37it/s, atk: -2.078 ent: -2.572 str: 0.000 loss: -4.650]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.56it/s, atk: -2.078 ent: -2.572 str: 0.000 loss: -4.650]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.56it/s, atk: -5.428 ent: -2.569 str: 0.000 loss: -7.997]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.71it/s, atk: -5.428 ent: -2.569 str: 0.000 loss: -7.997]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.71it/s, atk: -12.617 ent: -2.568 str: 0.000 loss: -15.185]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.81it/s, atk: -12.617 ent: -2.568 str: 0.000 loss: -15.185]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.81it/s, atk: -22.032 ent: -2.570 str: 0.000 loss: -24.602]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.83it/s, atk: -22.032 ent: -2.570 str: 0.000 loss: -24.602]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.83it/s, atk: -31.559 ent: -2.570 str: 0.000 loss: -34.129]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -31.559 ent: -2.570 str: 0.000 loss: -34.129]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -41.288 ent: -2.568 str: 0.000 loss: -43.856]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.92it/s, atk: -41.288 ent: -2.568 str: 0.000 loss: -43.856]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.92it/s, atk: -51.486 ent: -2.568 str: 0.000 loss: -54.054]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.89it/s, atk: -51.486 ent: -2.568 str: 0.000 loss: -54.054]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.89it/s, atk: -59.964 ent: -2.566 str: 0.000 loss: -62.529]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.90it/s, atk: -59.964 ent: -2.566 str: 0.000 loss: -62.529]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.90it/s, atk: -70.540 ent: -2.564 str: 0.000 loss: -73.104]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -70.540 ent: -2.564 str: 0.000 loss: -73.104]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.93it/s, atk: -79.172 ent: -2.563 str: 0.000 loss: -81.735]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -79.172 ent: -2.563 str: 0.000 loss: -81.735]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -87.520 ent: -2.561 str: 0.000 loss: -90.081]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -87.520 ent: -2.561 str: 0.000 loss: -90.081]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.95it/s, atk: -94.165 ent: -2.560 str: 0.000 loss: -96.725]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -94.165 ent: -2.560 str: 0.000 loss: -96.725]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -100.823 ent: -2.559 str: 0.000 loss: -103.383]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.95it/s, atk: -100.823 ent: -2.559 str: 0.000 loss: -103.383]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.95it/s, atk: -107.088 ent: -2.558 str: 0.000 loss: -109.646]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.95it/s, atk: -107.088 ent: -2.558 str: 0.000 loss: -109.646]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.95it/s, atk: -113.543 ent: -2.556 str: 0.000 loss: -116.100]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.93it/s, atk: -113.543 ent: -2.556 str: 0.000 loss: -116.100]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.93it/s, atk: -118.843 ent: -2.555 str: 0.000 loss: -121.398]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.95it/s, atk: -118.843 ent: -2.555 str: 0.000 loss: -121.398]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.95it/s, atk: -126.126 ent: -2.555 str: 0.000 loss: -128.682]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.94it/s, atk: -126.126 ent: -2.555 str: 0.000 loss: -128.682]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.94it/s, atk: -131.411 ent: -2.555 str: 0.000 loss: -133.966]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.91it/s, atk: -131.411 ent: -2.555 str: 0.000 loss: -133.966]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.91it/s, atk: -135.851 ent: -2.552 str: 0.000 loss: -138.403]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.90it/s, atk: -135.851 ent: -2.552 str: 0.000 loss: -138.403]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.90it/s, atk: -140.106 ent: -2.550 str: 0.000 loss: -142.656]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.93it/s, atk: -140.106 ent: -2.550 str: 0.000 loss: -142.656]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.93it/s, atk: -145.616 ent: -2.550 str: 0.000 loss: -148.166]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -145.616 ent: -2.550 str: 0.000 loss: -148.166]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.96it/s, atk: -150.804 ent: -2.549 str: 0.000 loss: -153.354]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.96it/s, atk: -150.804 ent: -2.549 str: 0.000 loss: -153.354]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.96it/s, atk: -151.341 ent: -2.548 str: 0.000 loss: -153.889]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.99it/s, atk: -151.341 ent: -2.548 str: 0.000 loss: -153.889]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.99it/s, atk: -153.700 ent: -2.544 str: 0.000 loss: -156.243]Iterations:  87%|████████▋ | 26/30 [00:13<00:01,  2.00it/s, atk: -153.700 ent: -2.544 str: 0.000 loss: -156.243]Iterations:  87%|████████▋ | 26/30 [00:14<00:01,  2.00it/s, atk: -154.973 ent: -2.543 str: 0.000 loss: -157.516]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.02it/s, atk: -154.973 ent: -2.543 str: 0.000 loss: -157.516]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.02it/s, atk: -157.932 ent: -2.543 str: 0.000 loss: -160.475]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.98it/s, atk: -157.932 ent: -2.543 str: 0.000 loss: -160.475]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -162.478 ent: -2.543 str: 0.000 loss: -165.021]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -162.478 ent: -2.543 str: 0.000 loss: -165.021]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.00it/s, atk: -162.699 ent: -2.543 str: 0.000 loss: -165.242]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.01it/s, atk: -162.699 ent: -2.543 str: 0.000 loss: -165.242]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -162.699 ent: -2.543 str: 0.000 loss: -165.242]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([716], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([470], device='cuda:0') tensor(4.6499e-08, device='cuda:0')
L1: [2111.7805]	L2: [17.757982]	Linf: [0.84705883]

Accuracy on benign examples: 100.0%
gt_label: 97 pred_label: 97 pred_clean_logit 0.9746637344360352
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 22.66it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.65it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.31it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.67it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.81it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.12it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.11it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.02it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.09s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.19s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.10s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5074
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.022 ent: -2.575 str: 0.000 loss: -2.597]Iterations:   3%|▎         | 1/30 [00:00<00:25,  1.12it/s, atk: -0.022 ent: -2.575 str: 0.000 loss: -2.597]Iterations:   3%|▎         | 1/30 [00:01<00:25,  1.12it/s, atk: -0.400 ent: -2.568 str: 0.000 loss: -2.968]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -0.400 ent: -2.568 str: 0.000 loss: -2.968]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.53it/s, atk: -0.640 ent: -2.566 str: 0.000 loss: -3.206]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.73it/s, atk: -0.640 ent: -2.566 str: 0.000 loss: -3.206]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.73it/s, atk: -2.655 ent: -2.573 str: 0.000 loss: -5.229]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.84it/s, atk: -2.655 ent: -2.573 str: 0.000 loss: -5.229]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.84it/s, atk: -6.426 ent: -2.568 str: 0.000 loss: -8.994]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.87it/s, atk: -6.426 ent: -2.568 str: 0.000 loss: -8.994]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.87it/s, atk: -13.172 ent: -2.571 str: 0.000 loss: -15.743]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.93it/s, atk: -13.172 ent: -2.571 str: 0.000 loss: -15.743]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.93it/s, atk: -27.476 ent: -2.577 str: 0.000 loss: -30.053]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.96it/s, atk: -27.476 ent: -2.577 str: 0.000 loss: -30.053]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.96it/s, atk: -38.202 ent: -2.578 str: 0.000 loss: -40.780]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.96it/s, atk: -38.202 ent: -2.578 str: 0.000 loss: -40.780]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.96it/s, atk: -54.720 ent: -2.578 str: 0.000 loss: -57.298]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.97it/s, atk: -54.720 ent: -2.578 str: 0.000 loss: -57.298]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.97it/s, atk: -65.532 ent: -2.576 str: 0.000 loss: -68.108]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.99it/s, atk: -65.532 ent: -2.576 str: 0.000 loss: -68.108]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.99it/s, atk: -88.408 ent: -2.572 str: 0.000 loss: -90.980]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.01it/s, atk: -88.408 ent: -2.572 str: 0.000 loss: -90.980]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  2.01it/s, atk: -98.127 ent: -2.569 str: 0.000 loss: -100.696]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.02it/s, atk: -98.127 ent: -2.569 str: 0.000 loss: -100.696]Iterations:  40%|████      | 12/30 [00:06<00:08,  2.02it/s, atk: -114.534 ent: -2.566 str: 0.000 loss: -117.100]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.03it/s, atk: -114.534 ent: -2.566 str: 0.000 loss: -117.100]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.03it/s, atk: -124.773 ent: -2.564 str: 0.000 loss: -127.337]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.01it/s, atk: -124.773 ent: -2.564 str: 0.000 loss: -127.337]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.01it/s, atk: -143.561 ent: -2.563 str: 0.000 loss: -146.124]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.97it/s, atk: -143.561 ent: -2.563 str: 0.000 loss: -146.124]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -157.048 ent: -2.563 str: 0.000 loss: -159.611]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.00it/s, atk: -157.048 ent: -2.563 str: 0.000 loss: -159.611]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.00it/s, atk: -165.716 ent: -2.563 str: 0.000 loss: -168.280]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.98it/s, atk: -165.716 ent: -2.563 str: 0.000 loss: -168.280]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.98it/s, atk: -177.264 ent: -2.565 str: 0.000 loss: -179.829]Iterations:  60%|██████    | 18/30 [00:09<00:06,  2.00it/s, atk: -177.264 ent: -2.565 str: 0.000 loss: -179.829]Iterations:  60%|██████    | 18/30 [00:09<00:06,  2.00it/s, atk: -188.607 ent: -2.566 str: 0.000 loss: -191.173]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.01it/s, atk: -188.607 ent: -2.566 str: 0.000 loss: -191.173]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.01it/s, atk: -197.472 ent: -2.565 str: 0.000 loss: -200.037]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  2.00it/s, atk: -197.472 ent: -2.565 str: 0.000 loss: -200.037]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  2.00it/s, atk: -205.906 ent: -2.565 str: 0.000 loss: -208.471]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.01it/s, atk: -205.906 ent: -2.565 str: 0.000 loss: -208.471]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.01it/s, atk: -215.506 ent: -2.565 str: 0.000 loss: -218.071]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.03it/s, atk: -215.506 ent: -2.565 str: 0.000 loss: -218.071]Iterations:  73%|███████▎  | 22/30 [00:11<00:03,  2.03it/s, atk: -224.142 ent: -2.564 str: 0.000 loss: -226.705]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  2.00it/s, atk: -224.142 ent: -2.564 str: 0.000 loss: -226.705]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  2.00it/s, atk: -232.538 ent: -2.564 str: 0.000 loss: -235.103]Iterations:  80%|████████  | 24/30 [00:12<00:03,  2.00it/s, atk: -232.538 ent: -2.564 str: 0.000 loss: -235.103]Iterations:  80%|████████  | 24/30 [00:12<00:03,  2.00it/s, atk: -240.037 ent: -2.565 str: 0.000 loss: -242.602]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  2.00it/s, atk: -240.037 ent: -2.565 str: 0.000 loss: -242.602]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  2.00it/s, atk: -246.033 ent: -2.566 str: 0.000 loss: -248.599]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -246.033 ent: -2.566 str: 0.000 loss: -248.599]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.97it/s, atk: -252.999 ent: -2.566 str: 0.000 loss: -255.565]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  2.00it/s, atk: -252.999 ent: -2.566 str: 0.000 loss: -255.565]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.00it/s, atk: -259.138 ent: -2.566 str: 0.000 loss: -261.704]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.01it/s, atk: -259.138 ent: -2.566 str: 0.000 loss: -261.704]Iterations:  93%|█████████▎| 28/30 [00:14<00:00,  2.01it/s, atk: -264.741 ent: -2.566 str: 0.000 loss: -267.306]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  2.03it/s, atk: -264.741 ent: -2.566 str: 0.000 loss: -267.306]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  2.03it/s, atk: -270.610 ent: -2.566 str: 0.000 loss: -273.176]Iterations: 100%|██████████| 30/30 [00:15<00:00,  2.00it/s, atk: -270.610 ent: -2.566 str: 0.000 loss: -273.176]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.96it/s, atk: -270.610 ent: -2.566 str: 0.000 loss: -273.176]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([17], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([97], device='cuda:0') tensor(1.0170e-12, device='cuda:0')
L1: [3887.792]	L2: [25.210114]	Linf: [0.7411765]

Accuracy on benign examples: 100.0%
gt_label: 814 pred_label: 814 pred_clean_logit 0.9920897483825684
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 22.89it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.83it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.41it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.02it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.67it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.59it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.24it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.09it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:02,  1.01s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.15s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.16s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4627
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.131 ent: -6.431 str: 0.000 loss: -6.562]Iterations:   3%|▎         | 1/30 [00:01<00:32,  1.13s/it, atk: -0.131 ent: -6.431 str: 0.000 loss: -6.562]Iterations:   3%|▎         | 1/30 [00:01<00:32,  1.13s/it, atk: -0.310 ent: -6.411 str: 0.000 loss: -6.721]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.24it/s, atk: -0.310 ent: -6.411 str: 0.000 loss: -6.721]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.24it/s, atk: -0.909 ent: -6.407 str: 0.000 loss: -7.316]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.48it/s, atk: -0.909 ent: -6.407 str: 0.000 loss: -7.316]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.48it/s, atk: -3.410 ent: -6.413 str: 0.000 loss: -9.824]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.65it/s, atk: -3.410 ent: -6.413 str: 0.000 loss: -9.824]Iterations:  13%|█▎        | 4/30 [00:03<00:15,  1.65it/s, atk: -12.099 ent: -6.414 str: 0.000 loss: -18.513]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -12.099 ent: -6.414 str: 0.000 loss: -18.513]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -22.999 ent: -6.415 str: 0.000 loss: -29.413]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.81it/s, atk: -22.999 ent: -6.415 str: 0.000 loss: -29.413]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.81it/s, atk: -30.806 ent: -6.412 str: 0.000 loss: -37.218]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -30.806 ent: -6.412 str: 0.000 loss: -37.218]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -40.480 ent: -6.412 str: 0.000 loss: -46.891]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.86it/s, atk: -40.480 ent: -6.412 str: 0.000 loss: -46.891]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.86it/s, atk: -65.337 ent: -6.405 str: 0.000 loss: -71.743]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -65.337 ent: -6.405 str: 0.000 loss: -71.743]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -64.685 ent: -6.400 str: 0.000 loss: -71.086]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.91it/s, atk: -64.685 ent: -6.400 str: 0.000 loss: -71.086]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.91it/s, atk: -77.952 ent: -6.404 str: 0.000 loss: -84.356]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.89it/s, atk: -77.952 ent: -6.404 str: 0.000 loss: -84.356]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.89it/s, atk: -88.775 ent: -6.410 str: 0.000 loss: -95.185]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.85it/s, atk: -88.775 ent: -6.410 str: 0.000 loss: -95.185]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.85it/s, atk: -93.626 ent: -6.409 str: 0.000 loss: -100.035]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.82it/s, atk: -93.626 ent: -6.409 str: 0.000 loss: -100.035]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.82it/s, atk: -101.899 ent: -6.406 str: 0.000 loss: -108.305]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.81it/s, atk: -101.899 ent: -6.406 str: 0.000 loss: -108.305]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.81it/s, atk: -108.761 ent: -6.405 str: 0.000 loss: -115.166]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.84it/s, atk: -108.761 ent: -6.405 str: 0.000 loss: -115.166]Iterations:  50%|█████     | 15/30 [00:08<00:08,  1.84it/s, atk: -112.685 ent: -6.405 str: 0.000 loss: -119.089]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.87it/s, atk: -112.685 ent: -6.405 str: 0.000 loss: -119.089]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.87it/s, atk: -116.373 ent: -6.406 str: 0.000 loss: -122.779]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.91it/s, atk: -116.373 ent: -6.406 str: 0.000 loss: -122.779]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.91it/s, atk: -119.511 ent: -6.406 str: 0.000 loss: -125.917]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.94it/s, atk: -119.511 ent: -6.406 str: 0.000 loss: -125.917]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.94it/s, atk: -124.891 ent: -6.408 str: 0.000 loss: -131.299]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -124.891 ent: -6.408 str: 0.000 loss: -131.299]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -129.429 ent: -6.408 str: 0.000 loss: -135.837]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.93it/s, atk: -129.429 ent: -6.408 str: 0.000 loss: -135.837]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.93it/s, atk: -131.288 ent: -6.407 str: 0.000 loss: -137.695]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.94it/s, atk: -131.288 ent: -6.407 str: 0.000 loss: -137.695]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.94it/s, atk: -134.448 ent: -6.407 str: 0.000 loss: -140.855]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.96it/s, atk: -134.448 ent: -6.407 str: 0.000 loss: -140.855]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.96it/s, atk: -137.996 ent: -6.408 str: 0.000 loss: -144.404]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.91it/s, atk: -137.996 ent: -6.408 str: 0.000 loss: -144.404]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.91it/s, atk: -141.510 ent: -6.408 str: 0.000 loss: -147.918]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -141.510 ent: -6.408 str: 0.000 loss: -147.918]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.94it/s, atk: -143.703 ent: -6.409 str: 0.000 loss: -150.112]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -143.703 ent: -6.409 str: 0.000 loss: -150.112]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.93it/s, atk: -146.359 ent: -6.409 str: 0.000 loss: -152.768]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.96it/s, atk: -146.359 ent: -6.409 str: 0.000 loss: -152.768]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.96it/s, atk: -150.367 ent: -6.407 str: 0.000 loss: -156.774]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -150.367 ent: -6.407 str: 0.000 loss: -156.774]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.98it/s, atk: -152.954 ent: -6.408 str: 0.000 loss: -159.362]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -152.954 ent: -6.408 str: 0.000 loss: -159.362]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.98it/s, atk: -155.867 ent: -6.408 str: 0.000 loss: -162.274]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -155.867 ent: -6.408 str: 0.000 loss: -162.274]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.99it/s, atk: -157.439 ent: -6.407 str: 0.000 loss: -163.846]Iterations: 100%|██████████| 30/30 [00:16<00:00,  2.00it/s, atk: -157.439 ent: -6.407 str: 0.000 loss: -163.846]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.85it/s, atk: -157.439 ent: -6.407 str: 0.000 loss: -163.846]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([435], device='cuda:0') tensor(0.7797, device='cuda:0')
after_true: tensor([814], device='cuda:0') tensor(1.1265e-07, device='cuda:0')
L1: [1652.5647]	L2: [14.297958]	Linf: [0.73333335]

Accuracy on benign examples: 100.0%
gt_label: 582 pred_label: 582 pred_clean_logit 0.932429313659668
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 23.29it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 24.83it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.79it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.23it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 25.92it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.22it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.80it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.14it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.04it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.13s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.22s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5661
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.576 ent: -5.097 str: 0.000 loss: -5.672]Iterations:   3%|▎         | 1/30 [00:00<00:18,  1.59it/s, atk: -0.576 ent: -5.097 str: 0.000 loss: -5.672]Iterations:   3%|▎         | 1/30 [00:00<00:18,  1.59it/s, atk: -1.782 ent: -5.073 str: 0.000 loss: -6.855]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.80it/s, atk: -1.782 ent: -5.073 str: 0.000 loss: -6.855]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.80it/s, atk: -3.433 ent: -5.075 str: 0.000 loss: -8.508]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.90it/s, atk: -3.433 ent: -5.075 str: 0.000 loss: -8.508]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.90it/s, atk: -6.381 ent: -5.075 str: 0.000 loss: -11.456]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.94it/s, atk: -6.381 ent: -5.075 str: 0.000 loss: -11.456]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.94it/s, atk: -11.111 ent: -5.065 str: 0.000 loss: -16.176]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.98it/s, atk: -11.111 ent: -5.065 str: 0.000 loss: -16.176]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.98it/s, atk: -13.371 ent: -5.065 str: 0.000 loss: -18.436]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.97it/s, atk: -13.371 ent: -5.065 str: 0.000 loss: -18.436]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.97it/s, atk: -25.245 ent: -5.065 str: 0.000 loss: -30.310]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.99it/s, atk: -25.245 ent: -5.065 str: 0.000 loss: -30.310]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.99it/s, atk: -36.030 ent: -5.062 str: 0.000 loss: -41.092]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.99it/s, atk: -36.030 ent: -5.062 str: 0.000 loss: -41.092]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.99it/s, atk: -41.354 ent: -5.059 str: 0.000 loss: -46.413]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.99it/s, atk: -41.354 ent: -5.059 str: 0.000 loss: -46.413]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.99it/s, atk: -49.221 ent: -5.053 str: 0.000 loss: -54.273]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -49.221 ent: -5.053 str: 0.000 loss: -54.273]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -59.646 ent: -5.062 str: 0.000 loss: -64.708]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.01it/s, atk: -59.646 ent: -5.062 str: 0.000 loss: -64.708]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.01it/s, atk: -69.641 ent: -5.065 str: 0.000 loss: -74.706]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.91it/s, atk: -69.641 ent: -5.065 str: 0.000 loss: -74.706]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.91it/s, atk: -75.998 ent: -5.072 str: 0.000 loss: -81.070]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.95it/s, atk: -75.998 ent: -5.072 str: 0.000 loss: -81.070]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.95it/s, atk: -83.972 ent: -5.070 str: 0.000 loss: -89.043]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -83.972 ent: -5.070 str: 0.000 loss: -89.043]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.97it/s, atk: -77.213 ent: -5.070 str: 0.000 loss: -82.283]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.99it/s, atk: -77.213 ent: -5.070 str: 0.000 loss: -82.283]Iterations:  50%|█████     | 15/30 [00:07<00:07,  1.99it/s, atk: -93.511 ent: -5.072 str: 0.000 loss: -98.583]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -93.511 ent: -5.072 str: 0.000 loss: -98.583]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.99it/s, atk: -99.465 ent: -5.073 str: 0.000 loss: -104.538]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.96it/s, atk: -99.465 ent: -5.073 str: 0.000 loss: -104.538]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  1.96it/s, atk: -103.126 ent: -5.068 str: 0.000 loss: -108.194]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -103.126 ent: -5.068 str: 0.000 loss: -108.194]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -111.401 ent: -5.071 str: 0.000 loss: -116.472]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.96it/s, atk: -111.401 ent: -5.071 str: 0.000 loss: -116.472]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  1.96it/s, atk: -117.493 ent: -5.072 str: 0.000 loss: -122.566]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -117.493 ent: -5.072 str: 0.000 loss: -122.566]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -121.684 ent: -5.072 str: 0.000 loss: -126.755]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.99it/s, atk: -121.684 ent: -5.072 str: 0.000 loss: -126.755]Iterations:  70%|███████   | 21/30 [00:10<00:04,  1.99it/s, atk: -130.619 ent: -5.072 str: 0.000 loss: -135.692]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.99it/s, atk: -130.619 ent: -5.072 str: 0.000 loss: -135.692]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.99it/s, atk: -136.328 ent: -5.071 str: 0.000 loss: -141.399]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.99it/s, atk: -136.328 ent: -5.071 str: 0.000 loss: -141.399]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.99it/s, atk: -139.710 ent: -5.069 str: 0.000 loss: -144.779]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.97it/s, atk: -139.710 ent: -5.069 str: 0.000 loss: -144.779]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.97it/s, atk: -147.042 ent: -5.070 str: 0.000 loss: -152.112]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.88it/s, atk: -147.042 ent: -5.070 str: 0.000 loss: -152.112]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.88it/s, atk: -154.407 ent: -5.071 str: 0.000 loss: -159.479]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.92it/s, atk: -154.407 ent: -5.071 str: 0.000 loss: -159.479]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.92it/s, atk: -160.805 ent: -5.071 str: 0.000 loss: -165.876]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  1.95it/s, atk: -160.805 ent: -5.071 str: 0.000 loss: -165.876]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -165.492 ent: -5.069 str: 0.000 loss: -170.561]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.95it/s, atk: -165.492 ent: -5.069 str: 0.000 loss: -170.561]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.95it/s, atk: -170.454 ent: -5.069 str: 0.000 loss: -175.523]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.97it/s, atk: -170.454 ent: -5.069 str: 0.000 loss: -175.523]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -175.146 ent: -5.068 str: 0.000 loss: -180.215]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.97it/s, atk: -175.146 ent: -5.068 str: 0.000 loss: -180.215]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.96it/s, atk: -175.146 ent: -5.068 str: 0.000 loss: -180.215]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([547], device='cuda:0') tensor(0.7360, device='cuda:0')
after_true: tensor([582], device='cuda:0') tensor(1.2528e-08, device='cuda:0')
L1: [4349.875]	L2: [28.254208]	Linf: [0.7921569]

Accuracy on benign examples: 100.0%
gt_label: 580 pred_label: 580 pred_clean_logit 0.9841015934944153
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 24.78it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.93it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.14it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.88it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.67it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.39it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.02it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.04s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.04s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.08s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.33s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.24s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4054
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.399 ent: -2.460 str: 0.000 loss: -3.858]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -1.399 ent: -2.460 str: 0.000 loss: -3.858]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -2.707 ent: -2.456 str: 0.000 loss: -5.163]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.24it/s, atk: -2.707 ent: -2.456 str: 0.000 loss: -5.163]Iterations:   7%|▋         | 2/30 [00:02<00:22,  1.24it/s, atk: -28.543 ent: -2.452 str: 0.000 loss: -30.995]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.48it/s, atk: -28.543 ent: -2.452 str: 0.000 loss: -30.995]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.48it/s, atk: -63.511 ent: -2.450 str: 0.000 loss: -65.961]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.61it/s, atk: -63.511 ent: -2.450 str: 0.000 loss: -65.961]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.61it/s, atk: -78.718 ent: -2.450 str: 0.000 loss: -81.168]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -78.718 ent: -2.450 str: 0.000 loss: -81.168]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.74it/s, atk: -103.317 ent: -2.449 str: 0.000 loss: -105.765]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.80it/s, atk: -103.317 ent: -2.449 str: 0.000 loss: -105.765]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.80it/s, atk: -119.898 ent: -2.447 str: 0.000 loss: -122.345]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -119.898 ent: -2.447 str: 0.000 loss: -122.345]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -138.003 ent: -2.446 str: 0.000 loss: -140.449]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -138.003 ent: -2.446 str: 0.000 loss: -140.449]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.91it/s, atk: -148.579 ent: -2.444 str: 0.000 loss: -151.023]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.95it/s, atk: -148.579 ent: -2.444 str: 0.000 loss: -151.023]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.95it/s, atk: -161.035 ent: -2.442 str: 0.000 loss: -163.477]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.97it/s, atk: -161.035 ent: -2.442 str: 0.000 loss: -163.477]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.97it/s, atk: -171.978 ent: -2.442 str: 0.000 loss: -174.420]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -171.978 ent: -2.442 str: 0.000 loss: -174.420]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.99it/s, atk: -182.477 ent: -2.442 str: 0.000 loss: -184.919]Iterations:  40%|████      | 12/30 [00:06<00:09,  2.00it/s, atk: -182.477 ent: -2.442 str: 0.000 loss: -184.919]Iterations:  40%|████      | 12/30 [00:07<00:09,  2.00it/s, atk: -195.356 ent: -2.443 str: 0.000 loss: -197.799]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.00it/s, atk: -195.356 ent: -2.443 str: 0.000 loss: -197.799]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.00it/s, atk: -202.957 ent: -2.444 str: 0.000 loss: -205.401]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.01it/s, atk: -202.957 ent: -2.444 str: 0.000 loss: -205.401]Iterations:  47%|████▋     | 14/30 [00:08<00:07,  2.01it/s, atk: -212.797 ent: -2.444 str: 0.000 loss: -215.241]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.01it/s, atk: -212.797 ent: -2.444 str: 0.000 loss: -215.241]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.01it/s, atk: -219.719 ent: -2.443 str: 0.000 loss: -222.163]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.98it/s, atk: -219.719 ent: -2.443 str: 0.000 loss: -222.163]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.98it/s, atk: -226.856 ent: -2.442 str: 0.000 loss: -229.298]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -226.856 ent: -2.442 str: 0.000 loss: -229.298]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.97it/s, atk: -237.088 ent: -2.442 str: 0.000 loss: -239.530]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -237.088 ent: -2.442 str: 0.000 loss: -239.530]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.96it/s, atk: -246.840 ent: -2.441 str: 0.000 loss: -249.281]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.99it/s, atk: -246.840 ent: -2.441 str: 0.000 loss: -249.281]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.99it/s, atk: -254.859 ent: -2.441 str: 0.000 loss: -257.300]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -254.859 ent: -2.441 str: 0.000 loss: -257.300]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.95it/s, atk: -263.223 ent: -2.441 str: 0.000 loss: -265.664]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -263.223 ent: -2.441 str: 0.000 loss: -265.664]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.98it/s, atk: -269.029 ent: -2.441 str: 0.000 loss: -271.471]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -269.029 ent: -2.441 str: 0.000 loss: -271.471]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.97it/s, atk: -276.711 ent: -2.441 str: 0.000 loss: -279.152]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -276.711 ent: -2.441 str: 0.000 loss: -279.152]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -283.866 ent: -2.442 str: 0.000 loss: -286.307]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.98it/s, atk: -283.866 ent: -2.442 str: 0.000 loss: -286.307]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.98it/s, atk: -290.777 ent: -2.442 str: 0.000 loss: -293.218]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.99it/s, atk: -290.777 ent: -2.442 str: 0.000 loss: -293.218]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.99it/s, atk: -298.863 ent: -2.441 str: 0.000 loss: -301.304]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  2.00it/s, atk: -298.863 ent: -2.441 str: 0.000 loss: -301.304]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  2.00it/s, atk: -303.330 ent: -2.441 str: 0.000 loss: -305.771]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.01it/s, atk: -303.330 ent: -2.441 str: 0.000 loss: -305.771]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.01it/s, atk: -312.115 ent: -2.440 str: 0.000 loss: -314.556]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  2.00it/s, atk: -312.115 ent: -2.440 str: 0.000 loss: -314.556]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  2.00it/s, atk: -318.380 ent: -2.440 str: 0.000 loss: -320.820]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -318.380 ent: -2.440 str: 0.000 loss: -320.820]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -325.022 ent: -2.440 str: 0.000 loss: -327.462]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.99it/s, atk: -325.022 ent: -2.440 str: 0.000 loss: -327.462]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.89it/s, atk: -325.022 ent: -2.440 str: 0.000 loss: -327.462]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([428], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([580], device='cuda:0') tensor(4.2092e-15, device='cuda:0')
L1: [4290.024]	L2: [28.130909]	Linf: [0.8980392]

Accuracy on benign examples: 100.0%
gt_label: 619 pred_label: 619 pred_clean_logit 0.6945925951004028
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.17it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 23.16it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.69it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 24.70it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 25.20it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 24.42it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.37it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.07it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.03it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.06s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.18s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.18s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6007
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -5.264 ent: -5.167 str: 0.000 loss: -10.431]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.17s/it, atk: -5.264 ent: -5.167 str: 0.000 loss: -10.431]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.17s/it, atk: -8.147 ent: -5.178 str: 0.000 loss: -13.325]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.27it/s, atk: -8.147 ent: -5.178 str: 0.000 loss: -13.325]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.27it/s, atk: -8.747 ent: -5.186 str: 0.000 loss: -13.933]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.52it/s, atk: -8.747 ent: -5.186 str: 0.000 loss: -13.933]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.52it/s, atk: -10.230 ent: -5.188 str: 0.000 loss: -15.418]Iterations:  13%|█▎        | 4/30 [00:02<00:16,  1.60it/s, atk: -10.230 ent: -5.188 str: 0.000 loss: -15.418]Iterations:  13%|█▎        | 4/30 [00:03<00:16,  1.60it/s, atk: -11.672 ent: -5.183 str: 0.000 loss: -16.855]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.71it/s, atk: -11.672 ent: -5.183 str: 0.000 loss: -16.855]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.71it/s, atk: -14.028 ent: -5.184 str: 0.000 loss: -19.212]Iterations:  20%|██        | 6/30 [00:03<00:13,  1.80it/s, atk: -14.028 ent: -5.184 str: 0.000 loss: -19.212]Iterations:  20%|██        | 6/30 [00:04<00:13,  1.80it/s, atk: -17.029 ent: -5.186 str: 0.000 loss: -22.215]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -17.029 ent: -5.186 str: 0.000 loss: -22.215]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.86it/s, atk: -21.493 ent: -5.189 str: 0.000 loss: -26.682]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.91it/s, atk: -21.493 ent: -5.189 str: 0.000 loss: -26.682]Iterations:  27%|██▋       | 8/30 [00:05<00:11,  1.91it/s, atk: -22.974 ent: -5.190 str: 0.000 loss: -28.165]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -22.974 ent: -5.190 str: 0.000 loss: -28.165]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -26.034 ent: -5.189 str: 0.000 loss: -31.223]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.87it/s, atk: -26.034 ent: -5.189 str: 0.000 loss: -31.223]Iterations:  33%|███▎      | 10/30 [00:06<00:10,  1.87it/s, atk: -28.441 ent: -5.186 str: 0.000 loss: -33.628]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.91it/s, atk: -28.441 ent: -5.186 str: 0.000 loss: -33.628]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.91it/s, atk: -31.356 ent: -5.185 str: 0.000 loss: -36.541]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.94it/s, atk: -31.356 ent: -5.185 str: 0.000 loss: -36.541]Iterations:  40%|████      | 12/30 [00:07<00:09,  1.94it/s, atk: -33.503 ent: -5.184 str: 0.000 loss: -38.687]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -33.503 ent: -5.184 str: 0.000 loss: -38.687]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.97it/s, atk: -35.906 ent: -5.183 str: 0.000 loss: -41.089]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.98it/s, atk: -35.906 ent: -5.183 str: 0.000 loss: -41.089]Iterations:  47%|████▋     | 14/30 [00:08<00:08,  1.98it/s, atk: -39.491 ent: -5.181 str: 0.000 loss: -44.672]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.95it/s, atk: -39.491 ent: -5.181 str: 0.000 loss: -44.672]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.95it/s, atk: -43.010 ent: -5.179 str: 0.000 loss: -48.189]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.92it/s, atk: -43.010 ent: -5.179 str: 0.000 loss: -48.189]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.92it/s, atk: -45.827 ent: -5.178 str: 0.000 loss: -51.005]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -45.827 ent: -5.178 str: 0.000 loss: -51.005]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -48.688 ent: -5.176 str: 0.000 loss: -53.864]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.97it/s, atk: -48.688 ent: -5.176 str: 0.000 loss: -53.864]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.97it/s, atk: -51.207 ent: -5.175 str: 0.000 loss: -56.382]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -51.207 ent: -5.175 str: 0.000 loss: -56.382]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.96it/s, atk: -53.921 ent: -5.174 str: 0.000 loss: -59.095]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.97it/s, atk: -53.921 ent: -5.174 str: 0.000 loss: -59.095]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.97it/s, atk: -57.183 ent: -5.173 str: 0.000 loss: -62.356]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -57.183 ent: -5.173 str: 0.000 loss: -62.356]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.97it/s, atk: -59.269 ent: -5.173 str: 0.000 loss: -64.443]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.92it/s, atk: -59.269 ent: -5.173 str: 0.000 loss: -64.443]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.92it/s, atk: -61.985 ent: -5.174 str: 0.000 loss: -67.158]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -61.985 ent: -5.174 str: 0.000 loss: -67.158]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.98it/s, atk: -64.109 ent: -5.174 str: 0.000 loss: -69.284]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.99it/s, atk: -64.109 ent: -5.174 str: 0.000 loss: -69.284]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.99it/s, atk: -67.306 ent: -5.174 str: 0.000 loss: -72.480]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -67.306 ent: -5.174 str: 0.000 loss: -72.480]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.97it/s, atk: -70.555 ent: -5.173 str: 0.000 loss: -75.728]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.99it/s, atk: -70.555 ent: -5.173 str: 0.000 loss: -75.728]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.99it/s, atk: -73.209 ent: -5.172 str: 0.000 loss: -78.380]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -73.209 ent: -5.172 str: 0.000 loss: -78.380]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.97it/s, atk: -75.233 ent: -5.171 str: 0.000 loss: -80.404]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.96it/s, atk: -75.233 ent: -5.171 str: 0.000 loss: -80.404]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.96it/s, atk: -78.071 ent: -5.173 str: 0.000 loss: -83.243]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.96it/s, atk: -78.071 ent: -5.173 str: 0.000 loss: -83.243]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.96it/s, atk: -80.766 ent: -5.174 str: 0.000 loss: -85.940]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -80.766 ent: -5.174 str: 0.000 loss: -85.940]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.88it/s, atk: -80.766 ent: -5.174 str: 0.000 loss: -85.940]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([794], device='cuda:0') tensor(0.9821, device='cuda:0')
after_true: tensor([619], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [2743.6824]	L2: [20.514545]	Linf: [0.69411767]

Accuracy on benign examples: 100.0%
gt_label: 875 pred_label: 875 pred_clean_logit 0.9897520542144775
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.86it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 21.44it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 23.20it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.87it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 22.75it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.51it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.95it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.38s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.24s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.18s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.28s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3013
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.063 ent: -2.932 str: 0.000 loss: -2.995]Iterations:   3%|▎         | 1/30 [00:00<00:24,  1.20it/s, atk: -0.063 ent: -2.932 str: 0.000 loss: -2.995]Iterations:   3%|▎         | 1/30 [00:01<00:24,  1.20it/s, atk: -0.269 ent: -2.953 str: 0.000 loss: -3.222]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.54it/s, atk: -0.269 ent: -2.953 str: 0.000 loss: -3.222]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.54it/s, atk: -1.596 ent: -2.963 str: 0.000 loss: -4.560]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.71it/s, atk: -1.596 ent: -2.963 str: 0.000 loss: -4.560]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.71it/s, atk: -8.508 ent: -2.970 str: 0.000 loss: -11.478]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.83it/s, atk: -8.508 ent: -2.970 str: 0.000 loss: -11.478]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.83it/s, atk: -13.854 ent: -2.975 str: 0.000 loss: -16.829]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.89it/s, atk: -13.854 ent: -2.975 str: 0.000 loss: -16.829]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.89it/s, atk: -19.009 ent: -2.971 str: 0.000 loss: -21.979]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.94it/s, atk: -19.009 ent: -2.971 str: 0.000 loss: -21.979]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.94it/s, atk: -30.435 ent: -2.973 str: 0.000 loss: -33.408]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.95it/s, atk: -30.435 ent: -2.973 str: 0.000 loss: -33.408]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.95it/s, atk: -38.058 ent: -2.969 str: 0.000 loss: -41.028]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -38.058 ent: -2.969 str: 0.000 loss: -41.028]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.97it/s, atk: -48.518 ent: -2.973 str: 0.000 loss: -51.491]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.98it/s, atk: -48.518 ent: -2.973 str: 0.000 loss: -51.491]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.98it/s, atk: -57.728 ent: -2.971 str: 0.000 loss: -60.699]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -57.728 ent: -2.971 str: 0.000 loss: -60.699]Iterations:  33%|███▎      | 10/30 [00:05<00:09,  2.00it/s, atk: -66.466 ent: -2.969 str: 0.000 loss: -69.435]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.98it/s, atk: -66.466 ent: -2.969 str: 0.000 loss: -69.435]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.98it/s, atk: -75.293 ent: -2.966 str: 0.000 loss: -78.260]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -75.293 ent: -2.966 str: 0.000 loss: -78.260]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.99it/s, atk: -84.196 ent: -2.961 str: 0.000 loss: -87.157]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  2.01it/s, atk: -84.196 ent: -2.961 str: 0.000 loss: -87.157]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  2.01it/s, atk: -91.391 ent: -2.959 str: 0.000 loss: -94.351]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.00it/s, atk: -91.391 ent: -2.959 str: 0.000 loss: -94.351]Iterations:  47%|████▋     | 14/30 [00:07<00:07,  2.00it/s, atk: -97.184 ent: -2.956 str: 0.000 loss: -100.140]Iterations:  50%|█████     | 15/30 [00:07<00:07,  2.00it/s, atk: -97.184 ent: -2.956 str: 0.000 loss: -100.140]Iterations:  50%|█████     | 15/30 [00:08<00:07,  2.00it/s, atk: -101.901 ent: -2.955 str: 0.000 loss: -104.855]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -101.901 ent: -2.955 str: 0.000 loss: -104.855]Iterations:  53%|█████▎    | 16/30 [00:08<00:06,  2.01it/s, atk: -108.748 ent: -2.950 str: 0.000 loss: -111.698]Iterations:  57%|█████▋    | 17/30 [00:08<00:06,  2.01it/s, atk: -108.748 ent: -2.950 str: 0.000 loss: -111.698]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  2.01it/s, atk: -112.738 ent: -2.948 str: 0.000 loss: -115.686]Iterations:  60%|██████    | 18/30 [00:09<00:06,  2.00it/s, atk: -112.738 ent: -2.948 str: 0.000 loss: -115.686]Iterations:  60%|██████    | 18/30 [00:09<00:06,  2.00it/s, atk: -114.798 ent: -2.944 str: 0.000 loss: -117.742]Iterations:  63%|██████▎   | 19/30 [00:09<00:05,  2.01it/s, atk: -114.798 ent: -2.944 str: 0.000 loss: -117.742]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  2.01it/s, atk: -120.981 ent: -2.943 str: 0.000 loss: -123.924]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -120.981 ent: -2.943 str: 0.000 loss: -123.924]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.98it/s, atk: -129.492 ent: -2.943 str: 0.000 loss: -132.435]Iterations:  70%|███████   | 21/30 [00:10<00:04,  2.00it/s, atk: -129.492 ent: -2.943 str: 0.000 loss: -132.435]Iterations:  70%|███████   | 21/30 [00:11<00:04,  2.00it/s, atk: -137.612 ent: -2.940 str: 0.000 loss: -140.552]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -137.612 ent: -2.940 str: 0.000 loss: -140.552]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -146.871 ent: -2.939 str: 0.000 loss: -149.810]Iterations:  77%|███████▋  | 23/30 [00:11<00:03,  1.99it/s, atk: -146.871 ent: -2.939 str: 0.000 loss: -149.810]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.99it/s, atk: -153.074 ent: -2.939 str: 0.000 loss: -156.013]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.01it/s, atk: -153.074 ent: -2.939 str: 0.000 loss: -156.013]Iterations:  80%|████████  | 24/30 [00:12<00:02,  2.01it/s, atk: -159.556 ent: -2.938 str: 0.000 loss: -162.494]Iterations:  83%|████████▎ | 25/30 [00:12<00:02,  1.96it/s, atk: -159.556 ent: -2.938 str: 0.000 loss: -162.494]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.96it/s, atk: -166.064 ent: -2.937 str: 0.000 loss: -169.001]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.98it/s, atk: -166.064 ent: -2.937 str: 0.000 loss: -169.001]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.98it/s, atk: -173.901 ent: -2.936 str: 0.000 loss: -176.837]Iterations:  90%|█████████ | 27/30 [00:13<00:01,  2.00it/s, atk: -173.901 ent: -2.936 str: 0.000 loss: -176.837]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  2.00it/s, atk: -182.123 ent: -2.936 str: 0.000 loss: -185.059]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  2.00it/s, atk: -182.123 ent: -2.936 str: 0.000 loss: -185.059]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  2.00it/s, atk: -189.590 ent: -2.938 str: 0.000 loss: -192.528]Iterations:  97%|█████████▋| 29/30 [00:14<00:00,  1.97it/s, atk: -189.590 ent: -2.938 str: 0.000 loss: -192.528]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.97it/s, atk: -197.324 ent: -2.940 str: 0.000 loss: -200.264]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.98it/s, atk: -197.324 ent: -2.940 str: 0.000 loss: -200.264]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.95it/s, atk: -197.324 ent: -2.940 str: 0.000 loss: -200.264]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([843], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([875], device='cuda:0') tensor(1.4971e-09, device='cuda:0')
L1: [2977.6746]	L2: [24.5825]	Linf: [0.95686275]

Accuracy on benign examples: 0.0%
gt_label: 609 pred_label: 436 pred_clean_logit 0.04516482725739479
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.55it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.77it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 23.29it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 24.85it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 25.12it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 25.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.82it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.72it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.22s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.06s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.08s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.29s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.22s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2872
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -40.044 ent: -2.944 str: 0.000 loss: -42.988]Iterations:   3%|▎         | 1/30 [00:00<00:23,  1.22it/s, atk: -40.044 ent: -2.944 str: 0.000 loss: -42.988]Iterations:   3%|▎         | 1/30 [00:01<00:23,  1.22it/s, atk: -52.493 ent: -2.933 str: 0.000 loss: -55.426]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.59it/s, atk: -52.493 ent: -2.933 str: 0.000 loss: -55.426]Iterations:   7%|▋         | 2/30 [00:01<00:17,  1.59it/s, atk: -60.915 ent: -2.936 str: 0.000 loss: -63.851]Iterations:  10%|█         | 3/30 [00:01<00:15,  1.74it/s, atk: -60.915 ent: -2.936 str: 0.000 loss: -63.851]Iterations:  10%|█         | 3/30 [00:02<00:15,  1.74it/s, atk: -66.428 ent: -2.925 str: 0.000 loss: -69.353]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -66.428 ent: -2.925 str: 0.000 loss: -69.353]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.79it/s, atk: -73.590 ent: -2.924 str: 0.000 loss: -76.515]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.87it/s, atk: -73.590 ent: -2.924 str: 0.000 loss: -76.515]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.87it/s, atk: -78.800 ent: -2.920 str: 0.000 loss: -81.720]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -78.800 ent: -2.920 str: 0.000 loss: -81.720]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -85.359 ent: -2.917 str: 0.000 loss: -88.277]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.91it/s, atk: -85.359 ent: -2.917 str: 0.000 loss: -88.277]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.91it/s, atk: -91.929 ent: -2.915 str: 0.000 loss: -94.844]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -91.929 ent: -2.915 str: 0.000 loss: -94.844]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.93it/s, atk: -98.192 ent: -2.915 str: 0.000 loss: -101.107]Iterations:  30%|███       | 9/30 [00:04<00:11,  1.90it/s, atk: -98.192 ent: -2.915 str: 0.000 loss: -101.107]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.90it/s, atk: -102.334 ent: -2.917 str: 0.000 loss: -105.251]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -102.334 ent: -2.917 str: 0.000 loss: -105.251]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.93it/s, atk: -106.947 ent: -2.915 str: 0.000 loss: -109.861]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  1.96it/s, atk: -106.947 ent: -2.915 str: 0.000 loss: -109.861]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  1.96it/s, atk: -111.140 ent: -2.914 str: 0.000 loss: -114.054]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.98it/s, atk: -111.140 ent: -2.914 str: 0.000 loss: -114.054]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.98it/s, atk: -114.024 ent: -2.915 str: 0.000 loss: -116.939]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.83it/s, atk: -114.024 ent: -2.915 str: 0.000 loss: -116.939]Iterations:  43%|████▎     | 13/30 [00:07<00:09,  1.83it/s, atk: -117.100 ent: -2.916 str: 0.000 loss: -120.016]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.89it/s, atk: -117.100 ent: -2.916 str: 0.000 loss: -120.016]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.89it/s, atk: -120.335 ent: -2.917 str: 0.000 loss: -123.252]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -120.335 ent: -2.917 str: 0.000 loss: -123.252]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -123.941 ent: -2.915 str: 0.000 loss: -126.857]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.86it/s, atk: -123.941 ent: -2.915 str: 0.000 loss: -126.857]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.86it/s, atk: -127.534 ent: -2.913 str: 0.000 loss: -130.447]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.92it/s, atk: -127.534 ent: -2.913 str: 0.000 loss: -130.447]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.92it/s, atk: -130.309 ent: -2.911 str: 0.000 loss: -133.220]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.92it/s, atk: -130.309 ent: -2.911 str: 0.000 loss: -133.220]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.92it/s, atk: -133.786 ent: -2.910 str: 0.000 loss: -136.697]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -133.786 ent: -2.910 str: 0.000 loss: -136.697]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -136.305 ent: -2.912 str: 0.000 loss: -139.217]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -136.305 ent: -2.912 str: 0.000 loss: -139.217]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.96it/s, atk: -139.237 ent: -2.912 str: 0.000 loss: -142.150]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -139.237 ent: -2.912 str: 0.000 loss: -142.150]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.99it/s, atk: -142.327 ent: -2.914 str: 0.000 loss: -145.241]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.99it/s, atk: -142.327 ent: -2.914 str: 0.000 loss: -145.241]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.99it/s, atk: -144.739 ent: -2.914 str: 0.000 loss: -147.654]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.95it/s, atk: -144.739 ent: -2.914 str: 0.000 loss: -147.654]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.95it/s, atk: -146.838 ent: -2.915 str: 0.000 loss: -149.753]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.94it/s, atk: -146.838 ent: -2.915 str: 0.000 loss: -149.753]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.94it/s, atk: -149.706 ent: -2.916 str: 0.000 loss: -152.622]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.95it/s, atk: -149.706 ent: -2.916 str: 0.000 loss: -152.622]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.95it/s, atk: -152.602 ent: -2.916 str: 0.000 loss: -155.518]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.84it/s, atk: -152.602 ent: -2.916 str: 0.000 loss: -155.518]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.84it/s, atk: -155.657 ent: -2.916 str: 0.000 loss: -158.573]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.87it/s, atk: -155.657 ent: -2.916 str: 0.000 loss: -158.573]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.87it/s, atk: -158.490 ent: -2.917 str: 0.000 loss: -161.408]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.90it/s, atk: -158.490 ent: -2.917 str: 0.000 loss: -161.408]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.90it/s, atk: -161.208 ent: -2.919 str: 0.000 loss: -164.127]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.93it/s, atk: -161.208 ent: -2.919 str: 0.000 loss: -164.127]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.93it/s, atk: -163.388 ent: -2.919 str: 0.000 loss: -166.307]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.96it/s, atk: -163.388 ent: -2.919 str: 0.000 loss: -166.307]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -163.388 ent: -2.919 str: 0.000 loss: -166.307]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([511], device='cuda:0') tensor(0.8663, device='cuda:0')
after_true: tensor([609], device='cuda:0') tensor(6.4941e-08, device='cuda:0')
L1: [3221.5332]	L2: [21.514372]	Linf: [0.7058824]

Accuracy on benign examples: 100.0%
gt_label: 421 pred_label: 421 pred_clean_logit 0.7963955402374268
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 24.78it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 25.94it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.25it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.43it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.40it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.16it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 26.19it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.25s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.10s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.11s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.27s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.21s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3978
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -4.738 ent: -4.981 str: 0.000 loss: -9.719]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.09it/s, atk: -4.738 ent: -4.981 str: 0.000 loss: -9.719]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.09it/s, atk: -12.737 ent: -4.984 str: 0.000 loss: -17.721]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.41it/s, atk: -12.737 ent: -4.984 str: 0.000 loss: -17.721]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.41it/s, atk: -23.211 ent: -4.985 str: 0.000 loss: -28.196]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.62it/s, atk: -23.211 ent: -4.985 str: 0.000 loss: -28.196]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.62it/s, atk: -32.237 ent: -4.983 str: 0.000 loss: -37.220]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.76it/s, atk: -32.237 ent: -4.983 str: 0.000 loss: -37.220]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.76it/s, atk: -41.028 ent: -4.984 str: 0.000 loss: -46.012]Iterations:  17%|█▋        | 5/30 [00:02<00:13,  1.84it/s, atk: -41.028 ent: -4.984 str: 0.000 loss: -46.012]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.84it/s, atk: -50.684 ent: -4.988 str: 0.000 loss: -55.672]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -50.684 ent: -4.988 str: 0.000 loss: -55.672]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.90it/s, atk: -56.842 ent: -4.990 str: 0.000 loss: -61.832]Iterations:  23%|██▎       | 7/30 [00:03<00:12,  1.90it/s, atk: -56.842 ent: -4.990 str: 0.000 loss: -61.832]Iterations:  23%|██▎       | 7/30 [00:04<00:12,  1.90it/s, atk: -66.283 ent: -4.990 str: 0.000 loss: -71.273]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -66.283 ent: -4.990 str: 0.000 loss: -71.273]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.94it/s, atk: -73.801 ent: -4.989 str: 0.000 loss: -78.790]Iterations:  30%|███       | 9/30 [00:04<00:10,  1.96it/s, atk: -73.801 ent: -4.989 str: 0.000 loss: -78.790]Iterations:  30%|███       | 9/30 [00:05<00:10,  1.96it/s, atk: -81.896 ent: -4.990 str: 0.000 loss: -86.886]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.98it/s, atk: -81.896 ent: -4.990 str: 0.000 loss: -86.886]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.98it/s, atk: -89.432 ent: -4.990 str: 0.000 loss: -94.421]Iterations:  37%|███▋      | 11/30 [00:05<00:09,  2.00it/s, atk: -89.432 ent: -4.990 str: 0.000 loss: -94.421]Iterations:  37%|███▋      | 11/30 [00:06<00:09,  2.00it/s, atk: -95.896 ent: -4.989 str: 0.000 loss: -100.884]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.97it/s, atk: -95.896 ent: -4.989 str: 0.000 loss: -100.884]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.97it/s, atk: -102.857 ent: -4.987 str: 0.000 loss: -107.844]Iterations:  43%|████▎     | 13/30 [00:06<00:08,  1.99it/s, atk: -102.857 ent: -4.987 str: 0.000 loss: -107.844]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.99it/s, atk: -110.569 ent: -4.987 str: 0.000 loss: -115.555]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -110.569 ent: -4.987 str: 0.000 loss: -115.555]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.95it/s, atk: -117.433 ent: -4.986 str: 0.000 loss: -122.419]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -117.433 ent: -4.986 str: 0.000 loss: -122.419]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.97it/s, atk: -127.451 ent: -4.985 str: 0.000 loss: -132.436]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.96it/s, atk: -127.451 ent: -4.985 str: 0.000 loss: -132.436]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.96it/s, atk: -135.274 ent: -4.984 str: 0.000 loss: -140.258]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -135.274 ent: -4.984 str: 0.000 loss: -140.258]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.95it/s, atk: -143.236 ent: -4.982 str: 0.000 loss: -148.218]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -143.236 ent: -4.982 str: 0.000 loss: -148.218]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.96it/s, atk: -150.633 ent: -4.980 str: 0.000 loss: -155.614]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -150.633 ent: -4.980 str: 0.000 loss: -155.614]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.97it/s, atk: -156.779 ent: -4.978 str: 0.000 loss: -161.758]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.92it/s, atk: -156.779 ent: -4.978 str: 0.000 loss: -161.758]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.92it/s, atk: -163.493 ent: -4.977 str: 0.000 loss: -168.470]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.95it/s, atk: -163.493 ent: -4.977 str: 0.000 loss: -168.470]Iterations:  70%|███████   | 21/30 [00:11<00:04,  1.95it/s, atk: -168.126 ent: -4.975 str: 0.000 loss: -173.101]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -168.126 ent: -4.975 str: 0.000 loss: -173.101]Iterations:  73%|███████▎  | 22/30 [00:11<00:04,  1.97it/s, atk: -173.205 ent: -4.975 str: 0.000 loss: -178.180]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.92it/s, atk: -173.205 ent: -4.975 str: 0.000 loss: -178.180]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.92it/s, atk: -180.452 ent: -4.975 str: 0.000 loss: -185.427]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.94it/s, atk: -180.452 ent: -4.975 str: 0.000 loss: -185.427]Iterations:  80%|████████  | 24/30 [00:12<00:03,  1.94it/s, atk: -184.887 ent: -4.975 str: 0.000 loss: -189.862]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.92it/s, atk: -184.887 ent: -4.975 str: 0.000 loss: -189.862]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.92it/s, atk: -190.316 ent: -4.976 str: 0.000 loss: -195.291]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.94it/s, atk: -190.316 ent: -4.976 str: 0.000 loss: -195.291]Iterations:  87%|████████▋ | 26/30 [00:13<00:02,  1.94it/s, atk: -195.229 ent: -4.976 str: 0.000 loss: -200.205]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -195.229 ent: -4.976 str: 0.000 loss: -200.205]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.95it/s, atk: -200.350 ent: -4.977 str: 0.000 loss: -205.327]Iterations:  93%|█████████▎| 28/30 [00:14<00:01,  1.92it/s, atk: -200.350 ent: -4.977 str: 0.000 loss: -205.327]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.92it/s, atk: -205.160 ent: -4.977 str: 0.000 loss: -210.137]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.96it/s, atk: -205.160 ent: -4.977 str: 0.000 loss: -210.137]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.96it/s, atk: -210.097 ent: -4.978 str: 0.000 loss: -215.075]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.93it/s, atk: -210.097 ent: -4.978 str: 0.000 loss: -215.075]Iterations: 100%|██████████| 30/30 [00:15<00:00,  1.90it/s, atk: -210.097 ent: -4.978 str: 0.000 loss: -215.075]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([581], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([421], device='cuda:0') tensor(4.7076e-10, device='cuda:0')
L1: [3179.514]	L2: [22.15605]	Linf: [0.81960785]

Accuracy on benign examples: 100.0%
gt_label: 513 pred_label: 513 pred_clean_logit 0.982560932636261
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 25.88it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 26.55it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 26.04it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 26.34it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 23.96it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.28it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.97it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:00<00:03,  1.18it/s]Optimize_uncond_embed:  40%|████      | 2/5 [00:01<00:02,  1.13it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:02<00:01,  1.03it/s]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.10s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.13s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3231
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.464 ent: -5.092 str: 0.000 loss: -5.557]Iterations:   3%|▎         | 1/30 [00:00<00:28,  1.01it/s, atk: -0.464 ent: -5.092 str: 0.000 loss: -5.557]Iterations:   3%|▎         | 1/30 [00:01<00:28,  1.01it/s, atk: -1.135 ent: -5.078 str: 0.000 loss: -6.213]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.45it/s, atk: -1.135 ent: -5.078 str: 0.000 loss: -6.213]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.45it/s, atk: -2.454 ent: -5.065 str: 0.000 loss: -7.518]Iterations:  10%|█         | 3/30 [00:01<00:16,  1.66it/s, atk: -2.454 ent: -5.065 str: 0.000 loss: -7.518]Iterations:  10%|█         | 3/30 [00:02<00:16,  1.66it/s, atk: -7.053 ent: -5.050 str: 0.000 loss: -12.103]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -7.053 ent: -5.050 str: 0.000 loss: -12.103]Iterations:  13%|█▎        | 4/30 [00:02<00:14,  1.78it/s, atk: -16.765 ent: -5.041 str: 0.000 loss: -21.806]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.73it/s, atk: -16.765 ent: -5.041 str: 0.000 loss: -21.806]Iterations:  17%|█▋        | 5/30 [00:03<00:14,  1.73it/s, atk: -28.955 ent: -5.036 str: 0.000 loss: -33.991]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.37it/s, atk: -28.955 ent: -5.036 str: 0.000 loss: -33.991]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.37it/s, atk: -38.919 ent: -5.032 str: 0.000 loss: -43.951]Iterations:  23%|██▎       | 7/30 [00:05<00:19,  1.20it/s, atk: -38.919 ent: -5.032 str: 0.000 loss: -43.951]Iterations:  23%|██▎       | 7/30 [00:05<00:19,  1.20it/s, atk: -49.609 ent: -5.029 str: 0.000 loss: -54.638]Iterations:  27%|██▋       | 8/30 [00:06<00:20,  1.09it/s, atk: -49.609 ent: -5.029 str: 0.000 loss: -54.638]Iterations:  27%|██▋       | 8/30 [00:06<00:20,  1.09it/s, atk: -61.428 ent: -5.029 str: 0.000 loss: -66.458]Iterations:  30%|███       | 9/30 [00:07<00:20,  1.04it/s, atk: -61.428 ent: -5.029 str: 0.000 loss: -66.458]Iterations:  30%|███       | 9/30 [00:07<00:20,  1.04it/s, atk: -73.421 ent: -5.031 str: 0.000 loss: -78.452]Iterations:  33%|███▎      | 10/30 [00:08<00:20,  1.01s/it, atk: -73.421 ent: -5.031 str: 0.000 loss: -78.452]Iterations:  33%|███▎      | 10/30 [00:09<00:20,  1.01s/it, atk: -83.603 ent: -5.028 str: 0.000 loss: -88.631]Iterations:  37%|███▋      | 11/30 [00:09<00:19,  1.03s/it, atk: -83.603 ent: -5.028 str: 0.000 loss: -88.631]Iterations:  37%|███▋      | 11/30 [00:10<00:19,  1.03s/it, atk: -93.163 ent: -5.026 str: 0.000 loss: -98.189]Iterations:  40%|████      | 12/30 [00:10<00:18,  1.04s/it, atk: -93.163 ent: -5.026 str: 0.000 loss: -98.189]Iterations:  40%|████      | 12/30 [00:11<00:18,  1.04s/it, atk: -101.305 ent: -5.026 str: 0.000 loss: -106.331]Iterations:  43%|████▎     | 13/30 [00:11<00:17,  1.05s/it, atk: -101.305 ent: -5.026 str: 0.000 loss: -106.331]Iterations:  43%|████▎     | 13/30 [00:12<00:17,  1.05s/it, atk: -110.697 ent: -5.024 str: 0.000 loss: -115.721]Iterations:  47%|████▋     | 14/30 [00:12<00:16,  1.06s/it, atk: -110.697 ent: -5.024 str: 0.000 loss: -115.721]Iterations:  47%|████▋     | 14/30 [00:13<00:16,  1.06s/it, atk: -118.759 ent: -5.023 str: 0.000 loss: -123.782]Iterations:  50%|█████     | 15/30 [00:13<00:15,  1.06s/it, atk: -118.759 ent: -5.023 str: 0.000 loss: -123.782]Iterations:  50%|█████     | 15/30 [00:14<00:15,  1.06s/it, atk: -126.532 ent: -5.021 str: 0.000 loss: -131.553]Iterations:  53%|█████▎    | 16/30 [00:14<00:14,  1.06s/it, atk: -126.532 ent: -5.021 str: 0.000 loss: -131.553]Iterations:  53%|█████▎    | 16/30 [00:15<00:14,  1.06s/it, atk: -134.638 ent: -5.020 str: 0.000 loss: -139.658]Iterations:  57%|█████▋    | 17/30 [00:15<00:13,  1.07s/it, atk: -134.638 ent: -5.020 str: 0.000 loss: -139.658]Iterations:  57%|█████▋    | 17/30 [00:16<00:13,  1.07s/it, atk: -141.748 ent: -5.018 str: 0.000 loss: -146.767]Iterations:  60%|██████    | 18/30 [00:16<00:12,  1.07s/it, atk: -141.748 ent: -5.018 str: 0.000 loss: -146.767]Iterations:  60%|██████    | 18/30 [00:17<00:12,  1.07s/it, atk: -148.488 ent: -5.017 str: 0.000 loss: -153.504]Iterations:  63%|██████▎   | 19/30 [00:18<00:11,  1.07s/it, atk: -148.488 ent: -5.017 str: 0.000 loss: -153.504]Iterations:  63%|██████▎   | 19/30 [00:18<00:11,  1.07s/it, atk: -156.971 ent: -5.015 str: 0.000 loss: -161.986]Iterations:  67%|██████▋   | 20/30 [00:19<00:10,  1.07s/it, atk: -156.971 ent: -5.015 str: 0.000 loss: -161.986]Iterations:  67%|██████▋   | 20/30 [00:19<00:10,  1.07s/it, atk: -164.384 ent: -5.013 str: 0.000 loss: -169.397]Iterations:  70%|███████   | 21/30 [00:20<00:09,  1.07s/it, atk: -164.384 ent: -5.013 str: 0.000 loss: -169.397]Iterations:  70%|███████   | 21/30 [00:20<00:09,  1.07s/it, atk: -171.372 ent: -5.012 str: 0.000 loss: -176.383]Iterations:  73%|███████▎  | 22/30 [00:21<00:08,  1.07s/it, atk: -171.372 ent: -5.012 str: 0.000 loss: -176.383]Iterations:  73%|███████▎  | 22/30 [00:21<00:08,  1.07s/it, atk: -177.661 ent: -5.011 str: 0.000 loss: -182.672]Iterations:  77%|███████▋  | 23/30 [00:22<00:07,  1.07s/it, atk: -177.661 ent: -5.011 str: 0.000 loss: -182.672]Iterations:  77%|███████▋  | 23/30 [00:22<00:07,  1.07s/it, atk: -182.922 ent: -5.012 str: 0.000 loss: -187.934]Iterations:  80%|████████  | 24/30 [00:23<00:06,  1.08s/it, atk: -182.922 ent: -5.012 str: 0.000 loss: -187.934]Iterations:  80%|████████  | 24/30 [00:24<00:06,  1.08s/it, atk: -188.472 ent: -5.012 str: 0.000 loss: -193.485]Iterations:  83%|████████▎ | 25/30 [00:24<00:05,  1.08s/it, atk: -188.472 ent: -5.012 str: 0.000 loss: -193.485]Iterations:  83%|████████▎ | 25/30 [00:25<00:05,  1.08s/it, atk: -195.032 ent: -5.013 str: 0.000 loss: -200.045]Iterations:  87%|████████▋ | 26/30 [00:25<00:04,  1.08s/it, atk: -195.032 ent: -5.013 str: 0.000 loss: -200.045]Iterations:  87%|████████▋ | 26/30 [00:26<00:04,  1.08s/it, atk: -201.687 ent: -5.012 str: 0.000 loss: -206.699]Iterations:  90%|█████████ | 27/30 [00:26<00:03,  1.07s/it, atk: -201.687 ent: -5.012 str: 0.000 loss: -206.699]Iterations:  90%|█████████ | 27/30 [00:27<00:03,  1.07s/it, atk: -207.095 ent: -5.010 str: 0.000 loss: -212.105]Iterations:  93%|█████████▎| 28/30 [00:27<00:02,  1.08s/it, atk: -207.095 ent: -5.010 str: 0.000 loss: -212.105]Iterations:  93%|█████████▎| 28/30 [00:28<00:02,  1.08s/it, atk: -212.676 ent: -5.008 str: 0.000 loss: -217.685]Iterations:  97%|█████████▋| 29/30 [00:28<00:01,  1.07s/it, atk: -212.676 ent: -5.008 str: 0.000 loss: -217.685]Iterations:  97%|█████████▋| 29/30 [00:29<00:01,  1.07s/it, atk: -218.271 ent: -5.008 str: 0.000 loss: -223.279]Iterations: 100%|██████████| 30/30 [00:29<00:00,  1.07s/it, atk: -218.271 ent: -5.008 str: 0.000 loss: -223.279]Iterations: 100%|██████████| 30/30 [00:29<00:00,  1.00it/s, atk: -218.271 ent: -5.008 str: 0.000 loss: -223.279]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([558], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([513], device='cuda:0') tensor(1.9130e-10, device='cuda:0')
L1: [3152.6628]	L2: [22.499338]	Linf: [0.85490197]

Accuracy on benign examples: 100.0%
gt_label: 775 pred_label: 775 pred_clean_logit 0.8998931050300598
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.97it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.04it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.62it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.48it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.40it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.26it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.33it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.26it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.26it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.42it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.82s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:04,  2.03s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.24s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.26s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4604
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.125 ent: -4.957 str: 0.000 loss: -7.082]Iterations:   3%|▎         | 1/30 [00:01<00:54,  1.89s/it, atk: -2.125 ent: -4.957 str: 0.000 loss: -7.082]Iterations:   3%|▎         | 1/30 [00:02<00:54,  1.89s/it, atk: -5.285 ent: -4.976 str: 0.000 loss: -10.261]Iterations:   7%|▋         | 2/30 [00:02<00:39,  1.40s/it, atk: -5.285 ent: -4.976 str: 0.000 loss: -10.261]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -6.343 ent: -4.976 str: 0.000 loss: -11.319]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.25s/it, atk: -6.343 ent: -4.976 str: 0.000 loss: -11.319]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.25s/it, atk: -18.659 ent: -4.977 str: 0.000 loss: -23.637]Iterations:  13%|█▎        | 4/30 [00:05<00:30,  1.18s/it, atk: -18.659 ent: -4.977 str: 0.000 loss: -23.637]Iterations:  13%|█▎        | 4/30 [00:05<00:30,  1.18s/it, atk: -18.641 ent: -4.960 str: 0.000 loss: -23.601]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.14s/it, atk: -18.641 ent: -4.960 str: 0.000 loss: -23.601]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.14s/it, atk: -30.613 ent: -4.958 str: 0.000 loss: -35.571]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.12s/it, atk: -30.613 ent: -4.958 str: 0.000 loss: -35.571]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.12s/it, atk: -34.276 ent: -4.969 str: 0.000 loss: -39.246]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -34.276 ent: -4.969 str: 0.000 loss: -39.246]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -51.216 ent: -4.986 str: 0.000 loss: -56.202]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.09s/it, atk: -51.216 ent: -4.986 str: 0.000 loss: -56.202]Iterations:  27%|██▋       | 8/30 [00:09<00:23,  1.09s/it, atk: -62.839 ent: -4.984 str: 0.000 loss: -67.823]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.05s/it, atk: -62.839 ent: -4.984 str: 0.000 loss: -67.823]Iterations:  30%|███       | 9/30 [00:10<00:22,  1.05s/it, atk: -66.729 ent: -4.993 str: 0.000 loss: -71.722]Iterations:  33%|███▎      | 10/30 [00:10<00:17,  1.14it/s, atk: -66.729 ent: -4.993 str: 0.000 loss: -71.722]Iterations:  33%|███▎      | 10/30 [00:11<00:17,  1.14it/s, atk: -78.490 ent: -4.999 str: 0.000 loss: -83.489]Iterations:  37%|███▋      | 11/30 [00:11<00:14,  1.31it/s, atk: -78.490 ent: -4.999 str: 0.000 loss: -83.489]Iterations:  37%|███▋      | 11/30 [00:11<00:14,  1.31it/s, atk: -89.663 ent: -5.006 str: 0.000 loss: -94.669]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.47it/s, atk: -89.663 ent: -5.006 str: 0.000 loss: -94.669]Iterations:  40%|████      | 12/30 [00:12<00:12,  1.47it/s, atk: -102.597 ent: -5.009 str: 0.000 loss: -107.606]Iterations:  43%|████▎     | 13/30 [00:12<00:10,  1.61it/s, atk: -102.597 ent: -5.009 str: 0.000 loss: -107.606]Iterations:  43%|████▎     | 13/30 [00:12<00:10,  1.61it/s, atk: -111.483 ent: -5.008 str: 0.000 loss: -116.491]Iterations:  47%|████▋     | 14/30 [00:12<00:09,  1.69it/s, atk: -111.483 ent: -5.008 str: 0.000 loss: -116.491]Iterations:  47%|████▋     | 14/30 [00:13<00:09,  1.69it/s, atk: -117.175 ent: -5.004 str: 0.000 loss: -122.179]Iterations:  50%|█████     | 15/30 [00:13<00:08,  1.78it/s, atk: -117.175 ent: -5.004 str: 0.000 loss: -122.179]Iterations:  50%|█████     | 15/30 [00:13<00:08,  1.78it/s, atk: -124.947 ent: -5.002 str: 0.000 loss: -129.949]Iterations:  53%|█████▎    | 16/30 [00:13<00:07,  1.84it/s, atk: -124.947 ent: -5.002 str: 0.000 loss: -129.949]Iterations:  53%|█████▎    | 16/30 [00:14<00:07,  1.84it/s, atk: -134.356 ent: -5.000 str: 0.000 loss: -139.356]Iterations:  57%|█████▋    | 17/30 [00:14<00:06,  1.87it/s, atk: -134.356 ent: -5.000 str: 0.000 loss: -139.356]Iterations:  57%|█████▋    | 17/30 [00:14<00:06,  1.87it/s, atk: -144.336 ent: -5.001 str: 0.000 loss: -149.337]Iterations:  60%|██████    | 18/30 [00:14<00:06,  1.92it/s, atk: -144.336 ent: -5.001 str: 0.000 loss: -149.337]Iterations:  60%|██████    | 18/30 [00:15<00:06,  1.92it/s, atk: -151.812 ent: -5.000 str: 0.000 loss: -156.811]Iterations:  63%|██████▎   | 19/30 [00:15<00:05,  1.96it/s, atk: -151.812 ent: -5.000 str: 0.000 loss: -156.811]Iterations:  63%|██████▎   | 19/30 [00:15<00:05,  1.96it/s, atk: -158.772 ent: -4.999 str: 0.000 loss: -163.772]Iterations:  67%|██████▋   | 20/30 [00:15<00:05,  1.99it/s, atk: -158.772 ent: -4.999 str: 0.000 loss: -163.772]Iterations:  67%|██████▋   | 20/30 [00:16<00:05,  1.99it/s, atk: -168.581 ent: -4.998 str: 0.000 loss: -173.579]Iterations:  70%|███████   | 21/30 [00:16<00:04,  1.97it/s, atk: -168.581 ent: -4.998 str: 0.000 loss: -173.579]Iterations:  70%|███████   | 21/30 [00:16<00:04,  1.97it/s, atk: -177.395 ent: -4.996 str: 0.000 loss: -182.391]Iterations:  73%|███████▎  | 22/30 [00:16<00:04,  1.99it/s, atk: -177.395 ent: -4.996 str: 0.000 loss: -182.391]Iterations:  73%|███████▎  | 22/30 [00:17<00:04,  1.99it/s, atk: -183.526 ent: -4.994 str: 0.000 loss: -188.521]Iterations:  77%|███████▋  | 23/30 [00:17<00:03,  2.00it/s, atk: -183.526 ent: -4.994 str: 0.000 loss: -188.521]Iterations:  77%|███████▋  | 23/30 [00:17<00:03,  2.00it/s, atk: -195.486 ent: -4.992 str: 0.000 loss: -200.478]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.95it/s, atk: -195.486 ent: -4.992 str: 0.000 loss: -200.478]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.95it/s, atk: -205.981 ent: -4.991 str: 0.000 loss: -210.972]Iterations:  83%|████████▎ | 25/30 [00:18<00:02,  1.98it/s, atk: -205.981 ent: -4.991 str: 0.000 loss: -210.972]Iterations:  83%|████████▎ | 25/30 [00:18<00:02,  1.98it/s, atk: -213.598 ent: -4.990 str: 0.000 loss: -218.588]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  2.00it/s, atk: -213.598 ent: -4.990 str: 0.000 loss: -218.588]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  2.00it/s, atk: -222.983 ent: -4.991 str: 0.000 loss: -227.974]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  2.01it/s, atk: -222.983 ent: -4.991 str: 0.000 loss: -227.974]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  2.01it/s, atk: -230.756 ent: -4.990 str: 0.000 loss: -235.746]Iterations:  93%|█████████▎| 28/30 [00:19<00:00,  2.01it/s, atk: -230.756 ent: -4.990 str: 0.000 loss: -235.746]Iterations:  93%|█████████▎| 28/30 [00:20<00:00,  2.01it/s, atk: -237.311 ent: -4.987 str: 0.000 loss: -242.298]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  2.00it/s, atk: -237.311 ent: -4.987 str: 0.000 loss: -242.298]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  2.00it/s, atk: -248.447 ent: -4.986 str: 0.000 loss: -253.433]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.99it/s, atk: -248.447 ent: -4.986 str: 0.000 loss: -253.433]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.44it/s, atk: -248.447 ent: -4.986 str: 0.000 loss: -253.433]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([863], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([775], device='cuda:0') tensor(6.3948e-12, device='cuda:0')
L1: [4153.204]	L2: [26.423391]	Linf: [0.7019608]

Accuracy on benign examples: 100.0%
gt_label: 701 pred_label: 701 pred_clean_logit 0.9999641180038452
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 23.97it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.34it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 25.33it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 25.37it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 26.20it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 26.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 25.79it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.06s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:02,  1.00it/s]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.05s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.14s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.22s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:05<00:00,  1.15s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4215
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.002 ent: -2.566 str: 0.000 loss: -2.568]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.10it/s, atk: -0.002 ent: -2.566 str: 0.000 loss: -2.568]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.10it/s, atk: -0.002 ent: -2.584 str: 0.000 loss: -2.586]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.51it/s, atk: -0.002 ent: -2.584 str: 0.000 loss: -2.586]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.51it/s, atk: -0.002 ent: -2.603 str: 0.000 loss: -2.604]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.56it/s, atk: -0.002 ent: -2.603 str: 0.000 loss: -2.604]Iterations:  10%|█         | 3/30 [00:02<00:17,  1.56it/s, atk: -0.002 ent: -2.622 str: 0.000 loss: -2.624]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.67it/s, atk: -0.002 ent: -2.622 str: 0.000 loss: -2.624]Iterations:  13%|█▎        | 4/30 [00:02<00:15,  1.67it/s, atk: -0.001 ent: -2.641 str: 0.000 loss: -2.643]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.82it/s, atk: -0.001 ent: -2.641 str: 0.000 loss: -2.643]Iterations:  17%|█▋        | 5/30 [00:03<00:13,  1.82it/s, atk: -0.002 ent: -2.655 str: 0.000 loss: -2.657]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.89it/s, atk: -0.002 ent: -2.655 str: 0.000 loss: -2.657]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.89it/s, atk: -0.002 ent: -2.667 str: 0.000 loss: -2.669]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -0.002 ent: -2.667 str: 0.000 loss: -2.669]Iterations:  23%|██▎       | 7/30 [00:04<00:11,  1.93it/s, atk: -0.002 ent: -2.676 str: 0.000 loss: -2.678]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.82it/s, atk: -0.002 ent: -2.676 str: 0.000 loss: -2.678]Iterations:  27%|██▋       | 8/30 [00:04<00:12,  1.82it/s, atk: -0.003 ent: -2.687 str: 0.000 loss: -2.690]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.86it/s, atk: -0.003 ent: -2.687 str: 0.000 loss: -2.690]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.86it/s, atk: -0.004 ent: -2.697 str: 0.000 loss: -2.701]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.90it/s, atk: -0.004 ent: -2.697 str: 0.000 loss: -2.701]Iterations:  33%|███▎      | 10/30 [00:05<00:10,  1.90it/s, atk: -0.005 ent: -2.707 str: 0.000 loss: -2.712]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.89it/s, atk: -0.005 ent: -2.707 str: 0.000 loss: -2.712]Iterations:  37%|███▋      | 11/30 [00:06<00:10,  1.89it/s, atk: -0.007 ent: -2.717 str: 0.000 loss: -2.724]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.92it/s, atk: -0.007 ent: -2.717 str: 0.000 loss: -2.724]Iterations:  40%|████      | 12/30 [00:06<00:09,  1.92it/s, atk: -0.009 ent: -2.728 str: 0.000 loss: -2.738]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -0.009 ent: -2.728 str: 0.000 loss: -2.738]Iterations:  43%|████▎     | 13/30 [00:07<00:08,  1.92it/s, atk: -0.016 ent: -2.738 str: 0.000 loss: -2.754]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.93it/s, atk: -0.016 ent: -2.738 str: 0.000 loss: -2.754]Iterations:  47%|████▋     | 14/30 [00:07<00:08,  1.93it/s, atk: -0.033 ent: -2.748 str: 0.000 loss: -2.781]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -0.033 ent: -2.748 str: 0.000 loss: -2.781]Iterations:  50%|█████     | 15/30 [00:08<00:07,  1.93it/s, atk: -0.070 ent: -2.749 str: 0.000 loss: -2.819]Iterations:  53%|█████▎    | 16/30 [00:08<00:07,  1.93it/s, atk: -0.070 ent: -2.749 str: 0.000 loss: -2.819]Iterations:  53%|█████▎    | 16/30 [00:09<00:07,  1.93it/s, atk: -0.211 ent: -2.747 str: 0.000 loss: -2.957]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.89it/s, atk: -0.211 ent: -2.747 str: 0.000 loss: -2.957]Iterations:  57%|█████▋    | 17/30 [00:09<00:06,  1.89it/s, atk: -0.494 ent: -2.748 str: 0.000 loss: -3.242]Iterations:  60%|██████    | 18/30 [00:09<00:06,  1.94it/s, atk: -0.494 ent: -2.748 str: 0.000 loss: -3.242]Iterations:  60%|██████    | 18/30 [00:10<00:06,  1.94it/s, atk: -1.566 ent: -2.747 str: 0.000 loss: -4.314]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -1.566 ent: -2.747 str: 0.000 loss: -4.314]Iterations:  63%|██████▎   | 19/30 [00:10<00:05,  1.95it/s, atk: -6.273 ent: -2.741 str: 0.000 loss: -9.014]Iterations:  67%|██████▋   | 20/30 [00:10<00:05,  1.95it/s, atk: -6.273 ent: -2.741 str: 0.000 loss: -9.014]Iterations:  67%|██████▋   | 20/30 [00:11<00:05,  1.95it/s, atk: -14.869 ent: -2.739 str: 0.000 loss: -17.608]Iterations:  70%|███████   | 21/30 [00:11<00:05,  1.76it/s, atk: -14.869 ent: -2.739 str: 0.000 loss: -17.608]Iterations:  70%|███████   | 21/30 [00:11<00:05,  1.76it/s, atk: -23.677 ent: -2.733 str: 0.000 loss: -26.409]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.79it/s, atk: -23.677 ent: -2.733 str: 0.000 loss: -26.409]Iterations:  73%|███████▎  | 22/30 [00:12<00:04,  1.79it/s, atk: -36.478 ent: -2.731 str: 0.000 loss: -39.209]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.85it/s, atk: -36.478 ent: -2.731 str: 0.000 loss: -39.209]Iterations:  77%|███████▋  | 23/30 [00:12<00:03,  1.85it/s, atk: -49.072 ent: -2.728 str: 0.000 loss: -51.800]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.88it/s, atk: -49.072 ent: -2.728 str: 0.000 loss: -51.800]Iterations:  80%|████████  | 24/30 [00:13<00:03,  1.88it/s, atk: -61.237 ent: -2.724 str: 0.000 loss: -63.961]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -61.237 ent: -2.724 str: 0.000 loss: -63.961]Iterations:  83%|████████▎ | 25/30 [00:13<00:02,  1.91it/s, atk: -70.483 ent: -2.719 str: 0.000 loss: -73.202]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.95it/s, atk: -70.483 ent: -2.719 str: 0.000 loss: -73.202]Iterations:  87%|████████▋ | 26/30 [00:14<00:02,  1.95it/s, atk: -80.969 ent: -2.715 str: 0.000 loss: -83.685]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.87it/s, atk: -80.969 ent: -2.715 str: 0.000 loss: -83.685]Iterations:  90%|█████████ | 27/30 [00:14<00:01,  1.87it/s, atk: -87.835 ent: -2.713 str: 0.000 loss: -90.548]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.89it/s, atk: -87.835 ent: -2.713 str: 0.000 loss: -90.548]Iterations:  93%|█████████▎| 28/30 [00:15<00:01,  1.89it/s, atk: -96.162 ent: -2.712 str: 0.000 loss: -98.874]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.91it/s, atk: -96.162 ent: -2.712 str: 0.000 loss: -98.874]Iterations:  97%|█████████▋| 29/30 [00:15<00:00,  1.91it/s, atk: -103.242 ent: -2.709 str: 0.000 loss: -105.952]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.92it/s, atk: -103.242 ent: -2.709 str: 0.000 loss: -105.952]Iterations: 100%|██████████| 30/30 [00:16<00:00,  1.86it/s, atk: -103.242 ent: -2.709 str: 0.000 loss: -105.952]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([417], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([701], device='cuda:0') tensor(1.5778e-05, device='cuda:0')
L1: [1331.7058]	L2: [10.69845]	Linf: [0.73333335]

Accuracy on benign examples: 100.0%
gt_label: 922 pred_label: 922 pred_clean_logit 0.981884241104126
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.17it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.37it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 22.30it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 23.08it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.75it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.76it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.95it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.18s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.09s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.14s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:04<00:01,  1.23s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.30s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.24s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4464
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.177 ent: -2.598 str: 0.000 loss: -2.775]Iterations:   3%|▎         | 1/30 [00:00<00:17,  1.69it/s, atk: -0.177 ent: -2.598 str: 0.000 loss: -2.775]Iterations:   3%|▎         | 1/30 [00:00<00:17,  1.69it/s, atk: -0.280 ent: -2.604 str: 0.000 loss: -2.883]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.85it/s, atk: -0.280 ent: -2.604 str: 0.000 loss: -2.883]Iterations:   7%|▋         | 2/30 [00:01<00:15,  1.85it/s, atk: -0.521 ent: -2.606 str: 0.000 loss: -3.127]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.89it/s, atk: -0.521 ent: -2.606 str: 0.000 loss: -3.127]Iterations:  10%|█         | 3/30 [00:01<00:14,  1.89it/s, atk: -0.884 ent: -2.607 str: 0.000 loss: -3.492]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.88it/s, atk: -0.884 ent: -2.607 str: 0.000 loss: -3.492]Iterations:  13%|█▎        | 4/30 [00:02<00:13,  1.88it/s, atk: -1.326 ent: -2.607 str: 0.000 loss: -3.933]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -1.326 ent: -2.607 str: 0.000 loss: -3.933]Iterations:  17%|█▋        | 5/30 [00:02<00:12,  1.93it/s, atk: -1.892 ent: -2.609 str: 0.000 loss: -4.501]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.93it/s, atk: -1.892 ent: -2.609 str: 0.000 loss: -4.501]Iterations:  20%|██        | 6/30 [00:03<00:12,  1.93it/s, atk: -2.669 ent: -2.606 str: 0.000 loss: -5.275]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -2.669 ent: -2.606 str: 0.000 loss: -5.275]Iterations:  23%|██▎       | 7/30 [00:03<00:11,  1.93it/s, atk: -4.197 ent: -2.606 str: 0.000 loss: -6.802]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -4.197 ent: -2.606 str: 0.000 loss: -6.802]Iterations:  27%|██▋       | 8/30 [00:04<00:11,  1.95it/s, atk: -5.688 ent: -2.609 str: 0.000 loss: -8.297]Iterations:  30%|███       | 9/30 [00:04<00:11,  1.83it/s, atk: -5.688 ent: -2.609 str: 0.000 loss: -8.297]Iterations:  30%|███       | 9/30 [00:05<00:11,  1.83it/s, atk: -6.919 ent: -2.609 str: 0.000 loss: -9.527]Iterations:  33%|███▎      | 10/30 [00:05<00:11,  1.77it/s, atk: -6.919 ent: -2.609 str: 0.000 loss: -9.527]Iterations:  33%|███▎      | 10/30 [00:05<00:11,  1.77it/s, atk: -8.307 ent: -2.609 str: 0.000 loss: -10.916]Iterations:  37%|███▋      | 11/30 [00:06<00:11,  1.60it/s, atk: -8.307 ent: -2.609 str: 0.000 loss: -10.916]Iterations:  37%|███▋      | 11/30 [00:06<00:11,  1.60it/s, atk: -9.829 ent: -2.607 str: 0.000 loss: -12.436]Iterations:  40%|████      | 12/30 [00:07<00:13,  1.38it/s, atk: -9.829 ent: -2.607 str: 0.000 loss: -12.436]Iterations:  40%|████      | 12/30 [00:07<00:13,  1.38it/s, atk: -10.991 ent: -2.606 str: 0.000 loss: -13.597]Iterations:  43%|████▎     | 13/30 [00:08<00:13,  1.25it/s, atk: -10.991 ent: -2.606 str: 0.000 loss: -13.597]Iterations:  43%|████▎     | 13/30 [00:08<00:13,  1.25it/s, atk: -12.166 ent: -2.607 str: 0.000 loss: -14.772]Iterations:  47%|████▋     | 14/30 [00:08<00:11,  1.37it/s, atk: -12.166 ent: -2.607 str: 0.000 loss: -14.772]Iterations:  47%|████▋     | 14/30 [00:09<00:11,  1.37it/s, atk: -13.666 ent: -2.607 str: 0.000 loss: -16.273]Iterations:  50%|█████     | 15/30 [00:09<00:12,  1.20it/s, atk: -13.666 ent: -2.607 str: 0.000 loss: -16.273]Iterations:  50%|█████     | 15/30 [00:10<00:12,  1.20it/s, atk: -15.761 ent: -2.608 str: 0.000 loss: -18.369]Iterations:  53%|█████▎    | 16/30 [00:10<00:11,  1.27it/s, atk: -15.761 ent: -2.608 str: 0.000 loss: -18.369]Iterations:  53%|█████▎    | 16/30 [00:10<00:11,  1.27it/s, atk: -17.233 ent: -2.608 str: 0.000 loss: -19.840]Iterations:  57%|█████▋    | 17/30 [00:10<00:09,  1.43it/s, atk: -17.233 ent: -2.608 str: 0.000 loss: -19.840]Iterations:  57%|█████▋    | 17/30 [00:11<00:09,  1.43it/s, atk: -18.206 ent: -2.607 str: 0.000 loss: -20.813]Iterations:  60%|██████    | 18/30 [00:11<00:09,  1.33it/s, atk: -18.206 ent: -2.607 str: 0.000 loss: -20.813]Iterations:  60%|██████    | 18/30 [00:12<00:09,  1.33it/s, atk: -18.395 ent: -2.606 str: 0.000 loss: -21.000]Iterations:  63%|██████▎   | 19/30 [00:12<00:08,  1.31it/s, atk: -18.395 ent: -2.606 str: 0.000 loss: -21.000]Iterations:  63%|██████▎   | 19/30 [00:13<00:08,  1.31it/s, atk: -21.294 ent: -2.604 str: 0.000 loss: -23.898]Iterations:  67%|██████▋   | 20/30 [00:13<00:07,  1.34it/s, atk: -21.294 ent: -2.604 str: 0.000 loss: -23.898]Iterations:  67%|██████▋   | 20/30 [00:13<00:07,  1.34it/s, atk: -22.503 ent: -2.603 str: 0.000 loss: -25.106]Iterations:  70%|███████   | 21/30 [00:14<00:07,  1.27it/s, atk: -22.503 ent: -2.603 str: 0.000 loss: -25.106]Iterations:  70%|███████   | 21/30 [00:14<00:07,  1.27it/s, atk: -23.799 ent: -2.602 str: 0.000 loss: -26.401]Iterations:  73%|███████▎  | 22/30 [00:14<00:06,  1.27it/s, atk: -23.799 ent: -2.602 str: 0.000 loss: -26.401]Iterations:  73%|███████▎  | 22/30 [00:15<00:06,  1.27it/s, atk: -25.160 ent: -2.602 str: 0.000 loss: -27.762]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.40it/s, atk: -25.160 ent: -2.602 str: 0.000 loss: -27.762]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.40it/s, atk: -26.901 ent: -2.603 str: 0.000 loss: -29.504]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.28it/s, atk: -26.901 ent: -2.603 str: 0.000 loss: -29.504]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.28it/s, atk: -28.832 ent: -2.603 str: 0.000 loss: -31.435]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.28it/s, atk: -28.832 ent: -2.603 str: 0.000 loss: -31.435]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.28it/s, atk: -30.332 ent: -2.603 str: 0.000 loss: -32.935]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.34it/s, atk: -30.332 ent: -2.603 str: 0.000 loss: -32.935]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.34it/s, atk: -32.104 ent: -2.603 str: 0.000 loss: -34.707]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.23it/s, atk: -32.104 ent: -2.603 str: 0.000 loss: -34.707]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.23it/s, atk: -34.151 ent: -2.602 str: 0.000 loss: -36.753]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.35it/s, atk: -34.151 ent: -2.602 str: 0.000 loss: -36.753]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.35it/s, atk: -35.850 ent: -2.602 str: 0.000 loss: -38.451]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.24it/s, atk: -35.850 ent: -2.602 str: 0.000 loss: -38.451]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.24it/s, atk: -37.319 ent: -2.601 str: 0.000 loss: -39.919]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.29it/s, atk: -37.319 ent: -2.601 str: 0.000 loss: -39.919]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -37.319 ent: -2.601 str: 0.000 loss: -39.919]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([916], device='cuda:0') tensor(0.9041, device='cuda:0')
after_true: tensor([922], device='cuda:0') tensor(0.0216, device='cuda:0')
L1: [2393.1926]	L2: [16.718187]	Linf: [0.54509807]

Accuracy on benign examples: 100.0%
gt_label: 468 pred_label: 468 pred_clean_logit 0.21594293415546417
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.86it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.29it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 21.29it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 22.96it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 24.10it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 24.97it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.50it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.39s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.54s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.55s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3803
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -21.902 ent: -2.757 str: 0.000 loss: -24.659]Iterations:   3%|▎         | 1/30 [00:01<00:57,  1.97s/it, atk: -21.902 ent: -2.757 str: 0.000 loss: -24.659]Iterations:   3%|▎         | 1/30 [00:02<00:57,  1.97s/it, atk: -41.305 ent: -2.749 str: 0.000 loss: -44.054]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.31s/it, atk: -41.305 ent: -2.749 str: 0.000 loss: -44.054]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.31s/it, atk: -48.618 ent: -2.754 str: 0.000 loss: -51.372]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.15s/it, atk: -48.618 ent: -2.754 str: 0.000 loss: -51.372]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.15s/it, atk: -54.463 ent: -2.754 str: 0.000 loss: -57.217]Iterations:  13%|█▎        | 4/30 [00:04<00:28,  1.08s/it, atk: -54.463 ent: -2.754 str: 0.000 loss: -57.217]Iterations:  13%|█▎        | 4/30 [00:05<00:28,  1.08s/it, atk: -59.409 ent: -2.749 str: 0.000 loss: -62.158]Iterations:  17%|█▋        | 5/30 [00:05<00:25,  1.00s/it, atk: -59.409 ent: -2.749 str: 0.000 loss: -62.158]Iterations:  17%|█▋        | 5/30 [00:06<00:25,  1.00s/it, atk: -63.192 ent: -2.744 str: 0.000 loss: -65.936]Iterations:  20%|██        | 6/30 [00:06<00:23,  1.01it/s, atk: -63.192 ent: -2.744 str: 0.000 loss: -65.936]Iterations:  20%|██        | 6/30 [00:07<00:23,  1.01it/s, atk: -66.311 ent: -2.740 str: 0.000 loss: -69.052]Iterations:  23%|██▎       | 7/30 [00:07<00:22,  1.02it/s, atk: -66.311 ent: -2.740 str: 0.000 loss: -69.052]Iterations:  23%|██▎       | 7/30 [00:08<00:22,  1.02it/s, atk: -70.096 ent: -2.739 str: 0.000 loss: -72.835]Iterations:  27%|██▋       | 8/30 [00:08<00:21,  1.03it/s, atk: -70.096 ent: -2.739 str: 0.000 loss: -72.835]Iterations:  27%|██▋       | 8/30 [00:09<00:21,  1.03it/s, atk: -74.227 ent: -2.732 str: 0.000 loss: -76.959]Iterations:  30%|███       | 9/30 [00:09<00:20,  1.04it/s, atk: -74.227 ent: -2.732 str: 0.000 loss: -76.959]Iterations:  30%|███       | 9/30 [00:09<00:20,  1.04it/s, atk: -78.700 ent: -2.730 str: 0.000 loss: -81.430]Iterations:  33%|███▎      | 10/30 [00:10<00:19,  1.05it/s, atk: -78.700 ent: -2.730 str: 0.000 loss: -81.430]Iterations:  33%|███▎      | 10/30 [00:10<00:19,  1.05it/s, atk: -81.441 ent: -2.729 str: 0.000 loss: -84.171]Iterations:  37%|███▋      | 11/30 [00:11<00:16,  1.12it/s, atk: -81.441 ent: -2.729 str: 0.000 loss: -84.171]Iterations:  37%|███▋      | 11/30 [00:11<00:16,  1.12it/s, atk: -84.104 ent: -2.729 str: 0.000 loss: -86.833]Iterations:  40%|████      | 12/30 [00:12<00:16,  1.09it/s, atk: -84.104 ent: -2.729 str: 0.000 loss: -86.833]Iterations:  40%|████      | 12/30 [00:12<00:16,  1.09it/s, atk: -87.107 ent: -2.732 str: 0.000 loss: -89.839]Iterations:  43%|████▎     | 13/30 [00:13<00:15,  1.07it/s, atk: -87.107 ent: -2.732 str: 0.000 loss: -89.839]Iterations:  43%|████▎     | 13/30 [00:13<00:15,  1.07it/s, atk: -88.783 ent: -2.732 str: 0.000 loss: -91.515]Iterations:  47%|████▋     | 14/30 [00:14<00:14,  1.07it/s, atk: -88.783 ent: -2.732 str: 0.000 loss: -91.515]Iterations:  47%|████▋     | 14/30 [00:14<00:14,  1.07it/s, atk: -90.598 ent: -2.733 str: 0.000 loss: -93.330]Iterations:  50%|█████     | 15/30 [00:14<00:13,  1.14it/s, atk: -90.598 ent: -2.733 str: 0.000 loss: -93.330]Iterations:  50%|█████     | 15/30 [00:15<00:13,  1.14it/s, atk: -93.181 ent: -2.732 str: 0.000 loss: -95.913]Iterations:  53%|█████▎    | 16/30 [00:15<00:10,  1.32it/s, atk: -93.181 ent: -2.732 str: 0.000 loss: -95.913]Iterations:  53%|█████▎    | 16/30 [00:15<00:10,  1.32it/s, atk: -96.889 ent: -2.729 str: 0.000 loss: -99.617]Iterations:  57%|█████▋    | 17/30 [00:15<00:08,  1.45it/s, atk: -96.889 ent: -2.729 str: 0.000 loss: -99.617]Iterations:  57%|█████▋    | 17/30 [00:16<00:08,  1.45it/s, atk: -100.020 ent: -2.727 str: 0.000 loss: -102.747]Iterations:  60%|██████    | 18/30 [00:16<00:07,  1.52it/s, atk: -100.020 ent: -2.727 str: 0.000 loss: -102.747]Iterations:  60%|██████    | 18/30 [00:16<00:07,  1.52it/s, atk: -103.474 ent: -2.726 str: 0.000 loss: -106.200]Iterations:  63%|██████▎   | 19/30 [00:16<00:06,  1.63it/s, atk: -103.474 ent: -2.726 str: 0.000 loss: -106.200]Iterations:  63%|██████▎   | 19/30 [00:17<00:06,  1.63it/s, atk: -108.072 ent: -2.726 str: 0.000 loss: -110.797]Iterations:  67%|██████▋   | 20/30 [00:17<00:05,  1.72it/s, atk: -108.072 ent: -2.726 str: 0.000 loss: -110.797]Iterations:  67%|██████▋   | 20/30 [00:17<00:05,  1.72it/s, atk: -110.777 ent: -2.725 str: 0.000 loss: -113.502]Iterations:  70%|███████   | 21/30 [00:18<00:05,  1.68it/s, atk: -110.777 ent: -2.725 str: 0.000 loss: -113.502]Iterations:  70%|███████   | 21/30 [00:18<00:05,  1.68it/s, atk: -113.951 ent: -2.725 str: 0.000 loss: -116.676]Iterations:  73%|███████▎  | 22/30 [00:18<00:04,  1.75it/s, atk: -113.951 ent: -2.725 str: 0.000 loss: -116.676]Iterations:  73%|███████▎  | 22/30 [00:18<00:04,  1.75it/s, atk: -117.579 ent: -2.724 str: 0.000 loss: -120.303]Iterations:  77%|███████▋  | 23/30 [00:19<00:03,  1.82it/s, atk: -117.579 ent: -2.724 str: 0.000 loss: -120.303]Iterations:  77%|███████▋  | 23/30 [00:19<00:03,  1.82it/s, atk: -121.209 ent: -2.723 str: 0.000 loss: -123.931]Iterations:  80%|████████  | 24/30 [00:19<00:03,  1.88it/s, atk: -121.209 ent: -2.723 str: 0.000 loss: -123.931]Iterations:  80%|████████  | 24/30 [00:19<00:03,  1.88it/s, atk: -124.215 ent: -2.723 str: 0.000 loss: -126.938]Iterations:  83%|████████▎ | 25/30 [00:20<00:02,  1.91it/s, atk: -124.215 ent: -2.723 str: 0.000 loss: -126.938]Iterations:  83%|████████▎ | 25/30 [00:20<00:02,  1.91it/s, atk: -128.061 ent: -2.723 str: 0.000 loss: -130.785]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.94it/s, atk: -128.061 ent: -2.723 str: 0.000 loss: -130.785]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.94it/s, atk: -131.252 ent: -2.724 str: 0.000 loss: -133.976]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.79it/s, atk: -131.252 ent: -2.724 str: 0.000 loss: -133.976]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.79it/s, atk: -135.412 ent: -2.724 str: 0.000 loss: -138.136]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.86it/s, atk: -135.412 ent: -2.724 str: 0.000 loss: -138.136]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.86it/s, atk: -138.324 ent: -2.724 str: 0.000 loss: -141.047]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.89it/s, atk: -138.324 ent: -2.724 str: 0.000 loss: -141.047]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.89it/s, atk: -141.079 ent: -2.723 str: 0.000 loss: -143.803]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.93it/s, atk: -141.079 ent: -2.723 str: 0.000 loss: -143.803]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -141.079 ent: -2.723 str: 0.000 loss: -143.803]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([864], device='cuda:0') tensor(0.7859, device='cuda:0')
after_true: tensor([468], device='cuda:0') tensor(5.5424e-07, device='cuda:0')
L1: [3783.4866]	L2: [24.612375]	Linf: [0.7411765]

Accuracy on benign examples: 100.0%
gt_label: 94 pred_label: 94 pred_clean_logit 0.9314122796058655
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.24it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  8.06it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.58it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 10.43it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 12.26it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.71it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.96it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 17.72it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 18.28it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.20it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.11it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.22s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.32s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.38s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.41s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2479
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.497 ent: -3.327 str: 0.000 loss: -3.824]Iterations:   3%|▎         | 1/30 [00:00<00:28,  1.02it/s, atk: -0.497 ent: -3.327 str: 0.000 loss: -3.824]Iterations:   3%|▎         | 1/30 [00:01<00:28,  1.02it/s, atk: -2.166 ent: -3.316 str: 0.000 loss: -5.482]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.27it/s, atk: -2.166 ent: -3.316 str: 0.000 loss: -5.482]Iterations:   7%|▋         | 2/30 [00:02<00:22,  1.27it/s, atk: -3.594 ent: -3.321 str: 0.000 loss: -6.915]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.37it/s, atk: -3.594 ent: -3.321 str: 0.000 loss: -6.915]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.37it/s, atk: -6.494 ent: -3.321 str: 0.000 loss: -9.815]Iterations:  13%|█▎        | 4/30 [00:02<00:18,  1.44it/s, atk: -6.494 ent: -3.321 str: 0.000 loss: -9.815]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.44it/s, atk: -14.435 ent: -3.322 str: 0.000 loss: -17.757]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.45it/s, atk: -14.435 ent: -3.322 str: 0.000 loss: -17.757]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.45it/s, atk: -22.515 ent: -3.325 str: 0.000 loss: -25.840]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.42it/s, atk: -22.515 ent: -3.325 str: 0.000 loss: -25.840]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.42it/s, atk: -23.987 ent: -3.325 str: 0.000 loss: -27.312]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.44it/s, atk: -23.987 ent: -3.325 str: 0.000 loss: -27.312]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.44it/s, atk: -31.419 ent: -3.327 str: 0.000 loss: -34.746]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.39it/s, atk: -31.419 ent: -3.327 str: 0.000 loss: -34.746]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -38.225 ent: -3.327 str: 0.000 loss: -41.553]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.40it/s, atk: -38.225 ent: -3.327 str: 0.000 loss: -41.553]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.40it/s, atk: -43.782 ent: -3.326 str: 0.000 loss: -47.108]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.42it/s, atk: -43.782 ent: -3.326 str: 0.000 loss: -47.108]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.42it/s, atk: -49.831 ent: -3.325 str: 0.000 loss: -53.156]Iterations:  37%|███▋      | 11/30 [00:07<00:13,  1.39it/s, atk: -49.831 ent: -3.325 str: 0.000 loss: -53.156]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.39it/s, atk: -54.931 ent: -3.324 str: 0.000 loss: -58.255]Iterations:  40%|████      | 12/30 [00:08<00:13,  1.36it/s, atk: -54.931 ent: -3.324 str: 0.000 loss: -58.255]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -60.337 ent: -3.322 str: 0.000 loss: -63.659]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.36it/s, atk: -60.337 ent: -3.322 str: 0.000 loss: -63.659]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.36it/s, atk: -64.856 ent: -3.319 str: 0.000 loss: -68.176]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.37it/s, atk: -64.856 ent: -3.319 str: 0.000 loss: -68.176]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.37it/s, atk: -69.732 ent: -3.316 str: 0.000 loss: -73.049]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.37it/s, atk: -69.732 ent: -3.316 str: 0.000 loss: -73.049]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.37it/s, atk: -74.430 ent: -3.313 str: 0.000 loss: -77.743]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.40it/s, atk: -74.430 ent: -3.313 str: 0.000 loss: -77.743]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.40it/s, atk: -79.349 ent: -3.311 str: 0.000 loss: -82.660]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.39it/s, atk: -79.349 ent: -3.311 str: 0.000 loss: -82.660]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.39it/s, atk: -84.114 ent: -3.309 str: 0.000 loss: -87.423]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -84.114 ent: -3.309 str: 0.000 loss: -87.423]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -88.687 ent: -3.309 str: 0.000 loss: -91.996]Iterations:  63%|██████▎   | 19/30 [00:13<00:08,  1.34it/s, atk: -88.687 ent: -3.309 str: 0.000 loss: -91.996]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.34it/s, atk: -92.544 ent: -3.308 str: 0.000 loss: -95.853]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.37it/s, atk: -92.544 ent: -3.308 str: 0.000 loss: -95.853]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.37it/s, atk: -96.687 ent: -3.307 str: 0.000 loss: -99.995]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.35it/s, atk: -96.687 ent: -3.307 str: 0.000 loss: -99.995]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.35it/s, atk: -100.518 ent: -3.306 str: 0.000 loss: -103.824]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.30it/s, atk: -100.518 ent: -3.306 str: 0.000 loss: -103.824]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.30it/s, atk: -103.718 ent: -3.305 str: 0.000 loss: -107.023]Iterations:  77%|███████▋  | 23/30 [00:16<00:05,  1.29it/s, atk: -103.718 ent: -3.305 str: 0.000 loss: -107.023]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.29it/s, atk: -106.997 ent: -3.303 str: 0.000 loss: -110.301]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.32it/s, atk: -106.997 ent: -3.303 str: 0.000 loss: -110.301]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.32it/s, atk: -110.709 ent: -3.303 str: 0.000 loss: -114.012]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.26it/s, atk: -110.709 ent: -3.303 str: 0.000 loss: -114.012]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.26it/s, atk: -114.384 ent: -3.302 str: 0.000 loss: -117.686]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.24it/s, atk: -114.384 ent: -3.302 str: 0.000 loss: -117.686]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.24it/s, atk: -117.852 ent: -3.302 str: 0.000 loss: -121.155]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.25it/s, atk: -117.852 ent: -3.302 str: 0.000 loss: -121.155]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.25it/s, atk: -120.688 ent: -3.304 str: 0.000 loss: -123.992]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.24it/s, atk: -120.688 ent: -3.304 str: 0.000 loss: -123.992]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.24it/s, atk: -124.981 ent: -3.304 str: 0.000 loss: -128.285]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.26it/s, atk: -124.981 ent: -3.304 str: 0.000 loss: -128.285]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.26it/s, atk: -128.405 ent: -3.305 str: 0.000 loss: -131.710]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.18it/s, atk: -128.405 ent: -3.305 str: 0.000 loss: -131.710]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -128.405 ent: -3.305 str: 0.000 loss: -131.710]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([95], device='cuda:0') tensor(0.9981, device='cuda:0')
after_true: tensor([94], device='cuda:0') tensor(1.9641e-06, device='cuda:0')
L1: [1998.3452]	L2: [13.396771]	Linf: [0.4509804]

Accuracy on benign examples: 100.0%
gt_label: 978 pred_label: 978 pred_clean_logit 0.5576567649841309
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.26it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.19it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.79it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.59it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 11.67it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 11.69it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.19it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 11.37it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.01it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.23it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.86s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.79s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.89s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:02,  2.02s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.12s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.03s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4474
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.550 ent: -5.158 str: 0.000 loss: -8.708]Iterations:   3%|▎         | 1/30 [00:02<01:21,  2.79s/it, atk: -3.550 ent: -5.158 str: 0.000 loss: -8.708]Iterations:   3%|▎         | 1/30 [00:03<01:21,  2.79s/it, atk: -5.033 ent: -5.152 str: 0.000 loss: -10.185]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.64s/it, atk: -5.033 ent: -5.152 str: 0.000 loss: -10.185]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.64s/it, atk: -7.563 ent: -5.151 str: 0.000 loss: -12.715]Iterations:  10%|█         | 3/30 [00:04<00:36,  1.35s/it, atk: -7.563 ent: -5.151 str: 0.000 loss: -12.715]Iterations:  10%|█         | 3/30 [00:05<00:36,  1.35s/it, atk: -9.631 ent: -5.148 str: 0.000 loss: -14.778]Iterations:  13%|█▎        | 4/30 [00:05<00:30,  1.18s/it, atk: -9.631 ent: -5.148 str: 0.000 loss: -14.778]Iterations:  13%|█▎        | 4/30 [00:06<00:30,  1.18s/it, atk: -10.850 ent: -5.140 str: 0.000 loss: -15.990]Iterations:  17%|█▋        | 5/30 [00:06<00:29,  1.16s/it, atk: -10.850 ent: -5.140 str: 0.000 loss: -15.990]Iterations:  17%|█▋        | 5/30 [00:07<00:29,  1.16s/it, atk: -13.281 ent: -5.130 str: 0.000 loss: -18.411]Iterations:  20%|██        | 6/30 [00:07<00:26,  1.08s/it, atk: -13.281 ent: -5.130 str: 0.000 loss: -18.411]Iterations:  20%|██        | 6/30 [00:08<00:26,  1.08s/it, atk: -18.210 ent: -5.123 str: 0.000 loss: -23.333]Iterations:  23%|██▎       | 7/30 [00:08<00:25,  1.10s/it, atk: -18.210 ent: -5.123 str: 0.000 loss: -23.333]Iterations:  23%|██▎       | 7/30 [00:09<00:25,  1.10s/it, atk: -19.623 ent: -5.118 str: 0.000 loss: -24.740]Iterations:  27%|██▋       | 8/30 [00:09<00:24,  1.09s/it, atk: -19.623 ent: -5.118 str: 0.000 loss: -24.740]Iterations:  27%|██▋       | 8/30 [00:10<00:24,  1.09s/it, atk: -22.017 ent: -5.114 str: 0.000 loss: -27.131]Iterations:  30%|███       | 9/30 [00:10<00:21,  1.05s/it, atk: -22.017 ent: -5.114 str: 0.000 loss: -27.131]Iterations:  30%|███       | 9/30 [00:11<00:21,  1.05s/it, atk: -24.953 ent: -5.113 str: 0.000 loss: -30.066]Iterations:  33%|███▎      | 10/30 [00:11<00:20,  1.01s/it, atk: -24.953 ent: -5.113 str: 0.000 loss: -30.066]Iterations:  33%|███▎      | 10/30 [00:12<00:20,  1.01s/it, atk: -26.875 ent: -5.111 str: 0.000 loss: -31.986]Iterations:  37%|███▋      | 11/30 [00:12<00:18,  1.03it/s, atk: -26.875 ent: -5.111 str: 0.000 loss: -31.986]Iterations:  37%|███▋      | 11/30 [00:13<00:18,  1.03it/s, atk: -28.513 ent: -5.111 str: 0.000 loss: -33.624]Iterations:  40%|████      | 12/30 [00:13<00:16,  1.06it/s, atk: -28.513 ent: -5.111 str: 0.000 loss: -33.624]Iterations:  40%|████      | 12/30 [00:13<00:16,  1.06it/s, atk: -28.889 ent: -5.110 str: 0.000 loss: -33.999]Iterations:  43%|████▎     | 13/30 [00:14<00:16,  1.03it/s, atk: -28.889 ent: -5.110 str: 0.000 loss: -33.999]Iterations:  43%|████▎     | 13/30 [00:15<00:16,  1.03it/s, atk: -31.165 ent: -5.109 str: 0.000 loss: -36.275]Iterations:  47%|████▋     | 14/30 [00:15<00:17,  1.10s/it, atk: -31.165 ent: -5.109 str: 0.000 loss: -36.275]Iterations:  47%|████▋     | 14/30 [00:16<00:17,  1.10s/it, atk: -32.711 ent: -5.108 str: 0.000 loss: -37.819]Iterations:  50%|█████     | 15/30 [00:16<00:16,  1.07s/it, atk: -32.711 ent: -5.108 str: 0.000 loss: -37.819]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.07s/it, atk: -34.879 ent: -5.102 str: 0.000 loss: -39.981]Iterations:  53%|█████▎    | 16/30 [00:18<00:16,  1.21s/it, atk: -34.879 ent: -5.102 str: 0.000 loss: -39.981]Iterations:  53%|█████▎    | 16/30 [00:19<00:16,  1.21s/it, atk: -37.566 ent: -5.095 str: 0.000 loss: -42.661]Iterations:  57%|█████▋    | 17/30 [00:19<00:15,  1.21s/it, atk: -37.566 ent: -5.095 str: 0.000 loss: -42.661]Iterations:  57%|█████▋    | 17/30 [00:20<00:15,  1.21s/it, atk: -40.444 ent: -5.087 str: 0.000 loss: -45.531]Iterations:  60%|██████    | 18/30 [00:20<00:14,  1.24s/it, atk: -40.444 ent: -5.087 str: 0.000 loss: -45.531]Iterations:  60%|██████    | 18/30 [00:21<00:14,  1.24s/it, atk: -42.624 ent: -5.080 str: 0.000 loss: -47.704]Iterations:  63%|██████▎   | 19/30 [00:22<00:14,  1.33s/it, atk: -42.624 ent: -5.080 str: 0.000 loss: -47.704]Iterations:  63%|██████▎   | 19/30 [00:23<00:14,  1.33s/it, atk: -44.049 ent: -5.081 str: 0.000 loss: -49.130]Iterations:  67%|██████▋   | 20/30 [00:23<00:13,  1.31s/it, atk: -44.049 ent: -5.081 str: 0.000 loss: -49.130]Iterations:  67%|██████▋   | 20/30 [00:24<00:13,  1.31s/it, atk: -44.544 ent: -5.085 str: 0.000 loss: -49.629]Iterations:  70%|███████   | 21/30 [00:25<00:12,  1.38s/it, atk: -44.544 ent: -5.085 str: 0.000 loss: -49.629]Iterations:  70%|███████   | 21/30 [00:26<00:12,  1.38s/it, atk: -45.768 ent: -5.084 str: 0.000 loss: -50.852]Iterations:  73%|███████▎  | 22/30 [00:26<00:10,  1.30s/it, atk: -45.768 ent: -5.084 str: 0.000 loss: -50.852]Iterations:  73%|███████▎  | 22/30 [00:27<00:10,  1.30s/it, atk: -49.310 ent: -5.080 str: 0.000 loss: -54.390]Iterations:  77%|███████▋  | 23/30 [00:27<00:08,  1.27s/it, atk: -49.310 ent: -5.080 str: 0.000 loss: -54.390]Iterations:  77%|███████▋  | 23/30 [00:28<00:08,  1.27s/it, atk: -50.661 ent: -5.078 str: 0.000 loss: -55.739]Iterations:  80%|████████  | 24/30 [00:28<00:07,  1.19s/it, atk: -50.661 ent: -5.078 str: 0.000 loss: -55.739]Iterations:  80%|████████  | 24/30 [00:29<00:07,  1.19s/it, atk: -53.627 ent: -5.081 str: 0.000 loss: -58.708]Iterations:  83%|████████▎ | 25/30 [00:29<00:05,  1.16s/it, atk: -53.627 ent: -5.081 str: 0.000 loss: -58.708]Iterations:  83%|████████▎ | 25/30 [00:30<00:05,  1.16s/it, atk: -55.987 ent: -5.082 str: 0.000 loss: -61.070]Iterations:  87%|████████▋ | 26/30 [00:31<00:04,  1.25s/it, atk: -55.987 ent: -5.082 str: 0.000 loss: -61.070]Iterations:  87%|████████▋ | 26/30 [00:31<00:04,  1.25s/it, atk: -54.976 ent: -5.079 str: 0.000 loss: -60.055]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.23s/it, atk: -54.976 ent: -5.079 str: 0.000 loss: -60.055]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.23s/it, atk: -56.881 ent: -5.084 str: 0.000 loss: -61.964]Iterations:  93%|█████████▎| 28/30 [00:33<00:02,  1.21s/it, atk: -56.881 ent: -5.084 str: 0.000 loss: -61.964]Iterations:  93%|█████████▎| 28/30 [00:34<00:02,  1.21s/it, atk: -59.535 ent: -5.083 str: 0.000 loss: -64.618]Iterations:  97%|█████████▋| 29/30 [00:34<00:01,  1.18s/it, atk: -59.535 ent: -5.083 str: 0.000 loss: -64.618]Iterations:  97%|█████████▋| 29/30 [00:35<00:01,  1.18s/it, atk: -60.263 ent: -5.084 str: 0.000 loss: -65.347]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.18s/it, atk: -60.263 ent: -5.084 str: 0.000 loss: -65.347]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.19s/it, atk: -60.263 ent: -5.084 str: 0.000 loss: -65.347]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([977], device='cuda:0') tensor(0.8634, device='cuda:0')
after_true: tensor([978], device='cuda:0') tensor(0.0023, device='cuda:0')
L1: [1435.9254]	L2: [10.461191]	Linf: [0.49411768]

Accuracy on benign examples: 100.0%
gt_label: 141 pred_label: 141 pred_clean_logit 0.5922299027442932
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.55it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.95it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.97it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  7.96it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:01,  9.45it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00, 10.82it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.59it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  9.93it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  9.95it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.98it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.11it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.04s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:04,  2.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.92s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.06s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2566
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.354 ent: -5.123 str: 0.000 loss: -8.477]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.22s/it, atk: -3.354 ent: -5.123 str: 0.000 loss: -8.477]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.22s/it, atk: -8.877 ent: -5.108 str: 0.000 loss: -13.984]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.66s/it, atk: -8.877 ent: -5.108 str: 0.000 loss: -13.984]Iterations:   7%|▋         | 2/30 [00:04<00:46,  1.66s/it, atk: -16.364 ent: -5.098 str: 0.000 loss: -21.462]Iterations:  10%|█         | 3/30 [00:05<00:45,  1.70s/it, atk: -16.364 ent: -5.098 str: 0.000 loss: -21.462]Iterations:  10%|█         | 3/30 [00:05<00:45,  1.70s/it, atk: -21.099 ent: -5.080 str: 0.000 loss: -26.179]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.53s/it, atk: -21.099 ent: -5.080 str: 0.000 loss: -26.179]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.53s/it, atk: -27.144 ent: -5.065 str: 0.000 loss: -32.208]Iterations:  17%|█▋        | 5/30 [00:07<00:35,  1.41s/it, atk: -27.144 ent: -5.065 str: 0.000 loss: -32.208]Iterations:  17%|█▋        | 5/30 [00:08<00:35,  1.41s/it, atk: -33.376 ent: -5.055 str: 0.000 loss: -38.432]Iterations:  20%|██        | 6/30 [00:09<00:34,  1.45s/it, atk: -33.376 ent: -5.055 str: 0.000 loss: -38.432]Iterations:  20%|██        | 6/30 [00:09<00:34,  1.45s/it, atk: -37.943 ent: -5.061 str: 0.000 loss: -43.004]Iterations:  23%|██▎       | 7/30 [00:10<00:33,  1.44s/it, atk: -37.943 ent: -5.061 str: 0.000 loss: -43.004]Iterations:  23%|██▎       | 7/30 [00:11<00:33,  1.44s/it, atk: -42.638 ent: -5.062 str: 0.000 loss: -47.701]Iterations:  27%|██▋       | 8/30 [00:12<00:33,  1.52s/it, atk: -42.638 ent: -5.062 str: 0.000 loss: -47.701]Iterations:  27%|██▋       | 8/30 [00:13<00:33,  1.52s/it, atk: -46.948 ent: -5.064 str: 0.000 loss: -52.013]Iterations:  30%|███       | 9/30 [00:13<00:32,  1.54s/it, atk: -46.948 ent: -5.064 str: 0.000 loss: -52.013]Iterations:  30%|███       | 9/30 [00:14<00:32,  1.54s/it, atk: -52.005 ent: -5.065 str: 0.000 loss: -57.070]Iterations:  33%|███▎      | 10/30 [00:15<00:30,  1.54s/it, atk: -52.005 ent: -5.065 str: 0.000 loss: -57.070]Iterations:  33%|███▎      | 10/30 [00:15<00:30,  1.54s/it, atk: -55.019 ent: -5.061 str: 0.000 loss: -60.079]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.36s/it, atk: -55.019 ent: -5.061 str: 0.000 loss: -60.079]Iterations:  37%|███▋      | 11/30 [00:17<00:25,  1.36s/it, atk: -59.792 ent: -5.061 str: 0.000 loss: -64.853]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.38s/it, atk: -59.792 ent: -5.061 str: 0.000 loss: -64.853]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.38s/it, atk: -64.192 ent: -5.063 str: 0.000 loss: -69.254]Iterations:  43%|████▎     | 13/30 [00:19<00:24,  1.43s/it, atk: -64.192 ent: -5.063 str: 0.000 loss: -69.254]Iterations:  43%|████▎     | 13/30 [00:20<00:24,  1.43s/it, atk: -65.643 ent: -5.064 str: 0.000 loss: -70.707]Iterations:  47%|████▋     | 14/30 [00:20<00:22,  1.41s/it, atk: -65.643 ent: -5.064 str: 0.000 loss: -70.707]Iterations:  47%|████▋     | 14/30 [00:21<00:22,  1.41s/it, atk: -70.788 ent: -5.066 str: 0.000 loss: -75.854]Iterations:  50%|█████     | 15/30 [00:22<00:22,  1.47s/it, atk: -70.788 ent: -5.066 str: 0.000 loss: -75.854]Iterations:  50%|█████     | 15/30 [00:23<00:22,  1.47s/it, atk: -73.761 ent: -5.063 str: 0.000 loss: -78.824]Iterations:  53%|█████▎    | 16/30 [00:24<00:21,  1.55s/it, atk: -73.761 ent: -5.063 str: 0.000 loss: -78.824]Iterations:  53%|█████▎    | 16/30 [00:24<00:21,  1.55s/it, atk: -78.226 ent: -5.064 str: 0.000 loss: -83.290]Iterations:  57%|█████▋    | 17/30 [00:25<00:19,  1.52s/it, atk: -78.226 ent: -5.064 str: 0.000 loss: -83.290]Iterations:  57%|█████▋    | 17/30 [00:26<00:19,  1.52s/it, atk: -81.628 ent: -5.068 str: 0.000 loss: -86.696]Iterations:  60%|██████    | 18/30 [00:27<00:18,  1.57s/it, atk: -81.628 ent: -5.068 str: 0.000 loss: -86.696]Iterations:  60%|██████    | 18/30 [00:28<00:18,  1.57s/it, atk: -83.045 ent: -5.067 str: 0.000 loss: -88.112]Iterations:  63%|██████▎   | 19/30 [00:28<00:17,  1.60s/it, atk: -83.045 ent: -5.067 str: 0.000 loss: -88.112]Iterations:  63%|██████▎   | 19/30 [00:29<00:17,  1.60s/it, atk: -86.549 ent: -5.065 str: 0.000 loss: -91.613]Iterations:  67%|██████▋   | 20/30 [00:30<00:14,  1.46s/it, atk: -86.549 ent: -5.065 str: 0.000 loss: -91.613]Iterations:  67%|██████▋   | 20/30 [00:30<00:14,  1.46s/it, atk: -87.872 ent: -5.060 str: 0.000 loss: -92.932]Iterations:  70%|███████   | 21/30 [00:31<00:12,  1.36s/it, atk: -87.872 ent: -5.060 str: 0.000 loss: -92.932]Iterations:  70%|███████   | 21/30 [00:31<00:12,  1.36s/it, atk: -90.281 ent: -5.058 str: 0.000 loss: -95.339]Iterations:  73%|███████▎  | 22/30 [00:32<00:10,  1.26s/it, atk: -90.281 ent: -5.058 str: 0.000 loss: -95.339]Iterations:  73%|███████▎  | 22/30 [00:32<00:10,  1.26s/it, atk: -95.357 ent: -5.059 str: 0.000 loss: -100.416]Iterations:  77%|███████▋  | 23/30 [00:33<00:08,  1.17s/it, atk: -95.357 ent: -5.059 str: 0.000 loss: -100.416]Iterations:  77%|███████▋  | 23/30 [00:33<00:08,  1.17s/it, atk: -96.108 ent: -5.061 str: 0.000 loss: -101.169]Iterations:  80%|████████  | 24/30 [00:34<00:07,  1.28s/it, atk: -96.108 ent: -5.061 str: 0.000 loss: -101.169]Iterations:  80%|████████  | 24/30 [00:35<00:07,  1.28s/it, atk: -97.810 ent: -5.062 str: 0.000 loss: -102.872]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.27s/it, atk: -97.810 ent: -5.062 str: 0.000 loss: -102.872]Iterations:  83%|████████▎ | 25/30 [00:36<00:06,  1.27s/it, atk: -101.148 ent: -5.063 str: 0.000 loss: -106.211]Iterations:  87%|████████▋ | 26/30 [00:37<00:05,  1.27s/it, atk: -101.148 ent: -5.063 str: 0.000 loss: -106.211]Iterations:  87%|████████▋ | 26/30 [00:37<00:05,  1.27s/it, atk: -103.571 ent: -5.063 str: 0.000 loss: -108.634]Iterations:  90%|█████████ | 27/30 [00:38<00:03,  1.14s/it, atk: -103.571 ent: -5.063 str: 0.000 loss: -108.634]Iterations:  90%|█████████ | 27/30 [00:38<00:03,  1.14s/it, atk: -105.939 ent: -5.064 str: 0.000 loss: -111.003]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.18s/it, atk: -105.939 ent: -5.064 str: 0.000 loss: -111.003]Iterations:  93%|█████████▎| 28/30 [00:40<00:02,  1.18s/it, atk: -108.511 ent: -5.064 str: 0.000 loss: -113.575]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.21s/it, atk: -108.511 ent: -5.064 str: 0.000 loss: -113.575]Iterations:  97%|█████████▋| 29/30 [00:41<00:01,  1.21s/it, atk: -110.733 ent: -5.066 str: 0.000 loss: -115.799]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.30s/it, atk: -110.733 ent: -5.066 str: 0.000 loss: -115.799]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.40s/it, atk: -110.733 ent: -5.066 str: 0.000 loss: -115.799]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([142], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([141], device='cuda:0') tensor(1.2075e-05, device='cuda:0')
L1: [2092.1492]	L2: [15.760844]	Linf: [0.6588235]

Accuracy on benign examples: 100.0%
gt_label: 227 pred_label: 227 pred_clean_logit 0.8357266783714294
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.50it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.23it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.44it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.62it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 13.27it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 11.47it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 14.23it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 14.16it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.05it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.69s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:07,  2.49s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.78s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:03,  3.15s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.17s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.02s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3748
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.288 ent: -5.086 str: 0.000 loss: -8.374]Iterations:   3%|▎         | 1/30 [00:03<01:28,  3.07s/it, atk: -3.288 ent: -5.086 str: 0.000 loss: -8.374]Iterations:   3%|▎         | 1/30 [00:03<01:28,  3.07s/it, atk: -6.839 ent: -5.089 str: 0.000 loss: -11.928]Iterations:   7%|▋         | 2/30 [00:04<00:54,  1.94s/it, atk: -6.839 ent: -5.089 str: 0.000 loss: -11.928]Iterations:   7%|▋         | 2/30 [00:04<00:54,  1.94s/it, atk: -22.635 ent: -5.085 str: 0.000 loss: -27.720]Iterations:  10%|█         | 3/30 [00:05<00:42,  1.59s/it, atk: -22.635 ent: -5.085 str: 0.000 loss: -27.720]Iterations:  10%|█         | 3/30 [00:06<00:42,  1.59s/it, atk: -35.310 ent: -5.082 str: 0.000 loss: -40.393]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.51s/it, atk: -35.310 ent: -5.082 str: 0.000 loss: -40.393]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.51s/it, atk: -52.477 ent: -5.085 str: 0.000 loss: -57.561]Iterations:  17%|█▋        | 5/30 [00:08<00:37,  1.52s/it, atk: -52.477 ent: -5.085 str: 0.000 loss: -57.561]Iterations:  17%|█▋        | 5/30 [00:09<00:37,  1.52s/it, atk: -59.768 ent: -5.077 str: 0.000 loss: -64.844]Iterations:  20%|██        | 6/30 [00:09<00:36,  1.51s/it, atk: -59.768 ent: -5.077 str: 0.000 loss: -64.844]Iterations:  20%|██        | 6/30 [00:10<00:36,  1.51s/it, atk: -61.926 ent: -5.072 str: 0.000 loss: -66.998]Iterations:  23%|██▎       | 7/30 [00:11<00:34,  1.50s/it, atk: -61.926 ent: -5.072 str: 0.000 loss: -66.998]Iterations:  23%|██▎       | 7/30 [00:11<00:34,  1.50s/it, atk: -71.934 ent: -5.064 str: 0.000 loss: -76.998]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.42s/it, atk: -71.934 ent: -5.064 str: 0.000 loss: -76.998]Iterations:  27%|██▋       | 8/30 [00:13<00:31,  1.42s/it, atk: -76.055 ent: -5.069 str: 0.000 loss: -81.124]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.35s/it, atk: -76.055 ent: -5.069 str: 0.000 loss: -81.124]Iterations:  30%|███       | 9/30 [00:14<00:28,  1.35s/it, atk: -82.715 ent: -5.069 str: 0.000 loss: -87.784]Iterations:  33%|███▎      | 10/30 [00:14<00:25,  1.26s/it, atk: -82.715 ent: -5.069 str: 0.000 loss: -87.784]Iterations:  33%|███▎      | 10/30 [00:15<00:25,  1.26s/it, atk: -90.757 ent: -5.070 str: 0.000 loss: -95.827]Iterations:  37%|███▋      | 11/30 [00:16<00:26,  1.38s/it, atk: -90.757 ent: -5.070 str: 0.000 loss: -95.827]Iterations:  37%|███▋      | 11/30 [00:17<00:26,  1.38s/it, atk: -99.045 ent: -5.070 str: 0.000 loss: -104.115]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.36s/it, atk: -99.045 ent: -5.070 str: 0.000 loss: -104.115]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.36s/it, atk: -104.401 ent: -5.067 str: 0.000 loss: -109.467]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.27s/it, atk: -104.401 ent: -5.067 str: 0.000 loss: -109.467]Iterations:  43%|████▎     | 13/30 [00:19<00:21,  1.27s/it, atk: -111.614 ent: -5.063 str: 0.000 loss: -116.677]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.33s/it, atk: -111.614 ent: -5.063 str: 0.000 loss: -116.677]Iterations:  47%|████▋     | 14/30 [00:21<00:21,  1.33s/it, atk: -112.137 ent: -5.064 str: 0.000 loss: -117.201]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.34s/it, atk: -112.137 ent: -5.064 str: 0.000 loss: -117.201]Iterations:  50%|█████     | 15/30 [00:22<00:20,  1.34s/it, atk: -115.580 ent: -5.059 str: 0.000 loss: -120.639]Iterations:  53%|█████▎    | 16/30 [00:22<00:18,  1.33s/it, atk: -115.580 ent: -5.059 str: 0.000 loss: -120.639]Iterations:  53%|█████▎    | 16/30 [00:23<00:18,  1.33s/it, atk: -119.362 ent: -5.052 str: 0.000 loss: -124.414]Iterations:  57%|█████▋    | 17/30 [00:24<00:17,  1.33s/it, atk: -119.362 ent: -5.052 str: 0.000 loss: -124.414]Iterations:  57%|█████▋    | 17/30 [00:25<00:17,  1.33s/it, atk: -120.329 ent: -5.048 str: 0.000 loss: -125.377]Iterations:  60%|██████    | 18/30 [00:25<00:16,  1.39s/it, atk: -120.329 ent: -5.048 str: 0.000 loss: -125.377]Iterations:  60%|██████    | 18/30 [00:26<00:16,  1.39s/it, atk: -124.022 ent: -5.047 str: 0.000 loss: -129.069]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.35s/it, atk: -124.022 ent: -5.047 str: 0.000 loss: -129.069]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.35s/it, atk: -125.993 ent: -5.047 str: 0.000 loss: -131.040]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.30s/it, atk: -125.993 ent: -5.047 str: 0.000 loss: -131.040]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.30s/it, atk: -132.603 ent: -5.049 str: 0.000 loss: -137.652]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.30s/it, atk: -132.603 ent: -5.049 str: 0.000 loss: -137.652]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.30s/it, atk: -136.575 ent: -5.035 str: 0.000 loss: -141.610]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.20s/it, atk: -136.575 ent: -5.035 str: 0.000 loss: -141.610]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.20s/it, atk: -137.406 ent: -5.035 str: 0.000 loss: -142.441]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.17s/it, atk: -137.406 ent: -5.035 str: 0.000 loss: -142.441]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.17s/it, atk: -140.069 ent: -5.037 str: 0.000 loss: -145.106]Iterations:  80%|████████  | 24/30 [00:32<00:06,  1.16s/it, atk: -140.069 ent: -5.037 str: 0.000 loss: -145.106]Iterations:  80%|████████  | 24/30 [00:33<00:06,  1.16s/it, atk: -145.609 ent: -5.032 str: 0.000 loss: -150.642]Iterations:  83%|████████▎ | 25/30 [00:33<00:05,  1.11s/it, atk: -145.609 ent: -5.032 str: 0.000 loss: -150.642]Iterations:  83%|████████▎ | 25/30 [00:34<00:05,  1.11s/it, atk: -150.745 ent: -5.028 str: 0.000 loss: -155.773]Iterations:  87%|████████▋ | 26/30 [00:35<00:04,  1.19s/it, atk: -150.745 ent: -5.028 str: 0.000 loss: -155.773]Iterations:  87%|████████▋ | 26/30 [00:35<00:04,  1.19s/it, atk: -156.128 ent: -5.024 str: 0.000 loss: -161.152]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.09s/it, atk: -156.128 ent: -5.024 str: 0.000 loss: -161.152]Iterations:  90%|█████████ | 27/30 [00:36<00:03,  1.09s/it, atk: -161.512 ent: -5.021 str: 0.000 loss: -166.534]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.17s/it, atk: -161.512 ent: -5.021 str: 0.000 loss: -166.534]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.17s/it, atk: -166.453 ent: -5.022 str: 0.000 loss: -171.475]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.20s/it, atk: -166.453 ent: -5.022 str: 0.000 loss: -171.475]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.20s/it, atk: -175.245 ent: -5.015 str: 0.000 loss: -180.260]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.34s/it, atk: -175.245 ent: -5.015 str: 0.000 loss: -180.260]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.34s/it, atk: -175.245 ent: -5.015 str: 0.000 loss: -180.260]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([250], device='cuda:0') tensor(0.9410, device='cuda:0')
after_true: tensor([227], device='cuda:0') tensor(1.6394e-08, device='cuda:0')
L1: [2816.7566]	L2: [18.922323]	Linf: [0.83137256]

Accuracy on benign examples: 100.0%
gt_label: 565 pred_label: 565 pred_clean_logit 0.36834716796875
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.64it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.09it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.42it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01, 10.35it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:00,  9.60it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  9.08it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.23it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  8.84it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.64it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.52it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  7.92it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  7.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.36s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.68s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.64s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:02,  2.07s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.38s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3609
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -7.296 ent: -5.625 str: 0.000 loss: -12.922]Iterations:   3%|▎         | 1/30 [00:02<01:26,  2.99s/it, atk: -7.296 ent: -5.625 str: 0.000 loss: -12.922]Iterations:   3%|▎         | 1/30 [00:03<01:26,  2.99s/it, atk: -13.483 ent: -5.666 str: 0.000 loss: -19.149]Iterations:   7%|▋         | 2/30 [00:03<00:48,  1.73s/it, atk: -13.483 ent: -5.666 str: 0.000 loss: -19.149]Iterations:   7%|▋         | 2/30 [00:04<00:48,  1.73s/it, atk: -15.426 ent: -5.665 str: 0.000 loss: -21.091]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.30s/it, atk: -15.426 ent: -5.665 str: 0.000 loss: -21.091]Iterations:  10%|█         | 3/30 [00:05<00:35,  1.30s/it, atk: -17.727 ent: -5.640 str: 0.000 loss: -23.367]Iterations:  13%|█▎        | 4/30 [00:05<00:31,  1.20s/it, atk: -17.727 ent: -5.640 str: 0.000 loss: -23.367]Iterations:  13%|█▎        | 4/30 [00:05<00:31,  1.20s/it, atk: -21.389 ent: -5.623 str: 0.000 loss: -27.012]Iterations:  17%|█▋        | 5/30 [00:06<00:27,  1.08s/it, atk: -21.389 ent: -5.623 str: 0.000 loss: -27.012]Iterations:  17%|█▋        | 5/30 [00:07<00:27,  1.08s/it, atk: -27.866 ent: -5.618 str: 0.000 loss: -33.484]Iterations:  20%|██        | 6/30 [00:07<00:28,  1.18s/it, atk: -27.866 ent: -5.618 str: 0.000 loss: -33.484]Iterations:  20%|██        | 6/30 [00:08<00:28,  1.18s/it, atk: -34.502 ent: -5.598 str: 0.000 loss: -40.100]Iterations:  23%|██▎       | 7/30 [00:09<00:29,  1.29s/it, atk: -34.502 ent: -5.598 str: 0.000 loss: -40.100]Iterations:  23%|██▎       | 7/30 [00:10<00:29,  1.29s/it, atk: -38.727 ent: -5.587 str: 0.000 loss: -44.314]Iterations:  27%|██▋       | 8/30 [00:10<00:28,  1.31s/it, atk: -38.727 ent: -5.587 str: 0.000 loss: -44.314]Iterations:  27%|██▋       | 8/30 [00:11<00:28,  1.31s/it, atk: -43.239 ent: -5.582 str: 0.000 loss: -48.821]Iterations:  30%|███       | 9/30 [00:12<00:27,  1.32s/it, atk: -43.239 ent: -5.582 str: 0.000 loss: -48.821]Iterations:  30%|███       | 9/30 [00:12<00:27,  1.32s/it, atk: -43.164 ent: -5.571 str: 0.000 loss: -48.735]Iterations:  33%|███▎      | 10/30 [00:13<00:25,  1.27s/it, atk: -43.164 ent: -5.571 str: 0.000 loss: -48.735]Iterations:  33%|███▎      | 10/30 [00:13<00:25,  1.27s/it, atk: -54.210 ent: -5.584 str: 0.000 loss: -59.794]Iterations:  37%|███▋      | 11/30 [00:14<00:23,  1.22s/it, atk: -54.210 ent: -5.584 str: 0.000 loss: -59.794]Iterations:  37%|███▋      | 11/30 [00:14<00:23,  1.22s/it, atk: -58.551 ent: -5.583 str: 0.000 loss: -64.134]Iterations:  40%|████      | 12/30 [00:15<00:20,  1.15s/it, atk: -58.551 ent: -5.583 str: 0.000 loss: -64.134]Iterations:  40%|████      | 12/30 [00:16<00:20,  1.15s/it, atk: -64.975 ent: -5.582 str: 0.000 loss: -70.557]Iterations:  43%|████▎     | 13/30 [00:16<00:21,  1.26s/it, atk: -64.975 ent: -5.582 str: 0.000 loss: -70.557]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.26s/it, atk: -69.605 ent: -5.580 str: 0.000 loss: -75.185]Iterations:  47%|████▋     | 14/30 [00:18<00:21,  1.32s/it, atk: -69.605 ent: -5.580 str: 0.000 loss: -75.185]Iterations:  47%|████▋     | 14/30 [00:19<00:21,  1.32s/it, atk: -73.496 ent: -5.581 str: 0.000 loss: -79.077]Iterations:  50%|█████     | 15/30 [00:19<00:19,  1.27s/it, atk: -73.496 ent: -5.581 str: 0.000 loss: -79.077]Iterations:  50%|█████     | 15/30 [00:20<00:19,  1.27s/it, atk: -76.760 ent: -5.581 str: 0.000 loss: -82.341]Iterations:  53%|█████▎    | 16/30 [00:20<00:18,  1.32s/it, atk: -76.760 ent: -5.581 str: 0.000 loss: -82.341]Iterations:  53%|█████▎    | 16/30 [00:21<00:18,  1.32s/it, atk: -80.587 ent: -5.581 str: 0.000 loss: -86.168]Iterations:  57%|█████▋    | 17/30 [00:22<00:17,  1.32s/it, atk: -80.587 ent: -5.581 str: 0.000 loss: -86.168]Iterations:  57%|█████▋    | 17/30 [00:23<00:17,  1.32s/it, atk: -83.619 ent: -5.583 str: 0.000 loss: -89.203]Iterations:  60%|██████    | 18/30 [00:23<00:15,  1.30s/it, atk: -83.619 ent: -5.583 str: 0.000 loss: -89.203]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.30s/it, atk: -86.472 ent: -5.584 str: 0.000 loss: -92.056]Iterations:  63%|██████▎   | 19/30 [00:24<00:13,  1.24s/it, atk: -86.472 ent: -5.584 str: 0.000 loss: -92.056]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.24s/it, atk: -90.885 ent: -5.585 str: 0.000 loss: -96.470]Iterations:  67%|██████▋   | 20/30 [00:26<00:13,  1.32s/it, atk: -90.885 ent: -5.585 str: 0.000 loss: -96.470]Iterations:  67%|██████▋   | 20/30 [00:26<00:13,  1.32s/it, atk: -94.795 ent: -5.588 str: 0.000 loss: -100.382]Iterations:  70%|███████   | 21/30 [00:27<00:11,  1.27s/it, atk: -94.795 ent: -5.588 str: 0.000 loss: -100.382]Iterations:  70%|███████   | 21/30 [00:28<00:11,  1.27s/it, atk: -99.698 ent: -5.591 str: 0.000 loss: -105.289]Iterations:  73%|███████▎  | 22/30 [00:28<00:10,  1.35s/it, atk: -99.698 ent: -5.591 str: 0.000 loss: -105.289]Iterations:  73%|███████▎  | 22/30 [00:29<00:10,  1.35s/it, atk: -103.188 ent: -5.593 str: 0.000 loss: -108.781]Iterations:  77%|███████▋  | 23/30 [00:30<00:09,  1.32s/it, atk: -103.188 ent: -5.593 str: 0.000 loss: -108.781]Iterations:  77%|███████▋  | 23/30 [00:30<00:09,  1.32s/it, atk: -106.857 ent: -5.594 str: 0.000 loss: -112.451]Iterations:  80%|████████  | 24/30 [00:31<00:07,  1.23s/it, atk: -106.857 ent: -5.594 str: 0.000 loss: -112.451]Iterations:  80%|████████  | 24/30 [00:31<00:07,  1.23s/it, atk: -108.711 ent: -5.595 str: 0.000 loss: -114.306]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.22s/it, atk: -108.711 ent: -5.595 str: 0.000 loss: -114.306]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.22s/it, atk: -110.969 ent: -5.596 str: 0.000 loss: -116.566]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.19s/it, atk: -110.969 ent: -5.596 str: 0.000 loss: -116.566]Iterations:  87%|████████▋ | 26/30 [00:34<00:04,  1.19s/it, atk: -114.165 ent: -5.596 str: 0.000 loss: -119.761]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.25s/it, atk: -114.165 ent: -5.596 str: 0.000 loss: -119.761]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.25s/it, atk: -116.280 ent: -5.595 str: 0.000 loss: -121.876]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.20s/it, atk: -116.280 ent: -5.595 str: 0.000 loss: -121.876]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.20s/it, atk: -119.897 ent: -5.597 str: 0.000 loss: -125.494]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.18s/it, atk: -119.897 ent: -5.597 str: 0.000 loss: -125.494]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.18s/it, atk: -122.608 ent: -5.599 str: 0.000 loss: -128.207]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.21s/it, atk: -122.608 ent: -5.599 str: 0.000 loss: -128.207]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.28s/it, atk: -122.608 ent: -5.599 str: 0.000 loss: -128.207]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([705], device='cuda:0') tensor(0.9990, device='cuda:0')
after_true: tensor([565], device='cuda:0') tensor(3.5727e-06, device='cuda:0')
L1: [2307.2786]	L2: [17.07121]	Linf: [0.99607843]

Accuracy on benign examples: 100.0%
gt_label: 555 pred_label: 555 pred_clean_logit 0.8923826217651367
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.81it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  7.25it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.62it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.23it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.17it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 11.51it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 12.22it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 10.82it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 10.35it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  9.91it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.78it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.03s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.55s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.73s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.93s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.35s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.04s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5019
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.392 ent: -5.937 str: 0.000 loss: -6.329]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.35s/it, atk: -0.392 ent: -5.937 str: 0.000 loss: -6.329]Iterations:   3%|▎         | 1/30 [00:03<01:08,  2.35s/it, atk: -2.028 ent: -5.953 str: 0.000 loss: -7.981]Iterations:   7%|▋         | 2/30 [00:03<00:48,  1.72s/it, atk: -2.028 ent: -5.953 str: 0.000 loss: -7.981]Iterations:   7%|▋         | 2/30 [00:04<00:48,  1.72s/it, atk: -7.182 ent: -5.950 str: 0.000 loss: -13.132]Iterations:  10%|█         | 3/30 [00:04<00:40,  1.52s/it, atk: -7.182 ent: -5.950 str: 0.000 loss: -13.132]Iterations:  10%|█         | 3/30 [00:05<00:40,  1.52s/it, atk: -13.240 ent: -5.946 str: 0.000 loss: -19.186]Iterations:  13%|█▎        | 4/30 [00:06<00:36,  1.39s/it, atk: -13.240 ent: -5.946 str: 0.000 loss: -19.186]Iterations:  13%|█▎        | 4/30 [00:06<00:36,  1.39s/it, atk: -20.464 ent: -5.939 str: 0.000 loss: -26.403]Iterations:  17%|█▋        | 5/30 [00:07<00:33,  1.36s/it, atk: -20.464 ent: -5.939 str: 0.000 loss: -26.403]Iterations:  17%|█▋        | 5/30 [00:07<00:33,  1.36s/it, atk: -28.413 ent: -5.946 str: 0.000 loss: -34.360]Iterations:  20%|██        | 6/30 [00:08<00:31,  1.29s/it, atk: -28.413 ent: -5.946 str: 0.000 loss: -34.360]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.29s/it, atk: -35.065 ent: -5.945 str: 0.000 loss: -41.010]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.36s/it, atk: -35.065 ent: -5.945 str: 0.000 loss: -41.010]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.36s/it, atk: -41.959 ent: -5.941 str: 0.000 loss: -47.900]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.26s/it, atk: -41.959 ent: -5.941 str: 0.000 loss: -47.900]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.26s/it, atk: -49.301 ent: -5.940 str: 0.000 loss: -55.241]Iterations:  30%|███       | 9/30 [00:12<00:27,  1.30s/it, atk: -49.301 ent: -5.940 str: 0.000 loss: -55.241]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.30s/it, atk: -56.497 ent: -5.940 str: 0.000 loss: -62.437]Iterations:  33%|███▎      | 10/30 [00:13<00:26,  1.31s/it, atk: -56.497 ent: -5.940 str: 0.000 loss: -62.437]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.31s/it, atk: -62.285 ent: -5.942 str: 0.000 loss: -68.227]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.28s/it, atk: -62.285 ent: -5.942 str: 0.000 loss: -68.227]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.28s/it, atk: -67.285 ent: -5.943 str: 0.000 loss: -73.228]Iterations:  40%|████      | 12/30 [00:16<00:21,  1.21s/it, atk: -67.285 ent: -5.943 str: 0.000 loss: -73.228]Iterations:  40%|████      | 12/30 [00:16<00:21,  1.21s/it, atk: -71.323 ent: -5.944 str: 0.000 loss: -77.267]Iterations:  43%|████▎     | 13/30 [00:17<00:22,  1.30s/it, atk: -71.323 ent: -5.944 str: 0.000 loss: -77.267]Iterations:  43%|████▎     | 13/30 [00:18<00:22,  1.30s/it, atk: -75.408 ent: -5.944 str: 0.000 loss: -81.352]Iterations:  47%|████▋     | 14/30 [00:19<00:22,  1.38s/it, atk: -75.408 ent: -5.944 str: 0.000 loss: -81.352]Iterations:  47%|████▋     | 14/30 [00:20<00:22,  1.38s/it, atk: -79.803 ent: -5.945 str: 0.000 loss: -85.748]Iterations:  50%|█████     | 15/30 [00:20<00:21,  1.45s/it, atk: -79.803 ent: -5.945 str: 0.000 loss: -85.748]Iterations:  50%|█████     | 15/30 [00:21<00:21,  1.45s/it, atk: -84.885 ent: -5.946 str: 0.000 loss: -90.831]Iterations:  53%|█████▎    | 16/30 [00:22<00:21,  1.50s/it, atk: -84.885 ent: -5.946 str: 0.000 loss: -90.831]Iterations:  53%|█████▎    | 16/30 [00:23<00:21,  1.50s/it, atk: -91.638 ent: -5.948 str: 0.000 loss: -97.586]Iterations:  57%|█████▋    | 17/30 [00:23<00:18,  1.40s/it, atk: -91.638 ent: -5.948 str: 0.000 loss: -97.586]Iterations:  57%|█████▋    | 17/30 [00:24<00:18,  1.40s/it, atk: -98.096 ent: -5.952 str: 0.000 loss: -104.048]Iterations:  60%|██████    | 18/30 [00:24<00:16,  1.41s/it, atk: -98.096 ent: -5.952 str: 0.000 loss: -104.048]Iterations:  60%|██████    | 18/30 [00:25<00:16,  1.41s/it, atk: -105.456 ent: -5.952 str: 0.000 loss: -111.408]Iterations:  63%|██████▎   | 19/30 [00:26<00:15,  1.38s/it, atk: -105.456 ent: -5.952 str: 0.000 loss: -111.408]Iterations:  63%|██████▎   | 19/30 [00:27<00:15,  1.38s/it, atk: -114.065 ent: -5.954 str: 0.000 loss: -120.020]Iterations:  67%|██████▋   | 20/30 [00:27<00:13,  1.38s/it, atk: -114.065 ent: -5.954 str: 0.000 loss: -120.020]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.38s/it, atk: -123.104 ent: -5.958 str: 0.000 loss: -129.062]Iterations:  70%|███████   | 21/30 [00:29<00:13,  1.50s/it, atk: -123.104 ent: -5.958 str: 0.000 loss: -129.062]Iterations:  70%|███████   | 21/30 [00:30<00:13,  1.50s/it, atk: -131.559 ent: -5.960 str: 0.000 loss: -137.519]Iterations:  73%|███████▎  | 22/30 [00:30<00:11,  1.39s/it, atk: -131.559 ent: -5.960 str: 0.000 loss: -137.519]Iterations:  73%|███████▎  | 22/30 [00:31<00:11,  1.39s/it, atk: -139.423 ent: -5.961 str: 0.000 loss: -145.384]Iterations:  77%|███████▋  | 23/30 [00:32<00:10,  1.43s/it, atk: -139.423 ent: -5.961 str: 0.000 loss: -145.384]Iterations:  77%|███████▋  | 23/30 [00:32<00:10,  1.43s/it, atk: -146.688 ent: -5.963 str: 0.000 loss: -152.651]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.29s/it, atk: -146.688 ent: -5.963 str: 0.000 loss: -152.651]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.29s/it, atk: -154.311 ent: -5.961 str: 0.000 loss: -160.272]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.23s/it, atk: -154.311 ent: -5.961 str: 0.000 loss: -160.272]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.23s/it, atk: -162.289 ent: -5.962 str: 0.000 loss: -168.251]Iterations:  87%|████████▋ | 26/30 [00:35<00:04,  1.17s/it, atk: -162.289 ent: -5.962 str: 0.000 loss: -168.251]Iterations:  87%|████████▋ | 26/30 [00:36<00:04,  1.17s/it, atk: -170.139 ent: -5.964 str: 0.000 loss: -176.103]Iterations:  90%|█████████ | 27/30 [00:36<00:03,  1.25s/it, atk: -170.139 ent: -5.964 str: 0.000 loss: -176.103]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.25s/it, atk: -177.365 ent: -5.964 str: 0.000 loss: -183.329]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.21s/it, atk: -177.365 ent: -5.964 str: 0.000 loss: -183.329]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.21s/it, atk: -183.612 ent: -5.963 str: 0.000 loss: -189.575]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.31s/it, atk: -183.612 ent: -5.963 str: 0.000 loss: -189.575]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.31s/it, atk: -190.012 ent: -5.964 str: 0.000 loss: -195.975]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.39s/it, atk: -190.012 ent: -5.964 str: 0.000 loss: -195.975]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.36s/it, atk: -190.012 ent: -5.964 str: 0.000 loss: -195.975]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([561], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([555], device='cuda:0') tensor(3.0421e-09, device='cuda:0')
L1: [4326.8237]	L2: [29.131693]	Linf: [0.9098039]

Accuracy on benign examples: 0.0%
gt_label: 965 pred_label: 923 pred_clean_logit 0.3958316147327423
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.03it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  9.47it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.89it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 10.73it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 10.24it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  9.43it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 10.71it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.41it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 11.79it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.44it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.12s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.72s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:03,  3.01s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  3.21s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.96s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4686
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -7.978 ent: -2.753 str: 0.000 loss: -10.731]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -7.978 ent: -2.753 str: 0.000 loss: -10.731]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -30.187 ent: -2.749 str: 0.000 loss: -32.936]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -30.187 ent: -2.749 str: 0.000 loss: -32.936]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -45.397 ent: -2.746 str: 0.000 loss: -48.143]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.32s/it, atk: -45.397 ent: -2.746 str: 0.000 loss: -48.143]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.32s/it, atk: -57.348 ent: -2.745 str: 0.000 loss: -60.093]Iterations:  13%|█▎        | 4/30 [00:05<00:33,  1.28s/it, atk: -57.348 ent: -2.745 str: 0.000 loss: -60.093]Iterations:  13%|█▎        | 4/30 [00:06<00:33,  1.28s/it, atk: -67.628 ent: -2.745 str: 0.000 loss: -70.373]Iterations:  17%|█▋        | 5/30 [00:06<00:30,  1.23s/it, atk: -67.628 ent: -2.745 str: 0.000 loss: -70.373]Iterations:  17%|█▋        | 5/30 [00:07<00:30,  1.23s/it, atk: -74.636 ent: -2.746 str: 0.000 loss: -77.381]Iterations:  20%|██        | 6/30 [00:07<00:29,  1.23s/it, atk: -74.636 ent: -2.746 str: 0.000 loss: -77.381]Iterations:  20%|██        | 6/30 [00:08<00:29,  1.23s/it, atk: -80.633 ent: -2.745 str: 0.000 loss: -83.378]Iterations:  23%|██▎       | 7/30 [00:09<00:30,  1.34s/it, atk: -80.633 ent: -2.745 str: 0.000 loss: -83.378]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.34s/it, atk: -86.433 ent: -2.745 str: 0.000 loss: -89.178]Iterations:  27%|██▋       | 8/30 [00:10<00:28,  1.31s/it, atk: -86.433 ent: -2.745 str: 0.000 loss: -89.178]Iterations:  27%|██▋       | 8/30 [00:11<00:28,  1.31s/it, atk: -90.507 ent: -2.744 str: 0.000 loss: -93.250]Iterations:  30%|███       | 9/30 [00:12<00:28,  1.37s/it, atk: -90.507 ent: -2.744 str: 0.000 loss: -93.250]Iterations:  30%|███       | 9/30 [00:12<00:28,  1.37s/it, atk: -94.661 ent: -2.743 str: 0.000 loss: -97.404]Iterations:  33%|███▎      | 10/30 [00:13<00:24,  1.25s/it, atk: -94.661 ent: -2.743 str: 0.000 loss: -97.404]Iterations:  33%|███▎      | 10/30 [00:13<00:24,  1.25s/it, atk: -100.536 ent: -2.743 str: 0.000 loss: -103.279]Iterations:  37%|███▋      | 11/30 [00:14<00:23,  1.22s/it, atk: -100.536 ent: -2.743 str: 0.000 loss: -103.279]Iterations:  37%|███▋      | 11/30 [00:15<00:23,  1.22s/it, atk: -106.593 ent: -2.743 str: 0.000 loss: -109.336]Iterations:  40%|████      | 12/30 [00:15<00:22,  1.28s/it, atk: -106.593 ent: -2.743 str: 0.000 loss: -109.336]Iterations:  40%|████      | 12/30 [00:16<00:22,  1.28s/it, atk: -111.064 ent: -2.743 str: 0.000 loss: -113.807]Iterations:  43%|████▎     | 13/30 [00:17<00:22,  1.33s/it, atk: -111.064 ent: -2.743 str: 0.000 loss: -113.807]Iterations:  43%|████▎     | 13/30 [00:17<00:22,  1.33s/it, atk: -115.434 ent: -2.743 str: 0.000 loss: -118.177]Iterations:  47%|████▋     | 14/30 [00:18<00:21,  1.37s/it, atk: -115.434 ent: -2.743 str: 0.000 loss: -118.177]Iterations:  47%|████▋     | 14/30 [00:19<00:21,  1.37s/it, atk: -119.220 ent: -2.742 str: 0.000 loss: -121.962]Iterations:  50%|█████     | 15/30 [00:20<00:21,  1.44s/it, atk: -119.220 ent: -2.742 str: 0.000 loss: -121.962]Iterations:  50%|█████     | 15/30 [00:21<00:21,  1.44s/it, atk: -123.211 ent: -2.741 str: 0.000 loss: -125.951]Iterations:  53%|█████▎    | 16/30 [00:21<00:21,  1.52s/it, atk: -123.211 ent: -2.741 str: 0.000 loss: -125.951]Iterations:  53%|█████▎    | 16/30 [00:22<00:21,  1.52s/it, atk: -126.692 ent: -2.740 str: 0.000 loss: -129.432]Iterations:  57%|█████▋    | 17/30 [00:23<00:20,  1.55s/it, atk: -126.692 ent: -2.740 str: 0.000 loss: -129.432]Iterations:  57%|█████▋    | 17/30 [00:24<00:20,  1.55s/it, atk: -130.567 ent: -2.739 str: 0.000 loss: -133.305]Iterations:  60%|██████    | 18/30 [00:25<00:19,  1.65s/it, atk: -130.567 ent: -2.739 str: 0.000 loss: -133.305]Iterations:  60%|██████    | 18/30 [00:26<00:19,  1.65s/it, atk: -134.674 ent: -2.738 str: 0.000 loss: -137.412]Iterations:  63%|██████▎   | 19/30 [00:27<00:18,  1.67s/it, atk: -134.674 ent: -2.738 str: 0.000 loss: -137.412]Iterations:  63%|██████▎   | 19/30 [00:28<00:18,  1.67s/it, atk: -135.892 ent: -2.736 str: 0.000 loss: -138.628]Iterations:  67%|██████▋   | 20/30 [00:28<00:16,  1.67s/it, atk: -135.892 ent: -2.736 str: 0.000 loss: -138.628]Iterations:  67%|██████▋   | 20/30 [00:29<00:16,  1.67s/it, atk: -140.314 ent: -2.736 str: 0.000 loss: -143.050]Iterations:  70%|███████   | 21/30 [00:30<00:13,  1.54s/it, atk: -140.314 ent: -2.736 str: 0.000 loss: -143.050]Iterations:  70%|███████   | 21/30 [00:30<00:13,  1.54s/it, atk: -144.468 ent: -2.735 str: 0.000 loss: -147.203]Iterations:  73%|███████▎  | 22/30 [00:31<00:11,  1.45s/it, atk: -144.468 ent: -2.735 str: 0.000 loss: -147.203]Iterations:  73%|███████▎  | 22/30 [00:32<00:11,  1.45s/it, atk: -148.312 ent: -2.735 str: 0.000 loss: -151.047]Iterations:  77%|███████▋  | 23/30 [00:32<00:09,  1.34s/it, atk: -148.312 ent: -2.735 str: 0.000 loss: -151.047]Iterations:  77%|███████▋  | 23/30 [00:33<00:09,  1.34s/it, atk: -152.109 ent: -2.734 str: 0.000 loss: -154.843]Iterations:  80%|████████  | 24/30 [00:33<00:08,  1.35s/it, atk: -152.109 ent: -2.734 str: 0.000 loss: -154.843]Iterations:  80%|████████  | 24/30 [00:34<00:08,  1.35s/it, atk: -153.606 ent: -2.733 str: 0.000 loss: -156.339]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.30s/it, atk: -153.606 ent: -2.733 str: 0.000 loss: -156.339]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.30s/it, atk: -156.809 ent: -2.733 str: 0.000 loss: -159.542]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.41s/it, atk: -156.809 ent: -2.733 str: 0.000 loss: -159.542]Iterations:  87%|████████▋ | 26/30 [00:37<00:05,  1.41s/it, atk: -160.325 ent: -2.732 str: 0.000 loss: -163.057]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.32s/it, atk: -160.325 ent: -2.732 str: 0.000 loss: -163.057]Iterations:  90%|█████████ | 27/30 [00:38<00:03,  1.32s/it, atk: -162.814 ent: -2.732 str: 0.000 loss: -165.546]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.42s/it, atk: -162.814 ent: -2.732 str: 0.000 loss: -165.546]Iterations:  93%|█████████▎| 28/30 [00:40<00:02,  1.42s/it, atk: -165.998 ent: -2.731 str: 0.000 loss: -168.729]Iterations:  97%|█████████▋| 29/30 [00:41<00:01,  1.50s/it, atk: -165.998 ent: -2.731 str: 0.000 loss: -168.729]Iterations:  97%|█████████▋| 29/30 [00:42<00:01,  1.50s/it, atk: -168.722 ent: -2.730 str: 0.000 loss: -171.452]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.49s/it, atk: -168.722 ent: -2.730 str: 0.000 loss: -171.452]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.42s/it, atk: -168.722 ent: -2.730 str: 0.000 loss: -171.452]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([923], device='cuda:0') tensor(0.8901, device='cuda:0')
after_true: tensor([965], device='cuda:0') tensor(3.7202e-08, device='cuda:0')
L1: [3125.4314]	L2: [21.888794]	Linf: [0.80784315]

Accuracy on benign examples: 100.0%
gt_label: 990 pred_label: 990 pred_clean_logit 0.4997272789478302
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.35it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  6.30it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:02,  7.07it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  7.95it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  7.81it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  7.78it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:01<00:01,  7.67it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  7.59it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  6.95it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:01,  6.79it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  7.48it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  7.68it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  7.75it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  7.77it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:02<00:00,  6.95it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:02<00:00,  6.61it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  6.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  6.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.20it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.41s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:08,  2.71s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.99s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:12<00:03,  3.31s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.20s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.09s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5361
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.114 ent: -2.475 str: 0.000 loss: -3.588]Iterations:   3%|▎         | 1/30 [00:02<01:23,  2.88s/it, atk: -1.114 ent: -2.475 str: 0.000 loss: -3.588]Iterations:   3%|▎         | 1/30 [00:03<01:23,  2.88s/it, atk: -8.149 ent: -2.474 str: 0.000 loss: -10.623]Iterations:   7%|▋         | 2/30 [00:03<00:50,  1.80s/it, atk: -8.149 ent: -2.474 str: 0.000 loss: -10.623]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.80s/it, atk: -19.665 ent: -2.479 str: 0.000 loss: -22.143]Iterations:  10%|█         | 3/30 [00:05<00:44,  1.65s/it, atk: -19.665 ent: -2.479 str: 0.000 loss: -22.143]Iterations:  10%|█         | 3/30 [00:06<00:44,  1.65s/it, atk: -25.810 ent: -2.476 str: 0.000 loss: -28.287]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.53s/it, atk: -25.810 ent: -2.476 str: 0.000 loss: -28.287]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.53s/it, atk: -37.840 ent: -2.474 str: 0.000 loss: -40.315]Iterations:  17%|█▋        | 5/30 [00:07<00:35,  1.42s/it, atk: -37.840 ent: -2.474 str: 0.000 loss: -40.315]Iterations:  17%|█▋        | 5/30 [00:08<00:35,  1.42s/it, atk: -54.038 ent: -2.467 str: 0.000 loss: -56.505]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.34s/it, atk: -54.038 ent: -2.467 str: 0.000 loss: -56.505]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.34s/it, atk: -67.561 ent: -2.464 str: 0.000 loss: -70.025]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.34s/it, atk: -67.561 ent: -2.464 str: 0.000 loss: -70.025]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.34s/it, atk: -79.962 ent: -2.462 str: 0.000 loss: -82.424]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.25s/it, atk: -79.962 ent: -2.462 str: 0.000 loss: -82.424]Iterations:  27%|██▋       | 8/30 [00:12<00:27,  1.25s/it, atk: -90.043 ent: -2.462 str: 0.000 loss: -92.505]Iterations:  30%|███       | 9/30 [00:12<00:27,  1.29s/it, atk: -90.043 ent: -2.462 str: 0.000 loss: -92.505]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.29s/it, atk: -96.009 ent: -2.463 str: 0.000 loss: -98.472]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.33s/it, atk: -96.009 ent: -2.463 str: 0.000 loss: -98.472]Iterations:  33%|███▎      | 10/30 [00:15<00:26,  1.33s/it, atk: -105.132 ent: -2.464 str: 0.000 loss: -107.596]Iterations:  37%|███▋      | 11/30 [00:15<00:25,  1.36s/it, atk: -105.132 ent: -2.464 str: 0.000 loss: -107.596]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.36s/it, atk: -113.668 ent: -2.462 str: 0.000 loss: -116.130]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.38s/it, atk: -113.668 ent: -2.462 str: 0.000 loss: -116.130]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.38s/it, atk: -123.591 ent: -2.461 str: 0.000 loss: -126.052]Iterations:  43%|████▎     | 13/30 [00:18<00:22,  1.31s/it, atk: -123.591 ent: -2.461 str: 0.000 loss: -126.052]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.31s/it, atk: -132.164 ent: -2.458 str: 0.000 loss: -134.622]Iterations:  47%|████▋     | 14/30 [00:19<00:21,  1.31s/it, atk: -132.164 ent: -2.458 str: 0.000 loss: -134.622]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.31s/it, atk: -141.300 ent: -2.456 str: 0.000 loss: -143.756]Iterations:  50%|█████     | 15/30 [00:20<00:19,  1.29s/it, atk: -141.300 ent: -2.456 str: 0.000 loss: -143.756]Iterations:  50%|█████     | 15/30 [00:21<00:19,  1.29s/it, atk: -151.601 ent: -2.454 str: 0.000 loss: -154.055]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.26s/it, atk: -151.601 ent: -2.454 str: 0.000 loss: -154.055]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.26s/it, atk: -158.970 ent: -2.452 str: 0.000 loss: -161.423]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.28s/it, atk: -158.970 ent: -2.452 str: 0.000 loss: -161.423]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.28s/it, atk: -166.034 ent: -2.452 str: 0.000 loss: -168.486]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.33s/it, atk: -166.034 ent: -2.452 str: 0.000 loss: -168.486]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.33s/it, atk: -171.725 ent: -2.452 str: 0.000 loss: -174.177]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.24s/it, atk: -171.725 ent: -2.452 str: 0.000 loss: -174.177]Iterations:  63%|██████▎   | 19/30 [00:26<00:13,  1.24s/it, atk: -176.858 ent: -2.451 str: 0.000 loss: -179.310]Iterations:  67%|██████▋   | 20/30 [00:26<00:11,  1.17s/it, atk: -176.858 ent: -2.451 str: 0.000 loss: -179.310]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.17s/it, atk: -182.379 ent: -2.450 str: 0.000 loss: -184.829]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.14s/it, atk: -182.379 ent: -2.450 str: 0.000 loss: -184.829]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.14s/it, atk: -187.382 ent: -2.449 str: 0.000 loss: -189.831]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.23s/it, atk: -187.382 ent: -2.449 str: 0.000 loss: -189.831]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.23s/it, atk: -192.494 ent: -2.448 str: 0.000 loss: -194.942]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.15s/it, atk: -192.494 ent: -2.448 str: 0.000 loss: -194.942]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.15s/it, atk: -196.400 ent: -2.447 str: 0.000 loss: -198.848]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.11s/it, atk: -196.400 ent: -2.447 str: 0.000 loss: -198.848]Iterations:  80%|████████  | 24/30 [00:32<00:06,  1.11s/it, atk: -200.972 ent: -2.447 str: 0.000 loss: -203.419]Iterations:  83%|████████▎ | 25/30 [00:32<00:05,  1.19s/it, atk: -200.972 ent: -2.447 str: 0.000 loss: -203.419]Iterations:  83%|████████▎ | 25/30 [00:33<00:05,  1.19s/it, atk: -204.527 ent: -2.447 str: 0.000 loss: -206.974]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.14s/it, atk: -204.527 ent: -2.447 str: 0.000 loss: -206.974]Iterations:  87%|████████▋ | 26/30 [00:34<00:04,  1.14s/it, atk: -208.489 ent: -2.447 str: 0.000 loss: -210.936]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.24s/it, atk: -208.489 ent: -2.447 str: 0.000 loss: -210.936]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.24s/it, atk: -212.565 ent: -2.447 str: 0.000 loss: -215.012]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.24s/it, atk: -212.565 ent: -2.447 str: 0.000 loss: -215.012]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.24s/it, atk: -216.540 ent: -2.447 str: 0.000 loss: -218.987]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.34s/it, atk: -216.540 ent: -2.447 str: 0.000 loss: -218.987]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.34s/it, atk: -220.428 ent: -2.448 str: 0.000 loss: -222.876]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.32s/it, atk: -220.428 ent: -2.448 str: 0.000 loss: -222.876]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.31s/it, atk: -220.428 ent: -2.448 str: 0.000 loss: -222.876]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([988], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([990], device='cuda:0') tensor(1.9183e-10, device='cuda:0')
L1: [2989.361]	L2: [19.36129]	Linf: [0.5294118]

Accuracy on benign examples: 100.0%
gt_label: 858 pred_label: 858 pred_clean_logit 0.9927694797515869
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.64it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  7.75it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.50it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.71it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:00,  9.95it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  8.77it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  8.54it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.65it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.37it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  8.36it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  8.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.78it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.27s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:08,  2.72s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.71s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:03,  3.08s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.29s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.06s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4905
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.242 ent: -4.920 str: 0.000 loss: -5.162]Iterations:   3%|▎         | 1/30 [00:02<01:16,  2.64s/it, atk: -0.242 ent: -4.920 str: 0.000 loss: -5.162]Iterations:   3%|▎         | 1/30 [00:03<01:16,  2.64s/it, atk: -0.570 ent: -4.926 str: 0.000 loss: -5.496]Iterations:   7%|▋         | 2/30 [00:04<00:54,  1.94s/it, atk: -0.570 ent: -4.926 str: 0.000 loss: -5.496]Iterations:   7%|▋         | 2/30 [00:05<00:54,  1.94s/it, atk: -2.028 ent: -4.924 str: 0.000 loss: -6.952]Iterations:  10%|█         | 3/30 [00:05<00:49,  1.84s/it, atk: -2.028 ent: -4.924 str: 0.000 loss: -6.952]Iterations:  10%|█         | 3/30 [00:06<00:49,  1.84s/it, atk: -3.588 ent: -4.920 str: 0.000 loss: -8.507]Iterations:  13%|█▎        | 4/30 [00:07<00:44,  1.73s/it, atk: -3.588 ent: -4.920 str: 0.000 loss: -8.507]Iterations:  13%|█▎        | 4/30 [00:08<00:44,  1.73s/it, atk: -5.871 ent: -4.917 str: 0.000 loss: -10.788]Iterations:  17%|█▋        | 5/30 [00:08<00:40,  1.64s/it, atk: -5.871 ent: -4.917 str: 0.000 loss: -10.788]Iterations:  17%|█▋        | 5/30 [00:09<00:40,  1.64s/it, atk: -11.624 ent: -4.916 str: 0.000 loss: -16.540]Iterations:  20%|██        | 6/30 [00:09<00:34,  1.45s/it, atk: -11.624 ent: -4.916 str: 0.000 loss: -16.540]Iterations:  20%|██        | 6/30 [00:10<00:34,  1.45s/it, atk: -15.265 ent: -4.918 str: 0.000 loss: -20.183]Iterations:  23%|██▎       | 7/30 [00:11<00:33,  1.45s/it, atk: -15.265 ent: -4.918 str: 0.000 loss: -20.183]Iterations:  23%|██▎       | 7/30 [00:11<00:33,  1.45s/it, atk: -19.258 ent: -4.920 str: 0.000 loss: -24.178]Iterations:  27%|██▋       | 8/30 [00:12<00:28,  1.31s/it, atk: -19.258 ent: -4.920 str: 0.000 loss: -24.178]Iterations:  27%|██▋       | 8/30 [00:13<00:28,  1.31s/it, atk: -23.595 ent: -4.919 str: 0.000 loss: -28.515]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.30s/it, atk: -23.595 ent: -4.919 str: 0.000 loss: -28.515]Iterations:  30%|███       | 9/30 [00:14<00:27,  1.30s/it, atk: -28.191 ent: -4.919 str: 0.000 loss: -33.110]Iterations:  33%|███▎      | 10/30 [00:14<00:25,  1.29s/it, atk: -28.191 ent: -4.919 str: 0.000 loss: -33.110]Iterations:  33%|███▎      | 10/30 [00:15<00:25,  1.29s/it, atk: -32.916 ent: -4.919 str: 0.000 loss: -37.835]Iterations:  37%|███▋      | 11/30 [00:16<00:26,  1.38s/it, atk: -32.916 ent: -4.919 str: 0.000 loss: -37.835]Iterations:  37%|███▋      | 11/30 [00:17<00:26,  1.38s/it, atk: -37.636 ent: -4.919 str: 0.000 loss: -42.555]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.36s/it, atk: -37.636 ent: -4.919 str: 0.000 loss: -42.555]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.36s/it, atk: -41.136 ent: -4.920 str: 0.000 loss: -46.055]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.32s/it, atk: -41.136 ent: -4.920 str: 0.000 loss: -46.055]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.32s/it, atk: -45.710 ent: -4.918 str: 0.000 loss: -50.628]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.36s/it, atk: -45.710 ent: -4.918 str: 0.000 loss: -50.628]Iterations:  47%|████▋     | 14/30 [00:21<00:21,  1.36s/it, atk: -49.829 ent: -4.917 str: 0.000 loss: -54.746]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.40s/it, atk: -49.829 ent: -4.917 str: 0.000 loss: -54.746]Iterations:  50%|█████     | 15/30 [00:22<00:20,  1.40s/it, atk: -53.896 ent: -4.917 str: 0.000 loss: -58.813]Iterations:  53%|█████▎    | 16/30 [00:23<00:19,  1.38s/it, atk: -53.896 ent: -4.917 str: 0.000 loss: -58.813]Iterations:  53%|█████▎    | 16/30 [00:24<00:19,  1.38s/it, atk: -57.586 ent: -4.917 str: 0.000 loss: -62.503]Iterations:  57%|█████▋    | 17/30 [00:24<00:17,  1.38s/it, atk: -57.586 ent: -4.917 str: 0.000 loss: -62.503]Iterations:  57%|█████▋    | 17/30 [00:25<00:17,  1.38s/it, atk: -60.881 ent: -4.916 str: 0.000 loss: -65.797]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.31s/it, atk: -60.881 ent: -4.916 str: 0.000 loss: -65.797]Iterations:  60%|██████    | 18/30 [00:26<00:15,  1.31s/it, atk: -64.254 ent: -4.916 str: 0.000 loss: -69.170]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.35s/it, atk: -64.254 ent: -4.916 str: 0.000 loss: -69.170]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.35s/it, atk: -68.099 ent: -4.915 str: 0.000 loss: -73.014]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.33s/it, atk: -68.099 ent: -4.915 str: 0.000 loss: -73.014]Iterations:  67%|██████▋   | 20/30 [00:29<00:13,  1.33s/it, atk: -70.962 ent: -4.913 str: 0.000 loss: -75.875]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.30s/it, atk: -70.962 ent: -4.913 str: 0.000 loss: -75.875]Iterations:  70%|███████   | 21/30 [00:30<00:11,  1.30s/it, atk: -73.925 ent: -4.913 str: 0.000 loss: -78.839]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.18s/it, atk: -73.925 ent: -4.913 str: 0.000 loss: -78.839]Iterations:  73%|███████▎  | 22/30 [00:31<00:09,  1.18s/it, atk: -77.028 ent: -4.913 str: 0.000 loss: -81.940]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.22s/it, atk: -77.028 ent: -4.913 str: 0.000 loss: -81.940]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.22s/it, atk: -79.089 ent: -4.912 str: 0.000 loss: -84.001]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.18s/it, atk: -79.089 ent: -4.912 str: 0.000 loss: -84.001]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.18s/it, atk: -81.695 ent: -4.913 str: 0.000 loss: -86.608]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.27s/it, atk: -81.695 ent: -4.913 str: 0.000 loss: -86.608]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.27s/it, atk: -84.228 ent: -4.914 str: 0.000 loss: -89.142]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.35s/it, atk: -84.228 ent: -4.914 str: 0.000 loss: -89.142]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.35s/it, atk: -86.795 ent: -4.914 str: 0.000 loss: -91.708]Iterations:  90%|█████████ | 27/30 [00:37<00:04,  1.38s/it, atk: -86.795 ent: -4.914 str: 0.000 loss: -91.708]Iterations:  90%|█████████ | 27/30 [00:38<00:04,  1.38s/it, atk: -89.765 ent: -4.913 str: 0.000 loss: -94.677]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.37s/it, atk: -89.765 ent: -4.913 str: 0.000 loss: -94.677]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.37s/it, atk: -92.000 ent: -4.912 str: 0.000 loss: -96.911]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.25s/it, atk: -92.000 ent: -4.912 str: 0.000 loss: -96.911]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.25s/it, atk: -94.219 ent: -4.912 str: 0.000 loss: -99.130]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.32s/it, atk: -94.219 ent: -4.912 str: 0.000 loss: -99.130]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.38s/it, atk: -94.219 ent: -4.912 str: 0.000 loss: -99.130]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([663], device='cuda:0') tensor(0.9974, device='cuda:0')
after_true: tensor([858], device='cuda:0') tensor(6.6172e-05, device='cuda:0')
L1: [3860.9602]	L2: [25.909054]	Linf: [0.8784314]

Accuracy on benign examples: 100.0%
gt_label: 517 pred_label: 517 pred_clean_logit 0.4300944209098816
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.59it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.34it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.07it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01, 10.38it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:00,  9.14it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  8.86it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.28it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  9.14it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.45it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.16it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  7.55it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  7.49it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.84it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.40s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:07,  2.64s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.86s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.96s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.85s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4408
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.223 ent: -2.612 str: 0.000 loss: -5.835]Iterations:   3%|▎         | 1/30 [00:02<01:20,  2.78s/it, atk: -3.223 ent: -2.612 str: 0.000 loss: -5.835]Iterations:   3%|▎         | 1/30 [00:03<01:20,  2.78s/it, atk: -6.328 ent: -2.604 str: 0.000 loss: -8.932]Iterations:   7%|▋         | 2/30 [00:03<00:50,  1.82s/it, atk: -6.328 ent: -2.604 str: 0.000 loss: -8.932]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.82s/it, atk: -11.449 ent: -2.599 str: 0.000 loss: -14.049]Iterations:  10%|█         | 3/30 [00:05<00:47,  1.75s/it, atk: -11.449 ent: -2.599 str: 0.000 loss: -14.049]Iterations:  10%|█         | 3/30 [00:06<00:47,  1.75s/it, atk: -19.522 ent: -2.602 str: 0.000 loss: -22.124]Iterations:  13%|█▎        | 4/30 [00:06<00:41,  1.58s/it, atk: -19.522 ent: -2.602 str: 0.000 loss: -22.124]Iterations:  13%|█▎        | 4/30 [00:07<00:41,  1.58s/it, atk: -20.613 ent: -2.605 str: 0.000 loss: -23.218]Iterations:  17%|█▋        | 5/30 [00:08<00:35,  1.42s/it, atk: -20.613 ent: -2.605 str: 0.000 loss: -23.218]Iterations:  17%|█▋        | 5/30 [00:08<00:35,  1.42s/it, atk: -27.893 ent: -2.606 str: 0.000 loss: -30.498]Iterations:  20%|██        | 6/30 [00:09<00:33,  1.39s/it, atk: -27.893 ent: -2.606 str: 0.000 loss: -30.498]Iterations:  20%|██        | 6/30 [00:09<00:33,  1.39s/it, atk: -33.312 ent: -2.607 str: 0.000 loss: -35.920]Iterations:  23%|██▎       | 7/30 [00:10<00:29,  1.29s/it, atk: -33.312 ent: -2.607 str: 0.000 loss: -35.920]Iterations:  23%|██▎       | 7/30 [00:11<00:29,  1.29s/it, atk: -43.038 ent: -2.608 str: 0.000 loss: -45.646]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.26s/it, atk: -43.038 ent: -2.608 str: 0.000 loss: -45.646]Iterations:  27%|██▋       | 8/30 [00:12<00:27,  1.26s/it, atk: -47.728 ent: -2.608 str: 0.000 loss: -50.336]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.34s/it, atk: -47.728 ent: -2.608 str: 0.000 loss: -50.336]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.34s/it, atk: -57.680 ent: -2.605 str: 0.000 loss: -60.284]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.33s/it, atk: -57.680 ent: -2.605 str: 0.000 loss: -60.284]Iterations:  33%|███▎      | 10/30 [00:15<00:26,  1.33s/it, atk: -66.174 ent: -2.605 str: 0.000 loss: -68.779]Iterations:  37%|███▋      | 11/30 [00:15<00:25,  1.32s/it, atk: -66.174 ent: -2.605 str: 0.000 loss: -68.779]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.32s/it, atk: -75.541 ent: -2.605 str: 0.000 loss: -78.146]Iterations:  40%|████      | 12/30 [00:16<00:22,  1.24s/it, atk: -75.541 ent: -2.605 str: 0.000 loss: -78.146]Iterations:  40%|████      | 12/30 [00:17<00:22,  1.24s/it, atk: -85.796 ent: -2.607 str: 0.000 loss: -88.403]Iterations:  43%|████▎     | 13/30 [00:18<00:22,  1.33s/it, atk: -85.796 ent: -2.607 str: 0.000 loss: -88.403]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.33s/it, atk: -94.679 ent: -2.606 str: 0.000 loss: -97.285]Iterations:  47%|████▋     | 14/30 [00:19<00:21,  1.36s/it, atk: -94.679 ent: -2.606 str: 0.000 loss: -97.285]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.36s/it, atk: -104.512 ent: -2.605 str: 0.000 loss: -107.118]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.36s/it, atk: -104.512 ent: -2.605 str: 0.000 loss: -107.118]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.36s/it, atk: -110.447 ent: -2.606 str: 0.000 loss: -113.053]Iterations:  53%|█████▎    | 16/30 [00:22<00:19,  1.39s/it, atk: -110.447 ent: -2.606 str: 0.000 loss: -113.053]Iterations:  53%|█████▎    | 16/30 [00:23<00:19,  1.39s/it, atk: -114.973 ent: -2.605 str: 0.000 loss: -117.579]Iterations:  57%|█████▋    | 17/30 [00:24<00:18,  1.44s/it, atk: -114.973 ent: -2.605 str: 0.000 loss: -117.579]Iterations:  57%|█████▋    | 17/30 [00:24<00:18,  1.44s/it, atk: -123.393 ent: -2.607 str: 0.000 loss: -126.000]Iterations:  60%|██████    | 18/30 [00:25<00:16,  1.41s/it, atk: -123.393 ent: -2.607 str: 0.000 loss: -126.000]Iterations:  60%|██████    | 18/30 [00:26<00:16,  1.41s/it, atk: -131.174 ent: -2.609 str: 0.000 loss: -133.783]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.33s/it, atk: -131.174 ent: -2.609 str: 0.000 loss: -133.783]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.33s/it, atk: -136.931 ent: -2.609 str: 0.000 loss: -139.541]Iterations:  67%|██████▋   | 20/30 [00:27<00:13,  1.33s/it, atk: -136.931 ent: -2.609 str: 0.000 loss: -139.541]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.33s/it, atk: -145.284 ent: -2.608 str: 0.000 loss: -147.892]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.19s/it, atk: -145.284 ent: -2.608 str: 0.000 loss: -147.892]Iterations:  70%|███████   | 21/30 [00:29<00:10,  1.19s/it, atk: -151.495 ent: -2.605 str: 0.000 loss: -154.100]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.21s/it, atk: -151.495 ent: -2.605 str: 0.000 loss: -154.100]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.21s/it, atk: -158.347 ent: -2.605 str: 0.000 loss: -160.952]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.18s/it, atk: -158.347 ent: -2.605 str: 0.000 loss: -160.952]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.18s/it, atk: -164.829 ent: -2.604 str: 0.000 loss: -167.433]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.26s/it, atk: -164.829 ent: -2.604 str: 0.000 loss: -167.433]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.26s/it, atk: -170.912 ent: -2.603 str: 0.000 loss: -173.515]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.28s/it, atk: -170.912 ent: -2.603 str: 0.000 loss: -173.515]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.28s/it, atk: -175.974 ent: -2.602 str: 0.000 loss: -178.576]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.32s/it, atk: -175.974 ent: -2.602 str: 0.000 loss: -178.576]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.32s/it, atk: -182.875 ent: -2.601 str: 0.000 loss: -185.475]Iterations:  90%|█████████ | 27/30 [00:36<00:04,  1.35s/it, atk: -182.875 ent: -2.601 str: 0.000 loss: -185.475]Iterations:  90%|█████████ | 27/30 [00:37<00:04,  1.35s/it, atk: -187.666 ent: -2.600 str: 0.000 loss: -190.266]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.27s/it, atk: -187.666 ent: -2.600 str: 0.000 loss: -190.266]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.27s/it, atk: -193.107 ent: -2.599 str: 0.000 loss: -195.706]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.30s/it, atk: -193.107 ent: -2.599 str: 0.000 loss: -195.706]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.30s/it, atk: -198.294 ent: -2.598 str: 0.000 loss: -200.892]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.28s/it, atk: -198.294 ent: -2.598 str: 0.000 loss: -200.892]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.35s/it, atk: -198.294 ent: -2.598 str: 0.000 loss: -200.892]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([403], device='cuda:0') tensor(0.9951, device='cuda:0')
after_true: tensor([517], device='cuda:0') tensor(1.5156e-09, device='cuda:0')
L1: [2912.4116]	L2: [20.352505]	Linf: [0.8]

Accuracy on benign examples: 100.0%
gt_label: 814 pred_label: 814 pred_clean_logit 0.998782217502594
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.38it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.74it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.75it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.86it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  9.04it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  8.06it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  8.37it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  8.69it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  8.03it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  8.34it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  7.88it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.74it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.70it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  9.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.08it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.73it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.29s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.44s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.83s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.85s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.80s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.75s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6203
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.011 ent: -5.680 str: 0.000 loss: -5.690]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.34s/it, atk: -0.011 ent: -5.680 str: 0.000 loss: -5.690]Iterations:   3%|▎         | 1/30 [00:03<01:07,  2.34s/it, atk: -0.031 ent: -5.706 str: 0.000 loss: -5.737]Iterations:   7%|▋         | 2/30 [00:03<00:49,  1.77s/it, atk: -0.031 ent: -5.706 str: 0.000 loss: -5.737]Iterations:   7%|▋         | 2/30 [00:04<00:49,  1.77s/it, atk: -0.071 ent: -5.723 str: 0.000 loss: -5.793]Iterations:  10%|█         | 3/30 [00:04<00:41,  1.52s/it, atk: -0.071 ent: -5.723 str: 0.000 loss: -5.793]Iterations:  10%|█         | 3/30 [00:05<00:41,  1.52s/it, atk: -0.188 ent: -5.731 str: 0.000 loss: -5.919]Iterations:  13%|█▎        | 4/30 [00:06<00:38,  1.48s/it, atk: -0.188 ent: -5.731 str: 0.000 loss: -5.919]Iterations:  13%|█▎        | 4/30 [00:06<00:38,  1.48s/it, atk: -0.455 ent: -5.735 str: 0.000 loss: -6.190]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -0.455 ent: -5.735 str: 0.000 loss: -6.190]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -1.195 ent: -5.736 str: 0.000 loss: -6.931]Iterations:  20%|██        | 6/30 [00:08<00:29,  1.24s/it, atk: -1.195 ent: -5.736 str: 0.000 loss: -6.931]Iterations:  20%|██        | 6/30 [00:09<00:29,  1.24s/it, atk: -2.556 ent: -5.735 str: 0.000 loss: -8.291]Iterations:  23%|██▎       | 7/30 [00:09<00:28,  1.23s/it, atk: -2.556 ent: -5.735 str: 0.000 loss: -8.291]Iterations:  23%|██▎       | 7/30 [00:10<00:28,  1.23s/it, atk: -4.454 ent: -5.737 str: 0.000 loss: -10.191]Iterations:  27%|██▋       | 8/30 [00:10<00:25,  1.17s/it, atk: -4.454 ent: -5.737 str: 0.000 loss: -10.191]Iterations:  27%|██▋       | 8/30 [00:11<00:25,  1.17s/it, atk: -5.591 ent: -5.731 str: 0.000 loss: -11.322]Iterations:  30%|███       | 9/30 [00:11<00:24,  1.18s/it, atk: -5.591 ent: -5.731 str: 0.000 loss: -11.322]Iterations:  30%|███       | 9/30 [00:12<00:24,  1.18s/it, atk: -5.906 ent: -5.726 str: 0.000 loss: -11.633]Iterations:  33%|███▎      | 10/30 [00:13<00:25,  1.25s/it, atk: -5.906 ent: -5.726 str: 0.000 loss: -11.633]Iterations:  33%|███▎      | 10/30 [00:14<00:25,  1.25s/it, atk: -8.145 ent: -5.725 str: 0.000 loss: -13.871]Iterations:  37%|███▋      | 11/30 [00:14<00:24,  1.30s/it, atk: -8.145 ent: -5.725 str: 0.000 loss: -13.871]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.30s/it, atk: -10.236 ent: -5.725 str: 0.000 loss: -15.961]Iterations:  40%|████      | 12/30 [00:16<00:23,  1.29s/it, atk: -10.236 ent: -5.725 str: 0.000 loss: -15.961]Iterations:  40%|████      | 12/30 [00:16<00:23,  1.29s/it, atk: -12.328 ent: -5.725 str: 0.000 loss: -18.052]Iterations:  43%|████▎     | 13/30 [00:17<00:20,  1.22s/it, atk: -12.328 ent: -5.725 str: 0.000 loss: -18.052]Iterations:  43%|████▎     | 13/30 [00:17<00:20,  1.22s/it, atk: -14.319 ent: -5.723 str: 0.000 loss: -20.042]Iterations:  47%|████▋     | 14/30 [00:18<00:20,  1.27s/it, atk: -14.319 ent: -5.723 str: 0.000 loss: -20.042]Iterations:  47%|████▋     | 14/30 [00:19<00:20,  1.27s/it, atk: -16.796 ent: -5.723 str: 0.000 loss: -22.518]Iterations:  50%|█████     | 15/30 [00:19<00:19,  1.31s/it, atk: -16.796 ent: -5.723 str: 0.000 loss: -22.518]Iterations:  50%|█████     | 15/30 [00:20<00:19,  1.31s/it, atk: -19.951 ent: -5.722 str: 0.000 loss: -25.674]Iterations:  53%|█████▎    | 16/30 [00:21<00:19,  1.38s/it, atk: -19.951 ent: -5.722 str: 0.000 loss: -25.674]Iterations:  53%|█████▎    | 16/30 [00:22<00:19,  1.38s/it, atk: -23.572 ent: -5.722 str: 0.000 loss: -29.295]Iterations:  57%|█████▋    | 17/30 [00:23<00:18,  1.44s/it, atk: -23.572 ent: -5.722 str: 0.000 loss: -29.295]Iterations:  57%|█████▋    | 17/30 [00:23<00:18,  1.44s/it, atk: -27.191 ent: -5.722 str: 0.000 loss: -32.913]Iterations:  60%|██████    | 18/30 [00:24<00:16,  1.39s/it, atk: -27.191 ent: -5.722 str: 0.000 loss: -32.913]Iterations:  60%|██████    | 18/30 [00:25<00:16,  1.39s/it, atk: -30.447 ent: -5.723 str: 0.000 loss: -36.169]Iterations:  63%|██████▎   | 19/30 [00:25<00:16,  1.47s/it, atk: -30.447 ent: -5.723 str: 0.000 loss: -36.169]Iterations:  63%|██████▎   | 19/30 [00:26<00:16,  1.47s/it, atk: -33.318 ent: -5.723 str: 0.000 loss: -39.041]Iterations:  67%|██████▋   | 20/30 [00:27<00:14,  1.41s/it, atk: -33.318 ent: -5.723 str: 0.000 loss: -39.041]Iterations:  67%|██████▋   | 20/30 [00:28<00:14,  1.41s/it, atk: -37.013 ent: -5.723 str: 0.000 loss: -42.736]Iterations:  70%|███████   | 21/30 [00:28<00:13,  1.45s/it, atk: -37.013 ent: -5.723 str: 0.000 loss: -42.736]Iterations:  70%|███████   | 21/30 [00:29<00:13,  1.45s/it, atk: -40.305 ent: -5.724 str: 0.000 loss: -46.029]Iterations:  73%|███████▎  | 22/30 [00:29<00:10,  1.30s/it, atk: -40.305 ent: -5.724 str: 0.000 loss: -46.029]Iterations:  73%|███████▎  | 22/30 [00:30<00:10,  1.30s/it, atk: -43.388 ent: -5.725 str: 0.000 loss: -49.112]Iterations:  77%|███████▋  | 23/30 [00:31<00:09,  1.30s/it, atk: -43.388 ent: -5.725 str: 0.000 loss: -49.112]Iterations:  77%|███████▋  | 23/30 [00:31<00:09,  1.30s/it, atk: -47.220 ent: -5.725 str: 0.000 loss: -52.944]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.26s/it, atk: -47.220 ent: -5.725 str: 0.000 loss: -52.944]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.26s/it, atk: -50.918 ent: -5.724 str: 0.000 loss: -56.642]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.37s/it, atk: -50.918 ent: -5.724 str: 0.000 loss: -56.642]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.37s/it, atk: -54.187 ent: -5.725 str: 0.000 loss: -59.911]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.49s/it, atk: -54.187 ent: -5.725 str: 0.000 loss: -59.911]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.49s/it, atk: -58.027 ent: -5.725 str: 0.000 loss: -63.752]Iterations:  90%|█████████ | 27/30 [00:36<00:04,  1.42s/it, atk: -58.027 ent: -5.725 str: 0.000 loss: -63.752]Iterations:  90%|█████████ | 27/30 [00:37<00:04,  1.42s/it, atk: -59.211 ent: -5.724 str: 0.000 loss: -64.934]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.36s/it, atk: -59.211 ent: -5.724 str: 0.000 loss: -64.934]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.36s/it, atk: -63.483 ent: -5.725 str: 0.000 loss: -69.208]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.46s/it, atk: -63.483 ent: -5.725 str: 0.000 loss: -69.208]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.46s/it, atk: -66.149 ent: -5.727 str: 0.000 loss: -71.876]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.33s/it, atk: -66.149 ent: -5.727 str: 0.000 loss: -71.876]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.36s/it, atk: -66.149 ent: -5.727 str: 0.000 loss: -71.876]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([817], device='cuda:0') tensor(0.6362, device='cuda:0')
after_true: tensor([814], device='cuda:0') tensor(0.0011, device='cuda:0')
L1: [2153.047]	L2: [17.107483]	Linf: [0.7921569]

Accuracy on benign examples: 100.0%
gt_label: 760 pred_label: 760 pred_clean_logit 0.9980649352073669
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.35it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  7.04it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:02,  7.10it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:02,  7.25it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  7.18it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  7.06it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  6.86it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  8.36it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  7.37it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:01,  7.05it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  7.37it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  7.03it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  7.67it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:02<00:00,  8.74it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:02<00:00,  8.73it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  8.26it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.69it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.63it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:08,  2.78s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.70s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.99s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.96s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.89s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5067
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.019 ent: -2.721 str: 0.000 loss: -2.740]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.38s/it, atk: -0.019 ent: -2.721 str: 0.000 loss: -2.740]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.38s/it, atk: -0.079 ent: -2.748 str: 0.000 loss: -2.827]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.64s/it, atk: -0.079 ent: -2.748 str: 0.000 loss: -2.827]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.64s/it, atk: -0.260 ent: -2.761 str: 0.000 loss: -3.021]Iterations:  10%|█         | 3/30 [00:04<00:40,  1.49s/it, atk: -0.260 ent: -2.761 str: 0.000 loss: -3.021]Iterations:  10%|█         | 3/30 [00:05<00:40,  1.49s/it, atk: -0.765 ent: -2.765 str: 0.000 loss: -3.530]Iterations:  13%|█▎        | 4/30 [00:06<00:37,  1.43s/it, atk: -0.765 ent: -2.765 str: 0.000 loss: -3.530]Iterations:  13%|█▎        | 4/30 [00:06<00:37,  1.43s/it, atk: -1.778 ent: -2.767 str: 0.000 loss: -4.546]Iterations:  17%|█▋        | 5/30 [00:07<00:32,  1.30s/it, atk: -1.778 ent: -2.767 str: 0.000 loss: -4.546]Iterations:  17%|█▋        | 5/30 [00:07<00:32,  1.30s/it, atk: -2.801 ent: -2.765 str: 0.000 loss: -5.566]Iterations:  20%|██        | 6/30 [00:08<00:31,  1.32s/it, atk: -2.801 ent: -2.765 str: 0.000 loss: -5.566]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.32s/it, atk: -5.639 ent: -2.766 str: 0.000 loss: -8.405]Iterations:  23%|██▎       | 7/30 [00:09<00:27,  1.19s/it, atk: -5.639 ent: -2.766 str: 0.000 loss: -8.405]Iterations:  23%|██▎       | 7/30 [00:10<00:27,  1.19s/it, atk: -8.487 ent: -2.767 str: 0.000 loss: -11.254]Iterations:  27%|██▋       | 8/30 [00:10<00:24,  1.12s/it, atk: -8.487 ent: -2.767 str: 0.000 loss: -11.254]Iterations:  27%|██▋       | 8/30 [00:11<00:24,  1.12s/it, atk: -12.044 ent: -2.768 str: 0.000 loss: -14.812]Iterations:  30%|███       | 9/30 [00:12<00:26,  1.25s/it, atk: -12.044 ent: -2.768 str: 0.000 loss: -14.812]Iterations:  30%|███       | 9/30 [00:12<00:26,  1.25s/it, atk: -16.465 ent: -2.767 str: 0.000 loss: -19.233]Iterations:  33%|███▎      | 10/30 [00:13<00:25,  1.27s/it, atk: -16.465 ent: -2.767 str: 0.000 loss: -19.233]Iterations:  33%|███▎      | 10/30 [00:14<00:25,  1.27s/it, atk: -20.817 ent: -2.765 str: 0.000 loss: -23.583]Iterations:  37%|███▋      | 11/30 [00:14<00:24,  1.27s/it, atk: -20.817 ent: -2.765 str: 0.000 loss: -23.583]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.27s/it, atk: -24.765 ent: -2.764 str: 0.000 loss: -27.529]Iterations:  40%|████      | 12/30 [00:15<00:23,  1.28s/it, atk: -24.765 ent: -2.764 str: 0.000 loss: -27.529]Iterations:  40%|████      | 12/30 [00:16<00:23,  1.28s/it, atk: -28.690 ent: -2.762 str: 0.000 loss: -31.452]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.25s/it, atk: -28.690 ent: -2.762 str: 0.000 loss: -31.452]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.25s/it, atk: -33.498 ent: -2.760 str: 0.000 loss: -36.258]Iterations:  47%|████▋     | 14/30 [00:18<00:20,  1.28s/it, atk: -33.498 ent: -2.760 str: 0.000 loss: -36.258]Iterations:  47%|████▋     | 14/30 [00:19<00:20,  1.28s/it, atk: -37.054 ent: -2.759 str: 0.000 loss: -39.812]Iterations:  50%|█████     | 15/30 [00:19<00:20,  1.34s/it, atk: -37.054 ent: -2.759 str: 0.000 loss: -39.812]Iterations:  50%|█████     | 15/30 [00:20<00:20,  1.34s/it, atk: -41.068 ent: -2.757 str: 0.000 loss: -43.825]Iterations:  53%|█████▎    | 16/30 [00:21<00:18,  1.30s/it, atk: -41.068 ent: -2.757 str: 0.000 loss: -43.825]Iterations:  53%|█████▎    | 16/30 [00:21<00:18,  1.30s/it, atk: -44.794 ent: -2.755 str: 0.000 loss: -47.549]Iterations:  57%|█████▋    | 17/30 [00:22<00:16,  1.28s/it, atk: -44.794 ent: -2.755 str: 0.000 loss: -47.549]Iterations:  57%|█████▋    | 17/30 [00:22<00:16,  1.28s/it, atk: -47.984 ent: -2.752 str: 0.000 loss: -50.736]Iterations:  60%|██████    | 18/30 [00:23<00:15,  1.26s/it, atk: -47.984 ent: -2.752 str: 0.000 loss: -50.736]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.26s/it, atk: -50.093 ent: -2.751 str: 0.000 loss: -52.845]Iterations:  63%|██████▎   | 19/30 [00:24<00:13,  1.27s/it, atk: -50.093 ent: -2.751 str: 0.000 loss: -52.845]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.27s/it, atk: -53.579 ent: -2.751 str: 0.000 loss: -56.330]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.24s/it, atk: -53.579 ent: -2.751 str: 0.000 loss: -56.330]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.24s/it, atk: -56.261 ent: -2.751 str: 0.000 loss: -59.012]Iterations:  70%|███████   | 21/30 [00:27<00:11,  1.28s/it, atk: -56.261 ent: -2.751 str: 0.000 loss: -59.012]Iterations:  70%|███████   | 21/30 [00:27<00:11,  1.28s/it, atk: -58.174 ent: -2.750 str: 0.000 loss: -60.924]Iterations:  73%|███████▎  | 22/30 [00:28<00:09,  1.24s/it, atk: -58.174 ent: -2.750 str: 0.000 loss: -60.924]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.24s/it, atk: -60.658 ent: -2.749 str: 0.000 loss: -63.407]Iterations:  77%|███████▋  | 23/30 [00:29<00:08,  1.20s/it, atk: -60.658 ent: -2.749 str: 0.000 loss: -63.407]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.20s/it, atk: -62.599 ent: -2.749 str: 0.000 loss: -65.349]Iterations:  80%|████████  | 24/30 [00:30<00:06,  1.13s/it, atk: -62.599 ent: -2.749 str: 0.000 loss: -65.349]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.13s/it, atk: -64.236 ent: -2.750 str: 0.000 loss: -66.986]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.23s/it, atk: -64.236 ent: -2.750 str: 0.000 loss: -66.986]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.23s/it, atk: -65.977 ent: -2.750 str: 0.000 loss: -68.727]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.22s/it, atk: -65.977 ent: -2.750 str: 0.000 loss: -68.727]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.22s/it, atk: -67.982 ent: -2.750 str: 0.000 loss: -70.732]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.21s/it, atk: -67.982 ent: -2.750 str: 0.000 loss: -70.732]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.21s/it, atk: -69.718 ent: -2.751 str: 0.000 loss: -72.468]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.25s/it, atk: -69.718 ent: -2.751 str: 0.000 loss: -72.468]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.25s/it, atk: -71.524 ent: -2.750 str: 0.000 loss: -74.274]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.26s/it, atk: -71.524 ent: -2.750 str: 0.000 loss: -74.274]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.26s/it, atk: -72.972 ent: -2.749 str: 0.000 loss: -75.721]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.21s/it, atk: -72.972 ent: -2.749 str: 0.000 loss: -75.721]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.27s/it, atk: -72.972 ent: -2.749 str: 0.000 loss: -75.721]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([886], device='cuda:0') tensor(0.9988, device='cuda:0')
after_true: tensor([760], device='cuda:0') tensor(0.0006, device='cuda:0')
L1: [2479.7058]	L2: [18.67273]	Linf: [0.6823529]

Accuracy on benign examples: 100.0%
gt_label: 777 pred_label: 777 pred_clean_logit 0.8415862917900085
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.21it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.29it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.02it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01, 10.01it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:00,  9.80it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.84it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.58it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  9.21it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.88it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  8.90it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.97it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.49it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.37s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.59s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.88s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.75s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4530
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.805 ent: -5.171 str: 0.000 loss: -5.976]Iterations:   3%|▎         | 1/30 [00:02<01:19,  2.74s/it, atk: -0.805 ent: -5.171 str: 0.000 loss: -5.976]Iterations:   3%|▎         | 1/30 [00:03<01:19,  2.74s/it, atk: -2.207 ent: -5.171 str: 0.000 loss: -7.378]Iterations:   7%|▋         | 2/30 [00:04<00:53,  1.92s/it, atk: -2.207 ent: -5.171 str: 0.000 loss: -7.378]Iterations:   7%|▋         | 2/30 [00:05<00:53,  1.92s/it, atk: -5.909 ent: -5.170 str: 0.000 loss: -11.079]Iterations:  10%|█         | 3/30 [00:05<00:44,  1.66s/it, atk: -5.909 ent: -5.170 str: 0.000 loss: -11.079]Iterations:  10%|█         | 3/30 [00:06<00:44,  1.66s/it, atk: -11.051 ent: -5.171 str: 0.000 loss: -16.222]Iterations:  13%|█▎        | 4/30 [00:07<00:43,  1.69s/it, atk: -11.051 ent: -5.171 str: 0.000 loss: -16.222]Iterations:  13%|█▎        | 4/30 [00:07<00:43,  1.69s/it, atk: -16.844 ent: -5.169 str: 0.000 loss: -22.013]Iterations:  17%|█▋        | 5/30 [00:08<00:36,  1.46s/it, atk: -16.844 ent: -5.169 str: 0.000 loss: -22.013]Iterations:  17%|█▋        | 5/30 [00:09<00:36,  1.46s/it, atk: -21.338 ent: -5.167 str: 0.000 loss: -26.505]Iterations:  20%|██        | 6/30 [00:09<00:35,  1.48s/it, atk: -21.338 ent: -5.167 str: 0.000 loss: -26.505]Iterations:  20%|██        | 6/30 [00:10<00:35,  1.48s/it, atk: -28.093 ent: -5.167 str: 0.000 loss: -33.259]Iterations:  23%|██▎       | 7/30 [00:10<00:29,  1.30s/it, atk: -28.093 ent: -5.167 str: 0.000 loss: -33.259]Iterations:  23%|██▎       | 7/30 [00:11<00:29,  1.30s/it, atk: -32.792 ent: -5.166 str: 0.000 loss: -37.958]Iterations:  27%|██▋       | 8/30 [00:12<00:30,  1.38s/it, atk: -32.792 ent: -5.166 str: 0.000 loss: -37.958]Iterations:  27%|██▋       | 8/30 [00:13<00:30,  1.38s/it, atk: -37.828 ent: -5.166 str: 0.000 loss: -42.995]Iterations:  30%|███       | 9/30 [00:14<00:32,  1.53s/it, atk: -37.828 ent: -5.166 str: 0.000 loss: -42.995]Iterations:  30%|███       | 9/30 [00:14<00:32,  1.53s/it, atk: -42.757 ent: -5.164 str: 0.000 loss: -47.921]Iterations:  33%|███▎      | 10/30 [00:15<00:30,  1.52s/it, atk: -42.757 ent: -5.164 str: 0.000 loss: -47.921]Iterations:  33%|███▎      | 10/30 [00:16<00:30,  1.52s/it, atk: -47.889 ent: -5.162 str: 0.000 loss: -53.051]Iterations:  37%|███▋      | 11/30 [00:17<00:30,  1.61s/it, atk: -47.889 ent: -5.162 str: 0.000 loss: -53.051]Iterations:  37%|███▋      | 11/30 [00:17<00:30,  1.61s/it, atk: -52.342 ent: -5.159 str: 0.000 loss: -57.501]Iterations:  40%|████      | 12/30 [00:18<00:26,  1.46s/it, atk: -52.342 ent: -5.159 str: 0.000 loss: -57.501]Iterations:  40%|████      | 12/30 [00:19<00:26,  1.46s/it, atk: -59.163 ent: -5.157 str: 0.000 loss: -64.321]Iterations:  43%|████▎     | 13/30 [00:20<00:25,  1.51s/it, atk: -59.163 ent: -5.157 str: 0.000 loss: -64.321]Iterations:  43%|████▎     | 13/30 [00:21<00:25,  1.51s/it, atk: -65.619 ent: -5.154 str: 0.000 loss: -70.773]Iterations:  47%|████▋     | 14/30 [00:21<00:24,  1.52s/it, atk: -65.619 ent: -5.154 str: 0.000 loss: -70.773]Iterations:  47%|████▋     | 14/30 [00:22<00:24,  1.52s/it, atk: -70.826 ent: -5.151 str: 0.000 loss: -75.977]Iterations:  50%|█████     | 15/30 [00:23<00:23,  1.58s/it, atk: -70.826 ent: -5.151 str: 0.000 loss: -75.977]Iterations:  50%|█████     | 15/30 [00:24<00:23,  1.58s/it, atk: -76.957 ent: -5.149 str: 0.000 loss: -82.106]Iterations:  53%|█████▎    | 16/30 [00:24<00:20,  1.47s/it, atk: -76.957 ent: -5.149 str: 0.000 loss: -82.106]Iterations:  53%|█████▎    | 16/30 [00:25<00:20,  1.47s/it, atk: -83.108 ent: -5.148 str: 0.000 loss: -88.255]Iterations:  57%|█████▋    | 17/30 [00:25<00:17,  1.36s/it, atk: -83.108 ent: -5.148 str: 0.000 loss: -88.255]Iterations:  57%|█████▋    | 17/30 [00:26<00:17,  1.36s/it, atk: -89.968 ent: -5.146 str: 0.000 loss: -95.114]Iterations:  60%|██████    | 18/30 [00:26<00:15,  1.30s/it, atk: -89.968 ent: -5.146 str: 0.000 loss: -95.114]Iterations:  60%|██████    | 18/30 [00:27<00:15,  1.30s/it, atk: -93.775 ent: -5.144 str: 0.000 loss: -98.920]Iterations:  63%|██████▎   | 19/30 [00:28<00:13,  1.27s/it, atk: -93.775 ent: -5.144 str: 0.000 loss: -98.920]Iterations:  63%|██████▎   | 19/30 [00:28<00:13,  1.27s/it, atk: -99.070 ent: -5.143 str: 0.000 loss: -104.213]Iterations:  67%|██████▋   | 20/30 [00:29<00:12,  1.30s/it, atk: -99.070 ent: -5.143 str: 0.000 loss: -104.213]Iterations:  67%|██████▋   | 20/30 [00:30<00:12,  1.30s/it, atk: -101.805 ent: -5.140 str: 0.000 loss: -106.945]Iterations:  70%|███████   | 21/30 [00:30<00:11,  1.24s/it, atk: -101.805 ent: -5.140 str: 0.000 loss: -106.945]Iterations:  70%|███████   | 21/30 [00:31<00:11,  1.24s/it, atk: -106.574 ent: -5.137 str: 0.000 loss: -111.712]Iterations:  73%|███████▎  | 22/30 [00:31<00:09,  1.22s/it, atk: -106.574 ent: -5.137 str: 0.000 loss: -111.712]Iterations:  73%|███████▎  | 22/30 [00:32<00:09,  1.22s/it, atk: -113.708 ent: -5.139 str: 0.000 loss: -118.846]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.23s/it, atk: -113.708 ent: -5.139 str: 0.000 loss: -118.846]Iterations:  77%|███████▋  | 23/30 [00:33<00:08,  1.23s/it, atk: -119.202 ent: -5.138 str: 0.000 loss: -124.341]Iterations:  80%|████████  | 24/30 [00:34<00:07,  1.20s/it, atk: -119.202 ent: -5.138 str: 0.000 loss: -124.341]Iterations:  80%|████████  | 24/30 [00:34<00:07,  1.20s/it, atk: -124.799 ent: -5.140 str: 0.000 loss: -129.939]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.23s/it, atk: -124.799 ent: -5.140 str: 0.000 loss: -129.939]Iterations:  83%|████████▎ | 25/30 [00:36<00:06,  1.23s/it, atk: -129.482 ent: -5.139 str: 0.000 loss: -134.621]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.25s/it, atk: -129.482 ent: -5.139 str: 0.000 loss: -134.621]Iterations:  87%|████████▋ | 26/30 [00:37<00:05,  1.25s/it, atk: -134.100 ent: -5.138 str: 0.000 loss: -139.239]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.22s/it, atk: -134.100 ent: -5.138 str: 0.000 loss: -139.239]Iterations:  90%|█████████ | 27/30 [00:38<00:03,  1.22s/it, atk: -136.592 ent: -5.137 str: 0.000 loss: -141.729]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.24s/it, atk: -136.592 ent: -5.137 str: 0.000 loss: -141.729]Iterations:  93%|█████████▎| 28/30 [00:40<00:02,  1.24s/it, atk: -142.529 ent: -5.136 str: 0.000 loss: -147.664]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.27s/it, atk: -142.529 ent: -5.136 str: 0.000 loss: -147.664]Iterations:  97%|█████████▋| 29/30 [00:41<00:01,  1.27s/it, atk: -150.248 ent: -5.134 str: 0.000 loss: -155.382]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.24s/it, atk: -150.248 ent: -5.134 str: 0.000 loss: -155.382]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.39s/it, atk: -150.248 ent: -5.134 str: 0.000 loss: -155.382]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([629], device='cuda:0') tensor(0.3176, device='cuda:0')
after_true: tensor([777], device='cuda:0') tensor(1.7648e-07, device='cuda:0')
L1: [2198.816]	L2: [15.360692]	Linf: [0.72156864]

Accuracy on benign examples: 100.0%
gt_label: 984 pred_label: 984 pred_clean_logit 0.9956283569335938
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.22it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.89it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.82it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.01it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 10.13it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.63it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.15it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  8.11it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.84it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.21it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.84it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:11,  2.81s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:07,  2.53s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.72s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.87s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.81s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5629
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.012 ent: -4.984 str: 0.000 loss: -4.996]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.54s/it, atk: -0.012 ent: -4.984 str: 0.000 loss: -4.996]Iterations:   3%|▎         | 1/30 [00:03<01:13,  2.54s/it, atk: -0.021 ent: -5.000 str: 0.000 loss: -5.020]Iterations:   7%|▋         | 2/30 [00:03<00:49,  1.76s/it, atk: -0.021 ent: -5.000 str: 0.000 loss: -5.020]Iterations:   7%|▋         | 2/30 [00:04<00:49,  1.76s/it, atk: -0.043 ent: -5.024 str: 0.000 loss: -5.067]Iterations:  10%|█         | 3/30 [00:04<00:39,  1.47s/it, atk: -0.043 ent: -5.024 str: 0.000 loss: -5.067]Iterations:  10%|█         | 3/30 [00:05<00:39,  1.47s/it, atk: -0.060 ent: -5.042 str: 0.000 loss: -5.102]Iterations:  13%|█▎        | 4/30 [00:05<00:32,  1.26s/it, atk: -0.060 ent: -5.042 str: 0.000 loss: -5.102]Iterations:  13%|█▎        | 4/30 [00:06<00:32,  1.26s/it, atk: -0.116 ent: -5.050 str: 0.000 loss: -5.166]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -0.116 ent: -5.050 str: 0.000 loss: -5.166]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -0.121 ent: -5.046 str: 0.000 loss: -5.166]Iterations:  20%|██        | 6/30 [00:08<00:30,  1.26s/it, atk: -0.121 ent: -5.046 str: 0.000 loss: -5.166]Iterations:  20%|██        | 6/30 [00:09<00:30,  1.26s/it, atk: -0.137 ent: -5.041 str: 0.000 loss: -5.178]Iterations:  23%|██▎       | 7/30 [00:09<00:31,  1.36s/it, atk: -0.137 ent: -5.041 str: 0.000 loss: -5.178]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.36s/it, atk: -0.258 ent: -5.042 str: 0.000 loss: -5.299]Iterations:  27%|██▋       | 8/30 [00:11<00:29,  1.36s/it, atk: -0.258 ent: -5.042 str: 0.000 loss: -5.299]Iterations:  27%|██▋       | 8/30 [00:12<00:29,  1.36s/it, atk: -0.416 ent: -5.046 str: 0.000 loss: -5.463]Iterations:  30%|███       | 9/30 [00:12<00:29,  1.40s/it, atk: -0.416 ent: -5.046 str: 0.000 loss: -5.463]Iterations:  30%|███       | 9/30 [00:13<00:29,  1.40s/it, atk: -0.609 ent: -5.049 str: 0.000 loss: -5.658]Iterations:  33%|███▎      | 10/30 [00:14<00:27,  1.37s/it, atk: -0.609 ent: -5.049 str: 0.000 loss: -5.658]Iterations:  33%|███▎      | 10/30 [00:15<00:27,  1.37s/it, atk: -0.953 ent: -5.051 str: 0.000 loss: -6.004]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.31s/it, atk: -0.953 ent: -5.051 str: 0.000 loss: -6.004]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.31s/it, atk: -1.427 ent: -5.053 str: 0.000 loss: -6.479]Iterations:  40%|████      | 12/30 [00:16<00:22,  1.25s/it, atk: -1.427 ent: -5.053 str: 0.000 loss: -6.479]Iterations:  40%|████      | 12/30 [00:17<00:22,  1.25s/it, atk: -1.892 ent: -5.052 str: 0.000 loss: -6.944]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.26s/it, atk: -1.892 ent: -5.052 str: 0.000 loss: -6.944]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.26s/it, atk: -2.330 ent: -5.045 str: 0.000 loss: -7.376]Iterations:  47%|████▋     | 14/30 [00:18<00:20,  1.27s/it, atk: -2.330 ent: -5.045 str: 0.000 loss: -7.376]Iterations:  47%|████▋     | 14/30 [00:19<00:20,  1.27s/it, atk: -3.331 ent: -5.050 str: 0.000 loss: -8.381]Iterations:  50%|█████     | 15/30 [00:20<00:20,  1.34s/it, atk: -3.331 ent: -5.050 str: 0.000 loss: -8.381]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.34s/it, atk: -4.286 ent: -5.053 str: 0.000 loss: -9.338]Iterations:  53%|█████▎    | 16/30 [00:21<00:18,  1.30s/it, atk: -4.286 ent: -5.053 str: 0.000 loss: -9.338]Iterations:  53%|█████▎    | 16/30 [00:22<00:18,  1.30s/it, atk: -5.411 ent: -5.051 str: 0.000 loss: -10.461]Iterations:  57%|█████▋    | 17/30 [00:22<00:15,  1.22s/it, atk: -5.411 ent: -5.051 str: 0.000 loss: -10.461]Iterations:  57%|█████▋    | 17/30 [00:23<00:15,  1.22s/it, atk: -5.674 ent: -5.054 str: 0.000 loss: -10.727]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.26s/it, atk: -5.674 ent: -5.054 str: 0.000 loss: -10.727]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.26s/it, atk: -8.537 ent: -5.050 str: 0.000 loss: -13.588]Iterations:  63%|██████▎   | 19/30 [00:25<00:12,  1.17s/it, atk: -8.537 ent: -5.050 str: 0.000 loss: -13.588]Iterations:  63%|██████▎   | 19/30 [00:25<00:12,  1.17s/it, atk: -9.307 ent: -5.051 str: 0.000 loss: -14.359]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.20s/it, atk: -9.307 ent: -5.051 str: 0.000 loss: -14.359]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.20s/it, atk: -8.745 ent: -5.047 str: 0.000 loss: -13.793]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.17s/it, atk: -8.745 ent: -5.047 str: 0.000 loss: -13.793]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.17s/it, atk: -11.824 ent: -5.049 str: 0.000 loss: -16.872]Iterations:  73%|███████▎  | 22/30 [00:28<00:09,  1.16s/it, atk: -11.824 ent: -5.049 str: 0.000 loss: -16.872]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.16s/it, atk: -13.696 ent: -5.046 str: 0.000 loss: -18.742]Iterations:  77%|███████▋  | 23/30 [00:29<00:07,  1.08s/it, atk: -13.696 ent: -5.046 str: 0.000 loss: -18.742]Iterations:  77%|███████▋  | 23/30 [00:30<00:07,  1.08s/it, atk: -18.071 ent: -5.045 str: 0.000 loss: -23.116]Iterations:  80%|████████  | 24/30 [00:30<00:06,  1.14s/it, atk: -18.071 ent: -5.045 str: 0.000 loss: -23.116]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.14s/it, atk: -20.752 ent: -5.045 str: 0.000 loss: -25.796]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.22s/it, atk: -20.752 ent: -5.045 str: 0.000 loss: -25.796]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.22s/it, atk: -24.631 ent: -5.047 str: 0.000 loss: -29.678]Iterations:  87%|████████▋ | 26/30 [00:33<00:05,  1.34s/it, atk: -24.631 ent: -5.047 str: 0.000 loss: -29.678]Iterations:  87%|████████▋ | 26/30 [00:34<00:05,  1.34s/it, atk: -25.285 ent: -5.050 str: 0.000 loss: -30.335]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.33s/it, atk: -25.285 ent: -5.050 str: 0.000 loss: -30.335]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.33s/it, atk: -28.548 ent: -5.050 str: 0.000 loss: -33.598]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.26s/it, atk: -28.548 ent: -5.050 str: 0.000 loss: -33.598]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.26s/it, atk: -32.194 ent: -5.048 str: 0.000 loss: -37.242]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.32s/it, atk: -32.194 ent: -5.048 str: 0.000 loss: -37.242]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.32s/it, atk: -35.195 ent: -5.047 str: 0.000 loss: -40.242]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.29s/it, atk: -35.195 ent: -5.047 str: 0.000 loss: -40.242]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.29s/it, atk: -35.195 ent: -5.047 str: 0.000 loss: -40.242]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([489], device='cuda:0') tensor(0.9154, device='cuda:0')
after_true: tensor([984], device='cuda:0') tensor(0.0209, device='cuda:0')
L1: [4178.6787]	L2: [25.492907]	Linf: [0.6039216]

Accuracy on benign examples: 100.0%
gt_label: 854 pred_label: 854 pred_clean_logit 0.8974374532699585
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.68it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.90it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 10.67it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 10.04it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 10.13it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  9.28it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  8.47it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  8.09it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  7.55it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.36it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  8.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.62it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.99it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.20s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.27s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.63s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  3.06s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.82s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4510
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.918 ent: -5.018 str: 0.000 loss: -5.935]Iterations:   3%|▎         | 1/30 [00:03<01:32,  3.20s/it, atk: -0.918 ent: -5.018 str: 0.000 loss: -5.935]Iterations:   3%|▎         | 1/30 [00:03<01:32,  3.20s/it, atk: -1.680 ent: -5.023 str: 0.000 loss: -6.703]Iterations:   7%|▋         | 2/30 [00:04<01:02,  2.22s/it, atk: -1.680 ent: -5.023 str: 0.000 loss: -6.703]Iterations:   7%|▋         | 2/30 [00:05<01:02,  2.22s/it, atk: -3.524 ent: -5.023 str: 0.000 loss: -8.547]Iterations:  10%|█         | 3/30 [00:06<00:51,  1.91s/it, atk: -3.524 ent: -5.023 str: 0.000 loss: -8.547]Iterations:  10%|█         | 3/30 [00:06<00:51,  1.91s/it, atk: -5.195 ent: -5.021 str: 0.000 loss: -10.216]Iterations:  13%|█▎        | 4/30 [00:07<00:42,  1.62s/it, atk: -5.195 ent: -5.021 str: 0.000 loss: -10.216]Iterations:  13%|█▎        | 4/30 [00:08<00:42,  1.62s/it, atk: -8.624 ent: -5.021 str: 0.000 loss: -13.645]Iterations:  17%|█▋        | 5/30 [00:08<00:37,  1.50s/it, atk: -8.624 ent: -5.021 str: 0.000 loss: -13.645]Iterations:  17%|█▋        | 5/30 [00:09<00:37,  1.50s/it, atk: -14.143 ent: -5.022 str: 0.000 loss: -19.164]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.35s/it, atk: -14.143 ent: -5.022 str: 0.000 loss: -19.164]Iterations:  20%|██        | 6/30 [00:10<00:32,  1.35s/it, atk: -20.405 ent: -5.016 str: 0.000 loss: -25.421]Iterations:  23%|██▎       | 7/30 [00:11<00:30,  1.32s/it, atk: -20.405 ent: -5.016 str: 0.000 loss: -25.421]Iterations:  23%|██▎       | 7/30 [00:12<00:30,  1.32s/it, atk: -24.827 ent: -5.012 str: 0.000 loss: -29.839]Iterations:  27%|██▋       | 8/30 [00:12<00:30,  1.41s/it, atk: -24.827 ent: -5.012 str: 0.000 loss: -29.839]Iterations:  27%|██▋       | 8/30 [00:13<00:30,  1.41s/it, atk: -29.837 ent: -5.008 str: 0.000 loss: -34.845]Iterations:  30%|███       | 9/30 [00:14<00:29,  1.42s/it, atk: -29.837 ent: -5.008 str: 0.000 loss: -34.845]Iterations:  30%|███       | 9/30 [00:14<00:29,  1.42s/it, atk: -35.709 ent: -5.007 str: 0.000 loss: -40.716]Iterations:  33%|███▎      | 10/30 [00:15<00:26,  1.33s/it, atk: -35.709 ent: -5.007 str: 0.000 loss: -40.716]Iterations:  33%|███▎      | 10/30 [00:15<00:26,  1.33s/it, atk: -41.310 ent: -5.006 str: 0.000 loss: -46.316]Iterations:  37%|███▋      | 11/30 [00:16<00:24,  1.30s/it, atk: -41.310 ent: -5.006 str: 0.000 loss: -46.316]Iterations:  37%|███▋      | 11/30 [00:16<00:24,  1.30s/it, atk: -45.449 ent: -5.006 str: 0.000 loss: -50.455]Iterations:  40%|████      | 12/30 [00:17<00:22,  1.24s/it, atk: -45.449 ent: -5.006 str: 0.000 loss: -50.455]Iterations:  40%|████      | 12/30 [00:18<00:22,  1.24s/it, atk: -50.178 ent: -5.009 str: 0.000 loss: -55.187]Iterations:  43%|████▎     | 13/30 [00:18<00:20,  1.23s/it, atk: -50.178 ent: -5.009 str: 0.000 loss: -55.187]Iterations:  43%|████▎     | 13/30 [00:19<00:20,  1.23s/it, atk: -55.163 ent: -5.010 str: 0.000 loss: -60.174]Iterations:  47%|████▋     | 14/30 [00:19<00:19,  1.19s/it, atk: -55.163 ent: -5.010 str: 0.000 loss: -60.174]Iterations:  47%|████▋     | 14/30 [00:20<00:19,  1.19s/it, atk: -60.803 ent: -5.010 str: 0.000 loss: -65.814]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.24s/it, atk: -60.803 ent: -5.010 str: 0.000 loss: -65.814]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.24s/it, atk: -66.095 ent: -5.010 str: 0.000 loss: -71.105]Iterations:  53%|█████▎    | 16/30 [00:22<00:18,  1.29s/it, atk: -66.095 ent: -5.010 str: 0.000 loss: -71.105]Iterations:  53%|█████▎    | 16/30 [00:23<00:18,  1.29s/it, atk: -71.360 ent: -5.010 str: 0.000 loss: -76.370]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.25s/it, atk: -71.360 ent: -5.010 str: 0.000 loss: -76.370]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.25s/it, atk: -75.432 ent: -5.010 str: 0.000 loss: -80.442]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.30s/it, atk: -75.432 ent: -5.010 str: 0.000 loss: -80.442]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.30s/it, atk: -80.242 ent: -5.011 str: 0.000 loss: -85.253]Iterations:  63%|██████▎   | 19/30 [00:26<00:13,  1.25s/it, atk: -80.242 ent: -5.011 str: 0.000 loss: -85.253]Iterations:  63%|██████▎   | 19/30 [00:27<00:13,  1.25s/it, atk: -84.960 ent: -5.012 str: 0.000 loss: -89.971]Iterations:  67%|██████▋   | 20/30 [00:27<00:12,  1.25s/it, atk: -84.960 ent: -5.012 str: 0.000 loss: -89.971]Iterations:  67%|██████▋   | 20/30 [00:28<00:12,  1.25s/it, atk: -90.067 ent: -5.012 str: 0.000 loss: -95.080]Iterations:  70%|███████   | 21/30 [00:28<00:11,  1.27s/it, atk: -90.067 ent: -5.012 str: 0.000 loss: -95.080]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.27s/it, atk: -94.651 ent: -5.013 str: 0.000 loss: -99.664]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.16s/it, atk: -94.651 ent: -5.013 str: 0.000 loss: -99.664]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.16s/it, atk: -98.826 ent: -5.011 str: 0.000 loss: -103.837]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.19s/it, atk: -98.826 ent: -5.011 str: 0.000 loss: -103.837]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.19s/it, atk: -102.453 ent: -5.010 str: 0.000 loss: -107.464]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.17s/it, atk: -102.453 ent: -5.010 str: 0.000 loss: -107.464]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.17s/it, atk: -106.907 ent: -5.010 str: 0.000 loss: -111.917]Iterations:  83%|████████▎ | 25/30 [00:33<00:05,  1.19s/it, atk: -106.907 ent: -5.010 str: 0.000 loss: -111.917]Iterations:  83%|████████▎ | 25/30 [00:34<00:05,  1.19s/it, atk: -111.143 ent: -5.010 str: 0.000 loss: -116.154]Iterations:  87%|████████▋ | 26/30 [00:34<00:05,  1.26s/it, atk: -111.143 ent: -5.010 str: 0.000 loss: -116.154]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.26s/it, atk: -116.165 ent: -5.011 str: 0.000 loss: -121.175]Iterations:  90%|█████████ | 27/30 [00:36<00:04,  1.35s/it, atk: -116.165 ent: -5.011 str: 0.000 loss: -121.175]Iterations:  90%|█████████ | 27/30 [00:36<00:04,  1.35s/it, atk: -120.420 ent: -5.010 str: 0.000 loss: -125.430]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.20s/it, atk: -120.420 ent: -5.010 str: 0.000 loss: -125.430]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.20s/it, atk: -124.228 ent: -5.009 str: 0.000 loss: -129.237]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.23s/it, atk: -124.228 ent: -5.009 str: 0.000 loss: -129.237]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.23s/it, atk: -128.337 ent: -5.008 str: 0.000 loss: -133.345]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.19s/it, atk: -128.337 ent: -5.008 str: 0.000 loss: -133.345]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.32s/it, atk: -128.337 ent: -5.008 str: 0.000 loss: -133.345]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([598], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([854], device='cuda:0') tensor(1.7562e-06, device='cuda:0')
L1: [3367.5686]	L2: [25.312366]	Linf: [0.8784314]

Accuracy on benign examples: 100.0%
gt_label: 931 pred_label: 931 pred_clean_logit 0.8918954133987427
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.83it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.99it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.56it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.48it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  8.19it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  7.78it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  8.23it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  8.29it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:01,  7.95it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.32it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  9.42it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 10.06it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  9.54it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  8.38it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.68it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.56it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.59s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.40s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.66s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.85s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  3.09s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.90s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5288
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -6.643 ent: -3.178 str: 0.000 loss: -9.821]Iterations:   3%|▎         | 1/30 [00:02<01:23,  2.89s/it, atk: -6.643 ent: -3.178 str: 0.000 loss: -9.821]Iterations:   3%|▎         | 1/30 [00:03<01:23,  2.89s/it, atk: -12.681 ent: -3.144 str: 0.000 loss: -15.825]Iterations:   7%|▋         | 2/30 [00:04<00:57,  2.06s/it, atk: -12.681 ent: -3.144 str: 0.000 loss: -15.825]Iterations:   7%|▋         | 2/30 [00:05<00:57,  2.06s/it, atk: -25.501 ent: -3.153 str: 0.000 loss: -28.653]Iterations:  10%|█         | 3/30 [00:05<00:45,  1.69s/it, atk: -25.501 ent: -3.153 str: 0.000 loss: -28.653]Iterations:  10%|█         | 3/30 [00:06<00:45,  1.69s/it, atk: -38.178 ent: -3.161 str: 0.000 loss: -41.338]Iterations:  13%|█▎        | 4/30 [00:06<00:40,  1.55s/it, atk: -38.178 ent: -3.161 str: 0.000 loss: -41.338]Iterations:  13%|█▎        | 4/30 [00:07<00:40,  1.55s/it, atk: -50.013 ent: -3.151 str: 0.000 loss: -53.164]Iterations:  17%|█▋        | 5/30 [00:08<00:36,  1.45s/it, atk: -50.013 ent: -3.151 str: 0.000 loss: -53.164]Iterations:  17%|█▋        | 5/30 [00:08<00:36,  1.45s/it, atk: -51.626 ent: -3.115 str: 0.000 loss: -54.741]Iterations:  20%|██        | 6/30 [00:09<00:33,  1.39s/it, atk: -51.626 ent: -3.115 str: 0.000 loss: -54.741]Iterations:  20%|██        | 6/30 [00:10<00:33,  1.39s/it, atk: -66.322 ent: -3.121 str: 0.000 loss: -69.444]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.38s/it, atk: -66.322 ent: -3.121 str: 0.000 loss: -69.444]Iterations:  23%|██▎       | 7/30 [00:11<00:31,  1.38s/it, atk: -74.741 ent: -3.123 str: 0.000 loss: -77.864]Iterations:  27%|██▋       | 8/30 [00:12<00:30,  1.40s/it, atk: -74.741 ent: -3.123 str: 0.000 loss: -77.864]Iterations:  27%|██▋       | 8/30 [00:13<00:30,  1.40s/it, atk: -82.265 ent: -3.123 str: 0.000 loss: -85.388]Iterations:  30%|███       | 9/30 [00:13<00:29,  1.41s/it, atk: -82.265 ent: -3.123 str: 0.000 loss: -85.388]Iterations:  30%|███       | 9/30 [00:14<00:29,  1.41s/it, atk: -89.390 ent: -3.121 str: 0.000 loss: -92.510]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.42s/it, atk: -89.390 ent: -3.121 str: 0.000 loss: -92.510]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.42s/it, atk: -96.790 ent: -3.118 str: 0.000 loss: -99.908]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.36s/it, atk: -96.790 ent: -3.118 str: 0.000 loss: -99.908]Iterations:  37%|███▋      | 11/30 [00:17<00:25,  1.36s/it, atk: -102.416 ent: -3.116 str: 0.000 loss: -105.532]Iterations:  40%|████      | 12/30 [00:17<00:23,  1.32s/it, atk: -102.416 ent: -3.116 str: 0.000 loss: -105.532]Iterations:  40%|████      | 12/30 [00:18<00:23,  1.32s/it, atk: -108.104 ent: -3.116 str: 0.000 loss: -111.220]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.28s/it, atk: -108.104 ent: -3.116 str: 0.000 loss: -111.220]Iterations:  43%|████▎     | 13/30 [00:19<00:21,  1.28s/it, atk: -111.878 ent: -3.117 str: 0.000 loss: -114.996]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.34s/it, atk: -111.878 ent: -3.117 str: 0.000 loss: -114.996]Iterations:  47%|████▋     | 14/30 [00:21<00:21,  1.34s/it, atk: -115.462 ent: -3.117 str: 0.000 loss: -118.578]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.37s/it, atk: -115.462 ent: -3.117 str: 0.000 loss: -118.578]Iterations:  50%|█████     | 15/30 [00:22<00:20,  1.37s/it, atk: -118.306 ent: -3.115 str: 0.000 loss: -121.421]Iterations:  53%|█████▎    | 16/30 [00:22<00:18,  1.31s/it, atk: -118.306 ent: -3.115 str: 0.000 loss: -121.421]Iterations:  53%|█████▎    | 16/30 [00:23<00:18,  1.31s/it, atk: -123.098 ent: -3.114 str: 0.000 loss: -126.212]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.30s/it, atk: -123.098 ent: -3.114 str: 0.000 loss: -126.212]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.30s/it, atk: -127.354 ent: -3.113 str: 0.000 loss: -130.467]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.33s/it, atk: -127.354 ent: -3.113 str: 0.000 loss: -130.467]Iterations:  60%|██████    | 18/30 [00:26<00:15,  1.33s/it, atk: -131.028 ent: -3.110 str: 0.000 loss: -134.138]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.29s/it, atk: -131.028 ent: -3.110 str: 0.000 loss: -134.138]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.29s/it, atk: -134.836 ent: -3.108 str: 0.000 loss: -137.945]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.31s/it, atk: -134.836 ent: -3.108 str: 0.000 loss: -137.945]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.31s/it, atk: -137.952 ent: -3.107 str: 0.000 loss: -141.059]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.32s/it, atk: -137.952 ent: -3.107 str: 0.000 loss: -141.059]Iterations:  70%|███████   | 21/30 [00:30<00:11,  1.32s/it, atk: -140.734 ent: -3.106 str: 0.000 loss: -143.839]Iterations:  73%|███████▎  | 22/30 [00:30<00:10,  1.30s/it, atk: -140.734 ent: -3.106 str: 0.000 loss: -143.839]Iterations:  73%|███████▎  | 22/30 [00:31<00:10,  1.30s/it, atk: -143.677 ent: -3.104 str: 0.000 loss: -146.781]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.27s/it, atk: -143.677 ent: -3.104 str: 0.000 loss: -146.781]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.27s/it, atk: -146.838 ent: -3.104 str: 0.000 loss: -149.942]Iterations:  80%|████████  | 24/30 [00:33<00:08,  1.37s/it, atk: -146.838 ent: -3.104 str: 0.000 loss: -149.942]Iterations:  80%|████████  | 24/30 [00:34<00:08,  1.37s/it, atk: -149.937 ent: -3.102 str: 0.000 loss: -153.040]Iterations:  83%|████████▎ | 25/30 [00:35<00:07,  1.41s/it, atk: -149.937 ent: -3.102 str: 0.000 loss: -153.040]Iterations:  83%|████████▎ | 25/30 [00:35<00:07,  1.41s/it, atk: -152.698 ent: -3.101 str: 0.000 loss: -155.799]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.33s/it, atk: -152.698 ent: -3.101 str: 0.000 loss: -155.799]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.33s/it, atk: -155.863 ent: -3.101 str: 0.000 loss: -158.964]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.29s/it, atk: -155.863 ent: -3.101 str: 0.000 loss: -158.964]Iterations:  90%|█████████ | 27/30 [00:38<00:03,  1.29s/it, atk: -159.306 ent: -3.101 str: 0.000 loss: -162.407]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.25s/it, atk: -159.306 ent: -3.101 str: 0.000 loss: -162.407]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.25s/it, atk: -162.784 ent: -3.101 str: 0.000 loss: -165.886]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.28s/it, atk: -162.784 ent: -3.101 str: 0.000 loss: -165.886]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.28s/it, atk: -165.238 ent: -3.102 str: 0.000 loss: -168.340]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.30s/it, atk: -165.238 ent: -3.102 str: 0.000 loss: -168.340]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.37s/it, atk: -165.238 ent: -3.102 str: 0.000 loss: -168.340]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([929], device='cuda:0') tensor(0.9996, device='cuda:0')
after_true: tensor([931], device='cuda:0') tensor(5.3597e-08, device='cuda:0')
L1: [1238.0942]	L2: [8.092096]	Linf: [0.4156863]

Accuracy on benign examples: 100.0%
gt_label: 607 pred_label: 607 pred_clean_logit 0.9999376535415649
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.73it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.87it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.00it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.17it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 11.10it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 10.16it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  9.61it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  9.49it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.44it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  8.26it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  7.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.47it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:03<00:12,  3.00s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:08,  2.70s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.74s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.93s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.86s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5635
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.005 ent: -14.848 str: 0.000 loss: -14.853]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.47s/it, atk: -0.005 ent: -14.848 str: 0.000 loss: -14.853]Iterations:   3%|▎         | 1/30 [00:03<01:11,  2.47s/it, atk: -0.012 ent: -15.014 str: 0.000 loss: -15.026]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.67s/it, atk: -0.012 ent: -15.014 str: 0.000 loss: -15.026]Iterations:   7%|▋         | 2/30 [00:04<00:46,  1.67s/it, atk: -0.006 ent: -15.100 str: 0.000 loss: -15.106]Iterations:  10%|█         | 3/30 [00:04<00:41,  1.54s/it, atk: -0.006 ent: -15.100 str: 0.000 loss: -15.106]Iterations:  10%|█         | 3/30 [00:05<00:41,  1.54s/it, atk: -0.034 ent: -15.162 str: 0.000 loss: -15.195]Iterations:  13%|█▎        | 4/30 [00:06<00:37,  1.45s/it, atk: -0.034 ent: -15.162 str: 0.000 loss: -15.195]Iterations:  13%|█▎        | 4/30 [00:06<00:37,  1.45s/it, atk: -0.102 ent: -15.213 str: 0.000 loss: -15.315]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -0.102 ent: -15.213 str: 0.000 loss: -15.315]Iterations:  17%|█▋        | 5/30 [00:08<00:34,  1.36s/it, atk: -0.588 ent: -15.241 str: 0.000 loss: -15.829]Iterations:  20%|██        | 6/30 [00:08<00:31,  1.30s/it, atk: -0.588 ent: -15.241 str: 0.000 loss: -15.829]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.30s/it, atk: -1.746 ent: -15.241 str: 0.000 loss: -16.987]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.33s/it, atk: -1.746 ent: -15.241 str: 0.000 loss: -16.987]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.33s/it, atk: -4.087 ent: -15.235 str: 0.000 loss: -19.322]Iterations:  27%|██▋       | 8/30 [00:11<00:30,  1.38s/it, atk: -4.087 ent: -15.235 str: 0.000 loss: -19.322]Iterations:  27%|██▋       | 8/30 [00:12<00:30,  1.38s/it, atk: -11.855 ent: -15.240 str: 0.000 loss: -27.095]Iterations:  30%|███       | 9/30 [00:12<00:28,  1.36s/it, atk: -11.855 ent: -15.240 str: 0.000 loss: -27.095]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.36s/it, atk: -20.046 ent: -15.237 str: 0.000 loss: -35.283]Iterations:  33%|███▎      | 10/30 [00:14<00:27,  1.36s/it, atk: -20.046 ent: -15.237 str: 0.000 loss: -35.283]Iterations:  33%|███▎      | 10/30 [00:15<00:27,  1.36s/it, atk: -28.810 ent: -15.233 str: 0.000 loss: -44.044]Iterations:  37%|███▋      | 11/30 [00:15<00:25,  1.35s/it, atk: -28.810 ent: -15.233 str: 0.000 loss: -44.044]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.35s/it, atk: -38.751 ent: -15.235 str: 0.000 loss: -53.986]Iterations:  40%|████      | 12/30 [00:16<00:23,  1.31s/it, atk: -38.751 ent: -15.235 str: 0.000 loss: -53.986]Iterations:  40%|████      | 12/30 [00:17<00:23,  1.31s/it, atk: -45.635 ent: -15.233 str: 0.000 loss: -60.868]Iterations:  43%|████▎     | 13/30 [00:18<00:23,  1.41s/it, atk: -45.635 ent: -15.233 str: 0.000 loss: -60.868]Iterations:  43%|████▎     | 13/30 [00:19<00:23,  1.41s/it, atk: -54.355 ent: -15.219 str: 0.000 loss: -69.573]Iterations:  47%|████▋     | 14/30 [00:19<00:21,  1.36s/it, atk: -54.355 ent: -15.219 str: 0.000 loss: -69.573]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.36s/it, atk: -61.349 ent: -15.208 str: 0.000 loss: -76.556]Iterations:  50%|█████     | 15/30 [00:20<00:19,  1.33s/it, atk: -61.349 ent: -15.208 str: 0.000 loss: -76.556]Iterations:  50%|█████     | 15/30 [00:21<00:19,  1.33s/it, atk: -67.574 ent: -15.205 str: 0.000 loss: -82.778]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.28s/it, atk: -67.574 ent: -15.205 str: 0.000 loss: -82.778]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.28s/it, atk: -74.340 ent: -15.206 str: 0.000 loss: -89.547]Iterations:  57%|█████▋    | 17/30 [00:23<00:17,  1.35s/it, atk: -74.340 ent: -15.206 str: 0.000 loss: -89.547]Iterations:  57%|█████▋    | 17/30 [00:24<00:17,  1.35s/it, atk: -79.324 ent: -15.211 str: 0.000 loss: -94.535]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.29s/it, atk: -79.324 ent: -15.211 str: 0.000 loss: -94.535]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.29s/it, atk: -85.390 ent: -15.211 str: 0.000 loss: -100.601]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.32s/it, atk: -85.390 ent: -15.211 str: 0.000 loss: -100.601]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.32s/it, atk: -91.169 ent: -15.210 str: 0.000 loss: -106.379]Iterations:  67%|██████▋   | 20/30 [00:27<00:13,  1.31s/it, atk: -91.169 ent: -15.210 str: 0.000 loss: -106.379]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.31s/it, atk: -97.402 ent: -15.211 str: 0.000 loss: -112.612]Iterations:  70%|███████   | 21/30 [00:28<00:11,  1.33s/it, atk: -97.402 ent: -15.211 str: 0.000 loss: -112.612]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.33s/it, atk: -102.932 ent: -15.207 str: 0.000 loss: -118.139]Iterations:  73%|███████▎  | 22/30 [00:29<00:10,  1.28s/it, atk: -102.932 ent: -15.207 str: 0.000 loss: -118.139]Iterations:  73%|███████▎  | 22/30 [00:30<00:10,  1.28s/it, atk: -108.271 ent: -15.202 str: 0.000 loss: -123.472]Iterations:  77%|███████▋  | 23/30 [00:31<00:09,  1.41s/it, atk: -108.271 ent: -15.202 str: 0.000 loss: -123.472]Iterations:  77%|███████▋  | 23/30 [00:32<00:09,  1.41s/it, atk: -113.010 ent: -15.198 str: 0.000 loss: -128.208]Iterations:  80%|████████  | 24/30 [00:32<00:08,  1.37s/it, atk: -113.010 ent: -15.198 str: 0.000 loss: -128.208]Iterations:  80%|████████  | 24/30 [00:33<00:08,  1.37s/it, atk: -117.789 ent: -15.198 str: 0.000 loss: -132.986]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.28s/it, atk: -117.789 ent: -15.198 str: 0.000 loss: -132.986]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.28s/it, atk: -123.037 ent: -15.197 str: 0.000 loss: -138.234]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.39s/it, atk: -123.037 ent: -15.197 str: 0.000 loss: -138.234]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.39s/it, atk: -127.360 ent: -15.195 str: 0.000 loss: -142.555]Iterations:  90%|█████████ | 27/30 [00:36<00:03,  1.30s/it, atk: -127.360 ent: -15.195 str: 0.000 loss: -142.555]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.30s/it, atk: -131.691 ent: -15.192 str: 0.000 loss: -146.883]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.34s/it, atk: -131.691 ent: -15.192 str: 0.000 loss: -146.883]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.34s/it, atk: -135.962 ent: -15.197 str: 0.000 loss: -151.159]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.36s/it, atk: -135.962 ent: -15.197 str: 0.000 loss: -151.159]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.36s/it, atk: -139.932 ent: -15.199 str: 0.000 loss: -155.131]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.43s/it, atk: -139.932 ent: -15.199 str: 0.000 loss: -155.131]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.37s/it, atk: -139.932 ent: -15.199 str: 0.000 loss: -155.131]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([685], device='cuda:0') tensor(0.9990, device='cuda:0')
after_true: tensor([607], device='cuda:0') tensor(6.0629e-07, device='cuda:0')
L1: [3100.208]	L2: [27.197948]	Linf: [0.9372549]

Accuracy on benign examples: 100.0%
gt_label: 869 pred_label: 869 pred_clean_logit 0.9995995163917542
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.86it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.65it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.76it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 11.08it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 14.74it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 14.18it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 11.88it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 10.98it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 10.48it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.35it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.59s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.88s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.75s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5107
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.018 ent: -6.091 str: 0.000 loss: -6.108]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.79s/it, atk: -0.018 ent: -6.091 str: 0.000 loss: -6.108]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.79s/it, atk: -0.129 ent: -6.096 str: 0.000 loss: -6.225]Iterations:   7%|▋         | 2/30 [00:02<00:39,  1.41s/it, atk: -0.129 ent: -6.096 str: 0.000 loss: -6.225]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -0.654 ent: -6.096 str: 0.000 loss: -6.750]Iterations:  10%|█         | 3/30 [00:04<00:41,  1.52s/it, atk: -0.654 ent: -6.096 str: 0.000 loss: -6.750]Iterations:  10%|█         | 3/30 [00:05<00:41,  1.52s/it, atk: -0.671 ent: -6.107 str: 0.000 loss: -6.777]Iterations:  13%|█▎        | 4/30 [00:05<00:36,  1.42s/it, atk: -0.671 ent: -6.107 str: 0.000 loss: -6.777]Iterations:  13%|█▎        | 4/30 [00:06<00:36,  1.42s/it, atk: -3.311 ent: -6.105 str: 0.000 loss: -9.415]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -3.311 ent: -6.105 str: 0.000 loss: -9.415]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -7.783 ent: -6.097 str: 0.000 loss: -13.880]Iterations:  20%|██        | 6/30 [00:08<00:34,  1.45s/it, atk: -7.783 ent: -6.097 str: 0.000 loss: -13.880]Iterations:  20%|██        | 6/30 [00:09<00:34,  1.45s/it, atk: -15.301 ent: -6.090 str: 0.000 loss: -21.391]Iterations:  23%|██▎       | 7/30 [00:10<00:32,  1.43s/it, atk: -15.301 ent: -6.090 str: 0.000 loss: -21.391]Iterations:  23%|██▎       | 7/30 [00:11<00:32,  1.43s/it, atk: -16.345 ent: -6.082 str: 0.000 loss: -22.427]Iterations:  27%|██▋       | 8/30 [00:11<00:31,  1.45s/it, atk: -16.345 ent: -6.082 str: 0.000 loss: -22.427]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.45s/it, atk: -24.659 ent: -6.075 str: 0.000 loss: -30.734]Iterations:  30%|███       | 9/30 [00:12<00:29,  1.38s/it, atk: -24.659 ent: -6.075 str: 0.000 loss: -30.734]Iterations:  30%|███       | 9/30 [00:13<00:29,  1.38s/it, atk: -22.021 ent: -6.078 str: 0.000 loss: -28.099]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.33s/it, atk: -22.021 ent: -6.078 str: 0.000 loss: -28.099]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.33s/it, atk: -32.957 ent: -6.070 str: 0.000 loss: -39.027]Iterations:  37%|███▋      | 11/30 [00:15<00:23,  1.24s/it, atk: -32.957 ent: -6.070 str: 0.000 loss: -39.027]Iterations:  37%|███▋      | 11/30 [00:15<00:23,  1.24s/it, atk: -37.900 ent: -6.067 str: 0.000 loss: -43.967]Iterations:  40%|████      | 12/30 [00:16<00:22,  1.23s/it, atk: -37.900 ent: -6.067 str: 0.000 loss: -43.967]Iterations:  40%|████      | 12/30 [00:17<00:22,  1.23s/it, atk: -42.447 ent: -6.064 str: 0.000 loss: -48.511]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.27s/it, atk: -42.447 ent: -6.064 str: 0.000 loss: -48.511]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.27s/it, atk: -47.552 ent: -6.060 str: 0.000 loss: -53.612]Iterations:  47%|████▋     | 14/30 [00:18<00:19,  1.25s/it, atk: -47.552 ent: -6.060 str: 0.000 loss: -53.612]Iterations:  47%|████▋     | 14/30 [00:19<00:19,  1.25s/it, atk: -55.880 ent: -6.058 str: 0.000 loss: -61.938]Iterations:  50%|█████     | 15/30 [00:20<00:18,  1.22s/it, atk: -55.880 ent: -6.058 str: 0.000 loss: -61.938]Iterations:  50%|█████     | 15/30 [00:20<00:18,  1.22s/it, atk: -61.932 ent: -6.057 str: 0.000 loss: -67.989]Iterations:  53%|█████▎    | 16/30 [00:21<00:16,  1.18s/it, atk: -61.932 ent: -6.057 str: 0.000 loss: -67.989]Iterations:  53%|█████▎    | 16/30 [00:21<00:16,  1.18s/it, atk: -68.755 ent: -6.055 str: 0.000 loss: -74.810]Iterations:  57%|█████▋    | 17/30 [00:22<00:16,  1.25s/it, atk: -68.755 ent: -6.055 str: 0.000 loss: -74.810]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.25s/it, atk: -74.475 ent: -6.053 str: 0.000 loss: -80.528]Iterations:  60%|██████    | 18/30 [00:23<00:14,  1.20s/it, atk: -74.475 ent: -6.053 str: 0.000 loss: -80.528]Iterations:  60%|██████    | 18/30 [00:24<00:14,  1.20s/it, atk: -80.670 ent: -6.052 str: 0.000 loss: -86.722]Iterations:  63%|██████▎   | 19/30 [00:25<00:14,  1.29s/it, atk: -80.670 ent: -6.052 str: 0.000 loss: -86.722]Iterations:  63%|██████▎   | 19/30 [00:25<00:14,  1.29s/it, atk: -86.543 ent: -6.050 str: 0.000 loss: -92.594]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.25s/it, atk: -86.543 ent: -6.050 str: 0.000 loss: -92.594]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.25s/it, atk: -92.596 ent: -6.049 str: 0.000 loss: -98.645]Iterations:  70%|███████   | 21/30 [00:27<00:11,  1.26s/it, atk: -92.596 ent: -6.049 str: 0.000 loss: -98.645]Iterations:  70%|███████   | 21/30 [00:28<00:11,  1.26s/it, atk: -99.605 ent: -6.047 str: 0.000 loss: -105.652]Iterations:  73%|███████▎  | 22/30 [00:28<00:09,  1.21s/it, atk: -99.605 ent: -6.047 str: 0.000 loss: -105.652]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.21s/it, atk: -104.871 ent: -6.045 str: 0.000 loss: -110.916]Iterations:  77%|███████▋  | 23/30 [00:30<00:09,  1.33s/it, atk: -104.871 ent: -6.045 str: 0.000 loss: -110.916]Iterations:  77%|███████▋  | 23/30 [00:31<00:09,  1.33s/it, atk: -109.771 ent: -6.043 str: 0.000 loss: -115.814]Iterations:  80%|████████  | 24/30 [00:31<00:08,  1.41s/it, atk: -109.771 ent: -6.043 str: 0.000 loss: -115.814]Iterations:  80%|████████  | 24/30 [00:32<00:08,  1.41s/it, atk: -114.579 ent: -6.042 str: 0.000 loss: -120.620]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.38s/it, atk: -114.579 ent: -6.042 str: 0.000 loss: -120.620]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.38s/it, atk: -119.163 ent: -6.041 str: 0.000 loss: -125.204]Iterations:  87%|████████▋ | 26/30 [00:34<00:05,  1.46s/it, atk: -119.163 ent: -6.041 str: 0.000 loss: -125.204]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.46s/it, atk: -123.111 ent: -6.040 str: 0.000 loss: -129.150]Iterations:  90%|█████████ | 27/30 [00:35<00:04,  1.37s/it, atk: -123.111 ent: -6.040 str: 0.000 loss: -129.150]Iterations:  90%|█████████ | 27/30 [00:36<00:04,  1.37s/it, atk: -126.913 ent: -6.040 str: 0.000 loss: -132.952]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.42s/it, atk: -126.913 ent: -6.040 str: 0.000 loss: -132.952]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.42s/it, atk: -130.022 ent: -6.040 str: 0.000 loss: -136.061]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.46s/it, atk: -130.022 ent: -6.040 str: 0.000 loss: -136.061]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.46s/it, atk: -134.655 ent: -6.039 str: 0.000 loss: -140.693]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.50s/it, atk: -134.655 ent: -6.039 str: 0.000 loss: -140.693]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.35s/it, atk: -134.655 ent: -6.039 str: 0.000 loss: -140.693]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([617], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([869], device='cuda:0') tensor(9.2824e-07, device='cuda:0')
L1: [2673.5254]	L2: [17.572212]	Linf: [0.69803923]

Accuracy on benign examples: 100.0%
gt_label: 656 pred_label: 656 pred_clean_logit 0.8270311951637268
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.34it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  9.00it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.52it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  7.70it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.10it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.20it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:00, 10.31it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.99it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.93it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 13.37it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.48it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.16it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.73s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:07,  2.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.64s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  3.10s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.90s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5739
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.090 ent: -5.412 str: 0.000 loss: -7.502]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.33s/it, atk: -2.090 ent: -5.412 str: 0.000 loss: -7.502]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.33s/it, atk: -3.164 ent: -5.376 str: 0.000 loss: -8.540]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.56s/it, atk: -3.164 ent: -5.376 str: 0.000 loss: -8.540]Iterations:   7%|▋         | 2/30 [00:04<00:43,  1.56s/it, atk: -6.330 ent: -5.383 str: 0.000 loss: -11.713]Iterations:  10%|█         | 3/30 [00:04<00:40,  1.49s/it, atk: -6.330 ent: -5.383 str: 0.000 loss: -11.713]Iterations:  10%|█         | 3/30 [00:05<00:40,  1.49s/it, atk: -9.788 ent: -5.384 str: 0.000 loss: -15.173]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.51s/it, atk: -9.788 ent: -5.384 str: 0.000 loss: -15.173]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.51s/it, atk: -14.320 ent: -5.380 str: 0.000 loss: -19.700]Iterations:  17%|█▋        | 5/30 [00:07<00:39,  1.57s/it, atk: -14.320 ent: -5.380 str: 0.000 loss: -19.700]Iterations:  17%|█▋        | 5/30 [00:08<00:39,  1.57s/it, atk: -18.648 ent: -5.380 str: 0.000 loss: -24.028]Iterations:  20%|██        | 6/30 [00:09<00:39,  1.64s/it, atk: -18.648 ent: -5.380 str: 0.000 loss: -24.028]Iterations:  20%|██        | 6/30 [00:10<00:39,  1.64s/it, atk: -22.975 ent: -5.383 str: 0.000 loss: -28.357]Iterations:  23%|██▎       | 7/30 [00:11<00:36,  1.58s/it, atk: -22.975 ent: -5.383 str: 0.000 loss: -28.357]Iterations:  23%|██▎       | 7/30 [00:11<00:36,  1.58s/it, atk: -25.363 ent: -5.386 str: 0.000 loss: -30.749]Iterations:  27%|██▋       | 8/30 [00:12<00:32,  1.48s/it, atk: -25.363 ent: -5.386 str: 0.000 loss: -30.749]Iterations:  27%|██▋       | 8/30 [00:13<00:32,  1.48s/it, atk: -28.797 ent: -5.379 str: 0.000 loss: -34.175]Iterations:  30%|███       | 9/30 [00:13<00:30,  1.47s/it, atk: -28.797 ent: -5.379 str: 0.000 loss: -34.175]Iterations:  30%|███       | 9/30 [00:14<00:30,  1.47s/it, atk: -31.596 ent: -5.375 str: 0.000 loss: -36.971]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.34s/it, atk: -31.596 ent: -5.375 str: 0.000 loss: -36.971]Iterations:  33%|███▎      | 10/30 [00:15<00:26,  1.34s/it, atk: -35.147 ent: -5.375 str: 0.000 loss: -40.522]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.36s/it, atk: -35.147 ent: -5.375 str: 0.000 loss: -40.522]Iterations:  37%|███▋      | 11/30 [00:17<00:25,  1.36s/it, atk: -38.328 ent: -5.375 str: 0.000 loss: -43.703]Iterations:  40%|████      | 12/30 [00:17<00:23,  1.32s/it, atk: -38.328 ent: -5.375 str: 0.000 loss: -43.703]Iterations:  40%|████      | 12/30 [00:18<00:23,  1.32s/it, atk: -41.279 ent: -5.377 str: 0.000 loss: -46.656]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.27s/it, atk: -41.279 ent: -5.377 str: 0.000 loss: -46.656]Iterations:  43%|████▎     | 13/30 [00:19<00:21,  1.27s/it, atk: -44.438 ent: -5.376 str: 0.000 loss: -49.815]Iterations:  47%|████▋     | 14/30 [00:20<00:20,  1.29s/it, atk: -44.438 ent: -5.376 str: 0.000 loss: -49.815]Iterations:  47%|████▋     | 14/30 [00:20<00:20,  1.29s/it, atk: -47.580 ent: -5.374 str: 0.000 loss: -52.954]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.22s/it, atk: -47.580 ent: -5.374 str: 0.000 loss: -52.954]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.22s/it, atk: -50.385 ent: -5.372 str: 0.000 loss: -55.757]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.24s/it, atk: -50.385 ent: -5.372 str: 0.000 loss: -55.757]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.24s/it, atk: -51.528 ent: -5.370 str: 0.000 loss: -56.898]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.25s/it, atk: -51.528 ent: -5.370 str: 0.000 loss: -56.898]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.25s/it, atk: -54.204 ent: -5.370 str: 0.000 loss: -59.574]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.28s/it, atk: -54.204 ent: -5.370 str: 0.000 loss: -59.574]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.28s/it, atk: -56.498 ent: -5.369 str: 0.000 loss: -61.867]Iterations:  63%|██████▎   | 19/30 [00:26<00:13,  1.23s/it, atk: -56.498 ent: -5.369 str: 0.000 loss: -61.867]Iterations:  63%|██████▎   | 19/30 [00:26<00:13,  1.23s/it, atk: -58.931 ent: -5.368 str: 0.000 loss: -64.299]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.17s/it, atk: -58.931 ent: -5.368 str: 0.000 loss: -64.299]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.17s/it, atk: -60.133 ent: -5.368 str: 0.000 loss: -65.501]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.13s/it, atk: -60.133 ent: -5.368 str: 0.000 loss: -65.501]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.13s/it, atk: -62.163 ent: -5.367 str: 0.000 loss: -67.530]Iterations:  73%|███████▎  | 22/30 [00:29<00:08,  1.12s/it, atk: -62.163 ent: -5.367 str: 0.000 loss: -67.530]Iterations:  73%|███████▎  | 22/30 [00:30<00:08,  1.12s/it, atk: -65.496 ent: -5.365 str: 0.000 loss: -70.861]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.18s/it, atk: -65.496 ent: -5.365 str: 0.000 loss: -70.861]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.18s/it, atk: -69.239 ent: -5.364 str: 0.000 loss: -74.603]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.24s/it, atk: -69.239 ent: -5.364 str: 0.000 loss: -74.603]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.24s/it, atk: -73.203 ent: -5.364 str: 0.000 loss: -78.568]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.23s/it, atk: -73.203 ent: -5.364 str: 0.000 loss: -78.568]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.23s/it, atk: -77.508 ent: -5.365 str: 0.000 loss: -82.873]Iterations:  87%|████████▋ | 26/30 [00:34<00:04,  1.22s/it, atk: -77.508 ent: -5.365 str: 0.000 loss: -82.873]Iterations:  87%|████████▋ | 26/30 [00:34<00:04,  1.22s/it, atk: -82.036 ent: -5.364 str: 0.000 loss: -87.400]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.21s/it, atk: -82.036 ent: -5.364 str: 0.000 loss: -87.400]Iterations:  90%|█████████ | 27/30 [00:36<00:03,  1.21s/it, atk: -87.024 ent: -5.363 str: 0.000 loss: -92.387]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.26s/it, atk: -87.024 ent: -5.363 str: 0.000 loss: -92.387]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.26s/it, atk: -91.830 ent: -5.362 str: 0.000 loss: -97.192]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.29s/it, atk: -91.830 ent: -5.362 str: 0.000 loss: -97.192]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.29s/it, atk: -97.770 ent: -5.362 str: 0.000 loss: -103.131]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.27s/it, atk: -97.770 ent: -5.362 str: 0.000 loss: -103.131]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.32s/it, atk: -97.770 ent: -5.362 str: 0.000 loss: -103.131]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([751], device='cuda:0') tensor(0.5905, device='cuda:0')
after_true: tensor([656], device='cuda:0') tensor(3.2677e-05, device='cuda:0')
L1: [2466.5178]	L2: [18.012407]	Linf: [0.7176471]

Accuracy on benign examples: 100.0%
gt_label: 897 pred_label: 897 pred_clean_logit 0.5567238330841064
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.29it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.48it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.46it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  9.69it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 11.80it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 14.20it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 14.97it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 11.25it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 10.16it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.85it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.24s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.26s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.90s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3880
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.657 ent: -2.597 str: 0.000 loss: -3.254]Iterations:   3%|▎         | 1/30 [00:02<01:23,  2.89s/it, atk: -0.657 ent: -2.597 str: 0.000 loss: -3.254]Iterations:   3%|▎         | 1/30 [00:03<01:23,  2.89s/it, atk: -12.245 ent: -2.603 str: 0.000 loss: -14.848]Iterations:   7%|▋         | 2/30 [00:03<00:49,  1.76s/it, atk: -12.245 ent: -2.603 str: 0.000 loss: -14.848]Iterations:   7%|▋         | 2/30 [00:04<00:49,  1.76s/it, atk: -25.510 ent: -2.600 str: 0.000 loss: -28.110]Iterations:  10%|█         | 3/30 [00:04<00:38,  1.44s/it, atk: -25.510 ent: -2.600 str: 0.000 loss: -28.110]Iterations:  10%|█         | 3/30 [00:05<00:38,  1.44s/it, atk: -43.807 ent: -2.598 str: 0.000 loss: -46.405]Iterations:  13%|█▎        | 4/30 [00:06<00:35,  1.37s/it, atk: -43.807 ent: -2.598 str: 0.000 loss: -46.405]Iterations:  13%|█▎        | 4/30 [00:06<00:35,  1.37s/it, atk: -56.626 ent: -2.597 str: 0.000 loss: -59.223]Iterations:  17%|█▋        | 5/30 [00:07<00:33,  1.35s/it, atk: -56.626 ent: -2.597 str: 0.000 loss: -59.223]Iterations:  17%|█▋        | 5/30 [00:08<00:33,  1.35s/it, atk: -69.006 ent: -2.597 str: 0.000 loss: -71.603]Iterations:  20%|██        | 6/30 [00:08<00:33,  1.39s/it, atk: -69.006 ent: -2.597 str: 0.000 loss: -71.603]Iterations:  20%|██        | 6/30 [00:09<00:33,  1.39s/it, atk: -80.899 ent: -2.598 str: 0.000 loss: -83.497]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.35s/it, atk: -80.899 ent: -2.598 str: 0.000 loss: -83.497]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.35s/it, atk: -91.771 ent: -2.597 str: 0.000 loss: -94.368]Iterations:  27%|██▋       | 8/30 [00:11<00:28,  1.29s/it, atk: -91.771 ent: -2.597 str: 0.000 loss: -94.368]Iterations:  27%|██▋       | 8/30 [00:12<00:28,  1.29s/it, atk: -100.684 ent: -2.597 str: 0.000 loss: -103.281]Iterations:  30%|███       | 9/30 [00:12<00:28,  1.33s/it, atk: -100.684 ent: -2.597 str: 0.000 loss: -103.281]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.33s/it, atk: -108.379 ent: -2.595 str: 0.000 loss: -110.974]Iterations:  33%|███▎      | 10/30 [00:14<00:28,  1.44s/it, atk: -108.379 ent: -2.595 str: 0.000 loss: -110.974]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.44s/it, atk: -117.210 ent: -2.596 str: 0.000 loss: -119.805]Iterations:  37%|███▋      | 11/30 [00:15<00:25,  1.35s/it, atk: -117.210 ent: -2.596 str: 0.000 loss: -119.805]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.35s/it, atk: -126.674 ent: -2.595 str: 0.000 loss: -129.269]Iterations:  40%|████      | 12/30 [00:17<00:25,  1.39s/it, atk: -126.674 ent: -2.595 str: 0.000 loss: -129.269]Iterations:  40%|████      | 12/30 [00:18<00:25,  1.39s/it, atk: -135.282 ent: -2.593 str: 0.000 loss: -137.875]Iterations:  43%|████▎     | 13/30 [00:18<00:22,  1.33s/it, atk: -135.282 ent: -2.593 str: 0.000 loss: -137.875]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.33s/it, atk: -142.934 ent: -2.591 str: 0.000 loss: -145.525]Iterations:  47%|████▋     | 14/30 [00:19<00:21,  1.33s/it, atk: -142.934 ent: -2.591 str: 0.000 loss: -145.525]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.33s/it, atk: -151.959 ent: -2.592 str: 0.000 loss: -154.551]Iterations:  50%|█████     | 15/30 [00:20<00:18,  1.26s/it, atk: -151.959 ent: -2.592 str: 0.000 loss: -154.551]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.26s/it, atk: -157.745 ent: -2.593 str: 0.000 loss: -160.338]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.27s/it, atk: -157.745 ent: -2.593 str: 0.000 loss: -160.338]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.27s/it, atk: -166.435 ent: -2.591 str: 0.000 loss: -169.026]Iterations:  57%|█████▋    | 17/30 [00:23<00:15,  1.20s/it, atk: -166.435 ent: -2.591 str: 0.000 loss: -169.026]Iterations:  57%|█████▋    | 17/30 [00:23<00:15,  1.20s/it, atk: -173.963 ent: -2.589 str: 0.000 loss: -176.553]Iterations:  60%|██████    | 18/30 [00:24<00:14,  1.24s/it, atk: -173.963 ent: -2.589 str: 0.000 loss: -176.553]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.24s/it, atk: -182.122 ent: -2.588 str: 0.000 loss: -184.710]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.23s/it, atk: -182.122 ent: -2.588 str: 0.000 loss: -184.710]Iterations:  63%|██████▎   | 19/30 [00:26<00:13,  1.23s/it, atk: -188.469 ent: -2.588 str: 0.000 loss: -191.056]Iterations:  67%|██████▋   | 20/30 [00:26<00:11,  1.20s/it, atk: -188.469 ent: -2.588 str: 0.000 loss: -191.056]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.20s/it, atk: -195.190 ent: -2.586 str: 0.000 loss: -197.776]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.20s/it, atk: -195.190 ent: -2.586 str: 0.000 loss: -197.776]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.20s/it, atk: -200.804 ent: -2.587 str: 0.000 loss: -203.391]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.20s/it, atk: -200.804 ent: -2.587 str: 0.000 loss: -203.391]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.20s/it, atk: -206.464 ent: -2.587 str: 0.000 loss: -209.051]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.26s/it, atk: -206.464 ent: -2.587 str: 0.000 loss: -209.051]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.26s/it, atk: -211.582 ent: -2.587 str: 0.000 loss: -214.169]Iterations:  80%|████████  | 24/30 [00:31<00:07,  1.24s/it, atk: -211.582 ent: -2.587 str: 0.000 loss: -214.169]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.24s/it, atk: -216.773 ent: -2.586 str: 0.000 loss: -219.359]Iterations:  83%|████████▎ | 25/30 [00:32<00:05,  1.17s/it, atk: -216.773 ent: -2.586 str: 0.000 loss: -219.359]Iterations:  83%|████████▎ | 25/30 [00:33<00:05,  1.17s/it, atk: -221.235 ent: -2.587 str: 0.000 loss: -223.821]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.19s/it, atk: -221.235 ent: -2.587 str: 0.000 loss: -223.821]Iterations:  87%|████████▋ | 26/30 [00:34<00:04,  1.19s/it, atk: -227.435 ent: -2.586 str: 0.000 loss: -230.021]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.14s/it, atk: -227.435 ent: -2.586 str: 0.000 loss: -230.021]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.14s/it, atk: -231.998 ent: -2.586 str: 0.000 loss: -234.584]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.08s/it, atk: -231.998 ent: -2.586 str: 0.000 loss: -234.584]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.08s/it, atk: -236.855 ent: -2.586 str: 0.000 loss: -239.441]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.23s/it, atk: -236.855 ent: -2.586 str: 0.000 loss: -239.441]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.23s/it, atk: -240.682 ent: -2.587 str: 0.000 loss: -243.269]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.28s/it, atk: -240.682 ent: -2.587 str: 0.000 loss: -243.269]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.30s/it, atk: -240.682 ent: -2.587 str: 0.000 loss: -243.269]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([778], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([897], device='cuda:0') tensor(2.1829e-11, device='cuda:0')
L1: [3401.]	L2: [24.195295]	Linf: [0.74509805]

Accuracy on benign examples: 100.0%
gt_label: 959 pred_label: 959 pred_clean_logit 0.5415793061256409
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.57it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.11it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.59it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00,  9.59it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 10.41it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 11.11it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.04it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 11.01it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.85it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.94s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.08s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.27s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4599
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -13.307 ent: -4.896 str: 0.000 loss: -18.204]Iterations:   3%|▎         | 1/30 [00:02<01:19,  2.73s/it, atk: -13.307 ent: -4.896 str: 0.000 loss: -18.204]Iterations:   3%|▎         | 1/30 [00:03<01:19,  2.73s/it, atk: -20.046 ent: -4.899 str: 0.000 loss: -24.945]Iterations:   7%|▋         | 2/30 [00:04<00:55,  1.99s/it, atk: -20.046 ent: -4.899 str: 0.000 loss: -24.945]Iterations:   7%|▋         | 2/30 [00:04<00:55,  1.99s/it, atk: -20.665 ent: -4.891 str: 0.000 loss: -25.556]Iterations:  10%|█         | 3/30 [00:05<00:43,  1.60s/it, atk: -20.665 ent: -4.891 str: 0.000 loss: -25.556]Iterations:  10%|█         | 3/30 [00:06<00:43,  1.60s/it, atk: -28.704 ent: -4.892 str: 0.000 loss: -33.595]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.50s/it, atk: -28.704 ent: -4.892 str: 0.000 loss: -33.595]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.50s/it, atk: -35.631 ent: -4.887 str: 0.000 loss: -40.519]Iterations:  17%|█▋        | 5/30 [00:07<00:33,  1.33s/it, atk: -35.631 ent: -4.887 str: 0.000 loss: -40.519]Iterations:  17%|█▋        | 5/30 [00:08<00:33,  1.33s/it, atk: -39.658 ent: -4.885 str: 0.000 loss: -44.543]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.32s/it, atk: -39.658 ent: -4.885 str: 0.000 loss: -44.543]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.32s/it, atk: -41.431 ent: -4.882 str: 0.000 loss: -46.313]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.38s/it, atk: -41.431 ent: -4.882 str: 0.000 loss: -46.313]Iterations:  23%|██▎       | 7/30 [00:11<00:31,  1.38s/it, atk: -47.728 ent: -4.878 str: 0.000 loss: -52.606]Iterations:  27%|██▋       | 8/30 [00:11<00:29,  1.35s/it, atk: -47.728 ent: -4.878 str: 0.000 loss: -52.606]Iterations:  27%|██▋       | 8/30 [00:12<00:29,  1.35s/it, atk: -52.142 ent: -4.875 str: 0.000 loss: -57.017]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.32s/it, atk: -52.142 ent: -4.875 str: 0.000 loss: -57.017]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.32s/it, atk: -54.988 ent: -4.875 str: 0.000 loss: -59.862]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.34s/it, atk: -54.988 ent: -4.875 str: 0.000 loss: -59.862]Iterations:  33%|███▎      | 10/30 [00:15<00:26,  1.34s/it, atk: -60.389 ent: -4.873 str: 0.000 loss: -65.262]Iterations:  37%|███▋      | 11/30 [00:15<00:25,  1.34s/it, atk: -60.389 ent: -4.873 str: 0.000 loss: -65.262]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.34s/it, atk: -64.766 ent: -4.872 str: 0.000 loss: -69.638]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.37s/it, atk: -64.766 ent: -4.872 str: 0.000 loss: -69.638]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.37s/it, atk: -70.482 ent: -4.871 str: 0.000 loss: -75.352]Iterations:  43%|████▎     | 13/30 [00:18<00:22,  1.32s/it, atk: -70.482 ent: -4.871 str: 0.000 loss: -75.352]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.32s/it, atk: -75.708 ent: -4.869 str: 0.000 loss: -80.577]Iterations:  47%|████▋     | 14/30 [00:19<00:20,  1.26s/it, atk: -75.708 ent: -4.869 str: 0.000 loss: -80.577]Iterations:  47%|████▋     | 14/30 [00:20<00:20,  1.26s/it, atk: -80.408 ent: -4.868 str: 0.000 loss: -85.276]Iterations:  50%|█████     | 15/30 [00:20<00:18,  1.23s/it, atk: -80.408 ent: -4.868 str: 0.000 loss: -85.276]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.23s/it, atk: -85.381 ent: -4.867 str: 0.000 loss: -90.247]Iterations:  53%|█████▎    | 16/30 [00:21<00:16,  1.18s/it, atk: -85.381 ent: -4.867 str: 0.000 loss: -90.247]Iterations:  53%|█████▎    | 16/30 [00:22<00:16,  1.18s/it, atk: -90.254 ent: -4.864 str: 0.000 loss: -95.118]Iterations:  57%|█████▋    | 17/30 [00:22<00:15,  1.17s/it, atk: -90.254 ent: -4.864 str: 0.000 loss: -95.118]Iterations:  57%|█████▋    | 17/30 [00:23<00:15,  1.17s/it, atk: -94.464 ent: -4.863 str: 0.000 loss: -99.326]Iterations:  60%|██████    | 18/30 [00:24<00:13,  1.17s/it, atk: -94.464 ent: -4.863 str: 0.000 loss: -99.326]Iterations:  60%|██████    | 18/30 [00:24<00:13,  1.17s/it, atk: -99.609 ent: -4.861 str: 0.000 loss: -104.469]Iterations:  63%|██████▎   | 19/30 [00:25<00:12,  1.15s/it, atk: -99.609 ent: -4.861 str: 0.000 loss: -104.469]Iterations:  63%|██████▎   | 19/30 [00:25<00:12,  1.15s/it, atk: -104.110 ent: -4.859 str: 0.000 loss: -108.969]Iterations:  67%|██████▋   | 20/30 [00:26<00:11,  1.19s/it, atk: -104.110 ent: -4.859 str: 0.000 loss: -108.969]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.19s/it, atk: -106.940 ent: -4.857 str: 0.000 loss: -111.798]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.18s/it, atk: -106.940 ent: -4.857 str: 0.000 loss: -111.798]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.18s/it, atk: -107.165 ent: -4.857 str: 0.000 loss: -112.022]Iterations:  73%|███████▎  | 22/30 [00:28<00:09,  1.15s/it, atk: -107.165 ent: -4.857 str: 0.000 loss: -112.022]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.15s/it, atk: -108.737 ent: -4.858 str: 0.000 loss: -113.595]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.20s/it, atk: -108.737 ent: -4.858 str: 0.000 loss: -113.595]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.20s/it, atk: -109.449 ent: -4.858 str: 0.000 loss: -114.307]Iterations:  80%|████████  | 24/30 [00:31<00:07,  1.18s/it, atk: -109.449 ent: -4.858 str: 0.000 loss: -114.307]Iterations:  80%|████████  | 24/30 [00:31<00:07,  1.18s/it, atk: -110.561 ent: -4.857 str: 0.000 loss: -115.418]Iterations:  83%|████████▎ | 25/30 [00:32<00:05,  1.16s/it, atk: -110.561 ent: -4.857 str: 0.000 loss: -115.418]Iterations:  83%|████████▎ | 25/30 [00:33<00:05,  1.16s/it, atk: -116.899 ent: -4.854 str: 0.000 loss: -121.753]Iterations:  87%|████████▋ | 26/30 [00:33<00:05,  1.27s/it, atk: -116.899 ent: -4.854 str: 0.000 loss: -121.753]Iterations:  87%|████████▋ | 26/30 [00:34<00:05,  1.27s/it, atk: -121.404 ent: -4.850 str: 0.000 loss: -126.254]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.24s/it, atk: -121.404 ent: -4.850 str: 0.000 loss: -126.254]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.24s/it, atk: -125.168 ent: -4.847 str: 0.000 loss: -130.015]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.20s/it, atk: -125.168 ent: -4.847 str: 0.000 loss: -130.015]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.20s/it, atk: -128.013 ent: -4.845 str: 0.000 loss: -132.858]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.21s/it, atk: -128.013 ent: -4.845 str: 0.000 loss: -132.858]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.21s/it, atk: -132.621 ent: -4.844 str: 0.000 loss: -137.466]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.16s/it, atk: -132.621 ent: -4.844 str: 0.000 loss: -137.466]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.28s/it, atk: -132.621 ent: -4.844 str: 0.000 loss: -137.466]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([926], device='cuda:0') tensor(0.9918, device='cuda:0')
after_true: tensor([959], device='cuda:0') tensor(1.0179e-06, device='cuda:0')
L1: [3729.9492]	L2: [25.741484]	Linf: [0.8666667]

Accuracy on benign examples: 100.0%
gt_label: 959 pred_label: 959 pred_clean_logit 0.9950985312461853
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.95it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.19it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.07it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.34it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 10.65it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:01,  9.72it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00, 10.76it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.87it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  9.50it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.03it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  8.90it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  8.78it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.80it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.43it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.60s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.31s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:04,  2.36s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6322
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.061 ent: -4.917 str: 0.000 loss: -4.978]Iterations:   3%|▎         | 1/30 [00:03<01:32,  3.18s/it, atk: -0.061 ent: -4.917 str: 0.000 loss: -4.978]Iterations:   3%|▎         | 1/30 [00:03<01:32,  3.18s/it, atk: -0.198 ent: -4.907 str: 0.000 loss: -5.105]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.79s/it, atk: -0.198 ent: -4.907 str: 0.000 loss: -5.105]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.79s/it, atk: -0.567 ent: -4.923 str: 0.000 loss: -5.490]Iterations:  10%|█         | 3/30 [00:05<00:42,  1.58s/it, atk: -0.567 ent: -4.923 str: 0.000 loss: -5.490]Iterations:  10%|█         | 3/30 [00:06<00:42,  1.58s/it, atk: -1.624 ent: -4.919 str: 0.000 loss: -6.543]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.53s/it, atk: -1.624 ent: -4.919 str: 0.000 loss: -6.543]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.53s/it, atk: -2.658 ent: -4.906 str: 0.000 loss: -7.564]Iterations:  17%|█▋        | 5/30 [00:07<00:33,  1.33s/it, atk: -2.658 ent: -4.906 str: 0.000 loss: -7.564]Iterations:  17%|█▋        | 5/30 [00:08<00:33,  1.33s/it, atk: -4.270 ent: -4.904 str: 0.000 loss: -9.175]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.36s/it, atk: -4.270 ent: -4.904 str: 0.000 loss: -9.175]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.36s/it, atk: -8.275 ent: -4.907 str: 0.000 loss: -13.182]Iterations:  23%|██▎       | 7/30 [00:10<00:29,  1.29s/it, atk: -8.275 ent: -4.907 str: 0.000 loss: -13.182]Iterations:  23%|██▎       | 7/30 [00:10<00:29,  1.29s/it, atk: -11.535 ent: -4.910 str: 0.000 loss: -16.445]Iterations:  27%|██▋       | 8/30 [00:11<00:28,  1.27s/it, atk: -11.535 ent: -4.910 str: 0.000 loss: -16.445]Iterations:  27%|██▋       | 8/30 [00:12<00:28,  1.27s/it, atk: -18.888 ent: -4.908 str: 0.000 loss: -23.796]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.35s/it, atk: -18.888 ent: -4.908 str: 0.000 loss: -23.796]Iterations:  30%|███       | 9/30 [00:13<00:28,  1.35s/it, atk: -24.215 ent: -4.904 str: 0.000 loss: -29.119]Iterations:  33%|███▎      | 10/30 [00:14<00:27,  1.35s/it, atk: -24.215 ent: -4.904 str: 0.000 loss: -29.119]Iterations:  33%|███▎      | 10/30 [00:15<00:27,  1.35s/it, atk: -29.111 ent: -4.909 str: 0.000 loss: -34.021]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.28s/it, atk: -29.111 ent: -4.909 str: 0.000 loss: -34.021]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.28s/it, atk: -35.069 ent: -4.913 str: 0.000 loss: -39.982]Iterations:  40%|████      | 12/30 [00:16<00:21,  1.17s/it, atk: -35.069 ent: -4.913 str: 0.000 loss: -39.982]Iterations:  40%|████      | 12/30 [00:17<00:21,  1.17s/it, atk: -37.255 ent: -4.906 str: 0.000 loss: -42.160]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.25s/it, atk: -37.255 ent: -4.906 str: 0.000 loss: -42.160]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.25s/it, atk: -40.539 ent: -4.905 str: 0.000 loss: -45.443]Iterations:  47%|████▋     | 14/30 [00:19<00:19,  1.24s/it, atk: -40.539 ent: -4.905 str: 0.000 loss: -45.443]Iterations:  47%|████▋     | 14/30 [00:19<00:19,  1.24s/it, atk: -39.125 ent: -4.905 str: 0.000 loss: -44.031]Iterations:  50%|█████     | 15/30 [00:20<00:19,  1.28s/it, atk: -39.125 ent: -4.905 str: 0.000 loss: -44.031]Iterations:  50%|█████     | 15/30 [00:20<00:19,  1.28s/it, atk: -38.774 ent: -4.907 str: 0.000 loss: -43.682]Iterations:  53%|█████▎    | 16/30 [00:21<00:16,  1.21s/it, atk: -38.774 ent: -4.907 str: 0.000 loss: -43.682]Iterations:  53%|█████▎    | 16/30 [00:22<00:16,  1.21s/it, atk: -37.269 ent: -4.908 str: 0.000 loss: -42.176]Iterations:  57%|█████▋    | 17/30 [00:22<00:16,  1.28s/it, atk: -37.269 ent: -4.908 str: 0.000 loss: -42.176]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.28s/it, atk: -36.485 ent: -4.908 str: 0.000 loss: -41.393]Iterations:  60%|██████    | 18/30 [00:23<00:14,  1.19s/it, atk: -36.485 ent: -4.908 str: 0.000 loss: -41.393]Iterations:  60%|██████    | 18/30 [00:24<00:14,  1.19s/it, atk: -36.238 ent: -4.909 str: 0.000 loss: -41.146]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.24s/it, atk: -36.238 ent: -4.909 str: 0.000 loss: -41.146]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.24s/it, atk: -36.697 ent: -4.910 str: 0.000 loss: -41.608]Iterations:  67%|██████▋   | 20/30 [00:26<00:11,  1.18s/it, atk: -36.697 ent: -4.910 str: 0.000 loss: -41.608]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.18s/it, atk: -37.008 ent: -4.911 str: 0.000 loss: -41.919]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.21s/it, atk: -37.008 ent: -4.911 str: 0.000 loss: -41.919]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.21s/it, atk: -37.933 ent: -4.912 str: 0.000 loss: -42.845]Iterations:  73%|███████▎  | 22/30 [00:28<00:09,  1.15s/it, atk: -37.933 ent: -4.912 str: 0.000 loss: -42.845]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.15s/it, atk: -39.400 ent: -4.912 str: 0.000 loss: -44.312]Iterations:  77%|███████▋  | 23/30 [00:29<00:07,  1.12s/it, atk: -39.400 ent: -4.912 str: 0.000 loss: -44.312]Iterations:  77%|███████▋  | 23/30 [00:30<00:07,  1.12s/it, atk: -41.058 ent: -4.910 str: 0.000 loss: -45.969]Iterations:  80%|████████  | 24/30 [00:30<00:06,  1.11s/it, atk: -41.058 ent: -4.910 str: 0.000 loss: -45.969]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.11s/it, atk: -43.180 ent: -4.909 str: 0.000 loss: -48.089]Iterations:  83%|████████▎ | 25/30 [00:31<00:05,  1.03s/it, atk: -43.180 ent: -4.909 str: 0.000 loss: -48.089]Iterations:  83%|████████▎ | 25/30 [00:32<00:05,  1.03s/it, atk: -45.212 ent: -4.908 str: 0.000 loss: -50.120]Iterations:  87%|████████▋ | 26/30 [00:32<00:04,  1.12s/it, atk: -45.212 ent: -4.908 str: 0.000 loss: -50.120]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.12s/it, atk: -47.599 ent: -4.906 str: 0.000 loss: -52.505]Iterations:  90%|█████████ | 27/30 [00:33<00:03,  1.09s/it, atk: -47.599 ent: -4.906 str: 0.000 loss: -52.505]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.09s/it, atk: -49.816 ent: -4.905 str: 0.000 loss: -54.721]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.12s/it, atk: -49.816 ent: -4.905 str: 0.000 loss: -54.721]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.12s/it, atk: -52.033 ent: -4.904 str: 0.000 loss: -56.937]Iterations:  97%|█████████▋| 29/30 [00:36<00:01,  1.22s/it, atk: -52.033 ent: -4.904 str: 0.000 loss: -56.937]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.22s/it, atk: -54.476 ent: -4.903 str: 0.000 loss: -59.379]Iterations: 100%|██████████| 30/30 [00:37<00:00,  1.17s/it, atk: -54.476 ent: -4.903 str: 0.000 loss: -59.379]Iterations: 100%|██████████| 30/30 [00:37<00:00,  1.26s/it, atk: -54.476 ent: -4.903 str: 0.000 loss: -59.379]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([996], device='cuda:0') tensor(0.6790, device='cuda:0')
after_true: tensor([959], device='cuda:0') tensor(0.0034, device='cuda:0')
L1: [2839.4746]	L2: [18.962244]	Linf: [0.7176471]

Accuracy on benign examples: 100.0%
gt_label: 422 pred_label: 422 pred_clean_logit 0.21040280163288116
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.24it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  6.59it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.53it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.04it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.26it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.16it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  8.78it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  9.99it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.54it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  9.61it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 10.88it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  9.16it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  9.16it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.21it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.05it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.01s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:04,  2.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5687
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -23.543 ent: -5.040 str: 0.000 loss: -28.583]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.43s/it, atk: -23.543 ent: -5.040 str: 0.000 loss: -28.583]Iterations:   3%|▎         | 1/30 [00:03<01:10,  2.43s/it, atk: -31.223 ent: -5.029 str: 0.000 loss: -36.252]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.64s/it, atk: -31.223 ent: -5.029 str: 0.000 loss: -36.252]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.64s/it, atk: -41.998 ent: -5.024 str: 0.000 loss: -47.022]Iterations:  10%|█         | 3/30 [00:04<00:39,  1.45s/it, atk: -41.998 ent: -5.024 str: 0.000 loss: -47.022]Iterations:  10%|█         | 3/30 [00:05<00:39,  1.45s/it, atk: -53.600 ent: -5.033 str: 0.000 loss: -58.633]Iterations:  13%|█▎        | 4/30 [00:05<00:33,  1.29s/it, atk: -53.600 ent: -5.033 str: 0.000 loss: -58.633]Iterations:  13%|█▎        | 4/30 [00:06<00:33,  1.29s/it, atk: -59.683 ent: -5.032 str: 0.000 loss: -64.715]Iterations:  17%|█▋        | 5/30 [00:06<00:31,  1.26s/it, atk: -59.683 ent: -5.032 str: 0.000 loss: -64.715]Iterations:  17%|█▋        | 5/30 [00:07<00:31,  1.26s/it, atk: -70.543 ent: -5.025 str: 0.000 loss: -75.568]Iterations:  20%|██        | 6/30 [00:08<00:33,  1.41s/it, atk: -70.543 ent: -5.025 str: 0.000 loss: -75.568]Iterations:  20%|██        | 6/30 [00:09<00:33,  1.41s/it, atk: -77.844 ent: -5.018 str: 0.000 loss: -82.861]Iterations:  23%|██▎       | 7/30 [00:09<00:29,  1.28s/it, atk: -77.844 ent: -5.018 str: 0.000 loss: -82.861]Iterations:  23%|██▎       | 7/30 [00:10<00:29,  1.28s/it, atk: -85.088 ent: -5.016 str: 0.000 loss: -90.105]Iterations:  27%|██▋       | 8/30 [00:10<00:27,  1.26s/it, atk: -85.088 ent: -5.016 str: 0.000 loss: -90.105]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.26s/it, atk: -91.770 ent: -5.014 str: 0.000 loss: -96.783]Iterations:  30%|███       | 9/30 [00:11<00:25,  1.20s/it, atk: -91.770 ent: -5.014 str: 0.000 loss: -96.783]Iterations:  30%|███       | 9/30 [00:12<00:25,  1.20s/it, atk: -97.226 ent: -5.011 str: 0.000 loss: -102.237]Iterations:  33%|███▎      | 10/30 [00:13<00:25,  1.26s/it, atk: -97.226 ent: -5.011 str: 0.000 loss: -102.237]Iterations:  33%|███▎      | 10/30 [00:14<00:25,  1.26s/it, atk: -103.767 ent: -5.011 str: 0.000 loss: -108.778]Iterations:  37%|███▋      | 11/30 [00:14<00:25,  1.32s/it, atk: -103.767 ent: -5.011 str: 0.000 loss: -108.778]Iterations:  37%|███▋      | 11/30 [00:15<00:25,  1.32s/it, atk: -109.843 ent: -5.010 str: 0.000 loss: -114.853]Iterations:  40%|████      | 12/30 [00:16<00:23,  1.33s/it, atk: -109.843 ent: -5.010 str: 0.000 loss: -114.853]Iterations:  40%|████      | 12/30 [00:17<00:23,  1.33s/it, atk: -117.077 ent: -5.007 str: 0.000 loss: -122.084]Iterations:  43%|████▎     | 13/30 [00:17<00:23,  1.38s/it, atk: -117.077 ent: -5.007 str: 0.000 loss: -122.084]Iterations:  43%|████▎     | 13/30 [00:18<00:23,  1.38s/it, atk: -125.066 ent: -5.003 str: 0.000 loss: -130.070]Iterations:  47%|████▋     | 14/30 [00:19<00:22,  1.40s/it, atk: -125.066 ent: -5.003 str: 0.000 loss: -130.070]Iterations:  47%|████▋     | 14/30 [00:19<00:22,  1.40s/it, atk: -132.319 ent: -5.001 str: 0.000 loss: -137.320]Iterations:  50%|█████     | 15/30 [00:20<00:21,  1.43s/it, atk: -132.319 ent: -5.001 str: 0.000 loss: -137.320]Iterations:  50%|█████     | 15/30 [00:21<00:21,  1.43s/it, atk: -140.620 ent: -5.001 str: 0.000 loss: -145.621]Iterations:  53%|█████▎    | 16/30 [00:22<00:20,  1.47s/it, atk: -140.620 ent: -5.001 str: 0.000 loss: -145.621]Iterations:  53%|█████▎    | 16/30 [00:22<00:20,  1.47s/it, atk: -146.177 ent: -5.001 str: 0.000 loss: -151.179]Iterations:  57%|█████▋    | 17/30 [00:23<00:18,  1.41s/it, atk: -146.177 ent: -5.001 str: 0.000 loss: -151.179]Iterations:  57%|█████▋    | 17/30 [00:23<00:18,  1.41s/it, atk: -151.980 ent: -5.002 str: 0.000 loss: -156.983]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.30s/it, atk: -151.980 ent: -5.002 str: 0.000 loss: -156.983]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.30s/it, atk: -157.557 ent: -5.003 str: 0.000 loss: -162.560]Iterations:  63%|██████▎   | 19/30 [00:25<00:14,  1.30s/it, atk: -157.557 ent: -5.003 str: 0.000 loss: -162.560]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.30s/it, atk: -163.467 ent: -5.003 str: 0.000 loss: -168.470]Iterations:  67%|██████▋   | 20/30 [00:27<00:13,  1.33s/it, atk: -163.467 ent: -5.003 str: 0.000 loss: -168.470]Iterations:  67%|██████▋   | 20/30 [00:27<00:13,  1.33s/it, atk: -167.631 ent: -5.002 str: 0.000 loss: -172.633]Iterations:  70%|███████   | 21/30 [00:28<00:12,  1.36s/it, atk: -167.631 ent: -5.002 str: 0.000 loss: -172.633]Iterations:  70%|███████   | 21/30 [00:29<00:12,  1.36s/it, atk: -171.952 ent: -5.001 str: 0.000 loss: -176.953]Iterations:  73%|███████▎  | 22/30 [00:30<00:11,  1.41s/it, atk: -171.952 ent: -5.001 str: 0.000 loss: -176.953]Iterations:  73%|███████▎  | 22/30 [00:30<00:11,  1.41s/it, atk: -177.110 ent: -5.000 str: 0.000 loss: -182.110]Iterations:  77%|███████▋  | 23/30 [00:31<00:09,  1.42s/it, atk: -177.110 ent: -5.000 str: 0.000 loss: -182.110]Iterations:  77%|███████▋  | 23/30 [00:32<00:09,  1.42s/it, atk: -181.557 ent: -4.999 str: 0.000 loss: -186.556]Iterations:  80%|████████  | 24/30 [00:33<00:08,  1.50s/it, atk: -181.557 ent: -4.999 str: 0.000 loss: -186.556]Iterations:  80%|████████  | 24/30 [00:33<00:08,  1.50s/it, atk: -186.497 ent: -4.998 str: 0.000 loss: -191.495]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.33s/it, atk: -186.497 ent: -4.998 str: 0.000 loss: -191.495]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.33s/it, atk: -191.213 ent: -4.998 str: 0.000 loss: -196.211]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.39s/it, atk: -191.213 ent: -4.998 str: 0.000 loss: -196.211]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.39s/it, atk: -194.473 ent: -4.998 str: 0.000 loss: -199.471]Iterations:  90%|█████████ | 27/30 [00:37<00:04,  1.37s/it, atk: -194.473 ent: -4.998 str: 0.000 loss: -199.471]Iterations:  90%|█████████ | 27/30 [00:37<00:04,  1.37s/it, atk: -197.635 ent: -4.999 str: 0.000 loss: -202.634]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.41s/it, atk: -197.635 ent: -4.999 str: 0.000 loss: -202.634]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.41s/it, atk: -201.025 ent: -4.999 str: 0.000 loss: -206.023]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.33s/it, atk: -201.025 ent: -4.999 str: 0.000 loss: -206.023]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.33s/it, atk: -204.575 ent: -4.998 str: 0.000 loss: -209.573]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.44s/it, atk: -204.575 ent: -4.998 str: 0.000 loss: -209.573]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.38s/it, atk: -204.575 ent: -4.998 str: 0.000 loss: -209.573]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([409], device='cuda:0') tensor(0.7554, device='cuda:0')
after_true: tensor([422], device='cuda:0') tensor(9.2891e-10, device='cuda:0')
L1: [1991.6705]	L2: [16.570913]	Linf: [0.7372549]

Accuracy on benign examples: 100.0%
gt_label: 859 pred_label: 859 pred_clean_logit 0.9999872446060181
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.65it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  9.10it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.11it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  7.32it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  6.90it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  7.82it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  8.01it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  8.45it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  7.99it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  7.79it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  8.30it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.46it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:02<00:00,  9.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.55it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:11,  2.97s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:06<00:09,  3.14s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:09<00:06,  3.14s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:12<00:03,  3.06s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:16<00:00,  3.30s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:16<00:00,  3.20s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6015
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.001 ent: -2.678 str: 0.000 loss: -2.678]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.70s/it, atk: -0.001 ent: -2.678 str: 0.000 loss: -2.678]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.70s/it, atk: -0.001 ent: -2.705 str: 0.000 loss: -2.706]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.67s/it, atk: -0.001 ent: -2.705 str: 0.000 loss: -2.706]Iterations:   7%|▋         | 2/30 [00:04<00:46,  1.67s/it, atk: -0.001 ent: -2.732 str: 0.000 loss: -2.733]Iterations:  10%|█         | 3/30 [00:05<00:43,  1.60s/it, atk: -0.001 ent: -2.732 str: 0.000 loss: -2.733]Iterations:  10%|█         | 3/30 [00:06<00:43,  1.60s/it, atk: -0.002 ent: -2.754 str: 0.000 loss: -2.756]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.52s/it, atk: -0.002 ent: -2.754 str: 0.000 loss: -2.756]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.52s/it, atk: -0.002 ent: -2.771 str: 0.000 loss: -2.773]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.36s/it, atk: -0.002 ent: -2.771 str: 0.000 loss: -2.773]Iterations:  17%|█▋        | 5/30 [00:08<00:34,  1.36s/it, atk: -0.003 ent: -2.786 str: 0.000 loss: -2.789]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.37s/it, atk: -0.003 ent: -2.786 str: 0.000 loss: -2.789]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.37s/it, atk: -0.005 ent: -2.800 str: 0.000 loss: -2.805]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.38s/it, atk: -0.005 ent: -2.800 str: 0.000 loss: -2.805]Iterations:  23%|██▎       | 7/30 [00:11<00:31,  1.38s/it, atk: -0.008 ent: -2.813 str: 0.000 loss: -2.820]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.45s/it, atk: -0.008 ent: -2.813 str: 0.000 loss: -2.820]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.45s/it, atk: -0.012 ent: -2.824 str: 0.000 loss: -2.836]Iterations:  30%|███       | 9/30 [00:13<00:29,  1.42s/it, atk: -0.012 ent: -2.824 str: 0.000 loss: -2.836]Iterations:  30%|███       | 9/30 [00:14<00:29,  1.42s/it, atk: -0.025 ent: -2.834 str: 0.000 loss: -2.859]Iterations:  33%|███▎      | 10/30 [00:14<00:28,  1.41s/it, atk: -0.025 ent: -2.834 str: 0.000 loss: -2.859]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.41s/it, atk: -0.045 ent: -2.842 str: 0.000 loss: -2.887]Iterations:  37%|███▋      | 11/30 [00:16<00:28,  1.48s/it, atk: -0.045 ent: -2.842 str: 0.000 loss: -2.887]Iterations:  37%|███▋      | 11/30 [00:17<00:28,  1.48s/it, atk: -0.085 ent: -2.848 str: 0.000 loss: -2.933]Iterations:  40%|████      | 12/30 [00:17<00:27,  1.50s/it, atk: -0.085 ent: -2.848 str: 0.000 loss: -2.933]Iterations:  40%|████      | 12/30 [00:19<00:27,  1.50s/it, atk: -0.153 ent: -2.851 str: 0.000 loss: -3.004]Iterations:  43%|████▎     | 13/30 [00:19<00:26,  1.53s/it, atk: -0.153 ent: -2.851 str: 0.000 loss: -3.004]Iterations:  43%|████▎     | 13/30 [00:20<00:26,  1.53s/it, atk: -0.332 ent: -2.853 str: 0.000 loss: -3.184]Iterations:  47%|████▋     | 14/30 [00:20<00:23,  1.49s/it, atk: -0.332 ent: -2.853 str: 0.000 loss: -3.184]Iterations:  47%|████▋     | 14/30 [00:21<00:23,  1.49s/it, atk: -0.646 ent: -2.853 str: 0.000 loss: -3.499]Iterations:  50%|█████     | 15/30 [00:22<00:21,  1.46s/it, atk: -0.646 ent: -2.853 str: 0.000 loss: -3.499]Iterations:  50%|█████     | 15/30 [00:22<00:21,  1.46s/it, atk: -0.641 ent: -2.849 str: 0.000 loss: -3.489]Iterations:  53%|█████▎    | 16/30 [00:23<00:18,  1.34s/it, atk: -0.641 ent: -2.849 str: 0.000 loss: -3.489]Iterations:  53%|█████▎    | 16/30 [00:24<00:18,  1.34s/it, atk: -1.247 ent: -2.848 str: 0.000 loss: -4.094]Iterations:  57%|█████▋    | 17/30 [00:24<00:17,  1.36s/it, atk: -1.247 ent: -2.848 str: 0.000 loss: -4.094]Iterations:  57%|█████▋    | 17/30 [00:25<00:17,  1.36s/it, atk: -2.244 ent: -2.848 str: 0.000 loss: -5.092]Iterations:  60%|██████    | 18/30 [00:25<00:15,  1.30s/it, atk: -2.244 ent: -2.848 str: 0.000 loss: -5.092]Iterations:  60%|██████    | 18/30 [00:26<00:15,  1.30s/it, atk: -2.611 ent: -2.848 str: 0.000 loss: -5.459]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.31s/it, atk: -2.611 ent: -2.848 str: 0.000 loss: -5.459]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.31s/it, atk: -5.074 ent: -2.846 str: 0.000 loss: -7.921]Iterations:  67%|██████▋   | 20/30 [00:28<00:12,  1.24s/it, atk: -5.074 ent: -2.846 str: 0.000 loss: -7.921]Iterations:  67%|██████▋   | 20/30 [00:28<00:12,  1.24s/it, atk: -6.588 ent: -2.843 str: 0.000 loss: -9.431]Iterations:  70%|███████   | 21/30 [00:29<00:10,  1.21s/it, atk: -6.588 ent: -2.843 str: 0.000 loss: -9.431]Iterations:  70%|███████   | 21/30 [00:30<00:10,  1.21s/it, atk: -9.340 ent: -2.841 str: 0.000 loss: -12.181]Iterations:  73%|███████▎  | 22/30 [00:30<00:10,  1.25s/it, atk: -9.340 ent: -2.841 str: 0.000 loss: -12.181]Iterations:  73%|███████▎  | 22/30 [00:31<00:10,  1.25s/it, atk: -13.135 ent: -2.840 str: 0.000 loss: -15.975]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.20s/it, atk: -13.135 ent: -2.840 str: 0.000 loss: -15.975]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.20s/it, atk: -16.036 ent: -2.839 str: 0.000 loss: -18.876]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.21s/it, atk: -16.036 ent: -2.839 str: 0.000 loss: -18.876]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.21s/it, atk: -19.817 ent: -2.838 str: 0.000 loss: -22.655]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.23s/it, atk: -19.817 ent: -2.838 str: 0.000 loss: -22.655]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.23s/it, atk: -22.534 ent: -2.837 str: 0.000 loss: -25.372]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.31s/it, atk: -22.534 ent: -2.837 str: 0.000 loss: -25.372]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.31s/it, atk: -26.490 ent: -2.835 str: 0.000 loss: -29.325]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.28s/it, atk: -26.490 ent: -2.835 str: 0.000 loss: -29.325]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.28s/it, atk: -31.337 ent: -2.835 str: 0.000 loss: -34.172]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.20s/it, atk: -31.337 ent: -2.835 str: 0.000 loss: -34.172]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.20s/it, atk: -35.805 ent: -2.834 str: 0.000 loss: -38.639]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.23s/it, atk: -35.805 ent: -2.834 str: 0.000 loss: -38.639]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.23s/it, atk: -42.311 ent: -2.834 str: 0.000 loss: -45.145]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.19s/it, atk: -42.311 ent: -2.834 str: 0.000 loss: -45.145]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.35s/it, atk: -42.311 ent: -2.834 str: 0.000 loss: -45.145]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([941], device='cuda:0') tensor(0.7159, device='cuda:0')
after_true: tensor([859], device='cuda:0') tensor(0.0079, device='cuda:0')
L1: [2373.7568]	L2: [17.281557]	Linf: [0.6509804]

Accuracy on benign examples: 100.0%
gt_label: 640 pred_label: 640 pred_clean_logit 0.9997902512550354
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.67it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.03it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.03it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  9.42it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  8.81it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 10.64it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.18it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  8.65it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  9.16it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 10.28it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00,  9.20it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00,  9.53it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.56s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.39s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  3.10s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.87s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6259
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.001 ent: -7.872 str: 0.000 loss: -7.873]Iterations:   3%|▎         | 1/30 [00:03<01:39,  3.42s/it, atk: -0.001 ent: -7.872 str: 0.000 loss: -7.873]Iterations:   3%|▎         | 1/30 [00:04<01:39,  3.42s/it, atk: -0.002 ent: -8.025 str: 0.000 loss: -8.027]Iterations:   7%|▋         | 2/30 [00:04<01:01,  2.21s/it, atk: -0.002 ent: -8.025 str: 0.000 loss: -8.027]Iterations:   7%|▋         | 2/30 [00:05<01:01,  2.21s/it, atk: -0.002 ent: -8.085 str: 0.000 loss: -8.087]Iterations:  10%|█         | 3/30 [00:06<00:49,  1.83s/it, atk: -0.002 ent: -8.085 str: 0.000 loss: -8.087]Iterations:  10%|█         | 3/30 [00:06<00:49,  1.83s/it, atk: -0.002 ent: -8.141 str: 0.000 loss: -8.142]Iterations:  13%|█▎        | 4/30 [00:07<00:43,  1.66s/it, atk: -0.002 ent: -8.141 str: 0.000 loss: -8.142]Iterations:  13%|█▎        | 4/30 [00:08<00:43,  1.66s/it, atk: -0.002 ent: -8.185 str: 0.000 loss: -8.187]Iterations:  17%|█▋        | 5/30 [00:08<00:37,  1.52s/it, atk: -0.002 ent: -8.185 str: 0.000 loss: -8.187]Iterations:  17%|█▋        | 5/30 [00:09<00:37,  1.52s/it, atk: -0.002 ent: -8.235 str: 0.000 loss: -8.237]Iterations:  20%|██        | 6/30 [00:10<00:34,  1.43s/it, atk: -0.002 ent: -8.235 str: 0.000 loss: -8.237]Iterations:  20%|██        | 6/30 [00:10<00:34,  1.43s/it, atk: -0.002 ent: -8.274 str: 0.000 loss: -8.275]Iterations:  23%|██▎       | 7/30 [00:11<00:32,  1.43s/it, atk: -0.002 ent: -8.274 str: 0.000 loss: -8.275]Iterations:  23%|██▎       | 7/30 [00:12<00:32,  1.43s/it, atk: -0.002 ent: -8.302 str: 0.000 loss: -8.303]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.44s/it, atk: -0.002 ent: -8.302 str: 0.000 loss: -8.303]Iterations:  27%|██▋       | 8/30 [00:13<00:31,  1.44s/it, atk: -0.002 ent: -8.334 str: 0.000 loss: -8.337]Iterations:  30%|███       | 9/30 [00:14<00:29,  1.40s/it, atk: -0.002 ent: -8.334 str: 0.000 loss: -8.337]Iterations:  30%|███       | 9/30 [00:15<00:29,  1.40s/it, atk: -0.002 ent: -8.364 str: 0.000 loss: -8.366]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.43s/it, atk: -0.002 ent: -8.364 str: 0.000 loss: -8.366]Iterations:  33%|███▎      | 10/30 [00:16<00:28,  1.43s/it, atk: -0.002 ent: -8.386 str: 0.000 loss: -8.388]Iterations:  37%|███▋      | 11/30 [00:17<00:27,  1.43s/it, atk: -0.002 ent: -8.386 str: 0.000 loss: -8.388]Iterations:  37%|███▋      | 11/30 [00:18<00:27,  1.43s/it, atk: -0.002 ent: -8.410 str: 0.000 loss: -8.411]Iterations:  40%|████      | 12/30 [00:18<00:26,  1.45s/it, atk: -0.002 ent: -8.410 str: 0.000 loss: -8.411]Iterations:  40%|████      | 12/30 [00:19<00:26,  1.45s/it, atk: -0.001 ent: -8.432 str: 0.000 loss: -8.433]Iterations:  43%|████▎     | 13/30 [00:19<00:23,  1.39s/it, atk: -0.001 ent: -8.432 str: 0.000 loss: -8.433]Iterations:  43%|████▎     | 13/30 [00:20<00:23,  1.39s/it, atk: -0.001 ent: -8.454 str: 0.000 loss: -8.455]Iterations:  47%|████▋     | 14/30 [00:21<00:22,  1.39s/it, atk: -0.001 ent: -8.454 str: 0.000 loss: -8.455]Iterations:  47%|████▋     | 14/30 [00:21<00:22,  1.39s/it, atk: -0.001 ent: -8.475 str: 0.000 loss: -8.476]Iterations:  50%|█████     | 15/30 [00:22<00:19,  1.30s/it, atk: -0.001 ent: -8.475 str: 0.000 loss: -8.476]Iterations:  50%|█████     | 15/30 [00:23<00:19,  1.30s/it, atk: -0.001 ent: -8.494 str: 0.000 loss: -8.495]Iterations:  53%|█████▎    | 16/30 [00:23<00:17,  1.27s/it, atk: -0.001 ent: -8.494 str: 0.000 loss: -8.495]Iterations:  53%|█████▎    | 16/30 [00:24<00:17,  1.27s/it, atk: -0.002 ent: -8.513 str: 0.000 loss: -8.515]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.25s/it, atk: -0.002 ent: -8.513 str: 0.000 loss: -8.515]Iterations:  57%|█████▋    | 17/30 [00:25<00:16,  1.25s/it, atk: -0.002 ent: -8.532 str: 0.000 loss: -8.534]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.21s/it, atk: -0.002 ent: -8.532 str: 0.000 loss: -8.534]Iterations:  60%|██████    | 18/30 [00:26<00:14,  1.21s/it, atk: -0.002 ent: -8.550 str: 0.000 loss: -8.552]Iterations:  63%|██████▎   | 19/30 [00:27<00:13,  1.22s/it, atk: -0.002 ent: -8.550 str: 0.000 loss: -8.552]Iterations:  63%|██████▎   | 19/30 [00:28<00:13,  1.22s/it, atk: -0.002 ent: -8.568 str: 0.000 loss: -8.570]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.31s/it, atk: -0.002 ent: -8.568 str: 0.000 loss: -8.570]Iterations:  67%|██████▋   | 20/30 [00:29<00:13,  1.31s/it, atk: -0.002 ent: -8.585 str: 0.000 loss: -8.587]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.25s/it, atk: -0.002 ent: -8.585 str: 0.000 loss: -8.587]Iterations:  70%|███████   | 21/30 [00:30<00:11,  1.25s/it, atk: -0.002 ent: -8.602 str: 0.000 loss: -8.604]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.19s/it, atk: -0.002 ent: -8.602 str: 0.000 loss: -8.604]Iterations:  73%|███████▎  | 22/30 [00:31<00:09,  1.19s/it, atk: -0.002 ent: -8.619 str: 0.000 loss: -8.621]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.17s/it, atk: -0.002 ent: -8.619 str: 0.000 loss: -8.621]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.17s/it, atk: -0.003 ent: -8.635 str: 0.000 loss: -8.637]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.23s/it, atk: -0.003 ent: -8.635 str: 0.000 loss: -8.637]Iterations:  80%|████████  | 24/30 [00:34<00:07,  1.23s/it, atk: -0.003 ent: -8.651 str: 0.000 loss: -8.653]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.32s/it, atk: -0.003 ent: -8.651 str: 0.000 loss: -8.653]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.32s/it, atk: -0.002 ent: -8.668 str: 0.000 loss: -8.670]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.37s/it, atk: -0.002 ent: -8.668 str: 0.000 loss: -8.670]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.37s/it, atk: -0.002 ent: -8.684 str: 0.000 loss: -8.686]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.32s/it, atk: -0.002 ent: -8.684 str: 0.000 loss: -8.686]Iterations:  90%|█████████ | 27/30 [00:38<00:03,  1.32s/it, atk: -0.002 ent: -8.700 str: 0.000 loss: -8.702]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.30s/it, atk: -0.002 ent: -8.700 str: 0.000 loss: -8.702]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.30s/it, atk: -0.002 ent: -8.715 str: 0.000 loss: -8.717]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.43s/it, atk: -0.002 ent: -8.715 str: 0.000 loss: -8.717]Iterations:  97%|█████████▋| 29/30 [00:41<00:01,  1.43s/it, atk: -0.002 ent: -8.730 str: 0.000 loss: -8.733]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.44s/it, atk: -0.002 ent: -8.730 str: 0.000 loss: -8.733]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.40s/it, atk: -0.002 ent: -8.730 str: 0.000 loss: -8.733]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 100.0%
after_pred: tensor([640], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([640], device='cuda:0') tensor(0.9997, device='cuda:0')
L1: [4099.7295]	L2: [26.767603]	Linf: [0.6862745]

Accuracy on benign examples: 100.0%
gt_label: 649 pred_label: 649 pred_clean_logit 0.999041736125946
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.55it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.90it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.03it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.39it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:01,  9.15it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  7.10it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  8.60it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  8.46it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.26it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  9.42it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00,  9.70it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.30s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.28s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.33s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.93s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4990
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.016 ent: -5.119 str: 0.000 loss: -5.135]Iterations:   3%|▎         | 1/30 [00:01<00:57,  1.99s/it, atk: -0.016 ent: -5.119 str: 0.000 loss: -5.135]Iterations:   3%|▎         | 1/30 [00:02<00:57,  1.99s/it, atk: -0.445 ent: -5.131 str: 0.000 loss: -5.576]Iterations:   7%|▋         | 2/30 [00:03<00:44,  1.60s/it, atk: -0.445 ent: -5.131 str: 0.000 loss: -5.576]Iterations:   7%|▋         | 2/30 [00:04<00:44,  1.60s/it, atk: -2.341 ent: -5.121 str: 0.000 loss: -7.462]Iterations:  10%|█         | 3/30 [00:04<00:43,  1.61s/it, atk: -2.341 ent: -5.121 str: 0.000 loss: -7.462]Iterations:  10%|█         | 3/30 [00:05<00:43,  1.61s/it, atk: -11.104 ent: -5.108 str: 0.000 loss: -16.212]Iterations:  13%|█▎        | 4/30 [00:06<00:41,  1.58s/it, atk: -11.104 ent: -5.108 str: 0.000 loss: -16.212]Iterations:  13%|█▎        | 4/30 [00:07<00:41,  1.58s/it, atk: -18.489 ent: -5.109 str: 0.000 loss: -23.598]Iterations:  17%|█▋        | 5/30 [00:07<00:35,  1.43s/it, atk: -18.489 ent: -5.109 str: 0.000 loss: -23.598]Iterations:  17%|█▋        | 5/30 [00:08<00:35,  1.43s/it, atk: -27.321 ent: -5.118 str: 0.000 loss: -32.439]Iterations:  20%|██        | 6/30 [00:09<00:35,  1.47s/it, atk: -27.321 ent: -5.118 str: 0.000 loss: -32.439]Iterations:  20%|██        | 6/30 [00:10<00:35,  1.47s/it, atk: -34.823 ent: -5.122 str: 0.000 loss: -39.945]Iterations:  23%|██▎       | 7/30 [00:10<00:33,  1.47s/it, atk: -34.823 ent: -5.122 str: 0.000 loss: -39.945]Iterations:  23%|██▎       | 7/30 [00:11<00:33,  1.47s/it, atk: -44.874 ent: -5.119 str: 0.000 loss: -49.993]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.43s/it, atk: -44.874 ent: -5.119 str: 0.000 loss: -49.993]Iterations:  27%|██▋       | 8/30 [00:12<00:31,  1.43s/it, atk: -51.409 ent: -5.112 str: 0.000 loss: -56.521]Iterations:  30%|███       | 9/30 [00:13<00:29,  1.43s/it, atk: -51.409 ent: -5.112 str: 0.000 loss: -56.521]Iterations:  30%|███       | 9/30 [00:14<00:29,  1.43s/it, atk: -62.669 ent: -5.118 str: 0.000 loss: -67.787]Iterations:  33%|███▎      | 10/30 [00:14<00:28,  1.41s/it, atk: -62.669 ent: -5.118 str: 0.000 loss: -67.787]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.41s/it, atk: -77.270 ent: -5.112 str: 0.000 loss: -82.382]Iterations:  37%|███▋      | 11/30 [00:16<00:28,  1.48s/it, atk: -77.270 ent: -5.112 str: 0.000 loss: -82.382]Iterations:  37%|███▋      | 11/30 [00:17<00:28,  1.48s/it, atk: -86.435 ent: -5.103 str: 0.000 loss: -91.538]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.38s/it, atk: -86.435 ent: -5.103 str: 0.000 loss: -91.538]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.38s/it, atk: -95.353 ent: -5.098 str: 0.000 loss: -100.452]Iterations:  43%|████▎     | 13/30 [00:19<00:23,  1.41s/it, atk: -95.353 ent: -5.098 str: 0.000 loss: -100.452]Iterations:  43%|████▎     | 13/30 [00:19<00:23,  1.41s/it, atk: -108.409 ent: -5.097 str: 0.000 loss: -113.506]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.34s/it, atk: -108.409 ent: -5.097 str: 0.000 loss: -113.506]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.34s/it, atk: -118.038 ent: -5.094 str: 0.000 loss: -123.132]Iterations:  50%|█████     | 15/30 [00:21<00:19,  1.29s/it, atk: -118.038 ent: -5.094 str: 0.000 loss: -123.132]Iterations:  50%|█████     | 15/30 [00:22<00:19,  1.29s/it, atk: -123.857 ent: -5.093 str: 0.000 loss: -128.950]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.22s/it, atk: -123.857 ent: -5.093 str: 0.000 loss: -128.950]Iterations:  53%|█████▎    | 16/30 [00:23<00:17,  1.22s/it, atk: -133.482 ent: -5.093 str: 0.000 loss: -138.575]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.28s/it, atk: -133.482 ent: -5.093 str: 0.000 loss: -138.575]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.28s/it, atk: -142.559 ent: -5.096 str: 0.000 loss: -147.655]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.25s/it, atk: -142.559 ent: -5.096 str: 0.000 loss: -147.655]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.25s/it, atk: -150.971 ent: -5.093 str: 0.000 loss: -156.065]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.28s/it, atk: -150.971 ent: -5.093 str: 0.000 loss: -156.065]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.28s/it, atk: -159.149 ent: -5.093 str: 0.000 loss: -164.243]Iterations:  67%|██████▋   | 20/30 [00:27<00:13,  1.35s/it, atk: -159.149 ent: -5.093 str: 0.000 loss: -164.243]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.35s/it, atk: -166.119 ent: -5.093 str: 0.000 loss: -171.213]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.29s/it, atk: -166.119 ent: -5.093 str: 0.000 loss: -171.213]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.29s/it, atk: -174.692 ent: -5.094 str: 0.000 loss: -179.786]Iterations:  73%|███████▎  | 22/30 [00:30<00:09,  1.24s/it, atk: -174.692 ent: -5.094 str: 0.000 loss: -179.786]Iterations:  73%|███████▎  | 22/30 [00:31<00:09,  1.24s/it, atk: -178.457 ent: -5.094 str: 0.000 loss: -183.551]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.26s/it, atk: -178.457 ent: -5.094 str: 0.000 loss: -183.551]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.26s/it, atk: -187.183 ent: -5.092 str: 0.000 loss: -192.275]Iterations:  80%|████████  | 24/30 [00:32<00:07,  1.31s/it, atk: -187.183 ent: -5.092 str: 0.000 loss: -192.275]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.31s/it, atk: -192.794 ent: -5.090 str: 0.000 loss: -197.885]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.37s/it, atk: -192.794 ent: -5.090 str: 0.000 loss: -197.885]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.37s/it, atk: -200.299 ent: -5.090 str: 0.000 loss: -205.389]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.30s/it, atk: -200.299 ent: -5.090 str: 0.000 loss: -205.389]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.30s/it, atk: -207.343 ent: -5.090 str: 0.000 loss: -212.432]Iterations:  90%|█████████ | 27/30 [00:36<00:03,  1.30s/it, atk: -207.343 ent: -5.090 str: 0.000 loss: -212.432]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.30s/it, atk: -213.624 ent: -5.091 str: 0.000 loss: -218.715]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.25s/it, atk: -213.624 ent: -5.091 str: 0.000 loss: -218.715]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.25s/it, atk: -216.825 ent: -5.092 str: 0.000 loss: -221.917]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.34s/it, atk: -216.825 ent: -5.092 str: 0.000 loss: -221.917]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.34s/it, atk: -221.309 ent: -5.090 str: 0.000 loss: -226.399]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.35s/it, atk: -221.309 ent: -5.090 str: 0.000 loss: -226.399]Iterations: 100%|██████████| 30/30 [00:40<00:00,  1.37s/it, atk: -221.309 ent: -5.090 str: 0.000 loss: -226.399]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([796], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([649], device='cuda:0') tensor(1.4681e-10, device='cuda:0')
L1: [2307.0195]	L2: [16.313822]	Linf: [0.52549016]

Accuracy on benign examples: 100.0%
gt_label: 57 pred_label: 57 pred_clean_logit 0.9958702921867371
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.88it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.14it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  7.84it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  7.35it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  7.09it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  7.81it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  8.06it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.46it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  9.91it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 10.42it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 11.35it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.42it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.37s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.55s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.93s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.76s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5140
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.391 ent: -5.006 str: 0.000 loss: -5.397]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.40s/it, atk: -0.391 ent: -5.006 str: 0.000 loss: -5.397]Iterations:   3%|▎         | 1/30 [00:03<01:09,  2.40s/it, atk: -0.699 ent: -5.032 str: 0.000 loss: -5.731]Iterations:   7%|▋         | 2/30 [00:03<00:51,  1.85s/it, atk: -0.699 ent: -5.032 str: 0.000 loss: -5.731]Iterations:   7%|▋         | 2/30 [00:04<00:51,  1.85s/it, atk: -1.794 ent: -5.026 str: 0.000 loss: -6.821]Iterations:  10%|█         | 3/30 [00:05<00:41,  1.54s/it, atk: -1.794 ent: -5.026 str: 0.000 loss: -6.821]Iterations:  10%|█         | 3/30 [00:05<00:41,  1.54s/it, atk: -12.466 ent: -5.014 str: 0.000 loss: -17.480]Iterations:  13%|█▎        | 4/30 [00:06<00:39,  1.51s/it, atk: -12.466 ent: -5.014 str: 0.000 loss: -17.480]Iterations:  13%|█▎        | 4/30 [00:07<00:39,  1.51s/it, atk: -39.107 ent: -4.984 str: 0.000 loss: -44.091]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.39s/it, atk: -39.107 ent: -4.984 str: 0.000 loss: -44.091]Iterations:  17%|█▋        | 5/30 [00:08<00:34,  1.39s/it, atk: -58.974 ent: -4.978 str: 0.000 loss: -63.952]Iterations:  20%|██        | 6/30 [00:09<00:34,  1.45s/it, atk: -58.974 ent: -4.978 str: 0.000 loss: -63.952]Iterations:  20%|██        | 6/30 [00:10<00:34,  1.45s/it, atk: -65.881 ent: -4.971 str: 0.000 loss: -70.852]Iterations:  23%|██▎       | 7/30 [00:10<00:32,  1.43s/it, atk: -65.881 ent: -4.971 str: 0.000 loss: -70.852]Iterations:  23%|██▎       | 7/30 [00:11<00:32,  1.43s/it, atk: -95.432 ent: -4.981 str: 0.000 loss: -100.413]Iterations:  27%|██▋       | 8/30 [00:12<00:32,  1.48s/it, atk: -95.432 ent: -4.981 str: 0.000 loss: -100.413]Iterations:  27%|██▋       | 8/30 [00:13<00:32,  1.48s/it, atk: -115.667 ent: -4.977 str: 0.000 loss: -120.645]Iterations:  30%|███       | 9/30 [00:13<00:30,  1.47s/it, atk: -115.667 ent: -4.977 str: 0.000 loss: -120.645]Iterations:  30%|███       | 9/30 [00:14<00:30,  1.47s/it, atk: -135.136 ent: -4.975 str: 0.000 loss: -140.111]Iterations:  33%|███▎      | 10/30 [00:14<00:28,  1.42s/it, atk: -135.136 ent: -4.975 str: 0.000 loss: -140.111]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.42s/it, atk: -143.701 ent: -4.983 str: 0.000 loss: -148.685]Iterations:  37%|███▋      | 11/30 [00:16<00:27,  1.46s/it, atk: -143.701 ent: -4.983 str: 0.000 loss: -148.685]Iterations:  37%|███▋      | 11/30 [00:17<00:27,  1.46s/it, atk: -147.097 ent: -4.977 str: 0.000 loss: -152.074]Iterations:  40%|████      | 12/30 [00:17<00:25,  1.40s/it, atk: -147.097 ent: -4.977 str: 0.000 loss: -152.074]Iterations:  40%|████      | 12/30 [00:18<00:25,  1.40s/it, atk: -144.781 ent: -4.971 str: 0.000 loss: -149.752]Iterations:  43%|████▎     | 13/30 [00:19<00:24,  1.42s/it, atk: -144.781 ent: -4.971 str: 0.000 loss: -149.752]Iterations:  43%|████▎     | 13/30 [00:19<00:24,  1.42s/it, atk: -154.508 ent: -4.971 str: 0.000 loss: -159.479]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.36s/it, atk: -154.508 ent: -4.971 str: 0.000 loss: -159.479]Iterations:  47%|████▋     | 14/30 [00:21<00:21,  1.36s/it, atk: -164.362 ent: -4.970 str: 0.000 loss: -169.332]Iterations:  50%|█████     | 15/30 [00:21<00:20,  1.34s/it, atk: -164.362 ent: -4.970 str: 0.000 loss: -169.332]Iterations:  50%|█████     | 15/30 [00:22<00:20,  1.34s/it, atk: -168.643 ent: -4.971 str: 0.000 loss: -173.614]Iterations:  53%|█████▎    | 16/30 [00:22<00:18,  1.31s/it, atk: -168.643 ent: -4.971 str: 0.000 loss: -173.614]Iterations:  53%|█████▎    | 16/30 [00:23<00:18,  1.31s/it, atk: -164.362 ent: -4.972 str: 0.000 loss: -169.334]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.26s/it, atk: -164.362 ent: -4.972 str: 0.000 loss: -169.334]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.26s/it, atk: -177.951 ent: -4.972 str: 0.000 loss: -182.923]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.20s/it, atk: -177.951 ent: -4.972 str: 0.000 loss: -182.923]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.20s/it, atk: -189.377 ent: -4.974 str: 0.000 loss: -194.351]Iterations:  63%|██████▎   | 19/30 [00:26<00:14,  1.28s/it, atk: -189.377 ent: -4.974 str: 0.000 loss: -194.351]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.28s/it, atk: -193.799 ent: -4.973 str: 0.000 loss: -198.772]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.35s/it, atk: -193.799 ent: -4.973 str: 0.000 loss: -198.772]Iterations:  67%|██████▋   | 20/30 [00:28<00:13,  1.35s/it, atk: -190.265 ent: -4.963 str: 0.000 loss: -195.227]Iterations:  70%|███████   | 21/30 [00:29<00:12,  1.37s/it, atk: -190.265 ent: -4.963 str: 0.000 loss: -195.227]Iterations:  70%|███████   | 21/30 [00:30<00:12,  1.37s/it, atk: -198.270 ent: -4.975 str: 0.000 loss: -203.245]Iterations:  73%|███████▎  | 22/30 [00:30<00:10,  1.26s/it, atk: -198.270 ent: -4.975 str: 0.000 loss: -203.245]Iterations:  73%|███████▎  | 22/30 [00:31<00:10,  1.26s/it, atk: -203.547 ent: -4.975 str: 0.000 loss: -208.522]Iterations:  77%|███████▋  | 23/30 [00:31<00:08,  1.26s/it, atk: -203.547 ent: -4.975 str: 0.000 loss: -208.522]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.26s/it, atk: -207.391 ent: -4.972 str: 0.000 loss: -212.364]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.27s/it, atk: -207.391 ent: -4.972 str: 0.000 loss: -212.364]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.27s/it, atk: -210.603 ent: -4.969 str: 0.000 loss: -215.572]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.26s/it, atk: -210.603 ent: -4.969 str: 0.000 loss: -215.572]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.26s/it, atk: -213.010 ent: -4.967 str: 0.000 loss: -217.978]Iterations:  87%|████████▋ | 26/30 [00:35<00:05,  1.28s/it, atk: -213.010 ent: -4.967 str: 0.000 loss: -217.978]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.28s/it, atk: -217.274 ent: -4.969 str: 0.000 loss: -222.244]Iterations:  90%|█████████ | 27/30 [00:36<00:03,  1.26s/it, atk: -217.274 ent: -4.969 str: 0.000 loss: -222.244]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.26s/it, atk: -222.879 ent: -4.972 str: 0.000 loss: -227.850]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.32s/it, atk: -222.879 ent: -4.972 str: 0.000 loss: -227.850]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.32s/it, atk: -227.550 ent: -4.972 str: 0.000 loss: -232.522]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.42s/it, atk: -227.550 ent: -4.972 str: 0.000 loss: -232.522]Iterations:  97%|█████████▋| 29/30 [00:41<00:01,  1.42s/it, atk: -230.144 ent: -4.972 str: 0.000 loss: -235.116]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.45s/it, atk: -230.144 ent: -4.972 str: 0.000 loss: -235.116]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.39s/it, atk: -230.144 ent: -4.972 str: 0.000 loss: -235.116]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([312], device='cuda:0') tensor(0.9245, device='cuda:0')
after_true: tensor([57], device='cuda:0') tensor(6.1035e-11, device='cuda:0')
L1: [3731.7646]	L2: [24.587679]	Linf: [0.67450976]

Accuracy on benign examples: 0.0%
gt_label: 409 pred_label: 826 pred_clean_logit 0.08319590240716934
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.32it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  7.52it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  7.83it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  7.15it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:01<00:01,  7.48it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  6.99it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  7.03it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:01,  7.16it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  7.38it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  7.26it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  7.36it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:02<00:00,  8.67it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:02<00:00,  8.79it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  8.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.89it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  7.72it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.56s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:07,  2.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:03,  3.00s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.25s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.01s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5000
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -21.921 ent: -5.125 str: 0.000 loss: -27.046]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.09s/it, atk: -21.921 ent: -5.125 str: 0.000 loss: -27.046]Iterations:   3%|▎         | 1/30 [00:03<01:00,  2.09s/it, atk: -27.980 ent: -5.124 str: 0.000 loss: -33.104]Iterations:   7%|▋         | 2/30 [00:03<00:50,  1.80s/it, atk: -27.980 ent: -5.124 str: 0.000 loss: -33.104]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.80s/it, atk: -35.590 ent: -5.123 str: 0.000 loss: -40.713]Iterations:  10%|█         | 3/30 [00:04<00:39,  1.45s/it, atk: -35.590 ent: -5.123 str: 0.000 loss: -40.713]Iterations:  10%|█         | 3/30 [00:05<00:39,  1.45s/it, atk: -43.475 ent: -5.118 str: 0.000 loss: -48.593]Iterations:  13%|█▎        | 4/30 [00:06<00:40,  1.57s/it, atk: -43.475 ent: -5.118 str: 0.000 loss: -48.593]Iterations:  13%|█▎        | 4/30 [00:07<00:40,  1.57s/it, atk: -52.609 ent: -5.121 str: 0.000 loss: -57.730]Iterations:  17%|█▋        | 5/30 [00:08<00:39,  1.59s/it, atk: -52.609 ent: -5.121 str: 0.000 loss: -57.730]Iterations:  17%|█▋        | 5/30 [00:09<00:39,  1.59s/it, atk: -58.337 ent: -5.120 str: 0.000 loss: -63.457]Iterations:  20%|██        | 6/30 [00:09<00:38,  1.62s/it, atk: -58.337 ent: -5.120 str: 0.000 loss: -63.457]Iterations:  20%|██        | 6/30 [00:10<00:38,  1.62s/it, atk: -64.432 ent: -5.123 str: 0.000 loss: -69.555]Iterations:  23%|██▎       | 7/30 [00:11<00:38,  1.66s/it, atk: -64.432 ent: -5.123 str: 0.000 loss: -69.555]Iterations:  23%|██▎       | 7/30 [00:12<00:38,  1.66s/it, atk: -70.936 ent: -5.127 str: 0.000 loss: -76.063]Iterations:  27%|██▋       | 8/30 [00:13<00:35,  1.63s/it, atk: -70.936 ent: -5.127 str: 0.000 loss: -76.063]Iterations:  27%|██▋       | 8/30 [00:13<00:35,  1.63s/it, atk: -75.757 ent: -5.126 str: 0.000 loss: -80.883]Iterations:  30%|███       | 9/30 [00:14<00:32,  1.57s/it, atk: -75.757 ent: -5.126 str: 0.000 loss: -80.883]Iterations:  30%|███       | 9/30 [00:15<00:32,  1.57s/it, atk: -85.631 ent: -5.123 str: 0.000 loss: -90.754]Iterations:  33%|███▎      | 10/30 [00:15<00:28,  1.44s/it, atk: -85.631 ent: -5.123 str: 0.000 loss: -90.754]Iterations:  33%|███▎      | 10/30 [00:16<00:28,  1.44s/it, atk: -95.574 ent: -5.122 str: 0.000 loss: -100.696]Iterations:  37%|███▋      | 11/30 [00:17<00:26,  1.42s/it, atk: -95.574 ent: -5.122 str: 0.000 loss: -100.696]Iterations:  37%|███▋      | 11/30 [00:17<00:26,  1.42s/it, atk: -105.634 ent: -5.123 str: 0.000 loss: -110.757]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.35s/it, atk: -105.634 ent: -5.123 str: 0.000 loss: -110.757]Iterations:  40%|████      | 12/30 [00:18<00:24,  1.35s/it, atk: -113.466 ent: -5.124 str: 0.000 loss: -118.590]Iterations:  43%|████▎     | 13/30 [00:19<00:21,  1.27s/it, atk: -113.466 ent: -5.124 str: 0.000 loss: -118.590]Iterations:  43%|████▎     | 13/30 [00:20<00:21,  1.27s/it, atk: -124.171 ent: -5.124 str: 0.000 loss: -129.295]Iterations:  47%|████▋     | 14/30 [00:20<00:21,  1.32s/it, atk: -124.171 ent: -5.124 str: 0.000 loss: -129.295]Iterations:  47%|████▋     | 14/30 [00:21<00:21,  1.32s/it, atk: -132.375 ent: -5.124 str: 0.000 loss: -137.499]Iterations:  50%|█████     | 15/30 [00:21<00:19,  1.29s/it, atk: -132.375 ent: -5.124 str: 0.000 loss: -137.499]Iterations:  50%|█████     | 15/30 [00:22<00:19,  1.29s/it, atk: -139.567 ent: -5.123 str: 0.000 loss: -144.690]Iterations:  53%|█████▎    | 16/30 [00:23<00:17,  1.27s/it, atk: -139.567 ent: -5.123 str: 0.000 loss: -144.690]Iterations:  53%|█████▎    | 16/30 [00:24<00:17,  1.27s/it, atk: -145.245 ent: -5.120 str: 0.000 loss: -150.365]Iterations:  57%|█████▋    | 17/30 [00:24<00:17,  1.36s/it, atk: -145.245 ent: -5.120 str: 0.000 loss: -150.365]Iterations:  57%|█████▋    | 17/30 [00:25<00:17,  1.36s/it, atk: -154.403 ent: -5.119 str: 0.000 loss: -159.522]Iterations:  60%|██████    | 18/30 [00:26<00:15,  1.33s/it, atk: -154.403 ent: -5.119 str: 0.000 loss: -159.522]Iterations:  60%|██████    | 18/30 [00:26<00:15,  1.33s/it, atk: -161.066 ent: -5.118 str: 0.000 loss: -166.184]Iterations:  63%|██████▎   | 19/30 [00:27<00:14,  1.33s/it, atk: -161.066 ent: -5.118 str: 0.000 loss: -166.184]Iterations:  63%|██████▎   | 19/30 [00:28<00:14,  1.33s/it, atk: -165.792 ent: -5.117 str: 0.000 loss: -170.909]Iterations:  67%|██████▋   | 20/30 [00:28<00:12,  1.23s/it, atk: -165.792 ent: -5.117 str: 0.000 loss: -170.909]Iterations:  67%|██████▋   | 20/30 [00:29<00:12,  1.23s/it, atk: -172.130 ent: -5.117 str: 0.000 loss: -177.246]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.28s/it, atk: -172.130 ent: -5.117 str: 0.000 loss: -177.246]Iterations:  70%|███████   | 21/30 [00:30<00:11,  1.28s/it, atk: -175.256 ent: -5.117 str: 0.000 loss: -180.372]Iterations:  73%|███████▎  | 22/30 [00:31<00:10,  1.31s/it, atk: -175.256 ent: -5.117 str: 0.000 loss: -180.372]Iterations:  73%|███████▎  | 22/30 [00:31<00:10,  1.31s/it, atk: -186.542 ent: -5.116 str: 0.000 loss: -191.658]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.25s/it, atk: -186.542 ent: -5.116 str: 0.000 loss: -191.658]Iterations:  77%|███████▋  | 23/30 [00:33<00:08,  1.25s/it, atk: -192.081 ent: -5.115 str: 0.000 loss: -197.197]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.30s/it, atk: -192.081 ent: -5.115 str: 0.000 loss: -197.197]Iterations:  80%|████████  | 24/30 [00:34<00:07,  1.30s/it, atk: -196.561 ent: -5.115 str: 0.000 loss: -201.676]Iterations:  83%|████████▎ | 25/30 [00:34<00:06,  1.26s/it, atk: -196.561 ent: -5.115 str: 0.000 loss: -201.676]Iterations:  83%|████████▎ | 25/30 [00:35<00:06,  1.26s/it, atk: -202.134 ent: -5.114 str: 0.000 loss: -207.249]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.37s/it, atk: -202.134 ent: -5.114 str: 0.000 loss: -207.249]Iterations:  87%|████████▋ | 26/30 [00:37<00:05,  1.37s/it, atk: -208.163 ent: -5.114 str: 0.000 loss: -213.278]Iterations:  90%|█████████ | 27/30 [00:37<00:04,  1.34s/it, atk: -208.163 ent: -5.114 str: 0.000 loss: -213.278]Iterations:  90%|█████████ | 27/30 [00:38<00:04,  1.34s/it, atk: -213.763 ent: -5.115 str: 0.000 loss: -218.878]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.42s/it, atk: -213.763 ent: -5.115 str: 0.000 loss: -218.878]Iterations:  93%|█████████▎| 28/30 [00:40<00:02,  1.42s/it, atk: -218.074 ent: -5.115 str: 0.000 loss: -223.190]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.44s/it, atk: -218.074 ent: -5.115 str: 0.000 loss: -223.190]Iterations:  97%|█████████▋| 29/30 [00:41<00:01,  1.44s/it, atk: -223.270 ent: -5.116 str: 0.000 loss: -228.386]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.45s/it, atk: -223.270 ent: -5.116 str: 0.000 loss: -228.386]Iterations: 100%|██████████| 30/30 [00:42<00:00,  1.41s/it, atk: -223.270 ent: -5.116 str: 0.000 loss: -228.386]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([455], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([409], device='cuda:0') tensor(1.0986e-10, device='cuda:0')
L1: [3764.5686]	L2: [28.098047]	Linf: [0.9764706]

Accuracy on benign examples: 100.0%
gt_label: 472 pred_label: 472 pred_clean_logit 0.7988874912261963
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.94it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  9.99it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.29it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.31it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 10.65it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.54it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 10.83it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 11.28it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 11.35it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.71it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.86s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.53s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  3.05s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.78s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4673
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.157 ent: -2.959 str: 0.000 loss: -6.116]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.43s/it, atk: -3.157 ent: -2.959 str: 0.000 loss: -6.116]Iterations:   3%|▎         | 1/30 [00:03<01:10,  2.43s/it, atk: -4.016 ent: -2.956 str: 0.000 loss: -6.972]Iterations:   7%|▋         | 2/30 [00:03<00:49,  1.76s/it, atk: -4.016 ent: -2.956 str: 0.000 loss: -6.972]Iterations:   7%|▋         | 2/30 [00:04<00:49,  1.76s/it, atk: -5.415 ent: -2.953 str: 0.000 loss: -8.368]Iterations:  10%|█         | 3/30 [00:05<00:43,  1.62s/it, atk: -5.415 ent: -2.953 str: 0.000 loss: -8.368]Iterations:  10%|█         | 3/30 [00:05<00:43,  1.62s/it, atk: -7.578 ent: -2.949 str: 0.000 loss: -10.527]Iterations:  13%|█▎        | 4/30 [00:06<00:38,  1.50s/it, atk: -7.578 ent: -2.949 str: 0.000 loss: -10.527]Iterations:  13%|█▎        | 4/30 [00:07<00:38,  1.50s/it, atk: -9.545 ent: -2.946 str: 0.000 loss: -12.491]Iterations:  17%|█▋        | 5/30 [00:07<00:35,  1.42s/it, atk: -9.545 ent: -2.946 str: 0.000 loss: -12.491]Iterations:  17%|█▋        | 5/30 [00:08<00:35,  1.42s/it, atk: -10.961 ent: -2.943 str: 0.000 loss: -13.904]Iterations:  20%|██        | 6/30 [00:08<00:32,  1.34s/it, atk: -10.961 ent: -2.943 str: 0.000 loss: -13.904]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.34s/it, atk: -12.880 ent: -2.939 str: 0.000 loss: -15.819]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.35s/it, atk: -12.880 ent: -2.939 str: 0.000 loss: -15.819]Iterations:  23%|██▎       | 7/30 [00:11<00:30,  1.35s/it, atk: -12.490 ent: -2.933 str: 0.000 loss: -15.422]Iterations:  27%|██▋       | 8/30 [00:11<00:30,  1.39s/it, atk: -12.490 ent: -2.933 str: 0.000 loss: -15.422]Iterations:  27%|██▋       | 8/30 [00:12<00:30,  1.39s/it, atk: -16.677 ent: -2.930 str: 0.000 loss: -19.607]Iterations:  30%|███       | 9/30 [00:12<00:27,  1.29s/it, atk: -16.677 ent: -2.930 str: 0.000 loss: -19.607]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.29s/it, atk: -17.334 ent: -2.937 str: 0.000 loss: -20.272]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.34s/it, atk: -17.334 ent: -2.937 str: 0.000 loss: -20.272]Iterations:  33%|███▎      | 10/30 [00:14<00:26,  1.34s/it, atk: -19.015 ent: -2.940 str: 0.000 loss: -21.955]Iterations:  37%|███▋      | 11/30 [00:15<00:24,  1.31s/it, atk: -19.015 ent: -2.940 str: 0.000 loss: -21.955]Iterations:  37%|███▋      | 11/30 [00:16<00:24,  1.31s/it, atk: -22.147 ent: -2.939 str: 0.000 loss: -25.085]Iterations:  40%|████      | 12/30 [00:16<00:24,  1.35s/it, atk: -22.147 ent: -2.939 str: 0.000 loss: -25.085]Iterations:  40%|████      | 12/30 [00:17<00:24,  1.35s/it, atk: -24.873 ent: -2.937 str: 0.000 loss: -27.810]Iterations:  43%|████▎     | 13/30 [00:17<00:21,  1.24s/it, atk: -24.873 ent: -2.937 str: 0.000 loss: -27.810]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.24s/it, atk: -27.372 ent: -2.934 str: 0.000 loss: -30.306]Iterations:  47%|████▋     | 14/30 [00:19<00:20,  1.27s/it, atk: -27.372 ent: -2.934 str: 0.000 loss: -30.306]Iterations:  47%|████▋     | 14/30 [00:20<00:20,  1.27s/it, atk: -30.044 ent: -2.934 str: 0.000 loss: -32.978]Iterations:  50%|█████     | 15/30 [00:20<00:18,  1.22s/it, atk: -30.044 ent: -2.934 str: 0.000 loss: -32.978]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.22s/it, atk: -32.444 ent: -2.933 str: 0.000 loss: -35.377]Iterations:  53%|█████▎    | 16/30 [00:21<00:17,  1.25s/it, atk: -32.444 ent: -2.933 str: 0.000 loss: -35.377]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.25s/it, atk: -35.482 ent: -2.932 str: 0.000 loss: -38.414]Iterations:  57%|█████▋    | 17/30 [00:23<00:17,  1.34s/it, atk: -35.482 ent: -2.932 str: 0.000 loss: -38.414]Iterations:  57%|█████▋    | 17/30 [00:23<00:17,  1.34s/it, atk: -38.701 ent: -2.931 str: 0.000 loss: -41.631]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.27s/it, atk: -38.701 ent: -2.931 str: 0.000 loss: -41.631]Iterations:  60%|██████    | 18/30 [00:24<00:15,  1.27s/it, atk: -41.047 ent: -2.929 str: 0.000 loss: -43.977]Iterations:  63%|██████▎   | 19/30 [00:25<00:13,  1.20s/it, atk: -41.047 ent: -2.929 str: 0.000 loss: -43.977]Iterations:  63%|██████▎   | 19/30 [00:26<00:13,  1.20s/it, atk: -44.080 ent: -2.930 str: 0.000 loss: -47.010]Iterations:  67%|██████▋   | 20/30 [00:26<00:11,  1.17s/it, atk: -44.080 ent: -2.930 str: 0.000 loss: -47.010]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.17s/it, atk: -46.586 ent: -2.930 str: 0.000 loss: -49.516]Iterations:  70%|███████   | 21/30 [00:27<00:10,  1.20s/it, atk: -46.586 ent: -2.930 str: 0.000 loss: -49.516]Iterations:  70%|███████   | 21/30 [00:28<00:10,  1.20s/it, atk: -48.865 ent: -2.931 str: 0.000 loss: -51.796]Iterations:  73%|███████▎  | 22/30 [00:28<00:09,  1.20s/it, atk: -48.865 ent: -2.931 str: 0.000 loss: -51.796]Iterations:  73%|███████▎  | 22/30 [00:29<00:09,  1.20s/it, atk: -51.224 ent: -2.930 str: 0.000 loss: -54.154]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.15s/it, atk: -51.224 ent: -2.930 str: 0.000 loss: -54.154]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.15s/it, atk: -53.514 ent: -2.929 str: 0.000 loss: -56.443]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.15s/it, atk: -53.514 ent: -2.929 str: 0.000 loss: -56.443]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.15s/it, atk: -55.566 ent: -2.928 str: 0.000 loss: -58.494]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.20s/it, atk: -55.566 ent: -2.928 str: 0.000 loss: -58.494]Iterations:  83%|████████▎ | 25/30 [00:33<00:06,  1.20s/it, atk: -57.499 ent: -2.927 str: 0.000 loss: -60.426]Iterations:  87%|████████▋ | 26/30 [00:33<00:05,  1.25s/it, atk: -57.499 ent: -2.927 str: 0.000 loss: -60.426]Iterations:  87%|████████▋ | 26/30 [00:34<00:05,  1.25s/it, atk: -59.825 ent: -2.926 str: 0.000 loss: -62.751]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.32s/it, atk: -59.825 ent: -2.926 str: 0.000 loss: -62.751]Iterations:  90%|█████████ | 27/30 [00:35<00:03,  1.32s/it, atk: -61.804 ent: -2.925 str: 0.000 loss: -64.729]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.27s/it, atk: -61.804 ent: -2.925 str: 0.000 loss: -64.729]Iterations:  93%|█████████▎| 28/30 [00:37<00:02,  1.27s/it, atk: -63.616 ent: -2.925 str: 0.000 loss: -66.541]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.29s/it, atk: -63.616 ent: -2.925 str: 0.000 loss: -66.541]Iterations:  97%|█████████▋| 29/30 [00:38<00:01,  1.29s/it, atk: -65.908 ent: -2.925 str: 0.000 loss: -68.832]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.32s/it, atk: -65.908 ent: -2.925 str: 0.000 loss: -68.832]Iterations: 100%|██████████| 30/30 [00:39<00:00,  1.31s/it, atk: -65.908 ent: -2.925 str: 0.000 loss: -68.832]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([693], device='cuda:0') tensor(0.9985, device='cuda:0')
after_true: tensor([472], device='cuda:0') tensor(0.0011, device='cuda:0')
L1: [2631.3022]	L2: [18.600615]	Linf: [0.8627451]

Accuracy on benign examples: 100.0%
gt_label: 430 pred_label: 430 pred_clean_logit 0.9915055632591248
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.82it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.47it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.59it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.84it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.37it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 10.84it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 10.67it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 10.22it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.18it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  8.73it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  8.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.41it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:11,  2.79s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:05<00:08,  2.69s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:08<00:05,  2.68s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:11<00:02,  2.94s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.29s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:15<00:00,  3.06s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5049
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.279 ent: -2.503 str: 0.000 loss: -2.782]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.72s/it, atk: -0.279 ent: -2.503 str: 0.000 loss: -2.782]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.72s/it, atk: -1.899 ent: -2.500 str: 0.000 loss: -4.400]Iterations:   7%|▋         | 2/30 [00:04<00:58,  2.10s/it, atk: -1.899 ent: -2.500 str: 0.000 loss: -4.400]Iterations:   7%|▋         | 2/30 [00:05<00:58,  2.10s/it, atk: -5.650 ent: -2.500 str: 0.000 loss: -8.150]Iterations:  10%|█         | 3/30 [00:05<00:47,  1.78s/it, atk: -5.650 ent: -2.500 str: 0.000 loss: -8.150]Iterations:  10%|█         | 3/30 [00:06<00:47,  1.78s/it, atk: -14.384 ent: -2.499 str: 0.000 loss: -16.883]Iterations:  13%|█▎        | 4/30 [00:07<00:43,  1.69s/it, atk: -14.384 ent: -2.499 str: 0.000 loss: -16.883]Iterations:  13%|█▎        | 4/30 [00:08<00:43,  1.69s/it, atk: -25.357 ent: -2.498 str: 0.000 loss: -27.855]Iterations:  17%|█▋        | 5/30 [00:08<00:41,  1.65s/it, atk: -25.357 ent: -2.498 str: 0.000 loss: -27.855]Iterations:  17%|█▋        | 5/30 [00:09<00:41,  1.65s/it, atk: -32.647 ent: -2.497 str: 0.000 loss: -35.144]Iterations:  20%|██        | 6/30 [00:10<00:36,  1.52s/it, atk: -32.647 ent: -2.497 str: 0.000 loss: -35.144]Iterations:  20%|██        | 6/30 [00:10<00:36,  1.52s/it, atk: -43.127 ent: -2.495 str: 0.000 loss: -45.622]Iterations:  23%|██▎       | 7/30 [00:11<00:32,  1.42s/it, atk: -43.127 ent: -2.495 str: 0.000 loss: -45.622]Iterations:  23%|██▎       | 7/30 [00:12<00:32,  1.42s/it, atk: -49.765 ent: -2.494 str: 0.000 loss: -52.259]Iterations:  27%|██▋       | 8/30 [00:12<00:29,  1.33s/it, atk: -49.765 ent: -2.494 str: 0.000 loss: -52.259]Iterations:  27%|██▋       | 8/30 [00:13<00:29,  1.33s/it, atk: -56.434 ent: -2.493 str: 0.000 loss: -58.926]Iterations:  30%|███       | 9/30 [00:13<00:27,  1.33s/it, atk: -56.434 ent: -2.493 str: 0.000 loss: -58.926]Iterations:  30%|███       | 9/30 [00:14<00:27,  1.33s/it, atk: -65.465 ent: -2.492 str: 0.000 loss: -67.957]Iterations:  33%|███▎      | 10/30 [00:14<00:25,  1.26s/it, atk: -65.465 ent: -2.492 str: 0.000 loss: -67.957]Iterations:  33%|███▎      | 10/30 [00:15<00:25,  1.26s/it, atk: -72.655 ent: -2.492 str: 0.000 loss: -75.147]Iterations:  37%|███▋      | 11/30 [00:16<00:24,  1.28s/it, atk: -72.655 ent: -2.492 str: 0.000 loss: -75.147]Iterations:  37%|███▋      | 11/30 [00:16<00:24,  1.28s/it, atk: -78.879 ent: -2.491 str: 0.000 loss: -81.370]Iterations:  40%|████      | 12/30 [00:17<00:21,  1.20s/it, atk: -78.879 ent: -2.491 str: 0.000 loss: -81.370]Iterations:  40%|████      | 12/30 [00:18<00:21,  1.20s/it, atk: -86.620 ent: -2.490 str: 0.000 loss: -89.110]Iterations:  43%|████▎     | 13/30 [00:18<00:21,  1.29s/it, atk: -86.620 ent: -2.490 str: 0.000 loss: -89.110]Iterations:  43%|████▎     | 13/30 [00:19<00:21,  1.29s/it, atk: -92.183 ent: -2.489 str: 0.000 loss: -94.673]Iterations:  47%|████▋     | 14/30 [00:19<00:19,  1.21s/it, atk: -92.183 ent: -2.489 str: 0.000 loss: -94.673]Iterations:  47%|████▋     | 14/30 [00:20<00:19,  1.21s/it, atk: -98.676 ent: -2.489 str: 0.000 loss: -101.165]Iterations:  50%|█████     | 15/30 [00:20<00:17,  1.17s/it, atk: -98.676 ent: -2.489 str: 0.000 loss: -101.165]Iterations:  50%|█████     | 15/30 [00:21<00:17,  1.17s/it, atk: -104.966 ent: -2.488 str: 0.000 loss: -107.454]Iterations:  53%|█████▎    | 16/30 [00:22<00:17,  1.27s/it, atk: -104.966 ent: -2.488 str: 0.000 loss: -107.454]Iterations:  53%|█████▎    | 16/30 [00:23<00:17,  1.27s/it, atk: -111.089 ent: -2.487 str: 0.000 loss: -113.576]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.28s/it, atk: -111.089 ent: -2.487 str: 0.000 loss: -113.576]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.28s/it, atk: -116.419 ent: -2.487 str: 0.000 loss: -118.905]Iterations:  60%|██████    | 18/30 [00:24<00:14,  1.22s/it, atk: -116.419 ent: -2.487 str: 0.000 loss: -118.905]Iterations:  60%|██████    | 18/30 [00:25<00:14,  1.22s/it, atk: -121.113 ent: -2.486 str: 0.000 loss: -123.600]Iterations:  63%|██████▎   | 19/30 [00:25<00:12,  1.12s/it, atk: -121.113 ent: -2.486 str: 0.000 loss: -123.600]Iterations:  63%|██████▎   | 19/30 [00:26<00:12,  1.12s/it, atk: -126.444 ent: -2.486 str: 0.000 loss: -128.930]Iterations:  67%|██████▋   | 20/30 [00:26<00:11,  1.13s/it, atk: -126.444 ent: -2.486 str: 0.000 loss: -128.930]Iterations:  67%|██████▋   | 20/30 [00:27<00:11,  1.13s/it, atk: -131.212 ent: -2.485 str: 0.000 loss: -133.697]Iterations:  70%|███████   | 21/30 [00:27<00:09,  1.02s/it, atk: -131.212 ent: -2.485 str: 0.000 loss: -133.697]Iterations:  70%|███████   | 21/30 [00:28<00:09,  1.02s/it, atk: -135.015 ent: -2.485 str: 0.000 loss: -137.500]Iterations:  73%|███████▎  | 22/30 [00:28<00:08,  1.08s/it, atk: -135.015 ent: -2.485 str: 0.000 loss: -137.500]Iterations:  73%|███████▎  | 22/30 [00:29<00:08,  1.08s/it, atk: -139.244 ent: -2.485 str: 0.000 loss: -141.729]Iterations:  77%|███████▋  | 23/30 [00:29<00:06,  1.00it/s, atk: -139.244 ent: -2.485 str: 0.000 loss: -141.729]Iterations:  77%|███████▋  | 23/30 [00:30<00:06,  1.00it/s, atk: -143.928 ent: -2.485 str: 0.000 loss: -146.413]Iterations:  80%|████████  | 24/30 [00:30<00:06,  1.01s/it, atk: -143.928 ent: -2.485 str: 0.000 loss: -146.413]Iterations:  80%|████████  | 24/30 [00:31<00:06,  1.01s/it, atk: -146.398 ent: -2.484 str: 0.000 loss: -148.882]Iterations:  83%|████████▎ | 25/30 [00:31<00:04,  1.03it/s, atk: -146.398 ent: -2.484 str: 0.000 loss: -148.882]Iterations:  83%|████████▎ | 25/30 [00:31<00:04,  1.03it/s, atk: -150.722 ent: -2.483 str: 0.000 loss: -153.206]Iterations:  87%|████████▋ | 26/30 [00:32<00:03,  1.10it/s, atk: -150.722 ent: -2.483 str: 0.000 loss: -153.206]Iterations:  87%|████████▋ | 26/30 [00:32<00:03,  1.10it/s, atk: -153.311 ent: -2.483 str: 0.000 loss: -155.794]Iterations:  90%|█████████ | 27/30 [00:33<00:02,  1.13it/s, atk: -153.311 ent: -2.483 str: 0.000 loss: -155.794]Iterations:  90%|█████████ | 27/30 [00:33<00:02,  1.13it/s, atk: -157.277 ent: -2.482 str: 0.000 loss: -159.759]Iterations:  93%|█████████▎| 28/30 [00:33<00:01,  1.23it/s, atk: -157.277 ent: -2.482 str: 0.000 loss: -159.759]Iterations:  93%|█████████▎| 28/30 [00:34<00:01,  1.23it/s, atk: -160.437 ent: -2.482 str: 0.000 loss: -162.919]Iterations:  97%|█████████▋| 29/30 [00:35<00:00,  1.07it/s, atk: -160.437 ent: -2.482 str: 0.000 loss: -162.919]Iterations:  97%|█████████▋| 29/30 [00:35<00:00,  1.07it/s, atk: -164.348 ent: -2.482 str: 0.000 loss: -166.829]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.14it/s, atk: -164.348 ent: -2.482 str: 0.000 loss: -166.829]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.19s/it, atk: -164.348 ent: -2.482 str: 0.000 loss: -166.829]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([890], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([430], device='cuda:0') tensor(5.4094e-08, device='cuda:0')
L1: [3616.8906]	L2: [26.380426]	Linf: [0.85490197]

Accuracy on benign examples: 0.0%
gt_label: 421 pred_label: 525 pred_clean_logit 0.1312979757785797
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.73it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.26it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.21it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01, 10.64it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 10.40it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 12.25it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 11.88it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.40it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 10.42it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.21it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.31s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.16s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:07<00:05,  2.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:12<00:03,  3.42s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:17<00:00,  4.07s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:17<00:00,  3.48s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4503
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -28.114 ent: -4.965 str: 0.000 loss: -33.079]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.44s/it, atk: -28.114 ent: -4.965 str: 0.000 loss: -33.079]Iterations:   3%|▎         | 1/30 [00:03<01:10,  2.44s/it, atk: -38.871 ent: -4.954 str: 0.000 loss: -43.825]Iterations:   7%|▋         | 2/30 [00:03<00:52,  1.87s/it, atk: -38.871 ent: -4.954 str: 0.000 loss: -43.825]Iterations:   7%|▋         | 2/30 [00:05<00:52,  1.87s/it, atk: -47.934 ent: -4.937 str: 0.000 loss: -52.871]Iterations:  10%|█         | 3/30 [00:05<00:49,  1.82s/it, atk: -47.934 ent: -4.937 str: 0.000 loss: -52.871]Iterations:  10%|█         | 3/30 [00:06<00:49,  1.82s/it, atk: -51.889 ent: -4.923 str: 0.000 loss: -56.812]Iterations:  13%|█▎        | 4/30 [00:06<00:37,  1.45s/it, atk: -51.889 ent: -4.923 str: 0.000 loss: -56.812]Iterations:  13%|█▎        | 4/30 [00:07<00:37,  1.45s/it, atk: -58.643 ent: -4.918 str: 0.000 loss: -63.560]Iterations:  17%|█▋        | 5/30 [00:07<00:33,  1.35s/it, atk: -58.643 ent: -4.918 str: 0.000 loss: -63.560]Iterations:  17%|█▋        | 5/30 [00:08<00:33,  1.35s/it, atk: -63.785 ent: -4.921 str: 0.000 loss: -68.707]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.33s/it, atk: -63.785 ent: -4.921 str: 0.000 loss: -68.707]Iterations:  20%|██        | 6/30 [00:09<00:31,  1.33s/it, atk: -69.867 ent: -4.919 str: 0.000 loss: -74.785]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.33s/it, atk: -69.867 ent: -4.919 str: 0.000 loss: -74.785]Iterations:  23%|██▎       | 7/30 [00:11<00:30,  1.33s/it, atk: -74.896 ent: -4.916 str: 0.000 loss: -79.812]Iterations:  27%|██▋       | 8/30 [00:11<00:29,  1.36s/it, atk: -74.896 ent: -4.916 str: 0.000 loss: -79.812]Iterations:  27%|██▋       | 8/30 [00:12<00:29,  1.36s/it, atk: -78.538 ent: -4.912 str: 0.000 loss: -83.450]Iterations:  30%|███       | 9/30 [00:12<00:25,  1.20s/it, atk: -78.538 ent: -4.912 str: 0.000 loss: -83.450]Iterations:  30%|███       | 9/30 [00:13<00:25,  1.20s/it, atk: -80.994 ent: -4.911 str: 0.000 loss: -85.905]Iterations:  33%|███▎      | 10/30 [00:13<00:24,  1.21s/it, atk: -80.994 ent: -4.911 str: 0.000 loss: -85.905]Iterations:  33%|███▎      | 10/30 [00:14<00:24,  1.21s/it, atk: -84.409 ent: -4.909 str: 0.000 loss: -89.319]Iterations:  37%|███▋      | 11/30 [00:14<00:21,  1.12s/it, atk: -84.409 ent: -4.909 str: 0.000 loss: -89.319]Iterations:  37%|███▋      | 11/30 [00:15<00:21,  1.12s/it, atk: -88.114 ent: -4.908 str: 0.000 loss: -93.022]Iterations:  40%|████      | 12/30 [00:15<00:20,  1.11s/it, atk: -88.114 ent: -4.908 str: 0.000 loss: -93.022]Iterations:  40%|████      | 12/30 [00:16<00:20,  1.11s/it, atk: -91.355 ent: -4.908 str: 0.000 loss: -96.262]Iterations:  43%|████▎     | 13/30 [00:16<00:18,  1.10s/it, atk: -91.355 ent: -4.908 str: 0.000 loss: -96.262]Iterations:  43%|████▎     | 13/30 [00:17<00:18,  1.10s/it, atk: -94.419 ent: -4.905 str: 0.000 loss: -99.324]Iterations:  47%|████▋     | 14/30 [00:18<00:17,  1.10s/it, atk: -94.419 ent: -4.905 str: 0.000 loss: -99.324]Iterations:  47%|████▋     | 14/30 [00:18<00:17,  1.10s/it, atk: -97.211 ent: -4.905 str: 0.000 loss: -102.116]Iterations:  50%|█████     | 15/30 [00:19<00:16,  1.09s/it, atk: -97.211 ent: -4.905 str: 0.000 loss: -102.116]Iterations:  50%|█████     | 15/30 [00:19<00:16,  1.09s/it, atk: -100.210 ent: -4.905 str: 0.000 loss: -105.115]Iterations:  53%|█████▎    | 16/30 [00:20<00:15,  1.10s/it, atk: -100.210 ent: -4.905 str: 0.000 loss: -105.115]Iterations:  53%|█████▎    | 16/30 [00:20<00:15,  1.10s/it, atk: -102.523 ent: -4.903 str: 0.000 loss: -107.426]Iterations:  57%|█████▋    | 17/30 [00:21<00:15,  1.20s/it, atk: -102.523 ent: -4.903 str: 0.000 loss: -107.426]Iterations:  57%|█████▋    | 17/30 [00:22<00:15,  1.20s/it, atk: -104.043 ent: -4.908 str: 0.000 loss: -108.950]Iterations:  60%|██████    | 18/30 [00:22<00:14,  1.23s/it, atk: -104.043 ent: -4.908 str: 0.000 loss: -108.950]Iterations:  60%|██████    | 18/30 [00:23<00:14,  1.23s/it, atk: -107.583 ent: -4.907 str: 0.000 loss: -112.491]Iterations:  63%|██████▎   | 19/30 [00:23<00:12,  1.17s/it, atk: -107.583 ent: -4.907 str: 0.000 loss: -112.491]Iterations:  63%|██████▎   | 19/30 [00:24<00:12,  1.17s/it, atk: -110.929 ent: -4.903 str: 0.000 loss: -115.833]Iterations:  67%|██████▋   | 20/30 [00:24<00:09,  1.03it/s, atk: -110.929 ent: -4.903 str: 0.000 loss: -115.833]Iterations:  67%|██████▋   | 20/30 [00:24<00:09,  1.03it/s, atk: -112.812 ent: -4.899 str: 0.000 loss: -117.711]Iterations:  70%|███████   | 21/30 [00:25<00:07,  1.17it/s, atk: -112.812 ent: -4.899 str: 0.000 loss: -117.711]Iterations:  70%|███████   | 21/30 [00:25<00:07,  1.17it/s, atk: -116.194 ent: -4.900 str: 0.000 loss: -121.095]Iterations:  73%|███████▎  | 22/30 [00:26<00:07,  1.11it/s, atk: -116.194 ent: -4.900 str: 0.000 loss: -121.095]Iterations:  73%|███████▎  | 22/30 [00:26<00:07,  1.11it/s, atk: -119.084 ent: -4.901 str: 0.000 loss: -123.985]Iterations:  77%|███████▋  | 23/30 [00:27<00:06,  1.08it/s, atk: -119.084 ent: -4.901 str: 0.000 loss: -123.985]Iterations:  77%|███████▋  | 23/30 [00:27<00:06,  1.08it/s, atk: -122.193 ent: -4.901 str: 0.000 loss: -127.094]Iterations:  80%|████████  | 24/30 [00:27<00:05,  1.08it/s, atk: -122.193 ent: -4.901 str: 0.000 loss: -127.094]Iterations:  80%|████████  | 24/30 [00:28<00:05,  1.08it/s, atk: -124.553 ent: -4.901 str: 0.000 loss: -129.454]Iterations:  83%|████████▎ | 25/30 [00:29<00:04,  1.04it/s, atk: -124.553 ent: -4.901 str: 0.000 loss: -129.454]Iterations:  83%|████████▎ | 25/30 [00:29<00:04,  1.04it/s, atk: -127.502 ent: -4.902 str: 0.000 loss: -132.404]Iterations:  87%|████████▋ | 26/30 [00:30<00:03,  1.03it/s, atk: -127.502 ent: -4.902 str: 0.000 loss: -132.404]Iterations:  87%|████████▋ | 26/30 [00:30<00:03,  1.03it/s, atk: -130.553 ent: -4.903 str: 0.000 loss: -135.456]Iterations:  90%|█████████ | 27/30 [00:31<00:03,  1.13s/it, atk: -130.553 ent: -4.903 str: 0.000 loss: -135.456]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.13s/it, atk: -134.676 ent: -4.902 str: 0.000 loss: -139.578]Iterations:  93%|█████████▎| 28/30 [00:32<00:02,  1.10s/it, atk: -134.676 ent: -4.902 str: 0.000 loss: -139.578]Iterations:  93%|█████████▎| 28/30 [00:33<00:02,  1.10s/it, atk: -137.593 ent: -4.901 str: 0.000 loss: -142.494]Iterations:  97%|█████████▋| 29/30 [00:33<00:01,  1.09s/it, atk: -137.593 ent: -4.901 str: 0.000 loss: -142.494]Iterations:  97%|█████████▋| 29/30 [00:33<00:01,  1.09s/it, atk: -141.054 ent: -4.901 str: 0.000 loss: -145.955]Iterations: 100%|██████████| 30/30 [00:34<00:00,  1.04it/s, atk: -141.054 ent: -4.901 str: 0.000 loss: -145.955]Iterations: 100%|██████████| 30/30 [00:34<00:00,  1.14s/it, atk: -141.054 ent: -4.901 str: 0.000 loss: -145.955]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([525], device='cuda:0') tensor(0.9959, device='cuda:0')
after_true: tensor([421], device='cuda:0') tensor(5.3862e-07, device='cuda:0')
L1: [4252.804]	L2: [28.727669]	Linf: [0.8392157]

Accuracy on benign examples: 100.0%
gt_label: 140 pred_label: 140 pred_clean_logit 0.9744125008583069
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.86it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.88it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.45it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.32it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.55it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 10.81it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 11.07it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 10.98it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 10.39it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.59s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.16s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.17s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.39s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.46s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4211
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.205 ent: -12.532 str: 0.000 loss: -12.737]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.27s/it, atk: -0.205 ent: -12.532 str: 0.000 loss: -12.737]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.27s/it, atk: -0.592 ent: -12.595 str: 0.000 loss: -13.188]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.62s/it, atk: -0.592 ent: -12.595 str: 0.000 loss: -13.188]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.62s/it, atk: -1.660 ent: -12.547 str: 0.000 loss: -14.208]Iterations:  10%|█         | 3/30 [00:04<00:38,  1.43s/it, atk: -1.660 ent: -12.547 str: 0.000 loss: -14.208]Iterations:  10%|█         | 3/30 [00:05<00:38,  1.43s/it, atk: -4.229 ent: -12.539 str: 0.000 loss: -16.769]Iterations:  13%|█▎        | 4/30 [00:05<00:33,  1.30s/it, atk: -4.229 ent: -12.539 str: 0.000 loss: -16.769]Iterations:  13%|█▎        | 4/30 [00:06<00:33,  1.30s/it, atk: -8.270 ent: -12.529 str: 0.000 loss: -20.799]Iterations:  17%|█▋        | 5/30 [00:06<00:28,  1.15s/it, atk: -8.270 ent: -12.529 str: 0.000 loss: -20.799]Iterations:  17%|█▋        | 5/30 [00:07<00:28,  1.15s/it, atk: -12.724 ent: -12.512 str: 0.000 loss: -25.237]Iterations:  20%|██        | 6/30 [00:07<00:28,  1.19s/it, atk: -12.724 ent: -12.512 str: 0.000 loss: -25.237]Iterations:  20%|██        | 6/30 [00:08<00:28,  1.19s/it, atk: -17.656 ent: -12.498 str: 0.000 loss: -30.154]Iterations:  23%|██▎       | 7/30 [00:09<00:28,  1.23s/it, atk: -17.656 ent: -12.498 str: 0.000 loss: -30.154]Iterations:  23%|██▎       | 7/30 [00:09<00:28,  1.23s/it, atk: -22.999 ent: -12.517 str: 0.000 loss: -35.516]Iterations:  27%|██▋       | 8/30 [00:10<00:26,  1.19s/it, atk: -22.999 ent: -12.517 str: 0.000 loss: -35.516]Iterations:  27%|██▋       | 8/30 [00:10<00:26,  1.19s/it, atk: -29.436 ent: -12.528 str: 0.000 loss: -41.965]Iterations:  30%|███       | 9/30 [00:11<00:22,  1.09s/it, atk: -29.436 ent: -12.528 str: 0.000 loss: -41.965]Iterations:  30%|███       | 9/30 [00:11<00:22,  1.09s/it, atk: -34.844 ent: -12.534 str: 0.000 loss: -47.378]Iterations:  33%|███▎      | 10/30 [00:11<00:19,  1.02it/s, atk: -34.844 ent: -12.534 str: 0.000 loss: -47.378]Iterations:  33%|███▎      | 10/30 [00:12<00:19,  1.02it/s, atk: -41.650 ent: -12.546 str: 0.000 loss: -54.195]Iterations:  37%|███▋      | 11/30 [00:12<00:17,  1.06it/s, atk: -41.650 ent: -12.546 str: 0.000 loss: -54.195]Iterations:  37%|███▋      | 11/30 [00:13<00:17,  1.06it/s, atk: -45.234 ent: -12.551 str: 0.000 loss: -57.785]Iterations:  40%|████      | 12/30 [00:14<00:18,  1.04s/it, atk: -45.234 ent: -12.551 str: 0.000 loss: -57.785]Iterations:  40%|████      | 12/30 [00:14<00:18,  1.04s/it, atk: -52.386 ent: -12.528 str: 0.000 loss: -64.914]Iterations:  43%|████▎     | 13/30 [00:15<00:18,  1.10s/it, atk: -52.386 ent: -12.528 str: 0.000 loss: -64.914]Iterations:  43%|████▎     | 13/30 [00:16<00:18,  1.10s/it, atk: -57.648 ent: -12.515 str: 0.000 loss: -70.163]Iterations:  47%|████▋     | 14/30 [00:16<00:18,  1.17s/it, atk: -57.648 ent: -12.515 str: 0.000 loss: -70.163]Iterations:  47%|████▋     | 14/30 [00:17<00:18,  1.17s/it, atk: -63.965 ent: -12.506 str: 0.000 loss: -76.471]Iterations:  50%|█████     | 15/30 [00:17<00:18,  1.22s/it, atk: -63.965 ent: -12.506 str: 0.000 loss: -76.471]Iterations:  50%|█████     | 15/30 [00:18<00:18,  1.22s/it, atk: -71.331 ent: -12.500 str: 0.000 loss: -83.831]Iterations:  53%|█████▎    | 16/30 [00:19<00:16,  1.18s/it, atk: -71.331 ent: -12.500 str: 0.000 loss: -83.831]Iterations:  53%|█████▎    | 16/30 [00:19<00:16,  1.18s/it, atk: -77.554 ent: -12.493 str: 0.000 loss: -90.047]Iterations:  57%|█████▋    | 17/30 [00:20<00:15,  1.20s/it, atk: -77.554 ent: -12.493 str: 0.000 loss: -90.047]Iterations:  57%|█████▋    | 17/30 [00:20<00:15,  1.20s/it, atk: -83.948 ent: -12.487 str: 0.000 loss: -96.435]Iterations:  60%|██████    | 18/30 [00:21<00:13,  1.09s/it, atk: -83.948 ent: -12.487 str: 0.000 loss: -96.435]Iterations:  60%|██████    | 18/30 [00:21<00:13,  1.09s/it, atk: -90.906 ent: -12.485 str: 0.000 loss: -103.391]Iterations:  63%|██████▎   | 19/30 [00:22<00:12,  1.10s/it, atk: -90.906 ent: -12.485 str: 0.000 loss: -103.391]Iterations:  63%|██████▎   | 19/30 [00:22<00:12,  1.10s/it, atk: -97.536 ent: -12.484 str: 0.000 loss: -110.020]Iterations:  67%|██████▋   | 20/30 [00:23<00:10,  1.02s/it, atk: -97.536 ent: -12.484 str: 0.000 loss: -110.020]Iterations:  67%|██████▋   | 20/30 [00:23<00:10,  1.02s/it, atk: -103.515 ent: -12.482 str: 0.000 loss: -115.997]Iterations:  70%|███████   | 21/30 [00:24<00:09,  1.07s/it, atk: -103.515 ent: -12.482 str: 0.000 loss: -115.997]Iterations:  70%|███████   | 21/30 [00:25<00:09,  1.07s/it, atk: -109.792 ent: -12.480 str: 0.000 loss: -122.272]Iterations:  73%|███████▎  | 22/30 [00:25<00:09,  1.13s/it, atk: -109.792 ent: -12.480 str: 0.000 loss: -122.272]Iterations:  73%|███████▎  | 22/30 [00:25<00:09,  1.13s/it, atk: -116.934 ent: -12.477 str: 0.000 loss: -129.411]Iterations:  77%|███████▋  | 23/30 [00:26<00:07,  1.04s/it, atk: -116.934 ent: -12.477 str: 0.000 loss: -129.411]Iterations:  77%|███████▋  | 23/30 [00:27<00:07,  1.04s/it, atk: -123.954 ent: -12.476 str: 0.000 loss: -136.430]Iterations:  80%|████████  | 24/30 [00:27<00:06,  1.03s/it, atk: -123.954 ent: -12.476 str: 0.000 loss: -136.430]Iterations:  80%|████████  | 24/30 [00:28<00:06,  1.03s/it, atk: -131.510 ent: -12.477 str: 0.000 loss: -143.987]Iterations:  83%|████████▎ | 25/30 [00:28<00:05,  1.06s/it, atk: -131.510 ent: -12.477 str: 0.000 loss: -143.987]Iterations:  83%|████████▎ | 25/30 [00:29<00:05,  1.06s/it, atk: -138.170 ent: -12.478 str: 0.000 loss: -150.648]Iterations:  87%|████████▋ | 26/30 [00:29<00:04,  1.12s/it, atk: -138.170 ent: -12.478 str: 0.000 loss: -150.648]Iterations:  87%|████████▋ | 26/30 [00:30<00:04,  1.12s/it, atk: -144.472 ent: -12.478 str: 0.000 loss: -156.950]Iterations:  90%|█████████ | 27/30 [00:31<00:03,  1.20s/it, atk: -144.472 ent: -12.478 str: 0.000 loss: -156.950]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.20s/it, atk: -152.218 ent: -12.475 str: 0.000 loss: -164.692]Iterations:  93%|█████████▎| 28/30 [00:32<00:02,  1.31s/it, atk: -152.218 ent: -12.475 str: 0.000 loss: -164.692]Iterations:  93%|█████████▎| 28/30 [00:33<00:02,  1.31s/it, atk: -159.202 ent: -12.469 str: 0.000 loss: -171.671]Iterations:  97%|█████████▋| 29/30 [00:33<00:01,  1.25s/it, atk: -159.202 ent: -12.469 str: 0.000 loss: -171.671]Iterations:  97%|█████████▋| 29/30 [00:34<00:01,  1.25s/it, atk: -167.850 ent: -12.466 str: 0.000 loss: -180.316]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.36s/it, atk: -167.850 ent: -12.466 str: 0.000 loss: -180.316]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.18s/it, atk: -167.850 ent: -12.466 str: 0.000 loss: -180.316]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([99], device='cuda:0') tensor(0.9955, device='cuda:0')
after_true: tensor([140], device='cuda:0') tensor(2.2355e-08, device='cuda:0')
L1: [2963.9722]	L2: [20.77807]	Linf: [0.73333335]

Accuracy on benign examples: 100.0%
gt_label: 498 pred_label: 498 pred_clean_logit 0.8321885466575623
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.71it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.62it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.94it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 10.92it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 11.44it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.61it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 16.30it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 15.03it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.57it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.92it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.05s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.01s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.36s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3744
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.049 ent: -2.513 str: 0.000 loss: -5.562]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -3.049 ent: -2.513 str: 0.000 loss: -5.562]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -4.606 ent: -2.508 str: 0.000 loss: -7.114]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.39s/it, atk: -4.606 ent: -2.508 str: 0.000 loss: -7.114]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.39s/it, atk: -7.309 ent: -2.506 str: 0.000 loss: -9.815]Iterations:  10%|█         | 3/30 [00:04<00:34,  1.28s/it, atk: -7.309 ent: -2.506 str: 0.000 loss: -9.815]Iterations:  10%|█         | 3/30 [00:04<00:34,  1.28s/it, atk: -13.473 ent: -2.505 str: 0.000 loss: -15.978]Iterations:  13%|█▎        | 4/30 [00:05<00:33,  1.30s/it, atk: -13.473 ent: -2.505 str: 0.000 loss: -15.978]Iterations:  13%|█▎        | 4/30 [00:06<00:33,  1.30s/it, atk: -22.591 ent: -2.506 str: 0.000 loss: -25.096]Iterations:  17%|█▋        | 5/30 [00:06<00:32,  1.31s/it, atk: -22.591 ent: -2.506 str: 0.000 loss: -25.096]Iterations:  17%|█▋        | 5/30 [00:07<00:32,  1.31s/it, atk: -30.447 ent: -2.506 str: 0.000 loss: -32.953]Iterations:  20%|██        | 6/30 [00:08<00:34,  1.42s/it, atk: -30.447 ent: -2.506 str: 0.000 loss: -32.953]Iterations:  20%|██        | 6/30 [00:09<00:34,  1.42s/it, atk: -36.608 ent: -2.506 str: 0.000 loss: -39.113]Iterations:  23%|██▎       | 7/30 [00:09<00:30,  1.33s/it, atk: -36.608 ent: -2.506 str: 0.000 loss: -39.113]Iterations:  23%|██▎       | 7/30 [00:10<00:30,  1.33s/it, atk: -43.078 ent: -2.506 str: 0.000 loss: -45.584]Iterations:  27%|██▋       | 8/30 [00:10<00:27,  1.25s/it, atk: -43.078 ent: -2.506 str: 0.000 loss: -45.584]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.25s/it, atk: -47.761 ent: -2.507 str: 0.000 loss: -50.268]Iterations:  30%|███       | 9/30 [00:11<00:25,  1.21s/it, atk: -47.761 ent: -2.507 str: 0.000 loss: -50.268]Iterations:  30%|███       | 9/30 [00:12<00:25,  1.21s/it, atk: -52.829 ent: -2.507 str: 0.000 loss: -55.336]Iterations:  33%|███▎      | 10/30 [00:12<00:22,  1.11s/it, atk: -52.829 ent: -2.507 str: 0.000 loss: -55.336]Iterations:  33%|███▎      | 10/30 [00:13<00:22,  1.11s/it, atk: -57.650 ent: -2.507 str: 0.000 loss: -60.157]Iterations:  37%|███▋      | 11/30 [00:13<00:22,  1.16s/it, atk: -57.650 ent: -2.507 str: 0.000 loss: -60.157]Iterations:  37%|███▋      | 11/30 [00:14<00:22,  1.16s/it, atk: -61.383 ent: -2.507 str: 0.000 loss: -63.890]Iterations:  40%|████      | 12/30 [00:15<00:22,  1.24s/it, atk: -61.383 ent: -2.507 str: 0.000 loss: -63.890]Iterations:  40%|████      | 12/30 [00:15<00:22,  1.24s/it, atk: -66.281 ent: -2.507 str: 0.000 loss: -68.788]Iterations:  43%|████▎     | 13/30 [00:16<00:19,  1.14s/it, atk: -66.281 ent: -2.507 str: 0.000 loss: -68.788]Iterations:  43%|████▎     | 13/30 [00:16<00:19,  1.14s/it, atk: -69.860 ent: -2.507 str: 0.000 loss: -72.366]Iterations:  47%|████▋     | 14/30 [00:17<00:16,  1.06s/it, atk: -69.860 ent: -2.507 str: 0.000 loss: -72.366]Iterations:  47%|████▋     | 14/30 [00:17<00:16,  1.06s/it, atk: -74.006 ent: -2.507 str: 0.000 loss: -76.513]Iterations:  50%|█████     | 15/30 [00:18<00:16,  1.10s/it, atk: -74.006 ent: -2.507 str: 0.000 loss: -76.513]Iterations:  50%|█████     | 15/30 [00:19<00:16,  1.10s/it, atk: -78.231 ent: -2.506 str: 0.000 loss: -80.737]Iterations:  53%|█████▎    | 16/30 [00:19<00:15,  1.08s/it, atk: -78.231 ent: -2.506 str: 0.000 loss: -80.737]Iterations:  53%|█████▎    | 16/30 [00:20<00:15,  1.08s/it, atk: -82.226 ent: -2.506 str: 0.000 loss: -84.732]Iterations:  57%|█████▋    | 17/30 [00:20<00:14,  1.15s/it, atk: -82.226 ent: -2.506 str: 0.000 loss: -84.732]Iterations:  57%|█████▋    | 17/30 [00:21<00:14,  1.15s/it, atk: -85.921 ent: -2.506 str: 0.000 loss: -88.427]Iterations:  60%|██████    | 18/30 [00:22<00:15,  1.27s/it, atk: -85.921 ent: -2.506 str: 0.000 loss: -88.427]Iterations:  60%|██████    | 18/30 [00:23<00:15,  1.27s/it, atk: -89.650 ent: -2.505 str: 0.000 loss: -92.156]Iterations:  63%|██████▎   | 19/30 [00:23<00:14,  1.32s/it, atk: -89.650 ent: -2.505 str: 0.000 loss: -92.156]Iterations:  63%|██████▎   | 19/30 [00:24<00:14,  1.32s/it, atk: -92.883 ent: -2.505 str: 0.000 loss: -95.388]Iterations:  67%|██████▋   | 20/30 [00:25<00:13,  1.40s/it, atk: -92.883 ent: -2.505 str: 0.000 loss: -95.388]Iterations:  67%|██████▋   | 20/30 [00:26<00:13,  1.40s/it, atk: -95.983 ent: -2.505 str: 0.000 loss: -98.489]Iterations:  70%|███████   | 21/30 [00:26<00:11,  1.29s/it, atk: -95.983 ent: -2.505 str: 0.000 loss: -98.489]Iterations:  70%|███████   | 21/30 [00:26<00:11,  1.29s/it, atk: -98.490 ent: -2.505 str: 0.000 loss: -100.995]Iterations:  73%|███████▎  | 22/30 [00:27<00:10,  1.30s/it, atk: -98.490 ent: -2.505 str: 0.000 loss: -100.995]Iterations:  73%|███████▎  | 22/30 [00:28<00:10,  1.30s/it, atk: -102.306 ent: -2.505 str: 0.000 loss: -104.811]Iterations:  77%|███████▋  | 23/30 [00:28<00:09,  1.32s/it, atk: -102.306 ent: -2.505 str: 0.000 loss: -104.811]Iterations:  77%|███████▋  | 23/30 [00:29<00:09,  1.32s/it, atk: -103.617 ent: -2.504 str: 0.000 loss: -106.122]Iterations:  80%|████████  | 24/30 [00:30<00:08,  1.38s/it, atk: -103.617 ent: -2.504 str: 0.000 loss: -106.122]Iterations:  80%|████████  | 24/30 [00:31<00:08,  1.38s/it, atk: -107.944 ent: -2.504 str: 0.000 loss: -110.448]Iterations:  83%|████████▎ | 25/30 [00:31<00:06,  1.35s/it, atk: -107.944 ent: -2.504 str: 0.000 loss: -110.448]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.35s/it, atk: -109.896 ent: -2.504 str: 0.000 loss: -112.400]Iterations:  87%|████████▋ | 26/30 [00:33<00:05,  1.34s/it, atk: -109.896 ent: -2.504 str: 0.000 loss: -112.400]Iterations:  87%|████████▋ | 26/30 [00:33<00:05,  1.34s/it, atk: -112.639 ent: -2.504 str: 0.000 loss: -115.143]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.31s/it, atk: -112.639 ent: -2.504 str: 0.000 loss: -115.143]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.31s/it, atk: -116.082 ent: -2.504 str: 0.000 loss: -118.586]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.25s/it, atk: -116.082 ent: -2.504 str: 0.000 loss: -118.586]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.25s/it, atk: -119.382 ent: -2.504 str: 0.000 loss: -121.886]Iterations:  97%|█████████▋| 29/30 [00:36<00:01,  1.29s/it, atk: -119.382 ent: -2.504 str: 0.000 loss: -121.886]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.29s/it, atk: -123.570 ent: -2.504 str: 0.000 loss: -126.074]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.28s/it, atk: -123.570 ent: -2.504 str: 0.000 loss: -126.074]Iterations: 100%|██████████| 30/30 [00:38<00:00,  1.27s/it, atk: -123.570 ent: -2.504 str: 0.000 loss: -126.074]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([727], device='cuda:0') tensor(0.9976, device='cuda:0')
after_true: tensor([498], device='cuda:0') tensor(2.9655e-06, device='cuda:0')
L1: [1718.2823]	L2: [13.031945]	Linf: [0.6862745]

Accuracy on benign examples: 100.0%
gt_label: 565 pred_label: 565 pred_clean_logit 0.9640735387802124
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.79it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.93it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.56it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 10.21it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:01,  9.78it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  9.49it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.36it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  8.95it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  9.30it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.18it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  9.06it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  8.90it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.10it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.79s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.85s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.91s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:08<00:02,  2.36s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:11<00:00,  2.36s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4400
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.232 ent: -5.125 str: 0.000 loss: -6.357]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.36s/it, atk: -1.232 ent: -5.125 str: 0.000 loss: -6.357]Iterations:   3%|▎         | 1/30 [00:03<01:08,  2.36s/it, atk: -3.786 ent: -5.130 str: 0.000 loss: -8.916]Iterations:   7%|▋         | 2/30 [00:03<00:53,  1.92s/it, atk: -3.786 ent: -5.130 str: 0.000 loss: -8.916]Iterations:   7%|▋         | 2/30 [00:04<00:53,  1.92s/it, atk: -7.658 ent: -5.125 str: 0.000 loss: -12.783]Iterations:  10%|█         | 3/30 [00:05<00:46,  1.73s/it, atk: -7.658 ent: -5.125 str: 0.000 loss: -12.783]Iterations:  10%|█         | 3/30 [00:06<00:46,  1.73s/it, atk: -12.317 ent: -5.119 str: 0.000 loss: -17.436]Iterations:  13%|█▎        | 4/30 [00:06<00:38,  1.48s/it, atk: -12.317 ent: -5.119 str: 0.000 loss: -17.436]Iterations:  13%|█▎        | 4/30 [00:06<00:38,  1.48s/it, atk: -17.974 ent: -5.114 str: 0.000 loss: -23.088]Iterations:  17%|█▋        | 5/30 [00:07<00:31,  1.26s/it, atk: -17.974 ent: -5.114 str: 0.000 loss: -23.088]Iterations:  17%|█▋        | 5/30 [00:08<00:31,  1.26s/it, atk: -26.125 ent: -5.111 str: 0.000 loss: -31.237]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.37s/it, atk: -26.125 ent: -5.111 str: 0.000 loss: -31.237]Iterations:  20%|██        | 6/30 [00:09<00:32,  1.37s/it, atk: -32.713 ent: -5.108 str: 0.000 loss: -37.821]Iterations:  23%|██▎       | 7/30 [00:10<00:33,  1.46s/it, atk: -32.713 ent: -5.108 str: 0.000 loss: -37.821]Iterations:  23%|██▎       | 7/30 [00:11<00:33,  1.46s/it, atk: -38.359 ent: -5.107 str: 0.000 loss: -43.466]Iterations:  27%|██▋       | 8/30 [00:12<00:32,  1.47s/it, atk: -38.359 ent: -5.107 str: 0.000 loss: -43.466]Iterations:  27%|██▋       | 8/30 [00:13<00:32,  1.47s/it, atk: -43.629 ent: -5.107 str: 0.000 loss: -48.736]Iterations:  30%|███       | 9/30 [00:13<00:31,  1.51s/it, atk: -43.629 ent: -5.107 str: 0.000 loss: -48.736]Iterations:  30%|███       | 9/30 [00:14<00:31,  1.51s/it, atk: -48.354 ent: -5.104 str: 0.000 loss: -53.458]Iterations:  33%|███▎      | 10/30 [00:15<00:30,  1.52s/it, atk: -48.354 ent: -5.104 str: 0.000 loss: -53.458]Iterations:  33%|███▎      | 10/30 [00:15<00:30,  1.52s/it, atk: -51.521 ent: -5.099 str: 0.000 loss: -56.620]Iterations:  37%|███▋      | 11/30 [00:16<00:25,  1.36s/it, atk: -51.521 ent: -5.099 str: 0.000 loss: -56.620]Iterations:  37%|███▋      | 11/30 [00:17<00:25,  1.36s/it, atk: -54.513 ent: -5.095 str: 0.000 loss: -59.608]Iterations:  40%|████      | 12/30 [00:17<00:25,  1.42s/it, atk: -54.513 ent: -5.095 str: 0.000 loss: -59.608]Iterations:  40%|████      | 12/30 [00:18<00:25,  1.42s/it, atk: -58.291 ent: -5.096 str: 0.000 loss: -63.387]Iterations:  43%|████▎     | 13/30 [00:18<00:22,  1.32s/it, atk: -58.291 ent: -5.096 str: 0.000 loss: -63.387]Iterations:  43%|████▎     | 13/30 [00:19<00:22,  1.32s/it, atk: -62.760 ent: -5.097 str: 0.000 loss: -67.857]Iterations:  47%|████▋     | 14/30 [00:20<00:22,  1.38s/it, atk: -62.760 ent: -5.097 str: 0.000 loss: -67.857]Iterations:  47%|████▋     | 14/30 [00:21<00:22,  1.38s/it, atk: -67.366 ent: -5.096 str: 0.000 loss: -72.463]Iterations:  50%|█████     | 15/30 [00:21<00:18,  1.22s/it, atk: -67.366 ent: -5.096 str: 0.000 loss: -72.463]Iterations:  50%|█████     | 15/30 [00:22<00:18,  1.22s/it, atk: -71.344 ent: -5.093 str: 0.000 loss: -76.437]Iterations:  53%|█████▎    | 16/30 [00:22<00:16,  1.19s/it, atk: -71.344 ent: -5.093 str: 0.000 loss: -76.437]Iterations:  53%|█████▎    | 16/30 [00:23<00:16,  1.19s/it, atk: -74.563 ent: -5.092 str: 0.000 loss: -79.655]Iterations:  57%|█████▋    | 17/30 [00:23<00:16,  1.27s/it, atk: -74.563 ent: -5.092 str: 0.000 loss: -79.655]Iterations:  57%|█████▋    | 17/30 [00:24<00:16,  1.27s/it, atk: -77.728 ent: -5.091 str: 0.000 loss: -82.819]Iterations:  60%|██████    | 18/30 [00:25<00:16,  1.42s/it, atk: -77.728 ent: -5.091 str: 0.000 loss: -82.819]Iterations:  60%|██████    | 18/30 [00:26<00:16,  1.42s/it, atk: -80.153 ent: -5.086 str: 0.000 loss: -85.239]Iterations:  63%|██████▎   | 19/30 [00:27<00:16,  1.50s/it, atk: -80.153 ent: -5.086 str: 0.000 loss: -85.239]Iterations:  63%|██████▎   | 19/30 [00:28<00:16,  1.50s/it, atk: -82.909 ent: -5.087 str: 0.000 loss: -87.996]Iterations:  67%|██████▋   | 20/30 [00:28<00:14,  1.50s/it, atk: -82.909 ent: -5.087 str: 0.000 loss: -87.996]Iterations:  67%|██████▋   | 20/30 [00:29<00:14,  1.50s/it, atk: -85.516 ent: -5.085 str: 0.000 loss: -90.601]Iterations:  70%|███████   | 21/30 [00:29<00:11,  1.32s/it, atk: -85.516 ent: -5.085 str: 0.000 loss: -90.601]Iterations:  70%|███████   | 21/30 [00:30<00:11,  1.32s/it, atk: -88.696 ent: -5.083 str: 0.000 loss: -93.779]Iterations:  73%|███████▎  | 22/30 [00:31<00:11,  1.43s/it, atk: -88.696 ent: -5.083 str: 0.000 loss: -93.779]Iterations:  73%|███████▎  | 22/30 [00:31<00:11,  1.43s/it, atk: -92.542 ent: -5.081 str: 0.000 loss: -97.624]Iterations:  77%|███████▋  | 23/30 [00:32<00:08,  1.28s/it, atk: -92.542 ent: -5.081 str: 0.000 loss: -97.624]Iterations:  77%|███████▋  | 23/30 [00:33<00:08,  1.28s/it, atk: -96.644 ent: -5.083 str: 0.000 loss: -101.728]Iterations:  80%|████████  | 24/30 [00:33<00:07,  1.29s/it, atk: -96.644 ent: -5.083 str: 0.000 loss: -101.728]Iterations:  80%|████████  | 24/30 [00:34<00:07,  1.29s/it, atk: -99.631 ent: -5.084 str: 0.000 loss: -104.715]Iterations:  83%|████████▎ | 25/30 [00:34<00:05,  1.19s/it, atk: -99.631 ent: -5.084 str: 0.000 loss: -104.715]Iterations:  83%|████████▎ | 25/30 [00:35<00:05,  1.19s/it, atk: -103.072 ent: -5.084 str: 0.000 loss: -108.156]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.27s/it, atk: -103.072 ent: -5.084 str: 0.000 loss: -108.156]Iterations:  87%|████████▋ | 26/30 [00:36<00:05,  1.27s/it, atk: -105.153 ent: -5.084 str: 0.000 loss: -110.237]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.19s/it, atk: -105.153 ent: -5.084 str: 0.000 loss: -110.237]Iterations:  90%|█████████ | 27/30 [00:37<00:03,  1.19s/it, atk: -108.239 ent: -5.082 str: 0.000 loss: -113.321]Iterations:  93%|█████████▎| 28/30 [00:38<00:02,  1.25s/it, atk: -108.239 ent: -5.082 str: 0.000 loss: -113.321]Iterations:  93%|█████████▎| 28/30 [00:39<00:02,  1.25s/it, atk: -110.478 ent: -5.082 str: 0.000 loss: -115.559]Iterations:  97%|█████████▋| 29/30 [00:39<00:01,  1.33s/it, atk: -110.478 ent: -5.082 str: 0.000 loss: -115.559]Iterations:  97%|█████████▋| 29/30 [00:40<00:01,  1.33s/it, atk: -113.920 ent: -5.083 str: 0.000 loss: -119.003]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.42s/it, atk: -113.920 ent: -5.083 str: 0.000 loss: -119.003]Iterations: 100%|██████████| 30/30 [00:41<00:00,  1.39s/it, atk: -113.920 ent: -5.083 str: 0.000 loss: -119.003]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([547], device='cuda:0') tensor(0.9996, device='cuda:0')
after_true: tensor([565], device='cuda:0') tensor(9.0859e-06, device='cuda:0')
L1: [2722.0513]	L2: [20.139559]	Linf: [0.73333335]

Accuracy on benign examples: 100.0%
gt_label: 404 pred_label: 404 pred_clean_logit 0.9315080046653748
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  8.96it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.46it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  9.91it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  9.91it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.58it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:01,  8.98it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:01,  8.79it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  8.61it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  8.33it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  7.79it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  7.32it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.84it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.30it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.09it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.62s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.29s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.26s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.42s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5709
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.029 ent: -5.375 str: 0.000 loss: -6.404]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.55s/it, atk: -1.029 ent: -5.375 str: 0.000 loss: -6.404]Iterations:   3%|▎         | 1/30 [00:03<01:13,  2.55s/it, atk: -7.745 ent: -5.353 str: 0.000 loss: -13.098]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.63s/it, atk: -7.745 ent: -5.353 str: 0.000 loss: -13.098]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.63s/it, atk: -18.834 ent: -5.347 str: 0.000 loss: -24.181]Iterations:  10%|█         | 3/30 [00:04<00:38,  1.43s/it, atk: -18.834 ent: -5.347 str: 0.000 loss: -24.181]Iterations:  10%|█         | 3/30 [00:05<00:38,  1.43s/it, atk: -31.131 ent: -5.343 str: 0.000 loss: -36.474]Iterations:  13%|█▎        | 4/30 [00:05<00:32,  1.23s/it, atk: -31.131 ent: -5.343 str: 0.000 loss: -36.474]Iterations:  13%|█▎        | 4/30 [00:06<00:32,  1.23s/it, atk: -42.607 ent: -5.341 str: 0.000 loss: -47.949]Iterations:  17%|█▋        | 5/30 [00:06<00:29,  1.16s/it, atk: -42.607 ent: -5.341 str: 0.000 loss: -47.949]Iterations:  17%|█▋        | 5/30 [00:07<00:29,  1.16s/it, atk: -49.775 ent: -5.337 str: 0.000 loss: -55.112]Iterations:  20%|██        | 6/30 [00:07<00:27,  1.16s/it, atk: -49.775 ent: -5.337 str: 0.000 loss: -55.112]Iterations:  20%|██        | 6/30 [00:08<00:27,  1.16s/it, atk: -60.941 ent: -5.333 str: 0.000 loss: -66.274]Iterations:  23%|██▎       | 7/30 [00:09<00:26,  1.17s/it, atk: -60.941 ent: -5.333 str: 0.000 loss: -66.274]Iterations:  23%|██▎       | 7/30 [00:09<00:26,  1.17s/it, atk: -71.967 ent: -5.334 str: 0.000 loss: -77.301]Iterations:  27%|██▋       | 8/30 [00:10<00:25,  1.16s/it, atk: -71.967 ent: -5.334 str: 0.000 loss: -77.301]Iterations:  27%|██▋       | 8/30 [00:10<00:25,  1.16s/it, atk: -73.509 ent: -5.331 str: 0.000 loss: -78.841]Iterations:  30%|███       | 9/30 [00:11<00:24,  1.18s/it, atk: -73.509 ent: -5.331 str: 0.000 loss: -78.841]Iterations:  30%|███       | 9/30 [00:12<00:24,  1.18s/it, atk: -83.085 ent: -5.339 str: 0.000 loss: -88.425]Iterations:  33%|███▎      | 10/30 [00:12<00:24,  1.21s/it, atk: -83.085 ent: -5.339 str: 0.000 loss: -88.425]Iterations:  33%|███▎      | 10/30 [00:13<00:24,  1.21s/it, atk: -87.966 ent: -5.341 str: 0.000 loss: -93.307]Iterations:  37%|███▋      | 11/30 [00:13<00:22,  1.18s/it, atk: -87.966 ent: -5.341 str: 0.000 loss: -93.307]Iterations:  37%|███▋      | 11/30 [00:14<00:22,  1.18s/it, atk: -94.173 ent: -5.340 str: 0.000 loss: -99.513]Iterations:  40%|████      | 12/30 [00:15<00:22,  1.25s/it, atk: -94.173 ent: -5.340 str: 0.000 loss: -99.513]Iterations:  40%|████      | 12/30 [00:15<00:22,  1.25s/it, atk: -100.445 ent: -5.338 str: 0.000 loss: -105.783]Iterations:  43%|████▎     | 13/30 [00:16<00:20,  1.22s/it, atk: -100.445 ent: -5.338 str: 0.000 loss: -105.783]Iterations:  43%|████▎     | 13/30 [00:16<00:20,  1.22s/it, atk: -106.445 ent: -5.337 str: 0.000 loss: -111.783]Iterations:  47%|████▋     | 14/30 [00:17<00:19,  1.19s/it, atk: -106.445 ent: -5.337 str: 0.000 loss: -111.783]Iterations:  47%|████▋     | 14/30 [00:18<00:19,  1.19s/it, atk: -114.282 ent: -5.336 str: 0.000 loss: -119.618]Iterations:  50%|█████     | 15/30 [00:18<00:17,  1.19s/it, atk: -114.282 ent: -5.336 str: 0.000 loss: -119.618]Iterations:  50%|█████     | 15/30 [00:19<00:17,  1.19s/it, atk: -119.147 ent: -5.336 str: 0.000 loss: -124.483]Iterations:  53%|█████▎    | 16/30 [00:19<00:16,  1.19s/it, atk: -119.147 ent: -5.336 str: 0.000 loss: -124.483]Iterations:  53%|█████▎    | 16/30 [00:20<00:16,  1.19s/it, atk: -124.147 ent: -5.336 str: 0.000 loss: -129.483]Iterations:  57%|█████▋    | 17/30 [00:20<00:13,  1.06s/it, atk: -124.147 ent: -5.336 str: 0.000 loss: -129.483]Iterations:  57%|█████▋    | 17/30 [00:21<00:13,  1.06s/it, atk: -129.463 ent: -5.336 str: 0.000 loss: -134.799]Iterations:  60%|██████    | 18/30 [00:21<00:13,  1.11s/it, atk: -129.463 ent: -5.336 str: 0.000 loss: -134.799]Iterations:  60%|██████    | 18/30 [00:22<00:13,  1.11s/it, atk: -133.511 ent: -5.335 str: 0.000 loss: -138.846]Iterations:  63%|██████▎   | 19/30 [00:22<00:11,  1.06s/it, atk: -133.511 ent: -5.335 str: 0.000 loss: -138.846]Iterations:  63%|██████▎   | 19/30 [00:23<00:11,  1.06s/it, atk: -138.543 ent: -5.334 str: 0.000 loss: -143.876]Iterations:  67%|██████▋   | 20/30 [00:23<00:09,  1.03it/s, atk: -138.543 ent: -5.334 str: 0.000 loss: -143.876]Iterations:  67%|██████▋   | 20/30 [00:24<00:09,  1.03it/s, atk: -145.346 ent: -5.332 str: 0.000 loss: -150.678]Iterations:  70%|███████   | 21/30 [00:24<00:09,  1.03s/it, atk: -145.346 ent: -5.332 str: 0.000 loss: -150.678]Iterations:  70%|███████   | 21/30 [00:25<00:09,  1.03s/it, atk: -151.290 ent: -5.331 str: 0.000 loss: -156.621]Iterations:  73%|███████▎  | 22/30 [00:26<00:09,  1.13s/it, atk: -151.290 ent: -5.331 str: 0.000 loss: -156.621]Iterations:  73%|███████▎  | 22/30 [00:26<00:09,  1.13s/it, atk: -157.257 ent: -5.331 str: 0.000 loss: -162.588]Iterations:  77%|███████▋  | 23/30 [00:27<00:08,  1.19s/it, atk: -157.257 ent: -5.331 str: 0.000 loss: -162.588]Iterations:  77%|███████▋  | 23/30 [00:28<00:08,  1.19s/it, atk: -162.455 ent: -5.331 str: 0.000 loss: -167.786]Iterations:  80%|████████  | 24/30 [00:28<00:07,  1.26s/it, atk: -162.455 ent: -5.331 str: 0.000 loss: -167.786]Iterations:  80%|████████  | 24/30 [00:29<00:07,  1.26s/it, atk: -167.358 ent: -5.331 str: 0.000 loss: -172.688]Iterations:  83%|████████▎ | 25/30 [00:30<00:06,  1.30s/it, atk: -167.358 ent: -5.331 str: 0.000 loss: -172.688]Iterations:  83%|████████▎ | 25/30 [00:30<00:06,  1.30s/it, atk: -172.482 ent: -5.330 str: 0.000 loss: -177.812]Iterations:  87%|████████▋ | 26/30 [00:31<00:04,  1.17s/it, atk: -172.482 ent: -5.330 str: 0.000 loss: -177.812]Iterations:  87%|████████▋ | 26/30 [00:31<00:04,  1.17s/it, atk: -176.578 ent: -5.329 str: 0.000 loss: -181.907]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.19s/it, atk: -176.578 ent: -5.329 str: 0.000 loss: -181.907]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.19s/it, atk: -180.702 ent: -5.328 str: 0.000 loss: -186.030]Iterations:  93%|█████████▎| 28/30 [00:33<00:02,  1.09s/it, atk: -180.702 ent: -5.328 str: 0.000 loss: -186.030]Iterations:  93%|█████████▎| 28/30 [00:33<00:02,  1.09s/it, atk: -185.352 ent: -5.328 str: 0.000 loss: -190.680]Iterations:  97%|█████████▋| 29/30 [00:34<00:01,  1.14s/it, atk: -185.352 ent: -5.328 str: 0.000 loss: -190.680]Iterations:  97%|█████████▋| 29/30 [00:35<00:01,  1.14s/it, atk: -189.430 ent: -5.327 str: 0.000 loss: -194.757]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.14s/it, atk: -189.430 ent: -5.327 str: 0.000 loss: -194.757]Iterations: 100%|██████████| 30/30 [00:35<00:00,  1.19s/it, atk: -189.430 ent: -5.327 str: 0.000 loss: -194.757]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([812], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([404], device='cuda:0') tensor(3.9942e-09, device='cuda:0')
L1: [1670.545]	L2: [13.59749]	Linf: [0.5529412]

Accuracy on benign examples: 100.0%
gt_label: 581 pred_label: 581 pred_clean_logit 0.9957043528556824
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.61it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  8.44it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.26it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.51it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  9.54it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00,  9.85it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.42it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  9.19it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  9.04it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  9.04it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  8.77it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00,  8.44it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.20it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  9.15it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.96s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:12<00:00,  2.44s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4881
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.020 ent: -2.449 str: 0.000 loss: -2.469]Iterations:   3%|▎         | 1/30 [00:02<01:12,  2.48s/it, atk: -0.020 ent: -2.449 str: 0.000 loss: -2.469]Iterations:   3%|▎         | 1/30 [00:03<01:12,  2.48s/it, atk: -0.055 ent: -2.465 str: 0.000 loss: -2.520]Iterations:   7%|▋         | 2/30 [00:03<00:48,  1.74s/it, atk: -0.055 ent: -2.465 str: 0.000 loss: -2.520]Iterations:   7%|▋         | 2/30 [00:04<00:48,  1.74s/it, atk: -0.074 ent: -2.468 str: 0.000 loss: -2.542]Iterations:  10%|█         | 3/30 [00:05<00:44,  1.64s/it, atk: -0.074 ent: -2.468 str: 0.000 loss: -2.542]Iterations:  10%|█         | 3/30 [00:06<00:44,  1.64s/it, atk: -0.149 ent: -2.470 str: 0.000 loss: -2.619]Iterations:  13%|█▎        | 4/30 [00:06<00:40,  1.54s/it, atk: -0.149 ent: -2.470 str: 0.000 loss: -2.619]Iterations:  13%|█▎        | 4/30 [00:07<00:40,  1.54s/it, atk: -0.231 ent: -2.474 str: 0.000 loss: -2.704]Iterations:  17%|█▋        | 5/30 [00:07<00:30,  1.22s/it, atk: -0.231 ent: -2.474 str: 0.000 loss: -2.704]Iterations:  17%|█▋        | 5/30 [00:07<00:30,  1.22s/it, atk: -0.219 ent: -2.471 str: 0.000 loss: -2.690]Iterations:  20%|██        | 6/30 [00:08<00:29,  1.22s/it, atk: -0.219 ent: -2.471 str: 0.000 loss: -2.690]Iterations:  20%|██        | 6/30 [00:08<00:29,  1.22s/it, atk: -0.304 ent: -2.471 str: 0.000 loss: -2.775]Iterations:  23%|██▎       | 7/30 [00:09<00:26,  1.13s/it, atk: -0.304 ent: -2.471 str: 0.000 loss: -2.775]Iterations:  23%|██▎       | 7/30 [00:09<00:26,  1.13s/it, atk: -0.533 ent: -2.476 str: 0.000 loss: -3.009]Iterations:  27%|██▋       | 8/30 [00:10<00:23,  1.08s/it, atk: -0.533 ent: -2.476 str: 0.000 loss: -3.009]Iterations:  27%|██▋       | 8/30 [00:10<00:23,  1.08s/it, atk: -0.661 ent: -2.478 str: 0.000 loss: -3.139]Iterations:  30%|███       | 9/30 [00:11<00:22,  1.09s/it, atk: -0.661 ent: -2.478 str: 0.000 loss: -3.139]Iterations:  30%|███       | 9/30 [00:12<00:22,  1.09s/it, atk: -1.020 ent: -2.479 str: 0.000 loss: -3.499]Iterations:  33%|███▎      | 10/30 [00:12<00:20,  1.02s/it, atk: -1.020 ent: -2.479 str: 0.000 loss: -3.499]Iterations:  33%|███▎      | 10/30 [00:13<00:20,  1.02s/it, atk: -1.248 ent: -2.479 str: 0.000 loss: -3.728]Iterations:  37%|███▋      | 11/30 [00:13<00:18,  1.03it/s, atk: -1.248 ent: -2.479 str: 0.000 loss: -3.728]Iterations:  37%|███▋      | 11/30 [00:13<00:18,  1.03it/s, atk: -1.603 ent: -2.479 str: 0.000 loss: -4.082]Iterations:  40%|████      | 12/30 [00:14<00:17,  1.03it/s, atk: -1.603 ent: -2.479 str: 0.000 loss: -4.082]Iterations:  40%|████      | 12/30 [00:14<00:17,  1.03it/s, atk: -2.173 ent: -2.480 str: 0.000 loss: -4.653]Iterations:  43%|████▎     | 13/30 [00:15<00:18,  1.06s/it, atk: -2.173 ent: -2.480 str: 0.000 loss: -4.653]Iterations:  43%|████▎     | 13/30 [00:16<00:18,  1.06s/it, atk: -2.813 ent: -2.478 str: 0.000 loss: -5.291]Iterations:  47%|████▋     | 14/30 [00:16<00:18,  1.13s/it, atk: -2.813 ent: -2.478 str: 0.000 loss: -5.291]Iterations:  47%|████▋     | 14/30 [00:17<00:18,  1.13s/it, atk: -3.368 ent: -2.475 str: 0.000 loss: -5.844]Iterations:  50%|█████     | 15/30 [00:17<00:16,  1.09s/it, atk: -3.368 ent: -2.475 str: 0.000 loss: -5.844]Iterations:  50%|█████     | 15/30 [00:18<00:16,  1.09s/it, atk: -4.266 ent: -2.476 str: 0.000 loss: -6.742]Iterations:  53%|█████▎    | 16/30 [00:19<00:16,  1.16s/it, atk: -4.266 ent: -2.476 str: 0.000 loss: -6.742]Iterations:  53%|█████▎    | 16/30 [00:19<00:16,  1.16s/it, atk: -5.964 ent: -2.476 str: 0.000 loss: -8.439]Iterations:  57%|█████▋    | 17/30 [00:20<00:15,  1.17s/it, atk: -5.964 ent: -2.476 str: 0.000 loss: -8.439]Iterations:  57%|█████▋    | 17/30 [00:21<00:15,  1.17s/it, atk: -8.354 ent: -2.475 str: 0.000 loss: -10.829]Iterations:  60%|██████    | 18/30 [00:21<00:14,  1.24s/it, atk: -8.354 ent: -2.475 str: 0.000 loss: -10.829]Iterations:  60%|██████    | 18/30 [00:22<00:14,  1.24s/it, atk: -9.851 ent: -2.473 str: 0.000 loss: -12.324]Iterations:  63%|██████▎   | 19/30 [00:22<00:12,  1.15s/it, atk: -9.851 ent: -2.473 str: 0.000 loss: -12.324]Iterations:  63%|██████▎   | 19/30 [00:23<00:12,  1.15s/it, atk: -11.324 ent: -2.474 str: 0.000 loss: -13.798]Iterations:  67%|██████▋   | 20/30 [00:24<00:12,  1.23s/it, atk: -11.324 ent: -2.474 str: 0.000 loss: -13.798]Iterations:  67%|██████▋   | 20/30 [00:24<00:12,  1.23s/it, atk: -13.132 ent: -2.473 str: 0.000 loss: -15.605]Iterations:  70%|███████   | 21/30 [00:25<00:12,  1.35s/it, atk: -13.132 ent: -2.473 str: 0.000 loss: -15.605]Iterations:  70%|███████   | 21/30 [00:26<00:12,  1.35s/it, atk: -15.659 ent: -2.472 str: 0.000 loss: -18.131]Iterations:  73%|███████▎  | 22/30 [00:26<00:09,  1.23s/it, atk: -15.659 ent: -2.472 str: 0.000 loss: -18.131]Iterations:  73%|███████▎  | 22/30 [00:27<00:09,  1.23s/it, atk: -16.936 ent: -2.469 str: 0.000 loss: -19.405]Iterations:  77%|███████▋  | 23/30 [00:27<00:08,  1.18s/it, atk: -16.936 ent: -2.469 str: 0.000 loss: -19.405]Iterations:  77%|███████▋  | 23/30 [00:28<00:08,  1.18s/it, atk: -19.300 ent: -2.472 str: 0.000 loss: -21.772]Iterations:  80%|████████  | 24/30 [00:28<00:07,  1.20s/it, atk: -19.300 ent: -2.472 str: 0.000 loss: -21.772]Iterations:  80%|████████  | 24/30 [00:29<00:07,  1.20s/it, atk: -20.185 ent: -2.471 str: 0.000 loss: -22.656]Iterations:  83%|████████▎ | 25/30 [00:29<00:05,  1.02s/it, atk: -20.185 ent: -2.471 str: 0.000 loss: -22.656]Iterations:  83%|████████▎ | 25/30 [00:30<00:05,  1.02s/it, atk: -22.829 ent: -2.470 str: 0.000 loss: -25.299]Iterations:  87%|████████▋ | 26/30 [00:30<00:04,  1.13s/it, atk: -22.829 ent: -2.470 str: 0.000 loss: -25.299]Iterations:  87%|████████▋ | 26/30 [00:31<00:04,  1.13s/it, atk: -24.768 ent: -2.469 str: 0.000 loss: -27.237]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.29s/it, atk: -24.768 ent: -2.469 str: 0.000 loss: -27.237]Iterations:  90%|█████████ | 27/30 [00:33<00:03,  1.29s/it, atk: -25.714 ent: -2.469 str: 0.000 loss: -28.183]Iterations:  93%|█████████▎| 28/30 [00:33<00:02,  1.32s/it, atk: -25.714 ent: -2.469 str: 0.000 loss: -28.183]Iterations:  93%|█████████▎| 28/30 [00:34<00:02,  1.32s/it, atk: -27.991 ent: -2.470 str: 0.000 loss: -30.462]Iterations:  97%|█████████▋| 29/30 [00:35<00:01,  1.29s/it, atk: -27.991 ent: -2.470 str: 0.000 loss: -30.462]Iterations:  97%|█████████▋| 29/30 [00:35<00:01,  1.29s/it, atk: -29.311 ent: -2.471 str: 0.000 loss: -31.782]Iterations: 100%|██████████| 30/30 [00:36<00:00,  1.33s/it, atk: -29.311 ent: -2.471 str: 0.000 loss: -31.782]Iterations: 100%|██████████| 30/30 [00:36<00:00,  1.22s/it, atk: -29.311 ent: -2.471 str: 0.000 loss: -31.782]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([479], device='cuda:0') tensor(0.8420, device='cuda:0')
after_true: tensor([581], device='cuda:0') tensor(0.0449, device='cuda:0')
L1: [3776.161]	L2: [32.364174]	Linf: [1.]

Accuracy on benign examples: 100.0%
gt_label: 415 pred_label: 415 pred_clean_logit 0.46411532163619995
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.32it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 10.58it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  9.07it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  9.30it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:01,  8.41it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  8.14it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00,  8.29it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  8.36it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 10.22it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 11.44it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 12.09it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.26it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.68s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.20s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:10<00:02,  2.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  3.28s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:14<00:00,  2.90s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3553
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.495 ent: -2.898 str: 0.000 loss: -6.392]Iterations:   3%|▎         | 1/30 [00:02<00:57,  2.00s/it, atk: -3.495 ent: -2.898 str: 0.000 loss: -6.392]Iterations:   3%|▎         | 1/30 [00:02<00:57,  2.00s/it, atk: -16.666 ent: -2.895 str: 0.000 loss: -19.561]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.29s/it, atk: -16.666 ent: -2.895 str: 0.000 loss: -19.561]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.29s/it, atk: -36.240 ent: -2.891 str: 0.000 loss: -39.131]Iterations:  10%|█         | 3/30 [00:04<00:34,  1.29s/it, atk: -36.240 ent: -2.891 str: 0.000 loss: -39.131]Iterations:  10%|█         | 3/30 [00:05<00:34,  1.29s/it, atk: -42.718 ent: -2.884 str: 0.000 loss: -45.602]Iterations:  13%|█▎        | 4/30 [00:05<00:35,  1.38s/it, atk: -42.718 ent: -2.884 str: 0.000 loss: -45.602]Iterations:  13%|█▎        | 4/30 [00:06<00:35,  1.38s/it, atk: -45.849 ent: -2.882 str: 0.000 loss: -48.730]Iterations:  17%|█▋        | 5/30 [00:06<00:34,  1.39s/it, atk: -45.849 ent: -2.882 str: 0.000 loss: -48.730]Iterations:  17%|█▋        | 5/30 [00:07<00:34,  1.39s/it, atk: -51.024 ent: -2.885 str: 0.000 loss: -53.909]Iterations:  20%|██        | 6/30 [00:08<00:33,  1.40s/it, atk: -51.024 ent: -2.885 str: 0.000 loss: -53.909]Iterations:  20%|██        | 6/30 [00:09<00:33,  1.40s/it, atk: -62.002 ent: -2.879 str: 0.000 loss: -64.880]Iterations:  23%|██▎       | 7/30 [00:09<00:31,  1.36s/it, atk: -62.002 ent: -2.879 str: 0.000 loss: -64.880]Iterations:  23%|██▎       | 7/30 [00:10<00:31,  1.36s/it, atk: -70.932 ent: -2.881 str: 0.000 loss: -73.814]Iterations:  27%|██▋       | 8/30 [00:10<00:27,  1.27s/it, atk: -70.932 ent: -2.881 str: 0.000 loss: -73.814]Iterations:  27%|██▋       | 8/30 [00:11<00:27,  1.27s/it, atk: -82.748 ent: -2.881 str: 0.000 loss: -85.629]Iterations:  30%|███       | 9/30 [00:11<00:23,  1.10s/it, atk: -82.748 ent: -2.881 str: 0.000 loss: -85.629]Iterations:  30%|███       | 9/30 [00:12<00:23,  1.10s/it, atk: -91.438 ent: -2.880 str: 0.000 loss: -94.318]Iterations:  33%|███▎      | 10/30 [00:12<00:21,  1.06s/it, atk: -91.438 ent: -2.880 str: 0.000 loss: -94.318]Iterations:  33%|███▎      | 10/30 [00:13<00:21,  1.06s/it, atk: -98.511 ent: -2.880 str: 0.000 loss: -101.391]Iterations:  37%|███▋      | 11/30 [00:13<00:20,  1.10s/it, atk: -98.511 ent: -2.880 str: 0.000 loss: -101.391]Iterations:  37%|███▋      | 11/30 [00:14<00:20,  1.10s/it, atk: -102.118 ent: -2.878 str: 0.000 loss: -104.996]Iterations:  40%|████      | 12/30 [00:14<00:20,  1.12s/it, atk: -102.118 ent: -2.878 str: 0.000 loss: -104.996]Iterations:  40%|████      | 12/30 [00:15<00:20,  1.12s/it, atk: -107.787 ent: -2.878 str: 0.000 loss: -110.665]Iterations:  43%|████▎     | 13/30 [00:16<00:19,  1.17s/it, atk: -107.787 ent: -2.878 str: 0.000 loss: -110.665]Iterations:  43%|████▎     | 13/30 [00:16<00:19,  1.17s/it, atk: -114.820 ent: -2.876 str: 0.000 loss: -117.696]Iterations:  47%|████▋     | 14/30 [00:16<00:16,  1.03s/it, atk: -114.820 ent: -2.876 str: 0.000 loss: -117.696]Iterations:  47%|████▋     | 14/30 [00:17<00:16,  1.03s/it, atk: -120.610 ent: -2.874 str: 0.000 loss: -123.485]Iterations:  50%|█████     | 15/30 [00:17<00:14,  1.03it/s, atk: -120.610 ent: -2.874 str: 0.000 loss: -123.485]Iterations:  50%|█████     | 15/30 [00:18<00:14,  1.03it/s, atk: -126.598 ent: -2.874 str: 0.000 loss: -129.472]Iterations:  53%|█████▎    | 16/30 [00:18<00:14,  1.05s/it, atk: -126.598 ent: -2.874 str: 0.000 loss: -129.472]Iterations:  53%|█████▎    | 16/30 [00:19<00:14,  1.05s/it, atk: -131.564 ent: -2.874 str: 0.000 loss: -134.438]Iterations:  57%|█████▋    | 17/30 [00:20<00:14,  1.11s/it, atk: -131.564 ent: -2.874 str: 0.000 loss: -134.438]Iterations:  57%|█████▋    | 17/30 [00:20<00:14,  1.11s/it, atk: -137.133 ent: -2.874 str: 0.000 loss: -140.007]Iterations:  60%|██████    | 18/30 [00:21<00:13,  1.16s/it, atk: -137.133 ent: -2.874 str: 0.000 loss: -140.007]Iterations:  60%|██████    | 18/30 [00:22<00:13,  1.16s/it, atk: -142.957 ent: -2.875 str: 0.000 loss: -145.831]Iterations:  63%|██████▎   | 19/30 [00:22<00:12,  1.13s/it, atk: -142.957 ent: -2.875 str: 0.000 loss: -145.831]Iterations:  63%|██████▎   | 19/30 [00:23<00:12,  1.13s/it, atk: -147.255 ent: -2.875 str: 0.000 loss: -150.130]Iterations:  67%|██████▋   | 20/30 [00:23<00:11,  1.14s/it, atk: -147.255 ent: -2.875 str: 0.000 loss: -150.130]Iterations:  67%|██████▋   | 20/30 [00:24<00:11,  1.14s/it, atk: -152.862 ent: -2.875 str: 0.000 loss: -155.737]Iterations:  70%|███████   | 21/30 [00:24<00:10,  1.18s/it, atk: -152.862 ent: -2.875 str: 0.000 loss: -155.737]Iterations:  70%|███████   | 21/30 [00:25<00:10,  1.18s/it, atk: -158.105 ent: -2.874 str: 0.000 loss: -160.979]Iterations:  73%|███████▎  | 22/30 [00:25<00:09,  1.13s/it, atk: -158.105 ent: -2.874 str: 0.000 loss: -160.979]Iterations:  73%|███████▎  | 22/30 [00:26<00:09,  1.13s/it, atk: -163.031 ent: -2.874 str: 0.000 loss: -165.904]Iterations:  77%|███████▋  | 23/30 [00:27<00:08,  1.20s/it, atk: -163.031 ent: -2.874 str: 0.000 loss: -165.904]Iterations:  77%|███████▋  | 23/30 [00:28<00:08,  1.20s/it, atk: -143.196 ent: -2.867 str: 0.000 loss: -146.063]Iterations:  80%|████████  | 24/30 [00:28<00:07,  1.23s/it, atk: -143.196 ent: -2.867 str: 0.000 loss: -146.063]Iterations:  80%|████████  | 24/30 [00:29<00:07,  1.23s/it, atk: -151.650 ent: -2.866 str: 0.000 loss: -154.516]Iterations:  83%|████████▎ | 25/30 [00:29<00:06,  1.21s/it, atk: -151.650 ent: -2.866 str: 0.000 loss: -154.516]Iterations:  83%|████████▎ | 25/30 [00:30<00:06,  1.21s/it, atk: -158.352 ent: -2.862 str: 0.000 loss: -161.215]Iterations:  87%|████████▋ | 26/30 [00:30<00:04,  1.19s/it, atk: -158.352 ent: -2.862 str: 0.000 loss: -161.215]Iterations:  87%|████████▋ | 26/30 [00:31<00:04,  1.19s/it, atk: -163.125 ent: -2.862 str: 0.000 loss: -165.987]Iterations:  90%|█████████ | 27/30 [00:31<00:03,  1.09s/it, atk: -163.125 ent: -2.862 str: 0.000 loss: -165.987]Iterations:  90%|█████████ | 27/30 [00:32<00:03,  1.09s/it, atk: -169.388 ent: -2.862 str: 0.000 loss: -172.250]Iterations:  93%|█████████▎| 28/30 [00:32<00:01,  1.03it/s, atk: -169.388 ent: -2.862 str: 0.000 loss: -172.250]Iterations:  93%|█████████▎| 28/30 [00:32<00:01,  1.03it/s, atk: -174.713 ent: -2.863 str: 0.000 loss: -177.576]Iterations:  97%|█████████▋| 29/30 [00:33<00:01,  1.02s/it, atk: -174.713 ent: -2.863 str: 0.000 loss: -177.576]Iterations:  97%|█████████▋| 29/30 [00:34<00:01,  1.02s/it, atk: -182.261 ent: -2.864 str: 0.000 loss: -185.125]Iterations: 100%|██████████| 30/30 [00:34<00:00,  1.04s/it, atk: -182.261 ent: -2.864 str: 0.000 loss: -185.125]Iterations: 100%|██████████| 30/30 [00:34<00:00,  1.16s/it, atk: -182.261 ent: -2.864 str: 0.000 loss: -185.125]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([953], device='cuda:0') tensor(0.9885, device='cuda:0')
after_true: tensor([415], device='cuda:0') tensor(6.7008e-09, device='cuda:0')
L1: [3636.6467]	L2: [23.644272]	Linf: [0.8862745]

Accuracy on benign examples: 100.0%
gt_label: 538 pred_label: 538 pred_clean_logit 0.7416375875473022
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.98it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.18it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.09it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  8.10it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  7.69it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01,  8.04it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:01,  9.43it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:01<00:00, 10.63it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 11.70it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 12.09it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 12.02it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.80it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.42it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.10s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:06,  2.12s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:06<00:04,  2.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:09<00:02,  2.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.87s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:13<00:00,  2.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3914
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.991 ent: -2.671 str: 0.000 loss: -5.662]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.23s/it, atk: -2.991 ent: -2.671 str: 0.000 loss: -5.662]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.23s/it, atk: -4.289 ent: -2.672 str: 0.000 loss: -6.960]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -4.289 ent: -2.672 str: 0.000 loss: -6.960]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -5.874 ent: -2.671 str: 0.000 loss: -8.546]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.31s/it, atk: -5.874 ent: -2.671 str: 0.000 loss: -8.546]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.31s/it, atk: -6.987 ent: -2.671 str: 0.000 loss: -9.658]Iterations:  13%|█▎        | 4/30 [00:05<00:33,  1.27s/it, atk: -6.987 ent: -2.671 str: 0.000 loss: -9.658]Iterations:  13%|█▎        | 4/30 [00:06<00:33,  1.27s/it, atk: -9.044 ent: -2.670 str: 0.000 loss: -11.714]Iterations:  17%|█▋        | 5/30 [00:06<00:30,  1.20s/it, atk: -9.044 ent: -2.670 str: 0.000 loss: -11.714]Iterations:  17%|█▋        | 5/30 [00:07<00:30,  1.20s/it, atk: -10.230 ent: -2.667 str: 0.000 loss: -12.898]Iterations:  20%|██        | 6/30 [00:07<00:25,  1.06s/it, atk: -10.230 ent: -2.667 str: 0.000 loss: -12.898]Iterations:  20%|██        | 6/30 [00:07<00:25,  1.06s/it, atk: -11.614 ent: -2.666 str: 0.000 loss: -14.280]Iterations:  23%|██▎       | 7/30 [00:08<00:24,  1.07s/it, atk: -11.614 ent: -2.666 str: 0.000 loss: -14.280]Iterations:  23%|██▎       | 7/30 [00:08<00:24,  1.07s/it, atk: -13.243 ent: -2.664 str: 0.000 loss: -15.906]Iterations:  27%|██▋       | 8/30 [00:09<00:19,  1.11it/s, atk: -13.243 ent: -2.664 str: 0.000 loss: -15.906]Iterations:  27%|██▋       | 8/30 [00:09<00:19,  1.11it/s, atk: -14.804 ent: -2.662 str: 0.000 loss: -17.466]Iterations:  30%|███       | 9/30 [00:09<00:18,  1.11it/s, atk: -14.804 ent: -2.662 str: 0.000 loss: -17.466]Iterations:  30%|███       | 9/30 [00:10<00:18,  1.11it/s, atk: -16.292 ent: -2.660 str: 0.000 loss: -18.952]Iterations:  33%|███▎      | 10/30 [00:11<00:20,  1.03s/it, atk: -16.292 ent: -2.660 str: 0.000 loss: -18.952]Iterations:  33%|███▎      | 10/30 [00:12<00:20,  1.03s/it, atk: -17.722 ent: -2.659 str: 0.000 loss: -20.381]Iterations:  37%|███▋      | 11/30 [00:12<00:23,  1.23s/it, atk: -17.722 ent: -2.659 str: 0.000 loss: -20.381]Iterations:  37%|███▋      | 11/30 [00:14<00:23,  1.23s/it, atk: -18.707 ent: -2.659 str: 0.000 loss: -21.366]Iterations:  40%|████      | 12/30 [00:14<00:26,  1.45s/it, atk: -18.707 ent: -2.659 str: 0.000 loss: -21.366]Iterations:  40%|████      | 12/30 [00:15<00:26,  1.45s/it, atk: -20.095 ent: -2.656 str: 0.000 loss: -22.751]Iterations:  43%|████▎     | 13/30 [00:16<00:27,  1.61s/it, atk: -20.095 ent: -2.656 str: 0.000 loss: -22.751]Iterations:  43%|████▎     | 13/30 [00:17<00:27,  1.61s/it, atk: -21.222 ent: -2.655 str: 0.000 loss: -23.877]Iterations:  47%|████▋     | 14/30 [00:18<00:25,  1.60s/it, atk: -21.222 ent: -2.655 str: 0.000 loss: -23.877]Iterations:  47%|████▋     | 14/30 [00:19<00:25,  1.60s/it, atk: -22.286 ent: -2.655 str: 0.000 loss: -24.941]Iterations:  50%|█████     | 15/30 [00:20<00:23,  1.60s/it, atk: -22.286 ent: -2.655 str: 0.000 loss: -24.941]Iterations:  50%|█████     | 15/30 [00:21<00:23,  1.60s/it, atk: -23.382 ent: -2.656 str: 0.000 loss: -26.037]Iterations:  53%|█████▎    | 16/30 [00:21<00:22,  1.59s/it, atk: -23.382 ent: -2.656 str: 0.000 loss: -26.037]Iterations:  53%|█████▎    | 16/30 [00:22<00:22,  1.59s/it, atk: -24.793 ent: -2.654 str: 0.000 loss: -27.447]Iterations:  57%|█████▋    | 17/30 [00:22<00:19,  1.47s/it, atk: -24.793 ent: -2.654 str: 0.000 loss: -27.447]Iterations:  57%|█████▋    | 17/30 [00:23<00:19,  1.47s/it, atk: -26.157 ent: -2.653 str: 0.000 loss: -28.810]Iterations:  60%|██████    | 18/30 [00:23<00:14,  1.24s/it, atk: -26.157 ent: -2.653 str: 0.000 loss: -28.810]Iterations:  60%|██████    | 18/30 [00:23<00:14,  1.24s/it, atk: -27.156 ent: -2.653 str: 0.000 loss: -29.809]Iterations:  63%|██████▎   | 19/30 [00:24<00:12,  1.13s/it, atk: -27.156 ent: -2.653 str: 0.000 loss: -29.809]Iterations:  63%|██████▎   | 19/30 [00:25<00:12,  1.13s/it, atk: -28.248 ent: -2.652 str: 0.000 loss: -30.901]Iterations:  67%|██████▋   | 20/30 [00:25<00:12,  1.22s/it, atk: -28.248 ent: -2.652 str: 0.000 loss: -30.901]Iterations:  67%|██████▋   | 20/30 [00:26<00:12,  1.22s/it, atk: -29.603 ent: -2.651 str: 0.000 loss: -32.254]Iterations:  70%|███████   | 21/30 [00:27<00:11,  1.23s/it, atk: -29.603 ent: -2.651 str: 0.000 loss: -32.254]Iterations:  70%|███████   | 21/30 [00:27<00:11,  1.23s/it, atk: -31.210 ent: -2.650 str: 0.000 loss: -33.860]Iterations:  73%|███████▎  | 22/30 [00:28<00:10,  1.26s/it, atk: -31.210 ent: -2.650 str: 0.000 loss: -33.860]Iterations:  73%|███████▎  | 22/30 [00:29<00:10,  1.26s/it, atk: -32.094 ent: -2.649 str: 0.000 loss: -34.743]Iterations:  77%|███████▋  | 23/30 [00:29<00:08,  1.26s/it, atk: -32.094 ent: -2.649 str: 0.000 loss: -34.743]Iterations:  77%|███████▋  | 23/30 [00:30<00:08,  1.26s/it, atk: -33.116 ent: -2.648 str: 0.000 loss: -35.764]Iterations:  80%|████████  | 24/30 [00:30<00:07,  1.25s/it, atk: -33.116 ent: -2.648 str: 0.000 loss: -35.764]Iterations:  80%|████████  | 24/30 [00:31<00:07,  1.25s/it, atk: -34.286 ent: -2.647 str: 0.000 loss: -36.934]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.26s/it, atk: -34.286 ent: -2.647 str: 0.000 loss: -36.934]Iterations:  83%|████████▎ | 25/30 [00:32<00:06,  1.26s/it, atk: -35.500 ent: -2.647 str: 0.000 loss: -38.146]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.22s/it, atk: -35.500 ent: -2.647 str: 0.000 loss: -38.146]Iterations:  87%|████████▋ | 26/30 [00:33<00:04,  1.22s/it, atk: -36.715 ent: -2.646 str: 0.000 loss: -39.361]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.11s/it, atk: -36.715 ent: -2.646 str: 0.000 loss: -39.361]Iterations:  90%|█████████ | 27/30 [00:34<00:03,  1.11s/it, atk: -37.929 ent: -2.645 str: 0.000 loss: -40.574]Iterations:  93%|█████████▎| 28/30 [00:35<00:02,  1.18s/it, atk: -37.929 ent: -2.645 str: 0.000 loss: -40.574]Iterations:  93%|█████████▎| 28/30 [00:36<00:02,  1.18s/it, atk: -39.194 ent: -2.645 str: 0.000 loss: -41.839]Iterations:  97%|█████████▋| 29/30 [00:36<00:01,  1.19s/it, atk: -39.194 ent: -2.645 str: 0.000 loss: -41.839]Iterations:  97%|█████████▋| 29/30 [00:37<00:01,  1.19s/it, atk: -40.288 ent: -2.645 str: 0.000 loss: -42.933]Iterations: 100%|██████████| 30/30 [00:37<00:00,  1.19s/it, atk: -40.288 ent: -2.645 str: 0.000 loss: -42.933]Iterations: 100%|██████████| 30/30 [00:37<00:00,  1.26s/it, atk: -40.288 ent: -2.645 str: 0.000 loss: -42.933]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([406], device='cuda:0') tensor(0.7647, device='cuda:0')
after_true: tensor([538], device='cuda:0') tensor(0.0159, device='cuda:0')
L1: [3465.8826]	L2: [23.073475]	Linf: [0.7019608]

Accuracy on benign examples: 100.0%
gt_label: 768 pred_label: 768 pred_clean_logit 0.3641981780529022
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.21it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.23it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.24it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.29it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 11.18it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00,  9.51it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00,  8.67it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00,  8.35it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00,  8.20it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00,  8.01it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00,  7.46it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:02<00:00,  7.03it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  6.84it/s]DDIM_inverse: 100%|██████████| 19/19 [00:02<00:00,  8.79it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:03<00:14,  3.56s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:06<00:09,  3.27s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:09<00:06,  3.01s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:12<00:03,  3.13s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:18<00:00,  4.23s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:18<00:00,  3.76s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4919
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -18.809 ent: -5.480 str: 0.000 loss: -24.289]Iterations:   3%|▎         | 1/30 [00:02<01:21,  2.83s/it, atk: -18.809 ent: -5.480 str: 0.000 loss: -24.289]Iterations:   3%|▎         | 1/30 [00:03<01:21,  2.83s/it, atk: -19.715 ent: -5.521 str: 0.000 loss: -25.236]Iterations:   7%|▋         | 2/30 [00:04<00:52,  1.87s/it, atk: -19.715 ent: -5.521 str: 0.000 loss: -25.236]Iterations:   7%|▋         | 2/30 [00:04<00:52,  1.87s/it, atk: -28.850 ent: -5.517 str: 0.000 loss: -34.367]Iterations:  10%|█         | 3/30 [00:04<00:38,  1.42s/it, atk: -28.850 ent: -5.517 str: 0.000 loss: -34.367]Iterations:  10%|█         | 3/30 [00:05<00:38,  1.42s/it, atk: -36.398 ent: -5.513 str: 0.000 loss: -41.910]Iterations:  13%|█▎        | 4/30 [00:05<00:33,  1.28s/it, atk: -36.398 ent: -5.513 str: 0.000 loss: -41.910]Iterations:  13%|█▎        | 4/30 [00:06<00:33,  1.28s/it, atk: -45.838 ent: -5.504 str: 0.000 loss: -51.342]Iterations:  17%|█▋        | 5/30 [00:06<00:25,  1.00s/it, atk: -45.838 ent: -5.504 str: 0.000 loss: -51.342]Iterations:  17%|█▋        | 5/30 [00:07<00:25,  1.00s/it, atk: -54.099 ent: -5.494 str: 0.000 loss: -59.593]Iterations:  20%|██        | 6/30 [00:07<00:24,  1.03s/it, atk: -54.099 ent: -5.494 str: 0.000 loss: -59.593]Iterations:  20%|██        | 6/30 [00:08<00:24,  1.03s/it, atk: -68.519 ent: -5.495 str: 0.000 loss: -74.014]Iterations:  23%|██▎       | 7/30 [00:08<00:26,  1.16s/it, atk: -68.519 ent: -5.495 str: 0.000 loss: -74.014]Iterations:  23%|██▎       | 7/30 [00:09<00:26,  1.16s/it, atk: -84.479 ent: -5.493 str: 0.000 loss: -89.972]Iterations:  27%|██▋       | 8/30 [00:10<00:25,  1.15s/it, atk: -84.479 ent: -5.493 str: 0.000 loss: -89.972]Iterations:  27%|██▋       | 8/30 [00:10<00:25,  1.15s/it, atk: -101.162 ent: -5.487 str: 0.000 loss: -106.649]Iterations:  30%|███       | 9/30 [00:11<00:23,  1.14s/it, atk: -101.162 ent: -5.487 str: 0.000 loss: -106.649]Iterations:  30%|███       | 9/30 [00:12<00:23,  1.14s/it, atk: -113.763 ent: -5.484 str: 0.000 loss: -119.247]Iterations:  33%|███▎      | 10/30 [00:12<00:23,  1.16s/it, atk: -113.763 ent: -5.484 str: 0.000 loss: -119.247]Iterations:  33%|███▎      | 10/30 [00:13<00:23,  1.16s/it, atk: -125.427 ent: -5.477 str: 0.000 loss: -130.904]Iterations:  37%|███▋      | 11/30 [00:13<00:21,  1.11s/it, atk: -125.427 ent: -5.477 str: 0.000 loss: -130.904]Iterations:  37%|███▋      | 11/30 [00:13<00:21,  1.11s/it, atk: -135.217 ent: -5.473 str: 0.000 loss: -140.690]Iterations:  40%|████      | 12/30 [00:14<00:17,  1.03it/s, atk: -135.217 ent: -5.473 str: 0.000 loss: -140.690]Iterations:  40%|████      | 12/30 [00:14<00:17,  1.03it/s, atk: -144.850 ent: -5.473 str: 0.000 loss: -150.323]Iterations:  43%|████▎     | 13/30 [00:14<00:14,  1.17it/s, atk: -144.850 ent: -5.473 str: 0.000 loss: -150.323]Iterations:  43%|████▎     | 13/30 [00:14<00:14,  1.17it/s, atk: -155.196 ent: -5.470 str: 0.000 loss: -160.666]Iterations:  47%|████▋     | 14/30 [00:15<00:12,  1.29it/s, atk: -155.196 ent: -5.470 str: 0.000 loss: -160.666]Iterations:  47%|████▋     | 14/30 [00:15<00:12,  1.29it/s, atk: -162.470 ent: -5.467 str: 0.000 loss: -167.937]Iterations:  50%|█████     | 15/30 [00:15<00:10,  1.39it/s, atk: -162.470 ent: -5.467 str: 0.000 loss: -167.937]Iterations:  50%|█████     | 15/30 [00:16<00:10,  1.39it/s, atk: -173.748 ent: -5.465 str: 0.000 loss: -179.213]Iterations:  53%|█████▎    | 16/30 [00:16<00:09,  1.45it/s, atk: -173.748 ent: -5.465 str: 0.000 loss: -179.213]Iterations:  53%|█████▎    | 16/30 [00:16<00:09,  1.45it/s, atk: -182.261 ent: -5.467 str: 0.000 loss: -187.728]Iterations:  57%|█████▋    | 17/30 [00:17<00:08,  1.46it/s, atk: -182.261 ent: -5.467 str: 0.000 loss: -187.728]Iterations:  57%|█████▋    | 17/30 [00:17<00:08,  1.46it/s, atk: -190.719 ent: -5.468 str: 0.000 loss: -196.187]Iterations:  60%|██████    | 18/30 [00:17<00:07,  1.52it/s, atk: -190.719 ent: -5.468 str: 0.000 loss: -196.187]Iterations:  60%|██████    | 18/30 [00:18<00:07,  1.52it/s, atk: -197.268 ent: -5.465 str: 0.000 loss: -202.733]Iterations:  63%|██████▎   | 19/30 [00:18<00:07,  1.51it/s, atk: -197.268 ent: -5.465 str: 0.000 loss: -202.733]Iterations:  63%|██████▎   | 19/30 [00:18<00:07,  1.51it/s, atk: -203.586 ent: -5.465 str: 0.000 loss: -209.052]Iterations:  67%|██████▋   | 20/30 [00:19<00:06,  1.50it/s, atk: -203.586 ent: -5.465 str: 0.000 loss: -209.052]Iterations:  67%|██████▋   | 20/30 [00:19<00:06,  1.50it/s, atk: -211.508 ent: -5.468 str: 0.000 loss: -216.977]Iterations:  70%|███████   | 21/30 [00:19<00:05,  1.51it/s, atk: -211.508 ent: -5.468 str: 0.000 loss: -216.977]Iterations:  70%|███████   | 21/30 [00:20<00:05,  1.51it/s, atk: -217.784 ent: -5.470 str: 0.000 loss: -223.254]Iterations:  73%|███████▎  | 22/30 [00:20<00:05,  1.53it/s, atk: -217.784 ent: -5.470 str: 0.000 loss: -223.254]Iterations:  73%|███████▎  | 22/30 [00:20<00:05,  1.53it/s, atk: -224.338 ent: -5.469 str: 0.000 loss: -229.806]Iterations:  77%|███████▋  | 23/30 [00:20<00:04,  1.60it/s, atk: -224.338 ent: -5.469 str: 0.000 loss: -229.806]Iterations:  77%|███████▋  | 23/30 [00:21<00:04,  1.60it/s, atk: -230.656 ent: -5.463 str: 0.000 loss: -236.119]Iterations:  80%|████████  | 24/30 [00:21<00:03,  1.55it/s, atk: -230.656 ent: -5.463 str: 0.000 loss: -236.119]Iterations:  80%|████████  | 24/30 [00:21<00:03,  1.55it/s, atk: -237.324 ent: -5.466 str: 0.000 loss: -242.791]Iterations:  83%|████████▎ | 25/30 [00:22<00:03,  1.56it/s, atk: -237.324 ent: -5.466 str: 0.000 loss: -242.791]Iterations:  83%|████████▎ | 25/30 [00:22<00:03,  1.56it/s, atk: -240.897 ent: -5.469 str: 0.000 loss: -246.366]Iterations:  87%|████████▋ | 26/30 [00:23<00:02,  1.44it/s, atk: -240.897 ent: -5.469 str: 0.000 loss: -246.366]Iterations:  87%|████████▋ | 26/30 [00:23<00:02,  1.44it/s, atk: -245.391 ent: -5.468 str: 0.000 loss: -250.860]Iterations:  90%|█████████ | 27/30 [00:23<00:01,  1.51it/s, atk: -245.391 ent: -5.468 str: 0.000 loss: -250.860]Iterations:  90%|█████████ | 27/30 [00:24<00:01,  1.51it/s, atk: -249.955 ent: -5.466 str: 0.000 loss: -255.422]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.50it/s, atk: -249.955 ent: -5.466 str: 0.000 loss: -255.422]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.50it/s, atk: -254.549 ent: -5.465 str: 0.000 loss: -260.014]Iterations:  97%|█████████▋| 29/30 [00:25<00:00,  1.46it/s, atk: -254.549 ent: -5.465 str: 0.000 loss: -260.014]Iterations:  97%|█████████▋| 29/30 [00:25<00:00,  1.46it/s, atk: -259.223 ent: -5.463 str: 0.000 loss: -264.686]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.40it/s, atk: -259.223 ent: -5.463 str: 0.000 loss: -264.686]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.16it/s, atk: -259.223 ent: -5.463 str: 0.000 loss: -264.686]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([573], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([768], device='cuda:0') tensor(3.6865e-12, device='cuda:0')
L1: [2944.3413]	L2: [20.697496]	Linf: [0.6392157]

Accuracy on benign examples: 100.0%
gt_label: 819 pred_label: 819 pred_clean_logit 0.9154808521270752
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.74it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.30it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.94it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.12it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.75it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.08it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 20.34it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.74it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.50s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.39s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.49s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.80s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4358
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.580 ent: -2.560 str: 0.000 loss: -3.139]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -0.580 ent: -2.560 str: 0.000 loss: -3.139]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -1.294 ent: -2.551 str: 0.000 loss: -3.845]Iterations:   7%|▋         | 2/30 [00:01<00:24,  1.12it/s, atk: -1.294 ent: -2.551 str: 0.000 loss: -3.845]Iterations:   7%|▋         | 2/30 [00:02<00:24,  1.12it/s, atk: -2.195 ent: -2.555 str: 0.000 loss: -4.749]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.21it/s, atk: -2.195 ent: -2.555 str: 0.000 loss: -4.749]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.21it/s, atk: -3.904 ent: -2.553 str: 0.000 loss: -6.458]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -3.904 ent: -2.553 str: 0.000 loss: -6.458]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -7.639 ent: -2.554 str: 0.000 loss: -10.193]Iterations:  17%|█▋        | 5/30 [00:03<00:18,  1.37it/s, atk: -7.639 ent: -2.554 str: 0.000 loss: -10.193]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.37it/s, atk: -10.941 ent: -2.552 str: 0.000 loss: -13.493]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.40it/s, atk: -10.941 ent: -2.552 str: 0.000 loss: -13.493]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.40it/s, atk: -10.018 ent: -2.551 str: 0.000 loss: -12.569]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.37it/s, atk: -10.018 ent: -2.551 str: 0.000 loss: -12.569]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.37it/s, atk: -16.402 ent: -2.549 str: 0.000 loss: -18.951]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -16.402 ent: -2.549 str: 0.000 loss: -18.951]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -16.442 ent: -2.548 str: 0.000 loss: -18.990]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.42it/s, atk: -16.442 ent: -2.548 str: 0.000 loss: -18.990]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -16.891 ent: -2.546 str: 0.000 loss: -19.436]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.48it/s, atk: -16.891 ent: -2.546 str: 0.000 loss: -19.436]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.48it/s, atk: -23.812 ent: -2.547 str: 0.000 loss: -26.359]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.49it/s, atk: -23.812 ent: -2.547 str: 0.000 loss: -26.359]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -27.984 ent: -2.546 str: 0.000 loss: -30.530]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.48it/s, atk: -27.984 ent: -2.546 str: 0.000 loss: -30.530]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -31.015 ent: -2.545 str: 0.000 loss: -33.560]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.49it/s, atk: -31.015 ent: -2.545 str: 0.000 loss: -33.560]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.49it/s, atk: -33.975 ent: -2.545 str: 0.000 loss: -36.520]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -33.975 ent: -2.545 str: 0.000 loss: -36.520]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -37.412 ent: -2.544 str: 0.000 loss: -39.957]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.51it/s, atk: -37.412 ent: -2.544 str: 0.000 loss: -39.957]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.51it/s, atk: -41.824 ent: -2.543 str: 0.000 loss: -44.367]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.56it/s, atk: -41.824 ent: -2.543 str: 0.000 loss: -44.367]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.56it/s, atk: -44.573 ent: -2.540 str: 0.000 loss: -47.113]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.44it/s, atk: -44.573 ent: -2.540 str: 0.000 loss: -47.113]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.44it/s, atk: -48.750 ent: -2.540 str: 0.000 loss: -51.290]Iterations:  60%|██████    | 18/30 [00:12<00:08,  1.46it/s, atk: -48.750 ent: -2.540 str: 0.000 loss: -51.290]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -52.344 ent: -2.540 str: 0.000 loss: -54.884]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.55it/s, atk: -52.344 ent: -2.540 str: 0.000 loss: -54.884]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.55it/s, atk: -54.709 ent: -2.541 str: 0.000 loss: -57.250]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.57it/s, atk: -54.709 ent: -2.541 str: 0.000 loss: -57.250]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.57it/s, atk: -58.201 ent: -2.541 str: 0.000 loss: -60.741]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.54it/s, atk: -58.201 ent: -2.541 str: 0.000 loss: -60.741]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.54it/s, atk: -61.751 ent: -2.540 str: 0.000 loss: -64.291]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.54it/s, atk: -61.751 ent: -2.540 str: 0.000 loss: -64.291]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.54it/s, atk: -65.276 ent: -2.540 str: 0.000 loss: -67.816]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.46it/s, atk: -65.276 ent: -2.540 str: 0.000 loss: -67.816]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.46it/s, atk: -68.497 ent: -2.540 str: 0.000 loss: -71.038]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.37it/s, atk: -68.497 ent: -2.540 str: 0.000 loss: -71.038]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.37it/s, atk: -69.021 ent: -2.541 str: 0.000 loss: -71.562]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.40it/s, atk: -69.021 ent: -2.541 str: 0.000 loss: -71.562]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.40it/s, atk: -74.286 ent: -2.542 str: 0.000 loss: -76.828]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.42it/s, atk: -74.286 ent: -2.542 str: 0.000 loss: -76.828]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.42it/s, atk: -76.774 ent: -2.542 str: 0.000 loss: -79.315]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.40it/s, atk: -76.774 ent: -2.542 str: 0.000 loss: -79.315]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -79.791 ent: -2.542 str: 0.000 loss: -82.333]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.38it/s, atk: -79.791 ent: -2.542 str: 0.000 loss: -82.333]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.38it/s, atk: -84.402 ent: -2.541 str: 0.000 loss: -86.942]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.33it/s, atk: -84.402 ent: -2.541 str: 0.000 loss: -86.942]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.33it/s, atk: -88.026 ent: -2.540 str: 0.000 loss: -90.566]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.32it/s, atk: -88.026 ent: -2.540 str: 0.000 loss: -90.566]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -88.026 ent: -2.540 str: 0.000 loss: -90.566]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([546], device='cuda:0') tensor(0.9978, device='cuda:0')
after_true: tensor([819], device='cuda:0') tensor(0.0001, device='cuda:0')
L1: [1693.7961]	L2: [13.049584]	Linf: [0.69019604]

Accuracy on benign examples: 100.0%
gt_label: 439 pred_label: 439 pred_clean_logit 0.8597570061683655
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 17.73it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.42it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.33it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.67it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.74it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 16.85it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.19it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.39it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.35s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4973
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.795 ent: -5.087 str: 0.000 loss: -6.882]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.82s/it, atk: -1.795 ent: -5.087 str: 0.000 loss: -6.882]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.82s/it, atk: -9.434 ent: -5.083 str: 0.000 loss: -14.517]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -9.434 ent: -5.083 str: 0.000 loss: -14.517]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -17.771 ent: -5.089 str: 0.000 loss: -22.860]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -17.771 ent: -5.089 str: 0.000 loss: -22.860]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -30.789 ent: -5.087 str: 0.000 loss: -35.876]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -30.789 ent: -5.087 str: 0.000 loss: -35.876]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -42.671 ent: -5.090 str: 0.000 loss: -47.760]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.19it/s, atk: -42.671 ent: -5.090 str: 0.000 loss: -47.760]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.19it/s, atk: -55.898 ent: -5.092 str: 0.000 loss: -60.990]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -55.898 ent: -5.092 str: 0.000 loss: -60.990]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -66.851 ent: -5.094 str: 0.000 loss: -71.945]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -66.851 ent: -5.094 str: 0.000 loss: -71.945]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -73.945 ent: -5.097 str: 0.000 loss: -79.042]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.38it/s, atk: -73.945 ent: -5.097 str: 0.000 loss: -79.042]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -85.914 ent: -5.096 str: 0.000 loss: -91.011]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -85.914 ent: -5.096 str: 0.000 loss: -91.011]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -96.164 ent: -5.096 str: 0.000 loss: -101.260]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -96.164 ent: -5.096 str: 0.000 loss: -101.260]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -106.497 ent: -5.095 str: 0.000 loss: -111.592]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -106.497 ent: -5.095 str: 0.000 loss: -111.592]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -115.108 ent: -5.094 str: 0.000 loss: -120.202]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.43it/s, atk: -115.108 ent: -5.094 str: 0.000 loss: -120.202]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.43it/s, atk: -123.089 ent: -5.093 str: 0.000 loss: -128.182]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -123.089 ent: -5.093 str: 0.000 loss: -128.182]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -130.004 ent: -5.092 str: 0.000 loss: -135.096]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -130.004 ent: -5.092 str: 0.000 loss: -135.096]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -138.345 ent: -5.091 str: 0.000 loss: -143.437]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.49it/s, atk: -138.345 ent: -5.091 str: 0.000 loss: -143.437]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.49it/s, atk: -144.850 ent: -5.090 str: 0.000 loss: -149.940]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -144.850 ent: -5.090 str: 0.000 loss: -149.940]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -151.990 ent: -5.090 str: 0.000 loss: -157.080]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.52it/s, atk: -151.990 ent: -5.090 str: 0.000 loss: -157.080]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.52it/s, atk: -160.155 ent: -5.090 str: 0.000 loss: -165.245]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.47it/s, atk: -160.155 ent: -5.090 str: 0.000 loss: -165.245]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.47it/s, atk: -167.951 ent: -5.090 str: 0.000 loss: -173.041]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -167.951 ent: -5.090 str: 0.000 loss: -173.041]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -176.877 ent: -5.091 str: 0.000 loss: -181.968]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -176.877 ent: -5.091 str: 0.000 loss: -181.968]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -182.938 ent: -5.092 str: 0.000 loss: -188.030]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.39it/s, atk: -182.938 ent: -5.092 str: 0.000 loss: -188.030]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -189.392 ent: -5.093 str: 0.000 loss: -194.485]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.36it/s, atk: -189.392 ent: -5.093 str: 0.000 loss: -194.485]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -195.871 ent: -5.093 str: 0.000 loss: -200.963]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -195.871 ent: -5.093 str: 0.000 loss: -200.963]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -203.329 ent: -5.093 str: 0.000 loss: -208.422]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -203.329 ent: -5.093 str: 0.000 loss: -208.422]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -209.126 ent: -5.094 str: 0.000 loss: -214.220]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.37it/s, atk: -209.126 ent: -5.094 str: 0.000 loss: -214.220]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.37it/s, atk: -214.692 ent: -5.094 str: 0.000 loss: -219.786]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -214.692 ent: -5.094 str: 0.000 loss: -219.786]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -219.573 ent: -5.093 str: 0.000 loss: -224.666]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -219.573 ent: -5.093 str: 0.000 loss: -224.666]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -224.902 ent: -5.093 str: 0.000 loss: -229.995]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -224.902 ent: -5.093 str: 0.000 loss: -229.995]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -230.148 ent: -5.093 str: 0.000 loss: -235.240]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.39it/s, atk: -230.148 ent: -5.093 str: 0.000 loss: -235.240]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.39it/s, atk: -233.930 ent: -5.093 str: 0.000 loss: -239.023]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.46it/s, atk: -233.930 ent: -5.093 str: 0.000 loss: -239.023]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -233.930 ent: -5.093 str: 0.000 loss: -239.023]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([456], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([439], device='cuda:0') tensor(4.1463e-11, device='cuda:0')
L1: [3164.5566]	L2: [24.206024]	Linf: [0.7254902]

Accuracy on benign examples: 100.0%
gt_label: 336 pred_label: 336 pred_clean_logit 0.897901713848114
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.07it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.89it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.45it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.46it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.08it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 23.02it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 24.11it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 22.28it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.97s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.61s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.61s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5220
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.738 ent: -4.933 str: 0.000 loss: -8.671]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.52s/it, atk: -3.738 ent: -4.933 str: 0.000 loss: -8.671]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.52s/it, atk: -12.019 ent: -4.923 str: 0.000 loss: -16.942]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -12.019 ent: -4.923 str: 0.000 loss: -16.942]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -15.140 ent: -4.924 str: 0.000 loss: -20.064]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -15.140 ent: -4.924 str: 0.000 loss: -20.064]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.07s/it, atk: -21.646 ent: -4.926 str: 0.000 loss: -26.571]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.13it/s, atk: -21.646 ent: -4.926 str: 0.000 loss: -26.571]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.13it/s, atk: -27.632 ent: -4.928 str: 0.000 loss: -32.560]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.24it/s, atk: -27.632 ent: -4.928 str: 0.000 loss: -32.560]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.24it/s, atk: -37.632 ent: -4.928 str: 0.000 loss: -42.561]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -37.632 ent: -4.928 str: 0.000 loss: -42.561]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -48.612 ent: -4.927 str: 0.000 loss: -53.539]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.11it/s, atk: -48.612 ent: -4.927 str: 0.000 loss: -53.539]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.11it/s, atk: -54.912 ent: -4.927 str: 0.000 loss: -59.840]Iterations:  27%|██▋       | 8/30 [00:07<00:18,  1.20it/s, atk: -54.912 ent: -4.927 str: 0.000 loss: -59.840]Iterations:  27%|██▋       | 8/30 [00:08<00:18,  1.20it/s, atk: -56.452 ent: -4.921 str: 0.000 loss: -61.373]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -56.452 ent: -4.921 str: 0.000 loss: -61.373]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -59.532 ent: -4.918 str: 0.000 loss: -64.450]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.29it/s, atk: -59.532 ent: -4.918 str: 0.000 loss: -64.450]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.29it/s, atk: -66.130 ent: -4.911 str: 0.000 loss: -71.041]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.24it/s, atk: -66.130 ent: -4.911 str: 0.000 loss: -71.041]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.24it/s, atk: -75.605 ent: -4.911 str: 0.000 loss: -80.515]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.28it/s, atk: -75.605 ent: -4.911 str: 0.000 loss: -80.515]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.28it/s, atk: -84.273 ent: -4.911 str: 0.000 loss: -89.185]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.33it/s, atk: -84.273 ent: -4.911 str: 0.000 loss: -89.185]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.33it/s, atk: -92.684 ent: -4.909 str: 0.000 loss: -97.593]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.35it/s, atk: -92.684 ent: -4.909 str: 0.000 loss: -97.593]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.35it/s, atk: -99.952 ent: -4.911 str: 0.000 loss: -104.863]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -99.952 ent: -4.911 str: 0.000 loss: -104.863]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.34it/s, atk: -110.780 ent: -4.904 str: 0.000 loss: -115.685]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.32it/s, atk: -110.780 ent: -4.904 str: 0.000 loss: -115.685]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.32it/s, atk: -116.209 ent: -4.903 str: 0.000 loss: -121.112]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.44it/s, atk: -116.209 ent: -4.903 str: 0.000 loss: -121.112]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.44it/s, atk: -119.506 ent: -4.904 str: 0.000 loss: -124.410]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.47it/s, atk: -119.506 ent: -4.904 str: 0.000 loss: -124.410]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.47it/s, atk: -120.318 ent: -4.907 str: 0.000 loss: -125.225]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.42it/s, atk: -120.318 ent: -4.907 str: 0.000 loss: -125.225]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.42it/s, atk: -122.261 ent: -4.909 str: 0.000 loss: -127.170]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -122.261 ent: -4.909 str: 0.000 loss: -127.170]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -134.198 ent: -4.908 str: 0.000 loss: -139.106]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.44it/s, atk: -134.198 ent: -4.908 str: 0.000 loss: -139.106]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.44it/s, atk: -144.701 ent: -4.906 str: 0.000 loss: -149.607]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.35it/s, atk: -144.701 ent: -4.906 str: 0.000 loss: -149.607]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.35it/s, atk: -154.548 ent: -4.904 str: 0.000 loss: -159.452]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.38it/s, atk: -154.548 ent: -4.904 str: 0.000 loss: -159.452]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.38it/s, atk: -155.451 ent: -4.909 str: 0.000 loss: -160.360]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.44it/s, atk: -155.451 ent: -4.909 str: 0.000 loss: -160.360]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.44it/s, atk: -165.032 ent: -4.908 str: 0.000 loss: -169.940]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -165.032 ent: -4.908 str: 0.000 loss: -169.940]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.39it/s, atk: -172.970 ent: -4.906 str: 0.000 loss: -177.876]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -172.970 ent: -4.906 str: 0.000 loss: -177.876]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -178.964 ent: -4.905 str: 0.000 loss: -183.869]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.49it/s, atk: -178.964 ent: -4.905 str: 0.000 loss: -183.869]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.49it/s, atk: -186.200 ent: -4.905 str: 0.000 loss: -191.105]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.54it/s, atk: -186.200 ent: -4.905 str: 0.000 loss: -191.105]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.54it/s, atk: -194.395 ent: -4.905 str: 0.000 loss: -199.300]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -194.395 ent: -4.905 str: 0.000 loss: -199.300]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -202.111 ent: -4.904 str: 0.000 loss: -207.015]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.45it/s, atk: -202.111 ent: -4.904 str: 0.000 loss: -207.015]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -202.111 ent: -4.904 str: 0.000 loss: -207.015]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([366], device='cuda:0') tensor(0.9989, device='cuda:0')
after_true: tensor([336], device='cuda:0') tensor(7.1229e-10, device='cuda:0')
L1: [3385.788]	L2: [20.852627]	Linf: [0.52156866]

Accuracy on benign examples: 100.0%
gt_label: 50 pred_label: 50 pred_clean_logit 0.9868040680885315
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 24.33it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.49it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 20.78it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 20.60it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.01it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.08it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 17.69it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.16it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.08s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.70s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3839
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.297 ent: -5.115 str: 0.000 loss: -5.411]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.18s/it, atk: -0.297 ent: -5.115 str: 0.000 loss: -5.411]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.18s/it, atk: -0.843 ent: -5.114 str: 0.000 loss: -5.957]Iterations:   7%|▋         | 2/30 [00:02<00:38,  1.37s/it, atk: -0.843 ent: -5.114 str: 0.000 loss: -5.957]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.37s/it, atk: -3.890 ent: -5.162 str: 0.000 loss: -9.052]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.15s/it, atk: -3.890 ent: -5.162 str: 0.000 loss: -9.052]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.15s/it, atk: -10.475 ent: -5.190 str: 0.000 loss: -15.665]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.02it/s, atk: -10.475 ent: -5.190 str: 0.000 loss: -15.665]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.02it/s, atk: -18.441 ent: -5.185 str: 0.000 loss: -23.626]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -18.441 ent: -5.185 str: 0.000 loss: -23.626]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -24.339 ent: -5.165 str: 0.000 loss: -29.504]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -24.339 ent: -5.165 str: 0.000 loss: -29.504]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -30.984 ent: -5.168 str: 0.000 loss: -36.152]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.27it/s, atk: -30.984 ent: -5.168 str: 0.000 loss: -36.152]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -32.959 ent: -5.167 str: 0.000 loss: -38.125]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -32.959 ent: -5.167 str: 0.000 loss: -38.125]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -37.132 ent: -5.158 str: 0.000 loss: -42.290]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -37.132 ent: -5.158 str: 0.000 loss: -42.290]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.45it/s, atk: -36.773 ent: -5.151 str: 0.000 loss: -41.923]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.39it/s, atk: -36.773 ent: -5.151 str: 0.000 loss: -41.923]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.39it/s, atk: -37.887 ent: -5.146 str: 0.000 loss: -43.033]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.32it/s, atk: -37.887 ent: -5.146 str: 0.000 loss: -43.033]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -42.583 ent: -5.145 str: 0.000 loss: -47.727]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.24it/s, atk: -42.583 ent: -5.145 str: 0.000 loss: -47.727]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.24it/s, atk: -49.397 ent: -5.146 str: 0.000 loss: -54.543]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.22it/s, atk: -49.397 ent: -5.146 str: 0.000 loss: -54.543]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.22it/s, atk: -54.826 ent: -5.146 str: 0.000 loss: -59.972]Iterations:  47%|████▋     | 14/30 [00:12<00:13,  1.21it/s, atk: -54.826 ent: -5.146 str: 0.000 loss: -59.972]Iterations:  47%|████▋     | 14/30 [00:12<00:13,  1.21it/s, atk: -60.222 ent: -5.145 str: 0.000 loss: -65.367]Iterations:  50%|█████     | 15/30 [00:12<00:12,  1.22it/s, atk: -60.222 ent: -5.145 str: 0.000 loss: -65.367]Iterations:  50%|█████     | 15/30 [00:13<00:12,  1.22it/s, atk: -65.309 ent: -5.146 str: 0.000 loss: -70.456]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.26it/s, atk: -65.309 ent: -5.146 str: 0.000 loss: -70.456]Iterations:  53%|█████▎    | 16/30 [00:14<00:11,  1.26it/s, atk: -69.975 ent: -5.142 str: 0.000 loss: -75.116]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.28it/s, atk: -69.975 ent: -5.142 str: 0.000 loss: -75.116]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.28it/s, atk: -71.506 ent: -5.132 str: 0.000 loss: -76.638]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.38it/s, atk: -71.506 ent: -5.132 str: 0.000 loss: -76.638]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.38it/s, atk: -76.059 ent: -5.127 str: 0.000 loss: -81.186]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.43it/s, atk: -76.059 ent: -5.127 str: 0.000 loss: -81.186]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.43it/s, atk: -80.041 ent: -5.122 str: 0.000 loss: -85.163]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.48it/s, atk: -80.041 ent: -5.122 str: 0.000 loss: -85.163]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.48it/s, atk: -83.756 ent: -5.119 str: 0.000 loss: -88.875]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.47it/s, atk: -83.756 ent: -5.119 str: 0.000 loss: -88.875]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.47it/s, atk: -86.300 ent: -5.116 str: 0.000 loss: -91.416]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.45it/s, atk: -86.300 ent: -5.116 str: 0.000 loss: -91.416]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.45it/s, atk: -89.839 ent: -5.116 str: 0.000 loss: -94.955]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.46it/s, atk: -89.839 ent: -5.116 str: 0.000 loss: -94.955]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.46it/s, atk: -92.667 ent: -5.117 str: 0.000 loss: -97.784]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -92.667 ent: -5.117 str: 0.000 loss: -97.784]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -96.658 ent: -5.117 str: 0.000 loss: -101.775]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.33it/s, atk: -96.658 ent: -5.117 str: 0.000 loss: -101.775]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.33it/s, atk: -99.915 ent: -5.117 str: 0.000 loss: -105.032]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.40it/s, atk: -99.915 ent: -5.117 str: 0.000 loss: -105.032]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.40it/s, atk: -103.097 ent: -5.119 str: 0.000 loss: -108.216]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.38it/s, atk: -103.097 ent: -5.119 str: 0.000 loss: -108.216]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.38it/s, atk: -106.033 ent: -5.121 str: 0.000 loss: -111.154]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.41it/s, atk: -106.033 ent: -5.121 str: 0.000 loss: -111.154]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.41it/s, atk: -108.800 ent: -5.123 str: 0.000 loss: -113.922]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.48it/s, atk: -108.800 ent: -5.123 str: 0.000 loss: -113.922]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.48it/s, atk: -111.544 ent: -5.121 str: 0.000 loss: -116.664]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.48it/s, atk: -111.544 ent: -5.121 str: 0.000 loss: -116.664]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -111.544 ent: -5.121 str: 0.000 loss: -116.664]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([49], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([50], device='cuda:0') tensor(1.1852e-05, device='cuda:0')
L1: [2638.4038]	L2: [16.447208]	Linf: [0.45490196]

Accuracy on benign examples: 100.0%
gt_label: 303 pred_label: 303 pred_clean_logit 0.9976637363433838
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.49it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.10it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.99it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.41it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.88it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.36it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.94it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.93it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.61it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.70s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.71s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.59s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3611
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.778 ent: -10.476 str: 0.000 loss: -11.254]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.34s/it, atk: -0.778 ent: -10.476 str: 0.000 loss: -11.254]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.34s/it, atk: -2.433 ent: -10.424 str: 0.000 loss: -12.856]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.33s/it, atk: -2.433 ent: -10.424 str: 0.000 loss: -12.856]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.33s/it, atk: -6.177 ent: -10.427 str: 0.000 loss: -16.604]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -6.177 ent: -10.427 str: 0.000 loss: -16.604]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.07s/it, atk: -9.447 ent: -10.409 str: 0.000 loss: -19.857]Iterations:  13%|█▎        | 4/30 [00:04<00:27,  1.05s/it, atk: -9.447 ent: -10.409 str: 0.000 loss: -19.857]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.05s/it, atk: -9.071 ent: -10.371 str: 0.000 loss: -19.441]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -9.071 ent: -10.371 str: 0.000 loss: -19.441]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -15.246 ent: -10.373 str: 0.000 loss: -25.619]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -15.246 ent: -10.373 str: 0.000 loss: -25.619]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -20.337 ent: -10.362 str: 0.000 loss: -30.699]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.27it/s, atk: -20.337 ent: -10.362 str: 0.000 loss: -30.699]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -27.890 ent: -10.362 str: 0.000 loss: -38.252]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -27.890 ent: -10.362 str: 0.000 loss: -38.252]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -35.064 ent: -10.367 str: 0.000 loss: -45.431]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.50it/s, atk: -35.064 ent: -10.367 str: 0.000 loss: -45.431]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.50it/s, atk: -40.188 ent: -10.370 str: 0.000 loss: -50.558]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.50it/s, atk: -40.188 ent: -10.370 str: 0.000 loss: -50.558]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.50it/s, atk: -45.882 ent: -10.369 str: 0.000 loss: -56.251]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -45.882 ent: -10.369 str: 0.000 loss: -56.251]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -52.820 ent: -10.365 str: 0.000 loss: -63.185]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -52.820 ent: -10.365 str: 0.000 loss: -63.185]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -58.163 ent: -10.364 str: 0.000 loss: -68.527]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.38it/s, atk: -58.163 ent: -10.364 str: 0.000 loss: -68.527]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.38it/s, atk: -63.829 ent: -10.369 str: 0.000 loss: -74.199]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -63.829 ent: -10.369 str: 0.000 loss: -74.199]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.35it/s, atk: -69.096 ent: -10.374 str: 0.000 loss: -79.470]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.35it/s, atk: -69.096 ent: -10.374 str: 0.000 loss: -79.470]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.35it/s, atk: -73.542 ent: -10.377 str: 0.000 loss: -83.918]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -73.542 ent: -10.377 str: 0.000 loss: -83.918]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -78.761 ent: -10.378 str: 0.000 loss: -89.139]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -78.761 ent: -10.378 str: 0.000 loss: -89.139]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.40it/s, atk: -82.265 ent: -10.377 str: 0.000 loss: -92.642]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -82.265 ent: -10.377 str: 0.000 loss: -92.642]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -85.749 ent: -10.375 str: 0.000 loss: -96.125]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.46it/s, atk: -85.749 ent: -10.375 str: 0.000 loss: -96.125]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.46it/s, atk: -88.947 ent: -10.369 str: 0.000 loss: -99.316]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -88.947 ent: -10.369 str: 0.000 loss: -99.316]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.43it/s, atk: -85.459 ent: -10.372 str: 0.000 loss: -95.831]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -85.459 ent: -10.372 str: 0.000 loss: -95.831]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -95.899 ent: -10.359 str: 0.000 loss: -106.259]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.55it/s, atk: -95.899 ent: -10.359 str: 0.000 loss: -106.259]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.55it/s, atk: -97.695 ent: -10.352 str: 0.000 loss: -108.047]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.52it/s, atk: -97.695 ent: -10.352 str: 0.000 loss: -108.047]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.52it/s, atk: -101.316 ent: -10.348 str: 0.000 loss: -111.664]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -101.316 ent: -10.348 str: 0.000 loss: -111.664]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -105.556 ent: -10.344 str: 0.000 loss: -115.901]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -105.556 ent: -10.344 str: 0.000 loss: -115.901]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -109.219 ent: -10.342 str: 0.000 loss: -119.561]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -109.219 ent: -10.342 str: 0.000 loss: -119.561]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.47it/s, atk: -112.218 ent: -10.341 str: 0.000 loss: -122.559]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -112.218 ent: -10.341 str: 0.000 loss: -122.559]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.43it/s, atk: -115.795 ent: -10.340 str: 0.000 loss: -126.136]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -115.795 ent: -10.340 str: 0.000 loss: -126.136]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -119.170 ent: -10.337 str: 0.000 loss: -129.506]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -119.170 ent: -10.337 str: 0.000 loss: -129.506]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.46it/s, atk: -121.876 ent: -10.335 str: 0.000 loss: -132.210]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.44it/s, atk: -121.876 ent: -10.335 str: 0.000 loss: -132.210]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -121.876 ent: -10.335 str: 0.000 loss: -132.210]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([307], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([303], device='cuda:0') tensor(3.8344e-06, device='cuda:0')
L1: [2166.463]	L2: [16.324648]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 33 pred_label: 33 pred_clean_logit 0.9505971074104309
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.01it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.05it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.18it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.23it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.77it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.14it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.94it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.55it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.20s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.25s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.37s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5274
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.639 ent: -7.392 str: 0.000 loss: -8.032]Iterations:   3%|▎         | 1/30 [00:01<00:54,  1.89s/it, atk: -0.639 ent: -7.392 str: 0.000 loss: -8.032]Iterations:   3%|▎         | 1/30 [00:02<00:54,  1.89s/it, atk: -1.093 ent: -7.379 str: 0.000 loss: -8.472]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -1.093 ent: -7.379 str: 0.000 loss: -8.472]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -1.720 ent: -7.383 str: 0.000 loss: -9.103]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -1.720 ent: -7.383 str: 0.000 loss: -9.103]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -2.847 ent: -7.363 str: 0.000 loss: -10.210]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.17it/s, atk: -2.847 ent: -7.363 str: 0.000 loss: -10.210]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.17it/s, atk: -7.538 ent: -7.376 str: 0.000 loss: -14.913]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.25it/s, atk: -7.538 ent: -7.376 str: 0.000 loss: -14.913]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.25it/s, atk: -13.364 ent: -7.384 str: 0.000 loss: -20.748]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -13.364 ent: -7.384 str: 0.000 loss: -20.748]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -21.904 ent: -7.388 str: 0.000 loss: -29.292]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -21.904 ent: -7.388 str: 0.000 loss: -29.292]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -28.009 ent: -7.390 str: 0.000 loss: -35.399]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -28.009 ent: -7.390 str: 0.000 loss: -35.399]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -35.137 ent: -7.389 str: 0.000 loss: -42.526]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -35.137 ent: -7.389 str: 0.000 loss: -42.526]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -45.666 ent: -7.387 str: 0.000 loss: -53.052]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -45.666 ent: -7.387 str: 0.000 loss: -53.052]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -53.494 ent: -7.387 str: 0.000 loss: -60.882]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -53.494 ent: -7.387 str: 0.000 loss: -60.882]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -60.650 ent: -7.390 str: 0.000 loss: -68.040]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.35it/s, atk: -60.650 ent: -7.390 str: 0.000 loss: -68.040]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.35it/s, atk: -70.565 ent: -7.390 str: 0.000 loss: -77.955]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.45it/s, atk: -70.565 ent: -7.390 str: 0.000 loss: -77.955]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.45it/s, atk: -77.744 ent: -7.392 str: 0.000 loss: -85.136]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -77.744 ent: -7.392 str: 0.000 loss: -85.136]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -85.727 ent: -7.395 str: 0.000 loss: -93.122]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -85.727 ent: -7.395 str: 0.000 loss: -93.122]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -93.147 ent: -7.396 str: 0.000 loss: -100.543]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -93.147 ent: -7.396 str: 0.000 loss: -100.543]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -100.259 ent: -7.395 str: 0.000 loss: -107.654]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -100.259 ent: -7.395 str: 0.000 loss: -107.654]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -110.383 ent: -7.394 str: 0.000 loss: -117.776]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -110.383 ent: -7.394 str: 0.000 loss: -117.776]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -116.551 ent: -7.392 str: 0.000 loss: -123.943]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -116.551 ent: -7.392 str: 0.000 loss: -123.943]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.41it/s, atk: -123.318 ent: -7.390 str: 0.000 loss: -130.708]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -123.318 ent: -7.390 str: 0.000 loss: -130.708]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -127.948 ent: -7.388 str: 0.000 loss: -135.336]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -127.948 ent: -7.388 str: 0.000 loss: -135.336]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -134.216 ent: -7.389 str: 0.000 loss: -141.605]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -134.216 ent: -7.389 str: 0.000 loss: -141.605]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.48it/s, atk: -140.335 ent: -7.388 str: 0.000 loss: -147.723]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.48it/s, atk: -140.335 ent: -7.388 str: 0.000 loss: -147.723]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.48it/s, atk: -145.292 ent: -7.387 str: 0.000 loss: -152.679]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.54it/s, atk: -145.292 ent: -7.387 str: 0.000 loss: -152.679]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.54it/s, atk: -151.330 ent: -7.388 str: 0.000 loss: -158.718]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -151.330 ent: -7.388 str: 0.000 loss: -158.718]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.51it/s, atk: -155.445 ent: -7.387 str: 0.000 loss: -162.833]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.51it/s, atk: -155.445 ent: -7.387 str: 0.000 loss: -162.833]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.51it/s, atk: -160.240 ent: -7.389 str: 0.000 loss: -167.629]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -160.240 ent: -7.389 str: 0.000 loss: -167.629]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -163.656 ent: -7.391 str: 0.000 loss: -171.046]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -163.656 ent: -7.391 str: 0.000 loss: -171.046]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -168.887 ent: -7.392 str: 0.000 loss: -176.278]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -168.887 ent: -7.392 str: 0.000 loss: -176.278]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -173.049 ent: -7.392 str: 0.000 loss: -180.441]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.43it/s, atk: -173.049 ent: -7.392 str: 0.000 loss: -180.441]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -173.049 ent: -7.392 str: 0.000 loss: -180.441]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([109], device='cuda:0') tensor(0.9957, device='cuda:0')
after_true: tensor([33], device='cuda:0') tensor(2.0698e-08, device='cuda:0')
L1: [2474.7844]	L2: [17.422405]	Linf: [0.5529412]

Accuracy on benign examples: 100.0%
gt_label: 708 pred_label: 708 pred_clean_logit 0.5240519046783447
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.62it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.46it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.74it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.14it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.05it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.45it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.09it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.34it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.47it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.36s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.39s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.49s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5849
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -5.712 ent: -5.087 str: 0.000 loss: -10.799]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -5.712 ent: -5.087 str: 0.000 loss: -10.799]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -15.393 ent: -5.075 str: 0.000 loss: -20.468]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -15.393 ent: -5.075 str: 0.000 loss: -20.468]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -25.197 ent: -5.079 str: 0.000 loss: -30.275]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -25.197 ent: -5.079 str: 0.000 loss: -30.275]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -32.506 ent: -5.076 str: 0.000 loss: -37.581]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -32.506 ent: -5.076 str: 0.000 loss: -37.581]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -45.087 ent: -5.075 str: 0.000 loss: -50.162]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.19it/s, atk: -45.087 ent: -5.075 str: 0.000 loss: -50.162]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -55.842 ent: -5.071 str: 0.000 loss: -60.913]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -55.842 ent: -5.071 str: 0.000 loss: -60.913]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -63.150 ent: -5.066 str: 0.000 loss: -68.216]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -63.150 ent: -5.066 str: 0.000 loss: -68.216]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -69.437 ent: -5.064 str: 0.000 loss: -74.501]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -69.437 ent: -5.064 str: 0.000 loss: -74.501]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -75.063 ent: -5.064 str: 0.000 loss: -80.127]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -75.063 ent: -5.064 str: 0.000 loss: -80.127]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -83.129 ent: -5.063 str: 0.000 loss: -88.192]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.50it/s, atk: -83.129 ent: -5.063 str: 0.000 loss: -88.192]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.50it/s, atk: -90.694 ent: -5.062 str: 0.000 loss: -95.757]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -90.694 ent: -5.062 str: 0.000 loss: -95.757]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.49it/s, atk: -98.379 ent: -5.062 str: 0.000 loss: -103.441]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.56it/s, atk: -98.379 ent: -5.062 str: 0.000 loss: -103.441]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.56it/s, atk: -105.296 ent: -5.063 str: 0.000 loss: -110.359]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.53it/s, atk: -105.296 ent: -5.063 str: 0.000 loss: -110.359]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.53it/s, atk: -110.816 ent: -5.063 str: 0.000 loss: -115.879]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -110.816 ent: -5.063 str: 0.000 loss: -115.879]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.54it/s, atk: -116.785 ent: -5.062 str: 0.000 loss: -121.847]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -116.785 ent: -5.062 str: 0.000 loss: -121.847]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -123.575 ent: -5.062 str: 0.000 loss: -128.637]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -123.575 ent: -5.062 str: 0.000 loss: -128.637]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -131.458 ent: -5.062 str: 0.000 loss: -136.520]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.33it/s, atk: -131.458 ent: -5.062 str: 0.000 loss: -136.520]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.33it/s, atk: -139.516 ent: -5.063 str: 0.000 loss: -144.578]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.37it/s, atk: -139.516 ent: -5.063 str: 0.000 loss: -144.578]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.37it/s, atk: -146.527 ent: -5.063 str: 0.000 loss: -151.589]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -146.527 ent: -5.063 str: 0.000 loss: -151.589]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -156.808 ent: -5.062 str: 0.000 loss: -161.869]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -156.808 ent: -5.062 str: 0.000 loss: -161.869]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -165.067 ent: -5.060 str: 0.000 loss: -170.127]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -165.067 ent: -5.060 str: 0.000 loss: -170.127]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.51it/s, atk: -172.774 ent: -5.058 str: 0.000 loss: -177.832]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -172.774 ent: -5.058 str: 0.000 loss: -177.832]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -180.548 ent: -5.058 str: 0.000 loss: -185.605]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.54it/s, atk: -180.548 ent: -5.058 str: 0.000 loss: -185.605]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -187.854 ent: -5.057 str: 0.000 loss: -192.911]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.58it/s, atk: -187.854 ent: -5.057 str: 0.000 loss: -192.911]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.58it/s, atk: -193.646 ent: -5.057 str: 0.000 loss: -198.702]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -193.646 ent: -5.057 str: 0.000 loss: -198.702]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -200.885 ent: -5.056 str: 0.000 loss: -205.941]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.54it/s, atk: -200.885 ent: -5.056 str: 0.000 loss: -205.941]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.54it/s, atk: -206.127 ent: -5.055 str: 0.000 loss: -211.182]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.53it/s, atk: -206.127 ent: -5.055 str: 0.000 loss: -211.182]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.53it/s, atk: -214.684 ent: -5.054 str: 0.000 loss: -219.738]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -214.684 ent: -5.054 str: 0.000 loss: -219.738]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -219.993 ent: -5.053 str: 0.000 loss: -225.046]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -219.993 ent: -5.053 str: 0.000 loss: -225.046]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -226.589 ent: -5.053 str: 0.000 loss: -231.641]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.48it/s, atk: -226.589 ent: -5.053 str: 0.000 loss: -231.641]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -226.589 ent: -5.053 str: 0.000 loss: -231.641]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([853], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([708], device='cuda:0') tensor(8.0767e-11, device='cuda:0')
L1: [2852.8665]	L2: [20.207384]	Linf: [0.7607843]

Accuracy on benign examples: 100.0%
gt_label: 475 pred_label: 475 pred_clean_logit 0.9682043790817261
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.18it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.05it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.29it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 23.08it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.51it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.52it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.07s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.86s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.69s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.96s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  2.02s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.96s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5000
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.741 ent: -4.931 str: 0.000 loss: -5.672]Iterations:   3%|▎         | 1/30 [00:02<01:17,  2.66s/it, atk: -0.741 ent: -4.931 str: 0.000 loss: -5.672]Iterations:   3%|▎         | 1/30 [00:03<01:17,  2.66s/it, atk: -3.711 ent: -4.917 str: 0.000 loss: -8.627]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -3.711 ent: -4.917 str: 0.000 loss: -8.627]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -7.282 ent: -4.914 str: 0.000 loss: -12.196]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.24s/it, atk: -7.282 ent: -4.914 str: 0.000 loss: -12.196]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.24s/it, atk: -14.643 ent: -4.906 str: 0.000 loss: -19.550]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.06s/it, atk: -14.643 ent: -4.906 str: 0.000 loss: -19.550]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.06s/it, atk: -26.835 ent: -4.902 str: 0.000 loss: -31.738]Iterations:  17%|█▋        | 5/30 [00:05<00:23,  1.08it/s, atk: -26.835 ent: -4.902 str: 0.000 loss: -31.738]Iterations:  17%|█▋        | 5/30 [00:06<00:23,  1.08it/s, atk: -36.493 ent: -4.901 str: 0.000 loss: -41.394]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.15it/s, atk: -36.493 ent: -4.901 str: 0.000 loss: -41.394]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.15it/s, atk: -46.633 ent: -4.897 str: 0.000 loss: -51.530]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -46.633 ent: -4.897 str: 0.000 loss: -51.530]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -56.215 ent: -4.894 str: 0.000 loss: -61.109]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -56.215 ent: -4.894 str: 0.000 loss: -61.109]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.37it/s, atk: -65.325 ent: -4.892 str: 0.000 loss: -70.217]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -65.325 ent: -4.892 str: 0.000 loss: -70.217]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -71.104 ent: -4.886 str: 0.000 loss: -75.989]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.30it/s, atk: -71.104 ent: -4.886 str: 0.000 loss: -75.989]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.30it/s, atk: -77.086 ent: -4.881 str: 0.000 loss: -81.967]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -77.086 ent: -4.881 str: 0.000 loss: -81.967]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.38it/s, atk: -84.521 ent: -4.878 str: 0.000 loss: -89.399]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.39it/s, atk: -84.521 ent: -4.878 str: 0.000 loss: -89.399]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.39it/s, atk: -93.077 ent: -4.877 str: 0.000 loss: -97.955]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.30it/s, atk: -93.077 ent: -4.877 str: 0.000 loss: -97.955]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.30it/s, atk: -100.427 ent: -4.878 str: 0.000 loss: -105.304]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.36it/s, atk: -100.427 ent: -4.878 str: 0.000 loss: -105.304]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.36it/s, atk: -108.142 ent: -4.876 str: 0.000 loss: -113.019]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -108.142 ent: -4.876 str: 0.000 loss: -113.019]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.41it/s, atk: -109.497 ent: -4.876 str: 0.000 loss: -114.373]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -109.497 ent: -4.876 str: 0.000 loss: -114.373]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -116.972 ent: -4.875 str: 0.000 loss: -121.847]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -116.972 ent: -4.875 str: 0.000 loss: -121.847]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -120.284 ent: -4.874 str: 0.000 loss: -125.157]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.50it/s, atk: -120.284 ent: -4.874 str: 0.000 loss: -125.157]Iterations:  60%|██████    | 18/30 [00:15<00:07,  1.50it/s, atk: -129.212 ent: -4.873 str: 0.000 loss: -134.084]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.53it/s, atk: -129.212 ent: -4.873 str: 0.000 loss: -134.084]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.53it/s, atk: -137.928 ent: -4.873 str: 0.000 loss: -142.801]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.54it/s, atk: -137.928 ent: -4.873 str: 0.000 loss: -142.801]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.54it/s, atk: -145.127 ent: -4.873 str: 0.000 loss: -150.001]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.51it/s, atk: -145.127 ent: -4.873 str: 0.000 loss: -150.001]Iterations:  70%|███████   | 21/30 [00:17<00:05,  1.51it/s, atk: -150.161 ent: -4.873 str: 0.000 loss: -155.033]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.51it/s, atk: -150.161 ent: -4.873 str: 0.000 loss: -155.033]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.51it/s, atk: -156.279 ent: -4.872 str: 0.000 loss: -161.151]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.49it/s, atk: -156.279 ent: -4.872 str: 0.000 loss: -161.151]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.49it/s, atk: -162.940 ent: -4.870 str: 0.000 loss: -167.811]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.50it/s, atk: -162.940 ent: -4.870 str: 0.000 loss: -167.811]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.50it/s, atk: -168.531 ent: -4.870 str: 0.000 loss: -173.402]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.53it/s, atk: -168.531 ent: -4.870 str: 0.000 loss: -173.402]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.53it/s, atk: -175.149 ent: -4.870 str: 0.000 loss: -180.019]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.53it/s, atk: -175.149 ent: -4.870 str: 0.000 loss: -180.019]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.53it/s, atk: -181.634 ent: -4.869 str: 0.000 loss: -186.503]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -181.634 ent: -4.869 str: 0.000 loss: -186.503]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.49it/s, atk: -188.224 ent: -4.869 str: 0.000 loss: -193.092]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -188.224 ent: -4.869 str: 0.000 loss: -193.092]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -188.567 ent: -4.871 str: 0.000 loss: -193.437]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.49it/s, atk: -188.567 ent: -4.871 str: 0.000 loss: -193.437]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.49it/s, atk: -193.862 ent: -4.871 str: 0.000 loss: -198.733]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.51it/s, atk: -193.862 ent: -4.871 str: 0.000 loss: -198.733]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -193.862 ent: -4.871 str: 0.000 loss: -198.733]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([576], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([475], device='cuda:0') tensor(2.2853e-09, device='cuda:0')
L1: [2334.2903]	L2: [16.579168]	Linf: [0.6627451]

Accuracy on benign examples: 100.0%
gt_label: 441 pred_label: 441 pred_clean_logit 0.9470117092132568
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.85it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.56it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.34it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.88it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.73it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.42it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.45it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.74it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.44s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.38s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.59s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5836
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.670 ent: -5.020 str: 0.000 loss: -5.690]Iterations:   3%|▎         | 1/30 [00:02<01:16,  2.64s/it, atk: -0.670 ent: -5.020 str: 0.000 loss: -5.690]Iterations:   3%|▎         | 1/30 [00:02<01:16,  2.64s/it, atk: -4.873 ent: -5.006 str: 0.000 loss: -9.879]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.46s/it, atk: -4.873 ent: -5.006 str: 0.000 loss: -9.879]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.46s/it, atk: -13.570 ent: -4.961 str: 0.000 loss: -18.531]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.11s/it, atk: -13.570 ent: -4.961 str: 0.000 loss: -18.531]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.11s/it, atk: -24.161 ent: -4.947 str: 0.000 loss: -29.107]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -24.161 ent: -4.947 str: 0.000 loss: -29.107]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.05it/s, atk: -33.273 ent: -4.946 str: 0.000 loss: -38.219]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -33.273 ent: -4.946 str: 0.000 loss: -38.219]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -35.860 ent: -4.952 str: 0.000 loss: -40.813]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -35.860 ent: -4.952 str: 0.000 loss: -40.813]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -44.159 ent: -4.954 str: 0.000 loss: -49.113]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -44.159 ent: -4.954 str: 0.000 loss: -49.113]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -52.054 ent: -4.958 str: 0.000 loss: -57.012]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -52.054 ent: -4.958 str: 0.000 loss: -57.012]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -60.083 ent: -4.960 str: 0.000 loss: -65.043]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -60.083 ent: -4.960 str: 0.000 loss: -65.043]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -67.915 ent: -4.962 str: 0.000 loss: -72.877]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -67.915 ent: -4.962 str: 0.000 loss: -72.877]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -74.758 ent: -4.962 str: 0.000 loss: -79.720]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -74.758 ent: -4.962 str: 0.000 loss: -79.720]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.37it/s, atk: -82.837 ent: -4.960 str: 0.000 loss: -87.797]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -82.837 ent: -4.960 str: 0.000 loss: -87.797]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -88.516 ent: -4.957 str: 0.000 loss: -93.473]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -88.516 ent: -4.957 str: 0.000 loss: -93.473]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.46it/s, atk: -95.326 ent: -4.955 str: 0.000 loss: -100.281]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.38it/s, atk: -95.326 ent: -4.955 str: 0.000 loss: -100.281]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -102.863 ent: -4.955 str: 0.000 loss: -107.818]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -102.863 ent: -4.955 str: 0.000 loss: -107.818]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -107.891 ent: -4.957 str: 0.000 loss: -112.848]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -107.891 ent: -4.957 str: 0.000 loss: -112.848]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -113.582 ent: -4.959 str: 0.000 loss: -118.541]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.42it/s, atk: -113.582 ent: -4.959 str: 0.000 loss: -118.541]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.42it/s, atk: -118.091 ent: -4.955 str: 0.000 loss: -123.046]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -118.091 ent: -4.955 str: 0.000 loss: -123.046]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -123.101 ent: -4.954 str: 0.000 loss: -128.055]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.58it/s, atk: -123.101 ent: -4.954 str: 0.000 loss: -128.055]Iterations:  63%|██████▎   | 19/30 [00:15<00:06,  1.58it/s, atk: -128.261 ent: -4.954 str: 0.000 loss: -133.215]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.52it/s, atk: -128.261 ent: -4.954 str: 0.000 loss: -133.215]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.52it/s, atk: -133.015 ent: -4.955 str: 0.000 loss: -137.970]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -133.015 ent: -4.955 str: 0.000 loss: -137.970]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -137.862 ent: -4.955 str: 0.000 loss: -142.817]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.39it/s, atk: -137.862 ent: -4.955 str: 0.000 loss: -142.817]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.39it/s, atk: -142.493 ent: -4.955 str: 0.000 loss: -147.448]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.48it/s, atk: -142.493 ent: -4.955 str: 0.000 loss: -147.448]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.48it/s, atk: -147.487 ent: -4.956 str: 0.000 loss: -152.443]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -147.487 ent: -4.956 str: 0.000 loss: -152.443]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -152.820 ent: -4.956 str: 0.000 loss: -157.776]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.49it/s, atk: -152.820 ent: -4.956 str: 0.000 loss: -157.776]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.49it/s, atk: -157.804 ent: -4.957 str: 0.000 loss: -162.761]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -157.804 ent: -4.957 str: 0.000 loss: -162.761]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.46it/s, atk: -163.247 ent: -4.958 str: 0.000 loss: -168.206]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.53it/s, atk: -163.247 ent: -4.958 str: 0.000 loss: -168.206]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.53it/s, atk: -168.961 ent: -4.959 str: 0.000 loss: -173.920]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -168.961 ent: -4.959 str: 0.000 loss: -173.920]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -175.974 ent: -4.960 str: 0.000 loss: -180.934]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.54it/s, atk: -175.974 ent: -4.960 str: 0.000 loss: -180.934]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.54it/s, atk: -182.413 ent: -4.961 str: 0.000 loss: -187.374]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.42it/s, atk: -182.413 ent: -4.961 str: 0.000 loss: -187.374]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -182.413 ent: -4.961 str: 0.000 loss: -187.374]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([629], device='cuda:0') tensor(0.8389, device='cuda:0')
after_true: tensor([441], device='cuda:0') tensor(5.8733e-09, device='cuda:0')
L1: [2687.7925]	L2: [18.564865]	Linf: [0.7137255]

Accuracy on benign examples: 100.0%
gt_label: 308 pred_label: 308 pred_clean_logit 0.9958985447883606
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:05,  3.11it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.31it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.33it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 13.49it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 14.56it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.00it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 18.56it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.85it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.23it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.42s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.31s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.34s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.48s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.52s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3488
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.107 ent: -2.877 str: 0.000 loss: -2.984]Iterations:   3%|▎         | 1/30 [00:01<00:51,  1.79s/it, atk: -0.107 ent: -2.877 str: 0.000 loss: -2.984]Iterations:   3%|▎         | 1/30 [00:02<00:51,  1.79s/it, atk: -0.463 ent: -2.884 str: 0.000 loss: -3.348]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -0.463 ent: -2.884 str: 0.000 loss: -3.348]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -2.156 ent: -2.882 str: 0.000 loss: -5.038]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -2.156 ent: -2.882 str: 0.000 loss: -5.038]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -5.780 ent: -2.882 str: 0.000 loss: -8.662]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.18it/s, atk: -5.780 ent: -2.882 str: 0.000 loss: -8.662]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.18it/s, atk: -15.066 ent: -2.882 str: 0.000 loss: -17.948]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -15.066 ent: -2.882 str: 0.000 loss: -17.948]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -25.621 ent: -2.880 str: 0.000 loss: -28.501]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -25.621 ent: -2.880 str: 0.000 loss: -28.501]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -34.795 ent: -2.879 str: 0.000 loss: -37.674]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -34.795 ent: -2.879 str: 0.000 loss: -37.674]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.43it/s, atk: -41.559 ent: -2.879 str: 0.000 loss: -44.438]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -41.559 ent: -2.879 str: 0.000 loss: -44.438]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -47.332 ent: -2.878 str: 0.000 loss: -50.210]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -47.332 ent: -2.878 str: 0.000 loss: -50.210]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -51.309 ent: -2.878 str: 0.000 loss: -54.187]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.39it/s, atk: -51.309 ent: -2.878 str: 0.000 loss: -54.187]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.39it/s, atk: -55.857 ent: -2.877 str: 0.000 loss: -58.734]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.38it/s, atk: -55.857 ent: -2.877 str: 0.000 loss: -58.734]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -59.172 ent: -2.877 str: 0.000 loss: -62.048]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -59.172 ent: -2.877 str: 0.000 loss: -62.048]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -64.134 ent: -2.875 str: 0.000 loss: -67.009]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.48it/s, atk: -64.134 ent: -2.875 str: 0.000 loss: -67.009]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -68.804 ent: -2.874 str: 0.000 loss: -71.679]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -68.804 ent: -2.874 str: 0.000 loss: -71.679]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -72.653 ent: -2.874 str: 0.000 loss: -75.527]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -72.653 ent: -2.874 str: 0.000 loss: -75.527]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -76.446 ent: -2.873 str: 0.000 loss: -79.319]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -76.446 ent: -2.873 str: 0.000 loss: -79.319]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.55it/s, atk: -80.189 ent: -2.872 str: 0.000 loss: -83.061]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.51it/s, atk: -80.189 ent: -2.872 str: 0.000 loss: -83.061]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.51it/s, atk: -83.676 ent: -2.871 str: 0.000 loss: -86.547]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -83.676 ent: -2.871 str: 0.000 loss: -86.547]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -86.500 ent: -2.870 str: 0.000 loss: -89.369]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.33it/s, atk: -86.500 ent: -2.870 str: 0.000 loss: -89.369]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.33it/s, atk: -89.334 ent: -2.869 str: 0.000 loss: -92.203]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.45it/s, atk: -89.334 ent: -2.869 str: 0.000 loss: -92.203]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -92.133 ent: -2.869 str: 0.000 loss: -95.002]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.46it/s, atk: -92.133 ent: -2.869 str: 0.000 loss: -95.002]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -91.311 ent: -2.869 str: 0.000 loss: -94.179]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.23it/s, atk: -91.311 ent: -2.869 str: 0.000 loss: -94.179]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.23it/s, atk: -95.576 ent: -2.864 str: 0.000 loss: -98.440]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.29it/s, atk: -95.576 ent: -2.864 str: 0.000 loss: -98.440]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.29it/s, atk: -96.329 ent: -2.861 str: 0.000 loss: -99.191]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.33it/s, atk: -96.329 ent: -2.861 str: 0.000 loss: -99.191]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.33it/s, atk: -98.459 ent: -2.860 str: 0.000 loss: -101.319]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.33it/s, atk: -98.459 ent: -2.860 str: 0.000 loss: -101.319]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.33it/s, atk: -100.713 ent: -2.860 str: 0.000 loss: -103.573]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -100.713 ent: -2.860 str: 0.000 loss: -103.573]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -103.206 ent: -2.859 str: 0.000 loss: -106.065]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -103.206 ent: -2.859 str: 0.000 loss: -106.065]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -105.585 ent: -2.859 str: 0.000 loss: -108.445]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -105.585 ent: -2.859 str: 0.000 loss: -108.445]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -108.073 ent: -2.860 str: 0.000 loss: -110.932]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -108.073 ent: -2.860 str: 0.000 loss: -110.932]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -109.632 ent: -2.860 str: 0.000 loss: -112.492]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.54it/s, atk: -109.632 ent: -2.860 str: 0.000 loss: -112.492]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -109.632 ent: -2.860 str: 0.000 loss: -112.492]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([309], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([308], device='cuda:0') tensor(1.3861e-05, device='cuda:0')
L1: [3321.122]	L2: [22.545086]	Linf: [0.9372549]

Accuracy on benign examples: 100.0%
gt_label: 990 pred_label: 990 pred_clean_logit 0.9910195469856262
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.29it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.06it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.89it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.83it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.81it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.05s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.78s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.79s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.81s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5384
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.036 ent: -2.512 str: 0.000 loss: -2.548]Iterations:   3%|▎         | 1/30 [00:02<01:17,  2.66s/it, atk: -0.036 ent: -2.512 str: 0.000 loss: -2.548]Iterations:   3%|▎         | 1/30 [00:03<01:17,  2.66s/it, atk: -0.288 ent: -2.512 str: 0.000 loss: -2.800]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.57s/it, atk: -0.288 ent: -2.512 str: 0.000 loss: -2.800]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.57s/it, atk: -1.068 ent: -2.510 str: 0.000 loss: -3.578]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -1.068 ent: -2.510 str: 0.000 loss: -3.578]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -1.580 ent: -2.514 str: 0.000 loss: -4.094]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.01s/it, atk: -1.580 ent: -2.514 str: 0.000 loss: -4.094]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.01s/it, atk: -3.303 ent: -2.512 str: 0.000 loss: -5.815]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -3.303 ent: -2.512 str: 0.000 loss: -5.815]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -6.859 ent: -2.511 str: 0.000 loss: -9.370]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -6.859 ent: -2.511 str: 0.000 loss: -9.370]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -12.088 ent: -2.509 str: 0.000 loss: -14.597]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -12.088 ent: -2.509 str: 0.000 loss: -14.597]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.30it/s, atk: -15.102 ent: -2.510 str: 0.000 loss: -17.612]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -15.102 ent: -2.510 str: 0.000 loss: -17.612]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.33it/s, atk: -21.184 ent: -2.511 str: 0.000 loss: -23.694]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -21.184 ent: -2.511 str: 0.000 loss: -23.694]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -27.213 ent: -2.511 str: 0.000 loss: -29.724]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.42it/s, atk: -27.213 ent: -2.511 str: 0.000 loss: -29.724]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.42it/s, atk: -29.670 ent: -2.513 str: 0.000 loss: -32.183]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -29.670 ent: -2.513 str: 0.000 loss: -32.183]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.44it/s, atk: -34.770 ent: -2.514 str: 0.000 loss: -37.285]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.50it/s, atk: -34.770 ent: -2.514 str: 0.000 loss: -37.285]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.50it/s, atk: -38.374 ent: -2.515 str: 0.000 loss: -40.890]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.44it/s, atk: -38.374 ent: -2.515 str: 0.000 loss: -40.890]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.44it/s, atk: -43.501 ent: -2.516 str: 0.000 loss: -46.017]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -43.501 ent: -2.516 str: 0.000 loss: -46.017]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.44it/s, atk: -48.913 ent: -2.517 str: 0.000 loss: -51.429]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -48.913 ent: -2.517 str: 0.000 loss: -51.429]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.34it/s, atk: -55.204 ent: -2.517 str: 0.000 loss: -57.721]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -55.204 ent: -2.517 str: 0.000 loss: -57.721]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -58.843 ent: -2.517 str: 0.000 loss: -61.360]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.35it/s, atk: -58.843 ent: -2.517 str: 0.000 loss: -61.360]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.35it/s, atk: -63.705 ent: -2.517 str: 0.000 loss: -66.222]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.35it/s, atk: -63.705 ent: -2.517 str: 0.000 loss: -66.222]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.35it/s, atk: -67.152 ent: -2.517 str: 0.000 loss: -69.670]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -67.152 ent: -2.517 str: 0.000 loss: -69.670]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -71.926 ent: -2.517 str: 0.000 loss: -74.443]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -71.926 ent: -2.517 str: 0.000 loss: -74.443]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -76.326 ent: -2.516 str: 0.000 loss: -78.842]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -76.326 ent: -2.516 str: 0.000 loss: -78.842]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.46it/s, atk: -80.528 ent: -2.516 str: 0.000 loss: -83.044]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -80.528 ent: -2.516 str: 0.000 loss: -83.044]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.43it/s, atk: -85.798 ent: -2.516 str: 0.000 loss: -88.314]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -85.798 ent: -2.516 str: 0.000 loss: -88.314]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -90.160 ent: -2.517 str: 0.000 loss: -92.677]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.36it/s, atk: -90.160 ent: -2.517 str: 0.000 loss: -92.677]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.36it/s, atk: -95.347 ent: -2.518 str: 0.000 loss: -97.865]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -95.347 ent: -2.518 str: 0.000 loss: -97.865]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.36it/s, atk: -99.714 ent: -2.518 str: 0.000 loss: -102.231]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -99.714 ent: -2.518 str: 0.000 loss: -102.231]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -101.260 ent: -2.518 str: 0.000 loss: -103.777]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.40it/s, atk: -101.260 ent: -2.518 str: 0.000 loss: -103.777]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.40it/s, atk: -107.164 ent: -2.518 str: 0.000 loss: -109.682]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -107.164 ent: -2.518 str: 0.000 loss: -109.682]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.42it/s, atk: -109.940 ent: -2.517 str: 0.000 loss: -112.458]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.37it/s, atk: -109.940 ent: -2.517 str: 0.000 loss: -112.458]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.37it/s, atk: -113.430 ent: -2.517 str: 0.000 loss: -115.947]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.47it/s, atk: -113.430 ent: -2.517 str: 0.000 loss: -115.947]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -113.430 ent: -2.517 str: 0.000 loss: -115.947]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([738], device='cuda:0') tensor(0.9886, device='cuda:0')
after_true: tensor([990], device='cuda:0') tensor(7.9706e-06, device='cuda:0')
L1: [4599.102]	L2: [32.170315]	Linf: [0.9764706]

Accuracy on benign examples: 100.0%
gt_label: 511 pred_label: 511 pred_clean_logit 0.967842698097229
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.27it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.88it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 14.84it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.09it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.17it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.78it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.15it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.92it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.29it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.27s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.29s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.46s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4643
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.347 ent: -2.520 str: 0.000 loss: -2.867]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.69s/it, atk: -0.347 ent: -2.520 str: 0.000 loss: -2.867]Iterations:   3%|▎         | 1/30 [00:02<00:48,  1.69s/it, atk: -1.274 ent: -2.512 str: 0.000 loss: -3.786]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -1.274 ent: -2.512 str: 0.000 loss: -3.786]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -2.359 ent: -2.502 str: 0.000 loss: -4.860]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -2.359 ent: -2.502 str: 0.000 loss: -4.860]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -3.424 ent: -2.497 str: 0.000 loss: -5.921]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.23it/s, atk: -3.424 ent: -2.497 str: 0.000 loss: -5.921]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.23it/s, atk: -5.794 ent: -2.494 str: 0.000 loss: -8.288]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -5.794 ent: -2.494 str: 0.000 loss: -8.288]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -8.273 ent: -2.495 str: 0.000 loss: -10.768]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -8.273 ent: -2.495 str: 0.000 loss: -10.768]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -10.850 ent: -2.491 str: 0.000 loss: -13.341]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -10.850 ent: -2.491 str: 0.000 loss: -13.341]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -11.828 ent: -2.489 str: 0.000 loss: -14.317]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.33it/s, atk: -11.828 ent: -2.489 str: 0.000 loss: -14.317]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.33it/s, atk: -15.571 ent: -2.491 str: 0.000 loss: -18.062]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -15.571 ent: -2.491 str: 0.000 loss: -18.062]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -16.519 ent: -2.494 str: 0.000 loss: -19.013]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.31it/s, atk: -16.519 ent: -2.494 str: 0.000 loss: -19.013]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.31it/s, atk: -20.738 ent: -2.492 str: 0.000 loss: -23.230]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.36it/s, atk: -20.738 ent: -2.492 str: 0.000 loss: -23.230]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.36it/s, atk: -23.043 ent: -2.489 str: 0.000 loss: -25.532]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.34it/s, atk: -23.043 ent: -2.489 str: 0.000 loss: -25.532]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -24.120 ent: -2.486 str: 0.000 loss: -26.605]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -24.120 ent: -2.486 str: 0.000 loss: -26.605]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -25.596 ent: -2.483 str: 0.000 loss: -28.079]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -25.596 ent: -2.483 str: 0.000 loss: -28.079]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -29.022 ent: -2.483 str: 0.000 loss: -31.505]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -29.022 ent: -2.483 str: 0.000 loss: -31.505]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -31.957 ent: -2.483 str: 0.000 loss: -34.440]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -31.957 ent: -2.483 str: 0.000 loss: -34.440]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -33.515 ent: -2.483 str: 0.000 loss: -35.998]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -33.515 ent: -2.483 str: 0.000 loss: -35.998]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.48it/s, atk: -35.848 ent: -2.484 str: 0.000 loss: -38.332]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -35.848 ent: -2.484 str: 0.000 loss: -38.332]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -38.075 ent: -2.484 str: 0.000 loss: -40.559]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -38.075 ent: -2.484 str: 0.000 loss: -40.559]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -39.863 ent: -2.484 str: 0.000 loss: -42.347]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.59it/s, atk: -39.863 ent: -2.484 str: 0.000 loss: -42.347]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.59it/s, atk: -41.933 ent: -2.484 str: 0.000 loss: -44.416]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.58it/s, atk: -41.933 ent: -2.484 str: 0.000 loss: -44.416]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.58it/s, atk: -43.652 ent: -2.484 str: 0.000 loss: -46.136]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.59it/s, atk: -43.652 ent: -2.484 str: 0.000 loss: -46.136]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.59it/s, atk: -45.446 ent: -2.484 str: 0.000 loss: -47.930]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.57it/s, atk: -45.446 ent: -2.484 str: 0.000 loss: -47.930]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.57it/s, atk: -44.982 ent: -2.487 str: 0.000 loss: -47.469]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -44.982 ent: -2.487 str: 0.000 loss: -47.469]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -46.414 ent: -2.489 str: 0.000 loss: -48.902]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -46.414 ent: -2.489 str: 0.000 loss: -48.902]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -48.819 ent: -2.488 str: 0.000 loss: -51.307]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.58it/s, atk: -48.819 ent: -2.488 str: 0.000 loss: -51.307]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.58it/s, atk: -51.493 ent: -2.488 str: 0.000 loss: -53.981]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.42it/s, atk: -51.493 ent: -2.488 str: 0.000 loss: -53.981]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.42it/s, atk: -54.354 ent: -2.488 str: 0.000 loss: -56.842]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -54.354 ent: -2.488 str: 0.000 loss: -56.842]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -56.367 ent: -2.488 str: 0.000 loss: -58.855]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.45it/s, atk: -56.367 ent: -2.488 str: 0.000 loss: -58.855]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -58.318 ent: -2.489 str: 0.000 loss: -60.807]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -58.318 ent: -2.489 str: 0.000 loss: -60.807]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -58.318 ent: -2.489 str: 0.000 loss: -60.807]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([436], device='cuda:0') tensor(0.8836, device='cuda:0')
after_true: tensor([511], device='cuda:0') tensor(0.0024, device='cuda:0')
L1: [3435.3608]	L2: [24.658878]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 644 pred_label: 644 pred_clean_logit 0.9999586343765259
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.06it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.65it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.43it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.67it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.36it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 21.79it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.96it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.69s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.63s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.64s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2693
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.000 ent: -5.575 str: 0.000 loss: -5.575]Iterations:   3%|▎         | 1/30 [00:02<01:22,  2.83s/it, atk: -0.000 ent: -5.575 str: 0.000 loss: -5.575]Iterations:   3%|▎         | 1/30 [00:03<01:22,  2.83s/it, atk: -0.000 ent: -5.574 str: 0.000 loss: -5.575]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.55s/it, atk: -0.000 ent: -5.574 str: 0.000 loss: -5.575]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.55s/it, atk: -0.000 ent: -5.570 str: 0.000 loss: -5.570]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.13s/it, atk: -0.000 ent: -5.570 str: 0.000 loss: -5.570]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.13s/it, atk: -0.000 ent: -5.583 str: 0.000 loss: -5.584]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -0.000 ent: -5.583 str: 0.000 loss: -5.584]Iterations:  13%|█▎        | 4/30 [00:05<00:23,  1.10it/s, atk: -0.000 ent: -5.605 str: 0.000 loss: -5.605]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -0.000 ent: -5.605 str: 0.000 loss: -5.605]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -0.000 ent: -5.620 str: 0.000 loss: -5.621]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.28it/s, atk: -0.000 ent: -5.620 str: 0.000 loss: -5.621]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.28it/s, atk: -0.000 ent: -5.642 str: 0.000 loss: -5.642]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -0.000 ent: -5.642 str: 0.000 loss: -5.642]Iterations:  23%|██▎       | 7/30 [00:07<00:16,  1.36it/s, atk: -0.000 ent: -5.674 str: 0.000 loss: -5.674]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -0.000 ent: -5.674 str: 0.000 loss: -5.674]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -0.000 ent: -5.707 str: 0.000 loss: -5.707]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -0.000 ent: -5.707 str: 0.000 loss: -5.707]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -0.000 ent: -5.728 str: 0.000 loss: -5.728]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.47it/s, atk: -0.000 ent: -5.728 str: 0.000 loss: -5.728]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.47it/s, atk: -0.000 ent: -5.754 str: 0.000 loss: -5.754]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -0.000 ent: -5.754 str: 0.000 loss: -5.754]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -0.000 ent: -5.776 str: 0.000 loss: -5.776]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.50it/s, atk: -0.000 ent: -5.776 str: 0.000 loss: -5.776]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.50it/s, atk: -0.000 ent: -5.802 str: 0.000 loss: -5.803]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -0.000 ent: -5.802 str: 0.000 loss: -5.803]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.54it/s, atk: -0.000 ent: -5.831 str: 0.000 loss: -5.832]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -0.000 ent: -5.831 str: 0.000 loss: -5.832]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -0.001 ent: -5.857 str: 0.000 loss: -5.857]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -0.001 ent: -5.857 str: 0.000 loss: -5.857]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.51it/s, atk: -0.001 ent: -5.880 str: 0.000 loss: -5.881]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -0.001 ent: -5.880 str: 0.000 loss: -5.881]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -0.002 ent: -5.903 str: 0.000 loss: -5.904]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.55it/s, atk: -0.002 ent: -5.903 str: 0.000 loss: -5.904]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.55it/s, atk: -0.003 ent: -5.928 str: 0.000 loss: -5.931]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -0.003 ent: -5.928 str: 0.000 loss: -5.931]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -0.006 ent: -5.951 str: 0.000 loss: -5.958]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -0.006 ent: -5.951 str: 0.000 loss: -5.958]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -0.015 ent: -5.975 str: 0.000 loss: -5.991]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -0.015 ent: -5.975 str: 0.000 loss: -5.991]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -0.056 ent: -5.988 str: 0.000 loss: -6.044]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -0.056 ent: -5.988 str: 0.000 loss: -6.044]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -0.271 ent: -6.000 str: 0.000 loss: -6.271]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.47it/s, atk: -0.271 ent: -6.000 str: 0.000 loss: -6.271]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.47it/s, atk: -1.254 ent: -5.977 str: 0.000 loss: -7.231]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -1.254 ent: -5.977 str: 0.000 loss: -7.231]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -3.630 ent: -5.969 str: 0.000 loss: -9.599]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -3.630 ent: -5.969 str: 0.000 loss: -9.599]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -10.008 ent: -5.972 str: 0.000 loss: -15.981]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -10.008 ent: -5.972 str: 0.000 loss: -15.981]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.43it/s, atk: -18.717 ent: -5.959 str: 0.000 loss: -24.675]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -18.717 ent: -5.959 str: 0.000 loss: -24.675]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -29.850 ent: -5.946 str: 0.000 loss: -35.797]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -29.850 ent: -5.946 str: 0.000 loss: -35.797]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -40.238 ent: -5.940 str: 0.000 loss: -46.178]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -40.238 ent: -5.940 str: 0.000 loss: -46.178]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -50.142 ent: -5.932 str: 0.000 loss: -56.073]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -50.142 ent: -5.932 str: 0.000 loss: -56.073]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -58.953 ent: -5.926 str: 0.000 loss: -64.879]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.48it/s, atk: -58.953 ent: -5.926 str: 0.000 loss: -64.879]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -58.953 ent: -5.926 str: 0.000 loss: -64.879]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([862], device='cuda:0') tensor(0.8750, device='cuda:0')
after_true: tensor([644], device='cuda:0') tensor(0.0014, device='cuda:0')
L1: [1618.8746]	L2: [15.299822]	Linf: [0.9764706]

Accuracy on benign examples: 100.0%
gt_label: 341 pred_label: 341 pred_clean_logit 0.9998564720153809
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.56it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.72it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.49it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.91it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.71it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.66it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.59it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.27it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.60it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.91it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.79s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4277
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.005 ent: -2.591 str: 0.000 loss: -2.597]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.12s/it, atk: -0.005 ent: -2.591 str: 0.000 loss: -2.597]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.12s/it, atk: -0.004 ent: -2.606 str: 0.000 loss: -2.610]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -0.004 ent: -2.606 str: 0.000 loss: -2.610]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -0.003 ent: -2.621 str: 0.000 loss: -2.624]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.003 ent: -2.621 str: 0.000 loss: -2.624]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.004 ent: -2.635 str: 0.000 loss: -2.639]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -0.004 ent: -2.635 str: 0.000 loss: -2.639]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -0.005 ent: -2.648 str: 0.000 loss: -2.653]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.22it/s, atk: -0.005 ent: -2.648 str: 0.000 loss: -2.653]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.22it/s, atk: -0.006 ent: -2.659 str: 0.000 loss: -2.665]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -0.006 ent: -2.659 str: 0.000 loss: -2.665]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -0.009 ent: -2.668 str: 0.000 loss: -2.677]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -0.009 ent: -2.668 str: 0.000 loss: -2.677]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -0.016 ent: -2.678 str: 0.000 loss: -2.694]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -0.016 ent: -2.678 str: 0.000 loss: -2.694]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.43it/s, atk: -0.033 ent: -2.689 str: 0.000 loss: -2.722]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -0.033 ent: -2.689 str: 0.000 loss: -2.722]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -0.120 ent: -2.691 str: 0.000 loss: -2.811]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -0.120 ent: -2.691 str: 0.000 loss: -2.811]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -0.228 ent: -2.691 str: 0.000 loss: -2.919]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.51it/s, atk: -0.228 ent: -2.691 str: 0.000 loss: -2.919]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.51it/s, atk: -0.806 ent: -2.685 str: 0.000 loss: -3.491]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.55it/s, atk: -0.806 ent: -2.685 str: 0.000 loss: -3.491]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.55it/s, atk: -4.381 ent: -2.681 str: 0.000 loss: -7.062]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.55it/s, atk: -4.381 ent: -2.681 str: 0.000 loss: -7.062]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.55it/s, atk: -14.656 ent: -2.679 str: 0.000 loss: -17.336]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -14.656 ent: -2.679 str: 0.000 loss: -17.336]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -27.144 ent: -2.676 str: 0.000 loss: -29.820]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -27.144 ent: -2.676 str: 0.000 loss: -29.820]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -34.493 ent: -2.676 str: 0.000 loss: -37.169]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -34.493 ent: -2.676 str: 0.000 loss: -37.169]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -43.531 ent: -2.676 str: 0.000 loss: -46.206]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -43.531 ent: -2.676 str: 0.000 loss: -46.206]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -50.208 ent: -2.677 str: 0.000 loss: -52.885]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -50.208 ent: -2.677 str: 0.000 loss: -52.885]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -57.166 ent: -2.676 str: 0.000 loss: -59.843]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -57.166 ent: -2.676 str: 0.000 loss: -59.843]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -65.133 ent: -2.674 str: 0.000 loss: -67.807]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -65.133 ent: -2.674 str: 0.000 loss: -67.807]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -71.427 ent: -2.673 str: 0.000 loss: -74.099]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.46it/s, atk: -71.427 ent: -2.673 str: 0.000 loss: -74.099]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -75.669 ent: -2.671 str: 0.000 loss: -78.341]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -75.669 ent: -2.671 str: 0.000 loss: -78.341]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -80.279 ent: -2.671 str: 0.000 loss: -82.949]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -80.279 ent: -2.671 str: 0.000 loss: -82.949]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -85.698 ent: -2.671 str: 0.000 loss: -88.369]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.52it/s, atk: -85.698 ent: -2.671 str: 0.000 loss: -88.369]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.52it/s, atk: -89.829 ent: -2.671 str: 0.000 loss: -92.500]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.49it/s, atk: -89.829 ent: -2.671 str: 0.000 loss: -92.500]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.49it/s, atk: -95.492 ent: -2.671 str: 0.000 loss: -98.163]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.54it/s, atk: -95.492 ent: -2.671 str: 0.000 loss: -98.163]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.54it/s, atk: -100.934 ent: -2.671 str: 0.000 loss: -103.605]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.47it/s, atk: -100.934 ent: -2.671 str: 0.000 loss: -103.605]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -104.104 ent: -2.671 str: 0.000 loss: -106.776]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.38it/s, atk: -104.104 ent: -2.671 str: 0.000 loss: -106.776]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.38it/s, atk: -109.137 ent: -2.671 str: 0.000 loss: -111.808]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.43it/s, atk: -109.137 ent: -2.671 str: 0.000 loss: -111.808]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.43it/s, atk: -113.427 ent: -2.671 str: 0.000 loss: -116.097]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.41it/s, atk: -113.427 ent: -2.671 str: 0.000 loss: -116.097]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -113.427 ent: -2.671 str: 0.000 loss: -116.097]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([251], device='cuda:0') tensor(0.9661, device='cuda:0')
after_true: tensor([341], device='cuda:0') tensor(7.6829e-06, device='cuda:0')
L1: [1942.106]	L2: [13.009266]	Linf: [0.5372549]

Accuracy on benign examples: 100.0%
gt_label: 582 pred_label: 582 pred_clean_logit 0.9841800928115845
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.85it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.37it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.21it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.50it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.96it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.40it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.86it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.96it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.97it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.79s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.56s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4782
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.790 ent: -4.810 str: 0.000 loss: -5.600]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.35s/it, atk: -0.790 ent: -4.810 str: 0.000 loss: -5.600]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.35s/it, atk: -1.587 ent: -4.809 str: 0.000 loss: -6.396]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -1.587 ent: -4.809 str: 0.000 loss: -6.396]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -3.342 ent: -4.811 str: 0.000 loss: -8.153]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -3.342 ent: -4.811 str: 0.000 loss: -8.153]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.02s/it, atk: -5.226 ent: -4.812 str: 0.000 loss: -10.038]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -5.226 ent: -4.812 str: 0.000 loss: -10.038]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -8.269 ent: -4.814 str: 0.000 loss: -13.083]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -8.269 ent: -4.814 str: 0.000 loss: -13.083]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.24it/s, atk: -12.431 ent: -4.809 str: 0.000 loss: -17.240]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -12.431 ent: -4.809 str: 0.000 loss: -17.240]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.30it/s, atk: -15.306 ent: -4.804 str: 0.000 loss: -20.110]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -15.306 ent: -4.804 str: 0.000 loss: -20.110]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -24.884 ent: -4.804 str: 0.000 loss: -29.688]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -24.884 ent: -4.804 str: 0.000 loss: -29.688]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -31.440 ent: -4.803 str: 0.000 loss: -36.243]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -31.440 ent: -4.803 str: 0.000 loss: -36.243]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -39.818 ent: -4.802 str: 0.000 loss: -44.620]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -39.818 ent: -4.802 str: 0.000 loss: -44.620]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -45.401 ent: -4.802 str: 0.000 loss: -50.203]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.39it/s, atk: -45.401 ent: -4.802 str: 0.000 loss: -50.203]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.39it/s, atk: -53.212 ent: -4.801 str: 0.000 loss: -58.013]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -53.212 ent: -4.801 str: 0.000 loss: -58.013]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -60.691 ent: -4.799 str: 0.000 loss: -65.490]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -60.691 ent: -4.799 str: 0.000 loss: -65.490]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.39it/s, atk: -67.759 ent: -4.797 str: 0.000 loss: -72.556]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.43it/s, atk: -67.759 ent: -4.797 str: 0.000 loss: -72.556]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.43it/s, atk: -74.909 ent: -4.794 str: 0.000 loss: -79.703]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -74.909 ent: -4.794 str: 0.000 loss: -79.703]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -79.296 ent: -4.793 str: 0.000 loss: -84.090]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -79.296 ent: -4.793 str: 0.000 loss: -84.090]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -85.384 ent: -4.794 str: 0.000 loss: -90.178]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.54it/s, atk: -85.384 ent: -4.794 str: 0.000 loss: -90.178]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.54it/s, atk: -90.359 ent: -4.795 str: 0.000 loss: -95.154]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -90.359 ent: -4.795 str: 0.000 loss: -95.154]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -96.341 ent: -4.795 str: 0.000 loss: -101.136]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -96.341 ent: -4.795 str: 0.000 loss: -101.136]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.48it/s, atk: -100.522 ent: -4.795 str: 0.000 loss: -105.317]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -100.522 ent: -4.795 str: 0.000 loss: -105.317]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -106.454 ent: -4.794 str: 0.000 loss: -111.247]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -106.454 ent: -4.794 str: 0.000 loss: -111.247]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -111.084 ent: -4.792 str: 0.000 loss: -115.877]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -111.084 ent: -4.792 str: 0.000 loss: -115.877]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -115.327 ent: -4.792 str: 0.000 loss: -120.118]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -115.327 ent: -4.792 str: 0.000 loss: -120.118]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -120.607 ent: -4.792 str: 0.000 loss: -125.399]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -120.607 ent: -4.792 str: 0.000 loss: -125.399]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -124.875 ent: -4.792 str: 0.000 loss: -129.667]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -124.875 ent: -4.792 str: 0.000 loss: -129.667]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -128.718 ent: -4.792 str: 0.000 loss: -133.510]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -128.718 ent: -4.792 str: 0.000 loss: -133.510]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -132.309 ent: -4.792 str: 0.000 loss: -137.101]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -132.309 ent: -4.792 str: 0.000 loss: -137.101]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -136.503 ent: -4.791 str: 0.000 loss: -141.294]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.48it/s, atk: -136.503 ent: -4.791 str: 0.000 loss: -141.294]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.48it/s, atk: -139.683 ent: -4.790 str: 0.000 loss: -144.472]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -139.683 ent: -4.790 str: 0.000 loss: -144.472]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -143.563 ent: -4.789 str: 0.000 loss: -148.353]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.37it/s, atk: -143.563 ent: -4.789 str: 0.000 loss: -148.353]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -143.563 ent: -4.789 str: 0.000 loss: -148.353]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([953], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([582], device='cuda:0') tensor(3.9490e-07, device='cuda:0')
L1: [3865.404]	L2: [26.450317]	Linf: [0.85490197]

Accuracy on benign examples: 100.0%
gt_label: 698 pred_label: 698 pred_clean_logit 0.3267611861228943
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.25it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 13.95it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.89it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.54it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.58it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.78it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.02it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.45s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4523
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -11.042 ent: -2.622 str: 0.000 loss: -13.664]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -11.042 ent: -2.622 str: 0.000 loss: -13.664]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -15.613 ent: -2.627 str: 0.000 loss: -18.240]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.23s/it, atk: -15.613 ent: -2.627 str: 0.000 loss: -18.240]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.23s/it, atk: -19.986 ent: -2.623 str: 0.000 loss: -22.609]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -19.986 ent: -2.623 str: 0.000 loss: -22.609]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -22.993 ent: -2.617 str: 0.000 loss: -25.611]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -22.993 ent: -2.617 str: 0.000 loss: -25.611]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -26.585 ent: -2.615 str: 0.000 loss: -29.200]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.21it/s, atk: -26.585 ent: -2.615 str: 0.000 loss: -29.200]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.21it/s, atk: -30.874 ent: -2.614 str: 0.000 loss: -33.488]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -30.874 ent: -2.614 str: 0.000 loss: -33.488]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -34.453 ent: -2.613 str: 0.000 loss: -37.066]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -34.453 ent: -2.613 str: 0.000 loss: -37.066]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -36.104 ent: -2.614 str: 0.000 loss: -38.718]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -36.104 ent: -2.614 str: 0.000 loss: -38.718]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -39.815 ent: -2.612 str: 0.000 loss: -42.427]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -39.815 ent: -2.612 str: 0.000 loss: -42.427]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -43.461 ent: -2.610 str: 0.000 loss: -46.071]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -43.461 ent: -2.610 str: 0.000 loss: -46.071]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -45.126 ent: -2.608 str: 0.000 loss: -47.733]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.43it/s, atk: -45.126 ent: -2.608 str: 0.000 loss: -47.733]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -48.079 ent: -2.606 str: 0.000 loss: -50.685]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -48.079 ent: -2.606 str: 0.000 loss: -50.685]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.45it/s, atk: -51.466 ent: -2.604 str: 0.000 loss: -54.069]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -51.466 ent: -2.604 str: 0.000 loss: -54.069]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -53.649 ent: -2.602 str: 0.000 loss: -56.252]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.47it/s, atk: -53.649 ent: -2.602 str: 0.000 loss: -56.252]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.47it/s, atk: -56.735 ent: -2.604 str: 0.000 loss: -59.339]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -56.735 ent: -2.604 str: 0.000 loss: -59.339]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.43it/s, atk: -58.393 ent: -2.605 str: 0.000 loss: -60.998]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -58.393 ent: -2.605 str: 0.000 loss: -60.998]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -61.182 ent: -2.605 str: 0.000 loss: -63.787]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.49it/s, atk: -61.182 ent: -2.605 str: 0.000 loss: -63.787]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.49it/s, atk: -64.312 ent: -2.604 str: 0.000 loss: -66.916]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -64.312 ent: -2.604 str: 0.000 loss: -66.916]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -67.368 ent: -2.604 str: 0.000 loss: -69.972]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -67.368 ent: -2.604 str: 0.000 loss: -69.972]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -71.313 ent: -2.604 str: 0.000 loss: -73.917]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -71.313 ent: -2.604 str: 0.000 loss: -73.917]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -75.850 ent: -2.604 str: 0.000 loss: -78.454]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -75.850 ent: -2.604 str: 0.000 loss: -78.454]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -79.645 ent: -2.603 str: 0.000 loss: -82.249]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -79.645 ent: -2.603 str: 0.000 loss: -82.249]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -86.525 ent: -2.603 str: 0.000 loss: -89.128]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.48it/s, atk: -86.525 ent: -2.603 str: 0.000 loss: -89.128]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.48it/s, atk: -91.092 ent: -2.602 str: 0.000 loss: -93.695]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.45it/s, atk: -91.092 ent: -2.602 str: 0.000 loss: -93.695]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -96.645 ent: -2.602 str: 0.000 loss: -99.247]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -96.645 ent: -2.602 str: 0.000 loss: -99.247]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -104.285 ent: -2.601 str: 0.000 loss: -106.886]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -104.285 ent: -2.601 str: 0.000 loss: -106.886]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -111.895 ent: -2.600 str: 0.000 loss: -114.494]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.52it/s, atk: -111.895 ent: -2.600 str: 0.000 loss: -114.494]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.52it/s, atk: -120.032 ent: -2.598 str: 0.000 loss: -122.630]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -120.032 ent: -2.598 str: 0.000 loss: -122.630]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -124.379 ent: -2.597 str: 0.000 loss: -126.976]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -124.379 ent: -2.597 str: 0.000 loss: -126.976]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -135.075 ent: -2.597 str: 0.000 loss: -137.673]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -135.075 ent: -2.597 str: 0.000 loss: -137.673]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -135.075 ent: -2.597 str: 0.000 loss: -137.673]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([872], device='cuda:0') tensor(0.9565, device='cuda:0')
after_true: tensor([698], device='cuda:0') tensor(6.2574e-07, device='cuda:0')
L1: [1992.2394]	L2: [13.475748]	Linf: [0.69803923]

Accuracy on benign examples: 0.0%
gt_label: 919 pred_label: 921 pred_clean_logit 0.14783966541290283
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 24.20it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 22.10it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.85it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.06it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.74it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 20.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.06it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.31s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.67s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.57s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5940
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -24.807 ent: -4.999 str: 0.000 loss: -29.806]Iterations:   3%|▎         | 1/30 [00:01<00:43,  1.50s/it, atk: -24.807 ent: -4.999 str: 0.000 loss: -29.806]Iterations:   3%|▎         | 1/30 [00:01<00:43,  1.50s/it, atk: -27.704 ent: -4.985 str: 0.000 loss: -32.689]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.01s/it, atk: -27.704 ent: -4.985 str: 0.000 loss: -32.689]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.01s/it, atk: -33.351 ent: -4.982 str: 0.000 loss: -38.333]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.16it/s, atk: -33.351 ent: -4.982 str: 0.000 loss: -38.333]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.16it/s, atk: -38.069 ent: -4.994 str: 0.000 loss: -43.063]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -38.069 ent: -4.994 str: 0.000 loss: -43.063]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -40.807 ent: -4.994 str: 0.000 loss: -45.801]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -40.807 ent: -4.994 str: 0.000 loss: -45.801]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -40.351 ent: -4.992 str: 0.000 loss: -45.343]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.44it/s, atk: -40.351 ent: -4.992 str: 0.000 loss: -45.343]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.44it/s, atk: -41.874 ent: -4.990 str: 0.000 loss: -46.864]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -41.874 ent: -4.990 str: 0.000 loss: -46.864]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -44.565 ent: -4.990 str: 0.000 loss: -49.555]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -44.565 ent: -4.990 str: 0.000 loss: -49.555]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -48.261 ent: -4.991 str: 0.000 loss: -53.251]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.45it/s, atk: -48.261 ent: -4.991 str: 0.000 loss: -53.251]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -48.106 ent: -4.993 str: 0.000 loss: -53.099]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -48.106 ent: -4.993 str: 0.000 loss: -53.099]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -54.707 ent: -4.992 str: 0.000 loss: -59.699]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.27it/s, atk: -54.707 ent: -4.992 str: 0.000 loss: -59.699]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.27it/s, atk: -55.396 ent: -4.994 str: 0.000 loss: -60.391]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -55.396 ent: -4.994 str: 0.000 loss: -60.391]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -57.259 ent: -4.995 str: 0.000 loss: -62.253]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.39it/s, atk: -57.259 ent: -4.995 str: 0.000 loss: -62.253]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -59.468 ent: -4.994 str: 0.000 loss: -64.462]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -59.468 ent: -4.994 str: 0.000 loss: -64.462]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -63.119 ent: -4.994 str: 0.000 loss: -68.113]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -63.119 ent: -4.994 str: 0.000 loss: -68.113]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -66.537 ent: -4.994 str: 0.000 loss: -71.531]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.46it/s, atk: -66.537 ent: -4.994 str: 0.000 loss: -71.531]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -68.810 ent: -4.992 str: 0.000 loss: -73.802]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.46it/s, atk: -68.810 ent: -4.992 str: 0.000 loss: -73.802]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.46it/s, atk: -71.395 ent: -4.992 str: 0.000 loss: -76.387]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -71.395 ent: -4.992 str: 0.000 loss: -76.387]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -73.659 ent: -4.992 str: 0.000 loss: -78.650]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.51it/s, atk: -73.659 ent: -4.992 str: 0.000 loss: -78.650]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -76.200 ent: -4.991 str: 0.000 loss: -81.191]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -76.200 ent: -4.991 str: 0.000 loss: -81.191]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -78.183 ent: -4.991 str: 0.000 loss: -83.175]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -78.183 ent: -4.991 str: 0.000 loss: -83.175]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -80.241 ent: -4.991 str: 0.000 loss: -85.233]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.50it/s, atk: -80.241 ent: -4.991 str: 0.000 loss: -85.233]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -82.165 ent: -4.991 str: 0.000 loss: -87.156]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -82.165 ent: -4.991 str: 0.000 loss: -87.156]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -84.619 ent: -4.990 str: 0.000 loss: -89.609]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -84.619 ent: -4.990 str: 0.000 loss: -89.609]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -86.666 ent: -4.989 str: 0.000 loss: -91.655]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.49it/s, atk: -86.666 ent: -4.989 str: 0.000 loss: -91.655]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.49it/s, atk: -89.048 ent: -4.989 str: 0.000 loss: -94.037]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -89.048 ent: -4.989 str: 0.000 loss: -94.037]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -91.550 ent: -4.990 str: 0.000 loss: -96.540]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.44it/s, atk: -91.550 ent: -4.990 str: 0.000 loss: -96.540]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.44it/s, atk: -94.009 ent: -4.991 str: 0.000 loss: -98.999]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -94.009 ent: -4.991 str: 0.000 loss: -98.999]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -96.052 ent: -4.991 str: 0.000 loss: -101.043]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.44it/s, atk: -96.052 ent: -4.991 str: 0.000 loss: -101.043]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -98.538 ent: -4.990 str: 0.000 loss: -103.529]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.53it/s, atk: -98.538 ent: -4.990 str: 0.000 loss: -103.529]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -98.538 ent: -4.990 str: 0.000 loss: -103.529]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([921], device='cuda:0') tensor(0.9896, device='cuda:0')
after_true: tensor([919], device='cuda:0') tensor(4.1142e-05, device='cuda:0')
L1: [2006.9374]	L2: [13.98595]	Linf: [0.5647059]

Accuracy on benign examples: 100.0%
gt_label: 974 pred_label: 974 pred_clean_logit 0.991377592086792
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.55it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.44it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.70it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.41it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.84it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 13.99it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 13.30it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.62it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.51s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.44s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4355
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.122 ent: -4.855 str: 0.000 loss: -4.977]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.27s/it, atk: -0.122 ent: -4.855 str: 0.000 loss: -4.977]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.27s/it, atk: -0.265 ent: -4.838 str: 0.000 loss: -5.103]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -0.265 ent: -4.838 str: 0.000 loss: -5.103]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -3.783 ent: -4.819 str: 0.000 loss: -8.602]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -3.783 ent: -4.819 str: 0.000 loss: -8.602]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -5.143 ent: -4.796 str: 0.000 loss: -9.939]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -5.143 ent: -4.796 str: 0.000 loss: -9.939]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -4.435 ent: -4.795 str: 0.000 loss: -9.230]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -4.435 ent: -4.795 str: 0.000 loss: -9.230]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -7.438 ent: -4.779 str: 0.000 loss: -12.217]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -7.438 ent: -4.779 str: 0.000 loss: -12.217]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -9.203 ent: -4.774 str: 0.000 loss: -13.978]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -9.203 ent: -4.774 str: 0.000 loss: -13.978]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -8.481 ent: -4.774 str: 0.000 loss: -13.255]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -8.481 ent: -4.774 str: 0.000 loss: -13.255]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -10.884 ent: -4.776 str: 0.000 loss: -15.660]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -10.884 ent: -4.776 str: 0.000 loss: -15.660]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -11.465 ent: -4.770 str: 0.000 loss: -16.235]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.42it/s, atk: -11.465 ent: -4.770 str: 0.000 loss: -16.235]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.42it/s, atk: -15.940 ent: -4.769 str: 0.000 loss: -20.709]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -15.940 ent: -4.769 str: 0.000 loss: -20.709]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -22.831 ent: -4.775 str: 0.000 loss: -27.607]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -22.831 ent: -4.775 str: 0.000 loss: -27.607]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -22.742 ent: -4.780 str: 0.000 loss: -27.523]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.51it/s, atk: -22.742 ent: -4.780 str: 0.000 loss: -27.523]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.51it/s, atk: -29.420 ent: -4.776 str: 0.000 loss: -34.196]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -29.420 ent: -4.776 str: 0.000 loss: -34.196]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -32.325 ent: -4.778 str: 0.000 loss: -37.103]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -32.325 ent: -4.778 str: 0.000 loss: -37.103]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -33.921 ent: -4.784 str: 0.000 loss: -38.705]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.40it/s, atk: -33.921 ent: -4.784 str: 0.000 loss: -38.705]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.40it/s, atk: -36.431 ent: -4.787 str: 0.000 loss: -41.218]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -36.431 ent: -4.787 str: 0.000 loss: -41.218]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -40.192 ent: -4.788 str: 0.000 loss: -44.980]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.39it/s, atk: -40.192 ent: -4.788 str: 0.000 loss: -44.980]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.39it/s, atk: -43.412 ent: -4.787 str: 0.000 loss: -48.199]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.32it/s, atk: -43.412 ent: -4.787 str: 0.000 loss: -48.199]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.32it/s, atk: -46.531 ent: -4.784 str: 0.000 loss: -51.315]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -46.531 ent: -4.784 str: 0.000 loss: -51.315]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -49.565 ent: -4.784 str: 0.000 loss: -54.349]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -49.565 ent: -4.784 str: 0.000 loss: -54.349]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -52.566 ent: -4.786 str: 0.000 loss: -57.352]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -52.566 ent: -4.786 str: 0.000 loss: -57.352]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -55.419 ent: -4.787 str: 0.000 loss: -60.205]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -55.419 ent: -4.787 str: 0.000 loss: -60.205]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -58.388 ent: -4.788 str: 0.000 loss: -63.176]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -58.388 ent: -4.788 str: 0.000 loss: -63.176]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -60.593 ent: -4.788 str: 0.000 loss: -65.381]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -60.593 ent: -4.788 str: 0.000 loss: -65.381]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -63.224 ent: -4.787 str: 0.000 loss: -68.011]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -63.224 ent: -4.787 str: 0.000 loss: -68.011]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -65.631 ent: -4.787 str: 0.000 loss: -70.417]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -65.631 ent: -4.787 str: 0.000 loss: -70.417]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -66.882 ent: -4.786 str: 0.000 loss: -71.668]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -66.882 ent: -4.786 str: 0.000 loss: -71.668]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.46it/s, atk: -69.358 ent: -4.787 str: 0.000 loss: -74.146]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -69.358 ent: -4.787 str: 0.000 loss: -74.146]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.40it/s, atk: -71.148 ent: -4.789 str: 0.000 loss: -75.937]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.45it/s, atk: -71.148 ent: -4.789 str: 0.000 loss: -75.937]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -71.148 ent: -4.789 str: 0.000 loss: -75.937]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([977], device='cuda:0') tensor(0.8337, device='cuda:0')
after_true: tensor([974], device='cuda:0') tensor(0.0007, device='cuda:0')
L1: [2644.9373]	L2: [16.540905]	Linf: [0.5411765]

Accuracy on benign examples: 100.0%
gt_label: 310 pred_label: 310 pred_clean_logit 0.8165473341941833
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.63it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.45it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 13.79it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 13.38it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.20it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.02it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 20.32it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.36it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.58s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4041
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -2.664 ent: -2.480 str: 0.000 loss: -5.143]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.08it/s, atk: -2.664 ent: -2.480 str: 0.000 loss: -5.143]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.08it/s, atk: -10.968 ent: -2.464 str: 0.000 loss: -13.432]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.38it/s, atk: -10.968 ent: -2.464 str: 0.000 loss: -13.432]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.38it/s, atk: -11.315 ent: -2.466 str: 0.000 loss: -13.781]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.44it/s, atk: -11.315 ent: -2.466 str: 0.000 loss: -13.781]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.44it/s, atk: -21.693 ent: -2.463 str: 0.000 loss: -24.156]Iterations:  13%|█▎        | 4/30 [00:02<00:19,  1.34it/s, atk: -21.693 ent: -2.463 str: 0.000 loss: -24.156]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.34it/s, atk: -47.804 ent: -2.462 str: 0.000 loss: -50.266]Iterations:  17%|█▋        | 5/30 [00:03<00:20,  1.22it/s, atk: -47.804 ent: -2.462 str: 0.000 loss: -50.266]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.22it/s, atk: -68.414 ent: -2.459 str: 0.000 loss: -70.873]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.28it/s, atk: -68.414 ent: -2.459 str: 0.000 loss: -70.873]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.28it/s, atk: -61.334 ent: -2.457 str: 0.000 loss: -63.791]Iterations:  23%|██▎       | 7/30 [00:05<00:18,  1.26it/s, atk: -61.334 ent: -2.457 str: 0.000 loss: -63.791]Iterations:  23%|██▎       | 7/30 [00:05<00:18,  1.26it/s, atk: -92.014 ent: -2.456 str: 0.000 loss: -94.470]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.29it/s, atk: -92.014 ent: -2.456 str: 0.000 loss: -94.470]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.29it/s, atk: -109.421 ent: -2.454 str: 0.000 loss: -111.874]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.35it/s, atk: -109.421 ent: -2.454 str: 0.000 loss: -111.874]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -119.902 ent: -2.454 str: 0.000 loss: -122.356]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.35it/s, atk: -119.902 ent: -2.454 str: 0.000 loss: -122.356]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.35it/s, atk: -130.992 ent: -2.453 str: 0.000 loss: -133.445]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.40it/s, atk: -130.992 ent: -2.453 str: 0.000 loss: -133.445]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.40it/s, atk: -137.291 ent: -2.452 str: 0.000 loss: -139.743]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.40it/s, atk: -137.291 ent: -2.452 str: 0.000 loss: -139.743]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -142.185 ent: -2.454 str: 0.000 loss: -144.639]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -142.185 ent: -2.454 str: 0.000 loss: -144.639]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -140.931 ent: -2.453 str: 0.000 loss: -143.383]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -140.931 ent: -2.453 str: 0.000 loss: -143.383]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -159.995 ent: -2.454 str: 0.000 loss: -162.449]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.38it/s, atk: -159.995 ent: -2.454 str: 0.000 loss: -162.449]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.38it/s, atk: -161.246 ent: -2.455 str: 0.000 loss: -163.701]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.38it/s, atk: -161.246 ent: -2.455 str: 0.000 loss: -163.701]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -167.192 ent: -2.454 str: 0.000 loss: -169.646]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.41it/s, atk: -167.192 ent: -2.454 str: 0.000 loss: -169.646]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.41it/s, atk: -176.136 ent: -2.454 str: 0.000 loss: -178.591]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -176.136 ent: -2.454 str: 0.000 loss: -178.591]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -179.661 ent: -2.455 str: 0.000 loss: -182.116]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.48it/s, atk: -179.661 ent: -2.455 str: 0.000 loss: -182.116]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -188.821 ent: -2.455 str: 0.000 loss: -191.276]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -188.821 ent: -2.455 str: 0.000 loss: -191.276]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -197.948 ent: -2.455 str: 0.000 loss: -200.403]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.44it/s, atk: -197.948 ent: -2.455 str: 0.000 loss: -200.403]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.44it/s, atk: -203.232 ent: -2.455 str: 0.000 loss: -205.687]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.37it/s, atk: -203.232 ent: -2.455 str: 0.000 loss: -205.687]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.37it/s, atk: -208.626 ent: -2.455 str: 0.000 loss: -211.080]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.47it/s, atk: -208.626 ent: -2.455 str: 0.000 loss: -211.080]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.47it/s, atk: -217.225 ent: -2.455 str: 0.000 loss: -219.681]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -217.225 ent: -2.455 str: 0.000 loss: -219.681]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -222.338 ent: -2.456 str: 0.000 loss: -224.794]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -222.338 ent: -2.456 str: 0.000 loss: -224.794]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -228.193 ent: -2.456 str: 0.000 loss: -230.649]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -228.193 ent: -2.456 str: 0.000 loss: -230.649]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -229.865 ent: -2.455 str: 0.000 loss: -232.320]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.55it/s, atk: -229.865 ent: -2.455 str: 0.000 loss: -232.320]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.55it/s, atk: -237.727 ent: -2.455 str: 0.000 loss: -240.182]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.52it/s, atk: -237.727 ent: -2.455 str: 0.000 loss: -240.182]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.52it/s, atk: -244.290 ent: -2.454 str: 0.000 loss: -246.744]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.49it/s, atk: -244.290 ent: -2.454 str: 0.000 loss: -246.744]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -249.045 ent: -2.454 str: 0.000 loss: -251.499]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.45it/s, atk: -249.045 ent: -2.454 str: 0.000 loss: -251.499]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -249.045 ent: -2.454 str: 0.000 loss: -251.499]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([994], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([310], device='cuda:0') tensor(1.1562e-11, device='cuda:0')
L1: [5150.93]	L2: [33.77765]	Linf: [0.9607843]

Accuracy on benign examples: 100.0%
gt_label: 881 pred_label: 881 pred_clean_logit 0.9970099925994873
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.55it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 13.43it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.79it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.43it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.97it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.22it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.46it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.80it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.76s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.55s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.45s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3340
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.062 ent: -2.584 str: 0.000 loss: -2.646]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.25s/it, atk: -0.062 ent: -2.584 str: 0.000 loss: -2.646]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.25s/it, atk: -0.114 ent: -2.589 str: 0.000 loss: -2.703]Iterations:   7%|▋         | 2/30 [00:02<00:38,  1.36s/it, atk: -0.114 ent: -2.589 str: 0.000 loss: -2.703]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -0.345 ent: -2.587 str: 0.000 loss: -2.932]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -0.345 ent: -2.587 str: 0.000 loss: -2.932]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -0.667 ent: -2.585 str: 0.000 loss: -3.252]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -0.667 ent: -2.585 str: 0.000 loss: -3.252]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -1.115 ent: -2.582 str: 0.000 loss: -3.697]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -1.115 ent: -2.582 str: 0.000 loss: -3.697]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.25it/s, atk: -1.810 ent: -2.586 str: 0.000 loss: -4.396]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -1.810 ent: -2.586 str: 0.000 loss: -4.396]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -3.454 ent: -2.585 str: 0.000 loss: -6.039]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -3.454 ent: -2.585 str: 0.000 loss: -6.039]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -3.842 ent: -2.586 str: 0.000 loss: -6.428]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -3.842 ent: -2.586 str: 0.000 loss: -6.428]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -6.681 ent: -2.587 str: 0.000 loss: -9.268]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -6.681 ent: -2.587 str: 0.000 loss: -9.268]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -9.241 ent: -2.587 str: 0.000 loss: -11.828]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -9.241 ent: -2.587 str: 0.000 loss: -11.828]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -12.881 ent: -2.586 str: 0.000 loss: -15.467]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -12.881 ent: -2.586 str: 0.000 loss: -15.467]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -15.481 ent: -2.587 str: 0.000 loss: -18.068]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.47it/s, atk: -15.481 ent: -2.587 str: 0.000 loss: -18.068]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.47it/s, atk: -18.932 ent: -2.588 str: 0.000 loss: -21.519]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.43it/s, atk: -18.932 ent: -2.588 str: 0.000 loss: -21.519]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.43it/s, atk: -23.247 ent: -2.587 str: 0.000 loss: -25.834]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.47it/s, atk: -23.247 ent: -2.587 str: 0.000 loss: -25.834]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.47it/s, atk: -28.966 ent: -2.587 str: 0.000 loss: -31.553]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -28.966 ent: -2.587 str: 0.000 loss: -31.553]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -32.858 ent: -2.585 str: 0.000 loss: -35.444]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -32.858 ent: -2.585 str: 0.000 loss: -35.444]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.48it/s, atk: -35.433 ent: -2.585 str: 0.000 loss: -38.018]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -35.433 ent: -2.585 str: 0.000 loss: -38.018]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -40.918 ent: -2.585 str: 0.000 loss: -43.503]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.54it/s, atk: -40.918 ent: -2.585 str: 0.000 loss: -43.503]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.54it/s, atk: -45.224 ent: -2.585 str: 0.000 loss: -47.809]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.59it/s, atk: -45.224 ent: -2.585 str: 0.000 loss: -47.809]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.59it/s, atk: -50.040 ent: -2.584 str: 0.000 loss: -52.624]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.54it/s, atk: -50.040 ent: -2.584 str: 0.000 loss: -52.624]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.54it/s, atk: -53.537 ent: -2.584 str: 0.000 loss: -56.121]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.55it/s, atk: -53.537 ent: -2.584 str: 0.000 loss: -56.121]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.55it/s, atk: -57.188 ent: -2.586 str: 0.000 loss: -59.773]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.54it/s, atk: -57.188 ent: -2.586 str: 0.000 loss: -59.773]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.54it/s, atk: -61.194 ent: -2.586 str: 0.000 loss: -63.779]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.53it/s, atk: -61.194 ent: -2.586 str: 0.000 loss: -63.779]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.53it/s, atk: -64.776 ent: -2.585 str: 0.000 loss: -67.361]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -64.776 ent: -2.585 str: 0.000 loss: -67.361]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.47it/s, atk: -68.379 ent: -2.585 str: 0.000 loss: -70.964]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -68.379 ent: -2.585 str: 0.000 loss: -70.964]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -71.443 ent: -2.584 str: 0.000 loss: -74.027]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.50it/s, atk: -71.443 ent: -2.584 str: 0.000 loss: -74.027]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.50it/s, atk: -75.438 ent: -2.583 str: 0.000 loss: -78.021]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.51it/s, atk: -75.438 ent: -2.583 str: 0.000 loss: -78.021]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.51it/s, atk: -79.326 ent: -2.581 str: 0.000 loss: -81.907]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -79.326 ent: -2.581 str: 0.000 loss: -81.907]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -82.196 ent: -2.582 str: 0.000 loss: -84.777]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -82.196 ent: -2.582 str: 0.000 loss: -84.777]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -84.935 ent: -2.582 str: 0.000 loss: -87.517]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.52it/s, atk: -84.935 ent: -2.582 str: 0.000 loss: -87.517]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -84.935 ent: -2.582 str: 0.000 loss: -87.517]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([579], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([881], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [2647.6199]	L2: [17.931963]	Linf: [0.6431372]

Accuracy on benign examples: 100.0%
gt_label: 897 pred_label: 897 pred_clean_logit 0.9999855756759644
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.16it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.96it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.43it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.13it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.43it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.69it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 17.85it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.26it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:10,  2.65s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.74s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.61s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5372
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.000 ent: -2.916 str: 0.000 loss: -2.916]Iterations:   3%|▎         | 1/30 [00:01<00:49,  1.70s/it, atk: -0.000 ent: -2.916 str: 0.000 loss: -2.916]Iterations:   3%|▎         | 1/30 [00:02<00:49,  1.70s/it, atk: -0.000 ent: -2.952 str: 0.000 loss: -2.953]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.07s/it, atk: -0.000 ent: -2.952 str: 0.000 loss: -2.953]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.07s/it, atk: -0.000 ent: -2.976 str: 0.000 loss: -2.976]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -0.000 ent: -2.976 str: 0.000 loss: -2.976]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -0.000 ent: -2.994 str: 0.000 loss: -2.995]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -0.000 ent: -2.994 str: 0.000 loss: -2.995]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -0.000 ent: -3.012 str: 0.000 loss: -3.012]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -0.000 ent: -3.012 str: 0.000 loss: -3.012]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -0.001 ent: -3.027 str: 0.000 loss: -3.027]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -0.001 ent: -3.027 str: 0.000 loss: -3.027]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -0.001 ent: -3.039 str: 0.000 loss: -3.039]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -0.001 ent: -3.039 str: 0.000 loss: -3.039]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -0.001 ent: -3.053 str: 0.000 loss: -3.054]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.47it/s, atk: -0.001 ent: -3.053 str: 0.000 loss: -3.054]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.47it/s, atk: -0.001 ent: -3.070 str: 0.000 loss: -3.071]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.51it/s, atk: -0.001 ent: -3.070 str: 0.000 loss: -3.071]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.51it/s, atk: -0.001 ent: -3.082 str: 0.000 loss: -3.082]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.47it/s, atk: -0.001 ent: -3.082 str: 0.000 loss: -3.082]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.47it/s, atk: -0.001 ent: -3.096 str: 0.000 loss: -3.097]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.46it/s, atk: -0.001 ent: -3.096 str: 0.000 loss: -3.097]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.46it/s, atk: -0.003 ent: -3.111 str: 0.000 loss: -3.114]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -0.003 ent: -3.111 str: 0.000 loss: -3.114]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -0.007 ent: -3.122 str: 0.000 loss: -3.129]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.60it/s, atk: -0.007 ent: -3.122 str: 0.000 loss: -3.129]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.60it/s, atk: -0.012 ent: -3.131 str: 0.000 loss: -3.143]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.53it/s, atk: -0.012 ent: -3.131 str: 0.000 loss: -3.143]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.53it/s, atk: -0.025 ent: -3.139 str: 0.000 loss: -3.164]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -0.025 ent: -3.139 str: 0.000 loss: -3.164]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -0.068 ent: -3.147 str: 0.000 loss: -3.215]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -0.068 ent: -3.147 str: 0.000 loss: -3.215]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -0.282 ent: -3.151 str: 0.000 loss: -3.433]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -0.282 ent: -3.151 str: 0.000 loss: -3.433]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -1.259 ent: -3.152 str: 0.000 loss: -4.410]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.52it/s, atk: -1.259 ent: -3.152 str: 0.000 loss: -4.410]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -3.455 ent: -3.152 str: 0.000 loss: -6.607]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.52it/s, atk: -3.455 ent: -3.152 str: 0.000 loss: -6.607]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.52it/s, atk: -6.975 ent: -3.152 str: 0.000 loss: -10.127]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.48it/s, atk: -6.975 ent: -3.152 str: 0.000 loss: -10.127]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.48it/s, atk: -14.513 ent: -3.151 str: 0.000 loss: -17.665]Iterations:  70%|███████   | 21/30 [00:14<00:06,  1.48it/s, atk: -14.513 ent: -3.151 str: 0.000 loss: -17.665]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.48it/s, atk: -22.630 ent: -3.150 str: 0.000 loss: -25.780]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.45it/s, atk: -22.630 ent: -3.150 str: 0.000 loss: -25.780]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -36.206 ent: -3.149 str: 0.000 loss: -39.356]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.43it/s, atk: -36.206 ent: -3.149 str: 0.000 loss: -39.356]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.43it/s, atk: -47.912 ent: -3.148 str: 0.000 loss: -51.059]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.51it/s, atk: -47.912 ent: -3.148 str: 0.000 loss: -51.059]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.51it/s, atk: -60.820 ent: -3.148 str: 0.000 loss: -63.968]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -60.820 ent: -3.148 str: 0.000 loss: -63.968]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -71.841 ent: -3.147 str: 0.000 loss: -74.988]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.55it/s, atk: -71.841 ent: -3.147 str: 0.000 loss: -74.988]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.55it/s, atk: -81.206 ent: -3.146 str: 0.000 loss: -84.351]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -81.206 ent: -3.146 str: 0.000 loss: -84.351]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -86.004 ent: -3.143 str: 0.000 loss: -89.147]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.45it/s, atk: -86.004 ent: -3.143 str: 0.000 loss: -89.147]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -91.870 ent: -3.142 str: 0.000 loss: -95.012]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.43it/s, atk: -91.870 ent: -3.142 str: 0.000 loss: -95.012]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.43it/s, atk: -96.599 ent: -3.142 str: 0.000 loss: -99.740]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.49it/s, atk: -96.599 ent: -3.142 str: 0.000 loss: -99.740]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -96.599 ent: -3.142 str: 0.000 loss: -99.740]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([409], device='cuda:0') tensor(0.7340, device='cuda:0')
after_true: tensor([897], device='cuda:0') tensor(4.0235e-05, device='cuda:0')
L1: [1521.9882]	L2: [12.468862]	Linf: [0.5568628]

Accuracy on benign examples: 100.0%
gt_label: 973 pred_label: 973 pred_clean_logit 0.9758716225624084
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:07,  2.49it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.45it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 10.82it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.94it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.29it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 18.72it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 20.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.20it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.75s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.55s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4818
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.727 ent: -4.899 str: 0.000 loss: -5.626]Iterations:   3%|▎         | 1/30 [00:02<01:20,  2.79s/it, atk: -0.727 ent: -4.899 str: 0.000 loss: -5.626]Iterations:   3%|▎         | 1/30 [00:03<01:20,  2.79s/it, atk: -1.227 ent: -4.892 str: 0.000 loss: -6.119]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -1.227 ent: -4.892 str: 0.000 loss: -6.119]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -1.118 ent: -4.899 str: 0.000 loss: -6.017]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -1.118 ent: -4.899 str: 0.000 loss: -6.017]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -1.490 ent: -4.900 str: 0.000 loss: -6.390]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.04it/s, atk: -1.490 ent: -4.900 str: 0.000 loss: -6.390]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.04it/s, atk: -2.993 ent: -4.907 str: 0.000 loss: -7.900]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -2.993 ent: -4.907 str: 0.000 loss: -7.900]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -7.675 ent: -4.906 str: 0.000 loss: -12.582]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.30it/s, atk: -7.675 ent: -4.906 str: 0.000 loss: -12.582]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.30it/s, atk: -14.381 ent: -4.905 str: 0.000 loss: -19.286]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -14.381 ent: -4.905 str: 0.000 loss: -19.286]Iterations:  23%|██▎       | 7/30 [00:07<00:16,  1.40it/s, atk: -20.660 ent: -4.907 str: 0.000 loss: -25.568]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -20.660 ent: -4.907 str: 0.000 loss: -25.568]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -30.651 ent: -4.909 str: 0.000 loss: -35.560]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.47it/s, atk: -30.651 ent: -4.909 str: 0.000 loss: -35.560]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.47it/s, atk: -50.590 ent: -4.907 str: 0.000 loss: -55.498]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -50.590 ent: -4.907 str: 0.000 loss: -55.498]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -57.586 ent: -4.906 str: 0.000 loss: -62.492]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.53it/s, atk: -57.586 ent: -4.906 str: 0.000 loss: -62.492]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.53it/s, atk: -69.023 ent: -4.906 str: 0.000 loss: -73.929]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -69.023 ent: -4.906 str: 0.000 loss: -73.929]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.54it/s, atk: -76.632 ent: -4.907 str: 0.000 loss: -81.540]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -76.632 ent: -4.907 str: 0.000 loss: -81.540]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -85.579 ent: -4.906 str: 0.000 loss: -90.485]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -85.579 ent: -4.906 str: 0.000 loss: -90.485]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -97.619 ent: -4.903 str: 0.000 loss: -102.522]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -97.619 ent: -4.903 str: 0.000 loss: -102.522]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -105.485 ent: -4.900 str: 0.000 loss: -110.385]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.43it/s, atk: -105.485 ent: -4.900 str: 0.000 loss: -110.385]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -112.891 ent: -4.899 str: 0.000 loss: -117.789]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -112.891 ent: -4.899 str: 0.000 loss: -117.789]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -121.697 ent: -4.897 str: 0.000 loss: -126.595]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -121.697 ent: -4.897 str: 0.000 loss: -126.595]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -122.276 ent: -4.896 str: 0.000 loss: -127.172]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -122.276 ent: -4.896 str: 0.000 loss: -127.172]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.38it/s, atk: -133.009 ent: -4.896 str: 0.000 loss: -137.905]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.39it/s, atk: -133.009 ent: -4.896 str: 0.000 loss: -137.905]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.39it/s, atk: -134.304 ent: -4.895 str: 0.000 loss: -139.199]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -134.304 ent: -4.895 str: 0.000 loss: -139.199]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -139.812 ent: -4.895 str: 0.000 loss: -144.707]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -139.812 ent: -4.895 str: 0.000 loss: -144.707]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.40it/s, atk: -148.418 ent: -4.892 str: 0.000 loss: -153.310]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.43it/s, atk: -148.418 ent: -4.892 str: 0.000 loss: -153.310]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.43it/s, atk: -158.262 ent: -4.891 str: 0.000 loss: -163.153]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -158.262 ent: -4.891 str: 0.000 loss: -163.153]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -163.663 ent: -4.891 str: 0.000 loss: -168.554]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -163.663 ent: -4.891 str: 0.000 loss: -168.554]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -168.160 ent: -4.892 str: 0.000 loss: -173.051]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.33it/s, atk: -168.160 ent: -4.892 str: 0.000 loss: -173.051]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.33it/s, atk: -175.994 ent: -4.893 str: 0.000 loss: -180.887]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -175.994 ent: -4.893 str: 0.000 loss: -180.887]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -177.993 ent: -4.894 str: 0.000 loss: -182.888]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -177.993 ent: -4.894 str: 0.000 loss: -182.888]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -187.049 ent: -4.893 str: 0.000 loss: -191.942]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -187.049 ent: -4.893 str: 0.000 loss: -191.942]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.41it/s, atk: -192.132 ent: -4.890 str: 0.000 loss: -197.022]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.41it/s, atk: -192.132 ent: -4.890 str: 0.000 loss: -197.022]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -192.132 ent: -4.890 str: 0.000 loss: -197.022]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([65], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([973], device='cuda:0') tensor(3.0551e-09, device='cuda:0')
L1: [3981.5767]	L2: [26.09393]	Linf: [0.7019608]

Accuracy on benign examples: 100.0%
gt_label: 480 pred_label: 480 pred_clean_logit 0.9998873472213745
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.22it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.99it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.02it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.69it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.32it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.13it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.32it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.46it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.90s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.52s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3160
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.001 ent: -5.815 str: 0.000 loss: -5.815]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.36s/it, atk: -0.001 ent: -5.815 str: 0.000 loss: -5.815]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.36s/it, atk: -0.001 ent: -5.865 str: 0.000 loss: -5.866]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -0.001 ent: -5.865 str: 0.000 loss: -5.866]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -0.001 ent: -5.908 str: 0.000 loss: -5.909]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.001 ent: -5.908 str: 0.000 loss: -5.909]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.01s/it, atk: -0.002 ent: -5.948 str: 0.000 loss: -5.949]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -0.002 ent: -5.948 str: 0.000 loss: -5.949]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -0.002 ent: -5.983 str: 0.000 loss: -5.985]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -0.002 ent: -5.983 str: 0.000 loss: -5.985]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.25it/s, atk: -0.002 ent: -6.014 str: 0.000 loss: -6.016]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -0.002 ent: -6.014 str: 0.000 loss: -6.016]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -0.002 ent: -6.044 str: 0.000 loss: -6.046]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -0.002 ent: -6.044 str: 0.000 loss: -6.046]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -0.003 ent: -6.075 str: 0.000 loss: -6.078]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.40it/s, atk: -0.003 ent: -6.075 str: 0.000 loss: -6.078]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -0.003 ent: -6.105 str: 0.000 loss: -6.108]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.48it/s, atk: -0.003 ent: -6.105 str: 0.000 loss: -6.108]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.48it/s, atk: -0.003 ent: -6.134 str: 0.000 loss: -6.138]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -0.003 ent: -6.134 str: 0.000 loss: -6.138]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -0.004 ent: -6.161 str: 0.000 loss: -6.165]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.40it/s, atk: -0.004 ent: -6.161 str: 0.000 loss: -6.165]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.40it/s, atk: -0.006 ent: -6.187 str: 0.000 loss: -6.192]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.46it/s, atk: -0.006 ent: -6.187 str: 0.000 loss: -6.192]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -0.008 ent: -6.213 str: 0.000 loss: -6.221]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -0.008 ent: -6.213 str: 0.000 loss: -6.221]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -0.013 ent: -6.238 str: 0.000 loss: -6.251]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -0.013 ent: -6.238 str: 0.000 loss: -6.251]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -0.020 ent: -6.263 str: 0.000 loss: -6.283]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -0.020 ent: -6.263 str: 0.000 loss: -6.283]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.51it/s, atk: -0.035 ent: -6.285 str: 0.000 loss: -6.320]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.55it/s, atk: -0.035 ent: -6.285 str: 0.000 loss: -6.320]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.55it/s, atk: -0.058 ent: -6.303 str: 0.000 loss: -6.361]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.51it/s, atk: -0.058 ent: -6.303 str: 0.000 loss: -6.361]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.51it/s, atk: -0.099 ent: -6.319 str: 0.000 loss: -6.418]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -0.099 ent: -6.319 str: 0.000 loss: -6.418]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -0.166 ent: -6.331 str: 0.000 loss: -6.497]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -0.166 ent: -6.331 str: 0.000 loss: -6.497]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -0.272 ent: -6.339 str: 0.000 loss: -6.611]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -0.272 ent: -6.339 str: 0.000 loss: -6.611]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -0.586 ent: -6.345 str: 0.000 loss: -6.931]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.37it/s, atk: -0.586 ent: -6.345 str: 0.000 loss: -6.931]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.37it/s, atk: -0.902 ent: -6.348 str: 0.000 loss: -7.250]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.38it/s, atk: -0.902 ent: -6.348 str: 0.000 loss: -7.250]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.38it/s, atk: -1.675 ent: -6.347 str: 0.000 loss: -8.022]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -1.675 ent: -6.347 str: 0.000 loss: -8.022]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -1.994 ent: -6.349 str: 0.000 loss: -8.343]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.43it/s, atk: -1.994 ent: -6.349 str: 0.000 loss: -8.343]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -3.614 ent: -6.347 str: 0.000 loss: -9.961]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -3.614 ent: -6.347 str: 0.000 loss: -9.961]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -4.585 ent: -6.348 str: 0.000 loss: -10.933]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -4.585 ent: -6.348 str: 0.000 loss: -10.933]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -5.322 ent: -6.346 str: 0.000 loss: -11.669]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.47it/s, atk: -5.322 ent: -6.346 str: 0.000 loss: -11.669]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -7.781 ent: -6.348 str: 0.000 loss: -14.128]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -7.781 ent: -6.348 str: 0.000 loss: -14.128]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -8.713 ent: -6.344 str: 0.000 loss: -15.057]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -8.713 ent: -6.344 str: 0.000 loss: -15.057]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -10.569 ent: -6.341 str: 0.000 loss: -16.910]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.49it/s, atk: -10.569 ent: -6.341 str: 0.000 loss: -16.910]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -10.569 ent: -6.341 str: 0.000 loss: -16.910]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([916], device='cuda:0') tensor(0.3918, device='cuda:0')
after_true: tensor([480], device='cuda:0') tensor(0.2809, device='cuda:0')
L1: [2802.9688]	L2: [19.799656]	Linf: [0.84313726]

Accuracy on benign examples: 100.0%
gt_label: 309 pred_label: 309 pred_clean_logit 0.9919247031211853
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.96it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.56it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.36it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.67it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.75it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 23.51it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 23.27it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.68it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.67s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.49s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.51s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2033
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.069 ent: -3.315 str: 0.000 loss: -3.385]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.26s/it, atk: -0.069 ent: -3.315 str: 0.000 loss: -3.385]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.26s/it, atk: -0.253 ent: -3.337 str: 0.000 loss: -3.590]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -0.253 ent: -3.337 str: 0.000 loss: -3.590]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -1.985 ent: -3.331 str: 0.000 loss: -5.316]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.00s/it, atk: -1.985 ent: -3.331 str: 0.000 loss: -5.316]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.00s/it, atk: -11.016 ent: -3.332 str: 0.000 loss: -14.348]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -11.016 ent: -3.332 str: 0.000 loss: -14.348]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -29.050 ent: -3.322 str: 0.000 loss: -32.372]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.23it/s, atk: -29.050 ent: -3.322 str: 0.000 loss: -32.372]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -44.450 ent: -3.320 str: 0.000 loss: -47.770]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.32it/s, atk: -44.450 ent: -3.320 str: 0.000 loss: -47.770]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.32it/s, atk: -60.316 ent: -3.304 str: 0.000 loss: -63.621]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.44it/s, atk: -60.316 ent: -3.304 str: 0.000 loss: -63.621]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.44it/s, atk: -78.396 ent: -3.304 str: 0.000 loss: -81.700]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.47it/s, atk: -78.396 ent: -3.304 str: 0.000 loss: -81.700]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.47it/s, atk: -82.171 ent: -3.308 str: 0.000 loss: -85.479]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.51it/s, atk: -82.171 ent: -3.308 str: 0.000 loss: -85.479]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.51it/s, atk: -96.417 ent: -3.308 str: 0.000 loss: -99.725]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -96.417 ent: -3.308 str: 0.000 loss: -99.725]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -106.912 ent: -3.304 str: 0.000 loss: -110.216]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.55it/s, atk: -106.912 ent: -3.304 str: 0.000 loss: -110.216]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.55it/s, atk: -116.801 ent: -3.300 str: 0.000 loss: -120.101]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.51it/s, atk: -116.801 ent: -3.300 str: 0.000 loss: -120.101]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.51it/s, atk: -128.728 ent: -3.297 str: 0.000 loss: -132.026]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -128.728 ent: -3.297 str: 0.000 loss: -132.026]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -140.147 ent: -3.293 str: 0.000 loss: -143.440]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -140.147 ent: -3.293 str: 0.000 loss: -143.440]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -152.314 ent: -3.291 str: 0.000 loss: -155.605]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -152.314 ent: -3.291 str: 0.000 loss: -155.605]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -162.485 ent: -3.288 str: 0.000 loss: -165.773]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.37it/s, atk: -162.485 ent: -3.288 str: 0.000 loss: -165.773]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.37it/s, atk: -170.968 ent: -3.285 str: 0.000 loss: -174.254]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.41it/s, atk: -170.968 ent: -3.285 str: 0.000 loss: -174.254]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -181.262 ent: -3.285 str: 0.000 loss: -184.547]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -181.262 ent: -3.285 str: 0.000 loss: -184.547]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -190.254 ent: -3.284 str: 0.000 loss: -193.538]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -190.254 ent: -3.284 str: 0.000 loss: -193.538]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -198.451 ent: -3.283 str: 0.000 loss: -201.734]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -198.451 ent: -3.283 str: 0.000 loss: -201.734]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -206.861 ent: -3.280 str: 0.000 loss: -210.142]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -206.861 ent: -3.280 str: 0.000 loss: -210.142]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -212.165 ent: -3.278 str: 0.000 loss: -215.443]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.51it/s, atk: -212.165 ent: -3.278 str: 0.000 loss: -215.443]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.51it/s, atk: -219.966 ent: -3.275 str: 0.000 loss: -223.241]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.51it/s, atk: -219.966 ent: -3.275 str: 0.000 loss: -223.241]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.51it/s, atk: -227.132 ent: -3.274 str: 0.000 loss: -230.406]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.45it/s, atk: -227.132 ent: -3.274 str: 0.000 loss: -230.406]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -234.949 ent: -3.272 str: 0.000 loss: -238.221]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -234.949 ent: -3.272 str: 0.000 loss: -238.221]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -241.689 ent: -3.271 str: 0.000 loss: -244.960]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.54it/s, atk: -241.689 ent: -3.271 str: 0.000 loss: -244.960]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.54it/s, atk: -249.758 ent: -3.272 str: 0.000 loss: -253.029]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.53it/s, atk: -249.758 ent: -3.272 str: 0.000 loss: -253.029]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.53it/s, atk: -255.342 ent: -3.273 str: 0.000 loss: -258.616]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.48it/s, atk: -255.342 ent: -3.273 str: 0.000 loss: -258.616]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.48it/s, atk: -259.326 ent: -3.273 str: 0.000 loss: -262.599]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -259.326 ent: -3.273 str: 0.000 loss: -262.599]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -265.705 ent: -3.270 str: 0.000 loss: -268.975]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.56it/s, atk: -265.705 ent: -3.270 str: 0.000 loss: -268.975]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -265.705 ent: -3.270 str: 0.000 loss: -268.975]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([54], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([309], device='cuda:0') tensor(1.7199e-12, device='cuda:0')
L1: [3241.196]	L2: [22.503063]	Linf: [0.70980394]

Accuracy on benign examples: 100.0%
gt_label: 619 pred_label: 619 pred_clean_logit 0.8698992133140564
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:06,  2.58it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:03,  4.48it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  8.41it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 13.35it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.92it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 17.07it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 17.35it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 17.80it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.82it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.93it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.59s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4347
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.634 ent: -4.943 str: 0.000 loss: -7.577]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.00s/it, atk: -2.634 ent: -4.943 str: 0.000 loss: -7.577]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.00s/it, atk: -5.718 ent: -4.950 str: 0.000 loss: -10.668]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.13s/it, atk: -5.718 ent: -4.950 str: 0.000 loss: -10.668]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.13s/it, atk: -10.271 ent: -4.945 str: 0.000 loss: -15.216]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.10it/s, atk: -10.271 ent: -4.945 str: 0.000 loss: -15.216]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.10it/s, atk: -19.384 ent: -4.944 str: 0.000 loss: -24.328]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -19.384 ent: -4.944 str: 0.000 loss: -24.328]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -24.055 ent: -4.945 str: 0.000 loss: -29.000]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.20it/s, atk: -24.055 ent: -4.945 str: 0.000 loss: -29.000]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.20it/s, atk: -28.307 ent: -4.948 str: 0.000 loss: -33.255]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -28.307 ent: -4.948 str: 0.000 loss: -33.255]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -33.473 ent: -4.950 str: 0.000 loss: -38.423]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -33.473 ent: -4.950 str: 0.000 loss: -38.423]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -39.969 ent: -4.950 str: 0.000 loss: -44.919]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -39.969 ent: -4.950 str: 0.000 loss: -44.919]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -45.298 ent: -4.949 str: 0.000 loss: -50.247]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.31it/s, atk: -45.298 ent: -4.949 str: 0.000 loss: -50.247]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.31it/s, atk: -52.480 ent: -4.948 str: 0.000 loss: -57.428]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -52.480 ent: -4.948 str: 0.000 loss: -57.428]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -58.706 ent: -4.946 str: 0.000 loss: -63.652]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -58.706 ent: -4.946 str: 0.000 loss: -63.652]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -66.353 ent: -4.945 str: 0.000 loss: -71.297]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -66.353 ent: -4.945 str: 0.000 loss: -71.297]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -72.751 ent: -4.945 str: 0.000 loss: -77.695]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -72.751 ent: -4.945 str: 0.000 loss: -77.695]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -79.171 ent: -4.945 str: 0.000 loss: -84.116]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.45it/s, atk: -79.171 ent: -4.945 str: 0.000 loss: -84.116]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.45it/s, atk: -86.086 ent: -4.944 str: 0.000 loss: -91.030]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -86.086 ent: -4.944 str: 0.000 loss: -91.030]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.43it/s, atk: -91.670 ent: -4.944 str: 0.000 loss: -96.615]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -91.670 ent: -4.944 str: 0.000 loss: -96.615]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -98.407 ent: -4.943 str: 0.000 loss: -103.350]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -98.407 ent: -4.943 str: 0.000 loss: -103.350]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.56it/s, atk: -103.489 ent: -4.943 str: 0.000 loss: -108.432]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -103.489 ent: -4.943 str: 0.000 loss: -108.432]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -108.855 ent: -4.943 str: 0.000 loss: -113.797]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.55it/s, atk: -108.855 ent: -4.943 str: 0.000 loss: -113.797]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.55it/s, atk: -113.903 ent: -4.942 str: 0.000 loss: -118.846]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -113.903 ent: -4.942 str: 0.000 loss: -118.846]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -119.506 ent: -4.942 str: 0.000 loss: -124.448]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.57it/s, atk: -119.506 ent: -4.942 str: 0.000 loss: -124.448]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.57it/s, atk: -127.475 ent: -4.942 str: 0.000 loss: -132.418]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.54it/s, atk: -127.475 ent: -4.942 str: 0.000 loss: -132.418]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.54it/s, atk: -132.662 ent: -4.943 str: 0.000 loss: -137.604]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.51it/s, atk: -132.662 ent: -4.943 str: 0.000 loss: -137.604]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.51it/s, atk: -137.701 ent: -4.944 str: 0.000 loss: -142.645]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -137.701 ent: -4.944 str: 0.000 loss: -142.645]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -141.428 ent: -4.944 str: 0.000 loss: -146.372]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.59it/s, atk: -141.428 ent: -4.944 str: 0.000 loss: -146.372]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.59it/s, atk: -146.306 ent: -4.944 str: 0.000 loss: -151.250]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.55it/s, atk: -146.306 ent: -4.944 str: 0.000 loss: -151.250]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.55it/s, atk: -151.170 ent: -4.942 str: 0.000 loss: -156.112]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.46it/s, atk: -151.170 ent: -4.942 str: 0.000 loss: -156.112]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -157.654 ent: -4.942 str: 0.000 loss: -162.596]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.44it/s, atk: -157.654 ent: -4.942 str: 0.000 loss: -162.596]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.44it/s, atk: -163.816 ent: -4.942 str: 0.000 loss: -168.759]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.53it/s, atk: -163.816 ent: -4.942 str: 0.000 loss: -168.759]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.53it/s, atk: -169.340 ent: -4.940 str: 0.000 loss: -174.279]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.50it/s, atk: -169.340 ent: -4.940 str: 0.000 loss: -174.279]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -169.340 ent: -4.940 str: 0.000 loss: -174.279]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([787], device='cuda:0') tensor(0.7401, device='cuda:0')
after_true: tensor([619], device='cuda:0') tensor(2.9295e-08, device='cuda:0')
L1: [3847.7766]	L2: [28.57305]	Linf: [0.8392157]

Accuracy on benign examples: 100.0%
gt_label: 114 pred_label: 114 pred_clean_logit 0.8928916454315186
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.98it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.24it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.73it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.85it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.30it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.83it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.49it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.94it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.38s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5124
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.046 ent: -2.449 str: 0.000 loss: -2.495]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.33s/it, atk: -0.046 ent: -2.449 str: 0.000 loss: -2.495]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.33s/it, atk: -0.127 ent: -2.442 str: 0.000 loss: -2.569]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.31s/it, atk: -0.127 ent: -2.442 str: 0.000 loss: -2.569]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.31s/it, atk: -0.198 ent: -2.442 str: 0.000 loss: -2.639]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.198 ent: -2.442 str: 0.000 loss: -2.639]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.166 ent: -2.448 str: 0.000 loss: -2.614]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -0.166 ent: -2.448 str: 0.000 loss: -2.614]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -0.235 ent: -2.448 str: 0.000 loss: -2.683]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -0.235 ent: -2.448 str: 0.000 loss: -2.683]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -0.384 ent: -2.445 str: 0.000 loss: -2.829]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -0.384 ent: -2.445 str: 0.000 loss: -2.829]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.25it/s, atk: -0.708 ent: -2.441 str: 0.000 loss: -3.149]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -0.708 ent: -2.441 str: 0.000 loss: -3.149]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -0.448 ent: -2.441 str: 0.000 loss: -2.889]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -0.448 ent: -2.441 str: 0.000 loss: -2.889]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -0.895 ent: -2.439 str: 0.000 loss: -3.334]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -0.895 ent: -2.439 str: 0.000 loss: -3.334]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -1.985 ent: -2.436 str: 0.000 loss: -4.421]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -1.985 ent: -2.436 str: 0.000 loss: -4.421]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -2.730 ent: -2.432 str: 0.000 loss: -5.162]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -2.730 ent: -2.432 str: 0.000 loss: -5.162]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -2.153 ent: -2.433 str: 0.000 loss: -4.586]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.53it/s, atk: -2.153 ent: -2.433 str: 0.000 loss: -4.586]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.53it/s, atk: -3.071 ent: -2.434 str: 0.000 loss: -5.505]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.58it/s, atk: -3.071 ent: -2.434 str: 0.000 loss: -5.505]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.58it/s, atk: -2.773 ent: -2.429 str: 0.000 loss: -5.202]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -2.773 ent: -2.429 str: 0.000 loss: -5.202]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.54it/s, atk: -5.931 ent: -2.427 str: 0.000 loss: -8.359]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.49it/s, atk: -5.931 ent: -2.427 str: 0.000 loss: -8.359]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.49it/s, atk: -12.057 ent: -2.428 str: 0.000 loss: -14.485]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -12.057 ent: -2.428 str: 0.000 loss: -14.485]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -15.489 ent: -2.434 str: 0.000 loss: -17.923]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.55it/s, atk: -15.489 ent: -2.434 str: 0.000 loss: -17.923]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.55it/s, atk: -17.836 ent: -2.434 str: 0.000 loss: -20.269]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -17.836 ent: -2.434 str: 0.000 loss: -20.269]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -14.434 ent: -2.433 str: 0.000 loss: -16.867]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.55it/s, atk: -14.434 ent: -2.433 str: 0.000 loss: -16.867]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.55it/s, atk: -8.711 ent: -2.429 str: 0.000 loss: -11.140] Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.53it/s, atk: -8.711 ent: -2.429 str: 0.000 loss: -11.140]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.53it/s, atk: -13.148 ent: -2.429 str: 0.000 loss: -15.577]Iterations:  70%|███████   | 21/30 [00:15<00:07,  1.28it/s, atk: -13.148 ent: -2.429 str: 0.000 loss: -15.577]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -22.124 ent: -2.429 str: 0.000 loss: -24.553]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.31it/s, atk: -22.124 ent: -2.429 str: 0.000 loss: -24.553]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.31it/s, atk: -29.839 ent: -2.427 str: 0.000 loss: -32.266]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.30it/s, atk: -29.839 ent: -2.427 str: 0.000 loss: -32.266]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.30it/s, atk: -44.107 ent: -2.426 str: 0.000 loss: -46.533]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.32it/s, atk: -44.107 ent: -2.426 str: 0.000 loss: -46.533]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.32it/s, atk: -54.138 ent: -2.427 str: 0.000 loss: -56.565]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.37it/s, atk: -54.138 ent: -2.427 str: 0.000 loss: -56.565]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.37it/s, atk: -67.512 ent: -2.425 str: 0.000 loss: -69.937]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -67.512 ent: -2.425 str: 0.000 loss: -69.937]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -70.192 ent: -2.422 str: 0.000 loss: -72.615]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -70.192 ent: -2.422 str: 0.000 loss: -72.615]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -78.166 ent: -2.423 str: 0.000 loss: -80.589]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -78.166 ent: -2.423 str: 0.000 loss: -80.589]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -83.698 ent: -2.421 str: 0.000 loss: -86.119]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.52it/s, atk: -83.698 ent: -2.421 str: 0.000 loss: -86.119]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.52it/s, atk: -95.666 ent: -2.421 str: 0.000 loss: -98.087]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.53it/s, atk: -95.666 ent: -2.421 str: 0.000 loss: -98.087]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -95.666 ent: -2.421 str: 0.000 loss: -98.087]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([76], device='cuda:0') tensor(0.8789, device='cuda:0')
after_true: tensor([114], device='cuda:0') tensor(3.1118e-05, device='cuda:0')
L1: [4756.153]	L2: [28.909367]	Linf: [0.68235296]

Accuracy on benign examples: 100.0%
gt_label: 475 pred_label: 475 pred_clean_logit 0.7275036573410034
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.09it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 16.10it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.54it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.11it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.11it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.12it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.17it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.62it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.95it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.50s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5512
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.294 ent: -5.172 str: 0.000 loss: -8.466]Iterations:   3%|▎         | 1/30 [00:01<00:51,  1.78s/it, atk: -3.294 ent: -5.172 str: 0.000 loss: -8.466]Iterations:   3%|▎         | 1/30 [00:02<00:51,  1.78s/it, atk: -8.754 ent: -5.148 str: 0.000 loss: -13.902]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -8.754 ent: -5.148 str: 0.000 loss: -13.902]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -14.734 ent: -5.132 str: 0.000 loss: -19.866]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.09it/s, atk: -14.734 ent: -5.132 str: 0.000 loss: -19.866]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.09it/s, atk: -18.755 ent: -5.126 str: 0.000 loss: -23.881]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.14it/s, atk: -18.755 ent: -5.126 str: 0.000 loss: -23.881]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -27.667 ent: -5.108 str: 0.000 loss: -32.775]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -27.667 ent: -5.108 str: 0.000 loss: -32.775]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -36.689 ent: -5.095 str: 0.000 loss: -41.784]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -36.689 ent: -5.095 str: 0.000 loss: -41.784]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -45.569 ent: -5.086 str: 0.000 loss: -50.654]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.27it/s, atk: -45.569 ent: -5.086 str: 0.000 loss: -50.654]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.27it/s, atk: -53.978 ent: -5.083 str: 0.000 loss: -59.061]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.28it/s, atk: -53.978 ent: -5.083 str: 0.000 loss: -59.061]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -58.837 ent: -5.083 str: 0.000 loss: -63.920]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -58.837 ent: -5.083 str: 0.000 loss: -63.920]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -63.181 ent: -5.080 str: 0.000 loss: -68.261]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -63.181 ent: -5.080 str: 0.000 loss: -68.261]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -76.326 ent: -5.083 str: 0.000 loss: -81.409]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -76.326 ent: -5.083 str: 0.000 loss: -81.409]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -83.827 ent: -5.087 str: 0.000 loss: -88.914]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -83.827 ent: -5.087 str: 0.000 loss: -88.914]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -93.521 ent: -5.089 str: 0.000 loss: -98.610]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.36it/s, atk: -93.521 ent: -5.089 str: 0.000 loss: -98.610]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.36it/s, atk: -103.096 ent: -5.090 str: 0.000 loss: -108.186]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -103.096 ent: -5.090 str: 0.000 loss: -108.186]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -110.395 ent: -5.088 str: 0.000 loss: -115.482]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.42it/s, atk: -110.395 ent: -5.088 str: 0.000 loss: -115.482]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -118.557 ent: -5.086 str: 0.000 loss: -123.643]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -118.557 ent: -5.086 str: 0.000 loss: -123.643]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -124.182 ent: -5.084 str: 0.000 loss: -129.266]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.55it/s, atk: -124.182 ent: -5.084 str: 0.000 loss: -129.266]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.55it/s, atk: -134.326 ent: -5.089 str: 0.000 loss: -139.415]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -134.326 ent: -5.089 str: 0.000 loss: -139.415]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -142.272 ent: -5.091 str: 0.000 loss: -147.363]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.56it/s, atk: -142.272 ent: -5.091 str: 0.000 loss: -147.363]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.56it/s, atk: -146.464 ent: -5.091 str: 0.000 loss: -151.555]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -146.464 ent: -5.091 str: 0.000 loss: -151.555]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.54it/s, atk: -152.274 ent: -5.096 str: 0.000 loss: -157.370]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.38it/s, atk: -152.274 ent: -5.096 str: 0.000 loss: -157.370]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.38it/s, atk: -158.609 ent: -5.103 str: 0.000 loss: -163.712]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.33it/s, atk: -158.609 ent: -5.103 str: 0.000 loss: -163.712]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.33it/s, atk: -163.156 ent: -5.108 str: 0.000 loss: -168.264]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.39it/s, atk: -163.156 ent: -5.108 str: 0.000 loss: -168.264]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.39it/s, atk: -169.430 ent: -5.109 str: 0.000 loss: -174.539]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -169.430 ent: -5.109 str: 0.000 loss: -174.539]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -176.200 ent: -5.106 str: 0.000 loss: -181.306]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -176.200 ent: -5.106 str: 0.000 loss: -181.306]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -181.332 ent: -5.106 str: 0.000 loss: -186.438]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.54it/s, atk: -181.332 ent: -5.106 str: 0.000 loss: -186.438]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.54it/s, atk: -182.771 ent: -5.108 str: 0.000 loss: -187.878]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.54it/s, atk: -182.771 ent: -5.108 str: 0.000 loss: -187.878]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.54it/s, atk: -188.856 ent: -5.111 str: 0.000 loss: -193.966]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.58it/s, atk: -188.856 ent: -5.111 str: 0.000 loss: -193.966]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.58it/s, atk: -189.163 ent: -5.108 str: 0.000 loss: -194.271]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.61it/s, atk: -189.163 ent: -5.108 str: 0.000 loss: -194.271]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.61it/s, atk: -194.640 ent: -5.099 str: 0.000 loss: -199.739]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.60it/s, atk: -194.640 ent: -5.099 str: 0.000 loss: -199.739]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -194.640 ent: -5.099 str: 0.000 loss: -199.739]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([681], device='cuda:0') tensor(0.6231, device='cuda:0')
after_true: tensor([475], device='cuda:0') tensor(1.7755e-09, device='cuda:0')
L1: [1409.8668]	L2: [11.107531]	Linf: [0.49803925]

Accuracy on benign examples: 100.0%
gt_label: 971 pred_label: 971 pred_clean_logit 1.0
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.55it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.57it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.45it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.13it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.47it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.73it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.65s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4763
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.000 ent: -2.496 str: 0.000 loss: -2.496]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.46s/it, atk: -0.000 ent: -2.496 str: 0.000 loss: -2.496]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.46s/it, atk: -0.000 ent: -2.523 str: 0.000 loss: -2.523]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -0.000 ent: -2.523 str: 0.000 loss: -2.523]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -0.000 ent: -2.543 str: 0.000 loss: -2.543]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.04s/it, atk: -0.000 ent: -2.543 str: 0.000 loss: -2.543]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.04s/it, atk: -0.000 ent: -2.559 str: 0.000 loss: -2.559]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -0.000 ent: -2.559 str: 0.000 loss: -2.559]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -0.000 ent: -2.571 str: 0.000 loss: -2.571]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.32it/s, atk: -0.000 ent: -2.571 str: 0.000 loss: -2.571]Iterations:  17%|█▋        | 5/30 [00:05<00:18,  1.32it/s, atk: -0.000 ent: -2.583 str: 0.000 loss: -2.583]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -0.000 ent: -2.583 str: 0.000 loss: -2.583]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -0.000 ent: -2.596 str: 0.000 loss: -2.596]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.45it/s, atk: -0.000 ent: -2.596 str: 0.000 loss: -2.596]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.45it/s, atk: -0.000 ent: -2.607 str: 0.000 loss: -2.607]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.47it/s, atk: -0.000 ent: -2.607 str: 0.000 loss: -2.607]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.47it/s, atk: -0.000 ent: -2.618 str: 0.000 loss: -2.618]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -0.000 ent: -2.618 str: 0.000 loss: -2.618]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -0.000 ent: -2.628 str: 0.000 loss: -2.628]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.54it/s, atk: -0.000 ent: -2.628 str: 0.000 loss: -2.628]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.54it/s, atk: -0.000 ent: -2.638 str: 0.000 loss: -2.638]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.56it/s, atk: -0.000 ent: -2.638 str: 0.000 loss: -2.638]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.56it/s, atk: -0.000 ent: -2.648 str: 0.000 loss: -2.648]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.57it/s, atk: -0.000 ent: -2.648 str: 0.000 loss: -2.648]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.57it/s, atk: -0.000 ent: -2.659 str: 0.000 loss: -2.659]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -0.000 ent: -2.659 str: 0.000 loss: -2.659]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -0.000 ent: -2.669 str: 0.000 loss: -2.669]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.51it/s, atk: -0.000 ent: -2.669 str: 0.000 loss: -2.669]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -0.000 ent: -2.679 str: 0.000 loss: -2.679]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -0.000 ent: -2.679 str: 0.000 loss: -2.679]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -0.000 ent: -2.689 str: 0.000 loss: -2.689]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -0.000 ent: -2.689 str: 0.000 loss: -2.689]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -0.000 ent: -2.698 str: 0.000 loss: -2.698]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.40it/s, atk: -0.000 ent: -2.698 str: 0.000 loss: -2.698]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -0.000 ent: -2.708 str: 0.000 loss: -2.708]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -0.000 ent: -2.708 str: 0.000 loss: -2.708]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -0.000 ent: -2.718 str: 0.000 loss: -2.718]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -0.000 ent: -2.718 str: 0.000 loss: -2.718]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -0.000 ent: -2.726 str: 0.000 loss: -2.726]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.48it/s, atk: -0.000 ent: -2.726 str: 0.000 loss: -2.726]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -0.000 ent: -2.735 str: 0.000 loss: -2.735]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.50it/s, atk: -0.000 ent: -2.735 str: 0.000 loss: -2.735]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.50it/s, atk: -0.000 ent: -2.743 str: 0.000 loss: -2.743]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -0.000 ent: -2.743 str: 0.000 loss: -2.743]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -0.000 ent: -2.752 str: 0.000 loss: -2.752]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.52it/s, atk: -0.000 ent: -2.752 str: 0.000 loss: -2.752]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.52it/s, atk: -0.000 ent: -2.760 str: 0.000 loss: -2.760]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -0.000 ent: -2.760 str: 0.000 loss: -2.760]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.50it/s, atk: -0.000 ent: -2.768 str: 0.000 loss: -2.768]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.38it/s, atk: -0.000 ent: -2.768 str: 0.000 loss: -2.768]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.38it/s, atk: -0.000 ent: -2.777 str: 0.000 loss: -2.777]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -0.000 ent: -2.777 str: 0.000 loss: -2.777]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -0.000 ent: -2.785 str: 0.000 loss: -2.785]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.48it/s, atk: -0.000 ent: -2.785 str: 0.000 loss: -2.785]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.48it/s, atk: -0.000 ent: -2.794 str: 0.000 loss: -2.794]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -0.000 ent: -2.794 str: 0.000 loss: -2.794]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -0.000 ent: -2.801 str: 0.000 loss: -2.801]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -0.000 ent: -2.801 str: 0.000 loss: -2.801]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -0.000 ent: -2.810 str: 0.000 loss: -2.810]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.49it/s, atk: -0.000 ent: -2.810 str: 0.000 loss: -2.810]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -0.000 ent: -2.810 str: 0.000 loss: -2.810]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 100.0%
after_pred: tensor([971], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([971], device='cuda:0') tensor(1., device='cuda:0')
L1: [3439.7214]	L2: [21.787928]	Linf: [0.6745098]

Accuracy on benign examples: 100.0%
gt_label: 478 pred_label: 478 pred_clean_logit 0.9965004920959473
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.48it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 13.00it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.83it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.74it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 15.23it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.12it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 14.83it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 15.10it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.23it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.04it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.62s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.40s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3502
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.066 ent: -2.639 str: 0.000 loss: -2.705]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.71s/it, atk: -0.066 ent: -2.639 str: 0.000 loss: -2.705]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.71s/it, atk: -0.138 ent: -2.608 str: 0.000 loss: -2.746]Iterations:   7%|▋         | 2/30 [00:03<00:44,  1.59s/it, atk: -0.138 ent: -2.608 str: 0.000 loss: -2.746]Iterations:   7%|▋         | 2/30 [00:03<00:44,  1.59s/it, atk: -0.189 ent: -2.567 str: 0.000 loss: -2.756]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -0.189 ent: -2.567 str: 0.000 loss: -2.756]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -0.466 ent: -2.557 str: 0.000 loss: -3.024]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.03it/s, atk: -0.466 ent: -2.557 str: 0.000 loss: -3.024]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.03it/s, atk: -1.384 ent: -2.554 str: 0.000 loss: -3.938]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -1.384 ent: -2.554 str: 0.000 loss: -3.938]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -1.385 ent: -2.551 str: 0.000 loss: -3.937]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -1.385 ent: -2.551 str: 0.000 loss: -3.937]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -3.436 ent: -2.551 str: 0.000 loss: -5.987]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -3.436 ent: -2.551 str: 0.000 loss: -5.987]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.32it/s, atk: -6.415 ent: -2.553 str: 0.000 loss: -8.968]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -6.415 ent: -2.553 str: 0.000 loss: -8.968]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -9.487 ent: -2.553 str: 0.000 loss: -12.040]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -9.487 ent: -2.553 str: 0.000 loss: -12.040]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -10.588 ent: -2.552 str: 0.000 loss: -13.140]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.43it/s, atk: -10.588 ent: -2.552 str: 0.000 loss: -13.140]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.43it/s, atk: -17.735 ent: -2.551 str: 0.000 loss: -20.286]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -17.735 ent: -2.551 str: 0.000 loss: -20.286]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -26.477 ent: -2.543 str: 0.000 loss: -29.020]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -26.477 ent: -2.543 str: 0.000 loss: -29.020]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -30.131 ent: -2.538 str: 0.000 loss: -32.668]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.45it/s, atk: -30.131 ent: -2.538 str: 0.000 loss: -32.668]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.45it/s, atk: -35.039 ent: -2.534 str: 0.000 loss: -37.574]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.57it/s, atk: -35.039 ent: -2.534 str: 0.000 loss: -37.574]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.57it/s, atk: -39.965 ent: -2.530 str: 0.000 loss: -42.495]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.60it/s, atk: -39.965 ent: -2.530 str: 0.000 loss: -42.495]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.60it/s, atk: -44.953 ent: -2.528 str: 0.000 loss: -47.481]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.61it/s, atk: -44.953 ent: -2.528 str: 0.000 loss: -47.481]Iterations:  53%|█████▎    | 16/30 [00:13<00:08,  1.61it/s, atk: -46.694 ent: -2.525 str: 0.000 loss: -49.219]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.53it/s, atk: -46.694 ent: -2.525 str: 0.000 loss: -49.219]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.53it/s, atk: -50.470 ent: -2.526 str: 0.000 loss: -52.996]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -50.470 ent: -2.526 str: 0.000 loss: -52.996]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -54.504 ent: -2.525 str: 0.000 loss: -57.029]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -54.504 ent: -2.525 str: 0.000 loss: -57.029]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.45it/s, atk: -55.058 ent: -2.527 str: 0.000 loss: -57.585]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -55.058 ent: -2.527 str: 0.000 loss: -57.585]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -52.526 ent: -2.529 str: 0.000 loss: -55.055]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.44it/s, atk: -52.526 ent: -2.529 str: 0.000 loss: -55.055]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.44it/s, atk: -62.482 ent: -2.529 str: 0.000 loss: -65.011]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.40it/s, atk: -62.482 ent: -2.529 str: 0.000 loss: -65.011]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.40it/s, atk: -64.089 ent: -2.529 str: 0.000 loss: -66.618]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.33it/s, atk: -64.089 ent: -2.529 str: 0.000 loss: -66.618]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.33it/s, atk: -66.518 ent: -2.528 str: 0.000 loss: -69.046]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -66.518 ent: -2.528 str: 0.000 loss: -69.046]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -68.851 ent: -2.526 str: 0.000 loss: -71.377]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -68.851 ent: -2.526 str: 0.000 loss: -71.377]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -71.386 ent: -2.528 str: 0.000 loss: -73.913]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -71.386 ent: -2.528 str: 0.000 loss: -73.913]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.41it/s, atk: -73.713 ent: -2.527 str: 0.000 loss: -76.240]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.39it/s, atk: -73.713 ent: -2.527 str: 0.000 loss: -76.240]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.39it/s, atk: -76.836 ent: -2.526 str: 0.000 loss: -79.362]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -76.836 ent: -2.526 str: 0.000 loss: -79.362]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -79.376 ent: -2.526 str: 0.000 loss: -81.903]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -79.376 ent: -2.526 str: 0.000 loss: -81.903]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.46it/s, atk: -81.651 ent: -2.525 str: 0.000 loss: -84.176]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.40it/s, atk: -81.651 ent: -2.525 str: 0.000 loss: -84.176]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -81.651 ent: -2.525 str: 0.000 loss: -84.176]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([519], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([478], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [1601.059]	L2: [11.741212]	Linf: [0.5058824]

Accuracy on benign examples: 100.0%
gt_label: 707 pred_label: 707 pred_clean_logit 0.8343031406402588
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.05it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  9.62it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 12.36it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 13.70it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 12.81it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 13.60it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 16.00it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.56it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.16it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.10it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.06s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.60s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3255
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.182 ent: -8.491 str: 0.000 loss: -11.673]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.61s/it, atk: -3.182 ent: -8.491 str: 0.000 loss: -11.673]Iterations:   3%|▎         | 1/30 [00:03<01:15,  2.61s/it, atk: -10.356 ent: -8.479 str: 0.000 loss: -18.835]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.48s/it, atk: -10.356 ent: -8.479 str: 0.000 loss: -18.835]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.48s/it, atk: -17.699 ent: -8.488 str: 0.000 loss: -26.187]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.09s/it, atk: -17.699 ent: -8.488 str: 0.000 loss: -26.187]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.09s/it, atk: -28.423 ent: -8.472 str: 0.000 loss: -36.895]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.02it/s, atk: -28.423 ent: -8.472 str: 0.000 loss: -36.895]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.02it/s, atk: -38.024 ent: -8.474 str: 0.000 loss: -46.498]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.19it/s, atk: -38.024 ent: -8.474 str: 0.000 loss: -46.498]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.19it/s, atk: -54.204 ent: -8.464 str: 0.000 loss: -62.668]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -54.204 ent: -8.464 str: 0.000 loss: -62.668]Iterations:  20%|██        | 6/30 [00:06<00:17,  1.35it/s, atk: -64.555 ent: -8.473 str: 0.000 loss: -73.028]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.44it/s, atk: -64.555 ent: -8.473 str: 0.000 loss: -73.028]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.44it/s, atk: -73.590 ent: -8.474 str: 0.000 loss: -82.065]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -73.590 ent: -8.474 str: 0.000 loss: -82.065]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -82.252 ent: -8.472 str: 0.000 loss: -90.724]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -82.252 ent: -8.472 str: 0.000 loss: -90.724]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.44it/s, atk: -90.308 ent: -8.471 str: 0.000 loss: -98.779]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -90.308 ent: -8.471 str: 0.000 loss: -98.779]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -99.048 ent: -8.471 str: 0.000 loss: -107.518]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -99.048 ent: -8.471 str: 0.000 loss: -107.518]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -106.744 ent: -8.471 str: 0.000 loss: -115.215]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -106.744 ent: -8.471 str: 0.000 loss: -115.215]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -112.652 ent: -8.472 str: 0.000 loss: -121.125]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -112.652 ent: -8.472 str: 0.000 loss: -121.125]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -119.908 ent: -8.475 str: 0.000 loss: -128.383]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -119.908 ent: -8.475 str: 0.000 loss: -128.383]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -125.291 ent: -8.478 str: 0.000 loss: -133.770]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.49it/s, atk: -125.291 ent: -8.478 str: 0.000 loss: -133.770]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.49it/s, atk: -131.371 ent: -8.481 str: 0.000 loss: -139.852]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -131.371 ent: -8.481 str: 0.000 loss: -139.852]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.41it/s, atk: -137.654 ent: -8.480 str: 0.000 loss: -146.134]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -137.654 ent: -8.480 str: 0.000 loss: -146.134]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -143.276 ent: -8.479 str: 0.000 loss: -151.755]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -143.276 ent: -8.479 str: 0.000 loss: -151.755]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -148.989 ent: -8.477 str: 0.000 loss: -157.466]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -148.989 ent: -8.477 str: 0.000 loss: -157.466]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -152.139 ent: -8.473 str: 0.000 loss: -160.612]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -152.139 ent: -8.473 str: 0.000 loss: -160.612]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -157.765 ent: -8.471 str: 0.000 loss: -166.236]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -157.765 ent: -8.471 str: 0.000 loss: -166.236]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -163.412 ent: -8.473 str: 0.000 loss: -171.884]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -163.412 ent: -8.473 str: 0.000 loss: -171.884]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -167.786 ent: -8.475 str: 0.000 loss: -176.261]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.38it/s, atk: -167.786 ent: -8.475 str: 0.000 loss: -176.261]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.38it/s, atk: -171.947 ent: -8.476 str: 0.000 loss: -180.423]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -171.947 ent: -8.476 str: 0.000 loss: -180.423]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -176.860 ent: -8.477 str: 0.000 loss: -185.337]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -176.860 ent: -8.477 str: 0.000 loss: -185.337]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -181.000 ent: -8.477 str: 0.000 loss: -189.478]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -181.000 ent: -8.477 str: 0.000 loss: -189.478]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -184.874 ent: -8.478 str: 0.000 loss: -193.352]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -184.874 ent: -8.478 str: 0.000 loss: -193.352]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -188.707 ent: -8.480 str: 0.000 loss: -197.187]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -188.707 ent: -8.480 str: 0.000 loss: -197.187]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -192.417 ent: -8.483 str: 0.000 loss: -200.900]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.35it/s, atk: -192.417 ent: -8.483 str: 0.000 loss: -200.900]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.35it/s, atk: -195.740 ent: -8.486 str: 0.000 loss: -204.226]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -195.740 ent: -8.486 str: 0.000 loss: -204.226]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -195.740 ent: -8.486 str: 0.000 loss: -204.226]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([584], device='cuda:0') tensor(0.9118, device='cuda:0')
after_true: tensor([707], device='cuda:0') tensor(2.2725e-09, device='cuda:0')
L1: [2055.6196]	L2: [16.617493]	Linf: [0.7882353]

Accuracy on benign examples: 100.0%
gt_label: 873 pred_label: 873 pred_clean_logit 0.9964967370033264
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.28it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.68it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.53it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.78it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.91it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.78it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.12it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.87it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.30it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.27it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5199
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.034 ent: -9.729 str: 0.000 loss: -9.764]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.38s/it, atk: -0.034 ent: -9.729 str: 0.000 loss: -9.764]Iterations:   3%|▎         | 1/30 [00:03<01:09,  2.38s/it, atk: -0.058 ent: -9.803 str: 0.000 loss: -9.861]Iterations:   7%|▋         | 2/30 [00:03<00:47,  1.70s/it, atk: -0.058 ent: -9.803 str: 0.000 loss: -9.861]Iterations:   7%|▋         | 2/30 [00:04<00:47,  1.70s/it, atk: -0.193 ent: -9.813 str: 0.000 loss: -10.006]Iterations:  10%|█         | 3/30 [00:04<00:35,  1.33s/it, atk: -0.193 ent: -9.813 str: 0.000 loss: -10.006]Iterations:  10%|█         | 3/30 [00:05<00:35,  1.33s/it, atk: -0.604 ent: -9.814 str: 0.000 loss: -10.418]Iterations:  13%|█▎        | 4/30 [00:05<00:29,  1.14s/it, atk: -0.604 ent: -9.814 str: 0.000 loss: -10.418]Iterations:  13%|█▎        | 4/30 [00:05<00:29,  1.14s/it, atk: -1.688 ent: -9.822 str: 0.000 loss: -11.510]Iterations:  17%|█▋        | 5/30 [00:06<00:26,  1.07s/it, atk: -1.688 ent: -9.822 str: 0.000 loss: -11.510]Iterations:  17%|█▋        | 5/30 [00:06<00:26,  1.07s/it, atk: -3.660 ent: -9.825 str: 0.000 loss: -13.485]Iterations:  20%|██        | 6/30 [00:07<00:23,  1.03it/s, atk: -3.660 ent: -9.825 str: 0.000 loss: -13.485]Iterations:  20%|██        | 6/30 [00:07<00:23,  1.03it/s, atk: -6.817 ent: -9.814 str: 0.000 loss: -16.631]Iterations:  23%|██▎       | 7/30 [00:07<00:21,  1.09it/s, atk: -6.817 ent: -9.814 str: 0.000 loss: -16.631]Iterations:  23%|██▎       | 7/30 [00:08<00:21,  1.09it/s, atk: -11.540 ent: -9.810 str: 0.000 loss: -21.350]Iterations:  27%|██▋       | 8/30 [00:08<00:20,  1.09it/s, atk: -11.540 ent: -9.810 str: 0.000 loss: -21.350]Iterations:  27%|██▋       | 8/30 [00:09<00:20,  1.09it/s, atk: -18.912 ent: -9.801 str: 0.000 loss: -28.713]Iterations:  30%|███       | 9/30 [00:09<00:18,  1.15it/s, atk: -18.912 ent: -9.801 str: 0.000 loss: -28.713]Iterations:  30%|███       | 9/30 [00:09<00:18,  1.15it/s, atk: -25.471 ent: -9.797 str: 0.000 loss: -35.268]Iterations:  33%|███▎      | 10/30 [00:10<00:16,  1.22it/s, atk: -25.471 ent: -9.797 str: 0.000 loss: -35.268]Iterations:  33%|███▎      | 10/30 [00:10<00:16,  1.22it/s, atk: -31.131 ent: -9.796 str: 0.000 loss: -40.927]Iterations:  37%|███▋      | 11/30 [00:11<00:16,  1.18it/s, atk: -31.131 ent: -9.796 str: 0.000 loss: -40.927]Iterations:  37%|███▋      | 11/30 [00:11<00:16,  1.18it/s, atk: -37.708 ent: -9.794 str: 0.000 loss: -47.502]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.22it/s, atk: -37.708 ent: -9.794 str: 0.000 loss: -47.502]Iterations:  40%|████      | 12/30 [00:12<00:14,  1.22it/s, atk: -42.587 ent: -9.785 str: 0.000 loss: -52.372]Iterations:  43%|████▎     | 13/30 [00:12<00:14,  1.21it/s, atk: -42.587 ent: -9.785 str: 0.000 loss: -52.372]Iterations:  43%|████▎     | 13/30 [00:13<00:14,  1.21it/s, atk: -47.228 ent: -9.785 str: 0.000 loss: -57.013]Iterations:  47%|████▋     | 14/30 [00:13<00:12,  1.28it/s, atk: -47.228 ent: -9.785 str: 0.000 loss: -57.013]Iterations:  47%|████▋     | 14/30 [00:13<00:12,  1.28it/s, atk: -52.084 ent: -9.789 str: 0.000 loss: -61.873]Iterations:  50%|█████     | 15/30 [00:14<00:11,  1.27it/s, atk: -52.084 ent: -9.789 str: 0.000 loss: -61.873]Iterations:  50%|█████     | 15/30 [00:14<00:11,  1.27it/s, atk: -56.478 ent: -9.793 str: 0.000 loss: -66.271]Iterations:  53%|█████▎    | 16/30 [00:15<00:11,  1.24it/s, atk: -56.478 ent: -9.793 str: 0.000 loss: -66.271]Iterations:  53%|█████▎    | 16/30 [00:15<00:11,  1.24it/s, atk: -59.013 ent: -9.794 str: 0.000 loss: -68.807]Iterations:  57%|█████▋    | 17/30 [00:15<00:10,  1.22it/s, atk: -59.013 ent: -9.794 str: 0.000 loss: -68.807]Iterations:  57%|█████▋    | 17/30 [00:16<00:10,  1.22it/s, atk: -62.907 ent: -9.795 str: 0.000 loss: -72.702]Iterations:  60%|██████    | 18/30 [00:17<00:11,  1.06it/s, atk: -62.907 ent: -9.795 str: 0.000 loss: -72.702]Iterations:  60%|██████    | 18/30 [00:17<00:11,  1.06it/s, atk: -68.070 ent: -9.794 str: 0.000 loss: -77.864]Iterations:  63%|██████▎   | 19/30 [00:18<00:10,  1.02it/s, atk: -68.070 ent: -9.794 str: 0.000 loss: -77.864]Iterations:  63%|██████▎   | 19/30 [00:18<00:10,  1.02it/s, atk: -71.221 ent: -9.794 str: 0.000 loss: -81.015]Iterations:  67%|██████▋   | 20/30 [00:18<00:08,  1.11it/s, atk: -71.221 ent: -9.794 str: 0.000 loss: -81.015]Iterations:  67%|██████▋   | 20/30 [00:19<00:08,  1.11it/s, atk: -75.289 ent: -9.798 str: 0.000 loss: -85.087]Iterations:  70%|███████   | 21/30 [00:19<00:07,  1.17it/s, atk: -75.289 ent: -9.798 str: 0.000 loss: -85.087]Iterations:  70%|███████   | 21/30 [00:20<00:07,  1.17it/s, atk: -79.115 ent: -9.800 str: 0.000 loss: -88.915]Iterations:  73%|███████▎  | 22/30 [00:20<00:06,  1.27it/s, atk: -79.115 ent: -9.800 str: 0.000 loss: -88.915]Iterations:  73%|███████▎  | 22/30 [00:20<00:06,  1.27it/s, atk: -82.998 ent: -9.799 str: 0.000 loss: -92.797]Iterations:  77%|███████▋  | 23/30 [00:21<00:05,  1.30it/s, atk: -82.998 ent: -9.799 str: 0.000 loss: -92.797]Iterations:  77%|███████▋  | 23/30 [00:21<00:05,  1.30it/s, atk: -85.856 ent: -9.796 str: 0.000 loss: -95.651]Iterations:  80%|████████  | 24/30 [00:21<00:04,  1.33it/s, atk: -85.856 ent: -9.796 str: 0.000 loss: -95.651]Iterations:  80%|████████  | 24/30 [00:22<00:04,  1.33it/s, atk: -88.921 ent: -9.792 str: 0.000 loss: -98.714]Iterations:  83%|████████▎ | 25/30 [00:22<00:03,  1.30it/s, atk: -88.921 ent: -9.792 str: 0.000 loss: -98.714]Iterations:  83%|████████▎ | 25/30 [00:22<00:03,  1.30it/s, atk: -91.619 ent: -9.789 str: 0.000 loss: -101.407]Iterations:  87%|████████▋ | 26/30 [00:23<00:02,  1.43it/s, atk: -91.619 ent: -9.789 str: 0.000 loss: -101.407]Iterations:  87%|████████▋ | 26/30 [00:23<00:02,  1.43it/s, atk: -94.627 ent: -9.786 str: 0.000 loss: -104.413]Iterations:  90%|█████████ | 27/30 [00:23<00:02,  1.44it/s, atk: -94.627 ent: -9.786 str: 0.000 loss: -104.413]Iterations:  90%|█████████ | 27/30 [00:24<00:02,  1.44it/s, atk: -97.735 ent: -9.784 str: 0.000 loss: -107.519]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.45it/s, atk: -97.735 ent: -9.784 str: 0.000 loss: -107.519]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.45it/s, atk: -99.588 ent: -9.781 str: 0.000 loss: -109.369]Iterations:  97%|█████████▋| 29/30 [00:25<00:00,  1.44it/s, atk: -99.588 ent: -9.781 str: 0.000 loss: -109.369]Iterations:  97%|█████████▋| 29/30 [00:25<00:00,  1.44it/s, atk: -102.082 ent: -9.778 str: 0.000 loss: -111.860]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.45it/s, atk: -102.082 ent: -9.778 str: 0.000 loss: -111.860]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.16it/s, atk: -102.082 ent: -9.778 str: 0.000 loss: -111.860]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([424], device='cuda:0') tensor(0.4060, device='cuda:0')
after_true: tensor([873], device='cuda:0') tensor(2.9725e-05, device='cuda:0')
L1: [2972.0784]	L2: [21.434792]	Linf: [0.7254902]

Accuracy on benign examples: 100.0%
gt_label: 544 pred_label: 544 pred_clean_logit 0.8760806322097778
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.27it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.14it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.46it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.41it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.19it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.36it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.79it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.69it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:11,  2.79s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:04<00:05,  1.97s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.78s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.08s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:10<00:00,  2.03s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4107
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.184 ent: -4.966 str: 0.000 loss: -6.151]Iterations:   3%|▎         | 1/30 [00:02<01:25,  2.95s/it, atk: -1.184 ent: -4.966 str: 0.000 loss: -6.151]Iterations:   3%|▎         | 1/30 [00:03<01:25,  2.95s/it, atk: -3.929 ent: -4.976 str: 0.000 loss: -8.905]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.63s/it, atk: -3.929 ent: -4.976 str: 0.000 loss: -8.905]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.63s/it, atk: -5.767 ent: -4.985 str: 0.000 loss: -10.752]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.20s/it, atk: -5.767 ent: -4.985 str: 0.000 loss: -10.752]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.20s/it, atk: -8.825 ent: -4.992 str: 0.000 loss: -13.818]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.03it/s, atk: -8.825 ent: -4.992 str: 0.000 loss: -13.818]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.03it/s, atk: -10.167 ent: -4.996 str: 0.000 loss: -15.162]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.15it/s, atk: -10.167 ent: -4.996 str: 0.000 loss: -15.162]Iterations:  17%|█▋        | 5/30 [00:06<00:21,  1.15it/s, atk: -11.297 ent: -4.997 str: 0.000 loss: -16.294]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -11.297 ent: -4.997 str: 0.000 loss: -16.294]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -12.269 ent: -4.999 str: 0.000 loss: -17.268]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -12.269 ent: -4.999 str: 0.000 loss: -17.268]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -14.582 ent: -4.999 str: 0.000 loss: -19.581]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -14.582 ent: -4.999 str: 0.000 loss: -19.581]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.28it/s, atk: -17.232 ent: -4.997 str: 0.000 loss: -22.229]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -17.232 ent: -4.997 str: 0.000 loss: -22.229]Iterations:  30%|███       | 9/30 [00:09<00:16,  1.30it/s, atk: -20.076 ent: -4.994 str: 0.000 loss: -25.071]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.30it/s, atk: -20.076 ent: -4.994 str: 0.000 loss: -25.071]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.30it/s, atk: -23.861 ent: -4.992 str: 0.000 loss: -28.853]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.35it/s, atk: -23.861 ent: -4.992 str: 0.000 loss: -28.853]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.35it/s, atk: -28.082 ent: -4.990 str: 0.000 loss: -33.072]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.44it/s, atk: -28.082 ent: -4.990 str: 0.000 loss: -33.072]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.44it/s, atk: -32.443 ent: -4.989 str: 0.000 loss: -37.432]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.49it/s, atk: -32.443 ent: -4.989 str: 0.000 loss: -37.432]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.49it/s, atk: -36.380 ent: -4.988 str: 0.000 loss: -41.368]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -36.380 ent: -4.988 str: 0.000 loss: -41.368]Iterations:  47%|████▋     | 14/30 [00:12<00:10,  1.51it/s, atk: -40.300 ent: -4.987 str: 0.000 loss: -45.287]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -40.300 ent: -4.987 str: 0.000 loss: -45.287]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.42it/s, atk: -44.924 ent: -4.987 str: 0.000 loss: -49.911]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.50it/s, atk: -44.924 ent: -4.987 str: 0.000 loss: -49.911]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.50it/s, atk: -49.253 ent: -4.987 str: 0.000 loss: -54.240]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.51it/s, atk: -49.253 ent: -4.987 str: 0.000 loss: -54.240]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.51it/s, atk: -52.277 ent: -4.986 str: 0.000 loss: -57.263]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -52.277 ent: -4.986 str: 0.000 loss: -57.263]Iterations:  60%|██████    | 18/30 [00:15<00:07,  1.52it/s, atk: -55.787 ent: -4.985 str: 0.000 loss: -60.772]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.48it/s, atk: -55.787 ent: -4.985 str: 0.000 loss: -60.772]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.48it/s, atk: -59.486 ent: -4.984 str: 0.000 loss: -64.469]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.55it/s, atk: -59.486 ent: -4.984 str: 0.000 loss: -64.469]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.55it/s, atk: -62.938 ent: -4.982 str: 0.000 loss: -67.921]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.53it/s, atk: -62.938 ent: -4.982 str: 0.000 loss: -67.921]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.53it/s, atk: -67.100 ent: -4.982 str: 0.000 loss: -72.082]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.42it/s, atk: -67.100 ent: -4.982 str: 0.000 loss: -72.082]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.42it/s, atk: -70.324 ent: -4.981 str: 0.000 loss: -75.304]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -70.324 ent: -4.981 str: 0.000 loss: -75.304]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -73.977 ent: -4.980 str: 0.000 loss: -78.957]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -73.977 ent: -4.980 str: 0.000 loss: -78.957]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.43it/s, atk: -77.821 ent: -4.980 str: 0.000 loss: -82.801]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.47it/s, atk: -77.821 ent: -4.980 str: 0.000 loss: -82.801]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.47it/s, atk: -80.998 ent: -4.979 str: 0.000 loss: -85.977]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.49it/s, atk: -80.998 ent: -4.979 str: 0.000 loss: -85.977]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.49it/s, atk: -84.227 ent: -4.978 str: 0.000 loss: -89.206]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.54it/s, atk: -84.227 ent: -4.978 str: 0.000 loss: -89.206]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.54it/s, atk: -87.033 ent: -4.978 str: 0.000 loss: -92.011]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.58it/s, atk: -87.033 ent: -4.978 str: 0.000 loss: -92.011]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.58it/s, atk: -90.020 ent: -4.977 str: 0.000 loss: -94.997]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -90.020 ent: -4.977 str: 0.000 loss: -94.997]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -93.285 ent: -4.977 str: 0.000 loss: -98.262]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.48it/s, atk: -93.285 ent: -4.977 str: 0.000 loss: -98.262]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -93.285 ent: -4.977 str: 0.000 loss: -98.262]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([909], device='cuda:0') tensor(0.9808, device='cuda:0')
after_true: tensor([544], device='cuda:0') tensor(6.2403e-05, device='cuda:0')
L1: [2661.9412]	L2: [18.66719]	Linf: [0.68235296]

Accuracy on benign examples: 100.0%
gt_label: 436 pred_label: 436 pred_clean_logit 0.9968736171722412
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.29it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 21.87it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.30it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.38it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.63it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.60it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.82it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.54s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.60s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4657
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.084 ent: -5.147 str: 0.000 loss: -5.231]Iterations:   3%|▎         | 1/30 [00:02<01:21,  2.82s/it, atk: -0.084 ent: -5.147 str: 0.000 loss: -5.231]Iterations:   3%|▎         | 1/30 [00:03<01:21,  2.82s/it, atk: -0.311 ent: -5.165 str: 0.000 loss: -5.476]Iterations:   7%|▋         | 2/30 [00:03<00:44,  1.60s/it, atk: -0.311 ent: -5.165 str: 0.000 loss: -5.476]Iterations:   7%|▋         | 2/30 [00:03<00:44,  1.60s/it, atk: -0.717 ent: -5.157 str: 0.000 loss: -5.874]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.20s/it, atk: -0.717 ent: -5.157 str: 0.000 loss: -5.874]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.20s/it, atk: -1.799 ent: -5.148 str: 0.000 loss: -6.948]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.03it/s, atk: -1.799 ent: -5.148 str: 0.000 loss: -6.948]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.03it/s, atk: -4.158 ent: -5.155 str: 0.000 loss: -9.314]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -4.158 ent: -5.155 str: 0.000 loss: -9.314]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -5.852 ent: -5.152 str: 0.000 loss: -11.004]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -5.852 ent: -5.152 str: 0.000 loss: -11.004]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -9.799 ent: -5.150 str: 0.000 loss: -14.949]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -9.799 ent: -5.150 str: 0.000 loss: -14.949]Iterations:  23%|██▎       | 7/30 [00:07<00:16,  1.36it/s, atk: -13.400 ent: -5.148 str: 0.000 loss: -18.548]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -13.400 ent: -5.148 str: 0.000 loss: -18.548]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -18.211 ent: -5.149 str: 0.000 loss: -23.360]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.45it/s, atk: -18.211 ent: -5.149 str: 0.000 loss: -23.360]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.45it/s, atk: -21.818 ent: -5.150 str: 0.000 loss: -26.968]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -21.818 ent: -5.150 str: 0.000 loss: -26.968]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.51it/s, atk: -25.906 ent: -5.148 str: 0.000 loss: -31.055]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -25.906 ent: -5.148 str: 0.000 loss: -31.055]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -30.566 ent: -5.151 str: 0.000 loss: -35.717]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.52it/s, atk: -30.566 ent: -5.151 str: 0.000 loss: -35.717]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.52it/s, atk: -36.585 ent: -5.154 str: 0.000 loss: -41.739]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.58it/s, atk: -36.585 ent: -5.154 str: 0.000 loss: -41.739]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.58it/s, atk: -40.765 ent: -5.156 str: 0.000 loss: -45.921]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.58it/s, atk: -40.765 ent: -5.156 str: 0.000 loss: -45.921]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.58it/s, atk: -45.290 ent: -5.159 str: 0.000 loss: -50.449]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.62it/s, atk: -45.290 ent: -5.159 str: 0.000 loss: -50.449]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.62it/s, atk: -49.756 ent: -5.154 str: 0.000 loss: -54.910]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.58it/s, atk: -49.756 ent: -5.154 str: 0.000 loss: -54.910]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.58it/s, atk: -55.166 ent: -5.153 str: 0.000 loss: -60.319]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.56it/s, atk: -55.166 ent: -5.153 str: 0.000 loss: -60.319]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.56it/s, atk: -58.017 ent: -5.150 str: 0.000 loss: -63.167]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.57it/s, atk: -58.017 ent: -5.150 str: 0.000 loss: -63.167]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.57it/s, atk: -62.645 ent: -5.154 str: 0.000 loss: -67.799]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.54it/s, atk: -62.645 ent: -5.154 str: 0.000 loss: -67.799]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.54it/s, atk: -67.315 ent: -5.156 str: 0.000 loss: -72.471]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.57it/s, atk: -67.315 ent: -5.156 str: 0.000 loss: -72.471]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.57it/s, atk: -71.257 ent: -5.155 str: 0.000 loss: -76.412]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.62it/s, atk: -71.257 ent: -5.155 str: 0.000 loss: -76.412]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.62it/s, atk: -75.547 ent: -5.155 str: 0.000 loss: -80.702]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.57it/s, atk: -75.547 ent: -5.155 str: 0.000 loss: -80.702]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.57it/s, atk: -77.879 ent: -5.155 str: 0.000 loss: -83.034]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.57it/s, atk: -77.879 ent: -5.155 str: 0.000 loss: -83.034]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.57it/s, atk: -80.579 ent: -5.155 str: 0.000 loss: -85.734]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -80.579 ent: -5.155 str: 0.000 loss: -85.734]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -84.719 ent: -5.149 str: 0.000 loss: -89.868]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -84.719 ent: -5.149 str: 0.000 loss: -89.868]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -87.657 ent: -5.150 str: 0.000 loss: -92.807]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.42it/s, atk: -87.657 ent: -5.150 str: 0.000 loss: -92.807]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.42it/s, atk: -91.319 ent: -5.150 str: 0.000 loss: -96.468]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -91.319 ent: -5.150 str: 0.000 loss: -96.468]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -94.170 ent: -5.150 str: 0.000 loss: -99.320]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.41it/s, atk: -94.170 ent: -5.150 str: 0.000 loss: -99.320]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.41it/s, atk: -96.659 ent: -5.148 str: 0.000 loss: -101.807]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -96.659 ent: -5.148 str: 0.000 loss: -101.807]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -99.263 ent: -5.149 str: 0.000 loss: -104.412]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.49it/s, atk: -99.263 ent: -5.149 str: 0.000 loss: -104.412]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -99.263 ent: -5.149 str: 0.000 loss: -104.412]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([511], device='cuda:0') tensor(0.9986, device='cuda:0')
after_true: tensor([436], device='cuda:0') tensor(3.9238e-05, device='cuda:0')
L1: [3229.7686]	L2: [22.133831]	Linf: [0.8509804]

Accuracy on benign examples: 100.0%
gt_label: 853 pred_label: 853 pred_clean_logit 0.9249933958053589
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.97it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.25it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.52it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.67it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.08it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.48it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.49it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.53s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4336
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -2.968 ent: -5.052 str: 0.000 loss: -8.020]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.36s/it, atk: -2.968 ent: -5.052 str: 0.000 loss: -8.020]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.36s/it, atk: -8.421 ent: -5.050 str: 0.000 loss: -13.471]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -8.421 ent: -5.050 str: 0.000 loss: -13.471]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -14.199 ent: -5.050 str: 0.000 loss: -19.250]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -14.199 ent: -5.050 str: 0.000 loss: -19.250]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -23.103 ent: -5.050 str: 0.000 loss: -28.153]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -23.103 ent: -5.050 str: 0.000 loss: -28.153]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -32.367 ent: -5.051 str: 0.000 loss: -37.418]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -32.367 ent: -5.051 str: 0.000 loss: -37.418]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -35.761 ent: -5.046 str: 0.000 loss: -40.807]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -35.761 ent: -5.046 str: 0.000 loss: -40.807]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -38.580 ent: -5.046 str: 0.000 loss: -43.626]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.45it/s, atk: -38.580 ent: -5.046 str: 0.000 loss: -43.626]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.45it/s, atk: -42.746 ent: -5.040 str: 0.000 loss: -47.787]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -42.746 ent: -5.040 str: 0.000 loss: -47.787]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -45.436 ent: -5.039 str: 0.000 loss: -50.475]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -45.436 ent: -5.039 str: 0.000 loss: -50.475]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -47.950 ent: -5.036 str: 0.000 loss: -52.986]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.46it/s, atk: -47.950 ent: -5.036 str: 0.000 loss: -52.986]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.46it/s, atk: -49.652 ent: -5.028 str: 0.000 loss: -54.680]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.52it/s, atk: -49.652 ent: -5.028 str: 0.000 loss: -54.680]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.52it/s, atk: -51.327 ent: -5.032 str: 0.000 loss: -56.358]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -51.327 ent: -5.032 str: 0.000 loss: -56.358]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -53.684 ent: -5.030 str: 0.000 loss: -58.714]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -53.684 ent: -5.030 str: 0.000 loss: -58.714]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -56.249 ent: -5.023 str: 0.000 loss: -61.272]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.52it/s, atk: -56.249 ent: -5.023 str: 0.000 loss: -61.272]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -57.468 ent: -5.022 str: 0.000 loss: -62.490]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -57.468 ent: -5.022 str: 0.000 loss: -62.490]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -60.655 ent: -5.024 str: 0.000 loss: -65.679]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.57it/s, atk: -60.655 ent: -5.024 str: 0.000 loss: -65.679]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.57it/s, atk: -62.781 ent: -5.027 str: 0.000 loss: -67.808]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.58it/s, atk: -62.781 ent: -5.027 str: 0.000 loss: -67.808]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.58it/s, atk: -63.673 ent: -5.028 str: 0.000 loss: -68.701]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.59it/s, atk: -63.673 ent: -5.028 str: 0.000 loss: -68.701]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.59it/s, atk: -65.453 ent: -5.028 str: 0.000 loss: -70.482]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -65.453 ent: -5.028 str: 0.000 loss: -70.482]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -67.130 ent: -5.029 str: 0.000 loss: -72.159]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -67.130 ent: -5.029 str: 0.000 loss: -72.159]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -69.353 ent: -5.030 str: 0.000 loss: -74.383]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -69.353 ent: -5.030 str: 0.000 loss: -74.383]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -71.148 ent: -5.030 str: 0.000 loss: -76.178]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -71.148 ent: -5.030 str: 0.000 loss: -76.178]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -72.400 ent: -5.030 str: 0.000 loss: -77.430]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.54it/s, atk: -72.400 ent: -5.030 str: 0.000 loss: -77.430]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -73.978 ent: -5.031 str: 0.000 loss: -79.009]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -73.978 ent: -5.031 str: 0.000 loss: -79.009]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -75.765 ent: -5.031 str: 0.000 loss: -80.796]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.59it/s, atk: -75.765 ent: -5.031 str: 0.000 loss: -80.796]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.59it/s, atk: -77.409 ent: -5.030 str: 0.000 loss: -82.439]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.58it/s, atk: -77.409 ent: -5.030 str: 0.000 loss: -82.439]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.58it/s, atk: -78.814 ent: -5.031 str: 0.000 loss: -83.845]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -78.814 ent: -5.031 str: 0.000 loss: -83.845]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -80.106 ent: -5.031 str: 0.000 loss: -85.137]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.59it/s, atk: -80.106 ent: -5.031 str: 0.000 loss: -85.137]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.59it/s, atk: -81.775 ent: -5.031 str: 0.000 loss: -86.806]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.59it/s, atk: -81.775 ent: -5.031 str: 0.000 loss: -86.806]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.59it/s, atk: -83.117 ent: -5.032 str: 0.000 loss: -88.149]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.58it/s, atk: -83.117 ent: -5.032 str: 0.000 loss: -88.149]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -83.117 ent: -5.032 str: 0.000 loss: -88.149]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([706], device='cuda:0') tensor(0.5927, device='cuda:0')
after_true: tensor([853], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [1766.0001]	L2: [12.5481205]	Linf: [0.6]

Accuracy on benign examples: 100.0%
gt_label: 479 pred_label: 479 pred_clean_logit 0.7791844010353088
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:04,  3.83it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:02,  7.92it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.91it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.50it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.67it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.56it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 21.63it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.96it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.43s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.33s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.39s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.49s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5138
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.986 ent: -5.068 str: 0.000 loss: -8.055]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -2.986 ent: -5.068 str: 0.000 loss: -8.055]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -3.037 ent: -5.069 str: 0.000 loss: -8.106]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -3.037 ent: -5.069 str: 0.000 loss: -8.106]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -4.003 ent: -5.062 str: 0.000 loss: -9.065]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -4.003 ent: -5.062 str: 0.000 loss: -9.065]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -5.262 ent: -5.057 str: 0.000 loss: -10.320]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -5.262 ent: -5.057 str: 0.000 loss: -10.320]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -6.519 ent: -5.052 str: 0.000 loss: -11.571]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.30it/s, atk: -6.519 ent: -5.052 str: 0.000 loss: -11.571]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.30it/s, atk: -7.899 ent: -5.051 str: 0.000 loss: -12.950]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.44it/s, atk: -7.899 ent: -5.051 str: 0.000 loss: -12.950]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.44it/s, atk: -9.161 ent: -5.051 str: 0.000 loss: -14.212]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -9.161 ent: -5.051 str: 0.000 loss: -14.212]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.51it/s, atk: -11.273 ent: -5.052 str: 0.000 loss: -16.325]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.52it/s, atk: -11.273 ent: -5.052 str: 0.000 loss: -16.325]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.52it/s, atk: -13.161 ent: -5.052 str: 0.000 loss: -18.213]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.52it/s, atk: -13.161 ent: -5.052 str: 0.000 loss: -18.213]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.52it/s, atk: -14.672 ent: -5.052 str: 0.000 loss: -19.723]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.56it/s, atk: -14.672 ent: -5.052 str: 0.000 loss: -19.723]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.56it/s, atk: -16.988 ent: -5.049 str: 0.000 loss: -22.037]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.62it/s, atk: -16.988 ent: -5.049 str: 0.000 loss: -22.037]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.62it/s, atk: -19.493 ent: -5.048 str: 0.000 loss: -24.541]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.61it/s, atk: -19.493 ent: -5.048 str: 0.000 loss: -24.541]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.61it/s, atk: -21.418 ent: -5.048 str: 0.000 loss: -26.467]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.51it/s, atk: -21.418 ent: -5.048 str: 0.000 loss: -26.467]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.51it/s, atk: -23.722 ent: -5.046 str: 0.000 loss: -28.768]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -23.722 ent: -5.046 str: 0.000 loss: -28.768]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -25.656 ent: -5.046 str: 0.000 loss: -30.702]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -25.656 ent: -5.046 str: 0.000 loss: -30.702]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -27.279 ent: -5.045 str: 0.000 loss: -32.323]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.46it/s, atk: -27.279 ent: -5.045 str: 0.000 loss: -32.323]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -29.449 ent: -5.045 str: 0.000 loss: -34.494]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.46it/s, atk: -29.449 ent: -5.045 str: 0.000 loss: -34.494]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.46it/s, atk: -31.785 ent: -5.047 str: 0.000 loss: -36.832]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -31.785 ent: -5.047 str: 0.000 loss: -36.832]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -33.733 ent: -5.050 str: 0.000 loss: -38.782]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.50it/s, atk: -33.733 ent: -5.050 str: 0.000 loss: -38.782]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.50it/s, atk: -35.344 ent: -5.051 str: 0.000 loss: -40.396]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -35.344 ent: -5.051 str: 0.000 loss: -40.396]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -37.960 ent: -5.049 str: 0.000 loss: -43.009]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -37.960 ent: -5.049 str: 0.000 loss: -43.009]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -41.035 ent: -5.047 str: 0.000 loss: -46.082]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.44it/s, atk: -41.035 ent: -5.047 str: 0.000 loss: -46.082]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -44.332 ent: -5.047 str: 0.000 loss: -49.380]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -44.332 ent: -5.047 str: 0.000 loss: -49.380]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -49.194 ent: -5.047 str: 0.000 loss: -54.241]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.38it/s, atk: -49.194 ent: -5.047 str: 0.000 loss: -54.241]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.38it/s, atk: -56.575 ent: -5.047 str: 0.000 loss: -61.623]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.51it/s, atk: -56.575 ent: -5.047 str: 0.000 loss: -61.623]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -64.659 ent: -5.046 str: 0.000 loss: -69.705]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.53it/s, atk: -64.659 ent: -5.046 str: 0.000 loss: -69.705]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.53it/s, atk: -73.807 ent: -5.044 str: 0.000 loss: -78.852]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.55it/s, atk: -73.807 ent: -5.044 str: 0.000 loss: -78.852]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.55it/s, atk: -82.589 ent: -5.045 str: 0.000 loss: -87.634]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.55it/s, atk: -82.589 ent: -5.045 str: 0.000 loss: -87.634]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.55it/s, atk: -91.809 ent: -5.046 str: 0.000 loss: -96.855]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.48it/s, atk: -91.809 ent: -5.046 str: 0.000 loss: -96.855]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -100.485 ent: -5.047 str: 0.000 loss: -105.532]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -100.485 ent: -5.047 str: 0.000 loss: -105.532]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -100.485 ent: -5.047 str: 0.000 loss: -105.532]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([837], device='cuda:0') tensor(0.5696, device='cuda:0')
after_true: tensor([479], device='cuda:0') tensor(1.8443e-05, device='cuda:0')
L1: [2770.9768]	L2: [20.729742]	Linf: [0.7607843]

Accuracy on benign examples: 100.0%
gt_label: 912 pred_label: 912 pred_clean_logit 0.9799173474311829
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.05it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.16it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.12it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.27it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.91it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.61it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.04it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.24it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.09it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.48s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.62s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5300
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.439 ent: -5.069 str: 0.000 loss: -5.507]Iterations:   3%|▎         | 1/30 [00:02<01:16,  2.64s/it, atk: -0.439 ent: -5.069 str: 0.000 loss: -5.507]Iterations:   3%|▎         | 1/30 [00:03<01:16,  2.64s/it, atk: -0.688 ent: -5.053 str: 0.000 loss: -5.741]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.50s/it, atk: -0.688 ent: -5.053 str: 0.000 loss: -5.741]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.50s/it, atk: -3.851 ent: -5.050 str: 0.000 loss: -8.900]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -3.851 ent: -5.050 str: 0.000 loss: -8.900]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -3.719 ent: -5.058 str: 0.000 loss: -8.777]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.02s/it, atk: -3.719 ent: -5.058 str: 0.000 loss: -8.777]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.02s/it, atk: -7.459 ent: -5.056 str: 0.000 loss: -12.515]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.14it/s, atk: -7.459 ent: -5.056 str: 0.000 loss: -12.515]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.14it/s, atk: -13.855 ent: -5.057 str: 0.000 loss: -18.912]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -13.855 ent: -5.057 str: 0.000 loss: -18.912]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -21.262 ent: -5.057 str: 0.000 loss: -26.319]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -21.262 ent: -5.057 str: 0.000 loss: -26.319]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -30.760 ent: -5.056 str: 0.000 loss: -35.816]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -30.760 ent: -5.056 str: 0.000 loss: -35.816]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.33it/s, atk: -31.730 ent: -5.054 str: 0.000 loss: -36.784]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -31.730 ent: -5.054 str: 0.000 loss: -36.784]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -36.644 ent: -5.055 str: 0.000 loss: -41.699]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -36.644 ent: -5.055 str: 0.000 loss: -41.699]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.40it/s, atk: -38.672 ent: -5.056 str: 0.000 loss: -43.728]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -38.672 ent: -5.056 str: 0.000 loss: -43.728]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.41it/s, atk: -46.803 ent: -5.057 str: 0.000 loss: -51.860]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.21it/s, atk: -46.803 ent: -5.057 str: 0.000 loss: -51.860]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.21it/s, atk: -54.777 ent: -5.057 str: 0.000 loss: -59.833]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.27it/s, atk: -54.777 ent: -5.057 str: 0.000 loss: -59.833]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.27it/s, atk: -57.936 ent: -5.057 str: 0.000 loss: -62.992]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.33it/s, atk: -57.936 ent: -5.057 str: 0.000 loss: -62.992]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.33it/s, atk: -65.958 ent: -5.053 str: 0.000 loss: -71.011]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.35it/s, atk: -65.958 ent: -5.053 str: 0.000 loss: -71.011]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.35it/s, atk: -75.104 ent: -5.051 str: 0.000 loss: -80.156]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.42it/s, atk: -75.104 ent: -5.051 str: 0.000 loss: -80.156]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.42it/s, atk: -80.541 ent: -5.050 str: 0.000 loss: -85.591]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.48it/s, atk: -80.541 ent: -5.050 str: 0.000 loss: -85.591]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.48it/s, atk: -89.782 ent: -5.049 str: 0.000 loss: -94.831]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -89.782 ent: -5.049 str: 0.000 loss: -94.831]Iterations:  60%|██████    | 18/30 [00:15<00:07,  1.52it/s, atk: -102.285 ent: -5.048 str: 0.000 loss: -107.334]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.52it/s, atk: -102.285 ent: -5.048 str: 0.000 loss: -107.334]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.52it/s, atk: -108.340 ent: -5.048 str: 0.000 loss: -113.388]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.46it/s, atk: -108.340 ent: -5.048 str: 0.000 loss: -113.388]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.46it/s, atk: -112.251 ent: -5.048 str: 0.000 loss: -117.299]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.47it/s, atk: -112.251 ent: -5.048 str: 0.000 loss: -117.299]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.47it/s, atk: -120.096 ent: -5.047 str: 0.000 loss: -125.143]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.54it/s, atk: -120.096 ent: -5.047 str: 0.000 loss: -125.143]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.54it/s, atk: -124.762 ent: -5.044 str: 0.000 loss: -129.807]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.53it/s, atk: -124.762 ent: -5.044 str: 0.000 loss: -129.807]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.53it/s, atk: -129.815 ent: -5.044 str: 0.000 loss: -134.859]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.55it/s, atk: -129.815 ent: -5.044 str: 0.000 loss: -134.859]Iterations:  80%|████████  | 24/30 [00:19<00:03,  1.55it/s, atk: -135.372 ent: -5.043 str: 0.000 loss: -140.415]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.55it/s, atk: -135.372 ent: -5.043 str: 0.000 loss: -140.415]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.55it/s, atk: -141.159 ent: -5.041 str: 0.000 loss: -146.200]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.45it/s, atk: -141.159 ent: -5.041 str: 0.000 loss: -146.200]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.45it/s, atk: -147.034 ent: -5.039 str: 0.000 loss: -152.073]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -147.034 ent: -5.039 str: 0.000 loss: -152.073]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -153.097 ent: -5.038 str: 0.000 loss: -158.135]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -153.097 ent: -5.038 str: 0.000 loss: -158.135]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -156.220 ent: -5.038 str: 0.000 loss: -161.258]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -156.220 ent: -5.038 str: 0.000 loss: -161.258]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -162.429 ent: -5.037 str: 0.000 loss: -167.466]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.45it/s, atk: -162.429 ent: -5.037 str: 0.000 loss: -167.466]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -162.429 ent: -5.037 str: 0.000 loss: -167.466]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([958], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([912], device='cuda:0') tensor(4.6670e-08, device='cuda:0')
L1: [3129.5413]	L2: [20.32335]	Linf: [0.63529414]

Accuracy on benign examples: 100.0%
gt_label: 879 pred_label: 879 pred_clean_logit 0.9993226528167725
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.26it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.50it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.44it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.43it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.66it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.10it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.68it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.99it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.44s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.35s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5807
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.003 ent: -2.497 str: 0.000 loss: -2.500]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.59s/it, atk: -0.003 ent: -2.497 str: 0.000 loss: -2.500]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.59s/it, atk: -0.004 ent: -2.527 str: 0.000 loss: -2.531]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -0.004 ent: -2.527 str: 0.000 loss: -2.531]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -0.006 ent: -2.547 str: 0.000 loss: -2.553]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.05s/it, atk: -0.006 ent: -2.547 str: 0.000 loss: -2.553]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.05s/it, atk: -0.012 ent: -2.562 str: 0.000 loss: -2.575]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -0.012 ent: -2.562 str: 0.000 loss: -2.575]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -0.027 ent: -2.575 str: 0.000 loss: -2.602]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -0.027 ent: -2.575 str: 0.000 loss: -2.602]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -0.065 ent: -2.584 str: 0.000 loss: -2.648]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.20it/s, atk: -0.065 ent: -2.584 str: 0.000 loss: -2.648]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.20it/s, atk: -0.148 ent: -2.586 str: 0.000 loss: -2.734]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -0.148 ent: -2.586 str: 0.000 loss: -2.734]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.33it/s, atk: -0.390 ent: -2.587 str: 0.000 loss: -2.977]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -0.390 ent: -2.587 str: 0.000 loss: -2.977]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -1.087 ent: -2.588 str: 0.000 loss: -3.675]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -1.087 ent: -2.588 str: 0.000 loss: -3.675]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -2.643 ent: -2.588 str: 0.000 loss: -5.231]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -2.643 ent: -2.588 str: 0.000 loss: -5.231]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -4.826 ent: -2.586 str: 0.000 loss: -7.412]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -4.826 ent: -2.586 str: 0.000 loss: -7.412]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -9.679 ent: -2.585 str: 0.000 loss: -12.264]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.47it/s, atk: -9.679 ent: -2.585 str: 0.000 loss: -12.264]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.47it/s, atk: -15.178 ent: -2.584 str: 0.000 loss: -17.763]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.25it/s, atk: -15.178 ent: -2.584 str: 0.000 loss: -17.763]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.25it/s, atk: -22.903 ent: -2.583 str: 0.000 loss: -25.485]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.24it/s, atk: -22.903 ent: -2.583 str: 0.000 loss: -25.485]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.24it/s, atk: -30.844 ent: -2.582 str: 0.000 loss: -33.426]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.29it/s, atk: -30.844 ent: -2.582 str: 0.000 loss: -33.426]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.29it/s, atk: -39.236 ent: -2.581 str: 0.000 loss: -41.817]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.39it/s, atk: -39.236 ent: -2.581 str: 0.000 loss: -41.817]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.39it/s, atk: -48.284 ent: -2.580 str: 0.000 loss: -50.864]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -48.284 ent: -2.580 str: 0.000 loss: -50.864]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.45it/s, atk: -54.542 ent: -2.579 str: 0.000 loss: -57.120]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -54.542 ent: -2.579 str: 0.000 loss: -57.120]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -61.098 ent: -2.579 str: 0.000 loss: -63.677]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.47it/s, atk: -61.098 ent: -2.579 str: 0.000 loss: -63.677]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.47it/s, atk: -68.003 ent: -2.578 str: 0.000 loss: -70.582]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.42it/s, atk: -68.003 ent: -2.578 str: 0.000 loss: -70.582]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.42it/s, atk: -75.359 ent: -2.577 str: 0.000 loss: -77.936]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -75.359 ent: -2.577 str: 0.000 loss: -77.936]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -81.621 ent: -2.576 str: 0.000 loss: -84.198]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -81.621 ent: -2.576 str: 0.000 loss: -84.198]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -86.063 ent: -2.576 str: 0.000 loss: -88.640]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -86.063 ent: -2.576 str: 0.000 loss: -88.640]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -93.532 ent: -2.576 str: 0.000 loss: -96.108]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -93.532 ent: -2.576 str: 0.000 loss: -96.108]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -99.118 ent: -2.575 str: 0.000 loss: -101.693]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.53it/s, atk: -99.118 ent: -2.575 str: 0.000 loss: -101.693]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.53it/s, atk: -104.140 ent: -2.575 str: 0.000 loss: -106.715]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.50it/s, atk: -104.140 ent: -2.575 str: 0.000 loss: -106.715]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.50it/s, atk: -109.562 ent: -2.575 str: 0.000 loss: -112.137]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.51it/s, atk: -109.562 ent: -2.575 str: 0.000 loss: -112.137]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.51it/s, atk: -116.308 ent: -2.575 str: 0.000 loss: -118.883]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.58it/s, atk: -116.308 ent: -2.575 str: 0.000 loss: -118.883]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.58it/s, atk: -121.269 ent: -2.575 str: 0.000 loss: -123.844]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -121.269 ent: -2.575 str: 0.000 loss: -123.844]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.51it/s, atk: -126.579 ent: -2.574 str: 0.000 loss: -129.153]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.51it/s, atk: -126.579 ent: -2.574 str: 0.000 loss: -129.153]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -126.579 ent: -2.574 str: 0.000 loss: -129.153]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([835], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([879], device='cuda:0') tensor(1.9836e-06, device='cuda:0')
L1: [2262.4314]	L2: [15.726659]	Linf: [0.81960785]

Accuracy on benign examples: 100.0%
gt_label: 307 pred_label: 307 pred_clean_logit 0.5830008387565613
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.38it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.58it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.63it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.61it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.29it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.10it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.08it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.64it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.25s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.27s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.51s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5253
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -7.286 ent: -5.081 str: 0.000 loss: -12.367]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.03s/it, atk: -7.286 ent: -5.081 str: 0.000 loss: -12.367]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.03s/it, atk: -16.382 ent: -5.066 str: 0.000 loss: -21.448]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -16.382 ent: -5.066 str: 0.000 loss: -21.448]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -28.779 ent: -5.057 str: 0.000 loss: -33.836]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.01it/s, atk: -28.779 ent: -5.057 str: 0.000 loss: -33.836]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.01it/s, atk: -38.052 ent: -5.057 str: 0.000 loss: -43.109]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -38.052 ent: -5.057 str: 0.000 loss: -43.109]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -46.692 ent: -5.057 str: 0.000 loss: -51.749]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -46.692 ent: -5.057 str: 0.000 loss: -51.749]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.31it/s, atk: -54.798 ent: -5.057 str: 0.000 loss: -59.855]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -54.798 ent: -5.057 str: 0.000 loss: -59.855]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -60.209 ent: -5.052 str: 0.000 loss: -65.261]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -60.209 ent: -5.052 str: 0.000 loss: -65.261]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -65.419 ent: -5.051 str: 0.000 loss: -70.470]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -65.419 ent: -5.051 str: 0.000 loss: -70.470]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.41it/s, atk: -72.039 ent: -5.050 str: 0.000 loss: -77.089]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -72.039 ent: -5.050 str: 0.000 loss: -77.089]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -76.130 ent: -5.049 str: 0.000 loss: -81.178]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.46it/s, atk: -76.130 ent: -5.049 str: 0.000 loss: -81.178]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.46it/s, atk: -78.347 ent: -5.051 str: 0.000 loss: -83.399]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.47it/s, atk: -78.347 ent: -5.051 str: 0.000 loss: -83.399]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -78.047 ent: -5.053 str: 0.000 loss: -83.100]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -78.047 ent: -5.053 str: 0.000 loss: -83.100]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -80.555 ent: -5.054 str: 0.000 loss: -85.609]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -80.555 ent: -5.054 str: 0.000 loss: -85.609]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -84.529 ent: -5.055 str: 0.000 loss: -89.585]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -84.529 ent: -5.055 str: 0.000 loss: -89.585]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.54it/s, atk: -88.585 ent: -5.056 str: 0.000 loss: -93.641]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -88.585 ent: -5.056 str: 0.000 loss: -93.641]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -90.965 ent: -5.057 str: 0.000 loss: -96.022]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -90.965 ent: -5.057 str: 0.000 loss: -96.022]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -94.324 ent: -5.056 str: 0.000 loss: -99.380]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.45it/s, atk: -94.324 ent: -5.056 str: 0.000 loss: -99.380]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -98.301 ent: -5.056 str: 0.000 loss: -103.357]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.54it/s, atk: -98.301 ent: -5.056 str: 0.000 loss: -103.357]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.54it/s, atk: -101.366 ent: -5.056 str: 0.000 loss: -106.421]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -101.366 ent: -5.056 str: 0.000 loss: -106.421]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.61it/s, atk: -103.996 ent: -5.056 str: 0.000 loss: -109.052]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.58it/s, atk: -103.996 ent: -5.056 str: 0.000 loss: -109.052]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.58it/s, atk: -106.871 ent: -5.056 str: 0.000 loss: -111.927]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.56it/s, atk: -106.871 ent: -5.056 str: 0.000 loss: -111.927]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.56it/s, atk: -109.672 ent: -5.056 str: 0.000 loss: -114.728]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.56it/s, atk: -109.672 ent: -5.056 str: 0.000 loss: -114.728]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.56it/s, atk: -112.295 ent: -5.056 str: 0.000 loss: -117.351]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.59it/s, atk: -112.295 ent: -5.056 str: 0.000 loss: -117.351]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.59it/s, atk: -115.321 ent: -5.055 str: 0.000 loss: -120.376]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -115.321 ent: -5.055 str: 0.000 loss: -120.376]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -118.436 ent: -5.054 str: 0.000 loss: -123.490]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.58it/s, atk: -118.436 ent: -5.054 str: 0.000 loss: -123.490]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.58it/s, atk: -121.397 ent: -5.053 str: 0.000 loss: -126.450]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.59it/s, atk: -121.397 ent: -5.053 str: 0.000 loss: -126.450]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.59it/s, atk: -124.351 ent: -5.053 str: 0.000 loss: -129.404]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.62it/s, atk: -124.351 ent: -5.053 str: 0.000 loss: -129.404]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.62it/s, atk: -127.033 ent: -5.053 str: 0.000 loss: -132.086]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.60it/s, atk: -127.033 ent: -5.053 str: 0.000 loss: -132.086]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.60it/s, atk: -129.708 ent: -5.052 str: 0.000 loss: -134.760]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.60it/s, atk: -129.708 ent: -5.052 str: 0.000 loss: -134.760]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.60it/s, atk: -132.617 ent: -5.051 str: 0.000 loss: -137.668]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.61it/s, atk: -132.617 ent: -5.051 str: 0.000 loss: -137.668]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.44it/s, atk: -132.617 ent: -5.051 str: 0.000 loss: -137.668]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([304], device='cuda:0') tensor(0.9990, device='cuda:0')
after_true: tensor([307], device='cuda:0') tensor(1.3264e-06, device='cuda:0')
L1: [3458.6592]	L2: [23.535965]	Linf: [0.72156864]

Accuracy on benign examples: 100.0%
gt_label: 470 pred_label: 470 pred_clean_logit 0.9984673857688904
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.41it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.22it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.44it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.06it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.69it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.90it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.33it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.26it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.88it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.61s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2562
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.028 ent: -2.873 str: 0.000 loss: -2.901]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.11s/it, atk: -0.028 ent: -2.873 str: 0.000 loss: -2.901]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.11s/it, atk: -0.186 ent: -2.884 str: 0.000 loss: -3.070]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.21s/it, atk: -0.186 ent: -2.884 str: 0.000 loss: -3.070]Iterations:   7%|▋         | 2/30 [00:03<00:33,  1.21s/it, atk: -0.813 ent: -2.896 str: 0.000 loss: -3.709]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -0.813 ent: -2.896 str: 0.000 loss: -3.709]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -1.683 ent: -2.901 str: 0.000 loss: -4.584]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.22it/s, atk: -1.683 ent: -2.901 str: 0.000 loss: -4.584]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.22it/s, atk: -2.295 ent: -2.886 str: 0.000 loss: -5.181]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -2.295 ent: -2.886 str: 0.000 loss: -5.181]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -5.079 ent: -2.888 str: 0.000 loss: -7.967]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.39it/s, atk: -5.079 ent: -2.888 str: 0.000 loss: -7.967]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.39it/s, atk: -8.125 ent: -2.893 str: 0.000 loss: -11.019]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -8.125 ent: -2.893 str: 0.000 loss: -11.019]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.43it/s, atk: -12.460 ent: -2.896 str: 0.000 loss: -15.356]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.45it/s, atk: -12.460 ent: -2.896 str: 0.000 loss: -15.356]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.45it/s, atk: -15.858 ent: -2.897 str: 0.000 loss: -18.755]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -15.858 ent: -2.897 str: 0.000 loss: -18.755]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -21.303 ent: -2.898 str: 0.000 loss: -24.201]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -21.303 ent: -2.898 str: 0.000 loss: -24.201]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -25.076 ent: -2.902 str: 0.000 loss: -27.977]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -25.076 ent: -2.902 str: 0.000 loss: -27.977]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -31.586 ent: -2.903 str: 0.000 loss: -34.489]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.53it/s, atk: -31.586 ent: -2.903 str: 0.000 loss: -34.489]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.53it/s, atk: -37.529 ent: -2.898 str: 0.000 loss: -40.426]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.53it/s, atk: -37.529 ent: -2.898 str: 0.000 loss: -40.426]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.53it/s, atk: -42.644 ent: -2.898 str: 0.000 loss: -45.542]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -42.644 ent: -2.898 str: 0.000 loss: -45.542]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -49.219 ent: -2.898 str: 0.000 loss: -52.117]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -49.219 ent: -2.898 str: 0.000 loss: -52.117]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -55.849 ent: -2.896 str: 0.000 loss: -58.745]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -55.849 ent: -2.896 str: 0.000 loss: -58.745]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -63.307 ent: -2.896 str: 0.000 loss: -66.202]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.43it/s, atk: -63.307 ent: -2.896 str: 0.000 loss: -66.202]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -65.505 ent: -2.897 str: 0.000 loss: -68.402]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.39it/s, atk: -65.505 ent: -2.897 str: 0.000 loss: -68.402]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.39it/s, atk: -73.992 ent: -2.893 str: 0.000 loss: -76.885]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -73.992 ent: -2.893 str: 0.000 loss: -76.885]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -78.200 ent: -2.887 str: 0.000 loss: -81.087]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.36it/s, atk: -78.200 ent: -2.887 str: 0.000 loss: -81.087]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -82.203 ent: -2.884 str: 0.000 loss: -85.086]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.39it/s, atk: -82.203 ent: -2.884 str: 0.000 loss: -85.086]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -88.078 ent: -2.884 str: 0.000 loss: -90.962]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -88.078 ent: -2.884 str: 0.000 loss: -90.962]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -93.987 ent: -2.885 str: 0.000 loss: -96.872]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -93.987 ent: -2.885 str: 0.000 loss: -96.872]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.50it/s, atk: -99.726 ent: -2.888 str: 0.000 loss: -102.614]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -99.726 ent: -2.888 str: 0.000 loss: -102.614]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -104.293 ent: -2.889 str: 0.000 loss: -107.182]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -104.293 ent: -2.889 str: 0.000 loss: -107.182]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -109.481 ent: -2.894 str: 0.000 loss: -112.375]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -109.481 ent: -2.894 str: 0.000 loss: -112.375]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -112.899 ent: -2.893 str: 0.000 loss: -115.792]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.46it/s, atk: -112.899 ent: -2.893 str: 0.000 loss: -115.792]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -116.943 ent: -2.894 str: 0.000 loss: -119.837]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -116.943 ent: -2.894 str: 0.000 loss: -119.837]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -121.638 ent: -2.896 str: 0.000 loss: -124.534]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -121.638 ent: -2.896 str: 0.000 loss: -124.534]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -125.844 ent: -2.898 str: 0.000 loss: -128.742]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.50it/s, atk: -125.844 ent: -2.898 str: 0.000 loss: -128.742]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -125.844 ent: -2.898 str: 0.000 loss: -128.742]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([473], device='cuda:0') tensor(0.9939, device='cuda:0')
after_true: tensor([470], device='cuda:0') tensor(2.0290e-06, device='cuda:0')
L1: [1035.1411]	L2: [7.8099823]	Linf: [0.45882353]

Accuracy on benign examples: 100.0%
gt_label: 457 pred_label: 457 pred_clean_logit 0.7459312081336975
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.86it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  7.80it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.18it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.42it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.74it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.23it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.65it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 17.85it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.88it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.10it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.36s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.43s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4863
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.381 ent: -5.107 str: 0.000 loss: -5.488]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.54s/it, atk: -0.381 ent: -5.107 str: 0.000 loss: -5.488]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.54s/it, atk: -2.427 ent: -5.097 str: 0.000 loss: -7.524]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.45s/it, atk: -2.427 ent: -5.097 str: 0.000 loss: -7.524]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.45s/it, atk: -8.774 ent: -5.085 str: 0.000 loss: -13.859]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.08s/it, atk: -8.774 ent: -5.085 str: 0.000 loss: -13.859]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.08s/it, atk: -23.321 ent: -5.086 str: 0.000 loss: -28.407]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -23.321 ent: -5.086 str: 0.000 loss: -28.407]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -35.052 ent: -5.082 str: 0.000 loss: -40.134]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -35.052 ent: -5.082 str: 0.000 loss: -40.134]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -45.752 ent: -5.078 str: 0.000 loss: -50.830]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.34it/s, atk: -45.752 ent: -5.078 str: 0.000 loss: -50.830]Iterations:  20%|██        | 6/30 [00:06<00:17,  1.34it/s, atk: -52.603 ent: -5.076 str: 0.000 loss: -57.678]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -52.603 ent: -5.076 str: 0.000 loss: -57.678]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -60.857 ent: -5.072 str: 0.000 loss: -65.929]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.41it/s, atk: -60.857 ent: -5.072 str: 0.000 loss: -65.929]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.41it/s, atk: -66.342 ent: -5.071 str: 0.000 loss: -71.413]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -66.342 ent: -5.071 str: 0.000 loss: -71.413]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.45it/s, atk: -71.631 ent: -5.072 str: 0.000 loss: -76.703]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -71.631 ent: -5.072 str: 0.000 loss: -76.703]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -78.166 ent: -5.070 str: 0.000 loss: -83.236]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.57it/s, atk: -78.166 ent: -5.070 str: 0.000 loss: -83.236]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.57it/s, atk: -84.816 ent: -5.070 str: 0.000 loss: -89.886]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.53it/s, atk: -84.816 ent: -5.070 str: 0.000 loss: -89.886]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.53it/s, atk: -91.659 ent: -5.070 str: 0.000 loss: -96.729]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -91.659 ent: -5.070 str: 0.000 loss: -96.729]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -98.773 ent: -5.070 str: 0.000 loss: -103.842]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.50it/s, atk: -98.773 ent: -5.070 str: 0.000 loss: -103.842]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -105.106 ent: -5.069 str: 0.000 loss: -110.175]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.53it/s, atk: -105.106 ent: -5.069 str: 0.000 loss: -110.175]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.53it/s, atk: -111.692 ent: -5.068 str: 0.000 loss: -116.759]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -111.692 ent: -5.068 str: 0.000 loss: -116.759]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -117.932 ent: -5.067 str: 0.000 loss: -122.999]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -117.932 ent: -5.067 str: 0.000 loss: -122.999]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -124.844 ent: -5.068 str: 0.000 loss: -129.913]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -124.844 ent: -5.068 str: 0.000 loss: -129.913]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -128.064 ent: -5.064 str: 0.000 loss: -133.128]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -128.064 ent: -5.064 str: 0.000 loss: -133.128]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -133.361 ent: -5.064 str: 0.000 loss: -138.425]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.50it/s, atk: -133.361 ent: -5.064 str: 0.000 loss: -138.425]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.50it/s, atk: -141.499 ent: -5.064 str: 0.000 loss: -146.563]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.48it/s, atk: -141.499 ent: -5.064 str: 0.000 loss: -146.563]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.48it/s, atk: -146.117 ent: -5.060 str: 0.000 loss: -151.177]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.56it/s, atk: -146.117 ent: -5.060 str: 0.000 loss: -151.177]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.56it/s, atk: -153.964 ent: -5.059 str: 0.000 loss: -159.023]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.55it/s, atk: -153.964 ent: -5.059 str: 0.000 loss: -159.023]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.55it/s, atk: -159.291 ent: -5.059 str: 0.000 loss: -164.350]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -159.291 ent: -5.059 str: 0.000 loss: -164.350]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.56it/s, atk: -164.329 ent: -5.060 str: 0.000 loss: -169.389]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.52it/s, atk: -164.329 ent: -5.060 str: 0.000 loss: -169.389]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.52it/s, atk: -171.210 ent: -5.061 str: 0.000 loss: -176.270]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.52it/s, atk: -171.210 ent: -5.061 str: 0.000 loss: -176.270]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.52it/s, atk: -177.161 ent: -5.061 str: 0.000 loss: -182.223]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.53it/s, atk: -177.161 ent: -5.061 str: 0.000 loss: -182.223]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.53it/s, atk: -183.325 ent: -5.061 str: 0.000 loss: -188.386]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -183.325 ent: -5.061 str: 0.000 loss: -188.386]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -189.551 ent: -5.061 str: 0.000 loss: -194.613]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.50it/s, atk: -189.551 ent: -5.061 str: 0.000 loss: -194.613]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -194.615 ent: -5.061 str: 0.000 loss: -199.677]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.50it/s, atk: -194.615 ent: -5.061 str: 0.000 loss: -199.677]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -194.615 ent: -5.061 str: 0.000 loss: -199.677]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([642], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([457], device='cuda:0') tensor(2.2227e-09, device='cuda:0')
L1: [1931.9884]	L2: [15.6928425]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 360 pred_label: 360 pred_clean_logit 0.9956438541412354
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.74it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.94it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.15it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 13.14it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 10.91it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 14.29it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 14.36it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 13.94it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.30it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.40s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.27s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.36s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.51s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.51s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2162
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.101 ent: -2.936 str: 0.000 loss: -3.037]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.32s/it, atk: -0.101 ent: -2.936 str: 0.000 loss: -3.037]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.32s/it, atk: -0.935 ent: -2.955 str: 0.000 loss: -3.890]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.35s/it, atk: -0.935 ent: -2.955 str: 0.000 loss: -3.890]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -3.987 ent: -2.932 str: 0.000 loss: -6.918]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -3.987 ent: -2.932 str: 0.000 loss: -6.918]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.01s/it, atk: -10.853 ent: -2.928 str: 0.000 loss: -13.781]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -10.853 ent: -2.928 str: 0.000 loss: -13.781]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -19.157 ent: -2.923 str: 0.000 loss: -22.080]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -19.157 ent: -2.923 str: 0.000 loss: -22.080]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -28.666 ent: -2.928 str: 0.000 loss: -31.594]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.22it/s, atk: -28.666 ent: -2.928 str: 0.000 loss: -31.594]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -40.273 ent: -2.927 str: 0.000 loss: -43.200]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -40.273 ent: -2.927 str: 0.000 loss: -43.200]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -51.711 ent: -2.921 str: 0.000 loss: -54.632]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -51.711 ent: -2.921 str: 0.000 loss: -54.632]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -61.923 ent: -2.913 str: 0.000 loss: -64.837]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -61.923 ent: -2.913 str: 0.000 loss: -64.837]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -72.596 ent: -2.906 str: 0.000 loss: -75.503]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.27it/s, atk: -72.596 ent: -2.906 str: 0.000 loss: -75.503]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.27it/s, atk: -77.532 ent: -2.898 str: 0.000 loss: -80.430]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -77.532 ent: -2.898 str: 0.000 loss: -80.430]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -83.370 ent: -2.908 str: 0.000 loss: -86.277]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -83.370 ent: -2.908 str: 0.000 loss: -86.277]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -89.488 ent: -2.900 str: 0.000 loss: -92.388]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -89.488 ent: -2.900 str: 0.000 loss: -92.388]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -96.119 ent: -2.891 str: 0.000 loss: -99.010]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -96.119 ent: -2.891 str: 0.000 loss: -99.010]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -106.074 ent: -2.891 str: 0.000 loss: -108.964]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.31it/s, atk: -106.074 ent: -2.891 str: 0.000 loss: -108.964]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.31it/s, atk: -112.445 ent: -2.896 str: 0.000 loss: -115.340]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.37it/s, atk: -112.445 ent: -2.896 str: 0.000 loss: -115.340]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -116.547 ent: -2.895 str: 0.000 loss: -119.442]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -116.547 ent: -2.895 str: 0.000 loss: -119.442]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -118.975 ent: -2.887 str: 0.000 loss: -121.862]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -118.975 ent: -2.887 str: 0.000 loss: -121.862]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -123.816 ent: -2.884 str: 0.000 loss: -126.700]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -123.816 ent: -2.884 str: 0.000 loss: -126.700]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.45it/s, atk: -129.427 ent: -2.882 str: 0.000 loss: -132.309]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -129.427 ent: -2.882 str: 0.000 loss: -132.309]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -133.957 ent: -2.880 str: 0.000 loss: -136.836]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.52it/s, atk: -133.957 ent: -2.880 str: 0.000 loss: -136.836]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.52it/s, atk: -137.832 ent: -2.879 str: 0.000 loss: -140.711]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -137.832 ent: -2.879 str: 0.000 loss: -140.711]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.52it/s, atk: -142.618 ent: -2.878 str: 0.000 loss: -145.495]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.52it/s, atk: -142.618 ent: -2.878 str: 0.000 loss: -145.495]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.52it/s, atk: -147.412 ent: -2.876 str: 0.000 loss: -150.288]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -147.412 ent: -2.876 str: 0.000 loss: -150.288]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -151.170 ent: -2.874 str: 0.000 loss: -154.044]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.49it/s, atk: -151.170 ent: -2.874 str: 0.000 loss: -154.044]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.49it/s, atk: -155.741 ent: -2.872 str: 0.000 loss: -158.613]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.35it/s, atk: -155.741 ent: -2.872 str: 0.000 loss: -158.613]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.35it/s, atk: -158.678 ent: -2.869 str: 0.000 loss: -161.547]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -158.678 ent: -2.869 str: 0.000 loss: -161.547]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -162.699 ent: -2.869 str: 0.000 loss: -165.569]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -162.699 ent: -2.869 str: 0.000 loss: -165.569]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -165.486 ent: -2.869 str: 0.000 loss: -168.355]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.47it/s, atk: -165.486 ent: -2.869 str: 0.000 loss: -168.355]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.47it/s, atk: -169.945 ent: -2.866 str: 0.000 loss: -172.811]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.43it/s, atk: -169.945 ent: -2.866 str: 0.000 loss: -172.811]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -169.945 ent: -2.866 str: 0.000 loss: -172.811]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([356], device='cuda:0') tensor(0.9996, device='cuda:0')
after_true: tensor([360], device='cuda:0') tensor(2.7930e-08, device='cuda:0')
L1: [2160.4392]	L2: [14.531753]	Linf: [0.4509804]

Accuracy on benign examples: 100.0%
gt_label: 79 pred_label: 79 pred_clean_logit 0.9998637437820435
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.35it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.76it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.25it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.16it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.90it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.67it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.14it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.59it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.46s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3391
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.492 ent: -4.940 str: 0.000 loss: -5.432]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -0.492 ent: -4.940 str: 0.000 loss: -5.432]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -7.011 ent: -4.924 str: 0.000 loss: -11.935]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.31s/it, atk: -7.011 ent: -4.924 str: 0.000 loss: -11.935]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.31s/it, atk: -8.300 ent: -4.944 str: 0.000 loss: -13.243]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.13s/it, atk: -8.300 ent: -4.944 str: 0.000 loss: -13.243]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.13s/it, atk: -52.490 ent: -4.945 str: 0.000 loss: -57.435]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -52.490 ent: -4.945 str: 0.000 loss: -57.435]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -44.227 ent: -4.929 str: 0.000 loss: -49.156]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -44.227 ent: -4.929 str: 0.000 loss: -49.156]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.29it/s, atk: -80.732 ent: -4.932 str: 0.000 loss: -85.664]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -80.732 ent: -4.932 str: 0.000 loss: -85.664]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -105.221 ent: -4.941 str: 0.000 loss: -110.162]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -105.221 ent: -4.941 str: 0.000 loss: -110.162]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -114.601 ent: -4.940 str: 0.000 loss: -119.540]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.45it/s, atk: -114.601 ent: -4.940 str: 0.000 loss: -119.540]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.45it/s, atk: -127.355 ent: -4.939 str: 0.000 loss: -132.293]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -127.355 ent: -4.939 str: 0.000 loss: -132.293]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -133.888 ent: -4.934 str: 0.000 loss: -138.822]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -133.888 ent: -4.934 str: 0.000 loss: -138.822]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -136.812 ent: -4.930 str: 0.000 loss: -141.743]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.48it/s, atk: -136.812 ent: -4.930 str: 0.000 loss: -141.743]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -144.177 ent: -4.930 str: 0.000 loss: -149.107]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.57it/s, atk: -144.177 ent: -4.930 str: 0.000 loss: -149.107]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.57it/s, atk: -159.213 ent: -4.929 str: 0.000 loss: -164.142]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.59it/s, atk: -159.213 ent: -4.929 str: 0.000 loss: -164.142]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.59it/s, atk: -159.955 ent: -4.929 str: 0.000 loss: -164.883]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -159.955 ent: -4.929 str: 0.000 loss: -164.883]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -169.489 ent: -4.928 str: 0.000 loss: -174.417]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.46it/s, atk: -169.489 ent: -4.928 str: 0.000 loss: -174.417]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.46it/s, atk: -177.226 ent: -4.926 str: 0.000 loss: -182.153]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -177.226 ent: -4.926 str: 0.000 loss: -182.153]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -183.058 ent: -4.924 str: 0.000 loss: -187.982]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.52it/s, atk: -183.058 ent: -4.924 str: 0.000 loss: -187.982]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.52it/s, atk: -180.996 ent: -4.920 str: 0.000 loss: -185.916]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.50it/s, atk: -180.996 ent: -4.920 str: 0.000 loss: -185.916]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.50it/s, atk: -185.892 ent: -4.915 str: 0.000 loss: -190.806]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.59it/s, atk: -185.892 ent: -4.915 str: 0.000 loss: -190.806]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.59it/s, atk: -188.495 ent: -4.910 str: 0.000 loss: -193.405]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.57it/s, atk: -188.495 ent: -4.910 str: 0.000 loss: -193.405]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.57it/s, atk: -192.472 ent: -4.907 str: 0.000 loss: -197.378]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.35it/s, atk: -192.472 ent: -4.907 str: 0.000 loss: -197.378]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.35it/s, atk: -197.051 ent: -4.901 str: 0.000 loss: -201.952]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.39it/s, atk: -197.051 ent: -4.901 str: 0.000 loss: -201.952]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.39it/s, atk: -195.110 ent: -4.898 str: 0.000 loss: -200.008]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -195.110 ent: -4.898 str: 0.000 loss: -200.008]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -198.659 ent: -4.899 str: 0.000 loss: -203.558]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.48it/s, atk: -198.659 ent: -4.899 str: 0.000 loss: -203.558]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.48it/s, atk: -202.023 ent: -4.900 str: 0.000 loss: -206.923]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -202.023 ent: -4.900 str: 0.000 loss: -206.923]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -201.162 ent: -4.903 str: 0.000 loss: -206.065]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.50it/s, atk: -201.162 ent: -4.903 str: 0.000 loss: -206.065]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.50it/s, atk: -203.714 ent: -4.902 str: 0.000 loss: -208.616]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.46it/s, atk: -203.714 ent: -4.902 str: 0.000 loss: -208.616]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -206.787 ent: -4.901 str: 0.000 loss: -211.688]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -206.787 ent: -4.901 str: 0.000 loss: -211.688]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -211.852 ent: -4.900 str: 0.000 loss: -216.752]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.34it/s, atk: -211.852 ent: -4.900 str: 0.000 loss: -216.752]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.34it/s, atk: -216.595 ent: -4.900 str: 0.000 loss: -221.495]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.44it/s, atk: -216.595 ent: -4.900 str: 0.000 loss: -221.495]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -216.595 ent: -4.900 str: 0.000 loss: -221.495]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([45], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([79], device='cuda:0') tensor(2.6568e-10, device='cuda:0')
L1: [4975.361]	L2: [29.79111]	Linf: [0.7176471]

Accuracy on benign examples: 100.0%
gt_label: 649 pred_label: 649 pred_clean_logit 0.48024624586105347
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.08it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.72it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.74it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.06it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.22it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 20.03it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.01it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.91it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.08it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.03s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.62s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.52s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5949
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -9.295 ent: -4.989 str: 0.000 loss: -14.285]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.45s/it, atk: -9.295 ent: -4.989 str: 0.000 loss: -14.285]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.45s/it, atk: -19.972 ent: -4.957 str: 0.000 loss: -24.929]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.49s/it, atk: -19.972 ent: -4.957 str: 0.000 loss: -24.929]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.49s/it, atk: -28.902 ent: -4.952 str: 0.000 loss: -33.854]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -28.902 ent: -4.952 str: 0.000 loss: -33.854]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -50.354 ent: -4.951 str: 0.000 loss: -55.305]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -50.354 ent: -4.951 str: 0.000 loss: -55.305]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -67.366 ent: -4.953 str: 0.000 loss: -72.319]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -67.366 ent: -4.953 str: 0.000 loss: -72.319]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -83.520 ent: -4.952 str: 0.000 loss: -88.472]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -83.520 ent: -4.952 str: 0.000 loss: -88.472]Iterations:  20%|██        | 6/30 [00:06<00:17,  1.38it/s, atk: -98.745 ent: -4.950 str: 0.000 loss: -103.695]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -98.745 ent: -4.950 str: 0.000 loss: -103.695]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -114.495 ent: -4.949 str: 0.000 loss: -119.444]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -114.495 ent: -4.949 str: 0.000 loss: -119.444]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -126.600 ent: -4.950 str: 0.000 loss: -131.550]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -126.600 ent: -4.950 str: 0.000 loss: -131.550]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -139.017 ent: -4.949 str: 0.000 loss: -143.967]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -139.017 ent: -4.949 str: 0.000 loss: -143.967]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.43it/s, atk: -149.302 ent: -4.949 str: 0.000 loss: -154.251]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -149.302 ent: -4.949 str: 0.000 loss: -154.251]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -156.932 ent: -4.949 str: 0.000 loss: -161.881]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.46it/s, atk: -156.932 ent: -4.949 str: 0.000 loss: -161.881]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -165.816 ent: -4.949 str: 0.000 loss: -170.765]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -165.816 ent: -4.949 str: 0.000 loss: -170.765]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -173.321 ent: -4.950 str: 0.000 loss: -178.271]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -173.321 ent: -4.950 str: 0.000 loss: -178.271]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -180.718 ent: -4.952 str: 0.000 loss: -185.670]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -180.718 ent: -4.952 str: 0.000 loss: -185.670]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.55it/s, atk: -188.294 ent: -4.953 str: 0.000 loss: -193.247]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.60it/s, atk: -188.294 ent: -4.953 str: 0.000 loss: -193.247]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.60it/s, atk: -194.530 ent: -4.954 str: 0.000 loss: -199.484]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.63it/s, atk: -194.530 ent: -4.954 str: 0.000 loss: -199.484]Iterations:  57%|█████▋    | 17/30 [00:13<00:07,  1.63it/s, atk: -201.296 ent: -4.954 str: 0.000 loss: -206.250]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.51it/s, atk: -201.296 ent: -4.954 str: 0.000 loss: -206.250]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.51it/s, atk: -210.612 ent: -4.955 str: 0.000 loss: -215.567]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -210.612 ent: -4.955 str: 0.000 loss: -215.567]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -217.678 ent: -4.955 str: 0.000 loss: -222.634]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.51it/s, atk: -217.678 ent: -4.955 str: 0.000 loss: -222.634]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.51it/s, atk: -224.703 ent: -4.955 str: 0.000 loss: -229.658]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -224.703 ent: -4.955 str: 0.000 loss: -229.658]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -230.160 ent: -4.955 str: 0.000 loss: -235.115]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -230.160 ent: -4.955 str: 0.000 loss: -235.115]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -236.433 ent: -4.955 str: 0.000 loss: -241.388]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -236.433 ent: -4.955 str: 0.000 loss: -241.388]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -242.175 ent: -4.956 str: 0.000 loss: -247.131]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.52it/s, atk: -242.175 ent: -4.956 str: 0.000 loss: -247.131]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.52it/s, atk: -247.575 ent: -4.955 str: 0.000 loss: -252.530]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.44it/s, atk: -247.575 ent: -4.955 str: 0.000 loss: -252.530]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.44it/s, atk: -254.541 ent: -4.954 str: 0.000 loss: -259.495]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -254.541 ent: -4.954 str: 0.000 loss: -259.495]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -261.389 ent: -4.953 str: 0.000 loss: -266.342]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.38it/s, atk: -261.389 ent: -4.953 str: 0.000 loss: -266.342]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.38it/s, atk: -265.663 ent: -4.952 str: 0.000 loss: -270.615]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -265.663 ent: -4.952 str: 0.000 loss: -270.615]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -271.601 ent: -4.952 str: 0.000 loss: -276.553]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -271.601 ent: -4.952 str: 0.000 loss: -276.553]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -276.758 ent: -4.952 str: 0.000 loss: -281.710]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -276.758 ent: -4.952 str: 0.000 loss: -281.710]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -276.758 ent: -4.952 str: 0.000 loss: -281.710]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([701], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([649], device='cuda:0') tensor(5.3350e-13, device='cuda:0')
L1: [2840.588]	L2: [19.470575]	Linf: [0.7411765]

Accuracy on benign examples: 100.0%
gt_label: 442 pred_label: 442 pred_clean_logit 0.5207568407058716
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.83it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 21.67it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.90it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.79it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.91it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 15.30it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.23it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.37it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.19it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3141
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -11.129 ent: -5.106 str: 0.000 loss: -16.235]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.58s/it, atk: -11.129 ent: -5.106 str: 0.000 loss: -16.235]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.58s/it, atk: -18.840 ent: -5.097 str: 0.000 loss: -23.937]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -18.840 ent: -5.097 str: 0.000 loss: -23.937]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -28.292 ent: -5.093 str: 0.000 loss: -33.385]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -28.292 ent: -5.093 str: 0.000 loss: -33.385]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.07s/it, atk: -38.061 ent: -5.089 str: 0.000 loss: -43.149]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -38.061 ent: -5.089 str: 0.000 loss: -43.149]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -45.247 ent: -5.094 str: 0.000 loss: -50.341]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -45.247 ent: -5.094 str: 0.000 loss: -50.341]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -53.426 ent: -5.085 str: 0.000 loss: -58.511]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.32it/s, atk: -53.426 ent: -5.085 str: 0.000 loss: -58.511]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.32it/s, atk: -60.956 ent: -5.084 str: 0.000 loss: -66.040]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.44it/s, atk: -60.956 ent: -5.084 str: 0.000 loss: -66.040]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.44it/s, atk: -67.459 ent: -5.083 str: 0.000 loss: -72.542]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.49it/s, atk: -67.459 ent: -5.083 str: 0.000 loss: -72.542]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.49it/s, atk: -73.261 ent: -5.081 str: 0.000 loss: -78.342]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.56it/s, atk: -73.261 ent: -5.081 str: 0.000 loss: -78.342]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.56it/s, atk: -78.903 ent: -5.080 str: 0.000 loss: -83.983]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -78.903 ent: -5.080 str: 0.000 loss: -83.983]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -83.475 ent: -5.077 str: 0.000 loss: -88.552]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.59it/s, atk: -83.475 ent: -5.077 str: 0.000 loss: -88.552]Iterations:  37%|███▋      | 11/30 [00:09<00:11,  1.59it/s, atk: -88.425 ent: -5.074 str: 0.000 loss: -93.499]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -88.425 ent: -5.074 str: 0.000 loss: -93.499]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -93.525 ent: -5.071 str: 0.000 loss: -98.596]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.53it/s, atk: -93.525 ent: -5.071 str: 0.000 loss: -98.596]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.53it/s, atk: -98.205 ent: -5.068 str: 0.000 loss: -103.273]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -98.205 ent: -5.068 str: 0.000 loss: -103.273]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -103.030 ent: -5.065 str: 0.000 loss: -108.095]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.45it/s, atk: -103.030 ent: -5.065 str: 0.000 loss: -108.095]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -107.515 ent: -5.069 str: 0.000 loss: -112.585]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -107.515 ent: -5.069 str: 0.000 loss: -112.585]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -111.465 ent: -5.070 str: 0.000 loss: -116.534]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -111.465 ent: -5.070 str: 0.000 loss: -116.534]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -115.815 ent: -5.068 str: 0.000 loss: -120.883]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.51it/s, atk: -115.815 ent: -5.068 str: 0.000 loss: -120.883]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.51it/s, atk: -120.120 ent: -5.064 str: 0.000 loss: -125.185]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.52it/s, atk: -120.120 ent: -5.064 str: 0.000 loss: -125.185]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.52it/s, atk: -124.602 ent: -5.062 str: 0.000 loss: -129.664]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -124.602 ent: -5.062 str: 0.000 loss: -129.664]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -128.277 ent: -5.060 str: 0.000 loss: -133.338]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.50it/s, atk: -128.277 ent: -5.060 str: 0.000 loss: -133.338]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.50it/s, atk: -132.619 ent: -5.059 str: 0.000 loss: -137.678]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -132.619 ent: -5.059 str: 0.000 loss: -137.678]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -137.559 ent: -5.059 str: 0.000 loss: -142.618]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.51it/s, atk: -137.559 ent: -5.059 str: 0.000 loss: -142.618]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.51it/s, atk: -141.542 ent: -5.058 str: 0.000 loss: -146.600]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -141.542 ent: -5.058 str: 0.000 loss: -146.600]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -145.116 ent: -5.059 str: 0.000 loss: -150.174]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.48it/s, atk: -145.116 ent: -5.059 str: 0.000 loss: -150.174]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.48it/s, atk: -149.021 ent: -5.059 str: 0.000 loss: -154.080]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.51it/s, atk: -149.021 ent: -5.059 str: 0.000 loss: -154.080]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.51it/s, atk: -152.947 ent: -5.058 str: 0.000 loss: -158.005]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.49it/s, atk: -152.947 ent: -5.058 str: 0.000 loss: -158.005]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -156.778 ent: -5.056 str: 0.000 loss: -161.835]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -156.778 ent: -5.056 str: 0.000 loss: -161.835]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -160.590 ent: -5.055 str: 0.000 loss: -165.645]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -160.590 ent: -5.055 str: 0.000 loss: -165.645]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -164.186 ent: -5.054 str: 0.000 loss: -169.240]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -164.186 ent: -5.054 str: 0.000 loss: -169.240]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -164.186 ent: -5.054 str: 0.000 loss: -169.240]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([557], device='cuda:0') tensor(0.7213, device='cuda:0')
after_true: tensor([442], device='cuda:0') tensor(4.9741e-08, device='cuda:0')
L1: [2419.5137]	L2: [18.570658]	Linf: [0.78431374]

Accuracy on benign examples: 100.0%
gt_label: 107 pred_label: 107 pred_clean_logit 0.9995262622833252
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.40it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.28it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.26it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.79it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.90it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.62it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.95it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.06it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.79s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4058
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.002 ent: -2.600 str: 0.000 loss: -2.602]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.72s/it, atk: -0.002 ent: -2.600 str: 0.000 loss: -2.602]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.72s/it, atk: -0.016 ent: -2.637 str: 0.000 loss: -2.653]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.50s/it, atk: -0.016 ent: -2.637 str: 0.000 loss: -2.653]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.50s/it, atk: -0.088 ent: -2.661 str: 0.000 loss: -2.749]Iterations:  10%|█         | 3/30 [00:04<00:36,  1.36s/it, atk: -0.088 ent: -2.661 str: 0.000 loss: -2.749]Iterations:  10%|█         | 3/30 [00:04<00:36,  1.36s/it, atk: -0.483 ent: -2.666 str: 0.000 loss: -3.149]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.05s/it, atk: -0.483 ent: -2.666 str: 0.000 loss: -3.149]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.05s/it, atk: -1.573 ent: -2.663 str: 0.000 loss: -4.236]Iterations:  17%|█▋        | 5/30 [00:05<00:23,  1.06it/s, atk: -1.573 ent: -2.663 str: 0.000 loss: -4.236]Iterations:  17%|█▋        | 5/30 [00:06<00:23,  1.06it/s, atk: -5.151 ent: -2.663 str: 0.000 loss: -7.813]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.16it/s, atk: -5.151 ent: -2.663 str: 0.000 loss: -7.813]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.16it/s, atk: -7.943 ent: -2.660 str: 0.000 loss: -10.603]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -7.943 ent: -2.660 str: 0.000 loss: -10.603]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -18.066 ent: -2.654 str: 0.000 loss: -20.720]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -18.066 ent: -2.654 str: 0.000 loss: -20.720]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.32it/s, atk: -23.590 ent: -2.646 str: 0.000 loss: -26.236]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -23.590 ent: -2.646 str: 0.000 loss: -26.236]Iterations:  30%|███       | 9/30 [00:09<00:15,  1.35it/s, atk: -30.275 ent: -2.644 str: 0.000 loss: -32.919]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.43it/s, atk: -30.275 ent: -2.644 str: 0.000 loss: -32.919]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.43it/s, atk: -40.842 ent: -2.646 str: 0.000 loss: -43.488]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.45it/s, atk: -40.842 ent: -2.646 str: 0.000 loss: -43.488]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.45it/s, atk: -50.448 ent: -2.645 str: 0.000 loss: -53.093]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -50.448 ent: -2.645 str: 0.000 loss: -53.093]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -60.821 ent: -2.642 str: 0.000 loss: -63.462]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.48it/s, atk: -60.821 ent: -2.642 str: 0.000 loss: -63.462]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.48it/s, atk: -68.190 ent: -2.639 str: 0.000 loss: -70.830]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -68.190 ent: -2.639 str: 0.000 loss: -70.830]Iterations:  47%|████▋     | 14/30 [00:12<00:10,  1.46it/s, atk: -77.339 ent: -2.640 str: 0.000 loss: -79.978]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.46it/s, atk: -77.339 ent: -2.640 str: 0.000 loss: -79.978]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.46it/s, atk: -85.550 ent: -2.640 str: 0.000 loss: -88.190]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.47it/s, atk: -85.550 ent: -2.640 str: 0.000 loss: -88.190]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.47it/s, atk: -92.342 ent: -2.640 str: 0.000 loss: -94.982]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -92.342 ent: -2.640 str: 0.000 loss: -94.982]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.47it/s, atk: -98.991 ent: -2.642 str: 0.000 loss: -101.633]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.56it/s, atk: -98.991 ent: -2.642 str: 0.000 loss: -101.633]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.56it/s, atk: -108.879 ent: -2.641 str: 0.000 loss: -111.520]Iterations:  63%|██████▎   | 19/30 [00:15<00:06,  1.57it/s, atk: -108.879 ent: -2.641 str: 0.000 loss: -111.520]Iterations:  63%|██████▎   | 19/30 [00:15<00:06,  1.57it/s, atk: -117.196 ent: -2.639 str: 0.000 loss: -119.835]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.53it/s, atk: -117.196 ent: -2.639 str: 0.000 loss: -119.835]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.53it/s, atk: -125.042 ent: -2.638 str: 0.000 loss: -127.680]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -125.042 ent: -2.638 str: 0.000 loss: -127.680]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -132.734 ent: -2.639 str: 0.000 loss: -135.373]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -132.734 ent: -2.639 str: 0.000 loss: -135.373]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -140.094 ent: -2.641 str: 0.000 loss: -142.735]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.57it/s, atk: -140.094 ent: -2.641 str: 0.000 loss: -142.735]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.57it/s, atk: -147.623 ent: -2.641 str: 0.000 loss: -150.264]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -147.623 ent: -2.641 str: 0.000 loss: -150.264]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -153.780 ent: -2.641 str: 0.000 loss: -156.421]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -153.780 ent: -2.641 str: 0.000 loss: -156.421]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -160.162 ent: -2.642 str: 0.000 loss: -162.804]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -160.162 ent: -2.642 str: 0.000 loss: -162.804]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.45it/s, atk: -166.068 ent: -2.642 str: 0.000 loss: -168.709]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -166.068 ent: -2.642 str: 0.000 loss: -168.709]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -171.691 ent: -2.641 str: 0.000 loss: -174.331]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -171.691 ent: -2.641 str: 0.000 loss: -174.331]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -178.666 ent: -2.640 str: 0.000 loss: -181.306]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.48it/s, atk: -178.666 ent: -2.640 str: 0.000 loss: -181.306]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.48it/s, atk: -185.282 ent: -2.640 str: 0.000 loss: -187.922]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.51it/s, atk: -185.282 ent: -2.640 str: 0.000 loss: -187.922]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -185.282 ent: -2.640 str: 0.000 loss: -187.922]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([552], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([107], device='cuda:0') tensor(5.3797e-09, device='cuda:0')
L1: [2112.1375]	L2: [15.263979]	Linf: [0.7647059]

Accuracy on benign examples: 0.0%
gt_label: 637 pred_label: 549 pred_clean_logit 0.019351622089743614
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.75it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.62it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.03it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.77it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.02it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.10it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.84it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.73s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.64s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4738
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -48.484 ent: -2.579 str: 0.000 loss: -51.062]Iterations:   3%|▎         | 1/30 [00:01<00:57,  1.98s/it, atk: -48.484 ent: -2.579 str: 0.000 loss: -51.062]Iterations:   3%|▎         | 1/30 [00:02<00:57,  1.98s/it, atk: -55.589 ent: -2.575 str: 0.000 loss: -58.164]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.19s/it, atk: -55.589 ent: -2.575 str: 0.000 loss: -58.164]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.19s/it, atk: -62.553 ent: -2.571 str: 0.000 loss: -65.125]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.04it/s, atk: -62.553 ent: -2.571 str: 0.000 loss: -65.125]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.04it/s, atk: -69.420 ent: -2.573 str: 0.000 loss: -71.994]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -69.420 ent: -2.573 str: 0.000 loss: -71.994]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -76.438 ent: -2.571 str: 0.000 loss: -79.010]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.30it/s, atk: -76.438 ent: -2.571 str: 0.000 loss: -79.010]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.30it/s, atk: -80.555 ent: -2.573 str: 0.000 loss: -83.128]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.41it/s, atk: -80.555 ent: -2.573 str: 0.000 loss: -83.128]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.41it/s, atk: -83.845 ent: -2.571 str: 0.000 loss: -86.416]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.44it/s, atk: -83.845 ent: -2.571 str: 0.000 loss: -86.416]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.44it/s, atk: -89.489 ent: -2.573 str: 0.000 loss: -92.062]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -89.489 ent: -2.573 str: 0.000 loss: -92.062]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -95.447 ent: -2.574 str: 0.000 loss: -98.022]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -95.447 ent: -2.574 str: 0.000 loss: -98.022]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -101.833 ent: -2.575 str: 0.000 loss: -104.408]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.50it/s, atk: -101.833 ent: -2.575 str: 0.000 loss: -104.408]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.50it/s, atk: -105.817 ent: -2.575 str: 0.000 loss: -108.392]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.52it/s, atk: -105.817 ent: -2.575 str: 0.000 loss: -108.392]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.52it/s, atk: -108.417 ent: -2.575 str: 0.000 loss: -110.992]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.50it/s, atk: -108.417 ent: -2.575 str: 0.000 loss: -110.992]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.50it/s, atk: -111.969 ent: -2.575 str: 0.000 loss: -114.544]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.50it/s, atk: -111.969 ent: -2.575 str: 0.000 loss: -114.544]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -115.710 ent: -2.574 str: 0.000 loss: -118.284]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -115.710 ent: -2.574 str: 0.000 loss: -118.284]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -118.766 ent: -2.572 str: 0.000 loss: -121.338]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -118.766 ent: -2.572 str: 0.000 loss: -121.338]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -121.675 ent: -2.571 str: 0.000 loss: -124.246]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.45it/s, atk: -121.675 ent: -2.571 str: 0.000 loss: -124.246]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -124.760 ent: -2.570 str: 0.000 loss: -127.329]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.49it/s, atk: -124.760 ent: -2.570 str: 0.000 loss: -127.329]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.49it/s, atk: -127.271 ent: -2.569 str: 0.000 loss: -129.840]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -127.271 ent: -2.569 str: 0.000 loss: -129.840]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -127.691 ent: -2.571 str: 0.000 loss: -130.261]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.47it/s, atk: -127.691 ent: -2.571 str: 0.000 loss: -130.261]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -128.937 ent: -2.571 str: 0.000 loss: -131.508]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.38it/s, atk: -128.937 ent: -2.571 str: 0.000 loss: -131.508]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -131.474 ent: -2.571 str: 0.000 loss: -134.045]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -131.474 ent: -2.571 str: 0.000 loss: -134.045]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -134.129 ent: -2.571 str: 0.000 loss: -136.700]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -134.129 ent: -2.571 str: 0.000 loss: -136.700]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -135.435 ent: -2.571 str: 0.000 loss: -138.006]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -135.435 ent: -2.571 str: 0.000 loss: -138.006]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -137.370 ent: -2.571 str: 0.000 loss: -139.942]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.48it/s, atk: -137.370 ent: -2.571 str: 0.000 loss: -139.942]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.48it/s, atk: -139.666 ent: -2.571 str: 0.000 loss: -142.237]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -139.666 ent: -2.571 str: 0.000 loss: -142.237]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -142.274 ent: -2.571 str: 0.000 loss: -144.845]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.49it/s, atk: -142.274 ent: -2.571 str: 0.000 loss: -144.845]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -145.621 ent: -2.571 str: 0.000 loss: -148.192]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -145.621 ent: -2.571 str: 0.000 loss: -148.192]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -148.008 ent: -2.571 str: 0.000 loss: -150.579]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.48it/s, atk: -148.008 ent: -2.571 str: 0.000 loss: -150.579]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.48it/s, atk: -150.583 ent: -2.570 str: 0.000 loss: -153.153]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.52it/s, atk: -150.583 ent: -2.570 str: 0.000 loss: -153.153]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.52it/s, atk: -153.179 ent: -2.570 str: 0.000 loss: -155.749]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.49it/s, atk: -153.179 ent: -2.570 str: 0.000 loss: -155.749]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -153.179 ent: -2.570 str: 0.000 loss: -155.749]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([549], device='cuda:0') tensor(0.9976, device='cuda:0')
after_true: tensor([637], device='cuda:0') tensor(1.8437e-07, device='cuda:0')
L1: [3013.0115]	L2: [21.741774]	Linf: [0.7294118]

Accuracy on benign examples: 100.0%
gt_label: 970 pred_label: 970 pred_clean_logit 0.938910961151123
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.61it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.99it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.07it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.33it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 20.24it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.70it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.96it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.88it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.33s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.44s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.49s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.59s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5254
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.731 ent: -2.540 str: 0.000 loss: -3.272]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.96s/it, atk: -0.731 ent: -2.540 str: 0.000 loss: -3.272]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.96s/it, atk: -1.636 ent: -2.542 str: 0.000 loss: -4.178]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.21s/it, atk: -1.636 ent: -2.542 str: 0.000 loss: -4.178]Iterations:   7%|▋         | 2/30 [00:03<00:33,  1.21s/it, atk: -2.326 ent: -2.541 str: 0.000 loss: -4.867]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -2.326 ent: -2.541 str: 0.000 loss: -4.867]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -3.739 ent: -2.542 str: 0.000 loss: -6.281]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -3.739 ent: -2.542 str: 0.000 loss: -6.281]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -5.518 ent: -2.542 str: 0.000 loss: -8.060]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.26it/s, atk: -5.518 ent: -2.542 str: 0.000 loss: -8.060]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -8.113 ent: -2.542 str: 0.000 loss: -10.655]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -8.113 ent: -2.542 str: 0.000 loss: -10.655]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -11.196 ent: -2.540 str: 0.000 loss: -13.737]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -11.196 ent: -2.540 str: 0.000 loss: -13.737]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -17.411 ent: -2.541 str: 0.000 loss: -19.952]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.40it/s, atk: -17.411 ent: -2.541 str: 0.000 loss: -19.952]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -23.507 ent: -2.540 str: 0.000 loss: -26.048]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -23.507 ent: -2.540 str: 0.000 loss: -26.048]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -28.970 ent: -2.541 str: 0.000 loss: -31.510]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -28.970 ent: -2.541 str: 0.000 loss: -31.510]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -37.799 ent: -2.539 str: 0.000 loss: -40.338]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -37.799 ent: -2.539 str: 0.000 loss: -40.338]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -45.264 ent: -2.538 str: 0.000 loss: -47.802]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.43it/s, atk: -45.264 ent: -2.538 str: 0.000 loss: -47.802]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.43it/s, atk: -52.082 ent: -2.537 str: 0.000 loss: -54.619]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -52.082 ent: -2.537 str: 0.000 loss: -54.619]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -61.539 ent: -2.536 str: 0.000 loss: -64.076]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -61.539 ent: -2.536 str: 0.000 loss: -64.076]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -69.459 ent: -2.536 str: 0.000 loss: -71.995]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -69.459 ent: -2.536 str: 0.000 loss: -71.995]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -75.560 ent: -2.537 str: 0.000 loss: -78.097]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -75.560 ent: -2.537 str: 0.000 loss: -78.097]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -85.607 ent: -2.538 str: 0.000 loss: -88.144]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -85.607 ent: -2.538 str: 0.000 loss: -88.144]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -92.539 ent: -2.538 str: 0.000 loss: -95.077]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.44it/s, atk: -92.539 ent: -2.538 str: 0.000 loss: -95.077]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -100.192 ent: -2.538 str: 0.000 loss: -102.730]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.46it/s, atk: -100.192 ent: -2.538 str: 0.000 loss: -102.730]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.46it/s, atk: -108.382 ent: -2.537 str: 0.000 loss: -110.919]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.50it/s, atk: -108.382 ent: -2.537 str: 0.000 loss: -110.919]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.50it/s, atk: -119.566 ent: -2.536 str: 0.000 loss: -122.103]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.59it/s, atk: -119.566 ent: -2.536 str: 0.000 loss: -122.103]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.59it/s, atk: -125.937 ent: -2.536 str: 0.000 loss: -128.473]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -125.937 ent: -2.536 str: 0.000 loss: -128.473]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -135.579 ent: -2.536 str: 0.000 loss: -138.115]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -135.579 ent: -2.536 str: 0.000 loss: -138.115]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -144.219 ent: -2.536 str: 0.000 loss: -146.754]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.43it/s, atk: -144.219 ent: -2.536 str: 0.000 loss: -146.754]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -150.887 ent: -2.536 str: 0.000 loss: -153.423]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.52it/s, atk: -150.887 ent: -2.536 str: 0.000 loss: -153.423]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.52it/s, atk: -155.448 ent: -2.537 str: 0.000 loss: -157.985]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.51it/s, atk: -155.448 ent: -2.537 str: 0.000 loss: -157.985]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.51it/s, atk: -163.876 ent: -2.536 str: 0.000 loss: -166.412]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.37it/s, atk: -163.876 ent: -2.536 str: 0.000 loss: -166.412]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -170.061 ent: -2.535 str: 0.000 loss: -172.596]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -170.061 ent: -2.535 str: 0.000 loss: -172.596]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -177.165 ent: -2.535 str: 0.000 loss: -179.699]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.20it/s, atk: -177.165 ent: -2.535 str: 0.000 loss: -179.699]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.20it/s, atk: -182.518 ent: -2.534 str: 0.000 loss: -185.053]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.28it/s, atk: -182.518 ent: -2.534 str: 0.000 loss: -185.053]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -182.518 ent: -2.534 str: 0.000 loss: -185.053]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([980], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([970], device='cuda:0') tensor(7.1140e-09, device='cuda:0')
L1: [2397.6038]	L2: [16.342348]	Linf: [0.60784316]

Accuracy on benign examples: 100.0%
gt_label: 785 pred_label: 785 pred_clean_logit 0.9525787830352783
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.30it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 21.91it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 23.80it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 23.65it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 24.11it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.48it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.39it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.12s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.64s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3952
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.579 ent: -4.975 str: 0.000 loss: -5.554]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.00s/it, atk: -0.579 ent: -4.975 str: 0.000 loss: -5.554]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.00s/it, atk: -1.408 ent: -4.976 str: 0.000 loss: -6.383]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.31s/it, atk: -1.408 ent: -4.976 str: 0.000 loss: -6.383]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.31s/it, atk: -4.197 ent: -4.978 str: 0.000 loss: -9.175]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -4.197 ent: -4.978 str: 0.000 loss: -9.175]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -9.436 ent: -4.977 str: 0.000 loss: -14.413]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -9.436 ent: -4.977 str: 0.000 loss: -14.413]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -17.049 ent: -4.975 str: 0.000 loss: -22.024]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -17.049 ent: -4.975 str: 0.000 loss: -22.024]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -24.206 ent: -4.972 str: 0.000 loss: -29.178]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.22it/s, atk: -24.206 ent: -4.972 str: 0.000 loss: -29.178]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -31.506 ent: -4.972 str: 0.000 loss: -36.477]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -31.506 ent: -4.972 str: 0.000 loss: -36.477]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -38.428 ent: -4.973 str: 0.000 loss: -43.400]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.24it/s, atk: -38.428 ent: -4.973 str: 0.000 loss: -43.400]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.24it/s, atk: -45.112 ent: -4.973 str: 0.000 loss: -50.086]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -45.112 ent: -4.973 str: 0.000 loss: -50.086]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -50.756 ent: -4.972 str: 0.000 loss: -55.728]Iterations:  33%|███▎      | 10/30 [00:08<00:16,  1.25it/s, atk: -50.756 ent: -4.972 str: 0.000 loss: -55.728]Iterations:  33%|███▎      | 10/30 [00:09<00:16,  1.25it/s, atk: -52.110 ent: -4.964 str: 0.000 loss: -57.075]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -52.110 ent: -4.964 str: 0.000 loss: -57.075]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -58.274 ent: -4.968 str: 0.000 loss: -63.242]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -58.274 ent: -4.968 str: 0.000 loss: -63.242]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -60.917 ent: -4.969 str: 0.000 loss: -65.886]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -60.917 ent: -4.969 str: 0.000 loss: -65.886]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -63.760 ent: -4.968 str: 0.000 loss: -68.728]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -63.760 ent: -4.968 str: 0.000 loss: -68.728]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.33it/s, atk: -69.602 ent: -4.965 str: 0.000 loss: -74.567]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -69.602 ent: -4.965 str: 0.000 loss: -74.567]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -71.328 ent: -4.960 str: 0.000 loss: -76.288]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -71.328 ent: -4.960 str: 0.000 loss: -76.288]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -74.040 ent: -4.957 str: 0.000 loss: -78.996]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -74.040 ent: -4.957 str: 0.000 loss: -78.996]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -78.802 ent: -4.955 str: 0.000 loss: -83.757]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -78.802 ent: -4.955 str: 0.000 loss: -83.757]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -83.105 ent: -4.954 str: 0.000 loss: -88.059]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.50it/s, atk: -83.105 ent: -4.954 str: 0.000 loss: -88.059]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.50it/s, atk: -87.121 ent: -4.954 str: 0.000 loss: -92.075]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -87.121 ent: -4.954 str: 0.000 loss: -92.075]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.47it/s, atk: -89.596 ent: -4.954 str: 0.000 loss: -94.550]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -89.596 ent: -4.954 str: 0.000 loss: -94.550]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.36it/s, atk: -92.111 ent: -4.953 str: 0.000 loss: -97.064]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -92.111 ent: -4.953 str: 0.000 loss: -97.064]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -95.260 ent: -4.951 str: 0.000 loss: -100.212]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -95.260 ent: -4.951 str: 0.000 loss: -100.212]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.46it/s, atk: -97.040 ent: -4.950 str: 0.000 loss: -101.990]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -97.040 ent: -4.950 str: 0.000 loss: -101.990]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -99.265 ent: -4.949 str: 0.000 loss: -104.213]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.56it/s, atk: -99.265 ent: -4.949 str: 0.000 loss: -104.213]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.56it/s, atk: -101.604 ent: -4.947 str: 0.000 loss: -106.551]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.53it/s, atk: -101.604 ent: -4.947 str: 0.000 loss: -106.551]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.53it/s, atk: -103.691 ent: -4.946 str: 0.000 loss: -108.637]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -103.691 ent: -4.946 str: 0.000 loss: -108.637]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -105.578 ent: -4.945 str: 0.000 loss: -110.523]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.53it/s, atk: -105.578 ent: -4.945 str: 0.000 loss: -110.523]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.53it/s, atk: -107.607 ent: -4.945 str: 0.000 loss: -112.552]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.54it/s, atk: -107.607 ent: -4.945 str: 0.000 loss: -112.552]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.54it/s, atk: -109.893 ent: -4.944 str: 0.000 loss: -114.837]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.50it/s, atk: -109.893 ent: -4.944 str: 0.000 loss: -114.837]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -109.893 ent: -4.944 str: 0.000 loss: -114.837]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([831], device='cuda:0') tensor(0.9771, device='cuda:0')
after_true: tensor([785], device='cuda:0') tensor(1.3624e-05, device='cuda:0')
L1: [1366.2943]	L2: [10.358862]	Linf: [0.6313726]

Accuracy on benign examples: 100.0%
gt_label: 933 pred_label: 933 pred_clean_logit 0.6640252470970154
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.52it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.98it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.30it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.42it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.23it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.05it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.47it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.90it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.35s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3987
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.860 ent: -2.775 str: 0.000 loss: -7.635]Iterations:   3%|▎         | 1/30 [00:01<00:57,  1.97s/it, atk: -4.860 ent: -2.775 str: 0.000 loss: -7.635]Iterations:   3%|▎         | 1/30 [00:02<00:57,  1.97s/it, atk: -11.602 ent: -2.754 str: 0.000 loss: -14.356]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.31s/it, atk: -11.602 ent: -2.754 str: 0.000 loss: -14.356]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.31s/it, atk: -20.682 ent: -2.755 str: 0.000 loss: -23.438]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.07s/it, atk: -20.682 ent: -2.755 str: 0.000 loss: -23.438]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.07s/it, atk: -26.919 ent: -2.750 str: 0.000 loss: -29.669]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -26.919 ent: -2.750 str: 0.000 loss: -29.669]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -37.603 ent: -2.746 str: 0.000 loss: -40.349]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.19it/s, atk: -37.603 ent: -2.746 str: 0.000 loss: -40.349]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -39.049 ent: -2.743 str: 0.000 loss: -41.791]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -39.049 ent: -2.743 str: 0.000 loss: -41.791]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -43.925 ent: -2.743 str: 0.000 loss: -46.667]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.43it/s, atk: -43.925 ent: -2.743 str: 0.000 loss: -46.667]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.43it/s, atk: -48.264 ent: -2.743 str: 0.000 loss: -51.007]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.45it/s, atk: -48.264 ent: -2.743 str: 0.000 loss: -51.007]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.45it/s, atk: -52.796 ent: -2.744 str: 0.000 loss: -55.540]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -52.796 ent: -2.744 str: 0.000 loss: -55.540]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -55.993 ent: -2.743 str: 0.000 loss: -58.736]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -55.993 ent: -2.743 str: 0.000 loss: -58.736]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -61.017 ent: -2.743 str: 0.000 loss: -63.760]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -61.017 ent: -2.743 str: 0.000 loss: -63.760]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.49it/s, atk: -65.363 ent: -2.742 str: 0.000 loss: -68.105]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -65.363 ent: -2.742 str: 0.000 loss: -68.105]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -67.568 ent: -2.742 str: 0.000 loss: -70.310]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.41it/s, atk: -67.568 ent: -2.742 str: 0.000 loss: -70.310]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.41it/s, atk: -70.538 ent: -2.742 str: 0.000 loss: -73.281]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -70.538 ent: -2.742 str: 0.000 loss: -73.281]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -73.494 ent: -2.742 str: 0.000 loss: -76.236]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.42it/s, atk: -73.494 ent: -2.742 str: 0.000 loss: -76.236]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -75.732 ent: -2.743 str: 0.000 loss: -78.474]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -75.732 ent: -2.743 str: 0.000 loss: -78.474]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -77.777 ent: -2.744 str: 0.000 loss: -80.521]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.34it/s, atk: -77.777 ent: -2.744 str: 0.000 loss: -80.521]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.34it/s, atk: -79.903 ent: -2.744 str: 0.000 loss: -82.646]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.41it/s, atk: -79.903 ent: -2.744 str: 0.000 loss: -82.646]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -81.827 ent: -2.744 str: 0.000 loss: -84.571]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -81.827 ent: -2.744 str: 0.000 loss: -84.571]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -83.833 ent: -2.744 str: 0.000 loss: -86.576]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -83.833 ent: -2.744 str: 0.000 loss: -86.576]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -86.063 ent: -2.743 str: 0.000 loss: -88.805]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.52it/s, atk: -86.063 ent: -2.743 str: 0.000 loss: -88.805]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.52it/s, atk: -88.269 ent: -2.742 str: 0.000 loss: -91.011]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -88.269 ent: -2.742 str: 0.000 loss: -91.011]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -90.253 ent: -2.741 str: 0.000 loss: -92.994]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.39it/s, atk: -90.253 ent: -2.741 str: 0.000 loss: -92.994]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.39it/s, atk: -92.133 ent: -2.741 str: 0.000 loss: -94.874]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -92.133 ent: -2.741 str: 0.000 loss: -94.874]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.47it/s, atk: -93.960 ent: -2.740 str: 0.000 loss: -96.700]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -93.960 ent: -2.740 str: 0.000 loss: -96.700]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -95.579 ent: -2.740 str: 0.000 loss: -98.319]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.60it/s, atk: -95.579 ent: -2.740 str: 0.000 loss: -98.319]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.60it/s, atk: -97.468 ent: -2.740 str: 0.000 loss: -100.208]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.55it/s, atk: -97.468 ent: -2.740 str: 0.000 loss: -100.208]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.55it/s, atk: -99.382 ent: -2.739 str: 0.000 loss: -102.122]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -99.382 ent: -2.739 str: 0.000 loss: -102.122]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -101.346 ent: -2.738 str: 0.000 loss: -104.084]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.56it/s, atk: -101.346 ent: -2.738 str: 0.000 loss: -104.084]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.56it/s, atk: -103.275 ent: -2.738 str: 0.000 loss: -106.013]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.52it/s, atk: -103.275 ent: -2.738 str: 0.000 loss: -106.013]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -103.275 ent: -2.738 str: 0.000 loss: -106.013]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([441], device='cuda:0') tensor(0.9451, device='cuda:0')
after_true: tensor([933], device='cuda:0') tensor(2.7582e-05, device='cuda:0')
L1: [2367.149]	L2: [16.7561]	Linf: [0.7176471]

Accuracy on benign examples: 100.0%
gt_label: 656 pred_label: 656 pred_clean_logit 0.9583325982093811
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.49it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.91it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.25it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.45it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.43it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.85it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.53it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 17.26it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.99it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.42s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.63s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5001
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.315 ent: -5.197 str: 0.000 loss: -6.512]Iterations:   3%|▎         | 1/30 [00:02<01:24,  2.90s/it, atk: -1.315 ent: -5.197 str: 0.000 loss: -6.512]Iterations:   3%|▎         | 1/30 [00:03<01:24,  2.90s/it, atk: -3.524 ent: -5.205 str: 0.000 loss: -8.730]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -3.524 ent: -5.205 str: 0.000 loss: -8.730]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -6.231 ent: -5.193 str: 0.000 loss: -11.425]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -6.231 ent: -5.193 str: 0.000 loss: -11.425]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -12.599 ent: -5.201 str: 0.000 loss: -17.800]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -12.599 ent: -5.201 str: 0.000 loss: -17.800]Iterations:  13%|█▎        | 4/30 [00:05<00:23,  1.12it/s, atk: -17.362 ent: -5.213 str: 0.000 loss: -22.575]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -17.362 ent: -5.213 str: 0.000 loss: -22.575]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -22.710 ent: -5.209 str: 0.000 loss: -27.919]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -22.710 ent: -5.209 str: 0.000 loss: -27.919]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -27.505 ent: -5.201 str: 0.000 loss: -32.706]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -27.505 ent: -5.201 str: 0.000 loss: -32.706]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.31it/s, atk: -31.030 ent: -5.193 str: 0.000 loss: -36.223]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -31.030 ent: -5.193 str: 0.000 loss: -36.223]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -33.361 ent: -5.184 str: 0.000 loss: -38.545]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -33.361 ent: -5.184 str: 0.000 loss: -38.545]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -37.097 ent: -5.188 str: 0.000 loss: -42.285]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.42it/s, atk: -37.097 ent: -5.188 str: 0.000 loss: -42.285]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.42it/s, atk: -40.269 ent: -5.189 str: 0.000 loss: -45.458]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -40.269 ent: -5.189 str: 0.000 loss: -45.458]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -43.189 ent: -5.189 str: 0.000 loss: -48.378]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -43.189 ent: -5.189 str: 0.000 loss: -48.378]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -46.020 ent: -5.186 str: 0.000 loss: -51.206]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -46.020 ent: -5.186 str: 0.000 loss: -51.206]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.48it/s, atk: -49.259 ent: -5.183 str: 0.000 loss: -54.442]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -49.259 ent: -5.183 str: 0.000 loss: -54.442]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -52.276 ent: -5.181 str: 0.000 loss: -57.456]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -52.276 ent: -5.181 str: 0.000 loss: -57.456]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -55.430 ent: -5.178 str: 0.000 loss: -60.608]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -55.430 ent: -5.178 str: 0.000 loss: -60.608]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.52it/s, atk: -59.224 ent: -5.176 str: 0.000 loss: -64.401]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.59it/s, atk: -59.224 ent: -5.176 str: 0.000 loss: -64.401]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.59it/s, atk: -62.040 ent: -5.174 str: 0.000 loss: -67.213]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.54it/s, atk: -62.040 ent: -5.174 str: 0.000 loss: -67.213]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.54it/s, atk: -64.921 ent: -5.172 str: 0.000 loss: -70.093]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.57it/s, atk: -64.921 ent: -5.172 str: 0.000 loss: -70.093]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.57it/s, atk: -68.794 ent: -5.171 str: 0.000 loss: -73.965]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.61it/s, atk: -68.794 ent: -5.171 str: 0.000 loss: -73.965]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.61it/s, atk: -71.919 ent: -5.169 str: 0.000 loss: -77.088]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.57it/s, atk: -71.919 ent: -5.169 str: 0.000 loss: -77.088]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.57it/s, atk: -75.145 ent: -5.166 str: 0.000 loss: -80.311]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -75.145 ent: -5.166 str: 0.000 loss: -80.311]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.48it/s, atk: -77.730 ent: -5.166 str: 0.000 loss: -82.895]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.40it/s, atk: -77.730 ent: -5.166 str: 0.000 loss: -82.895]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.40it/s, atk: -80.371 ent: -5.167 str: 0.000 loss: -85.538]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -80.371 ent: -5.167 str: 0.000 loss: -85.538]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -83.061 ent: -5.166 str: 0.000 loss: -88.227]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -83.061 ent: -5.166 str: 0.000 loss: -88.227]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -86.174 ent: -5.166 str: 0.000 loss: -91.340]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -86.174 ent: -5.166 str: 0.000 loss: -91.340]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -89.071 ent: -5.165 str: 0.000 loss: -94.236]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -89.071 ent: -5.165 str: 0.000 loss: -94.236]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -92.474 ent: -5.162 str: 0.000 loss: -97.636]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.52it/s, atk: -92.474 ent: -5.162 str: 0.000 loss: -97.636]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.52it/s, atk: -95.066 ent: -5.162 str: 0.000 loss: -100.228]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -95.066 ent: -5.162 str: 0.000 loss: -100.228]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -98.866 ent: -5.163 str: 0.000 loss: -104.028]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -98.866 ent: -5.163 str: 0.000 loss: -104.028]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -98.866 ent: -5.163 str: 0.000 loss: -104.028]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([704], device='cuda:0') tensor(0.8054, device='cuda:0')
after_true: tensor([656], device='cuda:0') tensor(3.8721e-05, device='cuda:0')
L1: [2854.5254]	L2: [19.755928]	Linf: [0.7764706]

Accuracy on benign examples: 0.0%
gt_label: 521 pred_label: 124 pred_clean_logit 0.013672580011188984
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.60it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.11it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.70it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.50it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.06it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.90it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.49it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.39s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.33s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.43s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5557
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -52.247 ent: -7.237 str: 0.000 loss: -59.484]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.43s/it, atk: -52.247 ent: -7.237 str: 0.000 loss: -59.484]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.43s/it, atk: -95.011 ent: -7.235 str: 0.000 loss: -102.245]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -95.011 ent: -7.235 str: 0.000 loss: -102.245]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -100.684 ent: -7.234 str: 0.000 loss: -107.919]Iterations:  10%|█         | 3/30 [00:03<00:31,  1.15s/it, atk: -100.684 ent: -7.234 str: 0.000 loss: -107.919]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -110.366 ent: -7.233 str: 0.000 loss: -117.599]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -110.366 ent: -7.233 str: 0.000 loss: -117.599]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -124.700 ent: -7.235 str: 0.000 loss: -131.935]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -124.700 ent: -7.235 str: 0.000 loss: -131.935]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -135.199 ent: -7.238 str: 0.000 loss: -142.437]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -135.199 ent: -7.238 str: 0.000 loss: -142.437]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -146.200 ent: -7.239 str: 0.000 loss: -153.440]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -146.200 ent: -7.239 str: 0.000 loss: -153.440]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.31it/s, atk: -155.276 ent: -7.240 str: 0.000 loss: -162.516]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -155.276 ent: -7.240 str: 0.000 loss: -162.516]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -163.632 ent: -7.241 str: 0.000 loss: -170.873]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -163.632 ent: -7.241 str: 0.000 loss: -170.873]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -171.790 ent: -7.242 str: 0.000 loss: -179.031]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -171.790 ent: -7.242 str: 0.000 loss: -179.031]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.44it/s, atk: -179.265 ent: -7.241 str: 0.000 loss: -186.506]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.52it/s, atk: -179.265 ent: -7.241 str: 0.000 loss: -186.506]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.52it/s, atk: -185.293 ent: -7.239 str: 0.000 loss: -192.532]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -185.293 ent: -7.239 str: 0.000 loss: -192.532]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -193.118 ent: -7.236 str: 0.000 loss: -200.354]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.51it/s, atk: -193.118 ent: -7.236 str: 0.000 loss: -200.354]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.51it/s, atk: -199.583 ent: -7.235 str: 0.000 loss: -206.818]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -199.583 ent: -7.235 str: 0.000 loss: -206.818]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.52it/s, atk: -206.473 ent: -7.233 str: 0.000 loss: -213.706]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.58it/s, atk: -206.473 ent: -7.233 str: 0.000 loss: -213.706]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.58it/s, atk: -212.894 ent: -7.232 str: 0.000 loss: -220.126]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.63it/s, atk: -212.894 ent: -7.232 str: 0.000 loss: -220.126]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.63it/s, atk: -219.850 ent: -7.231 str: 0.000 loss: -227.082]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.58it/s, atk: -219.850 ent: -7.231 str: 0.000 loss: -227.082]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.58it/s, atk: -226.137 ent: -7.231 str: 0.000 loss: -233.368]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -226.137 ent: -7.231 str: 0.000 loss: -233.368]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -232.952 ent: -7.231 str: 0.000 loss: -240.183]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.46it/s, atk: -232.952 ent: -7.231 str: 0.000 loss: -240.183]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.46it/s, atk: -239.228 ent: -7.232 str: 0.000 loss: -246.459]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -239.228 ent: -7.232 str: 0.000 loss: -246.459]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -245.225 ent: -7.232 str: 0.000 loss: -252.457]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.50it/s, atk: -245.225 ent: -7.232 str: 0.000 loss: -252.457]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.50it/s, atk: -251.193 ent: -7.233 str: 0.000 loss: -258.427]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -251.193 ent: -7.233 str: 0.000 loss: -258.427]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -256.691 ent: -7.234 str: 0.000 loss: -263.926]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.50it/s, atk: -256.691 ent: -7.234 str: 0.000 loss: -263.926]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.50it/s, atk: -262.154 ent: -7.235 str: 0.000 loss: -269.389]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -262.154 ent: -7.235 str: 0.000 loss: -269.389]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -267.110 ent: -7.236 str: 0.000 loss: -274.346]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -267.110 ent: -7.236 str: 0.000 loss: -274.346]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.47it/s, atk: -272.004 ent: -7.236 str: 0.000 loss: -279.240]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.40it/s, atk: -272.004 ent: -7.236 str: 0.000 loss: -279.240]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.40it/s, atk: -276.058 ent: -7.235 str: 0.000 loss: -283.293]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -276.058 ent: -7.235 str: 0.000 loss: -283.293]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -280.720 ent: -7.236 str: 0.000 loss: -287.956]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -280.720 ent: -7.236 str: 0.000 loss: -287.956]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -285.872 ent: -7.238 str: 0.000 loss: -293.110]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -285.872 ent: -7.238 str: 0.000 loss: -293.110]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -290.770 ent: -7.239 str: 0.000 loss: -298.009]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -290.770 ent: -7.239 str: 0.000 loss: -298.009]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -290.770 ent: -7.239 str: 0.000 loss: -298.009]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([124], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([521], device='cuda:0') tensor(1.4413e-13, device='cuda:0')
L1: [2652.255]	L2: [18.977531]	Linf: [0.8352941]

Accuracy on benign examples: 100.0%
gt_label: 510 pred_label: 510 pred_clean_logit 0.8385428190231323
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.14it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.80it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.85it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.87it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.34it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.79it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.86it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 19.00it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.49it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.63s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.61s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4506
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.813 ent: -5.320 str: 0.000 loss: -6.133]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.47s/it, atk: -0.813 ent: -5.320 str: 0.000 loss: -6.133]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.47s/it, atk: -1.222 ent: -5.289 str: 0.000 loss: -6.512]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.45s/it, atk: -1.222 ent: -5.289 str: 0.000 loss: -6.512]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.45s/it, atk: -2.037 ent: -5.284 str: 0.000 loss: -7.321]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.09s/it, atk: -2.037 ent: -5.284 str: 0.000 loss: -7.321]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.09s/it, atk: -3.432 ent: -5.276 str: 0.000 loss: -8.708]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -3.432 ent: -5.276 str: 0.000 loss: -8.708]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -5.710 ent: -5.266 str: 0.000 loss: -10.977]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -5.710 ent: -5.266 str: 0.000 loss: -10.977]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -9.651 ent: -5.262 str: 0.000 loss: -14.913]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.15it/s, atk: -9.651 ent: -5.262 str: 0.000 loss: -14.913]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.15it/s, atk: -14.544 ent: -5.256 str: 0.000 loss: -19.800]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -14.544 ent: -5.256 str: 0.000 loss: -19.800]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.30it/s, atk: -19.413 ent: -5.252 str: 0.000 loss: -24.665]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -19.413 ent: -5.252 str: 0.000 loss: -24.665]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -24.580 ent: -5.250 str: 0.000 loss: -29.830]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.39it/s, atk: -24.580 ent: -5.250 str: 0.000 loss: -29.830]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.39it/s, atk: -30.180 ent: -5.248 str: 0.000 loss: -35.427]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -30.180 ent: -5.248 str: 0.000 loss: -35.427]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.36it/s, atk: -35.791 ent: -5.246 str: 0.000 loss: -41.037]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -35.791 ent: -5.246 str: 0.000 loss: -41.037]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -40.044 ent: -5.244 str: 0.000 loss: -45.288]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -40.044 ent: -5.244 str: 0.000 loss: -45.288]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -44.805 ent: -5.245 str: 0.000 loss: -50.050]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -44.805 ent: -5.245 str: 0.000 loss: -50.050]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -50.615 ent: -5.247 str: 0.000 loss: -55.862]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -50.615 ent: -5.247 str: 0.000 loss: -55.862]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.35it/s, atk: -56.138 ent: -5.249 str: 0.000 loss: -61.387]Iterations:  50%|█████     | 15/30 [00:12<00:12,  1.16it/s, atk: -56.138 ent: -5.249 str: 0.000 loss: -61.387]Iterations:  50%|█████     | 15/30 [00:13<00:12,  1.16it/s, atk: -62.197 ent: -5.250 str: 0.000 loss: -67.447]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.20it/s, atk: -62.197 ent: -5.250 str: 0.000 loss: -67.447]Iterations:  53%|█████▎    | 16/30 [00:14<00:11,  1.20it/s, atk: -68.448 ent: -5.251 str: 0.000 loss: -73.699]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.24it/s, atk: -68.448 ent: -5.251 str: 0.000 loss: -73.699]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.24it/s, atk: -75.185 ent: -5.252 str: 0.000 loss: -80.437]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.32it/s, atk: -75.185 ent: -5.252 str: 0.000 loss: -80.437]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.32it/s, atk: -82.103 ent: -5.252 str: 0.000 loss: -87.355]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.33it/s, atk: -82.103 ent: -5.252 str: 0.000 loss: -87.355]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.33it/s, atk: -89.064 ent: -5.253 str: 0.000 loss: -94.317]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.23it/s, atk: -89.064 ent: -5.253 str: 0.000 loss: -94.317]Iterations:  67%|██████▋   | 20/30 [00:17<00:08,  1.23it/s, atk: -96.879 ent: -5.254 str: 0.000 loss: -102.134]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.30it/s, atk: -96.879 ent: -5.254 str: 0.000 loss: -102.134]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.30it/s, atk: -106.398 ent: -5.255 str: 0.000 loss: -111.652]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.34it/s, atk: -106.398 ent: -5.255 str: 0.000 loss: -111.652]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.34it/s, atk: -114.465 ent: -5.255 str: 0.000 loss: -119.720]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.38it/s, atk: -114.465 ent: -5.255 str: 0.000 loss: -119.720]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.38it/s, atk: -122.572 ent: -5.256 str: 0.000 loss: -127.828]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -122.572 ent: -5.256 str: 0.000 loss: -127.828]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -130.520 ent: -5.257 str: 0.000 loss: -135.778]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.45it/s, atk: -130.520 ent: -5.257 str: 0.000 loss: -135.778]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.45it/s, atk: -138.115 ent: -5.259 str: 0.000 loss: -143.374]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.49it/s, atk: -138.115 ent: -5.259 str: 0.000 loss: -143.374]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.49it/s, atk: -145.777 ent: -5.258 str: 0.000 loss: -151.035]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -145.777 ent: -5.258 str: 0.000 loss: -151.035]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -153.401 ent: -5.256 str: 0.000 loss: -158.656]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.41it/s, atk: -153.401 ent: -5.256 str: 0.000 loss: -158.656]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.41it/s, atk: -160.430 ent: -5.255 str: 0.000 loss: -165.686]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.24it/s, atk: -160.430 ent: -5.255 str: 0.000 loss: -165.686]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.24it/s, atk: -167.857 ent: -5.256 str: 0.000 loss: -173.113]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.31it/s, atk: -167.857 ent: -5.256 str: 0.000 loss: -173.113]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.25it/s, atk: -167.857 ent: -5.256 str: 0.000 loss: -173.113]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([724], device='cuda:0') tensor(0.9996, device='cuda:0')
after_true: tensor([510], device='cuda:0') tensor(2.3269e-08, device='cuda:0')
L1: [4187.533]	L2: [30.983488]	Linf: [0.9372549]

Accuracy on benign examples: 100.0%
gt_label: 865 pred_label: 865 pred_clean_logit 0.997918426990509
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.90it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.14it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.50it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.20it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.97it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 16.02it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.10it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.19it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.98s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.56s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5065
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:03<?, ?it/s, atk: -0.012 ent: -4.963 str: 0.000 loss: -4.975]Iterations:   3%|▎         | 1/30 [00:03<01:40,  3.46s/it, atk: -0.012 ent: -4.963 str: 0.000 loss: -4.975]Iterations:   3%|▎         | 1/30 [00:03<01:40,  3.46s/it, atk: -0.054 ent: -4.972 str: 0.000 loss: -5.025]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.80s/it, atk: -0.054 ent: -4.972 str: 0.000 loss: -5.025]Iterations:   7%|▋         | 2/30 [00:04<00:50,  1.80s/it, atk: -0.236 ent: -4.978 str: 0.000 loss: -5.214]Iterations:  10%|█         | 3/30 [00:04<00:34,  1.29s/it, atk: -0.236 ent: -4.978 str: 0.000 loss: -5.214]Iterations:  10%|█         | 3/30 [00:05<00:34,  1.29s/it, atk: -0.878 ent: -4.979 str: 0.000 loss: -5.857]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.04s/it, atk: -0.878 ent: -4.979 str: 0.000 loss: -5.857]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.04s/it, atk: -2.165 ent: -4.977 str: 0.000 loss: -7.142]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -2.165 ent: -4.977 str: 0.000 loss: -7.142]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -4.653 ent: -4.979 str: 0.000 loss: -9.632]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -4.653 ent: -4.979 str: 0.000 loss: -9.632]Iterations:  20%|██        | 6/30 [00:07<00:20,  1.19it/s, atk: -6.096 ent: -4.975 str: 0.000 loss: -11.071]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -6.096 ent: -4.975 str: 0.000 loss: -11.071]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -9.940 ent: -4.980 str: 0.000 loss: -14.920]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.36it/s, atk: -9.940 ent: -4.980 str: 0.000 loss: -14.920]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.36it/s, atk: -14.722 ent: -4.978 str: 0.000 loss: -19.700]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.40it/s, atk: -14.722 ent: -4.978 str: 0.000 loss: -19.700]Iterations:  30%|███       | 9/30 [00:09<00:14,  1.40it/s, atk: -18.885 ent: -4.977 str: 0.000 loss: -23.861]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.44it/s, atk: -18.885 ent: -4.977 str: 0.000 loss: -23.861]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.44it/s, atk: -19.387 ent: -4.978 str: 0.000 loss: -24.364]Iterations:  37%|███▋      | 11/30 [00:10<00:12,  1.47it/s, atk: -19.387 ent: -4.978 str: 0.000 loss: -24.364]Iterations:  37%|███▋      | 11/30 [00:10<00:12,  1.47it/s, atk: -25.613 ent: -4.973 str: 0.000 loss: -30.586]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.49it/s, atk: -25.613 ent: -4.973 str: 0.000 loss: -30.586]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.49it/s, atk: -30.910 ent: -4.972 str: 0.000 loss: -35.882]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.47it/s, atk: -30.910 ent: -4.972 str: 0.000 loss: -35.882]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.47it/s, atk: -34.718 ent: -4.969 str: 0.000 loss: -39.687]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.44it/s, atk: -34.718 ent: -4.969 str: 0.000 loss: -39.687]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.44it/s, atk: -41.735 ent: -4.968 str: 0.000 loss: -46.703]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.47it/s, atk: -41.735 ent: -4.968 str: 0.000 loss: -46.703]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.47it/s, atk: -48.103 ent: -4.967 str: 0.000 loss: -53.069]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.42it/s, atk: -48.103 ent: -4.967 str: 0.000 loss: -53.069]Iterations:  53%|█████▎    | 16/30 [00:14<00:09,  1.42it/s, atk: -54.135 ent: -4.966 str: 0.000 loss: -59.101]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -54.135 ent: -4.966 str: 0.000 loss: -59.101]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -60.452 ent: -4.968 str: 0.000 loss: -65.420]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.39it/s, atk: -60.452 ent: -4.968 str: 0.000 loss: -65.420]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.39it/s, atk: -67.024 ent: -4.966 str: 0.000 loss: -71.990]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.42it/s, atk: -67.024 ent: -4.966 str: 0.000 loss: -71.990]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.42it/s, atk: -72.223 ent: -4.965 str: 0.000 loss: -77.189]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.41it/s, atk: -72.223 ent: -4.965 str: 0.000 loss: -77.189]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.41it/s, atk: -77.410 ent: -4.965 str: 0.000 loss: -82.375]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.43it/s, atk: -77.410 ent: -4.965 str: 0.000 loss: -82.375]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.43it/s, atk: -82.828 ent: -4.965 str: 0.000 loss: -87.793]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -82.828 ent: -4.965 str: 0.000 loss: -87.793]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.44it/s, atk: -88.972 ent: -4.963 str: 0.000 loss: -93.935]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -88.972 ent: -4.963 str: 0.000 loss: -93.935]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -93.003 ent: -4.962 str: 0.000 loss: -97.965]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.37it/s, atk: -93.003 ent: -4.962 str: 0.000 loss: -97.965]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.37it/s, atk: -98.556 ent: -4.962 str: 0.000 loss: -103.518]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.43it/s, atk: -98.556 ent: -4.962 str: 0.000 loss: -103.518]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.43it/s, atk: -105.294 ent: -4.962 str: 0.000 loss: -110.255]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -105.294 ent: -4.962 str: 0.000 loss: -110.255]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.43it/s, atk: -108.767 ent: -4.961 str: 0.000 loss: -113.728]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.44it/s, atk: -108.767 ent: -4.961 str: 0.000 loss: -113.728]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.44it/s, atk: -115.476 ent: -4.961 str: 0.000 loss: -120.437]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.45it/s, atk: -115.476 ent: -4.961 str: 0.000 loss: -120.437]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.45it/s, atk: -118.863 ent: -4.960 str: 0.000 loss: -123.823]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.40it/s, atk: -118.863 ent: -4.960 str: 0.000 loss: -123.823]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.40it/s, atk: -122.720 ent: -4.959 str: 0.000 loss: -127.679]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.42it/s, atk: -122.720 ent: -4.959 str: 0.000 loss: -127.679]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -122.720 ent: -4.959 str: 0.000 loss: -127.679]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([582], device='cuda:0') tensor(0.9963, device='cuda:0')
after_true: tensor([865], device='cuda:0') tensor(2.9886e-06, device='cuda:0')
L1: [3899.318]	L2: [25.07816]	Linf: [0.6666667]

Accuracy on benign examples: 100.0%
gt_label: 23 pred_label: 23 pred_clean_logit 0.35676899552345276
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.48it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.76it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.63it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.78it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.68it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.63it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.54it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.62it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.68it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.08s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.80s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.74s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4442
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.550 ent: -2.624 str: 0.000 loss: -4.174]Iterations:   3%|▎         | 1/30 [00:01<00:54,  1.88s/it, atk: -1.550 ent: -2.624 str: 0.000 loss: -4.174]Iterations:   3%|▎         | 1/30 [00:02<00:54,  1.88s/it, atk: -2.314 ent: -2.615 str: 0.000 loss: -4.930]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.13s/it, atk: -2.314 ent: -2.615 str: 0.000 loss: -4.930]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.13s/it, atk: -3.926 ent: -2.607 str: 0.000 loss: -6.533]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -3.926 ent: -2.607 str: 0.000 loss: -6.533]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -23.920 ent: -2.602 str: 0.000 loss: -26.521]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.20it/s, atk: -23.920 ent: -2.602 str: 0.000 loss: -26.521]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -39.323 ent: -2.597 str: 0.000 loss: -41.920]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -39.323 ent: -2.597 str: 0.000 loss: -41.920]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -55.134 ent: -2.600 str: 0.000 loss: -57.733]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -55.134 ent: -2.600 str: 0.000 loss: -57.733]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -67.035 ent: -2.602 str: 0.000 loss: -69.638]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -67.035 ent: -2.602 str: 0.000 loss: -69.638]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -79.241 ent: -2.600 str: 0.000 loss: -81.841]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -79.241 ent: -2.600 str: 0.000 loss: -81.841]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -88.146 ent: -2.601 str: 0.000 loss: -90.747]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -88.146 ent: -2.601 str: 0.000 loss: -90.747]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -86.897 ent: -2.602 str: 0.000 loss: -89.499]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.46it/s, atk: -86.897 ent: -2.602 str: 0.000 loss: -89.499]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.46it/s, atk: -96.414 ent: -2.602 str: 0.000 loss: -99.016]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -96.414 ent: -2.602 str: 0.000 loss: -99.016]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -103.303 ent: -2.600 str: 0.000 loss: -105.903]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -103.303 ent: -2.600 str: 0.000 loss: -105.903]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -109.600 ent: -2.599 str: 0.000 loss: -112.199]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -109.600 ent: -2.599 str: 0.000 loss: -112.199]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -117.044 ent: -2.599 str: 0.000 loss: -119.642]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -117.044 ent: -2.599 str: 0.000 loss: -119.642]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -122.793 ent: -2.598 str: 0.000 loss: -125.391]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -122.793 ent: -2.598 str: 0.000 loss: -125.391]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -131.883 ent: -2.597 str: 0.000 loss: -134.480]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.40it/s, atk: -131.883 ent: -2.597 str: 0.000 loss: -134.480]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.40it/s, atk: -137.310 ent: -2.598 str: 0.000 loss: -139.908]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.25it/s, atk: -137.310 ent: -2.598 str: 0.000 loss: -139.908]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.25it/s, atk: -143.096 ent: -2.597 str: 0.000 loss: -145.693]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.32it/s, atk: -143.096 ent: -2.597 str: 0.000 loss: -145.693]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.32it/s, atk: -148.344 ent: -2.595 str: 0.000 loss: -150.939]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -148.344 ent: -2.595 str: 0.000 loss: -150.939]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -153.151 ent: -2.596 str: 0.000 loss: -155.747]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -153.151 ent: -2.596 str: 0.000 loss: -155.747]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -156.822 ent: -2.596 str: 0.000 loss: -159.418]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.38it/s, atk: -156.822 ent: -2.596 str: 0.000 loss: -159.418]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.38it/s, atk: -162.379 ent: -2.595 str: 0.000 loss: -164.974]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.37it/s, atk: -162.379 ent: -2.595 str: 0.000 loss: -164.974]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -167.010 ent: -2.595 str: 0.000 loss: -169.605]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -167.010 ent: -2.595 str: 0.000 loss: -169.605]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -170.731 ent: -2.596 str: 0.000 loss: -173.327]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.46it/s, atk: -170.731 ent: -2.596 str: 0.000 loss: -173.327]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.46it/s, atk: -175.792 ent: -2.596 str: 0.000 loss: -178.389]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.37it/s, atk: -175.792 ent: -2.596 str: 0.000 loss: -178.389]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.37it/s, atk: -184.293 ent: -2.596 str: 0.000 loss: -186.889]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.31it/s, atk: -184.293 ent: -2.596 str: 0.000 loss: -186.889]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.31it/s, atk: -190.385 ent: -2.595 str: 0.000 loss: -192.980]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -190.385 ent: -2.595 str: 0.000 loss: -192.980]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -197.119 ent: -2.595 str: 0.000 loss: -199.713]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -197.119 ent: -2.595 str: 0.000 loss: -199.713]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -203.672 ent: -2.594 str: 0.000 loss: -206.266]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -203.672 ent: -2.594 str: 0.000 loss: -206.266]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -208.919 ent: -2.595 str: 0.000 loss: -211.514]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -208.919 ent: -2.595 str: 0.000 loss: -211.514]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -208.919 ent: -2.595 str: 0.000 loss: -211.514]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([856], device='cuda:0') tensor(0.9706, device='cuda:0')
after_true: tensor([23], device='cuda:0') tensor(4.8939e-10, device='cuda:0')
L1: [3810.4707]	L2: [27.822964]	Linf: [0.87058824]

Accuracy on benign examples: 100.0%
gt_label: 857 pred_label: 857 pred_clean_logit 0.998840868473053
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.44it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 21.00it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.08it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 22.88it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.27it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 22.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.63it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.62s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3708
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.005 ent: -2.528 str: 0.000 loss: -2.533]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.72s/it, atk: -0.005 ent: -2.528 str: 0.000 loss: -2.533]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.72s/it, atk: -0.006 ent: -2.536 str: 0.000 loss: -2.543]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.54s/it, atk: -0.006 ent: -2.536 str: 0.000 loss: -2.543]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.54s/it, atk: -0.011 ent: -2.549 str: 0.000 loss: -2.561]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.15s/it, atk: -0.011 ent: -2.549 str: 0.000 loss: -2.561]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.15s/it, atk: -0.042 ent: -2.560 str: 0.000 loss: -2.602]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -0.042 ent: -2.560 str: 0.000 loss: -2.602]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.06it/s, atk: -0.074 ent: -2.565 str: 0.000 loss: -2.638]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -0.074 ent: -2.565 str: 0.000 loss: -2.638]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -0.187 ent: -2.568 str: 0.000 loss: -2.755]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -0.187 ent: -2.568 str: 0.000 loss: -2.755]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -0.514 ent: -2.570 str: 0.000 loss: -3.084]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -0.514 ent: -2.570 str: 0.000 loss: -3.084]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.35it/s, atk: -1.003 ent: -2.567 str: 0.000 loss: -3.570]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.44it/s, atk: -1.003 ent: -2.567 str: 0.000 loss: -3.570]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.44it/s, atk: -3.274 ent: -2.571 str: 0.000 loss: -5.845]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.48it/s, atk: -3.274 ent: -2.571 str: 0.000 loss: -5.845]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.48it/s, atk: -5.750 ent: -2.572 str: 0.000 loss: -8.321]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.53it/s, atk: -5.750 ent: -2.572 str: 0.000 loss: -8.321]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.53it/s, atk: -8.797 ent: -2.567 str: 0.000 loss: -11.364]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.51it/s, atk: -8.797 ent: -2.567 str: 0.000 loss: -11.364]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.51it/s, atk: -12.508 ent: -2.564 str: 0.000 loss: -15.072]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -12.508 ent: -2.564 str: 0.000 loss: -15.072]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -18.245 ent: -2.565 str: 0.000 loss: -20.810]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.41it/s, atk: -18.245 ent: -2.565 str: 0.000 loss: -20.810]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.41it/s, atk: -22.359 ent: -2.566 str: 0.000 loss: -24.925]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.45it/s, atk: -22.359 ent: -2.566 str: 0.000 loss: -24.925]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.45it/s, atk: -27.278 ent: -2.565 str: 0.000 loss: -29.843]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -27.278 ent: -2.565 str: 0.000 loss: -29.843]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -32.255 ent: -2.562 str: 0.000 loss: -34.817]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.43it/s, atk: -32.255 ent: -2.562 str: 0.000 loss: -34.817]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -36.533 ent: -2.561 str: 0.000 loss: -39.094]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -36.533 ent: -2.561 str: 0.000 loss: -39.094]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -41.683 ent: -2.560 str: 0.000 loss: -44.243]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -41.683 ent: -2.560 str: 0.000 loss: -44.243]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -47.237 ent: -2.561 str: 0.000 loss: -49.799]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -47.237 ent: -2.561 str: 0.000 loss: -49.799]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.47it/s, atk: -51.275 ent: -2.562 str: 0.000 loss: -53.837]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.52it/s, atk: -51.275 ent: -2.562 str: 0.000 loss: -53.837]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.52it/s, atk: -56.399 ent: -2.558 str: 0.000 loss: -58.956]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.53it/s, atk: -56.399 ent: -2.558 str: 0.000 loss: -58.956]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.53it/s, atk: -60.547 ent: -2.557 str: 0.000 loss: -63.104]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -60.547 ent: -2.557 str: 0.000 loss: -63.104]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.52it/s, atk: -65.449 ent: -2.558 str: 0.000 loss: -68.007]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -65.449 ent: -2.558 str: 0.000 loss: -68.007]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -69.440 ent: -2.558 str: 0.000 loss: -71.998]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.52it/s, atk: -69.440 ent: -2.558 str: 0.000 loss: -71.998]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.52it/s, atk: -72.486 ent: -2.557 str: 0.000 loss: -75.044]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.49it/s, atk: -72.486 ent: -2.557 str: 0.000 loss: -75.044]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.49it/s, atk: -75.605 ent: -2.557 str: 0.000 loss: -78.161]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -75.605 ent: -2.557 str: 0.000 loss: -78.161]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -78.412 ent: -2.557 str: 0.000 loss: -80.968]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.52it/s, atk: -78.412 ent: -2.557 str: 0.000 loss: -80.968]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.52it/s, atk: -81.968 ent: -2.557 str: 0.000 loss: -84.525]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -81.968 ent: -2.557 str: 0.000 loss: -84.525]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.54it/s, atk: -85.364 ent: -2.558 str: 0.000 loss: -87.922]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.62it/s, atk: -85.364 ent: -2.558 str: 0.000 loss: -87.922]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.62it/s, atk: -88.582 ent: -2.557 str: 0.000 loss: -91.139]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.56it/s, atk: -88.582 ent: -2.557 str: 0.000 loss: -91.139]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -88.582 ent: -2.557 str: 0.000 loss: -91.139]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([406], device='cuda:0') tensor(0.8984, device='cuda:0')
after_true: tensor([857], device='cuda:0') tensor(9.5889e-05, device='cuda:0')
L1: [3556.7412]	L2: [23.60418]	Linf: [0.8039216]

Accuracy on benign examples: 100.0%
gt_label: 498 pred_label: 498 pred_clean_logit 0.9995855689048767
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.86it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.73it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.06it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.83it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.44it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.27it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.29it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.21it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.94it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.87s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.53s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.49s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4262
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.009 ent: -2.617 str: 0.000 loss: -2.626]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.06s/it, atk: -0.009 ent: -2.617 str: 0.000 loss: -2.626]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.06s/it, atk: -0.079 ent: -2.618 str: 0.000 loss: -2.697]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.20s/it, atk: -0.079 ent: -2.618 str: 0.000 loss: -2.697]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.20s/it, atk: -0.179 ent: -2.620 str: 0.000 loss: -2.798]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -0.179 ent: -2.620 str: 0.000 loss: -2.798]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -1.003 ent: -2.624 str: 0.000 loss: -3.627]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.18it/s, atk: -1.003 ent: -2.624 str: 0.000 loss: -3.627]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.18it/s, atk: -1.826 ent: -2.625 str: 0.000 loss: -4.452]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.26it/s, atk: -1.826 ent: -2.625 str: 0.000 loss: -4.452]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -3.601 ent: -2.627 str: 0.000 loss: -6.229]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -3.601 ent: -2.627 str: 0.000 loss: -6.229]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -5.976 ent: -2.627 str: 0.000 loss: -8.603]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -5.976 ent: -2.627 str: 0.000 loss: -8.603]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -8.734 ent: -2.627 str: 0.000 loss: -11.361]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.29it/s, atk: -8.734 ent: -2.627 str: 0.000 loss: -11.361]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.29it/s, atk: -13.407 ent: -2.626 str: 0.000 loss: -16.034]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.28it/s, atk: -13.407 ent: -2.626 str: 0.000 loss: -16.034]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.28it/s, atk: -18.001 ent: -2.625 str: 0.000 loss: -20.626]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -18.001 ent: -2.625 str: 0.000 loss: -20.626]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -23.424 ent: -2.623 str: 0.000 loss: -26.047]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.29it/s, atk: -23.424 ent: -2.623 str: 0.000 loss: -26.047]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.29it/s, atk: -28.567 ent: -2.622 str: 0.000 loss: -31.189]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.34it/s, atk: -28.567 ent: -2.622 str: 0.000 loss: -31.189]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -32.432 ent: -2.621 str: 0.000 loss: -35.053]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.38it/s, atk: -32.432 ent: -2.621 str: 0.000 loss: -35.053]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.38it/s, atk: -35.756 ent: -2.620 str: 0.000 loss: -38.376]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -35.756 ent: -2.620 str: 0.000 loss: -38.376]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -41.929 ent: -2.619 str: 0.000 loss: -44.549]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -41.929 ent: -2.619 str: 0.000 loss: -44.549]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -44.608 ent: -2.618 str: 0.000 loss: -47.227]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.47it/s, atk: -44.608 ent: -2.618 str: 0.000 loss: -47.227]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.47it/s, atk: -48.614 ent: -2.617 str: 0.000 loss: -51.230]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.49it/s, atk: -48.614 ent: -2.617 str: 0.000 loss: -51.230]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.49it/s, atk: -52.033 ent: -2.615 str: 0.000 loss: -54.648]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.51it/s, atk: -52.033 ent: -2.615 str: 0.000 loss: -54.648]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.51it/s, atk: -56.765 ent: -2.614 str: 0.000 loss: -59.379]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -56.765 ent: -2.614 str: 0.000 loss: -59.379]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -60.823 ent: -2.613 str: 0.000 loss: -63.436]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -60.823 ent: -2.613 str: 0.000 loss: -63.436]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -64.110 ent: -2.612 str: 0.000 loss: -66.723]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -64.110 ent: -2.612 str: 0.000 loss: -66.723]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.54it/s, atk: -68.013 ent: -2.612 str: 0.000 loss: -70.625]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -68.013 ent: -2.612 str: 0.000 loss: -70.625]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.52it/s, atk: -71.199 ent: -2.612 str: 0.000 loss: -73.811]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.58it/s, atk: -71.199 ent: -2.612 str: 0.000 loss: -73.811]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.58it/s, atk: -74.081 ent: -2.611 str: 0.000 loss: -76.693]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -74.081 ent: -2.611 str: 0.000 loss: -76.693]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.54it/s, atk: -76.672 ent: -2.610 str: 0.000 loss: -79.282]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.60it/s, atk: -76.672 ent: -2.610 str: 0.000 loss: -79.282]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.60it/s, atk: -80.285 ent: -2.609 str: 0.000 loss: -82.894]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.61it/s, atk: -80.285 ent: -2.609 str: 0.000 loss: -82.894]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.61it/s, atk: -84.250 ent: -2.608 str: 0.000 loss: -86.859]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -84.250 ent: -2.608 str: 0.000 loss: -86.859]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.56it/s, atk: -87.750 ent: -2.608 str: 0.000 loss: -90.358]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -87.750 ent: -2.608 str: 0.000 loss: -90.358]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -90.740 ent: -2.607 str: 0.000 loss: -93.347]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.39it/s, atk: -90.740 ent: -2.607 str: 0.000 loss: -93.347]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.39it/s, atk: -94.291 ent: -2.607 str: 0.000 loss: -96.898]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.45it/s, atk: -94.291 ent: -2.607 str: 0.000 loss: -96.898]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -94.291 ent: -2.607 str: 0.000 loss: -96.898]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([860], device='cuda:0') tensor(0.8955, device='cuda:0')
after_true: tensor([498], device='cuda:0') tensor(6.0990e-05, device='cuda:0')
L1: [2601.6392]	L2: [19.101244]	Linf: [0.7490196]

Accuracy on benign examples: 100.0%
gt_label: 518 pred_label: 518 pred_clean_logit 0.9256844520568848
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.01it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:04,  3.66it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01,  9.30it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 13.12it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 14.73it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.42it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 16.80it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 17.57it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.11it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.54s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5462
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.170 ent: -5.321 str: 0.000 loss: -6.491]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.85s/it, atk: -1.170 ent: -5.321 str: 0.000 loss: -6.491]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.85s/it, atk: -4.751 ent: -5.340 str: 0.000 loss: -10.092]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -4.751 ent: -5.340 str: 0.000 loss: -10.092]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -8.817 ent: -5.304 str: 0.000 loss: -14.121]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.09it/s, atk: -8.817 ent: -5.304 str: 0.000 loss: -14.121]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.09it/s, atk: -16.997 ent: -5.293 str: 0.000 loss: -22.291]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.24it/s, atk: -16.997 ent: -5.293 str: 0.000 loss: -22.291]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.24it/s, atk: -30.452 ent: -5.298 str: 0.000 loss: -35.750]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -30.452 ent: -5.298 str: 0.000 loss: -35.750]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -40.643 ent: -5.298 str: 0.000 loss: -45.942]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -40.643 ent: -5.298 str: 0.000 loss: -45.942]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -50.655 ent: -5.298 str: 0.000 loss: -55.954]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -50.655 ent: -5.298 str: 0.000 loss: -55.954]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -59.863 ent: -5.298 str: 0.000 loss: -65.161]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -59.863 ent: -5.298 str: 0.000 loss: -65.161]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -68.966 ent: -5.302 str: 0.000 loss: -74.267]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -68.966 ent: -5.302 str: 0.000 loss: -74.267]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -77.301 ent: -5.302 str: 0.000 loss: -82.603]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -77.301 ent: -5.302 str: 0.000 loss: -82.603]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -84.757 ent: -5.301 str: 0.000 loss: -90.058]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.45it/s, atk: -84.757 ent: -5.301 str: 0.000 loss: -90.058]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.45it/s, atk: -90.968 ent: -5.299 str: 0.000 loss: -96.267]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -90.968 ent: -5.299 str: 0.000 loss: -96.267]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -98.057 ent: -5.298 str: 0.000 loss: -103.355]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.45it/s, atk: -98.057 ent: -5.298 str: 0.000 loss: -103.355]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.45it/s, atk: -103.938 ent: -5.297 str: 0.000 loss: -109.235]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.50it/s, atk: -103.938 ent: -5.297 str: 0.000 loss: -109.235]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -110.344 ent: -5.297 str: 0.000 loss: -115.641]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -110.344 ent: -5.297 str: 0.000 loss: -115.641]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -116.454 ent: -5.297 str: 0.000 loss: -121.751]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -116.454 ent: -5.297 str: 0.000 loss: -121.751]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -122.447 ent: -5.296 str: 0.000 loss: -127.743]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.50it/s, atk: -122.447 ent: -5.296 str: 0.000 loss: -127.743]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.50it/s, atk: -126.531 ent: -5.295 str: 0.000 loss: -131.826]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.55it/s, atk: -126.531 ent: -5.295 str: 0.000 loss: -131.826]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.55it/s, atk: -130.023 ent: -5.296 str: 0.000 loss: -135.319]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -130.023 ent: -5.296 str: 0.000 loss: -135.319]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -134.966 ent: -5.297 str: 0.000 loss: -140.263]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.47it/s, atk: -134.966 ent: -5.297 str: 0.000 loss: -140.263]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.47it/s, atk: -140.282 ent: -5.297 str: 0.000 loss: -145.579]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -140.282 ent: -5.297 str: 0.000 loss: -145.579]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -145.599 ent: -5.297 str: 0.000 loss: -150.896]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.53it/s, atk: -145.599 ent: -5.297 str: 0.000 loss: -150.896]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.53it/s, atk: -150.937 ent: -5.298 str: 0.000 loss: -156.234]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -150.937 ent: -5.298 str: 0.000 loss: -156.234]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -156.081 ent: -5.298 str: 0.000 loss: -161.380]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -156.081 ent: -5.298 str: 0.000 loss: -161.380]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -161.498 ent: -5.299 str: 0.000 loss: -166.797]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -161.498 ent: -5.299 str: 0.000 loss: -166.797]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -166.223 ent: -5.300 str: 0.000 loss: -171.523]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.39it/s, atk: -166.223 ent: -5.300 str: 0.000 loss: -171.523]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -170.933 ent: -5.301 str: 0.000 loss: -176.233]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.42it/s, atk: -170.933 ent: -5.301 str: 0.000 loss: -176.233]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -175.017 ent: -5.302 str: 0.000 loss: -180.318]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.44it/s, atk: -175.017 ent: -5.302 str: 0.000 loss: -180.318]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.44it/s, atk: -179.385 ent: -5.302 str: 0.000 loss: -184.687]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.52it/s, atk: -179.385 ent: -5.302 str: 0.000 loss: -184.687]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.52it/s, atk: -183.045 ent: -5.303 str: 0.000 loss: -188.348]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.56it/s, atk: -183.045 ent: -5.303 str: 0.000 loss: -188.348]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -183.045 ent: -5.303 str: 0.000 loss: -188.348]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([573], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([518], device='cuda:0') tensor(7.4320e-09, device='cuda:0')
L1: [4576.749]	L2: [32.768864]	Linf: [0.9490196]

Accuracy on benign examples: 100.0%
gt_label: 762 pred_label: 762 pred_clean_logit 0.9001943469047546
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.69it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.02it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.36it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.59it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.01it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.00it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.13it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.70it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.91it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.81s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.53s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.58s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5027
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.454 ent: -2.487 str: 0.000 loss: -6.941]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.82s/it, atk: -4.454 ent: -2.487 str: 0.000 loss: -6.941]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.82s/it, atk: -6.224 ent: -2.472 str: 0.000 loss: -8.696]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.15s/it, atk: -6.224 ent: -2.472 str: 0.000 loss: -8.696]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.15s/it, atk: -11.655 ent: -2.472 str: 0.000 loss: -14.126]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.11it/s, atk: -11.655 ent: -2.472 str: 0.000 loss: -14.126]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.11it/s, atk: -15.148 ent: -2.470 str: 0.000 loss: -17.618]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -15.148 ent: -2.470 str: 0.000 loss: -17.618]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.26it/s, atk: -21.820 ent: -2.470 str: 0.000 loss: -24.291]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -21.820 ent: -2.470 str: 0.000 loss: -24.291]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -27.873 ent: -2.469 str: 0.000 loss: -30.342]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -27.873 ent: -2.469 str: 0.000 loss: -30.342]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -35.005 ent: -2.468 str: 0.000 loss: -37.473]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.31it/s, atk: -35.005 ent: -2.468 str: 0.000 loss: -37.473]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -40.014 ent: -2.468 str: 0.000 loss: -42.481]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -40.014 ent: -2.468 str: 0.000 loss: -42.481]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -44.748 ent: -2.467 str: 0.000 loss: -47.215]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.34it/s, atk: -44.748 ent: -2.467 str: 0.000 loss: -47.215]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.34it/s, atk: -50.705 ent: -2.467 str: 0.000 loss: -53.172]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -50.705 ent: -2.467 str: 0.000 loss: -53.172]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -56.756 ent: -2.466 str: 0.000 loss: -59.222]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -56.756 ent: -2.466 str: 0.000 loss: -59.222]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -62.721 ent: -2.465 str: 0.000 loss: -65.185]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -62.721 ent: -2.465 str: 0.000 loss: -65.185]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -70.732 ent: -2.464 str: 0.000 loss: -73.196]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.50it/s, atk: -70.732 ent: -2.464 str: 0.000 loss: -73.196]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.50it/s, atk: -76.054 ent: -2.465 str: 0.000 loss: -78.519]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -76.054 ent: -2.465 str: 0.000 loss: -78.519]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -85.397 ent: -2.464 str: 0.000 loss: -87.861]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -85.397 ent: -2.464 str: 0.000 loss: -87.861]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -94.254 ent: -2.464 str: 0.000 loss: -96.719]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -94.254 ent: -2.464 str: 0.000 loss: -96.719]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -103.107 ent: -2.463 str: 0.000 loss: -105.570]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.37it/s, atk: -103.107 ent: -2.463 str: 0.000 loss: -105.570]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -111.863 ent: -2.462 str: 0.000 loss: -114.325]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.38it/s, atk: -111.863 ent: -2.462 str: 0.000 loss: -114.325]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -119.095 ent: -2.462 str: 0.000 loss: -121.557]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -119.095 ent: -2.462 str: 0.000 loss: -121.557]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -126.223 ent: -2.462 str: 0.000 loss: -128.685]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -126.223 ent: -2.462 str: 0.000 loss: -128.685]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -132.297 ent: -2.461 str: 0.000 loss: -134.758]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.38it/s, atk: -132.297 ent: -2.461 str: 0.000 loss: -134.758]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.38it/s, atk: -140.619 ent: -2.460 str: 0.000 loss: -143.079]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.39it/s, atk: -140.619 ent: -2.460 str: 0.000 loss: -143.079]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.39it/s, atk: -148.895 ent: -2.460 str: 0.000 loss: -151.355]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -148.895 ent: -2.460 str: 0.000 loss: -151.355]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -155.569 ent: -2.459 str: 0.000 loss: -158.028]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.38it/s, atk: -155.569 ent: -2.459 str: 0.000 loss: -158.028]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.38it/s, atk: -163.333 ent: -2.458 str: 0.000 loss: -165.791]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.44it/s, atk: -163.333 ent: -2.458 str: 0.000 loss: -165.791]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.44it/s, atk: -169.160 ent: -2.458 str: 0.000 loss: -171.617]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -169.160 ent: -2.458 str: 0.000 loss: -171.617]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -175.238 ent: -2.457 str: 0.000 loss: -177.695]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.46it/s, atk: -175.238 ent: -2.457 str: 0.000 loss: -177.695]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -183.298 ent: -2.457 str: 0.000 loss: -185.755]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -183.298 ent: -2.457 str: 0.000 loss: -185.755]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -189.997 ent: -2.457 str: 0.000 loss: -192.453]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -189.997 ent: -2.457 str: 0.000 loss: -192.453]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -195.352 ent: -2.455 str: 0.000 loss: -197.807]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.50it/s, atk: -195.352 ent: -2.455 str: 0.000 loss: -197.807]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -195.352 ent: -2.455 str: 0.000 loss: -197.807]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([766], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([762], device='cuda:0') tensor(1.4972e-09, device='cuda:0')
L1: [3784.2393]	L2: [25.02752]	Linf: [0.8117647]

Accuracy on benign examples: 100.0%
gt_label: 865 pred_label: 865 pred_clean_logit 0.9968661665916443
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:05,  3.02it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.05it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 13.01it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.44it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.47it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.48it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 16.48it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.21it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.13it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.70it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.99s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.63s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4644
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.080 ent: -4.840 str: 0.000 loss: -4.920]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.01s/it, atk: -0.080 ent: -4.840 str: 0.000 loss: -4.920]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.01s/it, atk: -0.476 ent: -4.845 str: 0.000 loss: -5.322]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -0.476 ent: -4.845 str: 0.000 loss: -5.322]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -1.308 ent: -4.849 str: 0.000 loss: -6.158]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -1.308 ent: -4.849 str: 0.000 loss: -6.158]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -3.423 ent: -4.843 str: 0.000 loss: -8.266]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.18it/s, atk: -3.423 ent: -4.843 str: 0.000 loss: -8.266]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.18it/s, atk: -6.056 ent: -4.842 str: 0.000 loss: -10.898]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.18it/s, atk: -6.056 ent: -4.842 str: 0.000 loss: -10.898]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -4.354 ent: -4.833 str: 0.000 loss: -9.188] Iterations:  20%|██        | 6/30 [00:05<00:19,  1.23it/s, atk: -4.354 ent: -4.833 str: 0.000 loss: -9.188]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.23it/s, atk: -9.305 ent: -4.835 str: 0.000 loss: -14.140]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -9.305 ent: -4.835 str: 0.000 loss: -14.140]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -18.899 ent: -4.839 str: 0.000 loss: -23.738]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -18.899 ent: -4.839 str: 0.000 loss: -23.738]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -25.410 ent: -4.842 str: 0.000 loss: -30.252]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.47it/s, atk: -25.410 ent: -4.842 str: 0.000 loss: -30.252]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.47it/s, atk: -32.802 ent: -4.843 str: 0.000 loss: -37.645]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -32.802 ent: -4.843 str: 0.000 loss: -37.645]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -42.272 ent: -4.843 str: 0.000 loss: -47.115]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.54it/s, atk: -42.272 ent: -4.843 str: 0.000 loss: -47.115]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.54it/s, atk: -48.607 ent: -4.844 str: 0.000 loss: -53.451]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.51it/s, atk: -48.607 ent: -4.844 str: 0.000 loss: -53.451]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.51it/s, atk: -54.288 ent: -4.843 str: 0.000 loss: -59.132]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.54it/s, atk: -54.288 ent: -4.843 str: 0.000 loss: -59.132]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -61.256 ent: -4.843 str: 0.000 loss: -66.098]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.47it/s, atk: -61.256 ent: -4.843 str: 0.000 loss: -66.098]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.47it/s, atk: -67.277 ent: -4.841 str: 0.000 loss: -72.118]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -67.277 ent: -4.841 str: 0.000 loss: -72.118]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -73.640 ent: -4.840 str: 0.000 loss: -78.480]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -73.640 ent: -4.840 str: 0.000 loss: -78.480]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -79.415 ent: -4.838 str: 0.000 loss: -84.253]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.44it/s, atk: -79.415 ent: -4.838 str: 0.000 loss: -84.253]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -84.574 ent: -4.836 str: 0.000 loss: -89.410]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -84.574 ent: -4.836 str: 0.000 loss: -89.410]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -89.698 ent: -4.836 str: 0.000 loss: -94.534]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -89.698 ent: -4.836 str: 0.000 loss: -94.534]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -95.240 ent: -4.837 str: 0.000 loss: -100.077]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.44it/s, atk: -95.240 ent: -4.837 str: 0.000 loss: -100.077]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -99.985 ent: -4.837 str: 0.000 loss: -104.822]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -99.985 ent: -4.837 str: 0.000 loss: -104.822]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -103.856 ent: -4.837 str: 0.000 loss: -108.693]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -103.856 ent: -4.837 str: 0.000 loss: -108.693]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -108.511 ent: -4.837 str: 0.000 loss: -113.348]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -108.511 ent: -4.837 str: 0.000 loss: -113.348]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -112.288 ent: -4.836 str: 0.000 loss: -117.124]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.51it/s, atk: -112.288 ent: -4.836 str: 0.000 loss: -117.124]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.51it/s, atk: -115.815 ent: -4.835 str: 0.000 loss: -120.650]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -115.815 ent: -4.835 str: 0.000 loss: -120.650]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -119.037 ent: -4.836 str: 0.000 loss: -123.873]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.49it/s, atk: -119.037 ent: -4.836 str: 0.000 loss: -123.873]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.49it/s, atk: -122.614 ent: -4.836 str: 0.000 loss: -127.450]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.46it/s, atk: -122.614 ent: -4.836 str: 0.000 loss: -127.450]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.46it/s, atk: -126.427 ent: -4.836 str: 0.000 loss: -131.264]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -126.427 ent: -4.836 str: 0.000 loss: -131.264]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -129.232 ent: -4.837 str: 0.000 loss: -134.069]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.50it/s, atk: -129.232 ent: -4.837 str: 0.000 loss: -134.069]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -133.936 ent: -4.836 str: 0.000 loss: -138.773]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.44it/s, atk: -133.936 ent: -4.836 str: 0.000 loss: -138.773]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -133.936 ent: -4.836 str: 0.000 loss: -138.773]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([406], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([865], device='cuda:0') tensor(1.0483e-06, device='cuda:0')
L1: [4236.9175]	L2: [29.402012]	Linf: [0.9607843]

Accuracy on benign examples: 100.0%
gt_label: 480 pred_label: 480 pred_clean_logit 0.9971984624862671
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.19it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.94it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.60it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.39it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.24it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.52it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.44it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.45it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.58it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.67it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.28s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.62s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.56s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2553
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.131 ent: -5.571 str: 0.000 loss: -5.703]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.41s/it, atk: -0.131 ent: -5.571 str: 0.000 loss: -5.703]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.41s/it, atk: -0.396 ent: -5.575 str: 0.000 loss: -5.971]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -0.396 ent: -5.575 str: 0.000 loss: -5.971]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -1.261 ent: -5.574 str: 0.000 loss: -6.835]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -1.261 ent: -5.574 str: 0.000 loss: -6.835]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -2.285 ent: -5.569 str: 0.000 loss: -7.854]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -2.285 ent: -5.569 str: 0.000 loss: -7.854]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -4.911 ent: -5.566 str: 0.000 loss: -10.477]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -4.911 ent: -5.566 str: 0.000 loss: -10.477]Iterations:  17%|█▋        | 5/30 [00:05<00:18,  1.33it/s, atk: -7.108 ent: -5.557 str: 0.000 loss: -12.665]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.37it/s, atk: -7.108 ent: -5.557 str: 0.000 loss: -12.665]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.37it/s, atk: -11.017 ent: -5.558 str: 0.000 loss: -16.575]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.48it/s, atk: -11.017 ent: -5.558 str: 0.000 loss: -16.575]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.48it/s, atk: -14.461 ent: -5.550 str: 0.000 loss: -20.011]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.50it/s, atk: -14.461 ent: -5.550 str: 0.000 loss: -20.011]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.50it/s, atk: -19.237 ent: -5.545 str: 0.000 loss: -24.782]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.54it/s, atk: -19.237 ent: -5.545 str: 0.000 loss: -24.782]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.54it/s, atk: -25.119 ent: -5.534 str: 0.000 loss: -30.652]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.56it/s, atk: -25.119 ent: -5.534 str: 0.000 loss: -30.652]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.56it/s, atk: -30.922 ent: -5.526 str: 0.000 loss: -36.448]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.51it/s, atk: -30.922 ent: -5.526 str: 0.000 loss: -36.448]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.51it/s, atk: -36.290 ent: -5.523 str: 0.000 loss: -41.814]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.42it/s, atk: -36.290 ent: -5.523 str: 0.000 loss: -41.814]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.42it/s, atk: -43.822 ent: -5.526 str: 0.000 loss: -49.349]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -43.822 ent: -5.526 str: 0.000 loss: -49.349]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -48.666 ent: -5.525 str: 0.000 loss: -54.191]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.47it/s, atk: -48.666 ent: -5.525 str: 0.000 loss: -54.191]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.47it/s, atk: -54.769 ent: -5.519 str: 0.000 loss: -60.289]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.45it/s, atk: -54.769 ent: -5.519 str: 0.000 loss: -60.289]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.45it/s, atk: -59.620 ent: -5.516 str: 0.000 loss: -65.136]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -59.620 ent: -5.516 str: 0.000 loss: -65.136]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -65.109 ent: -5.518 str: 0.000 loss: -70.627]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.44it/s, atk: -65.109 ent: -5.518 str: 0.000 loss: -70.627]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -69.446 ent: -5.522 str: 0.000 loss: -74.968]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.37it/s, atk: -69.446 ent: -5.522 str: 0.000 loss: -74.968]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.37it/s, atk: -74.871 ent: -5.527 str: 0.000 loss: -80.398]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -74.871 ent: -5.527 str: 0.000 loss: -80.398]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -80.533 ent: -5.522 str: 0.000 loss: -86.056]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.49it/s, atk: -80.533 ent: -5.522 str: 0.000 loss: -86.056]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -85.432 ent: -5.519 str: 0.000 loss: -90.950]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.46it/s, atk: -85.432 ent: -5.519 str: 0.000 loss: -90.950]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -90.200 ent: -5.518 str: 0.000 loss: -95.719]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.47it/s, atk: -90.200 ent: -5.518 str: 0.000 loss: -95.719]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.47it/s, atk: -95.568 ent: -5.513 str: 0.000 loss: -101.081]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -95.568 ent: -5.513 str: 0.000 loss: -101.081]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -99.699 ent: -5.512 str: 0.000 loss: -105.211]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -99.699 ent: -5.512 str: 0.000 loss: -105.211]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.47it/s, atk: -103.758 ent: -5.513 str: 0.000 loss: -109.271]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.40it/s, atk: -103.758 ent: -5.513 str: 0.000 loss: -109.271]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.40it/s, atk: -107.966 ent: -5.513 str: 0.000 loss: -113.480]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -107.966 ent: -5.513 str: 0.000 loss: -113.480]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -111.455 ent: -5.513 str: 0.000 loss: -116.968]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.41it/s, atk: -111.455 ent: -5.513 str: 0.000 loss: -116.968]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -114.031 ent: -5.513 str: 0.000 loss: -119.544]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -114.031 ent: -5.513 str: 0.000 loss: -119.544]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -116.858 ent: -5.512 str: 0.000 loss: -122.370]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -116.858 ent: -5.512 str: 0.000 loss: -122.370]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -119.526 ent: -5.515 str: 0.000 loss: -125.041]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.39it/s, atk: -119.526 ent: -5.515 str: 0.000 loss: -125.041]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -119.526 ent: -5.515 str: 0.000 loss: -125.041]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([637], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([480], device='cuda:0') tensor(4.7906e-06, device='cuda:0')
L1: [1744.0314]	L2: [11.808931]	Linf: [0.56078434]

Accuracy on benign examples: 100.0%
gt_label: 873 pred_label: 873 pred_clean_logit 0.9998544454574585
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.95it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.49it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 21.90it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 23.13it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 20.64it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.69it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.18it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.51s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.42s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5152
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.001 ent: -10.435 str: 0.000 loss: -10.436]Iterations:   3%|▎         | 1/30 [00:03<01:33,  3.22s/it, atk: -0.001 ent: -10.435 str: 0.000 loss: -10.436]Iterations:   3%|▎         | 1/30 [00:03<01:33,  3.22s/it, atk: -0.001 ent: -10.496 str: 0.000 loss: -10.497]Iterations:   7%|▋         | 2/30 [00:03<00:49,  1.78s/it, atk: -0.001 ent: -10.496 str: 0.000 loss: -10.497]Iterations:   7%|▋         | 2/30 [00:04<00:49,  1.78s/it, atk: -0.001 ent: -10.540 str: 0.000 loss: -10.542]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.24s/it, atk: -0.001 ent: -10.540 str: 0.000 loss: -10.542]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.24s/it, atk: -0.002 ent: -10.583 str: 0.000 loss: -10.585]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.01it/s, atk: -0.002 ent: -10.583 str: 0.000 loss: -10.585]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.01it/s, atk: -0.002 ent: -10.626 str: 0.000 loss: -10.627]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -0.002 ent: -10.626 str: 0.000 loss: -10.627]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.12it/s, atk: -0.002 ent: -10.666 str: 0.000 loss: -10.668]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -0.002 ent: -10.666 str: 0.000 loss: -10.668]Iterations:  20%|██        | 6/30 [00:07<00:20,  1.18it/s, atk: -0.002 ent: -10.706 str: 0.000 loss: -10.708]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -0.002 ent: -10.706 str: 0.000 loss: -10.708]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -0.002 ent: -10.747 str: 0.000 loss: -10.749]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.30it/s, atk: -0.002 ent: -10.747 str: 0.000 loss: -10.749]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.30it/s, atk: -0.002 ent: -10.787 str: 0.000 loss: -10.790]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -0.002 ent: -10.787 str: 0.000 loss: -10.790]Iterations:  30%|███       | 9/30 [00:09<00:15,  1.33it/s, atk: -0.003 ent: -10.829 str: 0.000 loss: -10.831]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -0.003 ent: -10.829 str: 0.000 loss: -10.831]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -0.003 ent: -10.870 str: 0.000 loss: -10.873]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.38it/s, atk: -0.003 ent: -10.870 str: 0.000 loss: -10.873]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.38it/s, atk: -0.003 ent: -10.909 str: 0.000 loss: -10.913]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.39it/s, atk: -0.003 ent: -10.909 str: 0.000 loss: -10.913]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.39it/s, atk: -0.004 ent: -10.947 str: 0.000 loss: -10.950]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.44it/s, atk: -0.004 ent: -10.947 str: 0.000 loss: -10.950]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.44it/s, atk: -0.004 ent: -10.978 str: 0.000 loss: -10.982]Iterations:  47%|████▋     | 14/30 [00:12<00:10,  1.49it/s, atk: -0.004 ent: -10.978 str: 0.000 loss: -10.982]Iterations:  47%|████▋     | 14/30 [00:12<00:10,  1.49it/s, atk: -0.005 ent: -10.992 str: 0.000 loss: -10.996]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.49it/s, atk: -0.005 ent: -10.992 str: 0.000 loss: -10.996]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.49it/s, atk: -0.005 ent: -11.010 str: 0.000 loss: -11.015]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.54it/s, atk: -0.005 ent: -11.010 str: 0.000 loss: -11.015]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.54it/s, atk: -0.005 ent: -11.026 str: 0.000 loss: -11.031]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.48it/s, atk: -0.005 ent: -11.026 str: 0.000 loss: -11.031]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.48it/s, atk: -0.006 ent: -11.045 str: 0.000 loss: -11.051]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -0.006 ent: -11.045 str: 0.000 loss: -11.051]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.49it/s, atk: -0.007 ent: -11.065 str: 0.000 loss: -11.071]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.41it/s, atk: -0.007 ent: -11.065 str: 0.000 loss: -11.071]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.41it/s, atk: -0.007 ent: -11.083 str: 0.000 loss: -11.090]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -0.007 ent: -11.083 str: 0.000 loss: -11.090]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -0.008 ent: -11.102 str: 0.000 loss: -11.111]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.41it/s, atk: -0.008 ent: -11.102 str: 0.000 loss: -11.111]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.41it/s, atk: -0.010 ent: -11.124 str: 0.000 loss: -11.134]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -0.010 ent: -11.124 str: 0.000 loss: -11.134]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.41it/s, atk: -0.012 ent: -11.147 str: 0.000 loss: -11.159]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -0.012 ent: -11.147 str: 0.000 loss: -11.159]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -0.014 ent: -11.168 str: 0.000 loss: -11.182]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -0.014 ent: -11.168 str: 0.000 loss: -11.182]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -0.016 ent: -11.188 str: 0.000 loss: -11.204]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.43it/s, atk: -0.016 ent: -11.188 str: 0.000 loss: -11.204]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.43it/s, atk: -0.020 ent: -11.207 str: 0.000 loss: -11.227]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -0.020 ent: -11.207 str: 0.000 loss: -11.227]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -0.027 ent: -11.226 str: 0.000 loss: -11.253]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.52it/s, atk: -0.027 ent: -11.226 str: 0.000 loss: -11.253]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.52it/s, atk: -0.034 ent: -11.244 str: 0.000 loss: -11.279]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.55it/s, atk: -0.034 ent: -11.244 str: 0.000 loss: -11.279]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.55it/s, atk: -0.049 ent: -11.260 str: 0.000 loss: -11.310]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -0.049 ent: -11.260 str: 0.000 loss: -11.310]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -0.075 ent: -11.276 str: 0.000 loss: -11.351]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.56it/s, atk: -0.075 ent: -11.276 str: 0.000 loss: -11.351]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -0.075 ent: -11.276 str: 0.000 loss: -11.351]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 100.0%
after_pred: tensor([873], device='cuda:0') tensor(0.9866, device='cuda:0')
after_true: tensor([873], device='cuda:0') tensor(0.9866, device='cuda:0')
L1: [4236.7017]	L2: [28.410358]	Linf: [0.7882353]

Accuracy on benign examples: 100.0%
gt_label: 476 pred_label: 476 pred_clean_logit 0.824795663356781
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  4.64it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.27it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.69it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.50it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.09it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.48it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.46it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.53it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.48s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.45s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.51s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5955
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -6.240 ent: -2.700 str: 0.000 loss: -8.941]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.38s/it, atk: -6.240 ent: -2.700 str: 0.000 loss: -8.941]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.38s/it, atk: -13.027 ent: -2.699 str: 0.000 loss: -15.726]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.44s/it, atk: -13.027 ent: -2.699 str: 0.000 loss: -15.726]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.44s/it, atk: -24.160 ent: -2.688 str: 0.000 loss: -26.847]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.11s/it, atk: -24.160 ent: -2.688 str: 0.000 loss: -26.847]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.11s/it, atk: -28.611 ent: -2.686 str: 0.000 loss: -31.297]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -28.611 ent: -2.686 str: 0.000 loss: -31.297]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -30.486 ent: -2.689 str: 0.000 loss: -33.175]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -30.486 ent: -2.689 str: 0.000 loss: -33.175]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -30.958 ent: -2.687 str: 0.000 loss: -33.644]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -30.958 ent: -2.687 str: 0.000 loss: -33.644]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.29it/s, atk: -42.914 ent: -2.688 str: 0.000 loss: -45.602]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -42.914 ent: -2.688 str: 0.000 loss: -45.602]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.39it/s, atk: -52.653 ent: -2.688 str: 0.000 loss: -55.341]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.43it/s, atk: -52.653 ent: -2.688 str: 0.000 loss: -55.341]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.43it/s, atk: -62.621 ent: -2.688 str: 0.000 loss: -65.310]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -62.621 ent: -2.688 str: 0.000 loss: -65.310]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.44it/s, atk: -73.556 ent: -2.688 str: 0.000 loss: -76.244]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.54it/s, atk: -73.556 ent: -2.688 str: 0.000 loss: -76.244]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.54it/s, atk: -82.970 ent: -2.688 str: 0.000 loss: -85.658]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.53it/s, atk: -82.970 ent: -2.688 str: 0.000 loss: -85.658]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.53it/s, atk: -92.921 ent: -2.687 str: 0.000 loss: -95.608]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.55it/s, atk: -92.921 ent: -2.687 str: 0.000 loss: -95.608]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.55it/s, atk: -101.840 ent: -2.686 str: 0.000 loss: -104.527]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -101.840 ent: -2.686 str: 0.000 loss: -104.527]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.54it/s, atk: -108.608 ent: -2.687 str: 0.000 loss: -111.296]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -108.608 ent: -2.687 str: 0.000 loss: -111.296]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -120.583 ent: -2.687 str: 0.000 loss: -123.270]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -120.583 ent: -2.687 str: 0.000 loss: -123.270]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.47it/s, atk: -125.736 ent: -2.688 str: 0.000 loss: -128.424]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -125.736 ent: -2.688 str: 0.000 loss: -128.424]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.46it/s, atk: -137.059 ent: -2.689 str: 0.000 loss: -139.748]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.46it/s, atk: -137.059 ent: -2.689 str: 0.000 loss: -139.748]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.46it/s, atk: -143.519 ent: -2.690 str: 0.000 loss: -146.209]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -143.519 ent: -2.690 str: 0.000 loss: -146.209]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -151.922 ent: -2.691 str: 0.000 loss: -154.613]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -151.922 ent: -2.691 str: 0.000 loss: -154.613]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -160.949 ent: -2.692 str: 0.000 loss: -163.640]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -160.949 ent: -2.692 str: 0.000 loss: -163.640]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -170.541 ent: -2.692 str: 0.000 loss: -173.233]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -170.541 ent: -2.692 str: 0.000 loss: -173.233]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.47it/s, atk: -177.046 ent: -2.693 str: 0.000 loss: -179.739]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -177.046 ent: -2.693 str: 0.000 loss: -179.739]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -181.761 ent: -2.692 str: 0.000 loss: -184.453]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -181.761 ent: -2.692 str: 0.000 loss: -184.453]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -188.822 ent: -2.691 str: 0.000 loss: -191.512]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.52it/s, atk: -188.822 ent: -2.691 str: 0.000 loss: -191.512]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.52it/s, atk: -196.225 ent: -2.690 str: 0.000 loss: -198.915]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -196.225 ent: -2.690 str: 0.000 loss: -198.915]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -203.552 ent: -2.692 str: 0.000 loss: -206.244]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.48it/s, atk: -203.552 ent: -2.692 str: 0.000 loss: -206.244]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.48it/s, atk: -209.153 ent: -2.692 str: 0.000 loss: -211.845]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.44it/s, atk: -209.153 ent: -2.692 str: 0.000 loss: -211.845]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -216.235 ent: -2.693 str: 0.000 loss: -218.928]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.53it/s, atk: -216.235 ent: -2.693 str: 0.000 loss: -218.928]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.53it/s, atk: -220.143 ent: -2.692 str: 0.000 loss: -222.836]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.53it/s, atk: -220.143 ent: -2.692 str: 0.000 loss: -222.836]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.53it/s, atk: -223.825 ent: -2.692 str: 0.000 loss: -226.517]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.53it/s, atk: -223.825 ent: -2.692 str: 0.000 loss: -226.517]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -223.825 ent: -2.692 str: 0.000 loss: -226.517]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([540], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([476], device='cuda:0') tensor(1.1668e-10, device='cuda:0')
L1: [3902.7805]	L2: [27.407293]	Linf: [0.93333334]

Accuracy on benign examples: 100.0%
gt_label: 315 pred_label: 315 pred_clean_logit 0.893388032913208
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.34it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.25it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.98it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.20it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.50it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.88it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.44it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 20.22it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.76it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.47s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.36s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4061
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.527 ent: -2.566 str: 0.000 loss: -4.093]Iterations:   3%|▎         | 1/30 [00:01<00:51,  1.77s/it, atk: -1.527 ent: -2.566 str: 0.000 loss: -4.093]Iterations:   3%|▎         | 1/30 [00:02<00:51,  1.77s/it, atk: -3.706 ent: -2.565 str: 0.000 loss: -6.270]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -3.706 ent: -2.565 str: 0.000 loss: -6.270]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -10.108 ent: -2.567 str: 0.000 loss: -12.675]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -10.108 ent: -2.567 str: 0.000 loss: -12.675]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -18.823 ent: -2.567 str: 0.000 loss: -21.390]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -18.823 ent: -2.567 str: 0.000 loss: -21.390]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.26it/s, atk: -22.825 ent: -2.568 str: 0.000 loss: -25.394]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -22.825 ent: -2.568 str: 0.000 loss: -25.394]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -31.739 ent: -2.568 str: 0.000 loss: -34.307]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -31.739 ent: -2.568 str: 0.000 loss: -34.307]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.38it/s, atk: -38.123 ent: -2.566 str: 0.000 loss: -40.690]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.40it/s, atk: -38.123 ent: -2.566 str: 0.000 loss: -40.690]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -41.421 ent: -2.565 str: 0.000 loss: -43.986]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -41.421 ent: -2.565 str: 0.000 loss: -43.986]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -44.533 ent: -2.565 str: 0.000 loss: -47.097]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -44.533 ent: -2.565 str: 0.000 loss: -47.097]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -47.193 ent: -2.565 str: 0.000 loss: -49.758]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.37it/s, atk: -47.193 ent: -2.565 str: 0.000 loss: -49.758]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -50.258 ent: -2.565 str: 0.000 loss: -52.823]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.39it/s, atk: -50.258 ent: -2.565 str: 0.000 loss: -52.823]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.39it/s, atk: -52.930 ent: -2.564 str: 0.000 loss: -55.494]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -52.930 ent: -2.564 str: 0.000 loss: -55.494]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -55.767 ent: -2.563 str: 0.000 loss: -58.330]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.35it/s, atk: -55.767 ent: -2.563 str: 0.000 loss: -58.330]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.35it/s, atk: -57.326 ent: -2.562 str: 0.000 loss: -59.887]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.38it/s, atk: -57.326 ent: -2.562 str: 0.000 loss: -59.887]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.38it/s, atk: -58.913 ent: -2.561 str: 0.000 loss: -61.474]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -58.913 ent: -2.561 str: 0.000 loss: -61.474]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -60.383 ent: -2.559 str: 0.000 loss: -62.943]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -60.383 ent: -2.559 str: 0.000 loss: -62.943]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -61.681 ent: -2.558 str: 0.000 loss: -64.238]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.39it/s, atk: -61.681 ent: -2.558 str: 0.000 loss: -64.238]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -63.205 ent: -2.557 str: 0.000 loss: -65.762]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.41it/s, atk: -63.205 ent: -2.557 str: 0.000 loss: -65.762]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -64.712 ent: -2.557 str: 0.000 loss: -67.269]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -64.712 ent: -2.557 str: 0.000 loss: -67.269]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -64.790 ent: -2.551 str: 0.000 loss: -67.341]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -64.790 ent: -2.551 str: 0.000 loss: -67.341]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -66.991 ent: -2.557 str: 0.000 loss: -69.548]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.47it/s, atk: -66.991 ent: -2.557 str: 0.000 loss: -69.548]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.47it/s, atk: -68.071 ent: -2.557 str: 0.000 loss: -70.627]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -68.071 ent: -2.557 str: 0.000 loss: -70.627]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -69.559 ent: -2.556 str: 0.000 loss: -72.115]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.52it/s, atk: -69.559 ent: -2.556 str: 0.000 loss: -72.115]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.52it/s, atk: -71.007 ent: -2.556 str: 0.000 loss: -73.563]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.29it/s, atk: -71.007 ent: -2.556 str: 0.000 loss: -73.563]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.29it/s, atk: -72.742 ent: -2.555 str: 0.000 loss: -75.297]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.34it/s, atk: -72.742 ent: -2.555 str: 0.000 loss: -75.297]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.34it/s, atk: -74.093 ent: -2.554 str: 0.000 loss: -76.647]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -74.093 ent: -2.554 str: 0.000 loss: -76.647]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -75.406 ent: -2.553 str: 0.000 loss: -77.958]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -75.406 ent: -2.553 str: 0.000 loss: -77.958]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -76.495 ent: -2.553 str: 0.000 loss: -79.048]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.35it/s, atk: -76.495 ent: -2.553 str: 0.000 loss: -79.048]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -77.705 ent: -2.552 str: 0.000 loss: -80.257]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.31it/s, atk: -77.705 ent: -2.552 str: 0.000 loss: -80.257]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.31it/s, atk: -78.838 ent: -2.552 str: 0.000 loss: -81.390]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -78.838 ent: -2.552 str: 0.000 loss: -81.390]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -78.838 ent: -2.552 str: 0.000 loss: -81.390]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([301], device='cuda:0') tensor(0.1065, device='cuda:0')
after_true: tensor([315], device='cuda:0') tensor(0.0003, device='cuda:0')
L1: [2021.]	L2: [15.995591]	Linf: [0.9607843]

Accuracy on benign examples: 100.0%
gt_label: 609 pred_label: 609 pred_clean_logit 0.9943798184394836
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.80it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.37it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.83it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 21.73it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 21.92it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.87it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.39it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.40it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.48s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5428
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.122 ent: -2.679 str: 0.000 loss: -2.801]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -0.122 ent: -2.679 str: 0.000 loss: -2.801]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -2.277 ent: -2.663 str: 0.000 loss: -4.940]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.31s/it, atk: -2.277 ent: -2.663 str: 0.000 loss: -4.940]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.31s/it, atk: -2.620 ent: -2.661 str: 0.000 loss: -5.281]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -2.620 ent: -2.661 str: 0.000 loss: -5.281]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -6.895 ent: -2.655 str: 0.000 loss: -9.550]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -6.895 ent: -2.655 str: 0.000 loss: -9.550]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -20.455 ent: -2.634 str: 0.000 loss: -23.089]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -20.455 ent: -2.634 str: 0.000 loss: -23.089]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.25it/s, atk: -20.260 ent: -2.608 str: 0.000 loss: -22.868]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -20.260 ent: -2.608 str: 0.000 loss: -22.868]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -31.066 ent: -2.603 str: 0.000 loss: -33.669]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -31.066 ent: -2.603 str: 0.000 loss: -33.669]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -41.694 ent: -2.607 str: 0.000 loss: -44.301]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -41.694 ent: -2.607 str: 0.000 loss: -44.301]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.42it/s, atk: -49.481 ent: -2.612 str: 0.000 loss: -52.094]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -49.481 ent: -2.612 str: 0.000 loss: -52.094]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -58.214 ent: -2.612 str: 0.000 loss: -60.826]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -58.214 ent: -2.612 str: 0.000 loss: -60.826]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -67.476 ent: -2.607 str: 0.000 loss: -70.083]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.50it/s, atk: -67.476 ent: -2.607 str: 0.000 loss: -70.083]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.50it/s, atk: -73.862 ent: -2.603 str: 0.000 loss: -76.465]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -73.862 ent: -2.603 str: 0.000 loss: -76.465]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -81.452 ent: -2.602 str: 0.000 loss: -84.054]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -81.452 ent: -2.602 str: 0.000 loss: -84.054]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -87.052 ent: -2.603 str: 0.000 loss: -89.655]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.43it/s, atk: -87.052 ent: -2.603 str: 0.000 loss: -89.655]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.43it/s, atk: -97.944 ent: -2.603 str: 0.000 loss: -100.547]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.50it/s, atk: -97.944 ent: -2.603 str: 0.000 loss: -100.547]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.50it/s, atk: -105.145 ent: -2.603 str: 0.000 loss: -107.748]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.50it/s, atk: -105.145 ent: -2.603 str: 0.000 loss: -107.748]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.50it/s, atk: -113.778 ent: -2.602 str: 0.000 loss: -116.380]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -113.778 ent: -2.602 str: 0.000 loss: -116.380]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.48it/s, atk: -122.691 ent: -2.600 str: 0.000 loss: -125.291]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -122.691 ent: -2.600 str: 0.000 loss: -125.291]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -128.394 ent: -2.599 str: 0.000 loss: -130.993]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -128.394 ent: -2.599 str: 0.000 loss: -130.993]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -133.206 ent: -2.599 str: 0.000 loss: -135.805]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -133.206 ent: -2.599 str: 0.000 loss: -135.805]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -140.960 ent: -2.599 str: 0.000 loss: -143.559]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.41it/s, atk: -140.960 ent: -2.599 str: 0.000 loss: -143.559]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -146.980 ent: -2.600 str: 0.000 loss: -149.580]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -146.980 ent: -2.600 str: 0.000 loss: -149.580]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -152.936 ent: -2.600 str: 0.000 loss: -155.536]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.41it/s, atk: -152.936 ent: -2.600 str: 0.000 loss: -155.536]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.41it/s, atk: -158.814 ent: -2.599 str: 0.000 loss: -161.413]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -158.814 ent: -2.599 str: 0.000 loss: -161.413]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -161.877 ent: -2.598 str: 0.000 loss: -164.475]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -161.877 ent: -2.598 str: 0.000 loss: -164.475]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -167.016 ent: -2.598 str: 0.000 loss: -169.614]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.57it/s, atk: -167.016 ent: -2.598 str: 0.000 loss: -169.614]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.57it/s, atk: -171.034 ent: -2.598 str: 0.000 loss: -173.632]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.52it/s, atk: -171.034 ent: -2.598 str: 0.000 loss: -173.632]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.52it/s, atk: -174.178 ent: -2.597 str: 0.000 loss: -176.775]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.50it/s, atk: -174.178 ent: -2.597 str: 0.000 loss: -176.775]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.50it/s, atk: -177.875 ent: -2.597 str: 0.000 loss: -180.472]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.58it/s, atk: -177.875 ent: -2.597 str: 0.000 loss: -180.472]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.58it/s, atk: -182.631 ent: -2.598 str: 0.000 loss: -185.228]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.60it/s, atk: -182.631 ent: -2.598 str: 0.000 loss: -185.228]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -182.631 ent: -2.598 str: 0.000 loss: -185.228]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([661], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([609], device='cuda:0') tensor(6.7401e-09, device='cuda:0')
L1: [2402.6746]	L2: [18.786182]	Linf: [0.7607843]

Accuracy on benign examples: 100.0%
gt_label: 911 pred_label: 911 pred_clean_logit 0.7660102248191833
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.03it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 13.60it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.85it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.24it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.91it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.57it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.96it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.42it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.38it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.62s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.58s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4455
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -2.493 ent: -2.486 str: 0.000 loss: -4.979]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.33s/it, atk: -2.493 ent: -2.486 str: 0.000 loss: -4.979]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.33s/it, atk: -5.110 ent: -2.488 str: 0.000 loss: -7.599]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.30s/it, atk: -5.110 ent: -2.488 str: 0.000 loss: -7.599]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.30s/it, atk: -8.546 ent: -2.487 str: 0.000 loss: -11.033]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -8.546 ent: -2.487 str: 0.000 loss: -11.033]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -13.432 ent: -2.485 str: 0.000 loss: -15.918]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -13.432 ent: -2.485 str: 0.000 loss: -15.918]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -17.341 ent: -2.481 str: 0.000 loss: -19.822]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -17.341 ent: -2.481 str: 0.000 loss: -19.822]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.28it/s, atk: -21.423 ent: -2.480 str: 0.000 loss: -23.903]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -21.423 ent: -2.480 str: 0.000 loss: -23.903]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -26.956 ent: -2.479 str: 0.000 loss: -29.434]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -26.956 ent: -2.479 str: 0.000 loss: -29.434]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -32.635 ent: -2.478 str: 0.000 loss: -35.112]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -32.635 ent: -2.478 str: 0.000 loss: -35.112]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -35.317 ent: -2.476 str: 0.000 loss: -37.793]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -35.317 ent: -2.476 str: 0.000 loss: -37.793]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.39it/s, atk: -41.064 ent: -2.477 str: 0.000 loss: -43.541]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -41.064 ent: -2.477 str: 0.000 loss: -43.541]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -45.306 ent: -2.477 str: 0.000 loss: -47.782]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -45.306 ent: -2.477 str: 0.000 loss: -47.782]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -49.051 ent: -2.476 str: 0.000 loss: -51.527]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -49.051 ent: -2.476 str: 0.000 loss: -51.527]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -54.161 ent: -2.477 str: 0.000 loss: -56.638]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -54.161 ent: -2.477 str: 0.000 loss: -56.638]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -57.882 ent: -2.477 str: 0.000 loss: -60.359]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -57.882 ent: -2.477 str: 0.000 loss: -60.359]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -60.208 ent: -2.477 str: 0.000 loss: -62.685]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.38it/s, atk: -60.208 ent: -2.477 str: 0.000 loss: -62.685]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -63.078 ent: -2.479 str: 0.000 loss: -65.557]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -63.078 ent: -2.479 str: 0.000 loss: -65.557]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -66.128 ent: -2.479 str: 0.000 loss: -68.607]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -66.128 ent: -2.479 str: 0.000 loss: -68.607]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -69.704 ent: -2.478 str: 0.000 loss: -72.183]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -69.704 ent: -2.478 str: 0.000 loss: -72.183]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -72.804 ent: -2.477 str: 0.000 loss: -75.282]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -72.804 ent: -2.477 str: 0.000 loss: -75.282]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.45it/s, atk: -74.822 ent: -2.477 str: 0.000 loss: -77.299]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -74.822 ent: -2.477 str: 0.000 loss: -77.299]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -77.779 ent: -2.477 str: 0.000 loss: -80.256]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.48it/s, atk: -77.779 ent: -2.477 str: 0.000 loss: -80.256]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.48it/s, atk: -81.258 ent: -2.477 str: 0.000 loss: -83.735]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -81.258 ent: -2.477 str: 0.000 loss: -83.735]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -84.842 ent: -2.478 str: 0.000 loss: -87.319]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.59it/s, atk: -84.842 ent: -2.478 str: 0.000 loss: -87.319]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.59it/s, atk: -88.156 ent: -2.476 str: 0.000 loss: -90.632]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -88.156 ent: -2.476 str: 0.000 loss: -90.632]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.54it/s, atk: -91.383 ent: -2.475 str: 0.000 loss: -93.858]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.51it/s, atk: -91.383 ent: -2.475 str: 0.000 loss: -93.858]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.51it/s, atk: -94.685 ent: -2.475 str: 0.000 loss: -97.160]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.44it/s, atk: -94.685 ent: -2.475 str: 0.000 loss: -97.160]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.44it/s, atk: -97.481 ent: -2.475 str: 0.000 loss: -99.956]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -97.481 ent: -2.475 str: 0.000 loss: -99.956]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -99.623 ent: -2.473 str: 0.000 loss: -102.097]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.41it/s, atk: -99.623 ent: -2.473 str: 0.000 loss: -102.097]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.41it/s, atk: -102.672 ent: -2.473 str: 0.000 loss: -105.145]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -102.672 ent: -2.473 str: 0.000 loss: -105.145]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.41it/s, atk: -104.439 ent: -2.475 str: 0.000 loss: -106.913]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.37it/s, atk: -104.439 ent: -2.475 str: 0.000 loss: -106.913]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -104.439 ent: -2.475 str: 0.000 loss: -106.913]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([949], device='cuda:0') tensor(0.9624, device='cuda:0')
after_true: tensor([911], device='cuda:0') tensor(2.2590e-05, device='cuda:0')
L1: [1471.4274]	L2: [9.710686]	Linf: [0.33333334]

Accuracy on benign examples: 100.0%
gt_label: 497 pred_label: 497 pred_clean_logit 0.9376676082611084
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.23it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.36it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.16it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.99it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 20.45it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 22.94it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.29it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.97it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.87s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.79s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.68s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3614
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.763 ent: -2.711 str: 0.000 loss: -3.475]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.19s/it, atk: -0.763 ent: -2.711 str: 0.000 loss: -3.475]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.19s/it, atk: -3.014 ent: -2.711 str: 0.000 loss: -5.725]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.35s/it, atk: -3.014 ent: -2.711 str: 0.000 loss: -5.725]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -8.146 ent: -2.711 str: 0.000 loss: -10.858]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -8.146 ent: -2.711 str: 0.000 loss: -10.858]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.07s/it, atk: -16.270 ent: -2.710 str: 0.000 loss: -18.981]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -16.270 ent: -2.710 str: 0.000 loss: -18.981]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -26.624 ent: -2.709 str: 0.000 loss: -29.332]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -26.624 ent: -2.709 str: 0.000 loss: -29.332]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -37.803 ent: -2.708 str: 0.000 loss: -40.511]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -37.803 ent: -2.708 str: 0.000 loss: -40.511]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -47.386 ent: -2.708 str: 0.000 loss: -50.095]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.27it/s, atk: -47.386 ent: -2.708 str: 0.000 loss: -50.095]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -58.377 ent: -2.709 str: 0.000 loss: -61.086]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -58.377 ent: -2.709 str: 0.000 loss: -61.086]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -68.189 ent: -2.709 str: 0.000 loss: -70.898]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -68.189 ent: -2.709 str: 0.000 loss: -70.898]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -77.292 ent: -2.710 str: 0.000 loss: -80.002]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -77.292 ent: -2.710 str: 0.000 loss: -80.002]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -85.503 ent: -2.711 str: 0.000 loss: -88.214]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -85.503 ent: -2.711 str: 0.000 loss: -88.214]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -93.695 ent: -2.711 str: 0.000 loss: -96.406]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.46it/s, atk: -93.695 ent: -2.711 str: 0.000 loss: -96.406]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -100.908 ent: -2.711 str: 0.000 loss: -103.619]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.56it/s, atk: -100.908 ent: -2.711 str: 0.000 loss: -103.619]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.56it/s, atk: -106.760 ent: -2.711 str: 0.000 loss: -109.471]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -106.760 ent: -2.711 str: 0.000 loss: -109.471]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -112.765 ent: -2.710 str: 0.000 loss: -115.475]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.56it/s, atk: -112.765 ent: -2.710 str: 0.000 loss: -115.475]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.56it/s, atk: -117.696 ent: -2.710 str: 0.000 loss: -120.405]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -117.696 ent: -2.710 str: 0.000 loss: -120.405]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -122.253 ent: -2.709 str: 0.000 loss: -124.962]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.58it/s, atk: -122.253 ent: -2.709 str: 0.000 loss: -124.962]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.58it/s, atk: -127.238 ent: -2.708 str: 0.000 loss: -129.946]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.58it/s, atk: -127.238 ent: -2.708 str: 0.000 loss: -129.946]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.58it/s, atk: -132.803 ent: -2.707 str: 0.000 loss: -135.510]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.53it/s, atk: -132.803 ent: -2.707 str: 0.000 loss: -135.510]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.53it/s, atk: -138.116 ent: -2.706 str: 0.000 loss: -140.822]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -138.116 ent: -2.706 str: 0.000 loss: -140.822]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -143.429 ent: -2.705 str: 0.000 loss: -146.134]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -143.429 ent: -2.705 str: 0.000 loss: -146.134]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.51it/s, atk: -148.114 ent: -2.705 str: 0.000 loss: -150.819]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -148.114 ent: -2.705 str: 0.000 loss: -150.819]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -151.902 ent: -2.705 str: 0.000 loss: -154.607]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.41it/s, atk: -151.902 ent: -2.705 str: 0.000 loss: -154.607]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.41it/s, atk: -155.453 ent: -2.705 str: 0.000 loss: -158.157]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.40it/s, atk: -155.453 ent: -2.705 str: 0.000 loss: -158.157]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.40it/s, atk: -159.259 ent: -2.704 str: 0.000 loss: -161.964]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -159.259 ent: -2.704 str: 0.000 loss: -161.964]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -163.181 ent: -2.703 str: 0.000 loss: -165.885]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.48it/s, atk: -163.181 ent: -2.703 str: 0.000 loss: -165.885]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.48it/s, atk: -167.012 ent: -2.703 str: 0.000 loss: -169.715]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -167.012 ent: -2.703 str: 0.000 loss: -169.715]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -170.012 ent: -2.702 str: 0.000 loss: -172.714]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -170.012 ent: -2.702 str: 0.000 loss: -172.714]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -173.184 ent: -2.702 str: 0.000 loss: -175.885]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.53it/s, atk: -173.184 ent: -2.702 str: 0.000 loss: -175.885]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.53it/s, atk: -176.634 ent: -2.702 str: 0.000 loss: -179.336]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.53it/s, atk: -176.634 ent: -2.702 str: 0.000 loss: -179.336]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -176.634 ent: -2.702 str: 0.000 loss: -179.336]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([442], device='cuda:0') tensor(0.9988, device='cuda:0')
after_true: tensor([497], device='cuda:0') tensor(1.4981e-08, device='cuda:0')
L1: [3047.2585]	L2: [21.436378]	Linf: [0.8980392]

Accuracy on benign examples: 100.0%
gt_label: 346 pred_label: 346 pred_clean_logit 0.49078884720802307
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.22it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.28it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.12it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.69it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.80it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.70it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.92it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.01it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.83s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4374
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -17.760 ent: -4.917 str: 0.000 loss: -22.678]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.80s/it, atk: -17.760 ent: -4.917 str: 0.000 loss: -22.678]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.80s/it, atk: -21.600 ent: -4.892 str: 0.000 loss: -26.492]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -21.600 ent: -4.892 str: 0.000 loss: -26.492]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -23.612 ent: -4.878 str: 0.000 loss: -28.490]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -23.612 ent: -4.878 str: 0.000 loss: -28.490]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -32.003 ent: -4.880 str: 0.000 loss: -36.883]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -32.003 ent: -4.880 str: 0.000 loss: -36.883]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -37.860 ent: -4.877 str: 0.000 loss: -42.737]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -37.860 ent: -4.877 str: 0.000 loss: -42.737]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -44.021 ent: -4.876 str: 0.000 loss: -48.897]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -44.021 ent: -4.876 str: 0.000 loss: -48.897]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -52.248 ent: -4.875 str: 0.000 loss: -57.124]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -52.248 ent: -4.875 str: 0.000 loss: -57.124]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -60.269 ent: -4.871 str: 0.000 loss: -65.140]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -60.269 ent: -4.871 str: 0.000 loss: -65.140]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.43it/s, atk: -66.815 ent: -4.870 str: 0.000 loss: -71.685]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -66.815 ent: -4.870 str: 0.000 loss: -71.685]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -73.717 ent: -4.870 str: 0.000 loss: -78.587]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -73.717 ent: -4.870 str: 0.000 loss: -78.587]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -81.148 ent: -4.870 str: 0.000 loss: -86.018]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -81.148 ent: -4.870 str: 0.000 loss: -86.018]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -87.754 ent: -4.870 str: 0.000 loss: -92.624]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.38it/s, atk: -87.754 ent: -4.870 str: 0.000 loss: -92.624]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.38it/s, atk: -94.239 ent: -4.871 str: 0.000 loss: -99.110]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -94.239 ent: -4.871 str: 0.000 loss: -99.110]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -101.741 ent: -4.876 str: 0.000 loss: -106.617]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.42it/s, atk: -101.741 ent: -4.876 str: 0.000 loss: -106.617]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -107.682 ent: -4.876 str: 0.000 loss: -112.558]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.42it/s, atk: -107.682 ent: -4.876 str: 0.000 loss: -112.558]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.42it/s, atk: -111.897 ent: -4.876 str: 0.000 loss: -116.773]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.43it/s, atk: -111.897 ent: -4.876 str: 0.000 loss: -116.773]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.43it/s, atk: -117.565 ent: -4.878 str: 0.000 loss: -122.443]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -117.565 ent: -4.878 str: 0.000 loss: -122.443]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.48it/s, atk: -122.512 ent: -4.877 str: 0.000 loss: -127.389]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.44it/s, atk: -122.512 ent: -4.877 str: 0.000 loss: -127.389]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -128.846 ent: -4.875 str: 0.000 loss: -133.721]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -128.846 ent: -4.875 str: 0.000 loss: -133.721]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -131.797 ent: -4.872 str: 0.000 loss: -136.669]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -131.797 ent: -4.872 str: 0.000 loss: -136.669]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -136.900 ent: -4.873 str: 0.000 loss: -141.773]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -136.900 ent: -4.873 str: 0.000 loss: -141.773]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -140.398 ent: -4.874 str: 0.000 loss: -145.272]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -140.398 ent: -4.874 str: 0.000 loss: -145.272]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -144.562 ent: -4.874 str: 0.000 loss: -149.437]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -144.562 ent: -4.874 str: 0.000 loss: -149.437]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -149.772 ent: -4.877 str: 0.000 loss: -154.649]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.48it/s, atk: -149.772 ent: -4.877 str: 0.000 loss: -154.649]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -154.073 ent: -4.879 str: 0.000 loss: -158.952]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -154.073 ent: -4.879 str: 0.000 loss: -158.952]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -156.686 ent: -4.877 str: 0.000 loss: -161.563]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -156.686 ent: -4.877 str: 0.000 loss: -161.563]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -159.466 ent: -4.879 str: 0.000 loss: -164.345]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -159.466 ent: -4.879 str: 0.000 loss: -164.345]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -164.381 ent: -4.878 str: 0.000 loss: -169.259]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.35it/s, atk: -164.381 ent: -4.878 str: 0.000 loss: -169.259]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -165.374 ent: -4.876 str: 0.000 loss: -170.249]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.33it/s, atk: -165.374 ent: -4.876 str: 0.000 loss: -170.249]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.33it/s, atk: -169.328 ent: -4.878 str: 0.000 loss: -174.206]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.44it/s, atk: -169.328 ent: -4.878 str: 0.000 loss: -174.206]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -169.328 ent: -4.878 str: 0.000 loss: -174.206]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([386], device='cuda:0') tensor(0.9886, device='cuda:0')
after_true: tensor([346], device='cuda:0') tensor(4.4511e-08, device='cuda:0')
L1: [3934.859]	L2: [24.348938]	Linf: [0.63529414]

Accuracy on benign examples: 100.0%
gt_label: 825 pred_label: 825 pred_clean_logit 0.9923892617225647
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.12it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.32it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.03it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.72it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.43it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.59it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.55it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.57it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.82s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.54s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5031
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.233 ent: -4.914 str: 0.000 loss: -5.147]Iterations:   3%|▎         | 1/30 [00:02<01:19,  2.73s/it, atk: -0.233 ent: -4.914 str: 0.000 loss: -5.147]Iterations:   3%|▎         | 1/30 [00:03<01:19,  2.73s/it, atk: -0.955 ent: -4.890 str: 0.000 loss: -5.846]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.49s/it, atk: -0.955 ent: -4.890 str: 0.000 loss: -5.846]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.49s/it, atk: -2.204 ent: -4.891 str: 0.000 loss: -7.095]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.10s/it, atk: -2.204 ent: -4.891 str: 0.000 loss: -7.095]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.10s/it, atk: -4.647 ent: -4.890 str: 0.000 loss: -9.537]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -4.647 ent: -4.890 str: 0.000 loss: -9.537]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.07it/s, atk: -9.183 ent: -4.877 str: 0.000 loss: -14.059]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.15it/s, atk: -9.183 ent: -4.877 str: 0.000 loss: -14.059]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.15it/s, atk: -20.488 ent: -4.876 str: 0.000 loss: -25.364]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -20.488 ent: -4.876 str: 0.000 loss: -25.364]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -20.971 ent: -4.866 str: 0.000 loss: -25.836]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -20.971 ent: -4.866 str: 0.000 loss: -25.836]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -26.921 ent: -4.868 str: 0.000 loss: -31.789]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -26.921 ent: -4.868 str: 0.000 loss: -31.789]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.31it/s, atk: -37.885 ent: -4.863 str: 0.000 loss: -42.748]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -37.885 ent: -4.863 str: 0.000 loss: -42.748]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -52.047 ent: -4.863 str: 0.000 loss: -56.910]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.34it/s, atk: -52.047 ent: -4.863 str: 0.000 loss: -56.910]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.34it/s, atk: -62.835 ent: -4.864 str: 0.000 loss: -67.699]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -62.835 ent: -4.864 str: 0.000 loss: -67.699]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.37it/s, atk: -69.393 ent: -4.863 str: 0.000 loss: -74.256]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -69.393 ent: -4.863 str: 0.000 loss: -74.256]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.36it/s, atk: -80.350 ent: -4.861 str: 0.000 loss: -85.211]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.27it/s, atk: -80.350 ent: -4.861 str: 0.000 loss: -85.211]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.27it/s, atk: -86.759 ent: -4.860 str: 0.000 loss: -91.618]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.37it/s, atk: -86.759 ent: -4.860 str: 0.000 loss: -91.618]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.37it/s, atk: -91.336 ent: -4.861 str: 0.000 loss: -96.196]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -91.336 ent: -4.861 str: 0.000 loss: -96.196]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.38it/s, atk: -100.977 ent: -4.861 str: 0.000 loss: -105.838]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -100.977 ent: -4.861 str: 0.000 loss: -105.838]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -108.194 ent: -4.859 str: 0.000 loss: -113.053]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.46it/s, atk: -108.194 ent: -4.859 str: 0.000 loss: -113.053]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.46it/s, atk: -114.298 ent: -4.858 str: 0.000 loss: -119.155]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.45it/s, atk: -114.298 ent: -4.858 str: 0.000 loss: -119.155]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.45it/s, atk: -123.141 ent: -4.858 str: 0.000 loss: -127.999]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -123.141 ent: -4.858 str: 0.000 loss: -127.999]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -131.431 ent: -4.859 str: 0.000 loss: -136.290]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -131.431 ent: -4.859 str: 0.000 loss: -136.290]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -134.053 ent: -4.860 str: 0.000 loss: -138.913]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.42it/s, atk: -134.053 ent: -4.860 str: 0.000 loss: -138.913]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.42it/s, atk: -139.858 ent: -4.858 str: 0.000 loss: -144.716]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -139.858 ent: -4.858 str: 0.000 loss: -144.716]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.43it/s, atk: -144.318 ent: -4.854 str: 0.000 loss: -149.172]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.45it/s, atk: -144.318 ent: -4.854 str: 0.000 loss: -149.172]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.45it/s, atk: -148.864 ent: -4.853 str: 0.000 loss: -153.717]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.47it/s, atk: -148.864 ent: -4.853 str: 0.000 loss: -153.717]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.47it/s, atk: -137.951 ent: -4.855 str: 0.000 loss: -142.807]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.46it/s, atk: -137.951 ent: -4.855 str: 0.000 loss: -142.807]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.46it/s, atk: -132.627 ent: -4.853 str: 0.000 loss: -137.480]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.48it/s, atk: -132.627 ent: -4.853 str: 0.000 loss: -137.480]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.48it/s, atk: -125.993 ent: -4.852 str: 0.000 loss: -130.845]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.51it/s, atk: -125.993 ent: -4.852 str: 0.000 loss: -130.845]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.51it/s, atk: -124.858 ent: -4.850 str: 0.000 loss: -129.708]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.50it/s, atk: -124.858 ent: -4.850 str: 0.000 loss: -129.708]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.50it/s, atk: -132.692 ent: -4.847 str: 0.000 loss: -137.540]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -132.692 ent: -4.847 str: 0.000 loss: -137.540]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.52it/s, atk: -146.691 ent: -4.845 str: 0.000 loss: -151.536]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.43it/s, atk: -146.691 ent: -4.845 str: 0.000 loss: -151.536]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -146.691 ent: -4.845 str: 0.000 loss: -151.536]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([500], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([825], device='cuda:0') tensor(1.9606e-07, device='cuda:0')
L1: [3208.196]	L2: [21.159756]	Linf: [0.7490196]

Accuracy on benign examples: 100.0%
gt_label: 738 pred_label: 738 pred_clean_logit 0.9641187191009521
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.79it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 22.45it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 20.73it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 20.42it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.72it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.71it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 18.45it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.48it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.33s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.23s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.36s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.46s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.47s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5133
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.159 ent: -2.577 str: 0.000 loss: -2.736]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.33s/it, atk: -0.159 ent: -2.577 str: 0.000 loss: -2.736]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.33s/it, atk: -0.520 ent: -2.581 str: 0.000 loss: -3.101]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.520 ent: -2.581 str: 0.000 loss: -3.101]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.785 ent: -2.585 str: 0.000 loss: -3.371]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.19it/s, atk: -0.785 ent: -2.585 str: 0.000 loss: -3.371]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.19it/s, atk: -1.312 ent: -2.585 str: 0.000 loss: -3.897]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.27it/s, atk: -1.312 ent: -2.585 str: 0.000 loss: -3.897]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.27it/s, atk: -2.374 ent: -2.582 str: 0.000 loss: -4.957]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -2.374 ent: -2.582 str: 0.000 loss: -4.957]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -3.206 ent: -2.586 str: 0.000 loss: -5.792]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.19it/s, atk: -3.206 ent: -2.586 str: 0.000 loss: -5.792]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.19it/s, atk: -4.510 ent: -2.585 str: 0.000 loss: -7.096]Iterations:  23%|██▎       | 7/30 [00:06<00:19,  1.17it/s, atk: -4.510 ent: -2.585 str: 0.000 loss: -7.096]Iterations:  23%|██▎       | 7/30 [00:06<00:19,  1.17it/s, atk: -6.794 ent: -2.588 str: 0.000 loss: -9.381]Iterations:  27%|██▋       | 8/30 [00:06<00:18,  1.16it/s, atk: -6.794 ent: -2.588 str: 0.000 loss: -9.381]Iterations:  27%|██▋       | 8/30 [00:07<00:18,  1.16it/s, atk: -9.853 ent: -2.589 str: 0.000 loss: -12.442]Iterations:  30%|███       | 9/30 [00:07<00:18,  1.14it/s, atk: -9.853 ent: -2.589 str: 0.000 loss: -12.442]Iterations:  30%|███       | 9/30 [00:08<00:18,  1.14it/s, atk: -13.471 ent: -2.589 str: 0.000 loss: -16.060]Iterations:  33%|███▎      | 10/30 [00:08<00:17,  1.17it/s, atk: -13.471 ent: -2.589 str: 0.000 loss: -16.060]Iterations:  33%|███▎      | 10/30 [00:09<00:17,  1.17it/s, atk: -15.252 ent: -2.587 str: 0.000 loss: -17.839]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.24it/s, atk: -15.252 ent: -2.587 str: 0.000 loss: -17.839]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.24it/s, atk: -16.720 ent: -2.586 str: 0.000 loss: -19.306]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.29it/s, atk: -16.720 ent: -2.586 str: 0.000 loss: -19.306]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.29it/s, atk: -20.055 ent: -2.586 str: 0.000 loss: -22.640]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.33it/s, atk: -20.055 ent: -2.586 str: 0.000 loss: -22.640]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.33it/s, atk: -17.762 ent: -2.586 str: 0.000 loss: -20.348]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -17.762 ent: -2.586 str: 0.000 loss: -20.348]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -19.302 ent: -2.584 str: 0.000 loss: -21.886]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.32it/s, atk: -19.302 ent: -2.584 str: 0.000 loss: -21.886]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.32it/s, atk: -22.600 ent: -2.584 str: 0.000 loss: -25.183]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.36it/s, atk: -22.600 ent: -2.584 str: 0.000 loss: -25.183]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.36it/s, atk: -27.898 ent: -2.582 str: 0.000 loss: -30.480]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -27.898 ent: -2.582 str: 0.000 loss: -30.480]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -33.396 ent: -2.581 str: 0.000 loss: -35.977]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -33.396 ent: -2.581 str: 0.000 loss: -35.977]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -38.766 ent: -2.579 str: 0.000 loss: -41.345]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -38.766 ent: -2.579 str: 0.000 loss: -41.345]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -46.202 ent: -2.577 str: 0.000 loss: -48.779]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -46.202 ent: -2.577 str: 0.000 loss: -48.779]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -56.184 ent: -2.578 str: 0.000 loss: -58.762]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.50it/s, atk: -56.184 ent: -2.578 str: 0.000 loss: -58.762]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.50it/s, atk: -63.165 ent: -2.578 str: 0.000 loss: -65.743]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -63.165 ent: -2.578 str: 0.000 loss: -65.743]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -71.151 ent: -2.574 str: 0.000 loss: -73.725]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -71.151 ent: -2.574 str: 0.000 loss: -73.725]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.49it/s, atk: -84.431 ent: -2.573 str: 0.000 loss: -87.004]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -84.431 ent: -2.573 str: 0.000 loss: -87.004]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -94.479 ent: -2.573 str: 0.000 loss: -97.052]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.46it/s, atk: -94.479 ent: -2.573 str: 0.000 loss: -97.052]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.46it/s, atk: -101.776 ent: -2.572 str: 0.000 loss: -104.348]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.44it/s, atk: -101.776 ent: -2.572 str: 0.000 loss: -104.348]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -110.138 ent: -2.570 str: 0.000 loss: -112.708]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -110.138 ent: -2.570 str: 0.000 loss: -112.708]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -119.220 ent: -2.570 str: 0.000 loss: -121.790]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -119.220 ent: -2.570 str: 0.000 loss: -121.790]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -127.364 ent: -2.571 str: 0.000 loss: -129.935]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -127.364 ent: -2.571 str: 0.000 loss: -129.935]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -131.838 ent: -2.569 str: 0.000 loss: -134.407]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.41it/s, atk: -131.838 ent: -2.569 str: 0.000 loss: -134.407]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -131.838 ent: -2.569 str: 0.000 loss: -134.407]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([604], device='cuda:0') tensor(0.9996, device='cuda:0')
after_true: tensor([738], device='cuda:0') tensor(7.5067e-07, device='cuda:0')
L1: [4090.4985]	L2: [29.876226]	Linf: [0.84313726]

Accuracy on benign examples: 100.0%
gt_label: 839 pred_label: 839 pred_clean_logit 0.9957570433616638
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.85it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.56it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 20.16it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.58it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.67it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.77it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.02it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.37s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4898
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.040 ent: -5.111 str: 0.000 loss: -5.151]Iterations:   3%|▎         | 1/30 [00:00<00:28,  1.00it/s, atk: -0.040 ent: -5.111 str: 0.000 loss: -5.151]Iterations:   3%|▎         | 1/30 [00:01<00:28,  1.00it/s, atk: -0.292 ent: -5.118 str: 0.000 loss: -5.410]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.34it/s, atk: -0.292 ent: -5.118 str: 0.000 loss: -5.410]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.34it/s, atk: -0.738 ent: -5.104 str: 0.000 loss: -5.842]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.35it/s, atk: -0.738 ent: -5.104 str: 0.000 loss: -5.842]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.35it/s, atk: -1.321 ent: -5.085 str: 0.000 loss: -6.406]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -1.321 ent: -5.085 str: 0.000 loss: -6.406]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -3.612 ent: -5.082 str: 0.000 loss: -8.694]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.47it/s, atk: -3.612 ent: -5.082 str: 0.000 loss: -8.694]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.47it/s, atk: -6.972 ent: -5.082 str: 0.000 loss: -12.054]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.44it/s, atk: -6.972 ent: -5.082 str: 0.000 loss: -12.054]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.44it/s, atk: -11.569 ent: -5.080 str: 0.000 loss: -16.649]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.41it/s, atk: -11.569 ent: -5.080 str: 0.000 loss: -16.649]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.41it/s, atk: -15.550 ent: -5.072 str: 0.000 loss: -20.622]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.40it/s, atk: -15.550 ent: -5.072 str: 0.000 loss: -20.622]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.40it/s, atk: -20.176 ent: -5.065 str: 0.000 loss: -25.242]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.35it/s, atk: -20.176 ent: -5.065 str: 0.000 loss: -25.242]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -24.251 ent: -5.066 str: 0.000 loss: -29.318]Iterations:  33%|███▎      | 10/30 [00:07<00:15,  1.33it/s, atk: -24.251 ent: -5.066 str: 0.000 loss: -29.318]Iterations:  33%|███▎      | 10/30 [00:07<00:15,  1.33it/s, atk: -29.663 ent: -5.069 str: 0.000 loss: -34.732]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.28it/s, atk: -29.663 ent: -5.069 str: 0.000 loss: -34.732]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.28it/s, atk: -32.887 ent: -5.067 str: 0.000 loss: -37.954]Iterations:  40%|████      | 12/30 [00:08<00:13,  1.34it/s, atk: -32.887 ent: -5.067 str: 0.000 loss: -37.954]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.34it/s, atk: -33.262 ent: -5.060 str: 0.000 loss: -38.322]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.38it/s, atk: -33.262 ent: -5.060 str: 0.000 loss: -38.322]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.38it/s, atk: -42.105 ent: -5.061 str: 0.000 loss: -47.165]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.39it/s, atk: -42.105 ent: -5.061 str: 0.000 loss: -47.165]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.39it/s, atk: -41.166 ent: -5.066 str: 0.000 loss: -46.232]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.38it/s, atk: -41.166 ent: -5.066 str: 0.000 loss: -46.232]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.38it/s, atk: -49.797 ent: -5.064 str: 0.000 loss: -54.861]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.38it/s, atk: -49.797 ent: -5.064 str: 0.000 loss: -54.861]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -56.373 ent: -5.067 str: 0.000 loss: -61.440]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.42it/s, atk: -56.373 ent: -5.067 str: 0.000 loss: -61.440]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.42it/s, atk: -62.758 ent: -5.065 str: 0.000 loss: -67.823]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.38it/s, atk: -62.758 ent: -5.065 str: 0.000 loss: -67.823]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.38it/s, atk: -69.086 ent: -5.063 str: 0.000 loss: -74.149]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.41it/s, atk: -69.086 ent: -5.063 str: 0.000 loss: -74.149]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -74.616 ent: -5.060 str: 0.000 loss: -79.676]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.37it/s, atk: -74.616 ent: -5.060 str: 0.000 loss: -79.676]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.37it/s, atk: -81.661 ent: -5.058 str: 0.000 loss: -86.719]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.37it/s, atk: -81.661 ent: -5.058 str: 0.000 loss: -86.719]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.37it/s, atk: -87.224 ent: -5.056 str: 0.000 loss: -92.280]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.35it/s, atk: -87.224 ent: -5.056 str: 0.000 loss: -92.280]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.35it/s, atk: -93.494 ent: -5.053 str: 0.000 loss: -98.547]Iterations:  77%|███████▋  | 23/30 [00:16<00:05,  1.30it/s, atk: -93.494 ent: -5.053 str: 0.000 loss: -98.547]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.30it/s, atk: -99.890 ent: -5.050 str: 0.000 loss: -104.940]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.28it/s, atk: -99.890 ent: -5.050 str: 0.000 loss: -104.940]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.28it/s, atk: -106.025 ent: -5.047 str: 0.000 loss: -111.072]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.30it/s, atk: -106.025 ent: -5.047 str: 0.000 loss: -111.072]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.30it/s, atk: -110.203 ent: -5.043 str: 0.000 loss: -115.246]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.34it/s, atk: -110.203 ent: -5.043 str: 0.000 loss: -115.246]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.34it/s, atk: -113.855 ent: -5.040 str: 0.000 loss: -118.895]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.34it/s, atk: -113.855 ent: -5.040 str: 0.000 loss: -118.895]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -118.666 ent: -5.039 str: 0.000 loss: -123.704]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -118.666 ent: -5.039 str: 0.000 loss: -123.704]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.43it/s, atk: -123.544 ent: -5.036 str: 0.000 loss: -128.580]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -123.544 ent: -5.036 str: 0.000 loss: -128.580]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -127.913 ent: -5.032 str: 0.000 loss: -132.945]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -127.913 ent: -5.032 str: 0.000 loss: -132.945]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -127.913 ent: -5.032 str: 0.000 loss: -132.945]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([472], device='cuda:0') tensor(0.9603, device='cuda:0')
after_true: tensor([839], device='cuda:0') tensor(2.0811e-06, device='cuda:0')
L1: [4290.333]	L2: [27.19485]	Linf: [0.7294118]

Accuracy on benign examples: 0.0%
gt_label: 497 pred_label: 818 pred_clean_logit 0.25700923800468445
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.95it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.53it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 22.73it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 22.19it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 12.31it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 13.65it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.03it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.82s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.63s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5292
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -13.809 ent: -2.595 str: 0.000 loss: -16.405]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.42s/it, atk: -13.809 ent: -2.595 str: 0.000 loss: -16.405]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.42s/it, atk: -20.812 ent: -2.577 str: 0.000 loss: -23.389]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.37s/it, atk: -20.812 ent: -2.577 str: 0.000 loss: -23.389]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.37s/it, atk: -27.454 ent: -2.577 str: 0.000 loss: -30.031]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -27.454 ent: -2.577 str: 0.000 loss: -30.031]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -32.899 ent: -2.570 str: 0.000 loss: -35.469]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -32.899 ent: -2.570 str: 0.000 loss: -35.469]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -29.758 ent: -2.550 str: 0.000 loss: -32.308]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -29.758 ent: -2.550 str: 0.000 loss: -32.308]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -33.028 ent: -2.542 str: 0.000 loss: -35.570]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -33.028 ent: -2.542 str: 0.000 loss: -35.570]Iterations:  20%|██        | 6/30 [00:06<00:17,  1.36it/s, atk: -39.487 ent: -2.536 str: 0.000 loss: -42.023]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -39.487 ent: -2.536 str: 0.000 loss: -42.023]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -45.253 ent: -2.531 str: 0.000 loss: -47.783]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.45it/s, atk: -45.253 ent: -2.531 str: 0.000 loss: -47.783]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.45it/s, atk: -50.276 ent: -2.528 str: 0.000 loss: -52.804]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.48it/s, atk: -50.276 ent: -2.528 str: 0.000 loss: -52.804]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.48it/s, atk: -54.208 ent: -2.527 str: 0.000 loss: -56.735]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -54.208 ent: -2.527 str: 0.000 loss: -56.735]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -57.192 ent: -2.528 str: 0.000 loss: -59.720]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -57.192 ent: -2.528 str: 0.000 loss: -59.720]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.49it/s, atk: -60.403 ent: -2.530 str: 0.000 loss: -62.933]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.55it/s, atk: -60.403 ent: -2.530 str: 0.000 loss: -62.933]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.55it/s, atk: -62.782 ent: -2.530 str: 0.000 loss: -65.313]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.60it/s, atk: -62.782 ent: -2.530 str: 0.000 loss: -65.313]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.60it/s, atk: -65.970 ent: -2.531 str: 0.000 loss: -68.501]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.61it/s, atk: -65.970 ent: -2.531 str: 0.000 loss: -68.501]Iterations:  47%|████▋     | 14/30 [00:11<00:09,  1.61it/s, atk: -68.913 ent: -2.530 str: 0.000 loss: -71.443]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.59it/s, atk: -68.913 ent: -2.530 str: 0.000 loss: -71.443]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.59it/s, atk: -71.656 ent: -2.529 str: 0.000 loss: -74.185]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.57it/s, atk: -71.656 ent: -2.529 str: 0.000 loss: -74.185]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.57it/s, atk: -74.852 ent: -2.527 str: 0.000 loss: -77.379]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.55it/s, atk: -74.852 ent: -2.527 str: 0.000 loss: -77.379]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.55it/s, atk: -78.064 ent: -2.526 str: 0.000 loss: -80.589]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.57it/s, atk: -78.064 ent: -2.526 str: 0.000 loss: -80.589]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.57it/s, atk: -81.024 ent: -2.524 str: 0.000 loss: -83.548]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.52it/s, atk: -81.024 ent: -2.524 str: 0.000 loss: -83.548]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.52it/s, atk: -84.551 ent: -2.523 str: 0.000 loss: -87.074]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -84.551 ent: -2.523 str: 0.000 loss: -87.074]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -88.142 ent: -2.522 str: 0.000 loss: -90.663]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -88.142 ent: -2.522 str: 0.000 loss: -90.663]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -91.626 ent: -2.519 str: 0.000 loss: -94.145]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.55it/s, atk: -91.626 ent: -2.519 str: 0.000 loss: -94.145]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.55it/s, atk: -93.941 ent: -2.516 str: 0.000 loss: -96.457]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.47it/s, atk: -93.941 ent: -2.516 str: 0.000 loss: -96.457]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -97.024 ent: -2.514 str: 0.000 loss: -99.539]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -97.024 ent: -2.514 str: 0.000 loss: -99.539]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -101.151 ent: -2.515 str: 0.000 loss: -103.666]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.54it/s, atk: -101.151 ent: -2.515 str: 0.000 loss: -103.666]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.54it/s, atk: -104.287 ent: -2.515 str: 0.000 loss: -106.802]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.50it/s, atk: -104.287 ent: -2.515 str: 0.000 loss: -106.802]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.50it/s, atk: -107.264 ent: -2.514 str: 0.000 loss: -109.779]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.34it/s, atk: -107.264 ent: -2.514 str: 0.000 loss: -109.779]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -109.904 ent: -2.514 str: 0.000 loss: -112.418]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.32it/s, atk: -109.904 ent: -2.514 str: 0.000 loss: -112.418]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.32it/s, atk: -112.497 ent: -2.514 str: 0.000 loss: -115.011]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -112.497 ent: -2.514 str: 0.000 loss: -115.011]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -114.776 ent: -2.514 str: 0.000 loss: -117.290]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -114.776 ent: -2.514 str: 0.000 loss: -117.290]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -114.776 ent: -2.514 str: 0.000 loss: -117.290]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([818], device='cuda:0') tensor(0.9655, device='cuda:0')
after_true: tensor([497], device='cuda:0') tensor(7.6148e-06, device='cuda:0')
L1: [839.14124]	L2: [6.5587335]	Linf: [0.4666667]

Accuracy on benign examples: 100.0%
gt_label: 805 pred_label: 805 pred_clean_logit 0.8519044518470764
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.75it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  8.26it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.47it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 13.94it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.12it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.36it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.64it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.02it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.45it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.19it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.74s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.54s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4337
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -16.771 ent: -4.910 str: 0.000 loss: -21.681]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.74s/it, atk: -16.771 ent: -4.910 str: 0.000 loss: -21.681]Iterations:   3%|▎         | 1/30 [00:02<00:50,  1.74s/it, atk: -19.157 ent: -4.903 str: 0.000 loss: -24.060]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -19.157 ent: -4.903 str: 0.000 loss: -24.060]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -29.917 ent: -4.900 str: 0.000 loss: -34.818]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -29.917 ent: -4.900 str: 0.000 loss: -34.818]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -43.485 ent: -4.899 str: 0.000 loss: -48.384]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -43.485 ent: -4.899 str: 0.000 loss: -48.384]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -52.825 ent: -4.892 str: 0.000 loss: -57.717]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -52.825 ent: -4.892 str: 0.000 loss: -57.717]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -60.037 ent: -4.889 str: 0.000 loss: -64.925]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.47it/s, atk: -60.037 ent: -4.889 str: 0.000 loss: -64.925]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.47it/s, atk: -67.740 ent: -4.886 str: 0.000 loss: -72.626]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.46it/s, atk: -67.740 ent: -4.886 str: 0.000 loss: -72.626]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.46it/s, atk: -73.357 ent: -4.883 str: 0.000 loss: -78.241]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -73.357 ent: -4.883 str: 0.000 loss: -78.241]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -79.620 ent: -4.880 str: 0.000 loss: -84.500]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -79.620 ent: -4.880 str: 0.000 loss: -84.500]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -84.767 ent: -4.879 str: 0.000 loss: -89.646]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.38it/s, atk: -84.767 ent: -4.879 str: 0.000 loss: -89.646]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -89.038 ent: -4.877 str: 0.000 loss: -93.915]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -89.038 ent: -4.877 str: 0.000 loss: -93.915]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -96.328 ent: -4.877 str: 0.000 loss: -101.204]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.31it/s, atk: -96.328 ent: -4.877 str: 0.000 loss: -101.204]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.31it/s, atk: -103.013 ent: -4.874 str: 0.000 loss: -107.887]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -103.013 ent: -4.874 str: 0.000 loss: -107.887]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -109.652 ent: -4.873 str: 0.000 loss: -114.525]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.35it/s, atk: -109.652 ent: -4.873 str: 0.000 loss: -114.525]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -116.925 ent: -4.874 str: 0.000 loss: -121.799]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -116.925 ent: -4.874 str: 0.000 loss: -121.799]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -123.897 ent: -4.875 str: 0.000 loss: -128.771]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -123.897 ent: -4.875 str: 0.000 loss: -128.771]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -130.946 ent: -4.874 str: 0.000 loss: -135.820]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -130.946 ent: -4.874 str: 0.000 loss: -135.820]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.56it/s, atk: -137.857 ent: -4.873 str: 0.000 loss: -142.731]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.53it/s, atk: -137.857 ent: -4.873 str: 0.000 loss: -142.731]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.53it/s, atk: -144.353 ent: -4.873 str: 0.000 loss: -149.226]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -144.353 ent: -4.873 str: 0.000 loss: -149.226]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.51it/s, atk: -151.143 ent: -4.872 str: 0.000 loss: -156.015]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -151.143 ent: -4.872 str: 0.000 loss: -156.015]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -156.227 ent: -4.872 str: 0.000 loss: -161.099]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.48it/s, atk: -156.227 ent: -4.872 str: 0.000 loss: -161.099]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.48it/s, atk: -162.524 ent: -4.873 str: 0.000 loss: -167.397]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.38it/s, atk: -162.524 ent: -4.873 str: 0.000 loss: -167.397]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.38it/s, atk: -168.075 ent: -4.874 str: 0.000 loss: -172.950]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.46it/s, atk: -168.075 ent: -4.874 str: 0.000 loss: -172.950]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -172.959 ent: -4.875 str: 0.000 loss: -177.833]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -172.959 ent: -4.875 str: 0.000 loss: -177.833]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -178.270 ent: -4.874 str: 0.000 loss: -183.143]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.40it/s, atk: -178.270 ent: -4.874 str: 0.000 loss: -183.143]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.40it/s, atk: -184.000 ent: -4.874 str: 0.000 loss: -188.874]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -184.000 ent: -4.874 str: 0.000 loss: -188.874]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -188.843 ent: -4.873 str: 0.000 loss: -193.716]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.36it/s, atk: -188.843 ent: -4.873 str: 0.000 loss: -193.716]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -194.350 ent: -4.871 str: 0.000 loss: -199.221]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.38it/s, atk: -194.350 ent: -4.871 str: 0.000 loss: -199.221]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.38it/s, atk: -199.093 ent: -4.869 str: 0.000 loss: -203.962]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -199.093 ent: -4.869 str: 0.000 loss: -203.962]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -203.777 ent: -4.869 str: 0.000 loss: -208.646]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.47it/s, atk: -203.777 ent: -4.869 str: 0.000 loss: -208.646]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -203.777 ent: -4.869 str: 0.000 loss: -208.646]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([830], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([805], device='cuda:0') tensor(9.0298e-10, device='cuda:0')
L1: [4069.851]	L2: [27.945118]	Linf: [0.8235294]

Accuracy on benign examples: 100.0%
gt_label: 326 pred_label: 326 pred_clean_logit 0.7792209386825562
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.15it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.32it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 20.99it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.88it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.89it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.78it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3941
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.572 ent: -10.316 str: 0.000 loss: -14.888]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.19s/it, atk: -4.572 ent: -10.316 str: 0.000 loss: -14.888]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.19s/it, atk: -10.096 ent: -10.323 str: 0.000 loss: -20.418]Iterations:   7%|▋         | 2/30 [00:02<00:38,  1.37s/it, atk: -10.096 ent: -10.323 str: 0.000 loss: -20.418]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.37s/it, atk: -20.827 ent: -10.302 str: 0.000 loss: -31.129]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.08s/it, atk: -20.827 ent: -10.302 str: 0.000 loss: -31.129]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.08s/it, atk: -32.605 ent: -10.301 str: 0.000 loss: -42.906]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.04it/s, atk: -32.605 ent: -10.301 str: 0.000 loss: -42.906]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.04it/s, atk: -42.310 ent: -10.286 str: 0.000 loss: -52.597]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.09it/s, atk: -42.310 ent: -10.286 str: 0.000 loss: -52.597]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.09it/s, atk: -52.816 ent: -10.283 str: 0.000 loss: -63.099]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -52.816 ent: -10.283 str: 0.000 loss: -63.099]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.25it/s, atk: -60.632 ent: -10.277 str: 0.000 loss: -70.909]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -60.632 ent: -10.277 str: 0.000 loss: -70.909]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -71.428 ent: -10.268 str: 0.000 loss: -81.696]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -71.428 ent: -10.268 str: 0.000 loss: -81.696]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -78.373 ent: -10.252 str: 0.000 loss: -88.625]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.47it/s, atk: -78.373 ent: -10.252 str: 0.000 loss: -88.625]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.47it/s, atk: -88.016 ent: -10.248 str: 0.000 loss: -98.264]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -88.016 ent: -10.248 str: 0.000 loss: -98.264]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.48it/s, atk: -93.135 ent: -10.243 str: 0.000 loss: -103.379]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.45it/s, atk: -93.135 ent: -10.243 str: 0.000 loss: -103.379]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.45it/s, atk: -100.441 ent: -10.232 str: 0.000 loss: -110.673]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.38it/s, atk: -100.441 ent: -10.232 str: 0.000 loss: -110.673]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.38it/s, atk: -110.123 ent: -10.226 str: 0.000 loss: -120.349]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.37it/s, atk: -110.123 ent: -10.226 str: 0.000 loss: -120.349]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -118.201 ent: -10.228 str: 0.000 loss: -128.429]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -118.201 ent: -10.228 str: 0.000 loss: -128.429]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -122.340 ent: -10.234 str: 0.000 loss: -132.575]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -122.340 ent: -10.234 str: 0.000 loss: -132.575]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -124.632 ent: -10.234 str: 0.000 loss: -134.865]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -124.632 ent: -10.234 str: 0.000 loss: -134.865]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.48it/s, atk: -137.071 ent: -10.247 str: 0.000 loss: -147.318]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -137.071 ent: -10.247 str: 0.000 loss: -147.318]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -141.416 ent: -10.266 str: 0.000 loss: -151.682]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -141.416 ent: -10.266 str: 0.000 loss: -151.682]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -146.507 ent: -10.274 str: 0.000 loss: -156.781]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -146.507 ent: -10.274 str: 0.000 loss: -156.781]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.41it/s, atk: -151.950 ent: -10.275 str: 0.000 loss: -162.226]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -151.950 ent: -10.275 str: 0.000 loss: -162.226]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -158.242 ent: -10.274 str: 0.000 loss: -168.516]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -158.242 ent: -10.274 str: 0.000 loss: -168.516]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -164.051 ent: -10.270 str: 0.000 loss: -174.321]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -164.051 ent: -10.270 str: 0.000 loss: -174.321]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -170.818 ent: -10.266 str: 0.000 loss: -181.084]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.41it/s, atk: -170.818 ent: -10.266 str: 0.000 loss: -181.084]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.41it/s, atk: -177.002 ent: -10.263 str: 0.000 loss: -187.264]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -177.002 ent: -10.263 str: 0.000 loss: -187.264]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -184.768 ent: -10.259 str: 0.000 loss: -195.027]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -184.768 ent: -10.259 str: 0.000 loss: -195.027]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -192.596 ent: -10.254 str: 0.000 loss: -202.850]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -192.596 ent: -10.254 str: 0.000 loss: -202.850]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -199.105 ent: -10.251 str: 0.000 loss: -209.357]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -199.105 ent: -10.251 str: 0.000 loss: -209.357]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -205.851 ent: -10.251 str: 0.000 loss: -216.101]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -205.851 ent: -10.251 str: 0.000 loss: -216.101]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -212.495 ent: -10.248 str: 0.000 loss: -222.744]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -212.495 ent: -10.248 str: 0.000 loss: -222.744]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -218.038 ent: -10.246 str: 0.000 loss: -228.284]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.49it/s, atk: -218.038 ent: -10.246 str: 0.000 loss: -228.284]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -218.038 ent: -10.246 str: 0.000 loss: -228.284]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([110], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([326], device='cuda:0') tensor(2.1222e-10, device='cuda:0')
L1: [4309.31]	L2: [28.138569]	Linf: [0.78039217]

Accuracy on benign examples: 0.0%
gt_label: 703 pred_label: 706 pred_clean_logit 0.08553332090377808
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.24it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.18it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.24it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 21.34it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.43it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.70it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.42it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.68it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.26s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.37s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.45s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3964
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -33.075 ent: -4.995 str: 0.000 loss: -38.070]Iterations:   3%|▎         | 1/30 [00:01<00:35,  1.22s/it, atk: -33.075 ent: -4.995 str: 0.000 loss: -38.070]Iterations:   3%|▎         | 1/30 [00:01<00:35,  1.22s/it, atk: -45.432 ent: -4.990 str: 0.000 loss: -50.421]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.11it/s, atk: -45.432 ent: -4.990 str: 0.000 loss: -50.421]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.11it/s, atk: -49.067 ent: -4.975 str: 0.000 loss: -54.042]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.21it/s, atk: -49.067 ent: -4.975 str: 0.000 loss: -54.042]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.21it/s, atk: -54.009 ent: -4.972 str: 0.000 loss: -58.981]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.37it/s, atk: -54.009 ent: -4.972 str: 0.000 loss: -58.981]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.37it/s, atk: -58.035 ent: -4.969 str: 0.000 loss: -63.003]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.43it/s, atk: -58.035 ent: -4.969 str: 0.000 loss: -63.003]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.43it/s, atk: -62.498 ent: -4.965 str: 0.000 loss: -67.463]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.45it/s, atk: -62.498 ent: -4.965 str: 0.000 loss: -67.463]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.45it/s, atk: -66.423 ent: -4.962 str: 0.000 loss: -71.386]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.47it/s, atk: -66.423 ent: -4.962 str: 0.000 loss: -71.386]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.47it/s, atk: -70.057 ent: -4.960 str: 0.000 loss: -75.018]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.45it/s, atk: -70.057 ent: -4.960 str: 0.000 loss: -75.018]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.45it/s, atk: -73.359 ent: -4.959 str: 0.000 loss: -78.318]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.44it/s, atk: -73.359 ent: -4.959 str: 0.000 loss: -78.318]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -76.480 ent: -4.958 str: 0.000 loss: -81.438]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.37it/s, atk: -76.480 ent: -4.958 str: 0.000 loss: -81.438]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.37it/s, atk: -79.485 ent: -4.957 str: 0.000 loss: -84.443]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.38it/s, atk: -79.485 ent: -4.957 str: 0.000 loss: -84.443]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.38it/s, atk: -83.356 ent: -4.956 str: 0.000 loss: -88.312]Iterations:  40%|████      | 12/30 [00:08<00:13,  1.37it/s, atk: -83.356 ent: -4.956 str: 0.000 loss: -88.312]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -87.374 ent: -4.955 str: 0.000 loss: -92.329]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.39it/s, atk: -87.374 ent: -4.955 str: 0.000 loss: -92.329]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -90.617 ent: -4.955 str: 0.000 loss: -95.572]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.34it/s, atk: -90.617 ent: -4.955 str: 0.000 loss: -95.572]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.34it/s, atk: -94.606 ent: -4.954 str: 0.000 loss: -99.560]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -94.606 ent: -4.954 str: 0.000 loss: -99.560]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -99.005 ent: -4.953 str: 0.000 loss: -103.958]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.33it/s, atk: -99.005 ent: -4.953 str: 0.000 loss: -103.958]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.33it/s, atk: -102.643 ent: -4.953 str: 0.000 loss: -107.596]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.35it/s, atk: -102.643 ent: -4.953 str: 0.000 loss: -107.596]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.35it/s, atk: -106.682 ent: -4.953 str: 0.000 loss: -111.635]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -106.682 ent: -4.953 str: 0.000 loss: -111.635]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -110.410 ent: -4.951 str: 0.000 loss: -115.361]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -110.410 ent: -4.951 str: 0.000 loss: -115.361]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -113.433 ent: -4.951 str: 0.000 loss: -118.384]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.37it/s, atk: -113.433 ent: -4.951 str: 0.000 loss: -118.384]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.37it/s, atk: -117.086 ent: -4.951 str: 0.000 loss: -122.037]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.46it/s, atk: -117.086 ent: -4.951 str: 0.000 loss: -122.037]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.46it/s, atk: -119.758 ent: -4.951 str: 0.000 loss: -124.710]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.47it/s, atk: -119.758 ent: -4.951 str: 0.000 loss: -124.710]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.47it/s, atk: -122.977 ent: -4.952 str: 0.000 loss: -127.929]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.46it/s, atk: -122.977 ent: -4.952 str: 0.000 loss: -127.929]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.46it/s, atk: -126.913 ent: -4.952 str: 0.000 loss: -131.866]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -126.913 ent: -4.952 str: 0.000 loss: -131.866]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -129.890 ent: -4.952 str: 0.000 loss: -134.842]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -129.890 ent: -4.952 str: 0.000 loss: -134.842]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -132.629 ent: -4.951 str: 0.000 loss: -137.580]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.45it/s, atk: -132.629 ent: -4.951 str: 0.000 loss: -137.580]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -135.620 ent: -4.951 str: 0.000 loss: -140.571]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -135.620 ent: -4.951 str: 0.000 loss: -140.571]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -138.908 ent: -4.950 str: 0.000 loss: -143.859]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -138.908 ent: -4.950 str: 0.000 loss: -143.859]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -142.039 ent: -4.950 str: 0.000 loss: -146.988]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.46it/s, atk: -142.039 ent: -4.950 str: 0.000 loss: -146.988]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -144.971 ent: -4.949 str: 0.000 loss: -149.920]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.53it/s, atk: -144.971 ent: -4.949 str: 0.000 loss: -149.920]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -144.971 ent: -4.949 str: 0.000 loss: -149.920]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([706], device='cuda:0') tensor(0.8447, device='cuda:0')
after_true: tensor([703], device='cuda:0') tensor(3.7377e-07, device='cuda:0')
L1: [3221.502]	L2: [22.01972]	Linf: [0.73333335]

Accuracy on benign examples: 100.0%
gt_label: 533 pred_label: 533 pred_clean_logit 0.9983868598937988
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.85it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.52it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.26it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.41it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.75it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.56it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 15.88it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.84it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.20it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.70it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.56s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.40s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5325
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.032 ent: -5.224 str: 0.000 loss: -5.257]Iterations:   3%|▎         | 1/30 [00:02<01:17,  2.66s/it, atk: -0.032 ent: -5.224 str: 0.000 loss: -5.257]Iterations:   3%|▎         | 1/30 [00:03<01:17,  2.66s/it, atk: -0.077 ent: -5.242 str: 0.000 loss: -5.319]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -0.077 ent: -5.242 str: 0.000 loss: -5.319]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -0.147 ent: -5.259 str: 0.000 loss: -5.405]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -0.147 ent: -5.259 str: 0.000 loss: -5.405]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -0.254 ent: -5.266 str: 0.000 loss: -5.519]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -0.254 ent: -5.266 str: 0.000 loss: -5.519]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.06it/s, atk: -0.404 ent: -5.275 str: 0.000 loss: -5.678]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -0.404 ent: -5.275 str: 0.000 loss: -5.678]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -0.297 ent: -5.275 str: 0.000 loss: -5.573]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -0.297 ent: -5.275 str: 0.000 loss: -5.573]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -0.745 ent: -5.280 str: 0.000 loss: -6.025]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -0.745 ent: -5.280 str: 0.000 loss: -6.025]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -0.726 ent: -5.276 str: 0.000 loss: -6.002]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.26it/s, atk: -0.726 ent: -5.276 str: 0.000 loss: -6.002]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.26it/s, atk: -0.772 ent: -5.273 str: 0.000 loss: -6.045]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -0.772 ent: -5.273 str: 0.000 loss: -6.045]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -1.015 ent: -5.274 str: 0.000 loss: -6.289]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.38it/s, atk: -1.015 ent: -5.274 str: 0.000 loss: -6.289]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.38it/s, atk: -1.475 ent: -5.275 str: 0.000 loss: -6.750]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.32it/s, atk: -1.475 ent: -5.275 str: 0.000 loss: -6.750]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -2.090 ent: -5.275 str: 0.000 loss: -7.365]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -2.090 ent: -5.275 str: 0.000 loss: -7.365]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.34it/s, atk: -3.044 ent: -5.273 str: 0.000 loss: -8.317]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -3.044 ent: -5.273 str: 0.000 loss: -8.317]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -4.207 ent: -5.271 str: 0.000 loss: -9.478]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -4.207 ent: -5.271 str: 0.000 loss: -9.478]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.41it/s, atk: -5.749 ent: -5.269 str: 0.000 loss: -11.018]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -5.749 ent: -5.269 str: 0.000 loss: -11.018]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.45it/s, atk: -7.393 ent: -5.265 str: 0.000 loss: -12.657]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -7.393 ent: -5.265 str: 0.000 loss: -12.657]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -9.071 ent: -5.263 str: 0.000 loss: -14.334]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.40it/s, atk: -9.071 ent: -5.263 str: 0.000 loss: -14.334]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.40it/s, atk: -10.496 ent: -5.262 str: 0.000 loss: -15.758]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.33it/s, atk: -10.496 ent: -5.262 str: 0.000 loss: -15.758]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.33it/s, atk: -11.332 ent: -5.258 str: 0.000 loss: -16.590]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.36it/s, atk: -11.332 ent: -5.258 str: 0.000 loss: -16.590]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.36it/s, atk: -13.407 ent: -5.256 str: 0.000 loss: -18.663]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.43it/s, atk: -13.407 ent: -5.256 str: 0.000 loss: -18.663]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.43it/s, atk: -15.180 ent: -5.254 str: 0.000 loss: -20.434]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.39it/s, atk: -15.180 ent: -5.254 str: 0.000 loss: -20.434]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.39it/s, atk: -16.968 ent: -5.253 str: 0.000 loss: -22.221]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -16.968 ent: -5.253 str: 0.000 loss: -22.221]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.41it/s, atk: -18.807 ent: -5.252 str: 0.000 loss: -24.059]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.48it/s, atk: -18.807 ent: -5.252 str: 0.000 loss: -24.059]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.48it/s, atk: -20.317 ent: -5.251 str: 0.000 loss: -25.568]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -20.317 ent: -5.251 str: 0.000 loss: -25.568]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.48it/s, atk: -22.616 ent: -5.250 str: 0.000 loss: -27.866]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.50it/s, atk: -22.616 ent: -5.250 str: 0.000 loss: -27.866]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.50it/s, atk: -24.764 ent: -5.249 str: 0.000 loss: -30.013]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -24.764 ent: -5.249 str: 0.000 loss: -30.013]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -26.778 ent: -5.248 str: 0.000 loss: -32.026]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.40it/s, atk: -26.778 ent: -5.248 str: 0.000 loss: -32.026]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.40it/s, atk: -28.996 ent: -5.247 str: 0.000 loss: -34.243]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.36it/s, atk: -28.996 ent: -5.247 str: 0.000 loss: -34.243]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.36it/s, atk: -31.082 ent: -5.247 str: 0.000 loss: -36.329]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -31.082 ent: -5.247 str: 0.000 loss: -36.329]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.33it/s, atk: -32.869 ent: -5.246 str: 0.000 loss: -38.115]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.36it/s, atk: -32.869 ent: -5.246 str: 0.000 loss: -38.115]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -32.869 ent: -5.246 str: 0.000 loss: -38.115]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([434], device='cuda:0') tensor(0.3605, device='cuda:0')
after_true: tensor([533], device='cuda:0') tensor(0.0312, device='cuda:0')
L1: [4413.1606]	L2: [29.25933]	Linf: [0.65882355]

Accuracy on benign examples: 100.0%
gt_label: 847 pred_label: 847 pred_clean_logit 0.9701091051101685
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.50it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.43it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.01it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.75it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.99it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.03it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.09it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.41it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.21it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.78s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5316
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.330 ent: -2.693 str: 0.000 loss: -3.024]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.96s/it, atk: -0.330 ent: -2.693 str: 0.000 loss: -3.024]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.96s/it, atk: -0.321 ent: -2.698 str: 0.000 loss: -3.018]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -0.321 ent: -2.698 str: 0.000 loss: -3.018]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -0.835 ent: -2.685 str: 0.000 loss: -3.520]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -0.835 ent: -2.685 str: 0.000 loss: -3.520]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -2.434 ent: -2.693 str: 0.000 loss: -5.127]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.13it/s, atk: -2.434 ent: -2.693 str: 0.000 loss: -5.127]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.13it/s, atk: -6.446 ent: -2.692 str: 0.000 loss: -9.138]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.15it/s, atk: -6.446 ent: -2.692 str: 0.000 loss: -9.138]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.15it/s, atk: -8.536 ent: -2.698 str: 0.000 loss: -11.234]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.20it/s, atk: -8.536 ent: -2.698 str: 0.000 loss: -11.234]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -15.587 ent: -2.698 str: 0.000 loss: -18.285]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -15.587 ent: -2.698 str: 0.000 loss: -18.285]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -20.381 ent: -2.686 str: 0.000 loss: -23.067]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.29it/s, atk: -20.381 ent: -2.686 str: 0.000 loss: -23.067]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.29it/s, atk: -27.570 ent: -2.684 str: 0.000 loss: -30.254]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.32it/s, atk: -27.570 ent: -2.684 str: 0.000 loss: -30.254]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -25.926 ent: -2.689 str: 0.000 loss: -28.615]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -25.926 ent: -2.689 str: 0.000 loss: -28.615]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.32it/s, atk: -35.145 ent: -2.691 str: 0.000 loss: -37.836]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.25it/s, atk: -35.145 ent: -2.691 str: 0.000 loss: -37.836]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.25it/s, atk: -44.438 ent: -2.693 str: 0.000 loss: -47.131]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.25it/s, atk: -44.438 ent: -2.693 str: 0.000 loss: -47.131]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.25it/s, atk: -52.629 ent: -2.694 str: 0.000 loss: -55.323]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.25it/s, atk: -52.629 ent: -2.694 str: 0.000 loss: -55.323]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.25it/s, atk: -60.395 ent: -2.692 str: 0.000 loss: -63.088]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.30it/s, atk: -60.395 ent: -2.692 str: 0.000 loss: -63.088]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.30it/s, atk: -67.738 ent: -2.690 str: 0.000 loss: -70.428]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.39it/s, atk: -67.738 ent: -2.690 str: 0.000 loss: -70.428]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.39it/s, atk: -74.223 ent: -2.687 str: 0.000 loss: -76.910]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -74.223 ent: -2.687 str: 0.000 loss: -76.910]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -82.156 ent: -2.689 str: 0.000 loss: -84.844]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.36it/s, atk: -82.156 ent: -2.689 str: 0.000 loss: -84.844]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.36it/s, atk: -86.287 ent: -2.689 str: 0.000 loss: -88.977]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.32it/s, atk: -86.287 ent: -2.689 str: 0.000 loss: -88.977]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.32it/s, atk: -92.688 ent: -2.688 str: 0.000 loss: -95.376]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.31it/s, atk: -92.688 ent: -2.688 str: 0.000 loss: -95.376]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.31it/s, atk: -100.110 ent: -2.685 str: 0.000 loss: -102.795]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.26it/s, atk: -100.110 ent: -2.685 str: 0.000 loss: -102.795]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.26it/s, atk: -107.629 ent: -2.683 str: 0.000 loss: -110.312]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.27it/s, atk: -107.629 ent: -2.683 str: 0.000 loss: -110.312]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.27it/s, atk: -112.675 ent: -2.684 str: 0.000 loss: -115.359]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.25it/s, atk: -112.675 ent: -2.684 str: 0.000 loss: -115.359]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.25it/s, atk: -118.974 ent: -2.682 str: 0.000 loss: -121.656]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.43it/s, atk: -118.974 ent: -2.682 str: 0.000 loss: -121.656]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.43it/s, atk: -123.947 ent: -2.682 str: 0.000 loss: -126.629]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.43it/s, atk: -123.947 ent: -2.682 str: 0.000 loss: -126.629]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.43it/s, atk: -129.526 ent: -2.683 str: 0.000 loss: -132.210]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -129.526 ent: -2.683 str: 0.000 loss: -132.210]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.41it/s, atk: -134.885 ent: -2.682 str: 0.000 loss: -137.567]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.36it/s, atk: -134.885 ent: -2.682 str: 0.000 loss: -137.567]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.36it/s, atk: -138.864 ent: -2.681 str: 0.000 loss: -141.545]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -138.864 ent: -2.681 str: 0.000 loss: -141.545]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -147.301 ent: -2.680 str: 0.000 loss: -149.981]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -147.301 ent: -2.680 str: 0.000 loss: -149.981]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -150.936 ent: -2.677 str: 0.000 loss: -153.613]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.41it/s, atk: -150.936 ent: -2.677 str: 0.000 loss: -153.613]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.41it/s, atk: -156.963 ent: -2.680 str: 0.000 loss: -159.643]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.38it/s, atk: -156.963 ent: -2.680 str: 0.000 loss: -159.643]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -156.963 ent: -2.680 str: 0.000 loss: -159.643]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([586], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([847], device='cuda:0') tensor(9.2534e-08, device='cuda:0')
L1: [2886.4785]	L2: [19.445038]	Linf: [0.517647]

Accuracy on benign examples: 100.0%
gt_label: 311 pred_label: 311 pred_clean_logit 0.7806981801986694
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.83it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.21it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.01it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.07it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.28it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 16.86it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.72it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.93it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.24it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.39it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.29s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.24s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4576
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.056 ent: -2.580 str: 0.000 loss: -4.636]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.02s/it, atk: -2.056 ent: -2.580 str: 0.000 loss: -4.636]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.02s/it, atk: -4.745 ent: -2.576 str: 0.000 loss: -7.320]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.28s/it, atk: -4.745 ent: -2.576 str: 0.000 loss: -7.320]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.28s/it, atk: -8.269 ent: -2.571 str: 0.000 loss: -10.839]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.09s/it, atk: -8.269 ent: -2.571 str: 0.000 loss: -10.839]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.09s/it, atk: -16.570 ent: -2.562 str: 0.000 loss: -19.132]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.00it/s, atk: -16.570 ent: -2.562 str: 0.000 loss: -19.132]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.00it/s, atk: -35.538 ent: -2.561 str: 0.000 loss: -38.099]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -35.538 ent: -2.561 str: 0.000 loss: -38.099]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -49.170 ent: -2.556 str: 0.000 loss: -51.726]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.19it/s, atk: -49.170 ent: -2.556 str: 0.000 loss: -51.726]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -51.594 ent: -2.554 str: 0.000 loss: -54.147]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -51.594 ent: -2.554 str: 0.000 loss: -54.147]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -59.680 ent: -2.557 str: 0.000 loss: -62.237]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -59.680 ent: -2.557 str: 0.000 loss: -62.237]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -69.776 ent: -2.558 str: 0.000 loss: -72.334]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -69.776 ent: -2.558 str: 0.000 loss: -72.334]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -77.124 ent: -2.558 str: 0.000 loss: -79.682]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.26it/s, atk: -77.124 ent: -2.558 str: 0.000 loss: -79.682]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.26it/s, atk: -85.754 ent: -2.559 str: 0.000 loss: -88.313]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -85.754 ent: -2.559 str: 0.000 loss: -88.313]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.31it/s, atk: -96.358 ent: -2.558 str: 0.000 loss: -98.917]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.33it/s, atk: -96.358 ent: -2.558 str: 0.000 loss: -98.917]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.33it/s, atk: -100.613 ent: -2.559 str: 0.000 loss: -103.172]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.27it/s, atk: -100.613 ent: -2.559 str: 0.000 loss: -103.172]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.27it/s, atk: -103.203 ent: -2.560 str: 0.000 loss: -105.764]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.29it/s, atk: -103.203 ent: -2.560 str: 0.000 loss: -105.764]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.29it/s, atk: -111.422 ent: -2.560 str: 0.000 loss: -113.982]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.36it/s, atk: -111.422 ent: -2.560 str: 0.000 loss: -113.982]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.36it/s, atk: -116.238 ent: -2.561 str: 0.000 loss: -118.799]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.46it/s, atk: -116.238 ent: -2.561 str: 0.000 loss: -118.799]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.46it/s, atk: -125.081 ent: -2.565 str: 0.000 loss: -127.646]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -125.081 ent: -2.565 str: 0.000 loss: -127.646]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.40it/s, atk: -129.291 ent: -2.567 str: 0.000 loss: -131.858]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -129.291 ent: -2.567 str: 0.000 loss: -131.858]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.41it/s, atk: -135.428 ent: -2.566 str: 0.000 loss: -137.994]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -135.428 ent: -2.566 str: 0.000 loss: -137.994]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -138.851 ent: -2.564 str: 0.000 loss: -141.415]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -138.851 ent: -2.564 str: 0.000 loss: -141.415]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -143.773 ent: -2.563 str: 0.000 loss: -146.336]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.44it/s, atk: -143.773 ent: -2.563 str: 0.000 loss: -146.336]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.44it/s, atk: -148.883 ent: -2.561 str: 0.000 loss: -151.445]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -148.883 ent: -2.561 str: 0.000 loss: -151.445]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -150.309 ent: -2.559 str: 0.000 loss: -152.868]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -150.309 ent: -2.559 str: 0.000 loss: -152.868]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -155.035 ent: -2.558 str: 0.000 loss: -157.594]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -155.035 ent: -2.558 str: 0.000 loss: -157.594]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.41it/s, atk: -159.191 ent: -2.559 str: 0.000 loss: -161.750]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -159.191 ent: -2.559 str: 0.000 loss: -161.750]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -163.459 ent: -2.559 str: 0.000 loss: -166.018]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.46it/s, atk: -163.459 ent: -2.559 str: 0.000 loss: -166.018]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.46it/s, atk: -167.612 ent: -2.560 str: 0.000 loss: -170.172]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.46it/s, atk: -167.612 ent: -2.560 str: 0.000 loss: -170.172]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.46it/s, atk: -171.467 ent: -2.560 str: 0.000 loss: -174.027]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -171.467 ent: -2.560 str: 0.000 loss: -174.027]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.44it/s, atk: -175.860 ent: -2.560 str: 0.000 loss: -178.421]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -175.860 ent: -2.560 str: 0.000 loss: -178.421]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -179.873 ent: -2.561 str: 0.000 loss: -182.434]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.50it/s, atk: -179.873 ent: -2.561 str: 0.000 loss: -182.434]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -179.873 ent: -2.561 str: 0.000 loss: -182.434]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([77], device='cuda:0') tensor(0.9530, device='cuda:0')
after_true: tensor([311], device='cuda:0') tensor(1.0698e-08, device='cuda:0')
L1: [3757.9097]	L2: [24.264605]	Linf: [0.62745094]

Accuracy on benign examples: 100.0%
gt_label: 923 pred_label: 923 pred_clean_logit 0.7175568342208862
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.95it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.41it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.79it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.10it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.88it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.34it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 16.33it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.13it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.47it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.25s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.37s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3550
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.946 ent: -2.544 str: 0.000 loss: -5.490]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.59s/it, atk: -2.946 ent: -2.544 str: 0.000 loss: -5.490]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.59s/it, atk: -5.882 ent: -2.541 str: 0.000 loss: -8.423]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -5.882 ent: -2.541 str: 0.000 loss: -8.423]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -7.815 ent: -2.537 str: 0.000 loss: -10.352]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -7.815 ent: -2.537 str: 0.000 loss: -10.352]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -10.287 ent: -2.532 str: 0.000 loss: -12.820]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.15it/s, atk: -10.287 ent: -2.532 str: 0.000 loss: -12.820]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -12.901 ent: -2.528 str: 0.000 loss: -15.429]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.19it/s, atk: -12.901 ent: -2.528 str: 0.000 loss: -15.429]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.19it/s, atk: -15.765 ent: -2.524 str: 0.000 loss: -18.289]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.23it/s, atk: -15.765 ent: -2.524 str: 0.000 loss: -18.289]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.23it/s, atk: -18.802 ent: -2.521 str: 0.000 loss: -21.324]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -18.802 ent: -2.521 str: 0.000 loss: -21.324]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -21.586 ent: -2.520 str: 0.000 loss: -24.106]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.29it/s, atk: -21.586 ent: -2.520 str: 0.000 loss: -24.106]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.29it/s, atk: -24.962 ent: -2.518 str: 0.000 loss: -27.480]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -24.962 ent: -2.518 str: 0.000 loss: -27.480]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -28.102 ent: -2.518 str: 0.000 loss: -30.621]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -28.102 ent: -2.518 str: 0.000 loss: -30.621]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -31.850 ent: -2.519 str: 0.000 loss: -34.368]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.44it/s, atk: -31.850 ent: -2.519 str: 0.000 loss: -34.368]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -34.663 ent: -2.519 str: 0.000 loss: -37.182]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -34.663 ent: -2.519 str: 0.000 loss: -37.182]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -38.147 ent: -2.518 str: 0.000 loss: -40.665]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.43it/s, atk: -38.147 ent: -2.518 str: 0.000 loss: -40.665]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.43it/s, atk: -42.019 ent: -2.517 str: 0.000 loss: -44.536]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.38it/s, atk: -42.019 ent: -2.517 str: 0.000 loss: -44.536]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.38it/s, atk: -45.414 ent: -2.517 str: 0.000 loss: -47.932]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.38it/s, atk: -45.414 ent: -2.517 str: 0.000 loss: -47.932]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -48.334 ent: -2.517 str: 0.000 loss: -50.851]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -48.334 ent: -2.517 str: 0.000 loss: -50.851]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -51.864 ent: -2.516 str: 0.000 loss: -54.380]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.47it/s, atk: -51.864 ent: -2.516 str: 0.000 loss: -54.380]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -54.870 ent: -2.515 str: 0.000 loss: -57.385]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -54.870 ent: -2.515 str: 0.000 loss: -57.385]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -58.026 ent: -2.516 str: 0.000 loss: -60.542]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -58.026 ent: -2.516 str: 0.000 loss: -60.542]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -61.113 ent: -2.515 str: 0.000 loss: -63.629]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -61.113 ent: -2.515 str: 0.000 loss: -63.629]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -64.011 ent: -2.517 str: 0.000 loss: -66.528]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -64.011 ent: -2.517 str: 0.000 loss: -66.528]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -65.898 ent: -2.516 str: 0.000 loss: -68.414]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -65.898 ent: -2.516 str: 0.000 loss: -68.414]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -67.912 ent: -2.515 str: 0.000 loss: -70.427]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -67.912 ent: -2.515 str: 0.000 loss: -70.427]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -70.556 ent: -2.514 str: 0.000 loss: -73.070]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.45it/s, atk: -70.556 ent: -2.514 str: 0.000 loss: -73.070]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -72.247 ent: -2.513 str: 0.000 loss: -74.760]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.35it/s, atk: -72.247 ent: -2.513 str: 0.000 loss: -74.760]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.35it/s, atk: -74.658 ent: -2.513 str: 0.000 loss: -77.171]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -74.658 ent: -2.513 str: 0.000 loss: -77.171]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -76.847 ent: -2.513 str: 0.000 loss: -79.360]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -76.847 ent: -2.513 str: 0.000 loss: -79.360]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -78.663 ent: -2.513 str: 0.000 loss: -81.176]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.17it/s, atk: -78.663 ent: -2.513 str: 0.000 loss: -81.176]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.17it/s, atk: -81.276 ent: -2.512 str: 0.000 loss: -83.788]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.22it/s, atk: -81.276 ent: -2.512 str: 0.000 loss: -83.788]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.22it/s, atk: -83.359 ent: -2.512 str: 0.000 loss: -85.872]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.30it/s, atk: -83.359 ent: -2.512 str: 0.000 loss: -85.872]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -83.359 ent: -2.512 str: 0.000 loss: -85.872]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([809], device='cuda:0') tensor(0.9606, device='cuda:0')
after_true: tensor([923], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [3075.9062]	L2: [22.721249]	Linf: [0.7294118]

Accuracy on benign examples: 100.0%
gt_label: 948 pred_label: 948 pred_clean_logit 0.48997068405151367
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 18.92it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.99it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.85it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.13it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.20it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.98it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 21.45it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.90it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.53s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.53s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4368
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.278 ent: -4.694 str: 0.000 loss: -8.972]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.31s/it, atk: -4.278 ent: -4.694 str: 0.000 loss: -8.972]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.31s/it, atk: -7.965 ent: -4.687 str: 0.000 loss: -12.652]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.01s/it, atk: -7.965 ent: -4.687 str: 0.000 loss: -12.652]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.01s/it, atk: -12.484 ent: -4.672 str: 0.000 loss: -17.157]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.26it/s, atk: -12.484 ent: -4.672 str: 0.000 loss: -17.157]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.26it/s, atk: -24.881 ent: -4.670 str: 0.000 loss: -29.551]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -24.881 ent: -4.670 str: 0.000 loss: -29.551]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -32.528 ent: -4.666 str: 0.000 loss: -37.194]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.44it/s, atk: -32.528 ent: -4.666 str: 0.000 loss: -37.194]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.44it/s, atk: -42.039 ent: -4.666 str: 0.000 loss: -46.705]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.42it/s, atk: -42.039 ent: -4.666 str: 0.000 loss: -46.705]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.42it/s, atk: -40.035 ent: -4.670 str: 0.000 loss: -44.705]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.33it/s, atk: -40.035 ent: -4.670 str: 0.000 loss: -44.705]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.33it/s, atk: -34.062 ent: -4.670 str: 0.000 loss: -38.732]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -34.062 ent: -4.670 str: 0.000 loss: -38.732]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -35.904 ent: -4.668 str: 0.000 loss: -40.572]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.44it/s, atk: -35.904 ent: -4.668 str: 0.000 loss: -40.572]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -42.617 ent: -4.666 str: 0.000 loss: -47.283]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.39it/s, atk: -42.617 ent: -4.666 str: 0.000 loss: -47.283]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.39it/s, atk: -46.958 ent: -4.663 str: 0.000 loss: -51.621]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -46.958 ent: -4.663 str: 0.000 loss: -51.621]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -53.540 ent: -4.659 str: 0.000 loss: -58.199]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -53.540 ent: -4.659 str: 0.000 loss: -58.199]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -55.425 ent: -4.658 str: 0.000 loss: -60.083]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.43it/s, atk: -55.425 ent: -4.658 str: 0.000 loss: -60.083]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.43it/s, atk: -58.581 ent: -4.657 str: 0.000 loss: -63.238]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -58.581 ent: -4.657 str: 0.000 loss: -63.238]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -59.479 ent: -4.657 str: 0.000 loss: -64.136]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.36it/s, atk: -59.479 ent: -4.657 str: 0.000 loss: -64.136]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.36it/s, atk: -68.497 ent: -4.658 str: 0.000 loss: -73.156]Iterations:  53%|█████▎    | 16/30 [00:12<00:11,  1.26it/s, atk: -68.497 ent: -4.658 str: 0.000 loss: -73.156]Iterations:  53%|█████▎    | 16/30 [00:12<00:11,  1.26it/s, atk: -77.071 ent: -4.659 str: 0.000 loss: -81.729]Iterations:  57%|█████▋    | 17/30 [00:12<00:10,  1.29it/s, atk: -77.071 ent: -4.659 str: 0.000 loss: -81.729]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.29it/s, atk: -80.307 ent: -4.660 str: 0.000 loss: -84.966]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -80.307 ent: -4.660 str: 0.000 loss: -84.966]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -79.792 ent: -4.660 str: 0.000 loss: -84.453]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.29it/s, atk: -79.792 ent: -4.660 str: 0.000 loss: -84.453]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.29it/s, atk: -82.723 ent: -4.660 str: 0.000 loss: -87.383]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.28it/s, atk: -82.723 ent: -4.660 str: 0.000 loss: -87.383]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.28it/s, atk: -84.712 ent: -4.659 str: 0.000 loss: -89.371]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.32it/s, atk: -84.712 ent: -4.659 str: 0.000 loss: -89.371]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.32it/s, atk: -91.834 ent: -4.658 str: 0.000 loss: -96.492]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.34it/s, atk: -91.834 ent: -4.658 str: 0.000 loss: -96.492]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -97.832 ent: -4.657 str: 0.000 loss: -102.489]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.34it/s, atk: -97.832 ent: -4.657 str: 0.000 loss: -102.489]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.34it/s, atk: -100.266 ent: -4.656 str: 0.000 loss: -104.922]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -100.266 ent: -4.656 str: 0.000 loss: -104.922]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -104.302 ent: -4.656 str: 0.000 loss: -108.958]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.37it/s, atk: -104.302 ent: -4.656 str: 0.000 loss: -108.958]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.37it/s, atk: -106.862 ent: -4.657 str: 0.000 loss: -111.519]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -106.862 ent: -4.657 str: 0.000 loss: -111.519]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -111.282 ent: -4.656 str: 0.000 loss: -115.938]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.38it/s, atk: -111.282 ent: -4.656 str: 0.000 loss: -115.938]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.38it/s, atk: -114.969 ent: -4.656 str: 0.000 loss: -119.625]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.37it/s, atk: -114.969 ent: -4.656 str: 0.000 loss: -119.625]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -118.098 ent: -4.657 str: 0.000 loss: -122.755]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -118.098 ent: -4.657 str: 0.000 loss: -122.755]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -123.672 ent: -4.657 str: 0.000 loss: -128.328]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.44it/s, atk: -123.672 ent: -4.657 str: 0.000 loss: -128.328]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -123.672 ent: -4.657 str: 0.000 loss: -128.328]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([955], device='cuda:0') tensor(0.9789, device='cuda:0')
after_true: tensor([948], device='cuda:0') tensor(2.7248e-06, device='cuda:0')
L1: [5600.0864]	L2: [34.201607]	Linf: [0.8117647]

Accuracy on benign examples: 100.0%
gt_label: 385 pred_label: 385 pred_clean_logit 0.7151691913604736
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.50it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 13.14it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.16it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.59it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.39it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.62it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.09it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 18.13it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.80it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.23it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.82s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.53s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3513
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -2.298 ent: -5.160 str: 0.000 loss: -7.459]Iterations:   3%|▎         | 1/30 [00:01<00:35,  1.24s/it, atk: -2.298 ent: -5.160 str: 0.000 loss: -7.459]Iterations:   3%|▎         | 1/30 [00:01<00:35,  1.24s/it, atk: -4.055 ent: -5.187 str: 0.000 loss: -9.241]Iterations:   7%|▋         | 2/30 [00:01<00:26,  1.05it/s, atk: -4.055 ent: -5.187 str: 0.000 loss: -9.241]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.05it/s, atk: -7.938 ent: -5.204 str: 0.000 loss: -13.142]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.16it/s, atk: -7.938 ent: -5.204 str: 0.000 loss: -13.142]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.16it/s, atk: -15.779 ent: -5.208 str: 0.000 loss: -20.987]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -15.779 ent: -5.208 str: 0.000 loss: -20.987]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -16.200 ent: -5.208 str: 0.000 loss: -21.407]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -16.200 ent: -5.208 str: 0.000 loss: -21.407]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -25.983 ent: -5.206 str: 0.000 loss: -31.190]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.33it/s, atk: -25.983 ent: -5.206 str: 0.000 loss: -31.190]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -41.629 ent: -5.206 str: 0.000 loss: -46.836]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.33it/s, atk: -41.629 ent: -5.206 str: 0.000 loss: -46.836]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.33it/s, atk: -46.522 ent: -5.204 str: 0.000 loss: -51.726]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -46.522 ent: -5.204 str: 0.000 loss: -51.726]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -54.888 ent: -5.204 str: 0.000 loss: -60.092]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -54.888 ent: -5.204 str: 0.000 loss: -60.092]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -65.536 ent: -5.204 str: 0.000 loss: -70.740]Iterations:  33%|███▎      | 10/30 [00:07<00:15,  1.33it/s, atk: -65.536 ent: -5.204 str: 0.000 loss: -70.740]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.33it/s, atk: -76.775 ent: -5.204 str: 0.000 loss: -81.979]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.30it/s, atk: -76.775 ent: -5.204 str: 0.000 loss: -81.979]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.30it/s, atk: -87.166 ent: -5.205 str: 0.000 loss: -92.371]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -87.166 ent: -5.205 str: 0.000 loss: -92.371]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -93.568 ent: -5.204 str: 0.000 loss: -98.772]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.37it/s, atk: -93.568 ent: -5.204 str: 0.000 loss: -98.772]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.37it/s, atk: -102.265 ent: -5.206 str: 0.000 loss: -107.471]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -102.265 ent: -5.206 str: 0.000 loss: -107.471]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -111.074 ent: -5.208 str: 0.000 loss: -116.282]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.61it/s, atk: -111.074 ent: -5.208 str: 0.000 loss: -116.282]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.61it/s, atk: -118.682 ent: -5.207 str: 0.000 loss: -123.889]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.71it/s, atk: -118.682 ent: -5.207 str: 0.000 loss: -123.889]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.71it/s, atk: -125.057 ent: -5.206 str: 0.000 loss: -130.263]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.65it/s, atk: -125.057 ent: -5.206 str: 0.000 loss: -130.263]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.65it/s, atk: -131.323 ent: -5.205 str: 0.000 loss: -136.527]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.55it/s, atk: -131.323 ent: -5.205 str: 0.000 loss: -136.527]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.55it/s, atk: -138.433 ent: -5.202 str: 0.000 loss: -143.635]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.58it/s, atk: -138.433 ent: -5.202 str: 0.000 loss: -143.635]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.58it/s, atk: -145.937 ent: -5.203 str: 0.000 loss: -151.140]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.55it/s, atk: -145.937 ent: -5.203 str: 0.000 loss: -151.140]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.55it/s, atk: -152.894 ent: -5.203 str: 0.000 loss: -158.097]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.53it/s, atk: -152.894 ent: -5.203 str: 0.000 loss: -158.097]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.53it/s, atk: -159.407 ent: -5.202 str: 0.000 loss: -164.609]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.48it/s, atk: -159.407 ent: -5.202 str: 0.000 loss: -164.609]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -164.585 ent: -5.203 str: 0.000 loss: -169.789]Iterations:  77%|███████▋  | 23/30 [00:16<00:05,  1.37it/s, atk: -164.585 ent: -5.203 str: 0.000 loss: -169.789]Iterations:  77%|███████▋  | 23/30 [00:16<00:05,  1.37it/s, atk: -172.068 ent: -5.202 str: 0.000 loss: -177.270]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -172.068 ent: -5.202 str: 0.000 loss: -177.270]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -176.597 ent: -5.202 str: 0.000 loss: -181.799]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.47it/s, atk: -176.597 ent: -5.202 str: 0.000 loss: -181.799]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -180.611 ent: -5.202 str: 0.000 loss: -185.813]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.47it/s, atk: -180.611 ent: -5.202 str: 0.000 loss: -185.813]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.47it/s, atk: -185.351 ent: -5.202 str: 0.000 loss: -190.553]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -185.351 ent: -5.202 str: 0.000 loss: -190.553]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -190.785 ent: -5.203 str: 0.000 loss: -195.988]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.38it/s, atk: -190.785 ent: -5.203 str: 0.000 loss: -195.988]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.38it/s, atk: -196.388 ent: -5.203 str: 0.000 loss: -201.591]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.40it/s, atk: -196.388 ent: -5.203 str: 0.000 loss: -201.591]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -201.255 ent: -5.202 str: 0.000 loss: -206.457]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -201.255 ent: -5.202 str: 0.000 loss: -206.457]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -201.255 ent: -5.202 str: 0.000 loss: -206.457]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([345], device='cuda:0') tensor(0.9383, device='cuda:0')
after_true: tensor([385], device='cuda:0') tensor(1.0020e-09, device='cuda:0')
L1: [2993.3416]	L2: [19.586115]	Linf: [0.6431373]

Accuracy on benign examples: 100.0%
gt_label: 915 pred_label: 915 pred_clean_logit 0.9999905824661255
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.53it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.62it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.86it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.80it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.43it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.21it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 13.88it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 14.43it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.10s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.26s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.33s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3039
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -5.784 str: 0.000 loss: -5.787]Iterations:   3%|▎         | 1/30 [00:02<01:02,  2.15s/it, atk: -0.003 ent: -5.784 str: 0.000 loss: -5.787]Iterations:   3%|▎         | 1/30 [00:02<01:02,  2.15s/it, atk: -0.016 ent: -5.792 str: 0.000 loss: -5.808]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -0.016 ent: -5.792 str: 0.000 loss: -5.808]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -0.055 ent: -5.821 str: 0.000 loss: -5.877]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.04it/s, atk: -0.055 ent: -5.821 str: 0.000 loss: -5.877]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.04it/s, atk: -0.276 ent: -5.841 str: 0.000 loss: -6.117]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -0.276 ent: -5.841 str: 0.000 loss: -6.117]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -1.192 ent: -5.849 str: 0.000 loss: -7.041]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -1.192 ent: -5.849 str: 0.000 loss: -7.041]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.24it/s, atk: -3.011 ent: -5.836 str: 0.000 loss: -8.847]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -3.011 ent: -5.836 str: 0.000 loss: -8.847]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -6.887 ent: -5.830 str: 0.000 loss: -12.717]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -6.887 ent: -5.830 str: 0.000 loss: -12.717]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -14.013 ent: -5.835 str: 0.000 loss: -19.849]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -14.013 ent: -5.835 str: 0.000 loss: -19.849]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -24.560 ent: -5.840 str: 0.000 loss: -30.400]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.32it/s, atk: -24.560 ent: -5.840 str: 0.000 loss: -30.400]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -30.787 ent: -5.850 str: 0.000 loss: -36.636]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -30.787 ent: -5.850 str: 0.000 loss: -36.636]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -45.475 ent: -5.830 str: 0.000 loss: -51.306]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.32it/s, atk: -45.475 ent: -5.830 str: 0.000 loss: -51.306]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.32it/s, atk: -55.593 ent: -5.821 str: 0.000 loss: -61.414]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.27it/s, atk: -55.593 ent: -5.821 str: 0.000 loss: -61.414]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.27it/s, atk: -60.654 ent: -5.816 str: 0.000 loss: -66.470]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.37it/s, atk: -60.654 ent: -5.816 str: 0.000 loss: -66.470]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -71.532 ent: -5.812 str: 0.000 loss: -77.344]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -71.532 ent: -5.812 str: 0.000 loss: -77.344]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -81.424 ent: -5.808 str: 0.000 loss: -87.232]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -81.424 ent: -5.808 str: 0.000 loss: -87.232]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -86.875 ent: -5.807 str: 0.000 loss: -92.682]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.33it/s, atk: -86.875 ent: -5.807 str: 0.000 loss: -92.682]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -93.591 ent: -5.806 str: 0.000 loss: -99.396]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.36it/s, atk: -93.591 ent: -5.806 str: 0.000 loss: -99.396]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.36it/s, atk: -100.407 ent: -5.802 str: 0.000 loss: -106.210]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -100.407 ent: -5.802 str: 0.000 loss: -106.210]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -108.014 ent: -5.805 str: 0.000 loss: -113.819]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.43it/s, atk: -108.014 ent: -5.805 str: 0.000 loss: -113.819]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.43it/s, atk: -113.347 ent: -5.806 str: 0.000 loss: -119.153]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.37it/s, atk: -113.347 ent: -5.806 str: 0.000 loss: -119.153]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.37it/s, atk: -113.977 ent: -5.798 str: 0.000 loss: -119.775]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -113.977 ent: -5.798 str: 0.000 loss: -119.775]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.28it/s, atk: -119.104 ent: -5.792 str: 0.000 loss: -124.896]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.29it/s, atk: -119.104 ent: -5.792 str: 0.000 loss: -124.896]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.29it/s, atk: -126.678 ent: -5.795 str: 0.000 loss: -132.473]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.30it/s, atk: -126.678 ent: -5.795 str: 0.000 loss: -132.473]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.30it/s, atk: -131.754 ent: -5.796 str: 0.000 loss: -137.550]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.26it/s, atk: -131.754 ent: -5.796 str: 0.000 loss: -137.550]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.26it/s, atk: -137.354 ent: -5.792 str: 0.000 loss: -143.146]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.35it/s, atk: -137.354 ent: -5.792 str: 0.000 loss: -143.146]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.35it/s, atk: -143.363 ent: -5.792 str: 0.000 loss: -149.154]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -143.363 ent: -5.792 str: 0.000 loss: -149.154]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -149.323 ent: -5.791 str: 0.000 loss: -155.114]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.37it/s, atk: -149.323 ent: -5.791 str: 0.000 loss: -155.114]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.37it/s, atk: -153.909 ent: -5.789 str: 0.000 loss: -159.699]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.31it/s, atk: -153.909 ent: -5.789 str: 0.000 loss: -159.699]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.31it/s, atk: -157.579 ent: -5.788 str: 0.000 loss: -163.367]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -157.579 ent: -5.788 str: 0.000 loss: -163.367]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.33it/s, atk: -162.808 ent: -5.788 str: 0.000 loss: -168.596]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -162.808 ent: -5.788 str: 0.000 loss: -168.596]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -162.808 ent: -5.788 str: 0.000 loss: -168.596]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([727], device='cuda:0') tensor(0.9974, device='cuda:0')
after_true: tensor([915], device='cuda:0') tensor(4.9205e-08, device='cuda:0')
L1: [3025.5527]	L2: [21.054874]	Linf: [0.6901961]

Accuracy on benign examples: 100.0%
gt_label: 768 pred_label: 768 pred_clean_logit 0.37610068917274475
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:12,  1.41it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:02,  5.79it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  8.26it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:01<00:00, 11.55it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 14.34it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 14.87it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 11.55it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.50s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.37s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.39s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4138
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -10.655 ent: -5.261 str: 0.000 loss: -15.916]Iterations:   3%|▎         | 1/30 [00:01<00:37,  1.28s/it, atk: -10.655 ent: -5.261 str: 0.000 loss: -15.916]Iterations:   3%|▎         | 1/30 [00:01<00:37,  1.28s/it, atk: -17.701 ent: -5.287 str: 0.000 loss: -22.989]Iterations:   7%|▋         | 2/30 [00:01<00:24,  1.14it/s, atk: -17.701 ent: -5.287 str: 0.000 loss: -22.989]Iterations:   7%|▋         | 2/30 [00:02<00:24,  1.14it/s, atk: -24.889 ent: -5.303 str: 0.000 loss: -30.192]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.24it/s, atk: -24.889 ent: -5.303 str: 0.000 loss: -30.192]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.24it/s, atk: -32.616 ent: -5.312 str: 0.000 loss: -37.929]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.31it/s, atk: -32.616 ent: -5.312 str: 0.000 loss: -37.929]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.31it/s, atk: -40.066 ent: -5.299 str: 0.000 loss: -45.365]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -40.066 ent: -5.299 str: 0.000 loss: -45.365]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -45.195 ent: -5.289 str: 0.000 loss: -50.484]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.40it/s, atk: -45.195 ent: -5.289 str: 0.000 loss: -50.484]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.40it/s, atk: -47.111 ent: -5.270 str: 0.000 loss: -52.381]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.40it/s, atk: -47.111 ent: -5.270 str: 0.000 loss: -52.381]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.40it/s, atk: -50.984 ent: -5.261 str: 0.000 loss: -56.245]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.44it/s, atk: -50.984 ent: -5.261 str: 0.000 loss: -56.245]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.44it/s, atk: -58.333 ent: -5.256 str: 0.000 loss: -63.589]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.48it/s, atk: -58.333 ent: -5.256 str: 0.000 loss: -63.589]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.48it/s, atk: -61.578 ent: -5.281 str: 0.000 loss: -66.859]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.44it/s, atk: -61.578 ent: -5.281 str: 0.000 loss: -66.859]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.44it/s, atk: -66.566 ent: -5.282 str: 0.000 loss: -71.847]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.35it/s, atk: -66.566 ent: -5.282 str: 0.000 loss: -71.847]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.35it/s, atk: -70.141 ent: -5.293 str: 0.000 loss: -75.434]Iterations:  40%|████      | 12/30 [00:08<00:13,  1.36it/s, atk: -70.141 ent: -5.293 str: 0.000 loss: -75.434]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -69.444 ent: -5.311 str: 0.000 loss: -74.754]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -69.444 ent: -5.311 str: 0.000 loss: -74.754]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -75.085 ent: -5.297 str: 0.000 loss: -80.382]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -75.085 ent: -5.297 str: 0.000 loss: -80.382]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -78.253 ent: -5.293 str: 0.000 loss: -83.546]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -78.253 ent: -5.293 str: 0.000 loss: -83.546]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -80.982 ent: -5.287 str: 0.000 loss: -86.269]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.35it/s, atk: -80.982 ent: -5.287 str: 0.000 loss: -86.269]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -82.668 ent: -5.285 str: 0.000 loss: -87.954]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.33it/s, atk: -82.668 ent: -5.285 str: 0.000 loss: -87.954]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.33it/s, atk: -86.320 ent: -5.283 str: 0.000 loss: -91.603]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.33it/s, atk: -86.320 ent: -5.283 str: 0.000 loss: -91.603]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.33it/s, atk: -89.581 ent: -5.281 str: 0.000 loss: -94.861]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -89.581 ent: -5.281 str: 0.000 loss: -94.861]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -92.616 ent: -5.277 str: 0.000 loss: -97.893]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.38it/s, atk: -92.616 ent: -5.277 str: 0.000 loss: -97.893]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -96.792 ent: -5.278 str: 0.000 loss: -102.070]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.38it/s, atk: -96.792 ent: -5.278 str: 0.000 loss: -102.070]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.38it/s, atk: -100.854 ent: -5.277 str: 0.000 loss: -106.131]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -100.854 ent: -5.277 str: 0.000 loss: -106.131]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -104.689 ent: -5.276 str: 0.000 loss: -109.965]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.44it/s, atk: -104.689 ent: -5.276 str: 0.000 loss: -109.965]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -108.221 ent: -5.278 str: 0.000 loss: -113.500]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -108.221 ent: -5.278 str: 0.000 loss: -113.500]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.47it/s, atk: -111.876 ent: -5.281 str: 0.000 loss: -117.156]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.46it/s, atk: -111.876 ent: -5.281 str: 0.000 loss: -117.156]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.46it/s, atk: -114.622 ent: -5.279 str: 0.000 loss: -119.902]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -114.622 ent: -5.279 str: 0.000 loss: -119.902]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -117.771 ent: -5.281 str: 0.000 loss: -123.052]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.38it/s, atk: -117.771 ent: -5.281 str: 0.000 loss: -123.052]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.38it/s, atk: -120.717 ent: -5.279 str: 0.000 loss: -125.996]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.38it/s, atk: -120.717 ent: -5.279 str: 0.000 loss: -125.996]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.38it/s, atk: -124.115 ent: -5.278 str: 0.000 loss: -129.393]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.47it/s, atk: -124.115 ent: -5.278 str: 0.000 loss: -129.393]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.47it/s, atk: -127.508 ent: -5.278 str: 0.000 loss: -132.786]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.45it/s, atk: -127.508 ent: -5.278 str: 0.000 loss: -132.786]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -127.508 ent: -5.278 str: 0.000 loss: -132.786]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([981], device='cuda:0') tensor(0.9720, device='cuda:0')
after_true: tensor([768], device='cuda:0') tensor(2.3417e-06, device='cuda:0')
L1: [3177.098]	L2: [22.929646]	Linf: [0.9490196]

Accuracy on benign examples: 100.0%
gt_label: 687 pred_label: 687 pred_clean_logit 0.9995108842849731
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.68it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.27it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.27it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 20.17it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.77it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.26it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.47it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5963
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.018 ent: -2.513 str: 0.000 loss: -2.531]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.39s/it, atk: -0.018 ent: -2.513 str: 0.000 loss: -2.531]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.39s/it, atk: -0.136 ent: -2.518 str: 0.000 loss: -2.654]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.04it/s, atk: -0.136 ent: -2.518 str: 0.000 loss: -2.654]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.04it/s, atk: -0.242 ent: -2.517 str: 0.000 loss: -2.759]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.15it/s, atk: -0.242 ent: -2.517 str: 0.000 loss: -2.759]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.15it/s, atk: -0.790 ent: -2.520 str: 0.000 loss: -3.310]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.28it/s, atk: -0.790 ent: -2.520 str: 0.000 loss: -3.310]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.28it/s, atk: -2.443 ent: -2.520 str: 0.000 loss: -4.963]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -2.443 ent: -2.520 str: 0.000 loss: -4.963]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -5.039 ent: -2.516 str: 0.000 loss: -7.555]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.33it/s, atk: -5.039 ent: -2.516 str: 0.000 loss: -7.555]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -8.792 ent: -2.513 str: 0.000 loss: -11.304]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -8.792 ent: -2.513 str: 0.000 loss: -11.304]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -16.643 ent: -2.512 str: 0.000 loss: -19.155]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -16.643 ent: -2.512 str: 0.000 loss: -19.155]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.43it/s, atk: -21.730 ent: -2.511 str: 0.000 loss: -24.242]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.46it/s, atk: -21.730 ent: -2.511 str: 0.000 loss: -24.242]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -30.752 ent: -2.511 str: 0.000 loss: -33.263]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.44it/s, atk: -30.752 ent: -2.511 str: 0.000 loss: -33.263]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.44it/s, atk: -39.327 ent: -2.511 str: 0.000 loss: -41.839]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -39.327 ent: -2.511 str: 0.000 loss: -41.839]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -48.027 ent: -2.511 str: 0.000 loss: -50.538]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -48.027 ent: -2.511 str: 0.000 loss: -50.538]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -55.774 ent: -2.512 str: 0.000 loss: -58.286]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.35it/s, atk: -55.774 ent: -2.512 str: 0.000 loss: -58.286]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.35it/s, atk: -66.341 ent: -2.512 str: 0.000 loss: -68.853]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -66.341 ent: -2.512 str: 0.000 loss: -68.853]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.40it/s, atk: -78.012 ent: -2.512 str: 0.000 loss: -80.524]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.39it/s, atk: -78.012 ent: -2.512 str: 0.000 loss: -80.524]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.39it/s, atk: -86.950 ent: -2.511 str: 0.000 loss: -89.461]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -86.950 ent: -2.511 str: 0.000 loss: -89.461]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -95.140 ent: -2.513 str: 0.000 loss: -97.653]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.42it/s, atk: -95.140 ent: -2.513 str: 0.000 loss: -97.653]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.42it/s, atk: -108.024 ent: -2.512 str: 0.000 loss: -110.536]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -108.024 ent: -2.512 str: 0.000 loss: -110.536]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -116.978 ent: -2.512 str: 0.000 loss: -119.490]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -116.978 ent: -2.512 str: 0.000 loss: -119.490]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -124.826 ent: -2.512 str: 0.000 loss: -127.338]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.37it/s, atk: -124.826 ent: -2.512 str: 0.000 loss: -127.338]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.37it/s, atk: -127.807 ent: -2.514 str: 0.000 loss: -130.321]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.35it/s, atk: -127.807 ent: -2.514 str: 0.000 loss: -130.321]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.35it/s, atk: -132.147 ent: -2.514 str: 0.000 loss: -134.661]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.37it/s, atk: -132.147 ent: -2.514 str: 0.000 loss: -134.661]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.37it/s, atk: -139.005 ent: -2.514 str: 0.000 loss: -141.519]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -139.005 ent: -2.514 str: 0.000 loss: -141.519]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -143.458 ent: -2.513 str: 0.000 loss: -145.972]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -143.458 ent: -2.513 str: 0.000 loss: -145.972]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -149.901 ent: -2.512 str: 0.000 loss: -152.413]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.46it/s, atk: -149.901 ent: -2.512 str: 0.000 loss: -152.413]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.46it/s, atk: -155.430 ent: -2.513 str: 0.000 loss: -157.942]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -155.430 ent: -2.513 str: 0.000 loss: -157.942]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -160.679 ent: -2.513 str: 0.000 loss: -163.193]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.42it/s, atk: -160.679 ent: -2.513 str: 0.000 loss: -163.193]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -166.688 ent: -2.514 str: 0.000 loss: -169.202]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.34it/s, atk: -166.688 ent: -2.514 str: 0.000 loss: -169.202]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.34it/s, atk: -171.478 ent: -2.513 str: 0.000 loss: -173.992]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.36it/s, atk: -171.478 ent: -2.513 str: 0.000 loss: -173.992]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.36it/s, atk: -175.101 ent: -2.512 str: 0.000 loss: -177.613]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -175.101 ent: -2.512 str: 0.000 loss: -177.613]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -175.101 ent: -2.512 str: 0.000 loss: -177.613]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([427], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([687], device='cuda:0') tensor(1.2502e-08, device='cuda:0')
L1: [3201.4626]	L2: [21.553267]	Linf: [0.7137255]

Accuracy on benign examples: 100.0%
gt_label: 979 pred_label: 979 pred_clean_logit 0.8285531997680664
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.06it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.71it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.37it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.01it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.78it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.71it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.60it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.23it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.33s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4296
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.755 ent: -2.535 str: 0.000 loss: -5.290]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -2.755 ent: -2.535 str: 0.000 loss: -5.290]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -9.608 ent: -2.537 str: 0.000 loss: -12.145]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.23s/it, atk: -9.608 ent: -2.537 str: 0.000 loss: -12.145]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.23s/it, atk: -14.240 ent: -2.534 str: 0.000 loss: -16.774]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -14.240 ent: -2.534 str: 0.000 loss: -16.774]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -25.298 ent: -2.533 str: 0.000 loss: -27.831]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.23it/s, atk: -25.298 ent: -2.533 str: 0.000 loss: -27.831]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.23it/s, atk: -34.858 ent: -2.532 str: 0.000 loss: -37.390]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -34.858 ent: -2.532 str: 0.000 loss: -37.390]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.31it/s, atk: -40.664 ent: -2.531 str: 0.000 loss: -43.195]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.17it/s, atk: -40.664 ent: -2.531 str: 0.000 loss: -43.195]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.17it/s, atk: -45.359 ent: -2.530 str: 0.000 loss: -47.889]Iterations:  23%|██▎       | 7/30 [00:06<00:19,  1.17it/s, atk: -45.359 ent: -2.530 str: 0.000 loss: -47.889]Iterations:  23%|██▎       | 7/30 [00:06<00:19,  1.17it/s, atk: -50.992 ent: -2.529 str: 0.000 loss: -53.521]Iterations:  27%|██▋       | 8/30 [00:07<00:18,  1.22it/s, atk: -50.992 ent: -2.529 str: 0.000 loss: -53.521]Iterations:  27%|██▋       | 8/30 [00:07<00:18,  1.22it/s, atk: -57.517 ent: -2.528 str: 0.000 loss: -60.044]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.26it/s, atk: -57.517 ent: -2.528 str: 0.000 loss: -60.044]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.26it/s, atk: -64.220 ent: -2.527 str: 0.000 loss: -66.747]Iterations:  33%|███▎      | 10/30 [00:08<00:16,  1.22it/s, atk: -64.220 ent: -2.527 str: 0.000 loss: -66.747]Iterations:  33%|███▎      | 10/30 [00:09<00:16,  1.22it/s, atk: -69.891 ent: -2.526 str: 0.000 loss: -72.417]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.25it/s, atk: -69.891 ent: -2.526 str: 0.000 loss: -72.417]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.25it/s, atk: -74.814 ent: -2.525 str: 0.000 loss: -77.339]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.31it/s, atk: -74.814 ent: -2.525 str: 0.000 loss: -77.339]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.31it/s, atk: -80.329 ent: -2.524 str: 0.000 loss: -82.853]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.31it/s, atk: -80.329 ent: -2.524 str: 0.000 loss: -82.853]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.31it/s, atk: -85.038 ent: -2.523 str: 0.000 loss: -87.561]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.32it/s, atk: -85.038 ent: -2.523 str: 0.000 loss: -87.561]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.32it/s, atk: -89.854 ent: -2.523 str: 0.000 loss: -92.377]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.31it/s, atk: -89.854 ent: -2.523 str: 0.000 loss: -92.377]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.31it/s, atk: -95.413 ent: -2.523 str: 0.000 loss: -97.936]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -95.413 ent: -2.523 str: 0.000 loss: -97.936]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -100.208 ent: -2.523 str: 0.000 loss: -102.731]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -100.208 ent: -2.523 str: 0.000 loss: -102.731]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.39it/s, atk: -104.362 ent: -2.523 str: 0.000 loss: -106.886]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.45it/s, atk: -104.362 ent: -2.523 str: 0.000 loss: -106.886]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.45it/s, atk: -108.930 ent: -2.523 str: 0.000 loss: -111.453]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.43it/s, atk: -108.930 ent: -2.523 str: 0.000 loss: -111.453]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.43it/s, atk: -114.336 ent: -2.523 str: 0.000 loss: -116.858]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.36it/s, atk: -114.336 ent: -2.523 str: 0.000 loss: -116.858]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.36it/s, atk: -118.734 ent: -2.523 str: 0.000 loss: -121.256]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.38it/s, atk: -118.734 ent: -2.523 str: 0.000 loss: -121.256]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.38it/s, atk: -123.801 ent: -2.521 str: 0.000 loss: -126.322]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -123.801 ent: -2.521 str: 0.000 loss: -126.322]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -128.672 ent: -2.521 str: 0.000 loss: -131.193]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -128.672 ent: -2.521 str: 0.000 loss: -131.193]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -133.205 ent: -2.521 str: 0.000 loss: -135.726]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -133.205 ent: -2.521 str: 0.000 loss: -135.726]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.48it/s, atk: -137.711 ent: -2.521 str: 0.000 loss: -140.232]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -137.711 ent: -2.521 str: 0.000 loss: -140.232]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -142.054 ent: -2.521 str: 0.000 loss: -144.574]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.46it/s, atk: -142.054 ent: -2.521 str: 0.000 loss: -144.574]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.46it/s, atk: -146.101 ent: -2.521 str: 0.000 loss: -148.622]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.52it/s, atk: -146.101 ent: -2.521 str: 0.000 loss: -148.622]Iterations:  90%|█████████ | 27/30 [00:21<00:01,  1.52it/s, atk: -151.001 ent: -2.520 str: 0.000 loss: -153.521]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.47it/s, atk: -151.001 ent: -2.520 str: 0.000 loss: -153.521]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.47it/s, atk: -155.778 ent: -2.520 str: 0.000 loss: -158.298]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -155.778 ent: -2.520 str: 0.000 loss: -158.298]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -160.244 ent: -2.520 str: 0.000 loss: -162.763]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.36it/s, atk: -160.244 ent: -2.520 str: 0.000 loss: -162.763]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -160.244 ent: -2.520 str: 0.000 loss: -162.763]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([974], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([979], device='cuda:0') tensor(7.5778e-08, device='cuda:0')
L1: [3280.3452]	L2: [21.21977]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 884 pred_label: 884 pred_clean_logit 0.9680145382881165
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.15it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.91it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.08it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.11it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.02it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.99it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.28it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.52it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.68it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.48s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4977
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.500 ent: -2.496 str: 0.000 loss: -2.996]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.500 ent: -2.496 str: 0.000 loss: -2.996]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.926 ent: -2.483 str: 0.000 loss: -3.409]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.33s/it, atk: -0.926 ent: -2.483 str: 0.000 loss: -3.409]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.33s/it, atk: -1.986 ent: -2.480 str: 0.000 loss: -4.466]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -1.986 ent: -2.480 str: 0.000 loss: -4.466]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.03s/it, atk: -4.179 ent: -2.480 str: 0.000 loss: -6.659]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -4.179 ent: -2.480 str: 0.000 loss: -6.659]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -10.324 ent: -2.482 str: 0.000 loss: -12.806]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -10.324 ent: -2.482 str: 0.000 loss: -12.806]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -21.400 ent: -2.480 str: 0.000 loss: -23.880]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.20it/s, atk: -21.400 ent: -2.480 str: 0.000 loss: -23.880]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -30.269 ent: -2.478 str: 0.000 loss: -32.747]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.24it/s, atk: -30.269 ent: -2.478 str: 0.000 loss: -32.747]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -35.418 ent: -2.478 str: 0.000 loss: -37.895]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -35.418 ent: -2.478 str: 0.000 loss: -37.895]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -45.959 ent: -2.478 str: 0.000 loss: -48.437]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -45.959 ent: -2.478 str: 0.000 loss: -48.437]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -53.831 ent: -2.477 str: 0.000 loss: -56.308]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -53.831 ent: -2.477 str: 0.000 loss: -56.308]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -57.948 ent: -2.477 str: 0.000 loss: -60.425]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -57.948 ent: -2.477 str: 0.000 loss: -60.425]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -62.112 ent: -2.476 str: 0.000 loss: -64.588]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -62.112 ent: -2.476 str: 0.000 loss: -64.588]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -68.510 ent: -2.476 str: 0.000 loss: -70.985]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.36it/s, atk: -68.510 ent: -2.476 str: 0.000 loss: -70.985]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -71.872 ent: -2.475 str: 0.000 loss: -74.347]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -71.872 ent: -2.475 str: 0.000 loss: -74.347]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.36it/s, atk: -77.587 ent: -2.475 str: 0.000 loss: -80.062]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -77.587 ent: -2.475 str: 0.000 loss: -80.062]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -81.725 ent: -2.475 str: 0.000 loss: -84.199]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.47it/s, atk: -81.725 ent: -2.475 str: 0.000 loss: -84.199]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.47it/s, atk: -86.513 ent: -2.475 str: 0.000 loss: -88.988]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -86.513 ent: -2.475 str: 0.000 loss: -88.988]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.39it/s, atk: -91.357 ent: -2.476 str: 0.000 loss: -93.833]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -91.357 ent: -2.476 str: 0.000 loss: -93.833]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -94.516 ent: -2.475 str: 0.000 loss: -96.991]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -94.516 ent: -2.475 str: 0.000 loss: -96.991]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -98.436 ent: -2.476 str: 0.000 loss: -100.912]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.43it/s, atk: -98.436 ent: -2.476 str: 0.000 loss: -100.912]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.43it/s, atk: -103.239 ent: -2.476 str: 0.000 loss: -105.714]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.33it/s, atk: -103.239 ent: -2.476 str: 0.000 loss: -105.714]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.33it/s, atk: -109.267 ent: -2.475 str: 0.000 loss: -111.743]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -109.267 ent: -2.475 str: 0.000 loss: -111.743]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -115.588 ent: -2.475 str: 0.000 loss: -118.063]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -115.588 ent: -2.475 str: 0.000 loss: -118.063]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -120.817 ent: -2.474 str: 0.000 loss: -123.291]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.39it/s, atk: -120.817 ent: -2.474 str: 0.000 loss: -123.291]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -126.786 ent: -2.474 str: 0.000 loss: -129.260]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -126.786 ent: -2.474 str: 0.000 loss: -129.260]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.36it/s, atk: -134.675 ent: -2.475 str: 0.000 loss: -137.150]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.34it/s, atk: -134.675 ent: -2.475 str: 0.000 loss: -137.150]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.34it/s, atk: -142.081 ent: -2.475 str: 0.000 loss: -144.556]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.27it/s, atk: -142.081 ent: -2.475 str: 0.000 loss: -144.556]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.27it/s, atk: -149.891 ent: -2.476 str: 0.000 loss: -152.366]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.28it/s, atk: -149.891 ent: -2.476 str: 0.000 loss: -152.366]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.28it/s, atk: -155.153 ent: -2.476 str: 0.000 loss: -157.629]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.28it/s, atk: -155.153 ent: -2.476 str: 0.000 loss: -157.629]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.28it/s, atk: -160.459 ent: -2.476 str: 0.000 loss: -162.935]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -160.459 ent: -2.476 str: 0.000 loss: -162.935]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.27it/s, atk: -160.459 ent: -2.476 str: 0.000 loss: -162.935]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([861], device='cuda:0') tensor(0.9898, device='cuda:0')
after_true: tensor([884], device='cuda:0') tensor(5.7103e-08, device='cuda:0')
L1: [1975.1923]	L2: [13.140256]	Linf: [0.5411765]

Accuracy on benign examples: 0.0%
gt_label: 572 pred_label: 549 pred_clean_logit 1.757569953042548e-05
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.37it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 16.35it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.68it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.65it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.04it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.71it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.14it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.80it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.43s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.42s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2231
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -110.218 ent: -5.770 str: 0.000 loss: -115.988]Iterations:   3%|▎         | 1/30 [00:01<00:49,  1.72s/it, atk: -110.218 ent: -5.770 str: 0.000 loss: -115.988]Iterations:   3%|▎         | 1/30 [00:02<00:49,  1.72s/it, atk: -124.275 ent: -5.773 str: 0.000 loss: -130.048]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.10s/it, atk: -124.275 ent: -5.773 str: 0.000 loss: -130.048]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.10s/it, atk: -123.951 ent: -5.774 str: 0.000 loss: -129.725]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -123.951 ent: -5.774 str: 0.000 loss: -129.725]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -132.364 ent: -5.778 str: 0.000 loss: -138.142]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -132.364 ent: -5.778 str: 0.000 loss: -138.142]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -139.620 ent: -5.772 str: 0.000 loss: -145.392]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -139.620 ent: -5.772 str: 0.000 loss: -145.392]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -144.134 ent: -5.765 str: 0.000 loss: -149.899]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -144.134 ent: -5.765 str: 0.000 loss: -149.899]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -149.698 ent: -5.763 str: 0.000 loss: -155.461]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.33it/s, atk: -149.698 ent: -5.763 str: 0.000 loss: -155.461]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -156.940 ent: -5.760 str: 0.000 loss: -162.700]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.27it/s, atk: -156.940 ent: -5.760 str: 0.000 loss: -162.700]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -159.664 ent: -5.761 str: 0.000 loss: -165.425]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -159.664 ent: -5.761 str: 0.000 loss: -165.425]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -163.206 ent: -5.764 str: 0.000 loss: -168.970]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -163.206 ent: -5.764 str: 0.000 loss: -168.970]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -166.067 ent: -5.768 str: 0.000 loss: -171.835]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.33it/s, atk: -166.067 ent: -5.768 str: 0.000 loss: -171.835]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.33it/s, atk: -169.482 ent: -5.770 str: 0.000 loss: -175.252]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.38it/s, atk: -169.482 ent: -5.770 str: 0.000 loss: -175.252]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.38it/s, atk: -173.659 ent: -5.772 str: 0.000 loss: -179.431]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -173.659 ent: -5.772 str: 0.000 loss: -179.431]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -177.466 ent: -5.773 str: 0.000 loss: -183.239]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -177.466 ent: -5.773 str: 0.000 loss: -183.239]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -179.793 ent: -5.773 str: 0.000 loss: -185.566]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.32it/s, atk: -179.793 ent: -5.773 str: 0.000 loss: -185.566]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.32it/s, atk: -182.113 ent: -5.772 str: 0.000 loss: -187.886]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.31it/s, atk: -182.113 ent: -5.772 str: 0.000 loss: -187.886]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.31it/s, atk: -184.162 ent: -5.773 str: 0.000 loss: -189.936]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -184.162 ent: -5.773 str: 0.000 loss: -189.936]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -186.122 ent: -5.774 str: 0.000 loss: -191.896]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -186.122 ent: -5.774 str: 0.000 loss: -191.896]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -187.364 ent: -5.773 str: 0.000 loss: -193.137]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -187.364 ent: -5.773 str: 0.000 loss: -193.137]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.35it/s, atk: -189.529 ent: -5.772 str: 0.000 loss: -195.301]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.29it/s, atk: -189.529 ent: -5.772 str: 0.000 loss: -195.301]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.29it/s, atk: -190.775 ent: -5.771 str: 0.000 loss: -196.546]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.27it/s, atk: -190.775 ent: -5.771 str: 0.000 loss: -196.546]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.27it/s, atk: -192.737 ent: -5.771 str: 0.000 loss: -198.508]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.26it/s, atk: -192.737 ent: -5.771 str: 0.000 loss: -198.508]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.26it/s, atk: -194.960 ent: -5.771 str: 0.000 loss: -200.730]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.28it/s, atk: -194.960 ent: -5.771 str: 0.000 loss: -200.730]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.28it/s, atk: -196.778 ent: -5.772 str: 0.000 loss: -202.550]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -196.778 ent: -5.772 str: 0.000 loss: -202.550]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -196.989 ent: -5.772 str: 0.000 loss: -202.762]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -196.989 ent: -5.772 str: 0.000 loss: -202.762]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -199.551 ent: -5.772 str: 0.000 loss: -205.323]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -199.551 ent: -5.772 str: 0.000 loss: -205.323]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -202.321 ent: -5.773 str: 0.000 loss: -208.094]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -202.321 ent: -5.773 str: 0.000 loss: -208.094]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -202.485 ent: -5.774 str: 0.000 loss: -208.259]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -202.485 ent: -5.774 str: 0.000 loss: -208.259]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -205.030 ent: -5.775 str: 0.000 loss: -210.805]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -205.030 ent: -5.775 str: 0.000 loss: -210.805]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -206.493 ent: -5.774 str: 0.000 loss: -212.267]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.45it/s, atk: -206.493 ent: -5.774 str: 0.000 loss: -212.267]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -206.493 ent: -5.774 str: 0.000 loss: -212.267]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([549], device='cuda:0') tensor(0.9994, device='cuda:0')
after_true: tensor([572], device='cuda:0') tensor(1.0225e-09, device='cuda:0')
L1: [664.82733]	L2: [9.240411]	Linf: [0.52156866]

Accuracy on benign examples: 100.0%
gt_label: 805 pred_label: 805 pred_clean_logit 0.989337682723999
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.92it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.77it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 13.92it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.70it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 14.84it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 14.48it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 13.90it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 13.69it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 13.43it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.81it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.69s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.55s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.62s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3626
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.054 ent: -5.079 str: 0.000 loss: -5.133]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.34s/it, atk: -0.054 ent: -5.079 str: 0.000 loss: -5.133]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.34s/it, atk: -0.119 ent: -5.095 str: 0.000 loss: -5.214]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.11it/s, atk: -0.119 ent: -5.095 str: 0.000 loss: -5.214]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.11it/s, atk: -0.289 ent: -5.100 str: 0.000 loss: -5.390]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.23it/s, atk: -0.289 ent: -5.100 str: 0.000 loss: -5.390]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.23it/s, atk: -0.965 ent: -5.117 str: 0.000 loss: -6.083]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.33it/s, atk: -0.965 ent: -5.117 str: 0.000 loss: -6.083]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.33it/s, atk: -1.780 ent: -5.116 str: 0.000 loss: -6.896]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.40it/s, atk: -1.780 ent: -5.116 str: 0.000 loss: -6.896]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -4.266 ent: -5.115 str: 0.000 loss: -9.381]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.46it/s, atk: -4.266 ent: -5.115 str: 0.000 loss: -9.381]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.46it/s, atk: -6.898 ent: -5.112 str: 0.000 loss: -12.010]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -6.898 ent: -5.112 str: 0.000 loss: -12.010]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -11.105 ent: -5.116 str: 0.000 loss: -16.222]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.46it/s, atk: -11.105 ent: -5.116 str: 0.000 loss: -16.222]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -13.583 ent: -5.118 str: 0.000 loss: -18.700]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.36it/s, atk: -13.583 ent: -5.118 str: 0.000 loss: -18.700]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -19.139 ent: -5.118 str: 0.000 loss: -24.257]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -19.139 ent: -5.118 str: 0.000 loss: -24.257]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -25.683 ent: -5.118 str: 0.000 loss: -30.801]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -25.683 ent: -5.118 str: 0.000 loss: -30.801]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -31.675 ent: -5.119 str: 0.000 loss: -36.794]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.45it/s, atk: -31.675 ent: -5.119 str: 0.000 loss: -36.794]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -38.869 ent: -5.119 str: 0.000 loss: -43.989]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.45it/s, atk: -38.869 ent: -5.119 str: 0.000 loss: -43.989]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.45it/s, atk: -43.331 ent: -5.119 str: 0.000 loss: -48.450]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.38it/s, atk: -43.331 ent: -5.119 str: 0.000 loss: -48.450]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.38it/s, atk: -47.643 ent: -5.119 str: 0.000 loss: -52.762]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -47.643 ent: -5.119 str: 0.000 loss: -52.762]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -53.406 ent: -5.119 str: 0.000 loss: -58.526]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.28it/s, atk: -53.406 ent: -5.119 str: 0.000 loss: -58.526]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.28it/s, atk: -59.342 ent: -5.119 str: 0.000 loss: -64.461]Iterations:  57%|█████▋    | 17/30 [00:12<00:10,  1.27it/s, atk: -59.342 ent: -5.119 str: 0.000 loss: -64.461]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.27it/s, atk: -64.130 ent: -5.118 str: 0.000 loss: -69.248]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.34it/s, atk: -64.130 ent: -5.118 str: 0.000 loss: -69.248]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.34it/s, atk: -68.089 ent: -5.117 str: 0.000 loss: -73.206]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -68.089 ent: -5.117 str: 0.000 loss: -73.206]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -72.260 ent: -5.115 str: 0.000 loss: -77.376]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.38it/s, atk: -72.260 ent: -5.115 str: 0.000 loss: -77.376]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -76.789 ent: -5.114 str: 0.000 loss: -81.903]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.43it/s, atk: -76.789 ent: -5.114 str: 0.000 loss: -81.903]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.43it/s, atk: -81.241 ent: -5.112 str: 0.000 loss: -86.353]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -81.241 ent: -5.112 str: 0.000 loss: -86.353]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.44it/s, atk: -84.297 ent: -5.111 str: 0.000 loss: -89.408]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.47it/s, atk: -84.297 ent: -5.111 str: 0.000 loss: -89.408]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -87.508 ent: -5.110 str: 0.000 loss: -92.618]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -87.508 ent: -5.110 str: 0.000 loss: -92.618]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -90.682 ent: -5.108 str: 0.000 loss: -95.790]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -90.682 ent: -5.108 str: 0.000 loss: -95.790]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -93.926 ent: -5.107 str: 0.000 loss: -99.033]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.41it/s, atk: -93.926 ent: -5.107 str: 0.000 loss: -99.033]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -96.562 ent: -5.106 str: 0.000 loss: -101.669]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.36it/s, atk: -96.562 ent: -5.106 str: 0.000 loss: -101.669]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -99.250 ent: -5.105 str: 0.000 loss: -104.355]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -99.250 ent: -5.105 str: 0.000 loss: -104.355]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -102.106 ent: -5.104 str: 0.000 loss: -107.210]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -102.106 ent: -5.104 str: 0.000 loss: -107.210]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -105.073 ent: -5.103 str: 0.000 loss: -110.176]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.34it/s, atk: -105.073 ent: -5.103 str: 0.000 loss: -110.176]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -105.073 ent: -5.103 str: 0.000 loss: -110.176]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([768], device='cuda:0') tensor(0.9987, device='cuda:0')
after_true: tensor([805], device='cuda:0') tensor(1.9945e-05, device='cuda:0')
L1: [3601.5574]	L2: [23.570168]	Linf: [0.8980392]

Accuracy on benign examples: 100.0%
gt_label: 663 pred_label: 663 pred_clean_logit 0.8157086372375488
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.00it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01,  9.15it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.59it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.79it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.05it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.55it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.02it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 19.39it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.70it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.44s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3834
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.704 ent: -2.640 str: 0.000 loss: -4.345]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.40s/it, atk: -1.704 ent: -2.640 str: 0.000 loss: -4.345]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.40s/it, atk: -4.953 ent: -2.643 str: 0.000 loss: -7.596]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -4.953 ent: -2.643 str: 0.000 loss: -7.596]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -11.805 ent: -2.642 str: 0.000 loss: -14.447]Iterations:  10%|█         | 3/30 [00:02<00:25,  1.06it/s, atk: -11.805 ent: -2.642 str: 0.000 loss: -14.447]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.06it/s, atk: -19.108 ent: -2.642 str: 0.000 loss: -21.750]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.20it/s, atk: -19.108 ent: -2.642 str: 0.000 loss: -21.750]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -28.427 ent: -2.640 str: 0.000 loss: -31.067]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -28.427 ent: -2.640 str: 0.000 loss: -31.067]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -33.577 ent: -2.639 str: 0.000 loss: -36.216]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.34it/s, atk: -33.577 ent: -2.639 str: 0.000 loss: -36.216]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.34it/s, atk: -38.972 ent: -2.637 str: 0.000 loss: -41.608]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.37it/s, atk: -38.972 ent: -2.637 str: 0.000 loss: -41.608]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -43.375 ent: -2.636 str: 0.000 loss: -46.010]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -43.375 ent: -2.636 str: 0.000 loss: -46.010]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -46.620 ent: -2.635 str: 0.000 loss: -49.255]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.32it/s, atk: -46.620 ent: -2.635 str: 0.000 loss: -49.255]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.32it/s, atk: -50.435 ent: -2.633 str: 0.000 loss: -53.068]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -50.435 ent: -2.633 str: 0.000 loss: -53.068]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -53.402 ent: -2.632 str: 0.000 loss: -56.034]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.35it/s, atk: -53.402 ent: -2.632 str: 0.000 loss: -56.034]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -56.803 ent: -2.633 str: 0.000 loss: -59.436]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -56.803 ent: -2.633 str: 0.000 loss: -59.436]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -59.156 ent: -2.633 str: 0.000 loss: -61.788]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.49it/s, atk: -59.156 ent: -2.633 str: 0.000 loss: -61.788]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.49it/s, atk: -62.330 ent: -2.633 str: 0.000 loss: -64.962]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -62.330 ent: -2.633 str: 0.000 loss: -64.962]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -65.874 ent: -2.632 str: 0.000 loss: -68.506]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -65.874 ent: -2.632 str: 0.000 loss: -68.506]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -68.796 ent: -2.631 str: 0.000 loss: -71.428]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -68.796 ent: -2.631 str: 0.000 loss: -71.428]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -71.950 ent: -2.630 str: 0.000 loss: -74.579]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.35it/s, atk: -71.950 ent: -2.630 str: 0.000 loss: -74.579]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.35it/s, atk: -74.584 ent: -2.628 str: 0.000 loss: -77.212]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -74.584 ent: -2.628 str: 0.000 loss: -77.212]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.36it/s, atk: -77.483 ent: -2.628 str: 0.000 loss: -80.111]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -77.483 ent: -2.628 str: 0.000 loss: -80.111]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -81.266 ent: -2.628 str: 0.000 loss: -83.894]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.44it/s, atk: -81.266 ent: -2.628 str: 0.000 loss: -83.894]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -83.739 ent: -2.628 str: 0.000 loss: -86.368]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.46it/s, atk: -83.739 ent: -2.628 str: 0.000 loss: -86.368]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -86.604 ent: -2.627 str: 0.000 loss: -89.232]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -86.604 ent: -2.627 str: 0.000 loss: -89.232]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -89.379 ent: -2.627 str: 0.000 loss: -92.006]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.54it/s, atk: -89.379 ent: -2.627 str: 0.000 loss: -92.006]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -89.700 ent: -2.627 str: 0.000 loss: -92.327]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -89.700 ent: -2.627 str: 0.000 loss: -92.327]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -92.697 ent: -2.627 str: 0.000 loss: -95.323]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -92.697 ent: -2.627 str: 0.000 loss: -95.323]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -94.557 ent: -2.627 str: 0.000 loss: -97.184]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.43it/s, atk: -94.557 ent: -2.627 str: 0.000 loss: -97.184]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -97.311 ent: -2.627 str: 0.000 loss: -99.938]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -97.311 ent: -2.627 str: 0.000 loss: -99.938]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -98.971 ent: -2.628 str: 0.000 loss: -101.599]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.39it/s, atk: -98.971 ent: -2.628 str: 0.000 loss: -101.599]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.39it/s, atk: -103.016 ent: -2.628 str: 0.000 loss: -105.644]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.34it/s, atk: -103.016 ent: -2.628 str: 0.000 loss: -105.644]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.34it/s, atk: -104.732 ent: -2.627 str: 0.000 loss: -107.359]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -104.732 ent: -2.627 str: 0.000 loss: -107.359]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -104.732 ent: -2.627 str: 0.000 loss: -107.359]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([497], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([663], device='cuda:0') tensor(2.2640e-05, device='cuda:0')
L1: [3329.2158]	L2: [22.587263]	Linf: [0.6666667]

Accuracy on benign examples: 100.0%
gt_label: 779 pred_label: 779 pred_clean_logit 0.9992058873176575
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:05,  3.39it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 10.32it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.52it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.59it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.31it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 14.98it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 14.76it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.31it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.83it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.97it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.76s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2384
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.060 ent: -5.987 str: 0.000 loss: -6.047]Iterations:   3%|▎         | 1/30 [00:01<00:51,  1.79s/it, atk: -0.060 ent: -5.987 str: 0.000 loss: -6.047]Iterations:   3%|▎         | 1/30 [00:02<00:51,  1.79s/it, atk: -0.322 ent: -6.022 str: 0.000 loss: -6.344]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.22s/it, atk: -0.322 ent: -6.022 str: 0.000 loss: -6.344]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.22s/it, atk: -0.749 ent: -6.013 str: 0.000 loss: -6.762]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.06it/s, atk: -0.749 ent: -6.013 str: 0.000 loss: -6.762]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.06it/s, atk: -1.532 ent: -6.008 str: 0.000 loss: -7.540]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -1.532 ent: -6.008 str: 0.000 loss: -7.540]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -2.746 ent: -6.002 str: 0.000 loss: -8.748]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.16it/s, atk: -2.746 ent: -6.002 str: 0.000 loss: -8.748]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -4.431 ent: -6.009 str: 0.000 loss: -10.440]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -4.431 ent: -6.009 str: 0.000 loss: -10.440]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -7.176 ent: -5.999 str: 0.000 loss: -13.175]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -7.176 ent: -5.999 str: 0.000 loss: -13.175]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -9.466 ent: -5.990 str: 0.000 loss: -15.455]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -9.466 ent: -5.990 str: 0.000 loss: -15.455]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -13.366 ent: -5.998 str: 0.000 loss: -19.364]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -13.366 ent: -5.998 str: 0.000 loss: -19.364]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -15.441 ent: -6.009 str: 0.000 loss: -21.450]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -15.441 ent: -6.009 str: 0.000 loss: -21.450]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -19.678 ent: -6.009 str: 0.000 loss: -25.687]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -19.678 ent: -6.009 str: 0.000 loss: -25.687]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -22.030 ent: -6.012 str: 0.000 loss: -28.042]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.38it/s, atk: -22.030 ent: -6.012 str: 0.000 loss: -28.042]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.38it/s, atk: -26.447 ent: -6.009 str: 0.000 loss: -32.456]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -26.447 ent: -6.009 str: 0.000 loss: -32.456]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -28.779 ent: -6.005 str: 0.000 loss: -34.785]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -28.779 ent: -6.005 str: 0.000 loss: -34.785]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -32.089 ent: -6.003 str: 0.000 loss: -38.092]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.50it/s, atk: -32.089 ent: -6.003 str: 0.000 loss: -38.092]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.50it/s, atk: -35.500 ent: -6.000 str: 0.000 loss: -41.500]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -35.500 ent: -6.000 str: 0.000 loss: -41.500]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -39.419 ent: -5.999 str: 0.000 loss: -45.418]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -39.419 ent: -5.999 str: 0.000 loss: -45.418]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.39it/s, atk: -43.854 ent: -5.999 str: 0.000 loss: -49.853]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -43.854 ent: -5.999 str: 0.000 loss: -49.853]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -48.234 ent: -6.000 str: 0.000 loss: -54.234]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -48.234 ent: -6.000 str: 0.000 loss: -54.234]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.38it/s, atk: -52.807 ent: -6.001 str: 0.000 loss: -58.808]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.32it/s, atk: -52.807 ent: -6.001 str: 0.000 loss: -58.808]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.32it/s, atk: -56.002 ent: -6.001 str: 0.000 loss: -62.003]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -56.002 ent: -6.001 str: 0.000 loss: -62.003]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -59.045 ent: -6.001 str: 0.000 loss: -65.046]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.27it/s, atk: -59.045 ent: -6.001 str: 0.000 loss: -65.046]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.27it/s, atk: -62.269 ent: -5.999 str: 0.000 loss: -68.268]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.31it/s, atk: -62.269 ent: -5.999 str: 0.000 loss: -68.268]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.31it/s, atk: -65.239 ent: -5.998 str: 0.000 loss: -71.236]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.31it/s, atk: -65.239 ent: -5.998 str: 0.000 loss: -71.236]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.31it/s, atk: -68.053 ent: -5.999 str: 0.000 loss: -74.052]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.33it/s, atk: -68.053 ent: -5.999 str: 0.000 loss: -74.052]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.33it/s, atk: -70.942 ent: -6.001 str: 0.000 loss: -76.943]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.36it/s, atk: -70.942 ent: -6.001 str: 0.000 loss: -76.943]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.36it/s, atk: -73.451 ent: -6.002 str: 0.000 loss: -79.452]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -73.451 ent: -6.002 str: 0.000 loss: -79.452]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -75.778 ent: -6.000 str: 0.000 loss: -81.779]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -75.778 ent: -6.000 str: 0.000 loss: -81.779]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -78.363 ent: -5.998 str: 0.000 loss: -84.361]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.47it/s, atk: -78.363 ent: -5.998 str: 0.000 loss: -84.361]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.47it/s, atk: -80.988 ent: -5.999 str: 0.000 loss: -86.987]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.45it/s, atk: -80.988 ent: -5.999 str: 0.000 loss: -86.987]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -80.988 ent: -5.999 str: 0.000 loss: -86.987]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([874], device='cuda:0') tensor(0.9974, device='cuda:0')
after_true: tensor([779], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [2332.7961]	L2: [16.649567]	Linf: [0.65098035]

Accuracy on benign examples: 0.0%
gt_label: 959 pred_label: 923 pred_clean_logit 0.26948368549346924
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.99it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.50it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 20.17it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.64it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.38it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.53it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.41it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.64it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.88it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.41s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.38s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4681
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -10.099 ent: -5.124 str: 0.000 loss: -15.224]Iterations:   3%|▎         | 1/30 [00:01<00:49,  1.72s/it, atk: -10.099 ent: -5.124 str: 0.000 loss: -15.224]Iterations:   3%|▎         | 1/30 [00:02<00:49,  1.72s/it, atk: -26.308 ent: -5.131 str: 0.000 loss: -31.439]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -26.308 ent: -5.131 str: 0.000 loss: -31.439]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.12s/it, atk: -39.942 ent: -5.144 str: 0.000 loss: -45.086]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -39.942 ent: -5.144 str: 0.000 loss: -45.086]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -46.133 ent: -5.149 str: 0.000 loss: -51.282]Iterations:  13%|█▎        | 4/30 [00:03<00:23,  1.13it/s, atk: -46.133 ent: -5.149 str: 0.000 loss: -51.282]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -60.481 ent: -5.145 str: 0.000 loss: -65.626]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -60.481 ent: -5.145 str: 0.000 loss: -65.626]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -66.791 ent: -5.147 str: 0.000 loss: -71.938]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -66.791 ent: -5.147 str: 0.000 loss: -71.938]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -70.158 ent: -5.146 str: 0.000 loss: -75.304]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.34it/s, atk: -70.158 ent: -5.146 str: 0.000 loss: -75.304]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -74.239 ent: -5.140 str: 0.000 loss: -79.379]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.37it/s, atk: -74.239 ent: -5.140 str: 0.000 loss: -79.379]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -77.009 ent: -5.131 str: 0.000 loss: -82.140]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -77.009 ent: -5.131 str: 0.000 loss: -82.140]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -79.355 ent: -5.132 str: 0.000 loss: -84.487]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.43it/s, atk: -79.355 ent: -5.132 str: 0.000 loss: -84.487]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.43it/s, atk: -80.954 ent: -5.133 str: 0.000 loss: -86.087]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.43it/s, atk: -80.954 ent: -5.133 str: 0.000 loss: -86.087]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -83.987 ent: -5.132 str: 0.000 loss: -89.119]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -83.987 ent: -5.132 str: 0.000 loss: -89.119]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -86.267 ent: -5.131 str: 0.000 loss: -91.398]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.41it/s, atk: -86.267 ent: -5.131 str: 0.000 loss: -91.398]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.41it/s, atk: -88.078 ent: -5.134 str: 0.000 loss: -93.212]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.38it/s, atk: -88.078 ent: -5.134 str: 0.000 loss: -93.212]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.38it/s, atk: -90.433 ent: -5.140 str: 0.000 loss: -95.574]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -90.433 ent: -5.140 str: 0.000 loss: -95.574]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -92.293 ent: -5.141 str: 0.000 loss: -97.434]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.40it/s, atk: -92.293 ent: -5.141 str: 0.000 loss: -97.434]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.40it/s, atk: -94.435 ent: -5.138 str: 0.000 loss: -99.573]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.43it/s, atk: -94.435 ent: -5.138 str: 0.000 loss: -99.573]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -95.699 ent: -5.139 str: 0.000 loss: -100.837]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.46it/s, atk: -95.699 ent: -5.139 str: 0.000 loss: -100.837]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -97.516 ent: -5.138 str: 0.000 loss: -102.654]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -97.516 ent: -5.138 str: 0.000 loss: -102.654]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -99.120 ent: -5.142 str: 0.000 loss: -104.261]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.48it/s, atk: -99.120 ent: -5.142 str: 0.000 loss: -104.261]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -100.749 ent: -5.141 str: 0.000 loss: -105.890]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.53it/s, atk: -100.749 ent: -5.141 str: 0.000 loss: -105.890]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.53it/s, atk: -102.699 ent: -5.140 str: 0.000 loss: -107.838]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.51it/s, atk: -102.699 ent: -5.140 str: 0.000 loss: -107.838]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.51it/s, atk: -105.047 ent: -5.138 str: 0.000 loss: -110.185]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.54it/s, atk: -105.047 ent: -5.138 str: 0.000 loss: -110.185]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -107.117 ent: -5.135 str: 0.000 loss: -112.252]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.49it/s, atk: -107.117 ent: -5.135 str: 0.000 loss: -112.252]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -108.449 ent: -5.133 str: 0.000 loss: -113.582]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -108.449 ent: -5.133 str: 0.000 loss: -113.582]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -110.005 ent: -5.134 str: 0.000 loss: -115.138]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.38it/s, atk: -110.005 ent: -5.134 str: 0.000 loss: -115.138]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.38it/s, atk: -111.670 ent: -5.134 str: 0.000 loss: -116.803]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -111.670 ent: -5.134 str: 0.000 loss: -116.803]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -113.385 ent: -5.133 str: 0.000 loss: -118.518]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.50it/s, atk: -113.385 ent: -5.133 str: 0.000 loss: -118.518]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.50it/s, atk: -114.854 ent: -5.134 str: 0.000 loss: -119.988]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -114.854 ent: -5.134 str: 0.000 loss: -119.988]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -116.684 ent: -5.133 str: 0.000 loss: -121.817]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.48it/s, atk: -116.684 ent: -5.133 str: 0.000 loss: -121.817]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -116.684 ent: -5.133 str: 0.000 loss: -121.817]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([809], device='cuda:0') tensor(0.4536, device='cuda:0')
after_true: tensor([959], device='cuda:0') tensor(7.3365e-06, device='cuda:0')
L1: [5279.2354]	L2: [35.22744]	Linf: [0.88235295]

Accuracy on benign examples: 100.0%
gt_label: 908 pred_label: 908 pred_clean_logit 0.8854382038116455
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.41it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.55it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 20.48it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.58it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.66it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.11it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.10it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.40s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.23s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.36s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.46s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4730
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:03<?, ?it/s, atk: -1.386 ent: -2.567 str: 0.000 loss: -3.953]Iterations:   3%|▎         | 1/30 [00:03<01:37,  3.37s/it, atk: -1.386 ent: -2.567 str: 0.000 loss: -3.953]Iterations:   3%|▎         | 1/30 [00:03<01:37,  3.37s/it, atk: -5.132 ent: -2.551 str: 0.000 loss: -7.683]Iterations:   7%|▋         | 2/30 [00:04<00:51,  1.83s/it, atk: -5.132 ent: -2.551 str: 0.000 loss: -7.683]Iterations:   7%|▋         | 2/30 [00:04<00:51,  1.83s/it, atk: -8.290 ent: -2.549 str: 0.000 loss: -10.839]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.26s/it, atk: -8.290 ent: -2.549 str: 0.000 loss: -10.839]Iterations:  10%|█         | 3/30 [00:04<00:33,  1.26s/it, atk: -14.383 ent: -2.549 str: 0.000 loss: -16.932]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.01it/s, atk: -14.383 ent: -2.549 str: 0.000 loss: -16.932]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.01it/s, atk: -19.950 ent: -2.550 str: 0.000 loss: -22.500]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -19.950 ent: -2.550 str: 0.000 loss: -22.500]Iterations:  17%|█▋        | 5/30 [00:06<00:21,  1.14it/s, atk: -25.998 ent: -2.550 str: 0.000 loss: -28.548]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -25.998 ent: -2.550 str: 0.000 loss: -28.548]Iterations:  20%|██        | 6/30 [00:07<00:19,  1.26it/s, atk: -31.151 ent: -2.549 str: 0.000 loss: -33.700]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -31.151 ent: -2.549 str: 0.000 loss: -33.700]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.23it/s, atk: -37.663 ent: -2.548 str: 0.000 loss: -40.211]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.27it/s, atk: -37.663 ent: -2.548 str: 0.000 loss: -40.211]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.27it/s, atk: -41.856 ent: -2.546 str: 0.000 loss: -44.402]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.29it/s, atk: -41.856 ent: -2.546 str: 0.000 loss: -44.402]Iterations:  30%|███       | 9/30 [00:09<00:16,  1.29it/s, atk: -47.918 ent: -2.547 str: 0.000 loss: -50.465]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.29it/s, atk: -47.918 ent: -2.547 str: 0.000 loss: -50.465]Iterations:  33%|███▎      | 10/30 [00:10<00:15,  1.29it/s, atk: -53.296 ent: -2.547 str: 0.000 loss: -55.843]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -53.296 ent: -2.547 str: 0.000 loss: -55.843]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -57.293 ent: -2.548 str: 0.000 loss: -59.840]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.39it/s, atk: -57.293 ent: -2.548 str: 0.000 loss: -59.840]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.39it/s, atk: -62.513 ent: -2.547 str: 0.000 loss: -65.061]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.35it/s, atk: -62.513 ent: -2.547 str: 0.000 loss: -65.061]Iterations:  43%|████▎     | 13/30 [00:12<00:12,  1.35it/s, atk: -67.166 ent: -2.548 str: 0.000 loss: -69.715]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.41it/s, atk: -67.166 ent: -2.548 str: 0.000 loss: -69.715]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.41it/s, atk: -71.825 ent: -2.549 str: 0.000 loss: -74.373]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.40it/s, atk: -71.825 ent: -2.549 str: 0.000 loss: -74.373]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.40it/s, atk: -76.238 ent: -2.549 str: 0.000 loss: -78.787]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.34it/s, atk: -76.238 ent: -2.549 str: 0.000 loss: -78.787]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.34it/s, atk: -80.099 ent: -2.549 str: 0.000 loss: -82.649]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.33it/s, atk: -80.099 ent: -2.549 str: 0.000 loss: -82.649]Iterations:  57%|█████▋    | 17/30 [00:15<00:09,  1.33it/s, atk: -83.862 ent: -2.550 str: 0.000 loss: -86.412]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.31it/s, atk: -83.862 ent: -2.550 str: 0.000 loss: -86.412]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.31it/s, atk: -87.680 ent: -2.551 str: 0.000 loss: -90.231]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.40it/s, atk: -87.680 ent: -2.551 str: 0.000 loss: -90.231]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.40it/s, atk: -91.040 ent: -2.551 str: 0.000 loss: -93.591]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.51it/s, atk: -91.040 ent: -2.551 str: 0.000 loss: -93.591]Iterations:  67%|██████▋   | 20/30 [00:17<00:06,  1.51it/s, atk: -93.711 ent: -2.552 str: 0.000 loss: -96.263]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.47it/s, atk: -93.711 ent: -2.552 str: 0.000 loss: -96.263]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.47it/s, atk: -97.710 ent: -2.552 str: 0.000 loss: -100.262]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.40it/s, atk: -97.710 ent: -2.552 str: 0.000 loss: -100.262]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.40it/s, atk: -102.166 ent: -2.554 str: 0.000 loss: -104.720]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.31it/s, atk: -102.166 ent: -2.554 str: 0.000 loss: -104.720]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.31it/s, atk: -105.448 ent: -2.554 str: 0.000 loss: -108.002]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.31it/s, atk: -105.448 ent: -2.554 str: 0.000 loss: -108.002]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.31it/s, atk: -107.913 ent: -2.554 str: 0.000 loss: -110.467]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.30it/s, atk: -107.913 ent: -2.554 str: 0.000 loss: -110.467]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.30it/s, atk: -111.800 ent: -2.553 str: 0.000 loss: -114.353]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.37it/s, atk: -111.800 ent: -2.553 str: 0.000 loss: -114.353]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.37it/s, atk: -116.152 ent: -2.552 str: 0.000 loss: -118.704]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.35it/s, atk: -116.152 ent: -2.552 str: 0.000 loss: -118.704]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.35it/s, atk: -120.277 ent: -2.551 str: 0.000 loss: -122.828]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.26it/s, atk: -120.277 ent: -2.551 str: 0.000 loss: -122.828]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.26it/s, atk: -124.635 ent: -2.550 str: 0.000 loss: -127.185]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.29it/s, atk: -124.635 ent: -2.550 str: 0.000 loss: -127.185]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.29it/s, atk: -129.355 ent: -2.549 str: 0.000 loss: -131.904]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.29it/s, atk: -129.355 ent: -2.549 str: 0.000 loss: -131.904]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.22it/s, atk: -129.355 ent: -2.549 str: 0.000 loss: -131.904]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([475], device='cuda:0') tensor(0.9975, device='cuda:0')
after_true: tensor([908], device='cuda:0') tensor(1.4835e-06, device='cuda:0')
L1: [1204.9763]	L2: [7.8466024]	Linf: [0.30196077]

Accuracy on benign examples: 100.0%
gt_label: 599 pred_label: 599 pred_clean_logit 0.9996908903121948
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.76it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.38it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.19it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.23it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 21.74it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 23.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.36s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4618
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -2.412 str: 0.000 loss: -2.415]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.003 ent: -2.412 str: 0.000 loss: -2.415]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.002 ent: -2.424 str: 0.000 loss: -2.426]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -0.002 ent: -2.424 str: 0.000 loss: -2.426]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.40s/it, atk: -0.003 ent: -2.431 str: 0.000 loss: -2.434]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.003 ent: -2.431 str: 0.000 loss: -2.434]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.03s/it, atk: -0.003 ent: -2.438 str: 0.000 loss: -2.441]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -0.003 ent: -2.438 str: 0.000 loss: -2.441]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -0.003 ent: -2.445 str: 0.000 loss: -2.449]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -0.003 ent: -2.445 str: 0.000 loss: -2.449]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -0.003 ent: -2.453 str: 0.000 loss: -2.456]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -0.003 ent: -2.453 str: 0.000 loss: -2.456]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.29it/s, atk: -0.003 ent: -2.461 str: 0.000 loss: -2.464]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.41it/s, atk: -0.003 ent: -2.461 str: 0.000 loss: -2.464]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.41it/s, atk: -0.004 ent: -2.461 str: 0.000 loss: -2.465]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.41it/s, atk: -0.004 ent: -2.461 str: 0.000 loss: -2.465]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.41it/s, atk: -0.004 ent: -2.463 str: 0.000 loss: -2.467]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -0.004 ent: -2.463 str: 0.000 loss: -2.467]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -0.004 ent: -2.466 str: 0.000 loss: -2.470]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -0.004 ent: -2.466 str: 0.000 loss: -2.470]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -0.004 ent: -2.469 str: 0.000 loss: -2.472]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.34it/s, atk: -0.004 ent: -2.469 str: 0.000 loss: -2.472]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.34it/s, atk: -0.004 ent: -2.472 str: 0.000 loss: -2.475]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.35it/s, atk: -0.004 ent: -2.472 str: 0.000 loss: -2.475]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.35it/s, atk: -0.004 ent: -2.477 str: 0.000 loss: -2.481]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -0.004 ent: -2.477 str: 0.000 loss: -2.481]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.40it/s, atk: -0.003 ent: -2.482 str: 0.000 loss: -2.486]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -0.003 ent: -2.482 str: 0.000 loss: -2.486]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -0.003 ent: -2.487 str: 0.000 loss: -2.490]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -0.003 ent: -2.487 str: 0.000 loss: -2.490]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -0.003 ent: -2.493 str: 0.000 loss: -2.496]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -0.003 ent: -2.493 str: 0.000 loss: -2.496]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -0.003 ent: -2.499 str: 0.000 loss: -2.502]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.35it/s, atk: -0.003 ent: -2.499 str: 0.000 loss: -2.502]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.35it/s, atk: -0.003 ent: -2.505 str: 0.000 loss: -2.508]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -0.003 ent: -2.505 str: 0.000 loss: -2.508]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -0.003 ent: -2.511 str: 0.000 loss: -2.515]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -0.003 ent: -2.511 str: 0.000 loss: -2.515]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -0.003 ent: -2.518 str: 0.000 loss: -2.521]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.39it/s, atk: -0.003 ent: -2.518 str: 0.000 loss: -2.521]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.39it/s, atk: -0.003 ent: -2.524 str: 0.000 loss: -2.527]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -0.003 ent: -2.524 str: 0.000 loss: -2.527]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -0.003 ent: -2.531 str: 0.000 loss: -2.534]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -0.003 ent: -2.531 str: 0.000 loss: -2.534]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -0.003 ent: -2.538 str: 0.000 loss: -2.541]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -0.003 ent: -2.538 str: 0.000 loss: -2.541]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -0.003 ent: -2.545 str: 0.000 loss: -2.548]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.39it/s, atk: -0.003 ent: -2.545 str: 0.000 loss: -2.548]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -0.003 ent: -2.554 str: 0.000 loss: -2.556]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -0.003 ent: -2.554 str: 0.000 loss: -2.556]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -0.002 ent: -2.562 str: 0.000 loss: -2.565]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.35it/s, atk: -0.002 ent: -2.562 str: 0.000 loss: -2.565]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.35it/s, atk: -0.002 ent: -2.568 str: 0.000 loss: -2.570]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.38it/s, atk: -0.002 ent: -2.568 str: 0.000 loss: -2.570]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.38it/s, atk: -0.002 ent: -2.574 str: 0.000 loss: -2.577]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.46it/s, atk: -0.002 ent: -2.574 str: 0.000 loss: -2.577]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.46it/s, atk: -0.002 ent: -2.581 str: 0.000 loss: -2.584]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.43it/s, atk: -0.002 ent: -2.581 str: 0.000 loss: -2.584]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.43it/s, atk: -0.002 ent: -2.589 str: 0.000 loss: -2.591]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.46it/s, atk: -0.002 ent: -2.589 str: 0.000 loss: -2.591]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -0.002 ent: -2.589 str: 0.000 loss: -2.591]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 100.0%
after_pred: tensor([599], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([599], device='cuda:0') tensor(0.9998, device='cuda:0')
L1: [1279.9138]	L2: [9.587831]	Linf: [0.43529412]

Accuracy on benign examples: 100.0%
gt_label: 132 pred_label: 132 pred_clean_logit 0.9960069060325623
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.52it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.57it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 20.59it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 22.81it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.38it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.49it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 18.38it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.49it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.14s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.27s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.43s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3559
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.030 ent: -5.216 str: 0.000 loss: -5.245]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.94s/it, atk: -0.030 ent: -5.216 str: 0.000 loss: -5.245]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.94s/it, atk: -0.046 ent: -5.250 str: 0.000 loss: -5.296]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.20s/it, atk: -0.046 ent: -5.250 str: 0.000 loss: -5.296]Iterations:   7%|▋         | 2/30 [00:03<00:33,  1.20s/it, atk: -0.081 ent: -5.275 str: 0.000 loss: -5.356]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.04s/it, atk: -0.081 ent: -5.275 str: 0.000 loss: -5.356]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.04s/it, atk: -0.131 ent: -5.289 str: 0.000 loss: -5.419]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -0.131 ent: -5.289 str: 0.000 loss: -5.419]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.11it/s, atk: -0.200 ent: -5.291 str: 0.000 loss: -5.491]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.14it/s, atk: -0.200 ent: -5.291 str: 0.000 loss: -5.491]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -0.291 ent: -5.289 str: 0.000 loss: -5.580]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.28it/s, atk: -0.291 ent: -5.289 str: 0.000 loss: -5.580]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.28it/s, atk: -0.429 ent: -5.290 str: 0.000 loss: -5.720]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -0.429 ent: -5.290 str: 0.000 loss: -5.720]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.38it/s, atk: -0.574 ent: -5.292 str: 0.000 loss: -5.866]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -0.574 ent: -5.292 str: 0.000 loss: -5.866]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -0.850 ent: -5.290 str: 0.000 loss: -6.140]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -0.850 ent: -5.290 str: 0.000 loss: -6.140]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -1.040 ent: -5.287 str: 0.000 loss: -6.327]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -1.040 ent: -5.287 str: 0.000 loss: -6.327]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -1.108 ent: -5.289 str: 0.000 loss: -6.397]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -1.108 ent: -5.289 str: 0.000 loss: -6.397]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -1.358 ent: -5.294 str: 0.000 loss: -6.651]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.34it/s, atk: -1.358 ent: -5.294 str: 0.000 loss: -6.651]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -1.599 ent: -5.295 str: 0.000 loss: -6.894]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -1.599 ent: -5.295 str: 0.000 loss: -6.894]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -2.151 ent: -5.290 str: 0.000 loss: -7.441]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -2.151 ent: -5.290 str: 0.000 loss: -7.441]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -2.519 ent: -5.282 str: 0.000 loss: -7.801]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.32it/s, atk: -2.519 ent: -5.282 str: 0.000 loss: -7.801]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.32it/s, atk: -2.712 ent: -5.283 str: 0.000 loss: -7.995]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.33it/s, atk: -2.712 ent: -5.283 str: 0.000 loss: -7.995]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -3.058 ent: -5.280 str: 0.000 loss: -8.338]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.34it/s, atk: -3.058 ent: -5.280 str: 0.000 loss: -8.338]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.34it/s, atk: -3.633 ent: -5.277 str: 0.000 loss: -8.910]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.31it/s, atk: -3.633 ent: -5.277 str: 0.000 loss: -8.910]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.31it/s, atk: -4.742 ent: -5.275 str: 0.000 loss: -10.017]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.32it/s, atk: -4.742 ent: -5.275 str: 0.000 loss: -10.017]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.32it/s, atk: -6.331 ent: -5.274 str: 0.000 loss: -11.606]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.33it/s, atk: -6.331 ent: -5.274 str: 0.000 loss: -11.606]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -8.088 ent: -5.272 str: 0.000 loss: -13.360]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -8.088 ent: -5.272 str: 0.000 loss: -13.360]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -9.948 ent: -5.272 str: 0.000 loss: -15.220]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -9.948 ent: -5.272 str: 0.000 loss: -15.220]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.44it/s, atk: -11.251 ent: -5.272 str: 0.000 loss: -16.523]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -11.251 ent: -5.272 str: 0.000 loss: -16.523]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -13.349 ent: -5.272 str: 0.000 loss: -18.622]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.32it/s, atk: -13.349 ent: -5.272 str: 0.000 loss: -18.622]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.32it/s, atk: -15.036 ent: -5.273 str: 0.000 loss: -20.309]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -15.036 ent: -5.273 str: 0.000 loss: -20.309]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -17.039 ent: -5.268 str: 0.000 loss: -22.308]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.28it/s, atk: -17.039 ent: -5.268 str: 0.000 loss: -22.308]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.28it/s, atk: -19.675 ent: -5.267 str: 0.000 loss: -24.941]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -19.675 ent: -5.267 str: 0.000 loss: -24.941]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -22.858 ent: -5.266 str: 0.000 loss: -28.123]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.39it/s, atk: -22.858 ent: -5.266 str: 0.000 loss: -28.123]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -25.618 ent: -5.264 str: 0.000 loss: -30.882]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -25.618 ent: -5.264 str: 0.000 loss: -30.882]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -27.298 ent: -5.260 str: 0.000 loss: -32.558]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.37it/s, atk: -27.298 ent: -5.260 str: 0.000 loss: -32.558]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -27.298 ent: -5.260 str: 0.000 loss: -32.558]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([134], device='cuda:0') tensor(0.9492, device='cuda:0')
after_true: tensor([132], device='cuda:0') tensor(0.0493, device='cuda:0')
L1: [2477.5686]	L2: [18.711468]	Linf: [0.7882353]

Accuracy on benign examples: 100.0%
gt_label: 895 pred_label: 895 pred_clean_logit 0.4099705219268799
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.74it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 14.85it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.01it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.24it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.61it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.05it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.82it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.85it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.54s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4124
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.830 ent: -5.738 str: 0.000 loss: -10.568]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.40s/it, atk: -4.830 ent: -5.738 str: 0.000 loss: -10.568]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.40s/it, atk: -14.827 ent: -5.705 str: 0.000 loss: -20.532]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -14.827 ent: -5.705 str: 0.000 loss: -20.532]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -27.005 ent: -5.698 str: 0.000 loss: -32.703]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.11s/it, atk: -27.005 ent: -5.698 str: 0.000 loss: -32.703]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.11s/it, atk: -37.979 ent: -5.695 str: 0.000 loss: -43.674]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -37.979 ent: -5.695 str: 0.000 loss: -43.674]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -51.636 ent: -5.690 str: 0.000 loss: -57.326]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -51.636 ent: -5.690 str: 0.000 loss: -57.326]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -62.787 ent: -5.687 str: 0.000 loss: -68.473]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -62.787 ent: -5.687 str: 0.000 loss: -68.473]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -71.726 ent: -5.681 str: 0.000 loss: -77.407]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.22it/s, atk: -71.726 ent: -5.681 str: 0.000 loss: -77.407]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.22it/s, atk: -80.104 ent: -5.680 str: 0.000 loss: -85.783]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -80.104 ent: -5.680 str: 0.000 loss: -85.783]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -87.459 ent: -5.677 str: 0.000 loss: -93.135]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -87.459 ent: -5.677 str: 0.000 loss: -93.135]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -93.835 ent: -5.673 str: 0.000 loss: -99.508]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.26it/s, atk: -93.835 ent: -5.673 str: 0.000 loss: -99.508]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.26it/s, atk: -100.444 ent: -5.671 str: 0.000 loss: -106.114]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.27it/s, atk: -100.444 ent: -5.671 str: 0.000 loss: -106.114]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.27it/s, atk: -106.603 ent: -5.668 str: 0.000 loss: -112.271]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.30it/s, atk: -106.603 ent: -5.668 str: 0.000 loss: -112.271]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.30it/s, atk: -113.206 ent: -5.666 str: 0.000 loss: -118.872]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.40it/s, atk: -113.206 ent: -5.666 str: 0.000 loss: -118.872]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.40it/s, atk: -118.291 ent: -5.663 str: 0.000 loss: -123.954]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -118.291 ent: -5.663 str: 0.000 loss: -123.954]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.41it/s, atk: -122.922 ent: -5.662 str: 0.000 loss: -128.583]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -122.922 ent: -5.662 str: 0.000 loss: -128.583]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -128.126 ent: -5.661 str: 0.000 loss: -133.787]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -128.126 ent: -5.661 str: 0.000 loss: -133.787]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -132.493 ent: -5.664 str: 0.000 loss: -138.157]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.37it/s, atk: -132.493 ent: -5.664 str: 0.000 loss: -138.157]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.37it/s, atk: -136.286 ent: -5.665 str: 0.000 loss: -141.950]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -136.286 ent: -5.665 str: 0.000 loss: -141.950]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.38it/s, atk: -139.332 ent: -5.666 str: 0.000 loss: -144.998]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -139.332 ent: -5.666 str: 0.000 loss: -144.998]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -142.635 ent: -5.667 str: 0.000 loss: -148.302]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.42it/s, atk: -142.635 ent: -5.667 str: 0.000 loss: -148.302]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.42it/s, atk: -145.819 ent: -5.668 str: 0.000 loss: -151.486]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.46it/s, atk: -145.819 ent: -5.668 str: 0.000 loss: -151.486]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.46it/s, atk: -149.278 ent: -5.668 str: 0.000 loss: -154.946]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.48it/s, atk: -149.278 ent: -5.668 str: 0.000 loss: -154.946]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.48it/s, atk: -153.070 ent: -5.667 str: 0.000 loss: -158.736]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.43it/s, atk: -153.070 ent: -5.667 str: 0.000 loss: -158.736]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.43it/s, atk: -157.215 ent: -5.665 str: 0.000 loss: -162.880]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -157.215 ent: -5.665 str: 0.000 loss: -162.880]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.44it/s, atk: -161.045 ent: -5.663 str: 0.000 loss: -166.709]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.46it/s, atk: -161.045 ent: -5.663 str: 0.000 loss: -166.709]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.46it/s, atk: -165.027 ent: -5.662 str: 0.000 loss: -170.690]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.51it/s, atk: -165.027 ent: -5.662 str: 0.000 loss: -170.690]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.51it/s, atk: -168.295 ent: -5.661 str: 0.000 loss: -173.957]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -168.295 ent: -5.661 str: 0.000 loss: -173.957]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.47it/s, atk: -170.813 ent: -5.660 str: 0.000 loss: -176.473]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.48it/s, atk: -170.813 ent: -5.660 str: 0.000 loss: -176.473]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.48it/s, atk: -173.645 ent: -5.658 str: 0.000 loss: -179.303]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.49it/s, atk: -173.645 ent: -5.658 str: 0.000 loss: -179.303]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.49it/s, atk: -177.018 ent: -5.657 str: 0.000 loss: -182.676]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.43it/s, atk: -177.018 ent: -5.657 str: 0.000 loss: -182.676]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -177.018 ent: -5.657 str: 0.000 loss: -182.676]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([744], device='cuda:0') tensor(0.5517, device='cuda:0')
after_true: tensor([895], device='cuda:0') tensor(1.4016e-08, device='cuda:0')
L1: [1755.6237]	L2: [14.2988]	Linf: [0.7607843]

Accuracy on benign examples: 100.0%
gt_label: 421 pred_label: 421 pred_clean_logit 0.9478787183761597
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.19it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.43it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 14.36it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 14.77it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 15.38it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.76it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.65it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 19.44it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.78it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.54it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.39s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4909
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.428 ent: -5.134 str: 0.000 loss: -5.562]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.18s/it, atk: -0.428 ent: -5.134 str: 0.000 loss: -5.562]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.18s/it, atk: -1.954 ent: -5.133 str: 0.000 loss: -7.087]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.34s/it, atk: -1.954 ent: -5.133 str: 0.000 loss: -7.087]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.34s/it, atk: -4.145 ent: -5.129 str: 0.000 loss: -9.274]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -4.145 ent: -5.129 str: 0.000 loss: -9.274]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -7.194 ent: -5.126 str: 0.000 loss: -12.320]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -7.194 ent: -5.126 str: 0.000 loss: -12.320]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -10.662 ent: -5.122 str: 0.000 loss: -15.784]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -10.662 ent: -5.122 str: 0.000 loss: -15.784]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -15.339 ent: -5.119 str: 0.000 loss: -20.458]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.18it/s, atk: -15.339 ent: -5.119 str: 0.000 loss: -20.458]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -19.983 ent: -5.118 str: 0.000 loss: -25.101]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -19.983 ent: -5.118 str: 0.000 loss: -25.101]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -26.474 ent: -5.118 str: 0.000 loss: -31.592]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -26.474 ent: -5.118 str: 0.000 loss: -31.592]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -31.096 ent: -5.117 str: 0.000 loss: -36.213]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -31.096 ent: -5.117 str: 0.000 loss: -36.213]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -35.178 ent: -5.114 str: 0.000 loss: -40.293]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -35.178 ent: -5.114 str: 0.000 loss: -40.293]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.34it/s, atk: -39.386 ent: -5.112 str: 0.000 loss: -44.498]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.28it/s, atk: -39.386 ent: -5.112 str: 0.000 loss: -44.498]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.28it/s, atk: -43.623 ent: -5.110 str: 0.000 loss: -48.733]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.33it/s, atk: -43.623 ent: -5.110 str: 0.000 loss: -48.733]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.33it/s, atk: -47.325 ent: -5.108 str: 0.000 loss: -52.432]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.39it/s, atk: -47.325 ent: -5.108 str: 0.000 loss: -52.432]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.39it/s, atk: -51.017 ent: -5.107 str: 0.000 loss: -56.124]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -51.017 ent: -5.107 str: 0.000 loss: -56.124]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.35it/s, atk: -55.220 ent: -5.107 str: 0.000 loss: -60.327]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -55.220 ent: -5.107 str: 0.000 loss: -60.327]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -59.032 ent: -5.107 str: 0.000 loss: -64.140]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -59.032 ent: -5.107 str: 0.000 loss: -64.140]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -61.045 ent: -5.108 str: 0.000 loss: -66.153]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.31it/s, atk: -61.045 ent: -5.108 str: 0.000 loss: -66.153]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.31it/s, atk: -65.797 ent: -5.109 str: 0.000 loss: -70.906]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -65.797 ent: -5.109 str: 0.000 loss: -70.906]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.34it/s, atk: -70.387 ent: -5.109 str: 0.000 loss: -75.496]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.30it/s, atk: -70.387 ent: -5.109 str: 0.000 loss: -75.496]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.30it/s, atk: -74.830 ent: -5.109 str: 0.000 loss: -79.939]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.31it/s, atk: -74.830 ent: -5.109 str: 0.000 loss: -79.939]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.31it/s, atk: -79.086 ent: -5.109 str: 0.000 loss: -84.195]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.34it/s, atk: -79.086 ent: -5.109 str: 0.000 loss: -84.195]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.34it/s, atk: -82.572 ent: -5.108 str: 0.000 loss: -87.679]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.38it/s, atk: -82.572 ent: -5.108 str: 0.000 loss: -87.679]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.38it/s, atk: -85.956 ent: -5.106 str: 0.000 loss: -91.062]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -85.956 ent: -5.106 str: 0.000 loss: -91.062]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -89.100 ent: -5.104 str: 0.000 loss: -94.204]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.50it/s, atk: -89.100 ent: -5.104 str: 0.000 loss: -94.204]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.50it/s, atk: -93.178 ent: -5.104 str: 0.000 loss: -98.281]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.46it/s, atk: -93.178 ent: -5.104 str: 0.000 loss: -98.281]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.46it/s, atk: -97.098 ent: -5.104 str: 0.000 loss: -102.202]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -97.098 ent: -5.104 str: 0.000 loss: -102.202]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -100.904 ent: -5.104 str: 0.000 loss: -106.008]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -100.904 ent: -5.104 str: 0.000 loss: -106.008]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -103.296 ent: -5.104 str: 0.000 loss: -108.400]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -103.296 ent: -5.104 str: 0.000 loss: -108.400]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.44it/s, atk: -106.711 ent: -5.103 str: 0.000 loss: -111.814]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -106.711 ent: -5.103 str: 0.000 loss: -111.814]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.42it/s, atk: -110.312 ent: -5.102 str: 0.000 loss: -115.415]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.35it/s, atk: -110.312 ent: -5.102 str: 0.000 loss: -115.415]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -110.312 ent: -5.102 str: 0.000 loss: -115.415]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([762], device='cuda:0') tensor(0.9831, device='cuda:0')
after_true: tensor([421], device='cuda:0') tensor(1.3093e-05, device='cuda:0')
L1: [1588.5177]	L2: [11.888548]	Linf: [0.58431375]

Accuracy on benign examples: 100.0%
gt_label: 979 pred_label: 979 pred_clean_logit 0.5149493217468262
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.75it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 13.96it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.60it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.47it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.53it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.80it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.92it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.67it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.64it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.54s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4766
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -6.177 ent: -2.509 str: 0.000 loss: -8.686]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.31s/it, atk: -6.177 ent: -2.509 str: 0.000 loss: -8.686]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.31s/it, atk: -5.665 ent: -2.507 str: 0.000 loss: -8.172]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -5.665 ent: -2.507 str: 0.000 loss: -8.172]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -8.786 ent: -2.501 str: 0.000 loss: -11.287]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.15s/it, atk: -8.786 ent: -2.501 str: 0.000 loss: -11.287]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.15s/it, atk: -9.792 ent: -2.501 str: 0.000 loss: -12.294]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.03it/s, atk: -9.792 ent: -2.501 str: 0.000 loss: -12.294]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.03it/s, atk: -13.190 ent: -2.500 str: 0.000 loss: -15.690]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -13.190 ent: -2.500 str: 0.000 loss: -15.690]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -15.090 ent: -2.497 str: 0.000 loss: -17.587]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -15.090 ent: -2.497 str: 0.000 loss: -17.587]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -19.356 ent: -2.498 str: 0.000 loss: -21.854]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -19.356 ent: -2.498 str: 0.000 loss: -21.854]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.31it/s, atk: -24.131 ent: -2.499 str: 0.000 loss: -26.631]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -24.131 ent: -2.499 str: 0.000 loss: -26.631]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -19.122 ent: -2.502 str: 0.000 loss: -21.624]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -19.122 ent: -2.502 str: 0.000 loss: -21.624]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -24.570 ent: -2.501 str: 0.000 loss: -27.071]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.35it/s, atk: -24.570 ent: -2.501 str: 0.000 loss: -27.071]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.35it/s, atk: -21.096 ent: -2.503 str: 0.000 loss: -23.599]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -21.096 ent: -2.503 str: 0.000 loss: -23.599]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -23.690 ent: -2.504 str: 0.000 loss: -26.194]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.43it/s, atk: -23.690 ent: -2.504 str: 0.000 loss: -26.194]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.43it/s, atk: -29.329 ent: -2.505 str: 0.000 loss: -31.833]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -29.329 ent: -2.505 str: 0.000 loss: -31.833]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -44.254 ent: -2.506 str: 0.000 loss: -46.760]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -44.254 ent: -2.506 str: 0.000 loss: -46.760]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.39it/s, atk: -43.384 ent: -2.508 str: 0.000 loss: -45.891]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.39it/s, atk: -43.384 ent: -2.508 str: 0.000 loss: -45.891]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.39it/s, atk: -49.313 ent: -2.508 str: 0.000 loss: -51.821]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.35it/s, atk: -49.313 ent: -2.508 str: 0.000 loss: -51.821]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.35it/s, atk: -54.904 ent: -2.507 str: 0.000 loss: -57.411]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -54.904 ent: -2.507 str: 0.000 loss: -57.411]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.45it/s, atk: -56.352 ent: -2.504 str: 0.000 loss: -58.857]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -56.352 ent: -2.504 str: 0.000 loss: -58.857]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -58.303 ent: -2.503 str: 0.000 loss: -60.806]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.47it/s, atk: -58.303 ent: -2.503 str: 0.000 loss: -60.806]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.47it/s, atk: -62.779 ent: -2.502 str: 0.000 loss: -65.281]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.43it/s, atk: -62.779 ent: -2.502 str: 0.000 loss: -65.281]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.43it/s, atk: -67.967 ent: -2.501 str: 0.000 loss: -70.468]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -67.967 ent: -2.501 str: 0.000 loss: -70.468]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -71.561 ent: -2.500 str: 0.000 loss: -74.061]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -71.561 ent: -2.500 str: 0.000 loss: -74.061]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -76.371 ent: -2.499 str: 0.000 loss: -78.870]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -76.371 ent: -2.499 str: 0.000 loss: -78.870]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -82.018 ent: -2.498 str: 0.000 loss: -84.516]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.40it/s, atk: -82.018 ent: -2.498 str: 0.000 loss: -84.516]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.40it/s, atk: -85.517 ent: -2.497 str: 0.000 loss: -88.014]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -85.517 ent: -2.497 str: 0.000 loss: -88.014]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -89.647 ent: -2.497 str: 0.000 loss: -92.144]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -89.647 ent: -2.497 str: 0.000 loss: -92.144]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -90.741 ent: -2.495 str: 0.000 loss: -93.237]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -90.741 ent: -2.495 str: 0.000 loss: -93.237]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.49it/s, atk: -96.281 ent: -2.495 str: 0.000 loss: -98.777]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -96.281 ent: -2.495 str: 0.000 loss: -98.777]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -103.507 ent: -2.495 str: 0.000 loss: -106.002]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.50it/s, atk: -103.507 ent: -2.495 str: 0.000 loss: -106.002]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.50it/s, atk: -103.623 ent: -2.494 str: 0.000 loss: -106.117]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.41it/s, atk: -103.623 ent: -2.494 str: 0.000 loss: -106.117]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -103.623 ent: -2.494 str: 0.000 loss: -106.117]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([415], device='cuda:0') tensor(0.8897, device='cuda:0')
after_true: tensor([979], device='cuda:0') tensor(1.7618e-05, device='cuda:0')
L1: [3576.5176]	L2: [22.484856]	Linf: [0.6588235]

Accuracy on benign examples: 100.0%
gt_label: 327 pred_label: 327 pred_clean_logit 0.9842950105667114
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.06it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.32it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 22.21it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 23.12it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.83it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.08it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.63s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.56s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4937
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.333 ent: -2.517 str: 0.000 loss: -2.851]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.48s/it, atk: -0.333 ent: -2.517 str: 0.000 loss: -2.851]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.48s/it, atk: -0.594 ent: -2.489 str: 0.000 loss: -3.083]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -0.594 ent: -2.489 str: 0.000 loss: -3.083]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -4.948 ent: -2.484 str: 0.000 loss: -7.433]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.18it/s, atk: -4.948 ent: -2.484 str: 0.000 loss: -7.433]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.18it/s, atk: -19.238 ent: -2.483 str: 0.000 loss: -21.722]Iterations:  13%|█▎        | 4/30 [00:03<00:23,  1.12it/s, atk: -19.238 ent: -2.483 str: 0.000 loss: -21.722]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.12it/s, atk: -26.159 ent: -2.483 str: 0.000 loss: -28.642]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.19it/s, atk: -26.159 ent: -2.483 str: 0.000 loss: -28.642]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.19it/s, atk: -40.958 ent: -2.483 str: 0.000 loss: -43.441]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -40.958 ent: -2.483 str: 0.000 loss: -43.441]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -52.955 ent: -2.482 str: 0.000 loss: -55.437]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.28it/s, atk: -52.955 ent: -2.482 str: 0.000 loss: -55.437]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -63.789 ent: -2.479 str: 0.000 loss: -66.268]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -63.789 ent: -2.479 str: 0.000 loss: -66.268]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -73.969 ent: -2.477 str: 0.000 loss: -76.445]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -73.969 ent: -2.477 str: 0.000 loss: -76.445]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -85.024 ent: -2.476 str: 0.000 loss: -87.500]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.25it/s, atk: -85.024 ent: -2.476 str: 0.000 loss: -87.500]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.25it/s, atk: -95.441 ent: -2.477 str: 0.000 loss: -97.919]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.25it/s, atk: -95.441 ent: -2.477 str: 0.000 loss: -97.919]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.25it/s, atk: -103.894 ent: -2.479 str: 0.000 loss: -106.373]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -103.894 ent: -2.479 str: 0.000 loss: -106.373]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -111.110 ent: -2.479 str: 0.000 loss: -113.590]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -111.110 ent: -2.479 str: 0.000 loss: -113.590]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -119.655 ent: -2.479 str: 0.000 loss: -122.134]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -119.655 ent: -2.479 str: 0.000 loss: -122.134]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -126.687 ent: -2.480 str: 0.000 loss: -129.167]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -126.687 ent: -2.480 str: 0.000 loss: -129.167]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.33it/s, atk: -132.778 ent: -2.480 str: 0.000 loss: -135.258]Iterations:  53%|█████▎    | 16/30 [00:12<00:11,  1.24it/s, atk: -132.778 ent: -2.480 str: 0.000 loss: -135.258]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.24it/s, atk: -139.419 ent: -2.480 str: 0.000 loss: -141.899]Iterations:  57%|█████▋    | 17/30 [00:13<00:11,  1.18it/s, atk: -139.419 ent: -2.480 str: 0.000 loss: -141.899]Iterations:  57%|█████▋    | 17/30 [00:14<00:11,  1.18it/s, atk: -145.875 ent: -2.479 str: 0.000 loss: -148.354]Iterations:  60%|██████    | 18/30 [00:14<00:10,  1.14it/s, atk: -145.875 ent: -2.479 str: 0.000 loss: -148.354]Iterations:  60%|██████    | 18/30 [00:15<00:10,  1.14it/s, atk: -152.332 ent: -2.478 str: 0.000 loss: -154.810]Iterations:  63%|██████▎   | 19/30 [00:15<00:09,  1.18it/s, atk: -152.332 ent: -2.478 str: 0.000 loss: -154.810]Iterations:  63%|██████▎   | 19/30 [00:15<00:09,  1.18it/s, atk: -159.947 ent: -2.478 str: 0.000 loss: -162.426]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.24it/s, atk: -159.947 ent: -2.478 str: 0.000 loss: -162.426]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.24it/s, atk: -167.035 ent: -2.478 str: 0.000 loss: -169.513]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.31it/s, atk: -167.035 ent: -2.478 str: 0.000 loss: -169.513]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.31it/s, atk: -174.133 ent: -2.475 str: 0.000 loss: -176.608]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.30it/s, atk: -174.133 ent: -2.475 str: 0.000 loss: -176.608]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.30it/s, atk: -181.838 ent: -2.474 str: 0.000 loss: -184.312]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.31it/s, atk: -181.838 ent: -2.474 str: 0.000 loss: -184.312]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.31it/s, atk: -189.750 ent: -2.474 str: 0.000 loss: -192.225]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.29it/s, atk: -189.750 ent: -2.474 str: 0.000 loss: -192.225]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.29it/s, atk: -195.890 ent: -2.474 str: 0.000 loss: -198.365]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.28it/s, atk: -195.890 ent: -2.474 str: 0.000 loss: -198.365]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.28it/s, atk: -202.754 ent: -2.474 str: 0.000 loss: -205.228]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.36it/s, atk: -202.754 ent: -2.474 str: 0.000 loss: -205.228]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.36it/s, atk: -208.664 ent: -2.474 str: 0.000 loss: -211.138]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.35it/s, atk: -208.664 ent: -2.474 str: 0.000 loss: -211.138]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.35it/s, atk: -213.560 ent: -2.475 str: 0.000 loss: -216.035]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.37it/s, atk: -213.560 ent: -2.475 str: 0.000 loss: -216.035]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.37it/s, atk: -219.281 ent: -2.473 str: 0.000 loss: -221.755]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.40it/s, atk: -219.281 ent: -2.473 str: 0.000 loss: -221.755]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.40it/s, atk: -224.857 ent: -2.472 str: 0.000 loss: -227.329]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.32it/s, atk: -224.857 ent: -2.472 str: 0.000 loss: -227.329]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.27it/s, atk: -224.857 ent: -2.472 str: 0.000 loss: -227.329]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([33], device='cuda:0') tensor(0.9845, device='cuda:0')
after_true: tensor([327], device='cuda:0') tensor(9.6047e-11, device='cuda:0')
L1: [2956.0078]	L2: [20.326014]	Linf: [0.77254903]

Accuracy on benign examples: 100.0%
gt_label: 696 pred_label: 696 pred_clean_logit 0.6273738145828247
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.77it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.71it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.80it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.85it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.48it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.58it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.18it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.97it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.22it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.98it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.13s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.51s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4219
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -46.168 ent: -5.139 str: 0.000 loss: -51.307]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.38s/it, atk: -46.168 ent: -5.139 str: 0.000 loss: -51.307]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.38s/it, atk: -49.913 ent: -5.137 str: 0.000 loss: -55.050]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.09it/s, atk: -49.913 ent: -5.137 str: 0.000 loss: -55.050]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.09it/s, atk: -67.179 ent: -5.136 str: 0.000 loss: -72.315]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.24it/s, atk: -67.179 ent: -5.136 str: 0.000 loss: -72.315]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.24it/s, atk: -73.980 ent: -5.136 str: 0.000 loss: -79.116]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -73.980 ent: -5.136 str: 0.000 loss: -79.116]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -82.665 ent: -5.128 str: 0.000 loss: -87.792]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.23it/s, atk: -82.665 ent: -5.128 str: 0.000 loss: -87.792]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.23it/s, atk: -89.858 ent: -5.121 str: 0.000 loss: -94.979]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.27it/s, atk: -89.858 ent: -5.121 str: 0.000 loss: -94.979]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -97.142 ent: -5.120 str: 0.000 loss: -102.261]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.41it/s, atk: -97.142 ent: -5.120 str: 0.000 loss: -102.261]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.41it/s, atk: -99.325 ent: -5.116 str: 0.000 loss: -104.441]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.40it/s, atk: -99.325 ent: -5.116 str: 0.000 loss: -104.441]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.40it/s, atk: -107.771 ent: -5.117 str: 0.000 loss: -112.888]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.43it/s, atk: -107.771 ent: -5.117 str: 0.000 loss: -112.888]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -114.055 ent: -5.118 str: 0.000 loss: -119.173]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.46it/s, atk: -114.055 ent: -5.118 str: 0.000 loss: -119.173]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.46it/s, atk: -118.596 ent: -5.117 str: 0.000 loss: -123.713]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.51it/s, atk: -118.596 ent: -5.117 str: 0.000 loss: -123.713]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.51it/s, atk: -125.479 ent: -5.113 str: 0.000 loss: -130.591]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.49it/s, atk: -125.479 ent: -5.113 str: 0.000 loss: -130.591]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -132.441 ent: -5.109 str: 0.000 loss: -137.550]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.42it/s, atk: -132.441 ent: -5.109 str: 0.000 loss: -137.550]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -137.448 ent: -5.108 str: 0.000 loss: -142.556]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.39it/s, atk: -137.448 ent: -5.108 str: 0.000 loss: -142.556]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.39it/s, atk: -146.104 ent: -5.109 str: 0.000 loss: -151.213]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -146.104 ent: -5.109 str: 0.000 loss: -151.213]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.33it/s, atk: -153.148 ent: -5.109 str: 0.000 loss: -158.258]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.43it/s, atk: -153.148 ent: -5.109 str: 0.000 loss: -158.258]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.43it/s, atk: -159.491 ent: -5.110 str: 0.000 loss: -164.601]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.49it/s, atk: -159.491 ent: -5.110 str: 0.000 loss: -164.601]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.49it/s, atk: -165.387 ent: -5.107 str: 0.000 loss: -170.495]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -165.387 ent: -5.107 str: 0.000 loss: -170.495]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -172.455 ent: -5.106 str: 0.000 loss: -177.560]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.41it/s, atk: -172.455 ent: -5.106 str: 0.000 loss: -177.560]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -178.246 ent: -5.105 str: 0.000 loss: -183.351]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.36it/s, atk: -178.246 ent: -5.105 str: 0.000 loss: -183.351]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -184.459 ent: -5.104 str: 0.000 loss: -189.563]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.40it/s, atk: -184.459 ent: -5.104 str: 0.000 loss: -189.563]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.40it/s, atk: -190.321 ent: -5.104 str: 0.000 loss: -195.424]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -190.321 ent: -5.104 str: 0.000 loss: -195.424]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -195.106 ent: -5.103 str: 0.000 loss: -200.210]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -195.106 ent: -5.103 str: 0.000 loss: -200.210]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -200.280 ent: -5.104 str: 0.000 loss: -205.384]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.53it/s, atk: -200.280 ent: -5.104 str: 0.000 loss: -205.384]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.53it/s, atk: -205.363 ent: -5.105 str: 0.000 loss: -210.467]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -205.363 ent: -5.105 str: 0.000 loss: -210.467]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.45it/s, atk: -210.647 ent: -5.105 str: 0.000 loss: -215.753]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.37it/s, atk: -210.647 ent: -5.105 str: 0.000 loss: -215.753]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.37it/s, atk: -215.206 ent: -5.105 str: 0.000 loss: -220.311]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.37it/s, atk: -215.206 ent: -5.105 str: 0.000 loss: -220.311]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.37it/s, atk: -220.677 ent: -5.104 str: 0.000 loss: -225.781]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -220.677 ent: -5.104 str: 0.000 loss: -225.781]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -224.992 ent: -5.101 str: 0.000 loss: -230.094]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -224.992 ent: -5.101 str: 0.000 loss: -230.094]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -229.354 ent: -5.102 str: 0.000 loss: -234.456]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -229.354 ent: -5.102 str: 0.000 loss: -234.456]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -229.354 ent: -5.102 str: 0.000 loss: -234.456]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([633], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([696], device='cuda:0') tensor(7.1126e-11, device='cuda:0')
L1: [1922.4979]	L2: [14.3078575]	Linf: [0.5058824]

Accuracy on benign examples: 100.0%
gt_label: 675 pred_label: 675 pred_clean_logit 0.6425507068634033
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 17.80it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.17it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.56it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.43it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.28it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.78it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 16.54it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.50it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.63s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.39s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.53s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4569
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.873 ent: -5.041 str: 0.000 loss: -8.913]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.44s/it, atk: -3.873 ent: -5.041 str: 0.000 loss: -8.913]Iterations:   3%|▎         | 1/30 [00:02<01:10,  2.44s/it, atk: -3.822 ent: -5.020 str: 0.000 loss: -8.841]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -3.822 ent: -5.020 str: 0.000 loss: -8.841]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -8.003 ent: -5.017 str: 0.000 loss: -13.020]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -8.003 ent: -5.017 str: 0.000 loss: -13.020]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -13.424 ent: -5.017 str: 0.000 loss: -18.442]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -13.424 ent: -5.017 str: 0.000 loss: -18.442]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -20.455 ent: -5.017 str: 0.000 loss: -25.472]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -20.455 ent: -5.017 str: 0.000 loss: -25.472]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -27.508 ent: -5.017 str: 0.000 loss: -32.525]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.21it/s, atk: -27.508 ent: -5.017 str: 0.000 loss: -32.525]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -33.109 ent: -5.014 str: 0.000 loss: -38.123]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -33.109 ent: -5.014 str: 0.000 loss: -38.123]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.25it/s, atk: -39.158 ent: -5.010 str: 0.000 loss: -44.169]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -39.158 ent: -5.010 str: 0.000 loss: -44.169]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -45.250 ent: -5.008 str: 0.000 loss: -50.258]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -45.250 ent: -5.008 str: 0.000 loss: -50.258]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -51.887 ent: -5.006 str: 0.000 loss: -56.893]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -51.887 ent: -5.006 str: 0.000 loss: -56.893]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -57.301 ent: -5.005 str: 0.000 loss: -62.306]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -57.301 ent: -5.005 str: 0.000 loss: -62.306]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -59.232 ent: -5.006 str: 0.000 loss: -64.238]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -59.232 ent: -5.006 str: 0.000 loss: -64.238]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -67.134 ent: -5.005 str: 0.000 loss: -72.139]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -67.134 ent: -5.005 str: 0.000 loss: -72.139]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.42it/s, atk: -72.512 ent: -5.001 str: 0.000 loss: -77.514]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -72.512 ent: -5.001 str: 0.000 loss: -77.514]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -75.777 ent: -4.998 str: 0.000 loss: -80.775]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -75.777 ent: -4.998 str: 0.000 loss: -80.775]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -81.479 ent: -4.997 str: 0.000 loss: -86.476]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -81.479 ent: -4.997 str: 0.000 loss: -86.476]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.49it/s, atk: -94.644 ent: -4.996 str: 0.000 loss: -99.641]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -94.644 ent: -4.996 str: 0.000 loss: -99.641]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -104.234 ent: -4.995 str: 0.000 loss: -109.229]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.33it/s, atk: -104.234 ent: -4.995 str: 0.000 loss: -109.229]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.33it/s, atk: -117.676 ent: -4.993 str: 0.000 loss: -122.669]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -117.676 ent: -4.993 str: 0.000 loss: -122.669]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -130.232 ent: -4.991 str: 0.000 loss: -135.223]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.33it/s, atk: -130.232 ent: -4.991 str: 0.000 loss: -135.223]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -136.096 ent: -4.990 str: 0.000 loss: -141.086]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.32it/s, atk: -136.096 ent: -4.990 str: 0.000 loss: -141.086]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.32it/s, atk: -148.624 ent: -4.989 str: 0.000 loss: -153.613]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.33it/s, atk: -148.624 ent: -4.989 str: 0.000 loss: -153.613]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.33it/s, atk: -156.869 ent: -4.988 str: 0.000 loss: -161.857]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.28it/s, atk: -156.869 ent: -4.988 str: 0.000 loss: -161.857]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.28it/s, atk: -163.477 ent: -4.988 str: 0.000 loss: -168.466]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -163.477 ent: -4.988 str: 0.000 loss: -168.466]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.37it/s, atk: -173.946 ent: -4.988 str: 0.000 loss: -178.934]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.34it/s, atk: -173.946 ent: -4.988 str: 0.000 loss: -178.934]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.34it/s, atk: -178.624 ent: -4.989 str: 0.000 loss: -183.613]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.25it/s, atk: -178.624 ent: -4.989 str: 0.000 loss: -183.613]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.25it/s, atk: -188.964 ent: -4.989 str: 0.000 loss: -193.952]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.19it/s, atk: -188.964 ent: -4.989 str: 0.000 loss: -193.952]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.19it/s, atk: -195.372 ent: -4.988 str: 0.000 loss: -200.361]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.17it/s, atk: -195.372 ent: -4.988 str: 0.000 loss: -200.361]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.17it/s, atk: -187.748 ent: -4.991 str: 0.000 loss: -192.740]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -187.748 ent: -4.991 str: 0.000 loss: -192.740]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -183.236 ent: -4.987 str: 0.000 loss: -188.223]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.22it/s, atk: -183.236 ent: -4.987 str: 0.000 loss: -188.223]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -183.236 ent: -4.987 str: 0.000 loss: -188.223]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([515], device='cuda:0') tensor(0.9681, device='cuda:0')
after_true: tensor([675], device='cuda:0') tensor(6.3389e-09, device='cuda:0')
L1: [2246.196]	L2: [15.849687]	Linf: [0.58431375]

Accuracy on benign examples: 100.0%
gt_label: 637 pred_label: 637 pred_clean_logit 0.9460114240646362
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.07it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.99it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.98it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.44it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.40it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.41it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 21.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.40it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.20it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.70s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.55s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3103
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.502 ent: -2.897 str: 0.000 loss: -4.399]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.58s/it, atk: -1.502 ent: -2.897 str: 0.000 loss: -4.399]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.58s/it, atk: -3.228 ent: -2.907 str: 0.000 loss: -6.135]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.46s/it, atk: -3.228 ent: -2.907 str: 0.000 loss: -6.135]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.46s/it, atk: -14.362 ent: -2.907 str: 0.000 loss: -17.268]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.10s/it, atk: -14.362 ent: -2.907 str: 0.000 loss: -17.268]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.10s/it, atk: -34.301 ent: -2.904 str: 0.000 loss: -37.205]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -34.301 ent: -2.904 str: 0.000 loss: -37.205]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.06it/s, atk: -35.366 ent: -2.905 str: 0.000 loss: -38.271]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -35.366 ent: -2.905 str: 0.000 loss: -38.271]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -45.234 ent: -2.887 str: 0.000 loss: -48.121]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -45.234 ent: -2.887 str: 0.000 loss: -48.121]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.33it/s, atk: -49.709 ent: -2.890 str: 0.000 loss: -52.599]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -49.709 ent: -2.890 str: 0.000 loss: -52.599]Iterations:  23%|██▎       | 7/30 [00:07<00:16,  1.37it/s, atk: -63.831 ent: -2.886 str: 0.000 loss: -66.717]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -63.831 ent: -2.886 str: 0.000 loss: -66.717]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -84.151 ent: -2.886 str: 0.000 loss: -87.037]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.36it/s, atk: -84.151 ent: -2.886 str: 0.000 loss: -87.037]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.36it/s, atk: -94.052 ent: -2.892 str: 0.000 loss: -96.944]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -94.052 ent: -2.892 str: 0.000 loss: -96.944]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -102.810 ent: -2.883 str: 0.000 loss: -105.692]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.32it/s, atk: -102.810 ent: -2.883 str: 0.000 loss: -105.692]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -106.750 ent: -2.883 str: 0.000 loss: -109.634]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.30it/s, atk: -106.750 ent: -2.883 str: 0.000 loss: -109.634]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.30it/s, atk: -115.300 ent: -2.881 str: 0.000 loss: -118.181]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -115.300 ent: -2.881 str: 0.000 loss: -118.181]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -123.173 ent: -2.878 str: 0.000 loss: -126.051]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -123.173 ent: -2.878 str: 0.000 loss: -126.051]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.33it/s, atk: -137.706 ent: -2.877 str: 0.000 loss: -140.583]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -137.706 ent: -2.877 str: 0.000 loss: -140.583]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -148.855 ent: -2.876 str: 0.000 loss: -151.731]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -148.855 ent: -2.876 str: 0.000 loss: -151.731]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -158.868 ent: -2.870 str: 0.000 loss: -161.738]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -158.868 ent: -2.870 str: 0.000 loss: -161.738]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.41it/s, atk: -163.637 ent: -2.867 str: 0.000 loss: -166.504]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -163.637 ent: -2.867 str: 0.000 loss: -166.504]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.33it/s, atk: -174.794 ent: -2.865 str: 0.000 loss: -177.660]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -174.794 ent: -2.865 str: 0.000 loss: -177.660]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -171.767 ent: -2.872 str: 0.000 loss: -174.639]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.35it/s, atk: -171.767 ent: -2.872 str: 0.000 loss: -174.639]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.35it/s, atk: -179.589 ent: -2.869 str: 0.000 loss: -182.458]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.30it/s, atk: -179.589 ent: -2.869 str: 0.000 loss: -182.458]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.30it/s, atk: -187.067 ent: -2.865 str: 0.000 loss: -189.932]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.31it/s, atk: -187.067 ent: -2.865 str: 0.000 loss: -189.932]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.31it/s, atk: -195.415 ent: -2.866 str: 0.000 loss: -198.281]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -195.415 ent: -2.866 str: 0.000 loss: -198.281]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -199.123 ent: -2.865 str: 0.000 loss: -201.988]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.31it/s, atk: -199.123 ent: -2.865 str: 0.000 loss: -201.988]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.31it/s, atk: -204.798 ent: -2.863 str: 0.000 loss: -207.662]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.29it/s, atk: -204.798 ent: -2.863 str: 0.000 loss: -207.662]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.29it/s, atk: -208.975 ent: -2.863 str: 0.000 loss: -211.838]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -208.975 ent: -2.863 str: 0.000 loss: -211.838]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.32it/s, atk: -217.752 ent: -2.861 str: 0.000 loss: -220.613]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -217.752 ent: -2.861 str: 0.000 loss: -220.613]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -222.658 ent: -2.859 str: 0.000 loss: -225.517]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.40it/s, atk: -222.658 ent: -2.859 str: 0.000 loss: -225.517]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.40it/s, atk: -231.879 ent: -2.857 str: 0.000 loss: -234.735]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.37it/s, atk: -231.879 ent: -2.857 str: 0.000 loss: -234.735]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.37it/s, atk: -237.034 ent: -2.856 str: 0.000 loss: -239.891]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.34it/s, atk: -237.034 ent: -2.856 str: 0.000 loss: -239.891]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.27it/s, atk: -237.034 ent: -2.856 str: 0.000 loss: -239.891]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([822], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([637], device='cuda:0') tensor(3.7249e-11, device='cuda:0')
L1: [3642.5374]	L2: [25.637045]	Linf: [0.972549]

Accuracy on benign examples: 100.0%
gt_label: 789 pred_label: 789 pred_clean_logit 0.9797908663749695
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 27.24it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.83it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 21.29it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.22it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.29it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.62it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 18.75it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.73it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.18s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.25s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4399
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.177 ent: -4.879 str: 0.000 loss: -5.056]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -0.177 ent: -4.879 str: 0.000 loss: -5.056]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -0.288 ent: -4.886 str: 0.000 loss: -5.173]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.28s/it, atk: -0.288 ent: -4.886 str: 0.000 loss: -5.173]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.28s/it, atk: -0.463 ent: -4.885 str: 0.000 loss: -5.348]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.463 ent: -4.885 str: 0.000 loss: -5.348]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.706 ent: -4.884 str: 0.000 loss: -5.589]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.08it/s, atk: -0.706 ent: -4.884 str: 0.000 loss: -5.589]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.08it/s, atk: -1.024 ent: -4.881 str: 0.000 loss: -5.905]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.15it/s, atk: -1.024 ent: -4.881 str: 0.000 loss: -5.905]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.15it/s, atk: -1.512 ent: -4.883 str: 0.000 loss: -6.395]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.23it/s, atk: -1.512 ent: -4.883 str: 0.000 loss: -6.395]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.23it/s, atk: -2.168 ent: -4.882 str: 0.000 loss: -7.050]Iterations:  23%|██▎       | 7/30 [00:06<00:19,  1.21it/s, atk: -2.168 ent: -4.882 str: 0.000 loss: -7.050]Iterations:  23%|██▎       | 7/30 [00:07<00:19,  1.21it/s, atk: -3.010 ent: -4.883 str: 0.000 loss: -7.893]Iterations:  27%|██▋       | 8/30 [00:07<00:18,  1.22it/s, atk: -3.010 ent: -4.883 str: 0.000 loss: -7.893]Iterations:  27%|██▋       | 8/30 [00:07<00:18,  1.22it/s, atk: -3.849 ent: -4.883 str: 0.000 loss: -8.733]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -3.849 ent: -4.883 str: 0.000 loss: -8.733]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -5.308 ent: -4.883 str: 0.000 loss: -10.191]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -5.308 ent: -4.883 str: 0.000 loss: -10.191]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.34it/s, atk: -8.005 ent: -4.882 str: 0.000 loss: -12.887]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -8.005 ent: -4.882 str: 0.000 loss: -12.887]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -9.881 ent: -4.879 str: 0.000 loss: -14.760]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -9.881 ent: -4.879 str: 0.000 loss: -14.760]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -13.488 ent: -4.877 str: 0.000 loss: -18.365]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.37it/s, atk: -13.488 ent: -4.877 str: 0.000 loss: -18.365]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -16.603 ent: -4.873 str: 0.000 loss: -21.476]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.35it/s, atk: -16.603 ent: -4.873 str: 0.000 loss: -21.476]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.35it/s, atk: -21.576 ent: -4.870 str: 0.000 loss: -26.446]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -21.576 ent: -4.870 str: 0.000 loss: -26.446]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -25.707 ent: -4.861 str: 0.000 loss: -30.568]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.40it/s, atk: -25.707 ent: -4.861 str: 0.000 loss: -30.568]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.40it/s, atk: -27.648 ent: -4.854 str: 0.000 loss: -32.502]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -27.648 ent: -4.854 str: 0.000 loss: -32.502]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.44it/s, atk: -33.354 ent: -4.854 str: 0.000 loss: -38.208]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.36it/s, atk: -33.354 ent: -4.854 str: 0.000 loss: -38.208]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.36it/s, atk: -40.593 ent: -4.855 str: 0.000 loss: -45.449]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -40.593 ent: -4.855 str: 0.000 loss: -45.449]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -43.632 ent: -4.856 str: 0.000 loss: -48.488]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -43.632 ent: -4.856 str: 0.000 loss: -48.488]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -44.203 ent: -4.860 str: 0.000 loss: -49.063]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.32it/s, atk: -44.203 ent: -4.860 str: 0.000 loss: -49.063]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.32it/s, atk: -51.766 ent: -4.859 str: 0.000 loss: -56.625]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.31it/s, atk: -51.766 ent: -4.859 str: 0.000 loss: -56.625]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.31it/s, atk: -59.181 ent: -4.860 str: 0.000 loss: -64.041]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.35it/s, atk: -59.181 ent: -4.860 str: 0.000 loss: -64.041]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.35it/s, atk: -65.187 ent: -4.861 str: 0.000 loss: -70.048]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -65.187 ent: -4.861 str: 0.000 loss: -70.048]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -71.664 ent: -4.859 str: 0.000 loss: -76.523]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.32it/s, atk: -71.664 ent: -4.859 str: 0.000 loss: -76.523]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.32it/s, atk: -79.414 ent: -4.857 str: 0.000 loss: -84.270]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -79.414 ent: -4.857 str: 0.000 loss: -84.270]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -87.803 ent: -4.856 str: 0.000 loss: -92.659]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.40it/s, atk: -87.803 ent: -4.856 str: 0.000 loss: -92.659]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.40it/s, atk: -93.115 ent: -4.851 str: 0.000 loss: -97.966]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.39it/s, atk: -93.115 ent: -4.851 str: 0.000 loss: -97.966]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -100.170 ent: -4.850 str: 0.000 loss: -105.020]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -100.170 ent: -4.850 str: 0.000 loss: -105.020]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -106.319 ent: -4.855 str: 0.000 loss: -111.174]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.44it/s, atk: -106.319 ent: -4.855 str: 0.000 loss: -111.174]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -106.319 ent: -4.855 str: 0.000 loss: -111.174]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([918], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([789], device='cuda:0') tensor(1.3920e-05, device='cuda:0')
L1: [2219.537]	L2: [14.969582]	Linf: [0.87058824]

Accuracy on benign examples: 100.0%
gt_label: 741 pred_label: 741 pred_clean_logit 0.3804924190044403
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.68it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.00it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.59it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.31it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.74it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.11it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 22.32it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.21it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.73s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5983
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -6.763 ent: -4.799 str: 0.000 loss: -11.562]Iterations:   3%|▎         | 1/30 [00:02<01:24,  2.93s/it, atk: -6.763 ent: -4.799 str: 0.000 loss: -11.562]Iterations:   3%|▎         | 1/30 [00:03<01:24,  2.93s/it, atk: -10.073 ent: -4.800 str: 0.000 loss: -14.873]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.56s/it, atk: -10.073 ent: -4.800 str: 0.000 loss: -14.873]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.56s/it, atk: -11.270 ent: -4.804 str: 0.000 loss: -16.074]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -11.270 ent: -4.804 str: 0.000 loss: -16.074]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -12.647 ent: -4.801 str: 0.000 loss: -17.449]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.00s/it, atk: -12.647 ent: -4.801 str: 0.000 loss: -17.449]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.00s/it, atk: -14.320 ent: -4.800 str: 0.000 loss: -19.119]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -14.320 ent: -4.800 str: 0.000 loss: -19.119]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -16.287 ent: -4.798 str: 0.000 loss: -21.085]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.26it/s, atk: -16.287 ent: -4.798 str: 0.000 loss: -21.085]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.26it/s, atk: -19.777 ent: -4.796 str: 0.000 loss: -24.573]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -19.777 ent: -4.796 str: 0.000 loss: -24.573]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -22.568 ent: -4.795 str: 0.000 loss: -27.363]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -22.568 ent: -4.795 str: 0.000 loss: -27.363]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.33it/s, atk: -24.388 ent: -4.795 str: 0.000 loss: -29.183]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -24.388 ent: -4.795 str: 0.000 loss: -29.183]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -26.948 ent: -4.795 str: 0.000 loss: -31.743]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.45it/s, atk: -26.948 ent: -4.795 str: 0.000 loss: -31.743]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.45it/s, atk: -29.235 ent: -4.796 str: 0.000 loss: -34.031]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -29.235 ent: -4.796 str: 0.000 loss: -34.031]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.43it/s, atk: -32.872 ent: -4.797 str: 0.000 loss: -37.669]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.44it/s, atk: -32.872 ent: -4.797 str: 0.000 loss: -37.669]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.44it/s, atk: -35.931 ent: -4.797 str: 0.000 loss: -40.728]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.47it/s, atk: -35.931 ent: -4.797 str: 0.000 loss: -40.728]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.47it/s, atk: -38.032 ent: -4.797 str: 0.000 loss: -42.828]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.45it/s, atk: -38.032 ent: -4.797 str: 0.000 loss: -42.828]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.45it/s, atk: -40.107 ent: -4.796 str: 0.000 loss: -44.903]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -40.107 ent: -4.796 str: 0.000 loss: -44.903]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -41.667 ent: -4.795 str: 0.000 loss: -46.462]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.40it/s, atk: -41.667 ent: -4.795 str: 0.000 loss: -46.462]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.40it/s, atk: -43.746 ent: -4.795 str: 0.000 loss: -48.541]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.39it/s, atk: -43.746 ent: -4.795 str: 0.000 loss: -48.541]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.39it/s, atk: -45.667 ent: -4.794 str: 0.000 loss: -50.461]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -45.667 ent: -4.794 str: 0.000 loss: -50.461]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -47.509 ent: -4.794 str: 0.000 loss: -52.303]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.42it/s, atk: -47.509 ent: -4.794 str: 0.000 loss: -52.303]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.42it/s, atk: -49.306 ent: -4.794 str: 0.000 loss: -54.100]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.48it/s, atk: -49.306 ent: -4.794 str: 0.000 loss: -54.100]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.48it/s, atk: -51.527 ent: -4.794 str: 0.000 loss: -56.321]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.53it/s, atk: -51.527 ent: -4.794 str: 0.000 loss: -56.321]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.53it/s, atk: -53.857 ent: -4.794 str: 0.000 loss: -58.651]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -53.857 ent: -4.794 str: 0.000 loss: -58.651]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -55.758 ent: -4.794 str: 0.000 loss: -60.552]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.51it/s, atk: -55.758 ent: -4.794 str: 0.000 loss: -60.552]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.51it/s, atk: -57.974 ent: -4.794 str: 0.000 loss: -62.768]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -57.974 ent: -4.794 str: 0.000 loss: -62.768]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.41it/s, atk: -60.058 ent: -4.794 str: 0.000 loss: -64.852]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -60.058 ent: -4.794 str: 0.000 loss: -64.852]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -62.084 ent: -4.794 str: 0.000 loss: -66.878]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -62.084 ent: -4.794 str: 0.000 loss: -66.878]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -64.501 ent: -4.793 str: 0.000 loss: -69.294]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -64.501 ent: -4.793 str: 0.000 loss: -69.294]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -66.901 ent: -4.794 str: 0.000 loss: -71.695]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -66.901 ent: -4.794 str: 0.000 loss: -71.695]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.43it/s, atk: -69.124 ent: -4.793 str: 0.000 loss: -73.917]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.47it/s, atk: -69.124 ent: -4.793 str: 0.000 loss: -73.917]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.47it/s, atk: -71.190 ent: -4.791 str: 0.000 loss: -75.981]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.40it/s, atk: -71.190 ent: -4.791 str: 0.000 loss: -75.981]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.30it/s, atk: -71.190 ent: -4.791 str: 0.000 loss: -75.981]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([725], device='cuda:0') tensor(0.2464, device='cuda:0')
after_true: tensor([741], device='cuda:0') tensor(0.0007, device='cuda:0')
L1: [5448.8193]	L2: [32.562622]	Linf: [0.73333335]

Accuracy on benign examples: 100.0%
gt_label: 821 pred_label: 821 pred_clean_logit 0.9945693016052246
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:07,  2.50it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:02,  7.04it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.95it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.89it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.43it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 14.50it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 14.70it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 15.22it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.00it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.07it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.40s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6456
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.122 ent: -7.832 str: 0.000 loss: -7.954]Iterations:   3%|▎         | 1/30 [00:01<00:36,  1.26s/it, atk: -0.122 ent: -7.832 str: 0.000 loss: -7.954]Iterations:   3%|▎         | 1/30 [00:01<00:36,  1.26s/it, atk: -0.363 ent: -7.823 str: 0.000 loss: -8.186]Iterations:   7%|▋         | 2/30 [00:01<00:26,  1.06it/s, atk: -0.363 ent: -7.823 str: 0.000 loss: -8.186]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.811 ent: -7.830 str: 0.000 loss: -8.641]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.13it/s, atk: -0.811 ent: -7.830 str: 0.000 loss: -8.641]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.13it/s, atk: -1.591 ent: -7.836 str: 0.000 loss: -9.427]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.24it/s, atk: -1.591 ent: -7.836 str: 0.000 loss: -9.427]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.24it/s, atk: -2.408 ent: -7.844 str: 0.000 loss: -10.252]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -2.408 ent: -7.844 str: 0.000 loss: -10.252]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -4.354 ent: -7.842 str: 0.000 loss: -12.197]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.32it/s, atk: -4.354 ent: -7.842 str: 0.000 loss: -12.197]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.32it/s, atk: -6.489 ent: -7.841 str: 0.000 loss: -14.330]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -6.489 ent: -7.841 str: 0.000 loss: -14.330]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -8.489 ent: -7.833 str: 0.000 loss: -16.322]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -8.489 ent: -7.833 str: 0.000 loss: -16.322]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -11.072 ent: -7.823 str: 0.000 loss: -18.895]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.27it/s, atk: -11.072 ent: -7.823 str: 0.000 loss: -18.895]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.27it/s, atk: -14.118 ent: -7.818 str: 0.000 loss: -21.936]Iterations:  33%|███▎      | 10/30 [00:07<00:15,  1.28it/s, atk: -14.118 ent: -7.818 str: 0.000 loss: -21.936]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.28it/s, atk: -18.540 ent: -7.815 str: 0.000 loss: -26.356]Iterations:  37%|███▋      | 11/30 [00:08<00:15,  1.23it/s, atk: -18.540 ent: -7.815 str: 0.000 loss: -26.356]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.23it/s, atk: -24.096 ent: -7.814 str: 0.000 loss: -31.910]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.29it/s, atk: -24.096 ent: -7.814 str: 0.000 loss: -31.910]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.29it/s, atk: -30.078 ent: -7.814 str: 0.000 loss: -37.892]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -30.078 ent: -7.814 str: 0.000 loss: -37.892]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -37.035 ent: -7.812 str: 0.000 loss: -44.847]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -37.035 ent: -7.812 str: 0.000 loss: -44.847]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -43.343 ent: -7.811 str: 0.000 loss: -51.154]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -43.343 ent: -7.811 str: 0.000 loss: -51.154]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -50.807 ent: -7.813 str: 0.000 loss: -58.619]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -50.807 ent: -7.813 str: 0.000 loss: -58.619]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -56.982 ent: -7.812 str: 0.000 loss: -64.794]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.33it/s, atk: -56.982 ent: -7.812 str: 0.000 loss: -64.794]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.33it/s, atk: -65.339 ent: -7.812 str: 0.000 loss: -73.151]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.29it/s, atk: -65.339 ent: -7.812 str: 0.000 loss: -73.151]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.29it/s, atk: -71.888 ent: -7.812 str: 0.000 loss: -79.700]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.33it/s, atk: -71.888 ent: -7.812 str: 0.000 loss: -79.700]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.33it/s, atk: -76.489 ent: -7.814 str: 0.000 loss: -84.303]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.31it/s, atk: -76.489 ent: -7.814 str: 0.000 loss: -84.303]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.31it/s, atk: -84.293 ent: -7.814 str: 0.000 loss: -92.107]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -84.293 ent: -7.814 str: 0.000 loss: -92.107]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -91.420 ent: -7.812 str: 0.000 loss: -99.232]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -91.420 ent: -7.812 str: 0.000 loss: -99.232]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.48it/s, atk: -96.578 ent: -7.813 str: 0.000 loss: -104.391]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -96.578 ent: -7.813 str: 0.000 loss: -104.391]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -104.756 ent: -7.812 str: 0.000 loss: -112.568]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -104.756 ent: -7.812 str: 0.000 loss: -112.568]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -109.325 ent: -7.812 str: 0.000 loss: -117.136]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -109.325 ent: -7.812 str: 0.000 loss: -117.136]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -114.831 ent: -7.812 str: 0.000 loss: -122.643]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.35it/s, atk: -114.831 ent: -7.812 str: 0.000 loss: -122.643]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.35it/s, atk: -119.256 ent: -7.813 str: 0.000 loss: -127.069]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -119.256 ent: -7.813 str: 0.000 loss: -127.069]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -124.077 ent: -7.815 str: 0.000 loss: -131.891]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -124.077 ent: -7.815 str: 0.000 loss: -131.891]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -129.443 ent: -7.812 str: 0.000 loss: -137.255]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -129.443 ent: -7.812 str: 0.000 loss: -137.255]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -133.818 ent: -7.811 str: 0.000 loss: -141.629]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -133.818 ent: -7.811 str: 0.000 loss: -141.629]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -133.818 ent: -7.811 str: 0.000 loss: -141.629]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([562], device='cuda:0') tensor(0.9995, device='cuda:0')
after_true: tensor([821], device='cuda:0') tensor(1.0585e-06, device='cuda:0')
L1: [2481.757]	L2: [18.216867]	Linf: [0.9098039]

Accuracy on benign examples: 100.0%
gt_label: 920 pred_label: 920 pred_clean_logit 0.9718925952911377
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.40it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.55it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 15.46it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.42it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.70it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.36it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 14.71it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.54it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.41s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.39s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.52s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.63s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.1396
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -2.136 ent: -5.585 str: 0.000 loss: -7.721]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.41s/it, atk: -2.136 ent: -5.585 str: 0.000 loss: -7.721]Iterations:   3%|▎         | 1/30 [00:02<01:09,  2.41s/it, atk: -6.350 ent: -5.481 str: 0.000 loss: -11.832]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -6.350 ent: -5.481 str: 0.000 loss: -11.832]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -9.308 ent: -5.478 str: 0.000 loss: -14.786]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.14s/it, atk: -9.308 ent: -5.478 str: 0.000 loss: -14.786]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.14s/it, atk: -12.258 ent: -5.470 str: 0.000 loss: -17.728]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -12.258 ent: -5.470 str: 0.000 loss: -17.728]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -14.482 ent: -5.456 str: 0.000 loss: -19.938]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.20it/s, atk: -14.482 ent: -5.456 str: 0.000 loss: -19.938]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.20it/s, atk: -18.698 ent: -5.461 str: 0.000 loss: -24.158]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -18.698 ent: -5.461 str: 0.000 loss: -24.158]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -23.268 ent: -5.462 str: 0.000 loss: -28.730]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -23.268 ent: -5.462 str: 0.000 loss: -28.730]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -28.529 ent: -5.463 str: 0.000 loss: -33.992]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -28.529 ent: -5.463 str: 0.000 loss: -33.992]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.40it/s, atk: -33.856 ent: -5.454 str: 0.000 loss: -39.309]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -33.856 ent: -5.454 str: 0.000 loss: -39.309]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.45it/s, atk: -37.897 ent: -5.448 str: 0.000 loss: -43.344]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -37.897 ent: -5.448 str: 0.000 loss: -43.344]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.45it/s, atk: -40.754 ent: -5.446 str: 0.000 loss: -46.200]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.40it/s, atk: -40.754 ent: -5.446 str: 0.000 loss: -46.200]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.40it/s, atk: -44.152 ent: -5.443 str: 0.000 loss: -49.595]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.37it/s, atk: -44.152 ent: -5.443 str: 0.000 loss: -49.595]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.37it/s, atk: -46.677 ent: -5.441 str: 0.000 loss: -52.118]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.36it/s, atk: -46.677 ent: -5.441 str: 0.000 loss: -52.118]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -48.743 ent: -5.439 str: 0.000 loss: -54.182]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -48.743 ent: -5.439 str: 0.000 loss: -54.182]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.41it/s, atk: -50.978 ent: -5.440 str: 0.000 loss: -56.418]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -50.978 ent: -5.440 str: 0.000 loss: -56.418]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -52.902 ent: -5.443 str: 0.000 loss: -58.345]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.48it/s, atk: -52.902 ent: -5.443 str: 0.000 loss: -58.345]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.48it/s, atk: -54.966 ent: -5.445 str: 0.000 loss: -60.411]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -54.966 ent: -5.445 str: 0.000 loss: -60.411]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.47it/s, atk: -56.845 ent: -5.453 str: 0.000 loss: -62.298]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -56.845 ent: -5.453 str: 0.000 loss: -62.298]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -58.222 ent: -5.460 str: 0.000 loss: -63.681]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.38it/s, atk: -58.222 ent: -5.460 str: 0.000 loss: -63.681]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.38it/s, atk: -59.866 ent: -5.461 str: 0.000 loss: -65.328]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -59.866 ent: -5.461 str: 0.000 loss: -65.328]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -61.826 ent: -5.461 str: 0.000 loss: -67.287]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.54it/s, atk: -61.826 ent: -5.461 str: 0.000 loss: -67.287]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.54it/s, atk: -63.524 ent: -5.457 str: 0.000 loss: -68.981]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.53it/s, atk: -63.524 ent: -5.457 str: 0.000 loss: -68.981]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.53it/s, atk: -65.369 ent: -5.454 str: 0.000 loss: -70.823]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -65.369 ent: -5.454 str: 0.000 loss: -70.823]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.45it/s, atk: -67.193 ent: -5.449 str: 0.000 loss: -72.643]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -67.193 ent: -5.449 str: 0.000 loss: -72.643]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -68.200 ent: -5.440 str: 0.000 loss: -73.639]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -68.200 ent: -5.440 str: 0.000 loss: -73.639]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -69.968 ent: -5.443 str: 0.000 loss: -75.411]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.33it/s, atk: -69.968 ent: -5.443 str: 0.000 loss: -75.411]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.33it/s, atk: -71.878 ent: -5.451 str: 0.000 loss: -77.329]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -71.878 ent: -5.451 str: 0.000 loss: -77.329]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.33it/s, atk: -74.522 ent: -5.451 str: 0.000 loss: -79.973]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.34it/s, atk: -74.522 ent: -5.451 str: 0.000 loss: -79.973]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.34it/s, atk: -76.451 ent: -5.449 str: 0.000 loss: -81.900]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -76.451 ent: -5.449 str: 0.000 loss: -81.900]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -79.155 ent: -5.451 str: 0.000 loss: -84.606]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.32it/s, atk: -79.155 ent: -5.451 str: 0.000 loss: -84.606]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -79.155 ent: -5.451 str: 0.000 loss: -84.606]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([487], device='cuda:0') tensor(0.4511, device='cuda:0')
after_true: tensor([920], device='cuda:0') tensor(0.0003, device='cuda:0')
L1: [1625.6821]	L2: [13.293959]	Linf: [0.5960784]

Accuracy on benign examples: 100.0%
gt_label: 705 pred_label: 705 pred_clean_logit 0.9490323662757874
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.95it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.82it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.67it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.32it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.74it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.30it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.37it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 14.29it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.55s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.53s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.95s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.81s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4074
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.420 ent: -5.144 str: 0.000 loss: -5.565]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.18s/it, atk: -0.420 ent: -5.144 str: 0.000 loss: -5.565]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.18s/it, atk: -1.052 ent: -5.152 str: 0.000 loss: -6.204]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.34s/it, atk: -1.052 ent: -5.152 str: 0.000 loss: -6.204]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.34s/it, atk: -2.412 ent: -5.151 str: 0.000 loss: -7.563]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.14s/it, atk: -2.412 ent: -5.151 str: 0.000 loss: -7.563]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.14s/it, atk: -5.289 ent: -5.154 str: 0.000 loss: -10.443]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -5.289 ent: -5.154 str: 0.000 loss: -10.443]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -9.631 ent: -5.151 str: 0.000 loss: -14.782]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -9.631 ent: -5.151 str: 0.000 loss: -14.782]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.14it/s, atk: -13.842 ent: -5.149 str: 0.000 loss: -18.991]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -13.842 ent: -5.149 str: 0.000 loss: -18.991]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.25it/s, atk: -19.672 ent: -5.145 str: 0.000 loss: -24.817]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -19.672 ent: -5.145 str: 0.000 loss: -24.817]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -26.452 ent: -5.145 str: 0.000 loss: -31.597]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -26.452 ent: -5.145 str: 0.000 loss: -31.597]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -31.760 ent: -5.146 str: 0.000 loss: -36.906]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -31.760 ent: -5.146 str: 0.000 loss: -36.906]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -37.223 ent: -5.147 str: 0.000 loss: -42.370]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.33it/s, atk: -37.223 ent: -5.147 str: 0.000 loss: -42.370]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -42.067 ent: -5.145 str: 0.000 loss: -47.212]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -42.067 ent: -5.145 str: 0.000 loss: -47.212]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -46.720 ent: -5.146 str: 0.000 loss: -51.866]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -46.720 ent: -5.146 str: 0.000 loss: -51.866]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -49.331 ent: -5.144 str: 0.000 loss: -54.475]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -49.331 ent: -5.144 str: 0.000 loss: -54.475]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.40it/s, atk: -53.743 ent: -5.145 str: 0.000 loss: -58.888]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.38it/s, atk: -53.743 ent: -5.145 str: 0.000 loss: -58.888]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -58.294 ent: -5.143 str: 0.000 loss: -63.436]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.31it/s, atk: -58.294 ent: -5.143 str: 0.000 loss: -63.436]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.31it/s, atk: -62.301 ent: -5.143 str: 0.000 loss: -67.444]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -62.301 ent: -5.143 str: 0.000 loss: -67.444]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -65.754 ent: -5.143 str: 0.000 loss: -70.897]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.33it/s, atk: -65.754 ent: -5.143 str: 0.000 loss: -70.897]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.33it/s, atk: -70.272 ent: -5.142 str: 0.000 loss: -75.414]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.29it/s, atk: -70.272 ent: -5.142 str: 0.000 loss: -75.414]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.29it/s, atk: -74.446 ent: -5.141 str: 0.000 loss: -79.587]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.27it/s, atk: -74.446 ent: -5.141 str: 0.000 loss: -79.587]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.27it/s, atk: -77.409 ent: -5.139 str: 0.000 loss: -82.548]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.32it/s, atk: -77.409 ent: -5.139 str: 0.000 loss: -82.548]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.32it/s, atk: -79.189 ent: -5.138 str: 0.000 loss: -84.326]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.31it/s, atk: -79.189 ent: -5.138 str: 0.000 loss: -84.326]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.31it/s, atk: -81.577 ent: -5.137 str: 0.000 loss: -86.714]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -81.577 ent: -5.137 str: 0.000 loss: -86.714]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.34it/s, atk: -83.912 ent: -5.137 str: 0.000 loss: -89.048]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.41it/s, atk: -83.912 ent: -5.137 str: 0.000 loss: -89.048]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.41it/s, atk: -86.927 ent: -5.137 str: 0.000 loss: -92.064]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -86.927 ent: -5.137 str: 0.000 loss: -92.064]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -89.732 ent: -5.138 str: 0.000 loss: -94.870]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.38it/s, atk: -89.732 ent: -5.138 str: 0.000 loss: -94.870]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.38it/s, atk: -91.619 ent: -5.138 str: 0.000 loss: -96.757]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.35it/s, atk: -91.619 ent: -5.138 str: 0.000 loss: -96.757]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.35it/s, atk: -93.340 ent: -5.139 str: 0.000 loss: -98.479]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.35it/s, atk: -93.340 ent: -5.139 str: 0.000 loss: -98.479]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.35it/s, atk: -96.846 ent: -5.138 str: 0.000 loss: -101.984]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.46it/s, atk: -96.846 ent: -5.138 str: 0.000 loss: -101.984]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.46it/s, atk: -98.621 ent: -5.139 str: 0.000 loss: -103.760]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.38it/s, atk: -98.621 ent: -5.139 str: 0.000 loss: -103.760]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.38it/s, atk: -100.970 ent: -5.139 str: 0.000 loss: -106.109]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.37it/s, atk: -100.970 ent: -5.139 str: 0.000 loss: -106.109]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -100.970 ent: -5.139 str: 0.000 loss: -106.109]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([829], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([705], device='cuda:0') tensor(3.0619e-05, device='cuda:0')
L1: [2207.8745]	L2: [16.989418]	Linf: [0.70980394]

Accuracy on benign examples: 100.0%
gt_label: 779 pred_label: 779 pred_clean_logit 0.9997072815895081
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.42it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.79it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 21.13it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 21.05it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 21.45it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 21.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 18.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.66it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4150
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.004 ent: -5.181 str: 0.000 loss: -5.185]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.57s/it, atk: -0.004 ent: -5.181 str: 0.000 loss: -5.185]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.57s/it, atk: -0.009 ent: -5.224 str: 0.000 loss: -5.232]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -0.009 ent: -5.224 str: 0.000 loss: -5.232]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -0.015 ent: -5.260 str: 0.000 loss: -5.276]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.13s/it, atk: -0.015 ent: -5.260 str: 0.000 loss: -5.276]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.13s/it, atk: -0.023 ent: -5.287 str: 0.000 loss: -5.311]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -0.023 ent: -5.287 str: 0.000 loss: -5.311]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.05it/s, atk: -0.039 ent: -5.307 str: 0.000 loss: -5.347]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -0.039 ent: -5.307 str: 0.000 loss: -5.347]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -0.039 ent: -5.312 str: 0.000 loss: -5.352]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -0.039 ent: -5.312 str: 0.000 loss: -5.352]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -0.056 ent: -5.319 str: 0.000 loss: -5.375]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -0.056 ent: -5.319 str: 0.000 loss: -5.375]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.32it/s, atk: -0.112 ent: -5.327 str: 0.000 loss: -5.438]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.29it/s, atk: -0.112 ent: -5.327 str: 0.000 loss: -5.438]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.29it/s, atk: -0.203 ent: -5.330 str: 0.000 loss: -5.533]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -0.203 ent: -5.330 str: 0.000 loss: -5.533]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.32it/s, atk: -0.513 ent: -5.333 str: 0.000 loss: -5.846]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -0.513 ent: -5.333 str: 0.000 loss: -5.846]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.34it/s, atk: -0.855 ent: -5.328 str: 0.000 loss: -6.184]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.34it/s, atk: -0.855 ent: -5.328 str: 0.000 loss: -6.184]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.34it/s, atk: -1.719 ent: -5.325 str: 0.000 loss: -7.044]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -1.719 ent: -5.325 str: 0.000 loss: -7.044]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -3.480 ent: -5.327 str: 0.000 loss: -8.807]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.32it/s, atk: -3.480 ent: -5.327 str: 0.000 loss: -8.807]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.32it/s, atk: -5.957 ent: -5.327 str: 0.000 loss: -11.285]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -5.957 ent: -5.327 str: 0.000 loss: -11.285]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.40it/s, atk: -9.368 ent: -5.321 str: 0.000 loss: -14.689]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -9.368 ent: -5.321 str: 0.000 loss: -14.689]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -11.569 ent: -5.317 str: 0.000 loss: -16.887]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.50it/s, atk: -11.569 ent: -5.317 str: 0.000 loss: -16.887]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.50it/s, atk: -16.359 ent: -5.315 str: 0.000 loss: -21.674]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.57it/s, atk: -16.359 ent: -5.315 str: 0.000 loss: -21.674]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.57it/s, atk: -21.595 ent: -5.311 str: 0.000 loss: -26.906]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.50it/s, atk: -21.595 ent: -5.311 str: 0.000 loss: -26.906]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.50it/s, atk: -25.535 ent: -5.310 str: 0.000 loss: -30.845]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.50it/s, atk: -25.535 ent: -5.310 str: 0.000 loss: -30.845]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.50it/s, atk: -29.758 ent: -5.308 str: 0.000 loss: -35.065]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -29.758 ent: -5.308 str: 0.000 loss: -35.065]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.46it/s, atk: -35.893 ent: -5.307 str: 0.000 loss: -41.199]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -35.893 ent: -5.307 str: 0.000 loss: -41.199]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -40.927 ent: -5.305 str: 0.000 loss: -46.232]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -40.927 ent: -5.305 str: 0.000 loss: -46.232]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -45.566 ent: -5.303 str: 0.000 loss: -50.869]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -45.566 ent: -5.303 str: 0.000 loss: -50.869]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.47it/s, atk: -51.198 ent: -5.301 str: 0.000 loss: -56.498]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -51.198 ent: -5.301 str: 0.000 loss: -56.498]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.45it/s, atk: -55.339 ent: -5.298 str: 0.000 loss: -60.638]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.38it/s, atk: -55.339 ent: -5.298 str: 0.000 loss: -60.638]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.38it/s, atk: -58.705 ent: -5.296 str: 0.000 loss: -64.002]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -58.705 ent: -5.296 str: 0.000 loss: -64.002]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -63.806 ent: -5.296 str: 0.000 loss: -69.102]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -63.806 ent: -5.296 str: 0.000 loss: -69.102]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -69.616 ent: -5.294 str: 0.000 loss: -74.910]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -69.616 ent: -5.294 str: 0.000 loss: -74.910]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.49it/s, atk: -73.473 ent: -5.291 str: 0.000 loss: -78.764]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.53it/s, atk: -73.473 ent: -5.291 str: 0.000 loss: -78.764]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.53it/s, atk: -77.020 ent: -5.292 str: 0.000 loss: -82.312]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.52it/s, atk: -77.020 ent: -5.292 str: 0.000 loss: -82.312]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -77.020 ent: -5.292 str: 0.000 loss: -82.312]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([874], device='cuda:0') tensor(0.9988, device='cuda:0')
after_true: tensor([779], device='cuda:0') tensor(0.0003, device='cuda:0')
L1: [2222.3022]	L2: [14.334305]	Linf: [0.58431375]

Accuracy on benign examples: 100.0%
gt_label: 861 pred_label: 861 pred_clean_logit 0.9894649982452393
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.53it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.70it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.41it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.25it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.81it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.24it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.48it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.70it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.51it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.28it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.27s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5266
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.085 ent: -5.514 str: 0.000 loss: -5.599]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.35s/it, atk: -0.085 ent: -5.514 str: 0.000 loss: -5.599]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.35s/it, atk: -0.136 ent: -5.516 str: 0.000 loss: -5.652]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -0.136 ent: -5.516 str: 0.000 loss: -5.652]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -0.223 ent: -5.524 str: 0.000 loss: -5.747]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.14s/it, atk: -0.223 ent: -5.524 str: 0.000 loss: -5.747]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.14s/it, atk: -0.330 ent: -5.531 str: 0.000 loss: -5.861]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.00s/it, atk: -0.330 ent: -5.531 str: 0.000 loss: -5.861]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.00s/it, atk: -0.426 ent: -5.531 str: 0.000 loss: -5.957]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -0.426 ent: -5.531 str: 0.000 loss: -5.957]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.12it/s, atk: -0.636 ent: -5.535 str: 0.000 loss: -6.172]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -0.636 ent: -5.535 str: 0.000 loss: -6.172]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -0.855 ent: -5.539 str: 0.000 loss: -6.395]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -0.855 ent: -5.539 str: 0.000 loss: -6.395]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.28it/s, atk: -1.138 ent: -5.541 str: 0.000 loss: -6.679]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -1.138 ent: -5.541 str: 0.000 loss: -6.679]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -1.631 ent: -5.543 str: 0.000 loss: -7.174]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -1.631 ent: -5.543 str: 0.000 loss: -7.174]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -2.370 ent: -5.544 str: 0.000 loss: -7.914]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.35it/s, atk: -2.370 ent: -5.544 str: 0.000 loss: -7.914]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.35it/s, atk: -3.391 ent: -5.544 str: 0.000 loss: -8.936]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -3.391 ent: -5.544 str: 0.000 loss: -8.936]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -4.488 ent: -5.545 str: 0.000 loss: -10.033]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -4.488 ent: -5.545 str: 0.000 loss: -10.033]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -6.408 ent: -5.541 str: 0.000 loss: -11.949]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -6.408 ent: -5.541 str: 0.000 loss: -11.949]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.47it/s, atk: -8.662 ent: -5.540 str: 0.000 loss: -14.202]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -8.662 ent: -5.540 str: 0.000 loss: -14.202]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -11.586 ent: -5.540 str: 0.000 loss: -17.126]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -11.586 ent: -5.540 str: 0.000 loss: -17.126]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -13.114 ent: -5.539 str: 0.000 loss: -18.653]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -13.114 ent: -5.539 str: 0.000 loss: -18.653]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -16.122 ent: -5.533 str: 0.000 loss: -21.656]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -16.122 ent: -5.533 str: 0.000 loss: -21.656]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -18.931 ent: -5.531 str: 0.000 loss: -24.462]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -18.931 ent: -5.531 str: 0.000 loss: -24.462]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.46it/s, atk: -23.155 ent: -5.530 str: 0.000 loss: -28.684]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -23.155 ent: -5.530 str: 0.000 loss: -28.684]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -28.242 ent: -5.530 str: 0.000 loss: -33.772]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -28.242 ent: -5.530 str: 0.000 loss: -33.772]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.41it/s, atk: -30.606 ent: -5.528 str: 0.000 loss: -36.134]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.38it/s, atk: -30.606 ent: -5.528 str: 0.000 loss: -36.134]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.38it/s, atk: -35.694 ent: -5.525 str: 0.000 loss: -41.219]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.47it/s, atk: -35.694 ent: -5.525 str: 0.000 loss: -41.219]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.47it/s, atk: -39.000 ent: -5.522 str: 0.000 loss: -44.522]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.47it/s, atk: -39.000 ent: -5.522 str: 0.000 loss: -44.522]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.47it/s, atk: -43.651 ent: -5.521 str: 0.000 loss: -49.171]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -43.651 ent: -5.521 str: 0.000 loss: -49.171]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -47.868 ent: -5.520 str: 0.000 loss: -53.387]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -47.868 ent: -5.520 str: 0.000 loss: -53.387]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -51.062 ent: -5.520 str: 0.000 loss: -56.582]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -51.062 ent: -5.520 str: 0.000 loss: -56.582]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.41it/s, atk: -56.318 ent: -5.519 str: 0.000 loss: -61.837]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -56.318 ent: -5.519 str: 0.000 loss: -61.837]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -61.915 ent: -5.520 str: 0.000 loss: -67.436]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -61.915 ent: -5.520 str: 0.000 loss: -67.436]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -66.237 ent: -5.520 str: 0.000 loss: -71.758]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.44it/s, atk: -66.237 ent: -5.520 str: 0.000 loss: -71.758]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -71.575 ent: -5.520 str: 0.000 loss: -77.095]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.44it/s, atk: -71.575 ent: -5.520 str: 0.000 loss: -77.095]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -71.575 ent: -5.520 str: 0.000 loss: -77.095]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([849], device='cuda:0') tensor(0.8375, device='cuda:0')
after_true: tensor([861], device='cuda:0') tensor(0.0005, device='cuda:0')
L1: [1274.5803]	L2: [9.639839]	Linf: [0.5058824]

Accuracy on benign examples: 100.0%
gt_label: 511 pred_label: 511 pred_clean_logit 0.6977852582931519
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.80it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.19it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.34it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.70it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.93it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.81it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.48it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.68it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.35it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.57s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.52s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4156
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.810 ent: -2.607 str: 0.000 loss: -7.416]Iterations:   3%|▎         | 1/30 [00:01<00:43,  1.51s/it, atk: -4.810 ent: -2.607 str: 0.000 loss: -7.416]Iterations:   3%|▎         | 1/30 [00:01<00:43,  1.51s/it, atk: -11.376 ent: -2.602 str: 0.000 loss: -13.978]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.07s/it, atk: -11.376 ent: -2.602 str: 0.000 loss: -13.978]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.07s/it, atk: -18.074 ent: -2.601 str: 0.000 loss: -20.676]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.17it/s, atk: -18.074 ent: -2.601 str: 0.000 loss: -20.676]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.17it/s, atk: -24.473 ent: -2.601 str: 0.000 loss: -27.075]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.31it/s, atk: -24.473 ent: -2.601 str: 0.000 loss: -27.075]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.31it/s, atk: -30.644 ent: -2.600 str: 0.000 loss: -33.244]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -30.644 ent: -2.600 str: 0.000 loss: -33.244]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -35.545 ent: -2.599 str: 0.000 loss: -38.144]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -35.545 ent: -2.599 str: 0.000 loss: -38.144]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -40.577 ent: -2.599 str: 0.000 loss: -43.176]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.29it/s, atk: -40.577 ent: -2.599 str: 0.000 loss: -43.176]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -44.617 ent: -2.599 str: 0.000 loss: -47.215]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -44.617 ent: -2.599 str: 0.000 loss: -47.215]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -49.200 ent: -2.600 str: 0.000 loss: -51.800]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -49.200 ent: -2.600 str: 0.000 loss: -51.800]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -52.235 ent: -2.601 str: 0.000 loss: -54.836]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -52.235 ent: -2.601 str: 0.000 loss: -54.836]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -55.901 ent: -2.602 str: 0.000 loss: -58.503]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.42it/s, atk: -55.901 ent: -2.602 str: 0.000 loss: -58.503]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -59.335 ent: -2.601 str: 0.000 loss: -61.936]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.30it/s, atk: -59.335 ent: -2.601 str: 0.000 loss: -61.936]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.30it/s, atk: -62.682 ent: -2.601 str: 0.000 loss: -65.284]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.27it/s, atk: -62.682 ent: -2.601 str: 0.000 loss: -65.284]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.27it/s, atk: -64.254 ent: -2.600 str: 0.000 loss: -66.854]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.34it/s, atk: -64.254 ent: -2.600 str: 0.000 loss: -66.854]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.34it/s, atk: -67.234 ent: -2.602 str: 0.000 loss: -69.836]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.30it/s, atk: -67.234 ent: -2.602 str: 0.000 loss: -69.836]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.30it/s, atk: -69.802 ent: -2.601 str: 0.000 loss: -72.403]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.29it/s, atk: -69.802 ent: -2.601 str: 0.000 loss: -72.403]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.29it/s, atk: -72.700 ent: -2.601 str: 0.000 loss: -75.302]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.23it/s, atk: -72.700 ent: -2.601 str: 0.000 loss: -75.302]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.23it/s, atk: -75.674 ent: -2.602 str: 0.000 loss: -78.276]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.25it/s, atk: -75.674 ent: -2.602 str: 0.000 loss: -78.276]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.25it/s, atk: -78.914 ent: -2.603 str: 0.000 loss: -81.517]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.29it/s, atk: -78.914 ent: -2.603 str: 0.000 loss: -81.517]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.29it/s, atk: -81.993 ent: -2.604 str: 0.000 loss: -84.598]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.29it/s, atk: -81.993 ent: -2.604 str: 0.000 loss: -84.598]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.29it/s, atk: -84.595 ent: -2.605 str: 0.000 loss: -87.201]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -84.595 ent: -2.605 str: 0.000 loss: -87.201]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -87.238 ent: -2.606 str: 0.000 loss: -89.844]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.38it/s, atk: -87.238 ent: -2.606 str: 0.000 loss: -89.844]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.38it/s, atk: -89.872 ent: -2.607 str: 0.000 loss: -92.479]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.40it/s, atk: -89.872 ent: -2.607 str: 0.000 loss: -92.479]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.40it/s, atk: -92.466 ent: -2.607 str: 0.000 loss: -95.073]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -92.466 ent: -2.607 str: 0.000 loss: -95.073]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -95.082 ent: -2.607 str: 0.000 loss: -97.689]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -95.082 ent: -2.607 str: 0.000 loss: -97.689]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -97.357 ent: -2.606 str: 0.000 loss: -99.963]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.44it/s, atk: -97.357 ent: -2.606 str: 0.000 loss: -99.963]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -99.276 ent: -2.606 str: 0.000 loss: -101.883]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.48it/s, atk: -99.276 ent: -2.606 str: 0.000 loss: -101.883]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.48it/s, atk: -101.184 ent: -2.605 str: 0.000 loss: -103.790]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.48it/s, atk: -101.184 ent: -2.605 str: 0.000 loss: -103.790]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.48it/s, atk: -103.040 ent: -2.605 str: 0.000 loss: -105.646]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.56it/s, atk: -103.040 ent: -2.605 str: 0.000 loss: -105.646]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.56it/s, atk: -104.743 ent: -2.606 str: 0.000 loss: -107.349]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -104.743 ent: -2.606 str: 0.000 loss: -107.349]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -104.743 ent: -2.606 str: 0.000 loss: -107.349]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([817], device='cuda:0') tensor(0.7524, device='cuda:0')
after_true: tensor([511], device='cuda:0') tensor(2.3969e-05, device='cuda:0')
L1: [2383.0237]	L2: [21.851631]	Linf: [0.84705883]

Accuracy on benign examples: 100.0%
gt_label: 150 pred_label: 150 pred_clean_logit 0.9717631936073303
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.88it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.33it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.57it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.83it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.43it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.27it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.02it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.75it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.86it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.78s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.61s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.68s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3231
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.425 ent: -5.148 str: 0.000 loss: -5.574]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.20s/it, atk: -0.425 ent: -5.148 str: 0.000 loss: -5.574]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.20s/it, atk: -1.014 ent: -5.132 str: 0.000 loss: -6.145]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.08it/s, atk: -1.014 ent: -5.132 str: 0.000 loss: -6.145]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.08it/s, atk: -2.966 ent: -5.135 str: 0.000 loss: -8.101]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.19it/s, atk: -2.966 ent: -5.135 str: 0.000 loss: -8.101]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.19it/s, atk: -6.125 ent: -5.135 str: 0.000 loss: -11.260]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -6.125 ent: -5.135 str: 0.000 loss: -11.260]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -7.611 ent: -5.139 str: 0.000 loss: -12.749]Iterations:  17%|█▋        | 5/30 [00:03<00:18,  1.35it/s, atk: -7.611 ent: -5.139 str: 0.000 loss: -12.749]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.35it/s, atk: -12.169 ent: -5.127 str: 0.000 loss: -17.296]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.29it/s, atk: -12.169 ent: -5.127 str: 0.000 loss: -17.296]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -17.399 ent: -5.128 str: 0.000 loss: -22.527]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.28it/s, atk: -17.399 ent: -5.128 str: 0.000 loss: -22.527]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -19.089 ent: -5.125 str: 0.000 loss: -24.214]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.28it/s, atk: -19.089 ent: -5.125 str: 0.000 loss: -24.214]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.28it/s, atk: -26.008 ent: -5.125 str: 0.000 loss: -31.134]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -26.008 ent: -5.125 str: 0.000 loss: -31.134]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -33.207 ent: -5.118 str: 0.000 loss: -38.325]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.37it/s, atk: -33.207 ent: -5.118 str: 0.000 loss: -38.325]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -39.795 ent: -5.112 str: 0.000 loss: -44.907]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -39.795 ent: -5.112 str: 0.000 loss: -44.907]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -47.945 ent: -5.110 str: 0.000 loss: -53.055]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -47.945 ent: -5.110 str: 0.000 loss: -53.055]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -53.094 ent: -5.109 str: 0.000 loss: -58.202]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.39it/s, atk: -53.094 ent: -5.109 str: 0.000 loss: -58.202]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -58.761 ent: -5.102 str: 0.000 loss: -63.863]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -58.761 ent: -5.102 str: 0.000 loss: -63.863]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -66.339 ent: -5.099 str: 0.000 loss: -71.438]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -66.339 ent: -5.099 str: 0.000 loss: -71.438]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -73.027 ent: -5.099 str: 0.000 loss: -78.126]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.49it/s, atk: -73.027 ent: -5.099 str: 0.000 loss: -78.126]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -78.552 ent: -5.099 str: 0.000 loss: -83.651]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.49it/s, atk: -78.552 ent: -5.099 str: 0.000 loss: -83.651]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.49it/s, atk: -86.338 ent: -5.099 str: 0.000 loss: -91.437]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -86.338 ent: -5.099 str: 0.000 loss: -91.437]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -91.893 ent: -5.099 str: 0.000 loss: -96.992]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.42it/s, atk: -91.893 ent: -5.099 str: 0.000 loss: -96.992]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -100.520 ent: -5.099 str: 0.000 loss: -105.618]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.49it/s, atk: -100.520 ent: -5.099 str: 0.000 loss: -105.618]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.49it/s, atk: -107.263 ent: -5.101 str: 0.000 loss: -112.364]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -107.263 ent: -5.101 str: 0.000 loss: -112.364]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -116.334 ent: -5.099 str: 0.000 loss: -121.433]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.45it/s, atk: -116.334 ent: -5.099 str: 0.000 loss: -121.433]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -125.588 ent: -5.098 str: 0.000 loss: -130.686]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -125.588 ent: -5.098 str: 0.000 loss: -130.686]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -132.496 ent: -5.097 str: 0.000 loss: -137.592]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -132.496 ent: -5.097 str: 0.000 loss: -137.592]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.50it/s, atk: -138.887 ent: -5.095 str: 0.000 loss: -143.982]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -138.887 ent: -5.095 str: 0.000 loss: -143.982]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.56it/s, atk: -146.311 ent: -5.097 str: 0.000 loss: -151.408]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.53it/s, atk: -146.311 ent: -5.097 str: 0.000 loss: -151.408]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.53it/s, atk: -153.704 ent: -5.096 str: 0.000 loss: -158.800]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.43it/s, atk: -153.704 ent: -5.096 str: 0.000 loss: -158.800]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.43it/s, atk: -159.535 ent: -5.094 str: 0.000 loss: -164.629]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.45it/s, atk: -159.535 ent: -5.094 str: 0.000 loss: -164.629]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -165.273 ent: -5.089 str: 0.000 loss: -170.362]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.46it/s, atk: -165.273 ent: -5.089 str: 0.000 loss: -170.362]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.46it/s, atk: -174.040 ent: -5.088 str: 0.000 loss: -179.128]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -174.040 ent: -5.088 str: 0.000 loss: -179.128]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -174.040 ent: -5.088 str: 0.000 loss: -179.128]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([982], device='cuda:0') tensor(0.9143, device='cuda:0')
after_true: tensor([150], device='cuda:0') tensor(1.5461e-08, device='cuda:0')
L1: [1824.9177]	L2: [14.797777]	Linf: [0.7019608]

Accuracy on benign examples: 100.0%
gt_label: 603 pred_label: 603 pred_clean_logit 0.9797001481056213
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.75it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.61it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.07it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 14.10it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.93it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.97it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.55it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.96it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.47it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.35s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.36s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.38s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.48s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6733
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.414 ent: -5.290 str: 0.000 loss: -5.703]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.83s/it, atk: -0.414 ent: -5.290 str: 0.000 loss: -5.703]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.83s/it, atk: -1.111 ent: -5.275 str: 0.000 loss: -6.386]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.17s/it, atk: -1.111 ent: -5.275 str: 0.000 loss: -6.386]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.17s/it, atk: -3.653 ent: -5.269 str: 0.000 loss: -8.922]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -3.653 ent: -5.269 str: 0.000 loss: -8.922]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -8.993 ent: -5.268 str: 0.000 loss: -14.261]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.20it/s, atk: -8.993 ent: -5.268 str: 0.000 loss: -14.261]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -13.319 ent: -5.258 str: 0.000 loss: -18.577]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.23it/s, atk: -13.319 ent: -5.258 str: 0.000 loss: -18.577]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -20.980 ent: -5.250 str: 0.000 loss: -26.229]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -20.980 ent: -5.250 str: 0.000 loss: -26.229]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -28.212 ent: -5.251 str: 0.000 loss: -33.464]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -28.212 ent: -5.251 str: 0.000 loss: -33.464]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -35.390 ent: -5.255 str: 0.000 loss: -40.645]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.37it/s, atk: -35.390 ent: -5.255 str: 0.000 loss: -40.645]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -40.218 ent: -5.258 str: 0.000 loss: -45.476]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -40.218 ent: -5.258 str: 0.000 loss: -45.476]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -44.653 ent: -5.260 str: 0.000 loss: -49.913]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -44.653 ent: -5.260 str: 0.000 loss: -49.913]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -50.044 ent: -5.262 str: 0.000 loss: -55.306]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.48it/s, atk: -50.044 ent: -5.262 str: 0.000 loss: -55.306]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.48it/s, atk: -54.515 ent: -5.262 str: 0.000 loss: -59.777]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -54.515 ent: -5.262 str: 0.000 loss: -59.777]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -58.898 ent: -5.262 str: 0.000 loss: -64.159]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -58.898 ent: -5.262 str: 0.000 loss: -64.159]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -63.544 ent: -5.261 str: 0.000 loss: -68.804]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -63.544 ent: -5.261 str: 0.000 loss: -68.804]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.49it/s, atk: -68.914 ent: -5.260 str: 0.000 loss: -74.174]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -68.914 ent: -5.260 str: 0.000 loss: -74.174]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -74.929 ent: -5.259 str: 0.000 loss: -80.188]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -74.929 ent: -5.259 str: 0.000 loss: -80.188]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -80.476 ent: -5.258 str: 0.000 loss: -85.733]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.41it/s, atk: -80.476 ent: -5.258 str: 0.000 loss: -85.733]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -86.358 ent: -5.258 str: 0.000 loss: -91.615]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -86.358 ent: -5.258 str: 0.000 loss: -91.615]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -92.078 ent: -5.259 str: 0.000 loss: -97.337]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -92.078 ent: -5.259 str: 0.000 loss: -97.337]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -97.275 ent: -5.260 str: 0.000 loss: -102.534]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -97.275 ent: -5.260 str: 0.000 loss: -102.534]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -102.482 ent: -5.260 str: 0.000 loss: -107.743]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.32it/s, atk: -102.482 ent: -5.260 str: 0.000 loss: -107.743]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.32it/s, atk: -107.339 ent: -5.262 str: 0.000 loss: -112.600]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.35it/s, atk: -107.339 ent: -5.262 str: 0.000 loss: -112.600]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.35it/s, atk: -111.631 ent: -5.262 str: 0.000 loss: -116.892]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -111.631 ent: -5.262 str: 0.000 loss: -116.892]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -116.765 ent: -5.263 str: 0.000 loss: -122.027]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.34it/s, atk: -116.765 ent: -5.263 str: 0.000 loss: -122.027]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.34it/s, atk: -120.768 ent: -5.263 str: 0.000 loss: -126.031]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.37it/s, atk: -120.768 ent: -5.263 str: 0.000 loss: -126.031]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.37it/s, atk: -126.458 ent: -5.264 str: 0.000 loss: -131.722]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -126.458 ent: -5.264 str: 0.000 loss: -131.722]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -132.263 ent: -5.263 str: 0.000 loss: -137.526]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.35it/s, atk: -132.263 ent: -5.263 str: 0.000 loss: -137.526]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.35it/s, atk: -136.277 ent: -5.263 str: 0.000 loss: -141.541]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.37it/s, atk: -136.277 ent: -5.263 str: 0.000 loss: -141.541]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -142.539 ent: -5.264 str: 0.000 loss: -147.803]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.34it/s, atk: -142.539 ent: -5.264 str: 0.000 loss: -147.803]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.34it/s, atk: -142.978 ent: -5.268 str: 0.000 loss: -148.246]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -142.978 ent: -5.268 str: 0.000 loss: -148.246]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -142.978 ent: -5.268 str: 0.000 loss: -148.246]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([518], device='cuda:0') tensor(0.9614, device='cuda:0')
after_true: tensor([603], device='cuda:0') tensor(5.4216e-07, device='cuda:0')
L1: [2844.2627]	L2: [22.139366]	Linf: [0.8666667]

Accuracy on benign examples: 100.0%
gt_label: 954 pred_label: 954 pred_clean_logit 0.8670639395713806
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.46it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 14.39it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.16it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.48it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.96it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.93it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.81it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.81it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.82s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.57s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.49s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5249
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -5.021 ent: -2.829 str: 0.000 loss: -7.851]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.44s/it, atk: -5.021 ent: -2.829 str: 0.000 loss: -7.851]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.44s/it, atk: -23.434 ent: -2.804 str: 0.000 loss: -26.239]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -23.434 ent: -2.804 str: 0.000 loss: -26.239]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -37.043 ent: -2.799 str: 0.000 loss: -39.842]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.00it/s, atk: -37.043 ent: -2.799 str: 0.000 loss: -39.842]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.00it/s, atk: -46.522 ent: -2.799 str: 0.000 loss: -49.321]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.16it/s, atk: -46.522 ent: -2.799 str: 0.000 loss: -49.321]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -54.704 ent: -2.806 str: 0.000 loss: -57.510]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.25it/s, atk: -54.704 ent: -2.806 str: 0.000 loss: -57.510]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.25it/s, atk: -51.739 ent: -2.797 str: 0.000 loss: -54.536]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -51.739 ent: -2.797 str: 0.000 loss: -54.536]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -57.043 ent: -2.801 str: 0.000 loss: -59.844]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -57.043 ent: -2.801 str: 0.000 loss: -59.844]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -58.761 ent: -2.804 str: 0.000 loss: -61.565]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.37it/s, atk: -58.761 ent: -2.804 str: 0.000 loss: -61.565]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.37it/s, atk: -63.011 ent: -2.803 str: 0.000 loss: -65.813]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -63.011 ent: -2.803 str: 0.000 loss: -65.813]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -67.099 ent: -2.804 str: 0.000 loss: -69.903]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -67.099 ent: -2.804 str: 0.000 loss: -69.903]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -70.397 ent: -2.804 str: 0.000 loss: -73.200]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.40it/s, atk: -70.397 ent: -2.804 str: 0.000 loss: -73.200]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.40it/s, atk: -73.641 ent: -2.802 str: 0.000 loss: -76.443]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.42it/s, atk: -73.641 ent: -2.802 str: 0.000 loss: -76.443]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.42it/s, atk: -77.430 ent: -2.800 str: 0.000 loss: -80.230]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -77.430 ent: -2.800 str: 0.000 loss: -80.230]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -79.941 ent: -2.799 str: 0.000 loss: -82.739]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.44it/s, atk: -79.941 ent: -2.799 str: 0.000 loss: -82.739]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -83.246 ent: -2.799 str: 0.000 loss: -86.045]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -83.246 ent: -2.799 str: 0.000 loss: -86.045]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -86.607 ent: -2.801 str: 0.000 loss: -89.408]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.36it/s, atk: -86.607 ent: -2.801 str: 0.000 loss: -89.408]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.36it/s, atk: -89.309 ent: -2.803 str: 0.000 loss: -92.112]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -89.309 ent: -2.803 str: 0.000 loss: -92.112]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -92.197 ent: -2.803 str: 0.000 loss: -95.000]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.49it/s, atk: -92.197 ent: -2.803 str: 0.000 loss: -95.000]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -95.794 ent: -2.802 str: 0.000 loss: -98.596]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -95.794 ent: -2.802 str: 0.000 loss: -98.596]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -98.873 ent: -2.802 str: 0.000 loss: -101.675]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -98.873 ent: -2.802 str: 0.000 loss: -101.675]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -101.680 ent: -2.802 str: 0.000 loss: -104.483]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.34it/s, atk: -101.680 ent: -2.802 str: 0.000 loss: -104.483]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.34it/s, atk: -105.456 ent: -2.802 str: 0.000 loss: -108.258]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.33it/s, atk: -105.456 ent: -2.802 str: 0.000 loss: -108.258]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.33it/s, atk: -108.638 ent: -2.800 str: 0.000 loss: -111.439]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.34it/s, atk: -108.638 ent: -2.800 str: 0.000 loss: -111.439]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.34it/s, atk: -112.256 ent: -2.801 str: 0.000 loss: -115.057]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.39it/s, atk: -112.256 ent: -2.801 str: 0.000 loss: -115.057]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.39it/s, atk: -116.030 ent: -2.802 str: 0.000 loss: -118.832]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -116.030 ent: -2.802 str: 0.000 loss: -118.832]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -118.579 ent: -2.800 str: 0.000 loss: -121.379]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.36it/s, atk: -118.579 ent: -2.800 str: 0.000 loss: -121.379]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.36it/s, atk: -122.053 ent: -2.799 str: 0.000 loss: -124.852]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.39it/s, atk: -122.053 ent: -2.799 str: 0.000 loss: -124.852]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.39it/s, atk: -125.082 ent: -2.798 str: 0.000 loss: -127.881]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -125.082 ent: -2.798 str: 0.000 loss: -127.881]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -128.669 ent: -2.798 str: 0.000 loss: -131.467]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -128.669 ent: -2.798 str: 0.000 loss: -131.467]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -131.692 ent: -2.799 str: 0.000 loss: -134.491]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -131.692 ent: -2.799 str: 0.000 loss: -134.491]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -131.692 ent: -2.799 str: 0.000 loss: -134.491]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([786], device='cuda:0') tensor(0.9940, device='cuda:0')
after_true: tensor([954], device='cuda:0') tensor(1.2367e-06, device='cuda:0')
L1: [2354.1099]	L2: [19.36076]	Linf: [0.63529414]

Accuracy on benign examples: 100.0%
gt_label: 820 pred_label: 820 pred_clean_logit 0.9998477697372437
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.60it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.64it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.39it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.31it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 22.91it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 23.33it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.56it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.63s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6468
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -5.372 str: 0.000 loss: -5.375]Iterations:   3%|▎         | 1/30 [00:02<01:02,  2.17s/it, atk: -0.003 ent: -5.372 str: 0.000 loss: -5.375]Iterations:   3%|▎         | 1/30 [00:02<01:02,  2.17s/it, atk: -0.003 ent: -5.437 str: 0.000 loss: -5.440]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.25s/it, atk: -0.003 ent: -5.437 str: 0.000 loss: -5.440]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.25s/it, atk: -0.008 ent: -5.465 str: 0.000 loss: -5.473]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.008 ent: -5.465 str: 0.000 loss: -5.473]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.03s/it, atk: -0.012 ent: -5.495 str: 0.000 loss: -5.507]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -0.012 ent: -5.495 str: 0.000 loss: -5.507]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -0.018 ent: -5.521 str: 0.000 loss: -5.540]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.30it/s, atk: -0.018 ent: -5.521 str: 0.000 loss: -5.540]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.30it/s, atk: -0.032 ent: -5.546 str: 0.000 loss: -5.577]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -0.032 ent: -5.546 str: 0.000 loss: -5.577]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -0.058 ent: -5.566 str: 0.000 loss: -5.623]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -0.058 ent: -5.566 str: 0.000 loss: -5.623]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -0.100 ent: -5.584 str: 0.000 loss: -5.684]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -0.100 ent: -5.584 str: 0.000 loss: -5.684]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.42it/s, atk: -0.160 ent: -5.596 str: 0.000 loss: -5.756]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -0.160 ent: -5.596 str: 0.000 loss: -5.756]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -0.337 ent: -5.598 str: 0.000 loss: -5.935]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.39it/s, atk: -0.337 ent: -5.598 str: 0.000 loss: -5.935]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.39it/s, atk: -0.874 ent: -5.599 str: 0.000 loss: -6.473]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -0.874 ent: -5.599 str: 0.000 loss: -6.473]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -1.692 ent: -5.601 str: 0.000 loss: -7.293]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -1.692 ent: -5.601 str: 0.000 loss: -7.293]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -3.111 ent: -5.599 str: 0.000 loss: -8.710]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -3.111 ent: -5.599 str: 0.000 loss: -8.710]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -6.237 ent: -5.597 str: 0.000 loss: -11.834]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -6.237 ent: -5.597 str: 0.000 loss: -11.834]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -6.762 ent: -5.596 str: 0.000 loss: -12.358]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.42it/s, atk: -6.762 ent: -5.596 str: 0.000 loss: -12.358]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -10.280 ent: -5.590 str: 0.000 loss: -15.871]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -10.280 ent: -5.590 str: 0.000 loss: -15.871]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -10.928 ent: -5.588 str: 0.000 loss: -16.517]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -10.928 ent: -5.588 str: 0.000 loss: -16.517]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -15.817 ent: -5.587 str: 0.000 loss: -21.404]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -15.817 ent: -5.587 str: 0.000 loss: -21.404]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -18.832 ent: -5.587 str: 0.000 loss: -24.419]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.36it/s, atk: -18.832 ent: -5.587 str: 0.000 loss: -24.419]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.36it/s, atk: -21.864 ent: -5.584 str: 0.000 loss: -27.448]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -21.864 ent: -5.584 str: 0.000 loss: -27.448]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -27.820 ent: -5.584 str: 0.000 loss: -33.403]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -27.820 ent: -5.584 str: 0.000 loss: -33.403]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -30.989 ent: -5.584 str: 0.000 loss: -36.573]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.39it/s, atk: -30.989 ent: -5.584 str: 0.000 loss: -36.573]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.39it/s, atk: -35.712 ent: -5.581 str: 0.000 loss: -41.293]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.40it/s, atk: -35.712 ent: -5.581 str: 0.000 loss: -41.293]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.40it/s, atk: -39.245 ent: -5.580 str: 0.000 loss: -44.825]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -39.245 ent: -5.580 str: 0.000 loss: -44.825]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -44.477 ent: -5.580 str: 0.000 loss: -50.057]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -44.477 ent: -5.580 str: 0.000 loss: -50.057]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.43it/s, atk: -49.251 ent: -5.583 str: 0.000 loss: -54.834]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.40it/s, atk: -49.251 ent: -5.583 str: 0.000 loss: -54.834]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.40it/s, atk: -53.264 ent: -5.583 str: 0.000 loss: -58.847]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -53.264 ent: -5.583 str: 0.000 loss: -58.847]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -57.727 ent: -5.582 str: 0.000 loss: -63.310]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.41it/s, atk: -57.727 ent: -5.582 str: 0.000 loss: -63.310]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.41it/s, atk: -62.597 ent: -5.581 str: 0.000 loss: -68.178]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.51it/s, atk: -62.597 ent: -5.581 str: 0.000 loss: -68.178]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.51it/s, atk: -66.727 ent: -5.580 str: 0.000 loss: -72.307]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.48it/s, atk: -66.727 ent: -5.580 str: 0.000 loss: -72.307]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -66.727 ent: -5.580 str: 0.000 loss: -72.307]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([845], device='cuda:0') tensor(0.1786, device='cuda:0')
after_true: tensor([820], device='cuda:0') tensor(0.0009, device='cuda:0')
L1: [2038.0392]	L2: [14.51516]	Linf: [0.5529412]

Accuracy on benign examples: 100.0%
gt_label: 293 pred_label: 293 pred_clean_logit 0.9942348599433899
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.24it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.46it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.83it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.73it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.42it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.28it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.48it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.36s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.46s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.45s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4767
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.095 ent: -2.850 str: 0.000 loss: -2.945]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.04s/it, atk: -0.095 ent: -2.850 str: 0.000 loss: -2.945]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.04s/it, atk: -0.324 ent: -2.855 str: 0.000 loss: -3.179]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.21s/it, atk: -0.324 ent: -2.855 str: 0.000 loss: -3.179]Iterations:   7%|▋         | 2/30 [00:03<00:33,  1.21s/it, atk: -0.963 ent: -2.832 str: 0.000 loss: -3.795]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -0.963 ent: -2.832 str: 0.000 loss: -3.795]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -1.002 ent: -2.826 str: 0.000 loss: -3.828]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -1.002 ent: -2.826 str: 0.000 loss: -3.828]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -2.169 ent: -2.828 str: 0.000 loss: -4.997]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -2.169 ent: -2.828 str: 0.000 loss: -4.997]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.25it/s, atk: -5.463 ent: -2.831 str: 0.000 loss: -8.294]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.17it/s, atk: -5.463 ent: -2.831 str: 0.000 loss: -8.294]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.17it/s, atk: -10.178 ent: -2.826 str: 0.000 loss: -13.005]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -10.178 ent: -2.826 str: 0.000 loss: -13.005]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -15.034 ent: -2.829 str: 0.000 loss: -17.863]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -15.034 ent: -2.829 str: 0.000 loss: -17.863]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -16.523 ent: -2.828 str: 0.000 loss: -19.351]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -16.523 ent: -2.828 str: 0.000 loss: -19.351]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -20.334 ent: -2.825 str: 0.000 loss: -23.159]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.27it/s, atk: -20.334 ent: -2.825 str: 0.000 loss: -23.159]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.27it/s, atk: -26.802 ent: -2.821 str: 0.000 loss: -29.623]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.30it/s, atk: -26.802 ent: -2.821 str: 0.000 loss: -29.623]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.30it/s, atk: -33.995 ent: -2.819 str: 0.000 loss: -36.814]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.27it/s, atk: -33.995 ent: -2.819 str: 0.000 loss: -36.814]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.27it/s, atk: -38.304 ent: -2.819 str: 0.000 loss: -41.122]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.24it/s, atk: -38.304 ent: -2.819 str: 0.000 loss: -41.122]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.24it/s, atk: -44.636 ent: -2.820 str: 0.000 loss: -47.456]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.32it/s, atk: -44.636 ent: -2.820 str: 0.000 loss: -47.456]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.32it/s, atk: -44.206 ent: -2.821 str: 0.000 loss: -47.027]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -44.206 ent: -2.821 str: 0.000 loss: -47.027]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -47.616 ent: -2.826 str: 0.000 loss: -50.442]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -47.616 ent: -2.826 str: 0.000 loss: -50.442]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -48.760 ent: -2.825 str: 0.000 loss: -51.585]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.30it/s, atk: -48.760 ent: -2.825 str: 0.000 loss: -51.585]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.30it/s, atk: -53.525 ent: -2.819 str: 0.000 loss: -56.344]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.37it/s, atk: -53.525 ent: -2.819 str: 0.000 loss: -56.344]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.37it/s, atk: -57.788 ent: -2.816 str: 0.000 loss: -60.604]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -57.788 ent: -2.816 str: 0.000 loss: -60.604]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -60.408 ent: -2.815 str: 0.000 loss: -63.223]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.37it/s, atk: -60.408 ent: -2.815 str: 0.000 loss: -63.223]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.37it/s, atk: -63.676 ent: -2.814 str: 0.000 loss: -66.490]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.31it/s, atk: -63.676 ent: -2.814 str: 0.000 loss: -66.490]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.31it/s, atk: -65.924 ent: -2.813 str: 0.000 loss: -68.736]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.39it/s, atk: -65.924 ent: -2.813 str: 0.000 loss: -68.736]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.39it/s, atk: -68.388 ent: -2.812 str: 0.000 loss: -71.200]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.40it/s, atk: -68.388 ent: -2.812 str: 0.000 loss: -71.200]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.40it/s, atk: -71.407 ent: -2.812 str: 0.000 loss: -74.219]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.25it/s, atk: -71.407 ent: -2.812 str: 0.000 loss: -74.219]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.25it/s, atk: -74.727 ent: -2.812 str: 0.000 loss: -77.539]Iterations:  83%|████████▎ | 25/30 [00:20<00:04,  1.20it/s, atk: -74.727 ent: -2.812 str: 0.000 loss: -77.539]Iterations:  83%|████████▎ | 25/30 [00:20<00:04,  1.20it/s, atk: -77.722 ent: -2.812 str: 0.000 loss: -80.535]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.12it/s, atk: -77.722 ent: -2.812 str: 0.000 loss: -80.535]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.12it/s, atk: -80.177 ent: -2.813 str: 0.000 loss: -82.990]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.10it/s, atk: -80.177 ent: -2.813 str: 0.000 loss: -82.990]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.10it/s, atk: -82.993 ent: -2.813 str: 0.000 loss: -85.806]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.12it/s, atk: -82.993 ent: -2.813 str: 0.000 loss: -85.806]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.12it/s, atk: -84.993 ent: -2.813 str: 0.000 loss: -87.805]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.14it/s, atk: -84.993 ent: -2.813 str: 0.000 loss: -87.805]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.14it/s, atk: -87.786 ent: -2.813 str: 0.000 loss: -90.598]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.18it/s, atk: -87.786 ent: -2.813 str: 0.000 loss: -90.598]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.22it/s, atk: -87.786 ent: -2.813 str: 0.000 loss: -90.598]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([288], device='cuda:0') tensor(0.9415, device='cuda:0')
after_true: tensor([293], device='cuda:0') tensor(0.0001, device='cuda:0')
L1: [4966.7104]	L2: [32.032955]	Linf: [0.8666667]

Accuracy on benign examples: 100.0%
gt_label: 707 pred_label: 707 pred_clean_logit 0.958092987537384
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  5.71it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.53it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 13.81it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.56it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.48it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 18.55it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.02it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.80s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5088
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.145 ent: -7.779 str: 0.000 loss: -7.924]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.94s/it, atk: -0.145 ent: -7.779 str: 0.000 loss: -7.924]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.94s/it, atk: -0.453 ent: -7.778 str: 0.000 loss: -8.231]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.21s/it, atk: -0.453 ent: -7.778 str: 0.000 loss: -8.231]Iterations:   7%|▋         | 2/30 [00:03<00:33,  1.21s/it, atk: -0.862 ent: -7.747 str: 0.000 loss: -8.610]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -0.862 ent: -7.747 str: 0.000 loss: -8.610]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.04it/s, atk: -2.651 ent: -7.735 str: 0.000 loss: -10.386]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -2.651 ent: -7.735 str: 0.000 loss: -10.386]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.10it/s, atk: -4.581 ent: -7.725 str: 0.000 loss: -12.306]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.17it/s, atk: -4.581 ent: -7.725 str: 0.000 loss: -12.306]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -8.822 ent: -7.743 str: 0.000 loss: -16.565]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -8.822 ent: -7.743 str: 0.000 loss: -16.565]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -12.934 ent: -7.764 str: 0.000 loss: -20.698]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.23it/s, atk: -12.934 ent: -7.764 str: 0.000 loss: -20.698]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.23it/s, atk: -16.645 ent: -7.778 str: 0.000 loss: -24.423]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -16.645 ent: -7.778 str: 0.000 loss: -24.423]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -23.398 ent: -7.778 str: 0.000 loss: -31.177]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.26it/s, atk: -23.398 ent: -7.778 str: 0.000 loss: -31.177]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.26it/s, atk: -30.922 ent: -7.776 str: 0.000 loss: -38.698]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -30.922 ent: -7.776 str: 0.000 loss: -38.698]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -37.167 ent: -7.771 str: 0.000 loss: -44.938]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -37.167 ent: -7.771 str: 0.000 loss: -44.938]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -45.237 ent: -7.769 str: 0.000 loss: -53.006]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.42it/s, atk: -45.237 ent: -7.769 str: 0.000 loss: -53.006]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -52.660 ent: -7.766 str: 0.000 loss: -60.427]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -52.660 ent: -7.766 str: 0.000 loss: -60.427]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.39it/s, atk: -59.024 ent: -7.765 str: 0.000 loss: -66.789]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.34it/s, atk: -59.024 ent: -7.765 str: 0.000 loss: -66.789]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.34it/s, atk: -65.366 ent: -7.764 str: 0.000 loss: -73.129]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.43it/s, atk: -65.366 ent: -7.764 str: 0.000 loss: -73.129]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.43it/s, atk: -70.541 ent: -7.762 str: 0.000 loss: -78.303]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.36it/s, atk: -70.541 ent: -7.762 str: 0.000 loss: -78.303]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.36it/s, atk: -75.861 ent: -7.761 str: 0.000 loss: -83.622]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.35it/s, atk: -75.861 ent: -7.761 str: 0.000 loss: -83.622]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.35it/s, atk: -82.258 ent: -7.759 str: 0.000 loss: -90.017]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -82.258 ent: -7.759 str: 0.000 loss: -90.017]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.33it/s, atk: -85.123 ent: -7.754 str: 0.000 loss: -92.877]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.29it/s, atk: -85.123 ent: -7.754 str: 0.000 loss: -92.877]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.29it/s, atk: -92.504 ent: -7.756 str: 0.000 loss: -100.260]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.36it/s, atk: -92.504 ent: -7.756 str: 0.000 loss: -100.260]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.36it/s, atk: -96.695 ent: -7.757 str: 0.000 loss: -104.452]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -96.695 ent: -7.757 str: 0.000 loss: -104.452]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -100.999 ent: -7.755 str: 0.000 loss: -108.754]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -100.999 ent: -7.755 str: 0.000 loss: -108.754]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -106.110 ent: -7.752 str: 0.000 loss: -113.862]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -106.110 ent: -7.752 str: 0.000 loss: -113.862]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -108.840 ent: -7.742 str: 0.000 loss: -116.582]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.34it/s, atk: -108.840 ent: -7.742 str: 0.000 loss: -116.582]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -114.775 ent: -7.753 str: 0.000 loss: -122.528]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.26it/s, atk: -114.775 ent: -7.753 str: 0.000 loss: -122.528]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.26it/s, atk: -118.813 ent: -7.753 str: 0.000 loss: -126.566]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.31it/s, atk: -118.813 ent: -7.753 str: 0.000 loss: -126.566]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.31it/s, atk: -122.459 ent: -7.751 str: 0.000 loss: -130.210]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.39it/s, atk: -122.459 ent: -7.751 str: 0.000 loss: -130.210]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.39it/s, atk: -125.782 ent: -7.740 str: 0.000 loss: -133.522]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.38it/s, atk: -125.782 ent: -7.740 str: 0.000 loss: -133.522]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.38it/s, atk: -129.667 ent: -7.741 str: 0.000 loss: -137.407]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.36it/s, atk: -129.667 ent: -7.741 str: 0.000 loss: -137.407]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.36it/s, atk: -132.928 ent: -7.741 str: 0.000 loss: -140.669]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.43it/s, atk: -132.928 ent: -7.741 str: 0.000 loss: -140.669]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -132.928 ent: -7.741 str: 0.000 loss: -140.669]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([480], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([707], device='cuda:0') tensor(1.2014e-06, device='cuda:0')
L1: [2952.5723]	L2: [20.378681]	Linf: [0.7411765]

Accuracy on benign examples: 0.0%
gt_label: 630 pred_label: 776 pred_clean_logit 0.04824281111359596
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.50it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.04it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.88it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 20.83it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 22.01it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 21.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.40it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.50s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.49s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.56s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3954
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -25.775 ent: -5.546 str: 0.000 loss: -31.321]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -25.775 ent: -5.546 str: 0.000 loss: -31.321]Iterations:   3%|▎         | 1/30 [00:02<01:04,  2.21s/it, atk: -36.466 ent: -5.517 str: 0.000 loss: -41.983]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.30s/it, atk: -36.466 ent: -5.517 str: 0.000 loss: -41.983]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.30s/it, atk: -42.086 ent: -5.490 str: 0.000 loss: -47.576]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -42.086 ent: -5.490 str: 0.000 loss: -47.576]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.07s/it, atk: -59.641 ent: -5.483 str: 0.000 loss: -65.124]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -59.641 ent: -5.483 str: 0.000 loss: -65.124]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.14it/s, atk: -72.973 ent: -5.471 str: 0.000 loss: -78.443]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -72.973 ent: -5.471 str: 0.000 loss: -78.443]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.24it/s, atk: -88.432 ent: -5.452 str: 0.000 loss: -93.883]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.28it/s, atk: -88.432 ent: -5.452 str: 0.000 loss: -93.883]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.28it/s, atk: -95.161 ent: -5.440 str: 0.000 loss: -100.601]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -95.161 ent: -5.440 str: 0.000 loss: -100.601]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -98.461 ent: -5.432 str: 0.000 loss: -103.892]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -98.461 ent: -5.432 str: 0.000 loss: -103.892]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.30it/s, atk: -105.743 ent: -5.427 str: 0.000 loss: -111.170]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.35it/s, atk: -105.743 ent: -5.427 str: 0.000 loss: -111.170]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -92.620 ent: -5.451 str: 0.000 loss: -98.070]  Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -92.620 ent: -5.451 str: 0.000 loss: -98.070]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -101.000 ent: -5.449 str: 0.000 loss: -106.448]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -101.000 ent: -5.449 str: 0.000 loss: -106.448]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.43it/s, atk: -109.421 ent: -5.446 str: 0.000 loss: -114.867]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.39it/s, atk: -109.421 ent: -5.446 str: 0.000 loss: -114.867]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.39it/s, atk: -118.125 ent: -5.447 str: 0.000 loss: -123.572]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.34it/s, atk: -118.125 ent: -5.447 str: 0.000 loss: -123.572]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.34it/s, atk: -121.028 ent: -5.450 str: 0.000 loss: -126.478]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -121.028 ent: -5.450 str: 0.000 loss: -126.478]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -123.517 ent: -5.452 str: 0.000 loss: -128.969]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -123.517 ent: -5.452 str: 0.000 loss: -128.969]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -130.828 ent: -5.454 str: 0.000 loss: -136.282]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.40it/s, atk: -130.828 ent: -5.454 str: 0.000 loss: -136.282]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.40it/s, atk: -136.407 ent: -5.456 str: 0.000 loss: -141.863]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.34it/s, atk: -136.407 ent: -5.456 str: 0.000 loss: -141.863]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.34it/s, atk: -140.463 ent: -5.458 str: 0.000 loss: -145.921]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.27it/s, atk: -140.463 ent: -5.458 str: 0.000 loss: -145.921]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.27it/s, atk: -143.903 ent: -5.459 str: 0.000 loss: -149.362]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.32it/s, atk: -143.903 ent: -5.459 str: 0.000 loss: -149.362]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.32it/s, atk: -148.450 ent: -5.459 str: 0.000 loss: -153.910]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -148.450 ent: -5.459 str: 0.000 loss: -153.910]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -153.915 ent: -5.456 str: 0.000 loss: -159.372]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.48it/s, atk: -153.915 ent: -5.456 str: 0.000 loss: -159.372]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.48it/s, atk: -161.507 ent: -5.453 str: 0.000 loss: -166.960]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -161.507 ent: -5.453 str: 0.000 loss: -166.960]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -168.745 ent: -5.451 str: 0.000 loss: -174.196]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.41it/s, atk: -168.745 ent: -5.451 str: 0.000 loss: -174.196]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.41it/s, atk: -178.030 ent: -5.452 str: 0.000 loss: -183.481]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -178.030 ent: -5.452 str: 0.000 loss: -183.481]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.43it/s, atk: -188.091 ent: -5.454 str: 0.000 loss: -193.544]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -188.091 ent: -5.454 str: 0.000 loss: -193.544]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -197.911 ent: -5.454 str: 0.000 loss: -203.365]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.40it/s, atk: -197.911 ent: -5.454 str: 0.000 loss: -203.365]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.40it/s, atk: -205.530 ent: -5.454 str: 0.000 loss: -210.984]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -205.530 ent: -5.454 str: 0.000 loss: -210.984]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.44it/s, atk: -216.519 ent: -5.454 str: 0.000 loss: -221.973]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -216.519 ent: -5.454 str: 0.000 loss: -221.973]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -224.490 ent: -5.456 str: 0.000 loss: -229.946]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.46it/s, atk: -224.490 ent: -5.456 str: 0.000 loss: -229.946]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.46it/s, atk: -231.294 ent: -5.458 str: 0.000 loss: -236.751]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.49it/s, atk: -231.294 ent: -5.458 str: 0.000 loss: -236.751]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -231.294 ent: -5.458 str: 0.000 loss: -236.751]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([546], device='cuda:0') tensor(0.9860, device='cuda:0')
after_true: tensor([630], device='cuda:0') tensor(4.0044e-11, device='cuda:0')
L1: [1387.1609]	L2: [12.047913]	Linf: [0.68235296]

Accuracy on benign examples: 100.0%
gt_label: 468 pred_label: 468 pred_clean_logit 0.23640909790992737
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.76it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.57it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.74it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.97it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.45it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.75it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.05it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.69it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.87it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.94s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.67s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.63s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4253
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -16.359 ent: -2.631 str: 0.000 loss: -18.991]Iterations:   3%|▎         | 1/30 [00:01<00:32,  1.12s/it, atk: -16.359 ent: -2.631 str: 0.000 loss: -18.991]Iterations:   3%|▎         | 1/30 [00:01<00:32,  1.12s/it, atk: -21.426 ent: -2.625 str: 0.000 loss: -24.050]Iterations:   7%|▋         | 2/30 [00:01<00:23,  1.19it/s, atk: -21.426 ent: -2.625 str: 0.000 loss: -24.050]Iterations:   7%|▋         | 2/30 [00:02<00:23,  1.19it/s, atk: -24.114 ent: -2.617 str: 0.000 loss: -26.731]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.29it/s, atk: -24.114 ent: -2.617 str: 0.000 loss: -26.731]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.29it/s, atk: -28.550 ent: -2.615 str: 0.000 loss: -31.165]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.33it/s, atk: -28.550 ent: -2.615 str: 0.000 loss: -31.165]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.33it/s, atk: -29.286 ent: -2.608 str: 0.000 loss: -31.894]Iterations:  17%|█▋        | 5/30 [00:03<00:18,  1.36it/s, atk: -29.286 ent: -2.608 str: 0.000 loss: -31.894]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.36it/s, atk: -31.309 ent: -2.604 str: 0.000 loss: -33.913]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.28it/s, atk: -31.309 ent: -2.604 str: 0.000 loss: -33.913]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.28it/s, atk: -34.546 ent: -2.603 str: 0.000 loss: -37.149]Iterations:  23%|██▎       | 7/30 [00:05<00:18,  1.26it/s, atk: -34.546 ent: -2.603 str: 0.000 loss: -37.149]Iterations:  23%|██▎       | 7/30 [00:05<00:18,  1.26it/s, atk: -37.233 ent: -2.603 str: 0.000 loss: -39.835]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.38it/s, atk: -37.233 ent: -2.603 str: 0.000 loss: -39.835]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.38it/s, atk: -38.594 ent: -2.601 str: 0.000 loss: -41.195]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.38it/s, atk: -38.594 ent: -2.601 str: 0.000 loss: -41.195]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -40.609 ent: -2.603 str: 0.000 loss: -43.212]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.35it/s, atk: -40.609 ent: -2.603 str: 0.000 loss: -43.212]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.35it/s, atk: -43.517 ent: -2.603 str: 0.000 loss: -46.121]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.30it/s, atk: -43.517 ent: -2.603 str: 0.000 loss: -46.121]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.30it/s, atk: -46.074 ent: -2.603 str: 0.000 loss: -48.677]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.33it/s, atk: -46.074 ent: -2.603 str: 0.000 loss: -48.677]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.33it/s, atk: -47.793 ent: -2.603 str: 0.000 loss: -50.396]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.31it/s, atk: -47.793 ent: -2.603 str: 0.000 loss: -50.396]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.31it/s, atk: -50.035 ent: -2.604 str: 0.000 loss: -52.638]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.37it/s, atk: -50.035 ent: -2.604 str: 0.000 loss: -52.638]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.37it/s, atk: -52.295 ent: -2.603 str: 0.000 loss: -54.898]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -52.295 ent: -2.603 str: 0.000 loss: -54.898]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -52.643 ent: -2.602 str: 0.000 loss: -55.245]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.37it/s, atk: -52.643 ent: -2.602 str: 0.000 loss: -55.245]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.37it/s, atk: -55.940 ent: -2.603 str: 0.000 loss: -58.543]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.40it/s, atk: -55.940 ent: -2.603 str: 0.000 loss: -58.543]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -59.276 ent: -2.603 str: 0.000 loss: -61.880]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -59.276 ent: -2.603 str: 0.000 loss: -61.880]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -62.314 ent: -2.604 str: 0.000 loss: -64.917]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -62.314 ent: -2.604 str: 0.000 loss: -64.917]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -65.176 ent: -2.604 str: 0.000 loss: -67.779]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.40it/s, atk: -65.176 ent: -2.604 str: 0.000 loss: -67.779]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -68.325 ent: -2.603 str: 0.000 loss: -70.927]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -68.325 ent: -2.603 str: 0.000 loss: -70.927]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -70.668 ent: -2.603 str: 0.000 loss: -73.271]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -70.668 ent: -2.603 str: 0.000 loss: -73.271]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -73.708 ent: -2.603 str: 0.000 loss: -76.311]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.42it/s, atk: -73.708 ent: -2.603 str: 0.000 loss: -76.311]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -77.169 ent: -2.604 str: 0.000 loss: -79.773]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -77.169 ent: -2.604 str: 0.000 loss: -79.773]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -81.635 ent: -2.603 str: 0.000 loss: -84.238]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -81.635 ent: -2.603 str: 0.000 loss: -84.238]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -84.796 ent: -2.603 str: 0.000 loss: -87.399]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.40it/s, atk: -84.796 ent: -2.603 str: 0.000 loss: -87.399]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.40it/s, atk: -89.093 ent: -2.603 str: 0.000 loss: -91.696]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.36it/s, atk: -89.093 ent: -2.603 str: 0.000 loss: -91.696]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -93.516 ent: -2.604 str: 0.000 loss: -96.119]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -93.516 ent: -2.604 str: 0.000 loss: -96.119]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -97.542 ent: -2.603 str: 0.000 loss: -100.145]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -97.542 ent: -2.603 str: 0.000 loss: -100.145]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.40it/s, atk: -101.945 ent: -2.604 str: 0.000 loss: -104.549]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.45it/s, atk: -101.945 ent: -2.604 str: 0.000 loss: -104.549]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -101.945 ent: -2.604 str: 0.000 loss: -104.549]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([656], device='cuda:0') tensor(0.9823, device='cuda:0')
after_true: tensor([468], device='cuda:0') tensor(2.6566e-05, device='cuda:0')
L1: [4031.6902]	L2: [27.42621]	Linf: [0.83137256]

Accuracy on benign examples: 100.0%
gt_label: 331 pred_label: 331 pred_clean_logit 0.9268011450767517
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.57it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.34it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.88it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.79it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.12it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.22it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.11it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.93it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.17it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.76it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.95s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.60s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.63s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2275
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -10.282 ent: -2.796 str: 0.000 loss: -13.078]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.86s/it, atk: -10.282 ent: -2.796 str: 0.000 loss: -13.078]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.86s/it, atk: -28.453 ent: -2.758 str: 0.000 loss: -31.211]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.17s/it, atk: -28.453 ent: -2.758 str: 0.000 loss: -31.211]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.17s/it, atk: -48.990 ent: -2.764 str: 0.000 loss: -51.754]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -48.990 ent: -2.764 str: 0.000 loss: -51.754]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -61.799 ent: -2.746 str: 0.000 loss: -64.545]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -61.799 ent: -2.746 str: 0.000 loss: -64.545]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -79.421 ent: -2.763 str: 0.000 loss: -82.185]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.18it/s, atk: -79.421 ent: -2.763 str: 0.000 loss: -82.185]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -94.123 ent: -2.769 str: 0.000 loss: -96.892]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.20it/s, atk: -94.123 ent: -2.769 str: 0.000 loss: -96.892]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.20it/s, atk: -106.733 ent: -2.763 str: 0.000 loss: -109.496]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -106.733 ent: -2.763 str: 0.000 loss: -109.496]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -108.114 ent: -2.758 str: 0.000 loss: -110.871]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.32it/s, atk: -108.114 ent: -2.758 str: 0.000 loss: -110.871]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -120.427 ent: -2.767 str: 0.000 loss: -123.194]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -120.427 ent: -2.767 str: 0.000 loss: -123.194]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -121.978 ent: -2.775 str: 0.000 loss: -124.753]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -121.978 ent: -2.775 str: 0.000 loss: -124.753]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -126.768 ent: -2.775 str: 0.000 loss: -129.543]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -126.768 ent: -2.775 str: 0.000 loss: -129.543]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -133.149 ent: -2.777 str: 0.000 loss: -135.926]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.43it/s, atk: -133.149 ent: -2.777 str: 0.000 loss: -135.926]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.43it/s, atk: -143.416 ent: -2.781 str: 0.000 loss: -146.197]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -143.416 ent: -2.781 str: 0.000 loss: -146.197]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -149.700 ent: -2.786 str: 0.000 loss: -152.486]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.32it/s, atk: -149.700 ent: -2.786 str: 0.000 loss: -152.486]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.32it/s, atk: -155.547 ent: -2.790 str: 0.000 loss: -158.337]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.37it/s, atk: -155.547 ent: -2.790 str: 0.000 loss: -158.337]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.37it/s, atk: -161.391 ent: -2.793 str: 0.000 loss: -164.183]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.42it/s, atk: -161.391 ent: -2.793 str: 0.000 loss: -164.183]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.42it/s, atk: -166.424 ent: -2.793 str: 0.000 loss: -169.217]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -166.424 ent: -2.793 str: 0.000 loss: -169.217]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -171.196 ent: -2.793 str: 0.000 loss: -173.989]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -171.196 ent: -2.793 str: 0.000 loss: -173.989]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -177.451 ent: -2.793 str: 0.000 loss: -180.244]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.40it/s, atk: -177.451 ent: -2.793 str: 0.000 loss: -180.244]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.40it/s, atk: -184.191 ent: -2.792 str: 0.000 loss: -186.983]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.26it/s, atk: -184.191 ent: -2.792 str: 0.000 loss: -186.983]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.26it/s, atk: -186.628 ent: -2.792 str: 0.000 loss: -189.419]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.31it/s, atk: -186.628 ent: -2.792 str: 0.000 loss: -189.419]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.31it/s, atk: -192.182 ent: -2.792 str: 0.000 loss: -194.975]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.42it/s, atk: -192.182 ent: -2.792 str: 0.000 loss: -194.975]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.42it/s, atk: -196.797 ent: -2.792 str: 0.000 loss: -199.589]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -196.797 ent: -2.792 str: 0.000 loss: -199.589]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.45it/s, atk: -200.981 ent: -2.792 str: 0.000 loss: -203.773]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -200.981 ent: -2.792 str: 0.000 loss: -203.773]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -204.986 ent: -2.793 str: 0.000 loss: -207.779]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.34it/s, atk: -204.986 ent: -2.793 str: 0.000 loss: -207.779]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.34it/s, atk: -209.580 ent: -2.793 str: 0.000 loss: -212.373]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.32it/s, atk: -209.580 ent: -2.793 str: 0.000 loss: -212.373]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -213.834 ent: -2.792 str: 0.000 loss: -216.626]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -213.834 ent: -2.792 str: 0.000 loss: -216.626]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.40it/s, atk: -217.984 ent: -2.790 str: 0.000 loss: -220.774]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.34it/s, atk: -217.984 ent: -2.790 str: 0.000 loss: -220.774]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.34it/s, atk: -221.417 ent: -2.790 str: 0.000 loss: -224.207]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.36it/s, atk: -221.417 ent: -2.790 str: 0.000 loss: -224.207]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.36it/s, atk: -225.951 ent: -2.789 str: 0.000 loss: -228.740]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.40it/s, atk: -225.951 ent: -2.789 str: 0.000 loss: -228.740]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -225.951 ent: -2.789 str: 0.000 loss: -228.740]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([289], device='cuda:0') tensor(0.9991, device='cuda:0')
after_true: tensor([331], device='cuda:0') tensor(1.0197e-10, device='cuda:0')
L1: [2128.067]	L2: [14.151183]	Linf: [0.49411765]

Accuracy on benign examples: 0.0%
gt_label: 99 pred_label: 144 pred_clean_logit 0.0607682503759861
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.71it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.95it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.67it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.25it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.82it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.68it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.59it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.35it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.86it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.76s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.58s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.80s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2713
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -24.669 ent: -2.925 str: 0.000 loss: -27.594]Iterations:   3%|▎         | 1/30 [00:03<01:32,  3.19s/it, atk: -24.669 ent: -2.925 str: 0.000 loss: -27.594]Iterations:   3%|▎         | 1/30 [00:03<01:32,  3.19s/it, atk: -57.337 ent: -2.917 str: 0.000 loss: -60.254]Iterations:   7%|▋         | 2/30 [00:04<00:51,  1.85s/it, atk: -57.337 ent: -2.917 str: 0.000 loss: -60.254]Iterations:   7%|▋         | 2/30 [00:04<00:51,  1.85s/it, atk: -70.100 ent: -2.908 str: 0.000 loss: -73.008]Iterations:  10%|█         | 3/30 [00:04<00:36,  1.37s/it, atk: -70.100 ent: -2.908 str: 0.000 loss: -73.008]Iterations:  10%|█         | 3/30 [00:05<00:36,  1.37s/it, atk: -86.560 ent: -2.907 str: 0.000 loss: -89.467]Iterations:  13%|█▎        | 4/30 [00:05<00:28,  1.09s/it, atk: -86.560 ent: -2.907 str: 0.000 loss: -89.467]Iterations:  13%|█▎        | 4/30 [00:05<00:28,  1.09s/it, atk: -95.097 ent: -2.897 str: 0.000 loss: -97.994]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -95.097 ent: -2.897 str: 0.000 loss: -97.994]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -102.030 ent: -2.885 str: 0.000 loss: -104.915]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.23it/s, atk: -102.030 ent: -2.885 str: 0.000 loss: -104.915]Iterations:  20%|██        | 6/30 [00:07<00:19,  1.23it/s, atk: -115.783 ent: -2.882 str: 0.000 loss: -118.664]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.35it/s, atk: -115.783 ent: -2.882 str: 0.000 loss: -118.664]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.35it/s, atk: -126.002 ent: -2.881 str: 0.000 loss: -128.884]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.41it/s, atk: -126.002 ent: -2.881 str: 0.000 loss: -128.884]Iterations:  27%|██▋       | 8/30 [00:08<00:15,  1.41it/s, atk: -132.906 ent: -2.880 str: 0.000 loss: -135.786]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -132.906 ent: -2.880 str: 0.000 loss: -135.786]Iterations:  30%|███       | 9/30 [00:09<00:15,  1.37it/s, atk: -140.674 ent: -2.880 str: 0.000 loss: -143.554]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -140.674 ent: -2.880 str: 0.000 loss: -143.554]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -149.130 ent: -2.881 str: 0.000 loss: -152.010]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.40it/s, atk: -149.130 ent: -2.881 str: 0.000 loss: -152.010]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.40it/s, atk: -159.020 ent: -2.883 str: 0.000 loss: -161.902]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.33it/s, atk: -159.020 ent: -2.883 str: 0.000 loss: -161.902]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.33it/s, atk: -168.583 ent: -2.885 str: 0.000 loss: -171.468]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.35it/s, atk: -168.583 ent: -2.885 str: 0.000 loss: -171.468]Iterations:  43%|████▎     | 13/30 [00:12<00:12,  1.35it/s, atk: -165.439 ent: -2.888 str: 0.000 loss: -168.327]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -165.439 ent: -2.888 str: 0.000 loss: -168.327]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -174.105 ent: -2.889 str: 0.000 loss: -176.994]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.39it/s, atk: -174.105 ent: -2.889 str: 0.000 loss: -176.994]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.39it/s, atk: -182.755 ent: -2.891 str: 0.000 loss: -185.645]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -182.755 ent: -2.891 str: 0.000 loss: -185.645]Iterations:  53%|█████▎    | 16/30 [00:14<00:09,  1.43it/s, atk: -189.717 ent: -2.891 str: 0.000 loss: -192.608]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.45it/s, atk: -189.717 ent: -2.891 str: 0.000 loss: -192.608]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.45it/s, atk: -196.328 ent: -2.891 str: 0.000 loss: -199.220]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.46it/s, atk: -196.328 ent: -2.891 str: 0.000 loss: -199.220]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.46it/s, atk: -203.003 ent: -2.892 str: 0.000 loss: -205.895]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.46it/s, atk: -203.003 ent: -2.892 str: 0.000 loss: -205.895]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.46it/s, atk: -209.375 ent: -2.892 str: 0.000 loss: -212.267]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -209.375 ent: -2.892 str: 0.000 loss: -212.267]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.40it/s, atk: -213.734 ent: -2.892 str: 0.000 loss: -216.626]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.29it/s, atk: -213.734 ent: -2.892 str: 0.000 loss: -216.626]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.29it/s, atk: -218.595 ent: -2.892 str: 0.000 loss: -221.487]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.32it/s, atk: -218.595 ent: -2.892 str: 0.000 loss: -221.487]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.32it/s, atk: -222.256 ent: -2.891 str: 0.000 loss: -225.148]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -222.256 ent: -2.891 str: 0.000 loss: -225.148]Iterations:  77%|███████▋  | 23/30 [00:19<00:04,  1.42it/s, atk: -221.024 ent: -2.892 str: 0.000 loss: -223.916]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.44it/s, atk: -221.024 ent: -2.892 str: 0.000 loss: -223.916]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.44it/s, atk: -229.851 ent: -2.893 str: 0.000 loss: -232.744]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.42it/s, atk: -229.851 ent: -2.893 str: 0.000 loss: -232.744]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.42it/s, atk: -234.329 ent: -2.892 str: 0.000 loss: -237.221]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.35it/s, atk: -234.329 ent: -2.892 str: 0.000 loss: -237.221]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.35it/s, atk: -238.973 ent: -2.890 str: 0.000 loss: -241.863]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -238.973 ent: -2.890 str: 0.000 loss: -241.863]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.36it/s, atk: -242.784 ent: -2.889 str: 0.000 loss: -245.673]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.36it/s, atk: -242.784 ent: -2.889 str: 0.000 loss: -245.673]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.36it/s, atk: -247.279 ent: -2.890 str: 0.000 loss: -250.169]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.44it/s, atk: -247.279 ent: -2.890 str: 0.000 loss: -250.169]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.44it/s, atk: -252.550 ent: -2.890 str: 0.000 loss: -255.440]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.38it/s, atk: -252.550 ent: -2.890 str: 0.000 loss: -255.440]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -252.550 ent: -2.890 str: 0.000 loss: -255.440]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([130], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([99], device='cuda:0') tensor(6.6015e-12, device='cuda:0')
L1: [3260.8394]	L2: [22.080824]	Linf: [0.6862745]

Accuracy on benign examples: 100.0%
gt_label: 736 pred_label: 736 pred_clean_logit 0.5268573760986328
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.50it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.10it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.30it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.14it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.42it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.18it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.43it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.37it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.25it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.42s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4480
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -5.493 ent: -5.167 str: 0.000 loss: -10.660]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.60s/it, atk: -5.493 ent: -5.167 str: 0.000 loss: -10.660]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.60s/it, atk: -22.639 ent: -5.160 str: 0.000 loss: -27.799]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.46s/it, atk: -22.639 ent: -5.160 str: 0.000 loss: -27.799]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.46s/it, atk: -38.840 ent: -5.156 str: 0.000 loss: -43.995]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.13s/it, atk: -38.840 ent: -5.156 str: 0.000 loss: -43.995]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.13s/it, atk: -56.321 ent: -5.152 str: 0.000 loss: -61.474]Iterations:  13%|█▎        | 4/30 [00:04<00:27,  1.05s/it, atk: -56.321 ent: -5.152 str: 0.000 loss: -61.474]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.05s/it, atk: -72.353 ent: -5.149 str: 0.000 loss: -77.502]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -72.353 ent: -5.149 str: 0.000 loss: -77.502]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -87.143 ent: -5.153 str: 0.000 loss: -92.295]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -87.143 ent: -5.153 str: 0.000 loss: -92.295]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -100.992 ent: -5.154 str: 0.000 loss: -106.146]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -100.992 ent: -5.154 str: 0.000 loss: -106.146]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -113.913 ent: -5.155 str: 0.000 loss: -119.068]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.25it/s, atk: -113.913 ent: -5.155 str: 0.000 loss: -119.068]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.25it/s, atk: -128.385 ent: -5.158 str: 0.000 loss: -133.542]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.31it/s, atk: -128.385 ent: -5.158 str: 0.000 loss: -133.542]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.31it/s, atk: -139.396 ent: -5.160 str: 0.000 loss: -144.556]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -139.396 ent: -5.160 str: 0.000 loss: -144.556]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -148.192 ent: -5.161 str: 0.000 loss: -153.353]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -148.192 ent: -5.161 str: 0.000 loss: -153.353]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.38it/s, atk: -158.637 ent: -5.159 str: 0.000 loss: -163.796]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.44it/s, atk: -158.637 ent: -5.159 str: 0.000 loss: -163.796]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.44it/s, atk: -166.972 ent: -5.157 str: 0.000 loss: -172.129]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.31it/s, atk: -166.972 ent: -5.157 str: 0.000 loss: -172.129]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.31it/s, atk: -174.622 ent: -5.155 str: 0.000 loss: -179.777]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.25it/s, atk: -174.622 ent: -5.155 str: 0.000 loss: -179.777]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.25it/s, atk: -180.471 ent: -5.153 str: 0.000 loss: -185.624]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.30it/s, atk: -180.471 ent: -5.153 str: 0.000 loss: -185.624]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.30it/s, atk: -186.172 ent: -5.153 str: 0.000 loss: -191.326]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -186.172 ent: -5.153 str: 0.000 loss: -191.326]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.33it/s, atk: -192.487 ent: -5.153 str: 0.000 loss: -197.640]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.30it/s, atk: -192.487 ent: -5.153 str: 0.000 loss: -197.640]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.30it/s, atk: -198.429 ent: -5.154 str: 0.000 loss: -203.583]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.32it/s, atk: -198.429 ent: -5.154 str: 0.000 loss: -203.583]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.32it/s, atk: -204.442 ent: -5.156 str: 0.000 loss: -209.598]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.35it/s, atk: -204.442 ent: -5.156 str: 0.000 loss: -209.598]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.35it/s, atk: -211.698 ent: -5.158 str: 0.000 loss: -216.855]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.36it/s, atk: -211.698 ent: -5.158 str: 0.000 loss: -216.855]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.36it/s, atk: -217.927 ent: -5.160 str: 0.000 loss: -223.087]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.33it/s, atk: -217.927 ent: -5.160 str: 0.000 loss: -223.087]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.33it/s, atk: -225.097 ent: -5.160 str: 0.000 loss: -230.257]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.35it/s, atk: -225.097 ent: -5.160 str: 0.000 loss: -230.257]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.35it/s, atk: -231.009 ent: -5.161 str: 0.000 loss: -236.170]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -231.009 ent: -5.161 str: 0.000 loss: -236.170]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.37it/s, atk: -236.510 ent: -5.163 str: 0.000 loss: -241.672]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.38it/s, atk: -236.510 ent: -5.163 str: 0.000 loss: -241.672]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.38it/s, atk: -243.052 ent: -5.163 str: 0.000 loss: -248.216]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.44it/s, atk: -243.052 ent: -5.163 str: 0.000 loss: -248.216]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.44it/s, atk: -248.452 ent: -5.164 str: 0.000 loss: -253.616]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -248.452 ent: -5.164 str: 0.000 loss: -253.616]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.43it/s, atk: -254.343 ent: -5.164 str: 0.000 loss: -259.506]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.35it/s, atk: -254.343 ent: -5.164 str: 0.000 loss: -259.506]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.35it/s, atk: -261.079 ent: -5.164 str: 0.000 loss: -266.243]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.35it/s, atk: -261.079 ent: -5.164 str: 0.000 loss: -266.243]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.35it/s, atk: -266.854 ent: -5.164 str: 0.000 loss: -272.019]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.35it/s, atk: -266.854 ent: -5.164 str: 0.000 loss: -272.019]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.35it/s, atk: -273.122 ent: -5.164 str: 0.000 loss: -278.286]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.40it/s, atk: -273.122 ent: -5.164 str: 0.000 loss: -278.286]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -273.122 ent: -5.164 str: 0.000 loss: -278.286]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([722], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([736], device='cuda:0') tensor(8.3474e-13, device='cuda:0')
L1: [3503.486]	L2: [25.825117]	Linf: [0.85882354]

Accuracy on benign examples: 100.0%
gt_label: 514 pred_label: 514 pred_clean_logit 0.9884191751480103
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.26it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.47it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.20it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.44it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.68it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.50it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.81it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.40it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.82s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3348
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.194 ent: -5.351 str: 0.000 loss: -5.545]Iterations:   3%|▎         | 1/30 [00:00<00:26,  1.11it/s, atk: -0.194 ent: -5.351 str: 0.000 loss: -5.545]Iterations:   3%|▎         | 1/30 [00:01<00:26,  1.11it/s, atk: -1.220 ent: -5.302 str: 0.000 loss: -6.522]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.29it/s, atk: -1.220 ent: -5.302 str: 0.000 loss: -6.522]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.29it/s, atk: -4.601 ent: -5.319 str: 0.000 loss: -9.919]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.38it/s, atk: -4.601 ent: -5.319 str: 0.000 loss: -9.919]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.38it/s, atk: -6.918 ent: -5.297 str: 0.000 loss: -12.215]Iterations:  13%|█▎        | 4/30 [00:02<00:18,  1.42it/s, atk: -6.918 ent: -5.297 str: 0.000 loss: -12.215]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.42it/s, atk: -7.940 ent: -5.291 str: 0.000 loss: -13.230]Iterations:  17%|█▋        | 5/30 [00:03<00:18,  1.37it/s, atk: -7.940 ent: -5.291 str: 0.000 loss: -13.230]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.37it/s, atk: -12.188 ent: -5.280 str: 0.000 loss: -17.468]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.44it/s, atk: -12.188 ent: -5.280 str: 0.000 loss: -17.468]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.44it/s, atk: -17.290 ent: -5.275 str: 0.000 loss: -22.565]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.40it/s, atk: -17.290 ent: -5.275 str: 0.000 loss: -22.565]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.40it/s, atk: -25.441 ent: -5.268 str: 0.000 loss: -30.709]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.50it/s, atk: -25.441 ent: -5.268 str: 0.000 loss: -30.709]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.50it/s, atk: -28.018 ent: -5.254 str: 0.000 loss: -33.272]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.49it/s, atk: -28.018 ent: -5.254 str: 0.000 loss: -33.272]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.49it/s, atk: -31.985 ent: -5.245 str: 0.000 loss: -37.229]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.43it/s, atk: -31.985 ent: -5.245 str: 0.000 loss: -37.229]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.43it/s, atk: -36.425 ent: -5.236 str: 0.000 loss: -41.661]Iterations:  37%|███▋      | 11/30 [00:07<00:13,  1.38it/s, atk: -36.425 ent: -5.236 str: 0.000 loss: -41.661]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.38it/s, atk: -38.507 ent: -5.234 str: 0.000 loss: -43.741]Iterations:  40%|████      | 12/30 [00:08<00:13,  1.33it/s, atk: -38.507 ent: -5.234 str: 0.000 loss: -43.741]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.33it/s, atk: -39.581 ent: -5.238 str: 0.000 loss: -44.820]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.35it/s, atk: -39.581 ent: -5.238 str: 0.000 loss: -44.820]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.35it/s, atk: -43.711 ent: -5.236 str: 0.000 loss: -48.947]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.41it/s, atk: -43.711 ent: -5.236 str: 0.000 loss: -48.947]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.41it/s, atk: -46.856 ent: -5.236 str: 0.000 loss: -52.092]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.45it/s, atk: -46.856 ent: -5.236 str: 0.000 loss: -52.092]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.45it/s, atk: -49.240 ent: -5.235 str: 0.000 loss: -54.475]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.49it/s, atk: -49.240 ent: -5.235 str: 0.000 loss: -54.475]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.49it/s, atk: -53.331 ent: -5.231 str: 0.000 loss: -58.561]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.40it/s, atk: -53.331 ent: -5.231 str: 0.000 loss: -58.561]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.40it/s, atk: -56.625 ent: -5.228 str: 0.000 loss: -61.853]Iterations:  60%|██████    | 18/30 [00:12<00:08,  1.37it/s, atk: -56.625 ent: -5.228 str: 0.000 loss: -61.853]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.37it/s, atk: -58.497 ent: -5.220 str: 0.000 loss: -63.716]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.41it/s, atk: -58.497 ent: -5.220 str: 0.000 loss: -63.716]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.41it/s, atk: -63.229 ent: -5.213 str: 0.000 loss: -68.443]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -63.229 ent: -5.213 str: 0.000 loss: -68.443]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -66.904 ent: -5.210 str: 0.000 loss: -72.114]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.52it/s, atk: -66.904 ent: -5.210 str: 0.000 loss: -72.114]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.52it/s, atk: -70.913 ent: -5.207 str: 0.000 loss: -76.120]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.48it/s, atk: -70.913 ent: -5.207 str: 0.000 loss: -76.120]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -75.676 ent: -5.205 str: 0.000 loss: -80.881]Iterations:  77%|███████▋  | 23/30 [00:16<00:05,  1.29it/s, atk: -75.676 ent: -5.205 str: 0.000 loss: -80.881]Iterations:  77%|███████▋  | 23/30 [00:16<00:05,  1.29it/s, atk: -80.045 ent: -5.202 str: 0.000 loss: -85.246]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.35it/s, atk: -80.045 ent: -5.202 str: 0.000 loss: -85.246]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.35it/s, atk: -83.969 ent: -5.200 str: 0.000 loss: -89.169]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.36it/s, atk: -83.969 ent: -5.200 str: 0.000 loss: -89.169]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.36it/s, atk: -87.576 ent: -5.197 str: 0.000 loss: -92.773]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.42it/s, atk: -87.576 ent: -5.197 str: 0.000 loss: -92.773]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.42it/s, atk: -90.480 ent: -5.195 str: 0.000 loss: -95.676]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -90.480 ent: -5.195 str: 0.000 loss: -95.676]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.40it/s, atk: -94.318 ent: -5.197 str: 0.000 loss: -99.515]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.48it/s, atk: -94.318 ent: -5.197 str: 0.000 loss: -99.515]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.48it/s, atk: -98.589 ent: -5.201 str: 0.000 loss: -103.790]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.48it/s, atk: -98.589 ent: -5.201 str: 0.000 loss: -103.790]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.48it/s, atk: -102.024 ent: -5.206 str: 0.000 loss: -107.230]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.44it/s, atk: -102.024 ent: -5.206 str: 0.000 loss: -107.230]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -102.024 ent: -5.206 str: 0.000 loss: -107.230]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([636], device='cuda:0') tensor(0.8672, device='cuda:0')
after_true: tensor([514], device='cuda:0') tensor(2.7681e-05, device='cuda:0')
L1: [1984.1924]	L2: [14.10259]	Linf: [0.6823529]

Accuracy on benign examples: 100.0%
gt_label: 652 pred_label: 652 pred_clean_logit 0.938698410987854
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.63it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.18it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 14.19it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.06it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.16it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.20it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.55s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.44s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.53s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.66s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5204
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -4.372 ent: -5.166 str: 0.000 loss: -9.538]Iterations:   3%|▎         | 1/30 [00:02<01:26,  2.98s/it, atk: -4.372 ent: -5.166 str: 0.000 loss: -9.538]Iterations:   3%|▎         | 1/30 [00:03<01:26,  2.98s/it, atk: -13.950 ent: -5.167 str: 0.000 loss: -19.117]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.63s/it, atk: -13.950 ent: -5.167 str: 0.000 loss: -19.117]Iterations:   7%|▋         | 2/30 [00:04<00:45,  1.63s/it, atk: -20.116 ent: -5.165 str: 0.000 loss: -25.281]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -20.116 ent: -5.165 str: 0.000 loss: -25.281]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -33.182 ent: -5.156 str: 0.000 loss: -38.338]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.06s/it, atk: -33.182 ent: -5.156 str: 0.000 loss: -38.338]Iterations:  13%|█▎        | 4/30 [00:05<00:27,  1.06s/it, atk: -41.067 ent: -5.151 str: 0.000 loss: -46.218]Iterations:  17%|█▋        | 5/30 [00:05<00:23,  1.06it/s, atk: -41.067 ent: -5.151 str: 0.000 loss: -46.218]Iterations:  17%|█▋        | 5/30 [00:06<00:23,  1.06it/s, atk: -48.653 ent: -5.148 str: 0.000 loss: -53.801]Iterations:  20%|██        | 6/30 [00:06<00:21,  1.11it/s, atk: -48.653 ent: -5.148 str: 0.000 loss: -53.801]Iterations:  20%|██        | 6/30 [00:07<00:21,  1.11it/s, atk: -59.968 ent: -5.143 str: 0.000 loss: -65.110]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -59.968 ent: -5.143 str: 0.000 loss: -65.110]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -69.392 ent: -5.144 str: 0.000 loss: -74.536]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.32it/s, atk: -69.392 ent: -5.144 str: 0.000 loss: -74.536]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.32it/s, atk: -76.628 ent: -5.145 str: 0.000 loss: -81.773]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -76.628 ent: -5.145 str: 0.000 loss: -81.773]Iterations:  30%|███       | 9/30 [00:09<00:15,  1.38it/s, atk: -83.714 ent: -5.147 str: 0.000 loss: -88.862]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -83.714 ent: -5.147 str: 0.000 loss: -88.862]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -93.297 ent: -5.153 str: 0.000 loss: -98.450]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.40it/s, atk: -93.297 ent: -5.153 str: 0.000 loss: -98.450]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.40it/s, atk: -107.796 ent: -5.148 str: 0.000 loss: -112.945]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.46it/s, atk: -107.796 ent: -5.148 str: 0.000 loss: -112.945]Iterations:  40%|████      | 12/30 [00:11<00:12,  1.46it/s, atk: -114.528 ent: -5.152 str: 0.000 loss: -119.680]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.50it/s, atk: -114.528 ent: -5.152 str: 0.000 loss: -119.680]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.50it/s, atk: -121.247 ent: -5.156 str: 0.000 loss: -126.403]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.44it/s, atk: -121.247 ent: -5.156 str: 0.000 loss: -126.403]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.44it/s, atk: -134.633 ent: -5.153 str: 0.000 loss: -139.786]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.48it/s, atk: -134.633 ent: -5.153 str: 0.000 loss: -139.786]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.48it/s, atk: -146.796 ent: -5.152 str: 0.000 loss: -151.948]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.50it/s, atk: -146.796 ent: -5.152 str: 0.000 loss: -151.948]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.50it/s, atk: -156.973 ent: -5.150 str: 0.000 loss: -162.123]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.49it/s, atk: -156.973 ent: -5.150 str: 0.000 loss: -162.123]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.49it/s, atk: -165.753 ent: -5.156 str: 0.000 loss: -170.909]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -165.753 ent: -5.156 str: 0.000 loss: -170.909]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.48it/s, atk: -173.103 ent: -5.158 str: 0.000 loss: -178.261]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -173.103 ent: -5.158 str: 0.000 loss: -178.261]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -183.216 ent: -5.159 str: 0.000 loss: -188.375]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.43it/s, atk: -183.216 ent: -5.159 str: 0.000 loss: -188.375]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.43it/s, atk: -193.511 ent: -5.159 str: 0.000 loss: -198.669]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.37it/s, atk: -193.511 ent: -5.159 str: 0.000 loss: -198.669]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.37it/s, atk: -202.879 ent: -5.157 str: 0.000 loss: -208.036]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.32it/s, atk: -202.879 ent: -5.157 str: 0.000 loss: -208.036]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.32it/s, atk: -213.894 ent: -5.156 str: 0.000 loss: -219.050]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.30it/s, atk: -213.894 ent: -5.156 str: 0.000 loss: -219.050]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.30it/s, atk: -222.239 ent: -5.153 str: 0.000 loss: -227.392]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -222.239 ent: -5.153 str: 0.000 loss: -227.392]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -232.511 ent: -5.153 str: 0.000 loss: -237.664]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.38it/s, atk: -232.511 ent: -5.153 str: 0.000 loss: -237.664]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.38it/s, atk: -240.763 ent: -5.153 str: 0.000 loss: -245.916]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -240.763 ent: -5.153 str: 0.000 loss: -245.916]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.37it/s, atk: -248.742 ent: -5.154 str: 0.000 loss: -253.896]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -248.742 ent: -5.154 str: 0.000 loss: -253.896]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -255.900 ent: -5.154 str: 0.000 loss: -261.054]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.46it/s, atk: -255.900 ent: -5.154 str: 0.000 loss: -261.054]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.46it/s, atk: -264.373 ent: -5.155 str: 0.000 loss: -269.528]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -264.373 ent: -5.155 str: 0.000 loss: -269.528]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.33it/s, atk: -271.433 ent: -5.156 str: 0.000 loss: -276.589]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.32it/s, atk: -271.433 ent: -5.156 str: 0.000 loss: -276.589]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.27it/s, atk: -271.433 ent: -5.156 str: 0.000 loss: -276.589]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([880], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([652], device='cuda:0') tensor(8.5499e-13, device='cuda:0')
L1: [2661.4902]	L2: [20.710777]	Linf: [0.8352941]

Accuracy on benign examples: 100.0%
gt_label: 972 pred_label: 972 pred_clean_logit 0.9855931401252747
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.77it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.92it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.17it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.70it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.98it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.19it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 15.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.70it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.67it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.16s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.44s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.60s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2686
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.098 ent: -2.654 str: 0.000 loss: -2.752]Iterations:   3%|▎         | 1/30 [00:02<01:02,  2.17s/it, atk: -0.098 ent: -2.654 str: 0.000 loss: -2.752]Iterations:   3%|▎         | 1/30 [00:02<01:02,  2.17s/it, atk: -0.166 ent: -2.612 str: 0.000 loss: -2.778]Iterations:   7%|▋         | 2/30 [00:02<00:38,  1.36s/it, atk: -0.166 ent: -2.612 str: 0.000 loss: -2.778]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -0.277 ent: -2.599 str: 0.000 loss: -2.876]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -0.277 ent: -2.599 str: 0.000 loss: -2.876]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -0.215 ent: -2.590 str: 0.000 loss: -2.805]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -0.215 ent: -2.590 str: 0.000 loss: -2.805]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -0.508 ent: -2.587 str: 0.000 loss: -3.096]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -0.508 ent: -2.587 str: 0.000 loss: -3.096]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.23it/s, atk: -0.603 ent: -2.588 str: 0.000 loss: -3.191]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -0.603 ent: -2.588 str: 0.000 loss: -3.191]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -1.080 ent: -2.592 str: 0.000 loss: -3.672]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -1.080 ent: -2.592 str: 0.000 loss: -3.672]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -1.088 ent: -2.591 str: 0.000 loss: -3.679]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -1.088 ent: -2.591 str: 0.000 loss: -3.679]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -1.172 ent: -2.589 str: 0.000 loss: -3.760]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -1.172 ent: -2.589 str: 0.000 loss: -3.760]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -2.763 ent: -2.592 str: 0.000 loss: -5.356]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.50it/s, atk: -2.763 ent: -2.592 str: 0.000 loss: -5.356]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.50it/s, atk: -4.214 ent: -2.594 str: 0.000 loss: -6.808]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.50it/s, atk: -4.214 ent: -2.594 str: 0.000 loss: -6.808]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.50it/s, atk: -6.804 ent: -2.590 str: 0.000 loss: -9.395]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.47it/s, atk: -6.804 ent: -2.590 str: 0.000 loss: -9.395]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.47it/s, atk: -11.590 ent: -2.589 str: 0.000 loss: -14.179]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -11.590 ent: -2.589 str: 0.000 loss: -14.179]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -17.592 ent: -2.587 str: 0.000 loss: -20.178]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -17.592 ent: -2.587 str: 0.000 loss: -20.178]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.54it/s, atk: -20.520 ent: -2.581 str: 0.000 loss: -23.101]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -20.520 ent: -2.581 str: 0.000 loss: -23.101]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -23.532 ent: -2.583 str: 0.000 loss: -26.115]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.58it/s, atk: -23.532 ent: -2.583 str: 0.000 loss: -26.115]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.58it/s, atk: -31.166 ent: -2.587 str: 0.000 loss: -33.753]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -31.166 ent: -2.587 str: 0.000 loss: -33.753]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -35.298 ent: -2.586 str: 0.000 loss: -37.884]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -35.298 ent: -2.586 str: 0.000 loss: -37.884]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -41.257 ent: -2.586 str: 0.000 loss: -43.843]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.52it/s, atk: -41.257 ent: -2.586 str: 0.000 loss: -43.843]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.52it/s, atk: -48.753 ent: -2.584 str: 0.000 loss: -51.337]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.55it/s, atk: -48.753 ent: -2.584 str: 0.000 loss: -51.337]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.55it/s, atk: -54.218 ent: -2.583 str: 0.000 loss: -56.801]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.57it/s, atk: -54.218 ent: -2.583 str: 0.000 loss: -56.801]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.57it/s, atk: -59.280 ent: -2.581 str: 0.000 loss: -61.861]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.56it/s, atk: -59.280 ent: -2.581 str: 0.000 loss: -61.861]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.56it/s, atk: -60.332 ent: -2.583 str: 0.000 loss: -62.914]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.51it/s, atk: -60.332 ent: -2.583 str: 0.000 loss: -62.914]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.51it/s, atk: -65.184 ent: -2.585 str: 0.000 loss: -67.769]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.52it/s, atk: -65.184 ent: -2.585 str: 0.000 loss: -67.769]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.52it/s, atk: -69.960 ent: -2.587 str: 0.000 loss: -72.547]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -69.960 ent: -2.587 str: 0.000 loss: -72.547]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.53it/s, atk: -74.719 ent: -2.587 str: 0.000 loss: -77.306]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.61it/s, atk: -74.719 ent: -2.587 str: 0.000 loss: -77.306]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.61it/s, atk: -80.502 ent: -2.586 str: 0.000 loss: -83.088]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.60it/s, atk: -80.502 ent: -2.586 str: 0.000 loss: -83.088]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.60it/s, atk: -85.644 ent: -2.586 str: 0.000 loss: -88.230]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.58it/s, atk: -85.644 ent: -2.586 str: 0.000 loss: -88.230]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.58it/s, atk: -90.911 ent: -2.585 str: 0.000 loss: -93.496]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.54it/s, atk: -90.911 ent: -2.585 str: 0.000 loss: -93.496]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.54it/s, atk: -94.684 ent: -2.584 str: 0.000 loss: -97.268]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.46it/s, atk: -94.684 ent: -2.584 str: 0.000 loss: -97.268]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -94.684 ent: -2.584 str: 0.000 loss: -97.268]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([483], device='cuda:0') tensor(0.9980, device='cuda:0')
after_true: tensor([972], device='cuda:0') tensor(5.0415e-05, device='cuda:0')
L1: [2424.6235]	L2: [19.012571]	Linf: [0.8156863]

Accuracy on benign examples: 100.0%
gt_label: 391 pred_label: 391 pred_clean_logit 0.9009170532226562
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.50it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.73it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.73it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.83it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.25it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.75it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.73it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.26it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.18s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.20s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5545
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.894 ent: -4.898 str: 0.000 loss: -6.792]Iterations:   3%|▎         | 1/30 [00:01<00:29,  1.01s/it, atk: -1.894 ent: -4.898 str: 0.000 loss: -6.792]Iterations:   3%|▎         | 1/30 [00:01<00:29,  1.01s/it, atk: -1.676 ent: -4.885 str: 0.000 loss: -6.561]Iterations:   7%|▋         | 2/30 [00:01<00:27,  1.01it/s, atk: -1.676 ent: -4.885 str: 0.000 loss: -6.561]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -2.533 ent: -4.885 str: 0.000 loss: -7.418]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.16it/s, atk: -2.533 ent: -4.885 str: 0.000 loss: -7.418]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.16it/s, atk: -3.769 ent: -4.892 str: 0.000 loss: -8.660]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -3.769 ent: -4.892 str: 0.000 loss: -8.660]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -6.952 ent: -4.890 str: 0.000 loss: -11.842]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.21it/s, atk: -6.952 ent: -4.890 str: 0.000 loss: -11.842]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.21it/s, atk: -11.464 ent: -4.889 str: 0.000 loss: -16.353]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -11.464 ent: -4.889 str: 0.000 loss: -16.353]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -16.884 ent: -4.886 str: 0.000 loss: -21.770]Iterations:  23%|██▎       | 7/30 [00:05<00:18,  1.26it/s, atk: -16.884 ent: -4.886 str: 0.000 loss: -21.770]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -22.647 ent: -4.886 str: 0.000 loss: -27.533]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.30it/s, atk: -22.647 ent: -4.886 str: 0.000 loss: -27.533]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.30it/s, atk: -32.261 ent: -4.886 str: 0.000 loss: -37.147]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -32.261 ent: -4.886 str: 0.000 loss: -37.147]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -40.600 ent: -4.884 str: 0.000 loss: -45.484]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.43it/s, atk: -40.600 ent: -4.884 str: 0.000 loss: -45.484]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -47.086 ent: -4.885 str: 0.000 loss: -51.971]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.43it/s, atk: -47.086 ent: -4.885 str: 0.000 loss: -51.971]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.43it/s, atk: -51.186 ent: -4.888 str: 0.000 loss: -56.074]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -51.186 ent: -4.888 str: 0.000 loss: -56.074]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -64.706 ent: -4.890 str: 0.000 loss: -69.596]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.44it/s, atk: -64.706 ent: -4.890 str: 0.000 loss: -69.596]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.44it/s, atk: -68.937 ent: -4.894 str: 0.000 loss: -73.831]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.45it/s, atk: -68.937 ent: -4.894 str: 0.000 loss: -73.831]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.45it/s, atk: -82.926 ent: -4.896 str: 0.000 loss: -87.822]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -82.926 ent: -4.896 str: 0.000 loss: -87.822]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -89.339 ent: -4.896 str: 0.000 loss: -94.235]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.53it/s, atk: -89.339 ent: -4.896 str: 0.000 loss: -94.235]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.53it/s, atk: -96.143 ent: -4.892 str: 0.000 loss: -101.034]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -96.143 ent: -4.892 str: 0.000 loss: -101.034]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -106.140 ent: -4.892 str: 0.000 loss: -111.031]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.51it/s, atk: -106.140 ent: -4.892 str: 0.000 loss: -111.031]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.51it/s, atk: -115.911 ent: -4.894 str: 0.000 loss: -120.805]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.38it/s, atk: -115.911 ent: -4.894 str: 0.000 loss: -120.805]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -125.265 ent: -4.893 str: 0.000 loss: -130.158]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.32it/s, atk: -125.265 ent: -4.893 str: 0.000 loss: -130.158]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.32it/s, atk: -132.455 ent: -4.891 str: 0.000 loss: -137.347]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.33it/s, atk: -132.455 ent: -4.891 str: 0.000 loss: -137.347]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.33it/s, atk: -139.802 ent: -4.889 str: 0.000 loss: -144.691]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -139.802 ent: -4.889 str: 0.000 loss: -144.691]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.40it/s, atk: -146.812 ent: -4.891 str: 0.000 loss: -151.703]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.40it/s, atk: -146.812 ent: -4.891 str: 0.000 loss: -151.703]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.40it/s, atk: -156.481 ent: -4.889 str: 0.000 loss: -161.370]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -156.481 ent: -4.889 str: 0.000 loss: -161.370]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -165.382 ent: -4.887 str: 0.000 loss: -170.269]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -165.382 ent: -4.887 str: 0.000 loss: -170.269]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -171.571 ent: -4.885 str: 0.000 loss: -176.455]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -171.571 ent: -4.885 str: 0.000 loss: -176.455]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -178.140 ent: -4.883 str: 0.000 loss: -183.023]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.49it/s, atk: -178.140 ent: -4.883 str: 0.000 loss: -183.023]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.49it/s, atk: -186.202 ent: -4.883 str: 0.000 loss: -191.085]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -186.202 ent: -4.883 str: 0.000 loss: -191.085]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -190.543 ent: -4.885 str: 0.000 loss: -195.428]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -190.543 ent: -4.885 str: 0.000 loss: -195.428]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -196.234 ent: -4.885 str: 0.000 loss: -201.119]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.32it/s, atk: -196.234 ent: -4.885 str: 0.000 loss: -201.119]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -196.234 ent: -4.885 str: 0.000 loss: -201.119]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([50], device='cuda:0') tensor(0.9940, device='cuda:0')
after_true: tensor([391], device='cuda:0') tensor(1.6636e-09, device='cuda:0')
L1: [1296.2432]	L2: [9.018147]	Linf: [0.4509804]

Accuracy on benign examples: 100.0%
gt_label: 847 pred_label: 847 pred_clean_logit 0.8111173510551453
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.27it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.86it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.19it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.35it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.01it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.39it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.43it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.44it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.87it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.39it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.42s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4428
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.144 ent: -2.609 str: 0.000 loss: -5.753]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.82s/it, atk: -3.144 ent: -2.609 str: 0.000 loss: -5.753]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.82s/it, atk: -10.606 ent: -2.575 str: 0.000 loss: -13.181]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -10.606 ent: -2.575 str: 0.000 loss: -13.181]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -22.405 ent: -2.564 str: 0.000 loss: -24.970]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -22.405 ent: -2.564 str: 0.000 loss: -24.970]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.08it/s, atk: -22.595 ent: -2.560 str: 0.000 loss: -25.155]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.15it/s, atk: -22.595 ent: -2.560 str: 0.000 loss: -25.155]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -34.114 ent: -2.562 str: 0.000 loss: -36.675]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -34.114 ent: -2.562 str: 0.000 loss: -36.675]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -48.861 ent: -2.564 str: 0.000 loss: -51.425]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -48.861 ent: -2.564 str: 0.000 loss: -51.425]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -53.932 ent: -2.565 str: 0.000 loss: -56.498]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.34it/s, atk: -53.932 ent: -2.565 str: 0.000 loss: -56.498]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -60.640 ent: -2.565 str: 0.000 loss: -63.205]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.38it/s, atk: -60.640 ent: -2.565 str: 0.000 loss: -63.205]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.38it/s, atk: -66.445 ent: -2.565 str: 0.000 loss: -69.010]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -66.445 ent: -2.565 str: 0.000 loss: -69.010]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -68.176 ent: -2.564 str: 0.000 loss: -70.739]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -68.176 ent: -2.564 str: 0.000 loss: -70.739]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -78.444 ent: -2.565 str: 0.000 loss: -81.009]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.46it/s, atk: -78.444 ent: -2.565 str: 0.000 loss: -81.009]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -87.104 ent: -2.562 str: 0.000 loss: -89.665]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -87.104 ent: -2.562 str: 0.000 loss: -89.665]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.49it/s, atk: -90.990 ent: -2.559 str: 0.000 loss: -93.548]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -90.990 ent: -2.559 str: 0.000 loss: -93.548]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -98.128 ent: -2.557 str: 0.000 loss: -100.684]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -98.128 ent: -2.557 str: 0.000 loss: -100.684]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -104.078 ent: -2.556 str: 0.000 loss: -106.634]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.54it/s, atk: -104.078 ent: -2.556 str: 0.000 loss: -106.634]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.54it/s, atk: -108.921 ent: -2.556 str: 0.000 loss: -111.477]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.56it/s, atk: -108.921 ent: -2.556 str: 0.000 loss: -111.477]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.56it/s, atk: -118.292 ent: -2.556 str: 0.000 loss: -120.848]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.53it/s, atk: -118.292 ent: -2.556 str: 0.000 loss: -120.848]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.53it/s, atk: -124.397 ent: -2.556 str: 0.000 loss: -126.953]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.55it/s, atk: -124.397 ent: -2.556 str: 0.000 loss: -126.953]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.55it/s, atk: -132.020 ent: -2.556 str: 0.000 loss: -134.576]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.48it/s, atk: -132.020 ent: -2.556 str: 0.000 loss: -134.576]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -138.999 ent: -2.555 str: 0.000 loss: -141.554]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.46it/s, atk: -138.999 ent: -2.555 str: 0.000 loss: -141.554]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.46it/s, atk: -149.539 ent: -2.554 str: 0.000 loss: -152.093]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -149.539 ent: -2.554 str: 0.000 loss: -152.093]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.49it/s, atk: -154.998 ent: -2.555 str: 0.000 loss: -157.553]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -154.998 ent: -2.555 str: 0.000 loss: -157.553]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -160.406 ent: -2.555 str: 0.000 loss: -162.961]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.44it/s, atk: -160.406 ent: -2.555 str: 0.000 loss: -162.961]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -167.891 ent: -2.554 str: 0.000 loss: -170.445]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.37it/s, atk: -167.891 ent: -2.554 str: 0.000 loss: -170.445]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.37it/s, atk: -172.851 ent: -2.553 str: 0.000 loss: -175.403]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -172.851 ent: -2.553 str: 0.000 loss: -175.403]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -179.167 ent: -2.552 str: 0.000 loss: -181.719]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.39it/s, atk: -179.167 ent: -2.552 str: 0.000 loss: -181.719]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -185.543 ent: -2.551 str: 0.000 loss: -188.095]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.35it/s, atk: -185.543 ent: -2.551 str: 0.000 loss: -188.095]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.35it/s, atk: -190.937 ent: -2.550 str: 0.000 loss: -193.487]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -190.937 ent: -2.550 str: 0.000 loss: -193.487]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -196.158 ent: -2.550 str: 0.000 loss: -198.708]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -196.158 ent: -2.550 str: 0.000 loss: -198.708]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -201.927 ent: -2.549 str: 0.000 loss: -204.476]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -201.927 ent: -2.549 str: 0.000 loss: -204.476]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -201.927 ent: -2.549 str: 0.000 loss: -204.476]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([634], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([847], device='cuda:0') tensor(1.0943e-09, device='cuda:0')
L1: [3022.9888]	L2: [19.794266]	Linf: [0.8117647]

Accuracy on benign examples: 100.0%
gt_label: 595 pred_label: 595 pred_clean_logit 0.955102264881134
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.08it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.65it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.73it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.28it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.18it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.57it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 14.87it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 15.03it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.91it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.44it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.55s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.49s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4183
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.900 ent: -5.887 str: 0.000 loss: -6.787]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.38s/it, atk: -0.900 ent: -5.887 str: 0.000 loss: -6.787]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.38s/it, atk: -2.491 ent: -5.864 str: 0.000 loss: -8.355]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -2.491 ent: -5.864 str: 0.000 loss: -8.355]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.35s/it, atk: -7.470 ent: -5.851 str: 0.000 loss: -13.321]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -7.470 ent: -5.851 str: 0.000 loss: -13.321]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.02s/it, atk: -17.538 ent: -5.845 str: 0.000 loss: -23.383]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -17.538 ent: -5.845 str: 0.000 loss: -23.383]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -24.898 ent: -5.841 str: 0.000 loss: -30.739]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.19it/s, atk: -24.898 ent: -5.841 str: 0.000 loss: -30.739]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.19it/s, atk: -28.298 ent: -5.859 str: 0.000 loss: -34.157]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.23it/s, atk: -28.298 ent: -5.859 str: 0.000 loss: -34.157]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.23it/s, atk: -29.814 ent: -5.855 str: 0.000 loss: -35.670]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -29.814 ent: -5.855 str: 0.000 loss: -35.670]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.25it/s, atk: -32.403 ent: -5.862 str: 0.000 loss: -38.266]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -32.403 ent: -5.862 str: 0.000 loss: -38.266]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -37.339 ent: -5.860 str: 0.000 loss: -43.199]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.36it/s, atk: -37.339 ent: -5.860 str: 0.000 loss: -43.199]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.36it/s, atk: -41.855 ent: -5.856 str: 0.000 loss: -47.711]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.33it/s, atk: -41.855 ent: -5.856 str: 0.000 loss: -47.711]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -44.130 ent: -5.852 str: 0.000 loss: -49.983]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -44.130 ent: -5.852 str: 0.000 loss: -49.983]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.35it/s, atk: -47.422 ent: -5.844 str: 0.000 loss: -53.266]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -47.422 ent: -5.844 str: 0.000 loss: -53.266]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -50.856 ent: -5.837 str: 0.000 loss: -56.692]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -50.856 ent: -5.837 str: 0.000 loss: -56.692]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.40it/s, atk: -54.580 ent: -5.832 str: 0.000 loss: -60.412]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -54.580 ent: -5.832 str: 0.000 loss: -60.412]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -57.196 ent: -5.830 str: 0.000 loss: -63.026]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -57.196 ent: -5.830 str: 0.000 loss: -63.026]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -59.540 ent: -5.836 str: 0.000 loss: -65.376]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.31it/s, atk: -59.540 ent: -5.836 str: 0.000 loss: -65.376]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.31it/s, atk: -61.445 ent: -5.808 str: 0.000 loss: -67.253]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.31it/s, atk: -61.445 ent: -5.808 str: 0.000 loss: -67.253]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.31it/s, atk: -65.468 ent: -5.802 str: 0.000 loss: -71.269]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.29it/s, atk: -65.468 ent: -5.802 str: 0.000 loss: -71.269]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.29it/s, atk: -63.951 ent: -5.786 str: 0.000 loss: -69.737]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.35it/s, atk: -63.951 ent: -5.786 str: 0.000 loss: -69.737]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.35it/s, atk: -66.723 ent: -5.778 str: 0.000 loss: -72.501]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -66.723 ent: -5.778 str: 0.000 loss: -72.501]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -69.897 ent: -5.779 str: 0.000 loss: -75.676]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.35it/s, atk: -69.897 ent: -5.779 str: 0.000 loss: -75.676]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.35it/s, atk: -70.194 ent: -5.773 str: 0.000 loss: -75.967]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -70.194 ent: -5.773 str: 0.000 loss: -75.967]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.34it/s, atk: -68.590 ent: -5.790 str: 0.000 loss: -74.380]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.35it/s, atk: -68.590 ent: -5.790 str: 0.000 loss: -74.380]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.35it/s, atk: -76.042 ent: -5.787 str: 0.000 loss: -81.829]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -76.042 ent: -5.787 str: 0.000 loss: -81.829]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -80.095 ent: -5.782 str: 0.000 loss: -85.877]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.48it/s, atk: -80.095 ent: -5.782 str: 0.000 loss: -85.877]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.48it/s, atk: -82.811 ent: -5.786 str: 0.000 loss: -88.596]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.54it/s, atk: -82.811 ent: -5.786 str: 0.000 loss: -88.596]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.54it/s, atk: -85.669 ent: -5.788 str: 0.000 loss: -91.457]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.49it/s, atk: -85.669 ent: -5.788 str: 0.000 loss: -91.457]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.49it/s, atk: -88.455 ent: -5.790 str: 0.000 loss: -94.245]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -88.455 ent: -5.790 str: 0.000 loss: -94.245]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.40it/s, atk: -88.319 ent: -5.792 str: 0.000 loss: -94.111]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -88.319 ent: -5.792 str: 0.000 loss: -94.111]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -92.177 ent: -5.795 str: 0.000 loss: -97.972]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.48it/s, atk: -92.177 ent: -5.795 str: 0.000 loss: -97.972]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -92.177 ent: -5.795 str: 0.000 loss: -97.972]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([557], device='cuda:0') tensor(0.3894, device='cuda:0')
after_true: tensor([595], device='cuda:0') tensor(5.7133e-05, device='cuda:0')
L1: [3226.5608]	L2: [21.894573]	Linf: [0.654902]

Accuracy on benign examples: 100.0%
gt_label: 132 pred_label: 132 pred_clean_logit 0.7448427081108093
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:01,  9.89it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 14.30it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 16.50it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.79it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.16it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.93it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.12it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 14.14it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 13.28it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.05it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.57s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.40s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.43s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4328
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.740 ent: -5.097 str: 0.000 loss: -6.837]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.59s/it, atk: -1.740 ent: -5.097 str: 0.000 loss: -6.837]Iterations:   3%|▎         | 1/30 [00:02<00:46,  1.59s/it, atk: -9.456 ent: -5.081 str: 0.000 loss: -14.537]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -9.456 ent: -5.081 str: 0.000 loss: -14.537]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -18.923 ent: -5.074 str: 0.000 loss: -23.997]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -18.923 ent: -5.074 str: 0.000 loss: -23.997]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.07it/s, atk: -28.014 ent: -5.073 str: 0.000 loss: -33.087]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.18it/s, atk: -28.014 ent: -5.073 str: 0.000 loss: -33.087]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.18it/s, atk: -39.990 ent: -5.068 str: 0.000 loss: -45.059]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -39.990 ent: -5.068 str: 0.000 loss: -45.059]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -52.535 ent: -5.071 str: 0.000 loss: -57.606]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -52.535 ent: -5.071 str: 0.000 loss: -57.606]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -64.335 ent: -5.071 str: 0.000 loss: -69.406]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.32it/s, atk: -64.335 ent: -5.071 str: 0.000 loss: -69.406]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -65.436 ent: -5.070 str: 0.000 loss: -70.506]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -65.436 ent: -5.070 str: 0.000 loss: -70.506]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -79.009 ent: -5.065 str: 0.000 loss: -84.075]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -79.009 ent: -5.065 str: 0.000 loss: -84.075]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -85.295 ent: -5.060 str: 0.000 loss: -90.354]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -85.295 ent: -5.060 str: 0.000 loss: -90.354]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -90.745 ent: -5.054 str: 0.000 loss: -95.799]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.31it/s, atk: -90.745 ent: -5.054 str: 0.000 loss: -95.799]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -99.508 ent: -5.054 str: 0.000 loss: -104.563]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -99.508 ent: -5.054 str: 0.000 loss: -104.563]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -106.704 ent: -5.055 str: 0.000 loss: -111.759]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -106.704 ent: -5.055 str: 0.000 loss: -111.759]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -112.751 ent: -5.055 str: 0.000 loss: -117.806]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -112.751 ent: -5.055 str: 0.000 loss: -117.806]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -116.821 ent: -5.055 str: 0.000 loss: -121.875]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.36it/s, atk: -116.821 ent: -5.055 str: 0.000 loss: -121.875]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.36it/s, atk: -122.395 ent: -5.052 str: 0.000 loss: -127.447]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.30it/s, atk: -122.395 ent: -5.052 str: 0.000 loss: -127.447]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.30it/s, atk: -117.177 ent: -5.053 str: 0.000 loss: -122.230]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.32it/s, atk: -117.177 ent: -5.053 str: 0.000 loss: -122.230]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.32it/s, atk: -120.364 ent: -5.050 str: 0.000 loss: -125.413]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -120.364 ent: -5.050 str: 0.000 loss: -125.413]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -121.753 ent: -5.047 str: 0.000 loss: -126.800]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -121.753 ent: -5.047 str: 0.000 loss: -126.800]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -127.080 ent: -5.047 str: 0.000 loss: -132.127]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -127.080 ent: -5.047 str: 0.000 loss: -132.127]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -129.237 ent: -5.048 str: 0.000 loss: -134.285]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -129.237 ent: -5.048 str: 0.000 loss: -134.285]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -134.969 ent: -5.049 str: 0.000 loss: -140.018]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -134.969 ent: -5.049 str: 0.000 loss: -140.018]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -139.127 ent: -5.049 str: 0.000 loss: -144.176]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -139.127 ent: -5.049 str: 0.000 loss: -144.176]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -139.737 ent: -5.050 str: 0.000 loss: -144.787]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -139.737 ent: -5.050 str: 0.000 loss: -144.787]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -146.136 ent: -5.051 str: 0.000 loss: -151.186]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -146.136 ent: -5.051 str: 0.000 loss: -151.186]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.36it/s, atk: -150.354 ent: -5.052 str: 0.000 loss: -155.406]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -150.354 ent: -5.052 str: 0.000 loss: -155.406]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.43it/s, atk: -154.914 ent: -5.054 str: 0.000 loss: -159.968]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -154.914 ent: -5.054 str: 0.000 loss: -159.968]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.44it/s, atk: -160.089 ent: -5.055 str: 0.000 loss: -165.144]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -160.089 ent: -5.055 str: 0.000 loss: -165.144]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -165.744 ent: -5.056 str: 0.000 loss: -170.800]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.43it/s, atk: -165.744 ent: -5.056 str: 0.000 loss: -170.800]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.43it/s, atk: -170.446 ent: -5.056 str: 0.000 loss: -175.501]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.45it/s, atk: -170.446 ent: -5.056 str: 0.000 loss: -175.501]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -170.446 ent: -5.056 str: 0.000 loss: -175.501]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([2], device='cuda:0') tensor(0.9325, device='cuda:0')
after_true: tensor([132], device='cuda:0') tensor(2.5745e-08, device='cuda:0')
L1: [2219.8706]	L2: [15.361263]	Linf: [0.627451]

Accuracy on benign examples: 100.0%
gt_label: 492 pred_label: 492 pred_clean_logit 0.998839795589447
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  4.50it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.70it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 13.21it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.12it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.03it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.39it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 14.92it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 15.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.23it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.01s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.52s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.56s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5738
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.017 ent: -2.590 str: 0.000 loss: -2.606]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.38s/it, atk: -0.017 ent: -2.590 str: 0.000 loss: -2.606]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.38s/it, atk: -0.069 ent: -2.594 str: 0.000 loss: -2.663]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -0.069 ent: -2.594 str: 0.000 loss: -2.663]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -0.850 ent: -2.596 str: 0.000 loss: -3.445]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.15it/s, atk: -0.850 ent: -2.596 str: 0.000 loss: -3.445]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.15it/s, atk: -2.046 ent: -2.596 str: 0.000 loss: -4.642]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.17it/s, atk: -2.046 ent: -2.596 str: 0.000 loss: -4.642]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.17it/s, atk: -3.276 ent: -2.597 str: 0.000 loss: -5.872]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.15it/s, atk: -3.276 ent: -2.597 str: 0.000 loss: -5.872]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.15it/s, atk: -6.841 ent: -2.597 str: 0.000 loss: -9.438]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -6.841 ent: -2.597 str: 0.000 loss: -9.438]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -10.344 ent: -2.597 str: 0.000 loss: -12.941]Iterations:  23%|██▎       | 7/30 [00:05<00:18,  1.27it/s, atk: -10.344 ent: -2.597 str: 0.000 loss: -12.941]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.27it/s, atk: -15.361 ent: -2.596 str: 0.000 loss: -17.957]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.24it/s, atk: -15.361 ent: -2.596 str: 0.000 loss: -17.957]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.24it/s, atk: -19.648 ent: -2.596 str: 0.000 loss: -22.245]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.27it/s, atk: -19.648 ent: -2.596 str: 0.000 loss: -22.245]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -24.962 ent: -2.595 str: 0.000 loss: -27.557]Iterations:  33%|███▎      | 10/30 [00:08<00:16,  1.24it/s, atk: -24.962 ent: -2.595 str: 0.000 loss: -27.557]Iterations:  33%|███▎      | 10/30 [00:08<00:16,  1.24it/s, atk: -29.586 ent: -2.595 str: 0.000 loss: -32.181]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.28it/s, atk: -29.586 ent: -2.595 str: 0.000 loss: -32.181]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.28it/s, atk: -34.129 ent: -2.594 str: 0.000 loss: -36.724]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -34.129 ent: -2.594 str: 0.000 loss: -36.724]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -38.734 ent: -2.593 str: 0.000 loss: -41.327]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.38it/s, atk: -38.734 ent: -2.593 str: 0.000 loss: -41.327]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.38it/s, atk: -43.404 ent: -2.593 str: 0.000 loss: -45.996]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.34it/s, atk: -43.404 ent: -2.593 str: 0.000 loss: -45.996]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.34it/s, atk: -48.702 ent: -2.592 str: 0.000 loss: -51.294]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.40it/s, atk: -48.702 ent: -2.592 str: 0.000 loss: -51.294]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -54.493 ent: -2.592 str: 0.000 loss: -57.084]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.50it/s, atk: -54.493 ent: -2.592 str: 0.000 loss: -57.084]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.50it/s, atk: -59.916 ent: -2.591 str: 0.000 loss: -62.507]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.49it/s, atk: -59.916 ent: -2.591 str: 0.000 loss: -62.507]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.49it/s, atk: -67.027 ent: -2.590 str: 0.000 loss: -69.617]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -67.027 ent: -2.590 str: 0.000 loss: -69.617]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -73.925 ent: -2.590 str: 0.000 loss: -76.515]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -73.925 ent: -2.590 str: 0.000 loss: -76.515]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -79.929 ent: -2.589 str: 0.000 loss: -82.519]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -79.929 ent: -2.589 str: 0.000 loss: -82.519]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.45it/s, atk: -86.338 ent: -2.589 str: 0.000 loss: -88.927]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -86.338 ent: -2.589 str: 0.000 loss: -88.927]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -93.852 ent: -2.588 str: 0.000 loss: -96.440]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.35it/s, atk: -93.852 ent: -2.588 str: 0.000 loss: -96.440]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.35it/s, atk: -100.217 ent: -2.588 str: 0.000 loss: -102.805]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -100.217 ent: -2.588 str: 0.000 loss: -102.805]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -105.689 ent: -2.587 str: 0.000 loss: -108.276]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.30it/s, atk: -105.689 ent: -2.587 str: 0.000 loss: -108.276]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.30it/s, atk: -110.844 ent: -2.587 str: 0.000 loss: -113.431]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -110.844 ent: -2.587 str: 0.000 loss: -113.431]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -113.787 ent: -2.586 str: 0.000 loss: -116.373]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -113.787 ent: -2.586 str: 0.000 loss: -116.373]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.41it/s, atk: -119.067 ent: -2.586 str: 0.000 loss: -121.653]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -119.067 ent: -2.586 str: 0.000 loss: -121.653]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -124.434 ent: -2.586 str: 0.000 loss: -127.020]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -124.434 ent: -2.586 str: 0.000 loss: -127.020]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -129.869 ent: -2.586 str: 0.000 loss: -132.455]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -129.869 ent: -2.586 str: 0.000 loss: -132.455]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -135.075 ent: -2.586 str: 0.000 loss: -137.661]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.50it/s, atk: -135.075 ent: -2.586 str: 0.000 loss: -137.661]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -135.075 ent: -2.586 str: 0.000 loss: -137.661]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([637], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([492], device='cuda:0') tensor(9.2047e-07, device='cuda:0')
L1: [3993.5767]	L2: [25.848322]	Linf: [0.7882353]

Accuracy on benign examples: 100.0%
gt_label: 917 pred_label: 917 pred_clean_logit 0.7053939700126648
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.64it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.04it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.73it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.28it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.48it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.78it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.02it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.51s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4374
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.860 ent: -5.032 str: 0.000 loss: -5.892]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.56s/it, atk: -0.860 ent: -5.032 str: 0.000 loss: -5.892]Iterations:   3%|▎         | 1/30 [00:03<01:14,  2.56s/it, atk: -2.707 ent: -5.022 str: 0.000 loss: -7.729]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -2.707 ent: -5.022 str: 0.000 loss: -7.729]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.51s/it, atk: -4.191 ent: -5.030 str: 0.000 loss: -9.221]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -4.191 ent: -5.030 str: 0.000 loss: -9.221]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -11.632 ent: -5.019 str: 0.000 loss: -16.651]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.04it/s, atk: -11.632 ent: -5.019 str: 0.000 loss: -16.651]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.04it/s, atk: -18.149 ent: -5.019 str: 0.000 loss: -23.168]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -18.149 ent: -5.019 str: 0.000 loss: -23.168]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -23.148 ent: -5.018 str: 0.000 loss: -28.166]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -23.148 ent: -5.018 str: 0.000 loss: -28.166]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -30.269 ent: -5.015 str: 0.000 loss: -35.283]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.22it/s, atk: -30.269 ent: -5.015 str: 0.000 loss: -35.283]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.22it/s, atk: -36.569 ent: -5.016 str: 0.000 loss: -41.586]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -36.569 ent: -5.016 str: 0.000 loss: -41.586]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.34it/s, atk: -47.633 ent: -5.017 str: 0.000 loss: -52.650]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -47.633 ent: -5.017 str: 0.000 loss: -52.650]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -53.746 ent: -5.018 str: 0.000 loss: -58.764]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.32it/s, atk: -53.746 ent: -5.018 str: 0.000 loss: -58.764]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.32it/s, atk: -59.969 ent: -5.017 str: 0.000 loss: -64.985]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.32it/s, atk: -59.969 ent: -5.017 str: 0.000 loss: -64.985]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -68.268 ent: -5.011 str: 0.000 loss: -73.279]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -68.268 ent: -5.011 str: 0.000 loss: -73.279]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -75.850 ent: -5.009 str: 0.000 loss: -80.859]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.42it/s, atk: -75.850 ent: -5.009 str: 0.000 loss: -80.859]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.42it/s, atk: -81.896 ent: -5.007 str: 0.000 loss: -86.903]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -81.896 ent: -5.007 str: 0.000 loss: -86.903]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.40it/s, atk: -90.156 ent: -5.005 str: 0.000 loss: -95.161]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -90.156 ent: -5.005 str: 0.000 loss: -95.161]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -97.204 ent: -5.005 str: 0.000 loss: -102.209]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -97.204 ent: -5.005 str: 0.000 loss: -102.209]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -103.688 ent: -5.004 str: 0.000 loss: -108.692]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.39it/s, atk: -103.688 ent: -5.004 str: 0.000 loss: -108.692]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.39it/s, atk: -110.526 ent: -5.002 str: 0.000 loss: -115.527]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -110.526 ent: -5.002 str: 0.000 loss: -115.527]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.43it/s, atk: -117.144 ent: -5.000 str: 0.000 loss: -122.143]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.45it/s, atk: -117.144 ent: -5.000 str: 0.000 loss: -122.143]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.45it/s, atk: -122.922 ent: -4.998 str: 0.000 loss: -127.920]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.50it/s, atk: -122.922 ent: -4.998 str: 0.000 loss: -127.920]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.50it/s, atk: -126.586 ent: -4.999 str: 0.000 loss: -131.584]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.48it/s, atk: -126.586 ent: -4.999 str: 0.000 loss: -131.584]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.48it/s, atk: -133.059 ent: -4.998 str: 0.000 loss: -138.057]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -133.059 ent: -4.998 str: 0.000 loss: -138.057]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -139.407 ent: -4.997 str: 0.000 loss: -144.404]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -139.407 ent: -4.997 str: 0.000 loss: -144.404]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.54it/s, atk: -140.299 ent: -4.998 str: 0.000 loss: -145.297]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -140.299 ent: -4.998 str: 0.000 loss: -145.297]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.45it/s, atk: -148.888 ent: -4.997 str: 0.000 loss: -153.885]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.48it/s, atk: -148.888 ent: -4.997 str: 0.000 loss: -153.885]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.48it/s, atk: -150.779 ent: -4.996 str: 0.000 loss: -155.775]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -150.779 ent: -4.996 str: 0.000 loss: -155.775]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -158.566 ent: -4.996 str: 0.000 loss: -163.562]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -158.566 ent: -4.996 str: 0.000 loss: -163.562]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -162.104 ent: -4.998 str: 0.000 loss: -167.102]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.39it/s, atk: -162.104 ent: -4.998 str: 0.000 loss: -167.102]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -166.367 ent: -4.998 str: 0.000 loss: -171.366]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.39it/s, atk: -166.367 ent: -4.998 str: 0.000 loss: -171.366]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.39it/s, atk: -170.521 ent: -4.997 str: 0.000 loss: -175.518]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.33it/s, atk: -170.521 ent: -4.997 str: 0.000 loss: -175.518]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -170.521 ent: -4.997 str: 0.000 loss: -175.518]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([611], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([917], device='cuda:0') tensor(2.7997e-08, device='cuda:0')
L1: [6612.5024]	L2: [42.439724]	Linf: [0.9882353]

Accuracy on benign examples: 100.0%
gt_label: 81 pred_label: 81 pred_clean_logit 0.9926135540008545
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.79it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.51it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.19it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.74it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.31it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.44it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.97it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.65it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.69it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.14it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.58s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4435
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.426 ent: -9.771 str: 0.000 loss: -10.197]Iterations:   3%|▎         | 1/30 [00:01<00:36,  1.26s/it, atk: -0.426 ent: -9.771 str: 0.000 loss: -10.197]Iterations:   3%|▎         | 1/30 [00:01<00:36,  1.26s/it, atk: -1.944 ent: -9.751 str: 0.000 loss: -11.695]Iterations:   7%|▋         | 2/30 [00:01<00:24,  1.14it/s, atk: -1.944 ent: -9.751 str: 0.000 loss: -11.695]Iterations:   7%|▋         | 2/30 [00:02<00:24,  1.14it/s, atk: -7.567 ent: -9.737 str: 0.000 loss: -17.304]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.29it/s, atk: -7.567 ent: -9.737 str: 0.000 loss: -17.304]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.29it/s, atk: -13.513 ent: -9.718 str: 0.000 loss: -23.230]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -13.513 ent: -9.718 str: 0.000 loss: -23.230]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -29.852 ent: -9.718 str: 0.000 loss: -39.570]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -29.852 ent: -9.718 str: 0.000 loss: -39.570]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -49.752 ent: -9.719 str: 0.000 loss: -59.470]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.30it/s, atk: -49.752 ent: -9.719 str: 0.000 loss: -59.470]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.30it/s, atk: -65.268 ent: -9.726 str: 0.000 loss: -74.995]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.29it/s, atk: -65.268 ent: -9.726 str: 0.000 loss: -74.995]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -79.262 ent: -9.724 str: 0.000 loss: -88.986]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.25it/s, atk: -79.262 ent: -9.724 str: 0.000 loss: -88.986]Iterations:  27%|██▋       | 8/30 [00:06<00:17,  1.25it/s, atk: -86.408 ent: -9.721 str: 0.000 loss: -96.129]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.30it/s, atk: -86.408 ent: -9.721 str: 0.000 loss: -96.129]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.30it/s, atk: -99.650 ent: -9.720 str: 0.000 loss: -109.370]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.25it/s, atk: -99.650 ent: -9.720 str: 0.000 loss: -109.370]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.25it/s, atk: -103.924 ent: -9.721 str: 0.000 loss: -113.645]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.29it/s, atk: -103.924 ent: -9.721 str: 0.000 loss: -113.645]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.29it/s, atk: -112.588 ent: -9.721 str: 0.000 loss: -122.310]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.34it/s, atk: -112.588 ent: -9.721 str: 0.000 loss: -122.310]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.34it/s, atk: -121.404 ent: -9.717 str: 0.000 loss: -131.121]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -121.404 ent: -9.717 str: 0.000 loss: -131.121]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -131.148 ent: -9.713 str: 0.000 loss: -140.862]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.37it/s, atk: -131.148 ent: -9.713 str: 0.000 loss: -140.862]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.37it/s, atk: -138.905 ent: -9.712 str: 0.000 loss: -148.616]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.34it/s, atk: -138.905 ent: -9.712 str: 0.000 loss: -148.616]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.34it/s, atk: -142.581 ent: -9.709 str: 0.000 loss: -152.290]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -142.581 ent: -9.709 str: 0.000 loss: -152.290]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -145.940 ent: -9.702 str: 0.000 loss: -155.642]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -145.940 ent: -9.702 str: 0.000 loss: -155.642]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -154.009 ent: -9.707 str: 0.000 loss: -163.716]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -154.009 ent: -9.707 str: 0.000 loss: -163.716]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.43it/s, atk: -158.951 ent: -9.699 str: 0.000 loss: -168.650]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -158.951 ent: -9.699 str: 0.000 loss: -168.650]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -164.684 ent: -9.696 str: 0.000 loss: -174.381]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -164.684 ent: -9.696 str: 0.000 loss: -174.381]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -171.213 ent: -9.693 str: 0.000 loss: -180.906]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.40it/s, atk: -171.213 ent: -9.693 str: 0.000 loss: -180.906]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -172.563 ent: -9.697 str: 0.000 loss: -182.260]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -172.563 ent: -9.697 str: 0.000 loss: -182.260]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.45it/s, atk: -177.655 ent: -9.691 str: 0.000 loss: -187.346]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -177.655 ent: -9.691 str: 0.000 loss: -187.346]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -181.697 ent: -9.683 str: 0.000 loss: -191.380]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -181.697 ent: -9.683 str: 0.000 loss: -191.380]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.37it/s, atk: -189.111 ent: -9.681 str: 0.000 loss: -198.792]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -189.111 ent: -9.681 str: 0.000 loss: -198.792]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -190.422 ent: -9.686 str: 0.000 loss: -200.108]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -190.422 ent: -9.686 str: 0.000 loss: -200.108]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.46it/s, atk: -196.651 ent: -9.683 str: 0.000 loss: -206.335]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.47it/s, atk: -196.651 ent: -9.683 str: 0.000 loss: -206.335]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -200.294 ent: -9.687 str: 0.000 loss: -209.981]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.44it/s, atk: -200.294 ent: -9.687 str: 0.000 loss: -209.981]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.44it/s, atk: -205.077 ent: -9.690 str: 0.000 loss: -214.768]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -205.077 ent: -9.690 str: 0.000 loss: -214.768]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -208.320 ent: -9.692 str: 0.000 loss: -218.012]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -208.320 ent: -9.692 str: 0.000 loss: -218.012]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -208.320 ent: -9.692 str: 0.000 loss: -218.012]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([139], device='cuda:0') tensor(0.9991, device='cuda:0')
after_true: tensor([81], device='cuda:0') tensor(5.0958e-10, device='cuda:0')
L1: [4233.0474]	L2: [27.638292]	Linf: [0.8117647]

Accuracy on benign examples: 100.0%
gt_label: 763 pred_label: 763 pred_clean_logit 0.9998593330383301
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.65it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 16.01it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.26it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.02it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.65it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.03it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.72it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.50it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.42s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.45s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.44s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4049
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -2.854 str: 0.000 loss: -2.858]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.75s/it, atk: -0.003 ent: -2.854 str: 0.000 loss: -2.858]Iterations:   3%|▎         | 1/30 [00:02<00:50,  1.75s/it, atk: -0.002 ent: -2.889 str: 0.000 loss: -2.890]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -0.002 ent: -2.889 str: 0.000 loss: -2.890]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.14s/it, atk: -0.003 ent: -2.905 str: 0.000 loss: -2.908]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -0.003 ent: -2.905 str: 0.000 loss: -2.908]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -0.004 ent: -2.919 str: 0.000 loss: -2.924]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -0.004 ent: -2.919 str: 0.000 loss: -2.924]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -0.005 ent: -2.929 str: 0.000 loss: -2.934]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.21it/s, atk: -0.005 ent: -2.929 str: 0.000 loss: -2.934]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.21it/s, atk: -0.007 ent: -2.941 str: 0.000 loss: -2.947]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -0.007 ent: -2.941 str: 0.000 loss: -2.947]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -0.010 ent: -2.950 str: 0.000 loss: -2.960]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.35it/s, atk: -0.010 ent: -2.950 str: 0.000 loss: -2.960]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -0.014 ent: -2.957 str: 0.000 loss: -2.971]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -0.014 ent: -2.957 str: 0.000 loss: -2.971]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -0.027 ent: -2.966 str: 0.000 loss: -2.992]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.40it/s, atk: -0.027 ent: -2.966 str: 0.000 loss: -2.992]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.40it/s, atk: -0.053 ent: -2.973 str: 0.000 loss: -3.025]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -0.053 ent: -2.973 str: 0.000 loss: -3.025]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.44it/s, atk: -0.153 ent: -2.975 str: 0.000 loss: -3.128]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.52it/s, atk: -0.153 ent: -2.975 str: 0.000 loss: -3.128]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.52it/s, atk: -0.294 ent: -2.972 str: 0.000 loss: -3.266]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.58it/s, atk: -0.294 ent: -2.972 str: 0.000 loss: -3.266]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.58it/s, atk: -0.543 ent: -2.975 str: 0.000 loss: -3.519]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.59it/s, atk: -0.543 ent: -2.975 str: 0.000 loss: -3.519]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.59it/s, atk: -1.097 ent: -2.976 str: 0.000 loss: -4.073]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -1.097 ent: -2.976 str: 0.000 loss: -4.073]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -2.362 ent: -2.973 str: 0.000 loss: -5.335]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -2.362 ent: -2.973 str: 0.000 loss: -5.335]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -3.721 ent: -2.970 str: 0.000 loss: -6.691]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.49it/s, atk: -3.721 ent: -2.970 str: 0.000 loss: -6.691]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -7.233 ent: -2.969 str: 0.000 loss: -10.201]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.46it/s, atk: -7.233 ent: -2.969 str: 0.000 loss: -10.201]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.46it/s, atk: -12.130 ent: -2.967 str: 0.000 loss: -15.097]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.45it/s, atk: -12.130 ent: -2.967 str: 0.000 loss: -15.097]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.45it/s, atk: -21.478 ent: -2.967 str: 0.000 loss: -24.445]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.46it/s, atk: -21.478 ent: -2.967 str: 0.000 loss: -24.445]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.46it/s, atk: -29.450 ent: -2.966 str: 0.000 loss: -32.415]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.52it/s, atk: -29.450 ent: -2.966 str: 0.000 loss: -32.415]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.52it/s, atk: -40.488 ent: -2.965 str: 0.000 loss: -43.452]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.52it/s, atk: -40.488 ent: -2.965 str: 0.000 loss: -43.452]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.52it/s, atk: -49.274 ent: -2.965 str: 0.000 loss: -52.238]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.46it/s, atk: -49.274 ent: -2.965 str: 0.000 loss: -52.238]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.46it/s, atk: -56.760 ent: -2.964 str: 0.000 loss: -59.724]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.43it/s, atk: -56.760 ent: -2.964 str: 0.000 loss: -59.724]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.43it/s, atk: -66.959 ent: -2.962 str: 0.000 loss: -69.921]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.43it/s, atk: -66.959 ent: -2.962 str: 0.000 loss: -69.921]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.43it/s, atk: -73.970 ent: -2.960 str: 0.000 loss: -76.930]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -73.970 ent: -2.960 str: 0.000 loss: -76.930]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -84.411 ent: -2.959 str: 0.000 loss: -87.370]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.41it/s, atk: -84.411 ent: -2.959 str: 0.000 loss: -87.370]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.41it/s, atk: -93.825 ent: -2.958 str: 0.000 loss: -96.783]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.50it/s, atk: -93.825 ent: -2.958 str: 0.000 loss: -96.783]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.50it/s, atk: -101.095 ent: -2.957 str: 0.000 loss: -104.053]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -101.095 ent: -2.957 str: 0.000 loss: -104.053]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.49it/s, atk: -108.816 ent: -2.957 str: 0.000 loss: -111.774]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.41it/s, atk: -108.816 ent: -2.957 str: 0.000 loss: -111.774]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.41it/s, atk: -115.213 ent: -2.957 str: 0.000 loss: -118.170]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.50it/s, atk: -115.213 ent: -2.957 str: 0.000 loss: -118.170]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -115.213 ent: -2.957 str: 0.000 loss: -118.170]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([784], device='cuda:0') tensor(0.7062, device='cuda:0')
after_true: tensor([763], device='cuda:0') tensor(4.3148e-06, device='cuda:0')
L1: [2498.7805]	L2: [17.404446]	Linf: [0.6784314]

Accuracy on benign examples: 100.0%
gt_label: 50 pred_label: 50 pred_clean_logit 0.9821228384971619
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.59it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.75it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.64it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 22.70it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 22.29it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 21.97it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 22.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.60s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.56s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5158
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.017 ent: -4.848 str: 0.000 loss: -4.864]Iterations:   3%|▎         | 1/30 [00:02<01:14,  2.56s/it, atk: -0.017 ent: -4.848 str: 0.000 loss: -4.864]Iterations:   3%|▎         | 1/30 [00:03<01:14,  2.56s/it, atk: -0.056 ent: -4.867 str: 0.000 loss: -4.923]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -0.056 ent: -4.867 str: 0.000 loss: -4.923]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -0.251 ent: -4.872 str: 0.000 loss: -5.122]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.11s/it, atk: -0.251 ent: -4.872 str: 0.000 loss: -5.122]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.11s/it, atk: -0.836 ent: -4.878 str: 0.000 loss: -5.713]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.04it/s, atk: -0.836 ent: -4.878 str: 0.000 loss: -5.713]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.04it/s, atk: -1.110 ent: -4.877 str: 0.000 loss: -5.988]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.22it/s, atk: -1.110 ent: -4.877 str: 0.000 loss: -5.988]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.22it/s, atk: -2.182 ent: -4.874 str: 0.000 loss: -7.056]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -2.182 ent: -4.874 str: 0.000 loss: -7.056]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -6.586 ent: -4.869 str: 0.000 loss: -11.455]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -6.586 ent: -4.869 str: 0.000 loss: -11.455]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -4.969 ent: -4.874 str: 0.000 loss: -9.843] Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.43it/s, atk: -4.969 ent: -4.874 str: 0.000 loss: -9.843]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.43it/s, atk: -9.679 ent: -4.867 str: 0.000 loss: -14.547]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -9.679 ent: -4.867 str: 0.000 loss: -14.547]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.43it/s, atk: -8.727 ent: -4.865 str: 0.000 loss: -13.592]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.42it/s, atk: -8.727 ent: -4.865 str: 0.000 loss: -13.592]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.42it/s, atk: -16.232 ent: -4.869 str: 0.000 loss: -21.101]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.46it/s, atk: -16.232 ent: -4.869 str: 0.000 loss: -21.101]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.46it/s, atk: -24.610 ent: -4.869 str: 0.000 loss: -29.479]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -24.610 ent: -4.869 str: 0.000 loss: -29.479]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -28.901 ent: -4.868 str: 0.000 loss: -33.769]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -28.901 ent: -4.868 str: 0.000 loss: -33.769]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.48it/s, atk: -36.081 ent: -4.865 str: 0.000 loss: -40.946]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -36.081 ent: -4.865 str: 0.000 loss: -40.946]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -38.435 ent: -4.862 str: 0.000 loss: -43.297]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -38.435 ent: -4.862 str: 0.000 loss: -43.297]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.44it/s, atk: -44.518 ent: -4.862 str: 0.000 loss: -49.379]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.37it/s, atk: -44.518 ent: -4.862 str: 0.000 loss: -49.379]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -49.617 ent: -4.862 str: 0.000 loss: -54.479]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -49.617 ent: -4.862 str: 0.000 loss: -54.479]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -50.721 ent: -4.865 str: 0.000 loss: -55.586]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -50.721 ent: -4.865 str: 0.000 loss: -55.586]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -52.263 ent: -4.866 str: 0.000 loss: -57.129]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -52.263 ent: -4.866 str: 0.000 loss: -57.129]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -46.273 ent: -4.865 str: 0.000 loss: -51.138]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.33it/s, atk: -46.273 ent: -4.865 str: 0.000 loss: -51.138]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -54.120 ent: -4.871 str: 0.000 loss: -58.991]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.28it/s, atk: -54.120 ent: -4.871 str: 0.000 loss: -58.991]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.28it/s, atk: -49.058 ent: -4.871 str: 0.000 loss: -53.930]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.35it/s, atk: -49.058 ent: -4.871 str: 0.000 loss: -53.930]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.35it/s, atk: -51.195 ent: -4.869 str: 0.000 loss: -56.064]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.40it/s, atk: -51.195 ent: -4.869 str: 0.000 loss: -56.064]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.40it/s, atk: -53.589 ent: -4.867 str: 0.000 loss: -58.456]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.33it/s, atk: -53.589 ent: -4.867 str: 0.000 loss: -58.456]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.33it/s, atk: -51.724 ent: -4.863 str: 0.000 loss: -56.586]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.34it/s, atk: -51.724 ent: -4.863 str: 0.000 loss: -56.586]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.34it/s, atk: -53.566 ent: -4.861 str: 0.000 loss: -58.427]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.34it/s, atk: -53.566 ent: -4.861 str: 0.000 loss: -58.427]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.34it/s, atk: -55.278 ent: -4.862 str: 0.000 loss: -60.140]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -55.278 ent: -4.862 str: 0.000 loss: -60.140]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.43it/s, atk: -56.122 ent: -4.862 str: 0.000 loss: -60.984]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -56.122 ent: -4.862 str: 0.000 loss: -60.984]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.45it/s, atk: -60.738 ent: -4.862 str: 0.000 loss: -65.600]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -60.738 ent: -4.862 str: 0.000 loss: -65.600]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -63.898 ent: -4.862 str: 0.000 loss: -68.759]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.47it/s, atk: -63.898 ent: -4.862 str: 0.000 loss: -68.759]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -63.898 ent: -4.862 str: 0.000 loss: -68.759]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([49], device='cuda:0') tensor(0.9988, device='cuda:0')
after_true: tensor([50], device='cuda:0') tensor(0.0012, device='cuda:0')
L1: [4000.2434]	L2: [24.904121]	Linf: [0.5882353]

Accuracy on benign examples: 100.0%
gt_label: 970 pred_label: 970 pred_clean_logit 0.6527518630027771
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.06it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.74it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 14.31it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.01it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.39it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.98it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.46it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.57it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.80it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.05it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.22s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.28s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.45s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5607
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.892 ent: -2.570 str: 0.000 loss: -5.462]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.85s/it, atk: -2.892 ent: -2.570 str: 0.000 loss: -5.462]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.85s/it, atk: -3.615 ent: -2.521 str: 0.000 loss: -6.135]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -3.615 ent: -2.521 str: 0.000 loss: -6.135]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -3.569 ent: -2.522 str: 0.000 loss: -6.091]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -3.569 ent: -2.522 str: 0.000 loss: -6.091]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -4.158 ent: -2.520 str: 0.000 loss: -6.678]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.18it/s, atk: -4.158 ent: -2.520 str: 0.000 loss: -6.678]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.18it/s, atk: -4.381 ent: -2.517 str: 0.000 loss: -6.899]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -4.381 ent: -2.517 str: 0.000 loss: -6.899]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -5.283 ent: -2.527 str: 0.000 loss: -7.811]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.33it/s, atk: -5.283 ent: -2.527 str: 0.000 loss: -7.811]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.33it/s, atk: -5.941 ent: -2.520 str: 0.000 loss: -8.461]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -5.941 ent: -2.520 str: 0.000 loss: -8.461]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -6.526 ent: -2.521 str: 0.000 loss: -9.047]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -6.526 ent: -2.521 str: 0.000 loss: -9.047]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -7.268 ent: -2.516 str: 0.000 loss: -9.784]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -7.268 ent: -2.516 str: 0.000 loss: -9.784]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -7.628 ent: -2.508 str: 0.000 loss: -10.136]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -7.628 ent: -2.508 str: 0.000 loss: -10.136]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -7.756 ent: -2.505 str: 0.000 loss: -10.261]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.31it/s, atk: -7.756 ent: -2.505 str: 0.000 loss: -10.261]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.31it/s, atk: -8.080 ent: -2.505 str: 0.000 loss: -10.586]Iterations:  40%|████      | 12/30 [00:09<00:14,  1.28it/s, atk: -8.080 ent: -2.505 str: 0.000 loss: -10.586]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.28it/s, atk: -7.929 ent: -2.511 str: 0.000 loss: -10.440]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.26it/s, atk: -7.929 ent: -2.511 str: 0.000 loss: -10.440]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.26it/s, atk: -7.117 ent: -2.515 str: 0.000 loss: -9.632] Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -7.117 ent: -2.515 str: 0.000 loss: -9.632]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -7.299 ent: -2.517 str: 0.000 loss: -9.816]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.36it/s, atk: -7.299 ent: -2.517 str: 0.000 loss: -9.816]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.36it/s, atk: -7.788 ent: -2.519 str: 0.000 loss: -10.308]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.41it/s, atk: -7.788 ent: -2.519 str: 0.000 loss: -10.308]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.41it/s, atk: -7.938 ent: -2.522 str: 0.000 loss: -10.460]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -7.938 ent: -2.522 str: 0.000 loss: -10.460]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -8.455 ent: -2.525 str: 0.000 loss: -10.979]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.30it/s, atk: -8.455 ent: -2.525 str: 0.000 loss: -10.979]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.30it/s, atk: -8.540 ent: -2.530 str: 0.000 loss: -11.069]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.34it/s, atk: -8.540 ent: -2.530 str: 0.000 loss: -11.069]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -9.762 ent: -2.532 str: 0.000 loss: -12.294]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -9.762 ent: -2.532 str: 0.000 loss: -12.294]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.41it/s, atk: -10.673 ent: -2.531 str: 0.000 loss: -13.204]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -10.673 ent: -2.531 str: 0.000 loss: -13.204]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -11.080 ent: -2.532 str: 0.000 loss: -13.612]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -11.080 ent: -2.532 str: 0.000 loss: -13.612]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.37it/s, atk: -11.190 ent: -2.528 str: 0.000 loss: -13.718]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -11.190 ent: -2.528 str: 0.000 loss: -13.718]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.44it/s, atk: -12.113 ent: -2.527 str: 0.000 loss: -14.640]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.47it/s, atk: -12.113 ent: -2.527 str: 0.000 loss: -14.640]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.47it/s, atk: -12.905 ent: -2.526 str: 0.000 loss: -15.431]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -12.905 ent: -2.526 str: 0.000 loss: -15.431]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.40it/s, atk: -13.780 ent: -2.525 str: 0.000 loss: -16.304]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.38it/s, atk: -13.780 ent: -2.525 str: 0.000 loss: -16.304]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -14.831 ent: -2.524 str: 0.000 loss: -17.354]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -14.831 ent: -2.524 str: 0.000 loss: -17.354]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -16.014 ent: -2.522 str: 0.000 loss: -18.537]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.33it/s, atk: -16.014 ent: -2.522 str: 0.000 loss: -18.537]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.33it/s, atk: -16.694 ent: -2.522 str: 0.000 loss: -19.216]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.35it/s, atk: -16.694 ent: -2.522 str: 0.000 loss: -19.216]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.35it/s, atk: -17.458 ent: -2.523 str: 0.000 loss: -19.981]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -17.458 ent: -2.523 str: 0.000 loss: -19.981]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -17.458 ent: -2.523 str: 0.000 loss: -19.981]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([979], device='cuda:0') tensor(0.3302, device='cuda:0')
after_true: tensor([970], device='cuda:0') tensor(0.1549, device='cuda:0')
L1: [1040.9688]	L2: [7.3770547]	Linf: [0.4]

Accuracy on benign examples: 100.0%
gt_label: 113 pred_label: 113 pred_clean_logit 0.9921445250511169
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.39it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.01it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 14.91it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.33it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.06it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.15it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.83it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.85it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.72it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.29s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.17s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.25s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.40s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.50s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3449
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.028 ent: -2.618 str: 0.000 loss: -2.647]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.84s/it, atk: -0.028 ent: -2.618 str: 0.000 loss: -2.647]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.84s/it, atk: -0.080 ent: -2.640 str: 0.000 loss: -2.720]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.23s/it, atk: -0.080 ent: -2.640 str: 0.000 loss: -2.720]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.23s/it, atk: -0.425 ent: -2.648 str: 0.000 loss: -3.073]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.425 ent: -2.648 str: 0.000 loss: -3.073]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -1.594 ent: -2.635 str: 0.000 loss: -4.229]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -1.594 ent: -2.635 str: 0.000 loss: -4.229]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -7.283 ent: -2.629 str: 0.000 loss: -9.912]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.18it/s, atk: -7.283 ent: -2.629 str: 0.000 loss: -9.912]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -17.113 ent: -2.623 str: 0.000 loss: -19.736]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -17.113 ent: -2.623 str: 0.000 loss: -19.736]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -30.130 ent: -2.618 str: 0.000 loss: -32.748]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -30.130 ent: -2.618 str: 0.000 loss: -32.748]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -40.797 ent: -2.617 str: 0.000 loss: -43.415]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -40.797 ent: -2.617 str: 0.000 loss: -43.415]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -54.123 ent: -2.609 str: 0.000 loss: -56.732]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.34it/s, atk: -54.123 ent: -2.609 str: 0.000 loss: -56.732]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -65.337 ent: -2.603 str: 0.000 loss: -67.940]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.33it/s, atk: -65.337 ent: -2.603 str: 0.000 loss: -67.940]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.33it/s, atk: -76.699 ent: -2.600 str: 0.000 loss: -79.299]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.27it/s, atk: -76.699 ent: -2.600 str: 0.000 loss: -79.299]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.27it/s, atk: -86.033 ent: -2.597 str: 0.000 loss: -88.631]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.33it/s, atk: -86.033 ent: -2.597 str: 0.000 loss: -88.631]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.33it/s, atk: -94.539 ent: -2.596 str: 0.000 loss: -97.136]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.39it/s, atk: -94.539 ent: -2.596 str: 0.000 loss: -97.136]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.39it/s, atk: -102.075 ent: -2.596 str: 0.000 loss: -104.671]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -102.075 ent: -2.596 str: 0.000 loss: -104.671]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -108.660 ent: -2.597 str: 0.000 loss: -111.257]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -108.660 ent: -2.597 str: 0.000 loss: -111.257]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.45it/s, atk: -114.264 ent: -2.596 str: 0.000 loss: -116.861]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -114.264 ent: -2.596 str: 0.000 loss: -116.861]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.49it/s, atk: -120.418 ent: -2.596 str: 0.000 loss: -123.014]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -120.418 ent: -2.596 str: 0.000 loss: -123.014]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -126.133 ent: -2.598 str: 0.000 loss: -128.731]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -126.133 ent: -2.598 str: 0.000 loss: -128.731]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -131.191 ent: -2.599 str: 0.000 loss: -133.791]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -131.191 ent: -2.599 str: 0.000 loss: -133.791]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.37it/s, atk: -135.368 ent: -2.599 str: 0.000 loss: -137.968]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -135.368 ent: -2.599 str: 0.000 loss: -137.968]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -140.454 ent: -2.600 str: 0.000 loss: -143.054]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -140.454 ent: -2.600 str: 0.000 loss: -143.054]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -145.178 ent: -2.600 str: 0.000 loss: -147.778]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -145.178 ent: -2.600 str: 0.000 loss: -147.778]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -149.753 ent: -2.597 str: 0.000 loss: -152.351]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -149.753 ent: -2.597 str: 0.000 loss: -152.351]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -153.723 ent: -2.597 str: 0.000 loss: -156.320]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.36it/s, atk: -153.723 ent: -2.597 str: 0.000 loss: -156.320]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.36it/s, atk: -156.879 ent: -2.596 str: 0.000 loss: -159.475]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -156.879 ent: -2.596 str: 0.000 loss: -159.475]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -160.490 ent: -2.597 str: 0.000 loss: -163.087]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.47it/s, atk: -160.490 ent: -2.597 str: 0.000 loss: -163.087]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.47it/s, atk: -163.327 ent: -2.597 str: 0.000 loss: -165.924]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -163.327 ent: -2.597 str: 0.000 loss: -165.924]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.42it/s, atk: -166.707 ent: -2.596 str: 0.000 loss: -169.303]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.47it/s, atk: -166.707 ent: -2.596 str: 0.000 loss: -169.303]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.47it/s, atk: -170.740 ent: -2.597 str: 0.000 loss: -173.337]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -170.740 ent: -2.597 str: 0.000 loss: -173.337]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.45it/s, atk: -174.663 ent: -2.599 str: 0.000 loss: -177.262]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.38it/s, atk: -174.663 ent: -2.599 str: 0.000 loss: -177.262]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -174.663 ent: -2.599 str: 0.000 loss: -177.262]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([114], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([113], device='cuda:0') tensor(1.8187e-08, device='cuda:0')
L1: [2575.3765]	L2: [16.925526]	Linf: [0.62352943]

Accuracy on benign examples: 100.0%
gt_label: 973 pred_label: 973 pred_clean_logit 0.8252130150794983
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:06,  2.72it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  9.10it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 12.78it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 14.14it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.28it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 15.95it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 18.74it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 20.84it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.33it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.49s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5695
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -3.592 ent: -4.899 str: 0.000 loss: -8.490]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.15s/it, atk: -3.592 ent: -4.899 str: 0.000 loss: -8.490]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.15s/it, atk: -4.381 ent: -4.892 str: 0.000 loss: -9.272]Iterations:   7%|▋         | 2/30 [00:01<00:24,  1.15it/s, atk: -4.381 ent: -4.892 str: 0.000 loss: -9.272]Iterations:   7%|▋         | 2/30 [00:02<00:24,  1.15it/s, atk: -6.613 ent: -4.894 str: 0.000 loss: -11.507]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.32it/s, atk: -6.613 ent: -4.894 str: 0.000 loss: -11.507]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.32it/s, atk: -12.513 ent: -4.883 str: 0.000 loss: -17.396]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.31it/s, atk: -12.513 ent: -4.883 str: 0.000 loss: -17.396]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.31it/s, atk: -18.217 ent: -4.882 str: 0.000 loss: -23.099]Iterations:  17%|█▋        | 5/30 [00:03<00:18,  1.36it/s, atk: -18.217 ent: -4.882 str: 0.000 loss: -23.099]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.36it/s, atk: -23.492 ent: -4.879 str: 0.000 loss: -28.372]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.31it/s, atk: -23.492 ent: -4.879 str: 0.000 loss: -28.372]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -39.451 ent: -4.879 str: 0.000 loss: -44.330]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -39.451 ent: -4.879 str: 0.000 loss: -44.330]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.38it/s, atk: -44.014 ent: -4.880 str: 0.000 loss: -48.894]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -44.014 ent: -4.880 str: 0.000 loss: -48.894]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -49.992 ent: -4.872 str: 0.000 loss: -54.864]Iterations:  30%|███       | 9/30 [00:06<00:16,  1.31it/s, atk: -49.992 ent: -4.872 str: 0.000 loss: -54.864]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.31it/s, atk: -52.676 ent: -4.873 str: 0.000 loss: -57.549]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.40it/s, atk: -52.676 ent: -4.873 str: 0.000 loss: -57.549]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.40it/s, atk: -58.630 ent: -4.872 str: 0.000 loss: -63.502]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.39it/s, atk: -58.630 ent: -4.872 str: 0.000 loss: -63.502]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.39it/s, atk: -65.064 ent: -4.869 str: 0.000 loss: -69.933]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.30it/s, atk: -65.064 ent: -4.869 str: 0.000 loss: -69.933]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.30it/s, atk: -73.140 ent: -4.868 str: 0.000 loss: -78.008]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.32it/s, atk: -73.140 ent: -4.868 str: 0.000 loss: -78.008]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -78.137 ent: -4.869 str: 0.000 loss: -83.006]Iterations:  47%|████▋     | 14/30 [00:10<00:12,  1.31it/s, atk: -78.137 ent: -4.869 str: 0.000 loss: -83.006]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.31it/s, atk: -81.707 ent: -4.870 str: 0.000 loss: -86.577]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.27it/s, atk: -81.707 ent: -4.870 str: 0.000 loss: -86.577]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.27it/s, atk: -85.732 ent: -4.868 str: 0.000 loss: -90.599]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.28it/s, atk: -85.732 ent: -4.868 str: 0.000 loss: -90.599]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.28it/s, atk: -91.235 ent: -4.866 str: 0.000 loss: -96.102]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.35it/s, atk: -91.235 ent: -4.866 str: 0.000 loss: -96.102]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.35it/s, atk: -94.910 ent: -4.868 str: 0.000 loss: -99.778]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.34it/s, atk: -94.910 ent: -4.868 str: 0.000 loss: -99.778]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -101.038 ent: -4.871 str: 0.000 loss: -105.909]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -101.038 ent: -4.871 str: 0.000 loss: -105.909]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -108.708 ent: -4.874 str: 0.000 loss: -113.582]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -108.708 ent: -4.874 str: 0.000 loss: -113.582]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -114.367 ent: -4.876 str: 0.000 loss: -119.244]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.36it/s, atk: -114.367 ent: -4.876 str: 0.000 loss: -119.244]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -116.435 ent: -4.880 str: 0.000 loss: -121.314]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -116.435 ent: -4.880 str: 0.000 loss: -121.314]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -120.374 ent: -4.881 str: 0.000 loss: -125.255]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -120.374 ent: -4.881 str: 0.000 loss: -125.255]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -122.809 ent: -4.882 str: 0.000 loss: -127.690]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.33it/s, atk: -122.809 ent: -4.882 str: 0.000 loss: -127.690]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.33it/s, atk: -126.969 ent: -4.881 str: 0.000 loss: -131.850]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.37it/s, atk: -126.969 ent: -4.881 str: 0.000 loss: -131.850]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.37it/s, atk: -130.361 ent: -4.881 str: 0.000 loss: -135.242]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.32it/s, atk: -130.361 ent: -4.881 str: 0.000 loss: -135.242]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.32it/s, atk: -135.420 ent: -4.880 str: 0.000 loss: -140.300]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -135.420 ent: -4.880 str: 0.000 loss: -140.300]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.36it/s, atk: -140.061 ent: -4.879 str: 0.000 loss: -144.939]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -140.061 ent: -4.879 str: 0.000 loss: -144.939]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -143.228 ent: -4.879 str: 0.000 loss: -148.107]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -143.228 ent: -4.879 str: 0.000 loss: -148.107]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.50it/s, atk: -147.192 ent: -4.877 str: 0.000 loss: -152.069]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.53it/s, atk: -147.192 ent: -4.877 str: 0.000 loss: -152.069]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -147.192 ent: -4.877 str: 0.000 loss: -152.069]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([33], device='cuda:0') tensor(0.9836, device='cuda:0')
after_true: tensor([973], device='cuda:0') tensor(2.7491e-07, device='cuda:0')
L1: [2492.0667]	L2: [15.85861]	Linf: [0.43529415]

Accuracy on benign examples: 100.0%
gt_label: 850 pred_label: 850 pred_clean_logit 0.9894589185714722
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.41it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.81it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.45it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.63it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.91it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.87it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.41it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.57s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.49s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.57s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4663
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.197 ent: -2.615 str: 0.000 loss: -2.812]Iterations:   3%|▎         | 1/30 [00:00<00:27,  1.07it/s, atk: -0.197 ent: -2.615 str: 0.000 loss: -2.812]Iterations:   3%|▎         | 1/30 [00:01<00:27,  1.07it/s, atk: -0.738 ent: -2.601 str: 0.000 loss: -3.339]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.42it/s, atk: -0.738 ent: -2.601 str: 0.000 loss: -3.339]Iterations:   7%|▋         | 2/30 [00:01<00:19,  1.42it/s, atk: -2.208 ent: -2.600 str: 0.000 loss: -4.808]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.40it/s, atk: -2.208 ent: -2.600 str: 0.000 loss: -4.808]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.40it/s, atk: -2.339 ent: -2.603 str: 0.000 loss: -4.942]Iterations:  13%|█▎        | 4/30 [00:02<00:17,  1.46it/s, atk: -2.339 ent: -2.603 str: 0.000 loss: -4.942]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.46it/s, atk: -2.816 ent: -2.598 str: 0.000 loss: -5.414]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.49it/s, atk: -2.816 ent: -2.598 str: 0.000 loss: -5.414]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.49it/s, atk: -4.230 ent: -2.597 str: 0.000 loss: -6.827]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.47it/s, atk: -4.230 ent: -2.597 str: 0.000 loss: -6.827]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.47it/s, atk: -8.930 ent: -2.597 str: 0.000 loss: -11.528]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.35it/s, atk: -8.930 ent: -2.597 str: 0.000 loss: -11.528]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.35it/s, atk: -8.150 ent: -2.600 str: 0.000 loss: -10.750]Iterations:  27%|██▋       | 8/30 [00:05<00:16,  1.32it/s, atk: -8.150 ent: -2.600 str: 0.000 loss: -10.750]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.32it/s, atk: -15.148 ent: -2.602 str: 0.000 loss: -17.750]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.39it/s, atk: -15.148 ent: -2.602 str: 0.000 loss: -17.750]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.39it/s, atk: -23.727 ent: -2.602 str: 0.000 loss: -26.329]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -23.727 ent: -2.602 str: 0.000 loss: -26.329]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -25.658 ent: -2.601 str: 0.000 loss: -28.259]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.29it/s, atk: -25.658 ent: -2.601 str: 0.000 loss: -28.259]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.29it/s, atk: -33.135 ent: -2.601 str: 0.000 loss: -35.736]Iterations:  40%|████      | 12/30 [00:08<00:13,  1.32it/s, atk: -33.135 ent: -2.601 str: 0.000 loss: -35.736]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.32it/s, atk: -43.926 ent: -2.600 str: 0.000 loss: -46.526]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.32it/s, atk: -43.926 ent: -2.600 str: 0.000 loss: -46.526]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -58.011 ent: -2.598 str: 0.000 loss: -60.609]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.37it/s, atk: -58.011 ent: -2.598 str: 0.000 loss: -60.609]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.37it/s, atk: -69.777 ent: -2.598 str: 0.000 loss: -72.375]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.41it/s, atk: -69.777 ent: -2.598 str: 0.000 loss: -72.375]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -82.082 ent: -2.598 str: 0.000 loss: -84.680]Iterations:  53%|█████▎    | 16/30 [00:11<00:10,  1.35it/s, atk: -82.082 ent: -2.598 str: 0.000 loss: -84.680]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -90.946 ent: -2.598 str: 0.000 loss: -93.545]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.42it/s, atk: -90.946 ent: -2.598 str: 0.000 loss: -93.545]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.42it/s, atk: -100.363 ent: -2.598 str: 0.000 loss: -102.961]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -100.363 ent: -2.598 str: 0.000 loss: -102.961]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -111.840 ent: -2.598 str: 0.000 loss: -114.438]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.42it/s, atk: -111.840 ent: -2.598 str: 0.000 loss: -114.438]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.42it/s, atk: -122.332 ent: -2.596 str: 0.000 loss: -124.928]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.43it/s, atk: -122.332 ent: -2.596 str: 0.000 loss: -124.928]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.43it/s, atk: -127.778 ent: -2.593 str: 0.000 loss: -130.371]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.42it/s, atk: -127.778 ent: -2.593 str: 0.000 loss: -130.371]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.42it/s, atk: -138.197 ent: -2.590 str: 0.000 loss: -140.787]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.43it/s, atk: -138.197 ent: -2.590 str: 0.000 loss: -140.787]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -147.351 ent: -2.587 str: 0.000 loss: -149.938]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.48it/s, atk: -147.351 ent: -2.587 str: 0.000 loss: -149.938]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.48it/s, atk: -157.163 ent: -2.585 str: 0.000 loss: -159.749]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.46it/s, atk: -157.163 ent: -2.585 str: 0.000 loss: -159.749]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.46it/s, atk: -158.647 ent: -2.582 str: 0.000 loss: -161.229]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.50it/s, atk: -158.647 ent: -2.582 str: 0.000 loss: -161.229]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.50it/s, atk: -156.277 ent: -2.590 str: 0.000 loss: -158.867]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.50it/s, atk: -156.277 ent: -2.590 str: 0.000 loss: -158.867]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.50it/s, atk: -155.346 ent: -2.593 str: 0.000 loss: -157.939]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.43it/s, atk: -155.346 ent: -2.593 str: 0.000 loss: -157.939]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.43it/s, atk: -173.240 ent: -2.593 str: 0.000 loss: -175.833]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.35it/s, atk: -173.240 ent: -2.593 str: 0.000 loss: -175.833]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.35it/s, atk: -186.636 ent: -2.591 str: 0.000 loss: -189.227]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.37it/s, atk: -186.636 ent: -2.591 str: 0.000 loss: -189.227]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -192.845 ent: -2.589 str: 0.000 loss: -195.434]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -192.845 ent: -2.589 str: 0.000 loss: -195.434]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -192.845 ent: -2.589 str: 0.000 loss: -195.434]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([355], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([850], device='cuda:0') tensor(2.2175e-09, device='cuda:0')
L1: [2000.2981]	L2: [12.938287]	Linf: [0.47058827]

Accuracy on benign examples: 0.0%
gt_label: 1 pred_label: 973 pred_clean_logit 0.00849248468875885
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.37it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.88it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.95it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 20.32it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.32it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.05it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.41it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.33it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.49s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3984
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -55.630 ent: -2.688 str: 0.000 loss: -58.318]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -55.630 ent: -2.688 str: 0.000 loss: -58.318]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -79.376 ent: -2.668 str: 0.000 loss: -82.044]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.24s/it, atk: -79.376 ent: -2.668 str: 0.000 loss: -82.044]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.24s/it, atk: -83.419 ent: -2.649 str: 0.000 loss: -86.068]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.05s/it, atk: -83.419 ent: -2.649 str: 0.000 loss: -86.068]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.05s/it, atk: -95.783 ent: -2.644 str: 0.000 loss: -98.427]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -95.783 ent: -2.644 str: 0.000 loss: -98.427]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -106.629 ent: -2.641 str: 0.000 loss: -109.269]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -106.629 ent: -2.641 str: 0.000 loss: -109.269]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -112.564 ent: -2.636 str: 0.000 loss: -115.200]Iterations:  20%|██        | 6/30 [00:05<00:20,  1.18it/s, atk: -112.564 ent: -2.636 str: 0.000 loss: -115.200]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -132.083 ent: -2.635 str: 0.000 loss: -134.717]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -132.083 ent: -2.635 str: 0.000 loss: -134.717]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -142.031 ent: -2.634 str: 0.000 loss: -144.665]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.29it/s, atk: -142.031 ent: -2.634 str: 0.000 loss: -144.665]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.29it/s, atk: -151.984 ent: -2.634 str: 0.000 loss: -154.619]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -151.984 ent: -2.634 str: 0.000 loss: -154.619]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -161.778 ent: -2.636 str: 0.000 loss: -164.414]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.41it/s, atk: -161.778 ent: -2.636 str: 0.000 loss: -164.414]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.41it/s, atk: -165.894 ent: -2.638 str: 0.000 loss: -168.533]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -165.894 ent: -2.638 str: 0.000 loss: -168.533]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -169.766 ent: -2.637 str: 0.000 loss: -172.402]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.44it/s, atk: -169.766 ent: -2.637 str: 0.000 loss: -172.402]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.44it/s, atk: -182.416 ent: -2.638 str: 0.000 loss: -185.054]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.40it/s, atk: -182.416 ent: -2.638 str: 0.000 loss: -185.054]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.40it/s, atk: -184.981 ent: -2.641 str: 0.000 loss: -187.621]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -184.981 ent: -2.641 str: 0.000 loss: -187.621]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -196.527 ent: -2.637 str: 0.000 loss: -199.164]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -196.527 ent: -2.637 str: 0.000 loss: -199.164]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -200.232 ent: -2.636 str: 0.000 loss: -202.868]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.44it/s, atk: -200.232 ent: -2.636 str: 0.000 loss: -202.868]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -202.953 ent: -2.634 str: 0.000 loss: -205.587]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.42it/s, atk: -202.953 ent: -2.634 str: 0.000 loss: -205.587]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.42it/s, atk: -207.080 ent: -2.633 str: 0.000 loss: -209.713]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.47it/s, atk: -207.080 ent: -2.633 str: 0.000 loss: -209.713]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.47it/s, atk: -214.895 ent: -2.634 str: 0.000 loss: -217.529]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -214.895 ent: -2.634 str: 0.000 loss: -217.529]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -218.316 ent: -2.635 str: 0.000 loss: -220.951]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.51it/s, atk: -218.316 ent: -2.635 str: 0.000 loss: -220.951]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.51it/s, atk: -225.052 ent: -2.635 str: 0.000 loss: -227.687]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -225.052 ent: -2.635 str: 0.000 loss: -227.687]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.45it/s, atk: -230.969 ent: -2.634 str: 0.000 loss: -233.604]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -230.969 ent: -2.634 str: 0.000 loss: -233.604]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.41it/s, atk: -233.822 ent: -2.634 str: 0.000 loss: -236.455]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -233.822 ent: -2.634 str: 0.000 loss: -236.455]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -236.325 ent: -2.634 str: 0.000 loss: -238.959]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -236.325 ent: -2.634 str: 0.000 loss: -238.959]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -241.435 ent: -2.633 str: 0.000 loss: -244.067]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -241.435 ent: -2.633 str: 0.000 loss: -244.067]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -244.770 ent: -2.631 str: 0.000 loss: -247.401]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -244.770 ent: -2.631 str: 0.000 loss: -247.401]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.39it/s, atk: -250.343 ent: -2.631 str: 0.000 loss: -252.974]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.34it/s, atk: -250.343 ent: -2.631 str: 0.000 loss: -252.974]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -253.620 ent: -2.632 str: 0.000 loss: -256.252]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.32it/s, atk: -253.620 ent: -2.632 str: 0.000 loss: -256.252]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.32it/s, atk: -257.837 ent: -2.631 str: 0.000 loss: -260.468]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.31it/s, atk: -257.837 ent: -2.631 str: 0.000 loss: -260.468]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.31it/s, atk: -260.553 ent: -2.631 str: 0.000 loss: -263.184]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -260.553 ent: -2.631 str: 0.000 loss: -263.184]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -260.553 ent: -2.631 str: 0.000 loss: -263.184]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([392], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([1], device='cuda:0') tensor(3.6406e-12, device='cuda:0')
L1: [3307.235]	L2: [21.358849]	Linf: [0.62745094]

Accuracy on benign examples: 100.0%
gt_label: 978 pred_label: 978 pred_clean_logit 0.6886453628540039
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.17it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.85it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.75it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.16it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.89it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.01it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.40it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.75it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.61s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.41s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5094
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -3.854 ent: -5.001 str: 0.000 loss: -8.854]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -3.854 ent: -5.001 str: 0.000 loss: -8.854]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -5.278 ent: -4.985 str: 0.000 loss: -10.263]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.10it/s, atk: -5.278 ent: -4.985 str: 0.000 loss: -10.263]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.10it/s, atk: -6.393 ent: -4.992 str: 0.000 loss: -11.385]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.27it/s, atk: -6.393 ent: -4.992 str: 0.000 loss: -11.385]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.27it/s, atk: -9.186 ent: -4.992 str: 0.000 loss: -14.178]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -9.186 ent: -4.992 str: 0.000 loss: -14.178]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -11.412 ent: -4.988 str: 0.000 loss: -16.400]Iterations:  17%|█▋        | 5/30 [00:03<00:18,  1.33it/s, atk: -11.412 ent: -4.988 str: 0.000 loss: -16.400]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -12.435 ent: -4.984 str: 0.000 loss: -17.419]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.41it/s, atk: -12.435 ent: -4.984 str: 0.000 loss: -17.419]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.41it/s, atk: -14.814 ent: -4.979 str: 0.000 loss: -19.792]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -14.814 ent: -4.979 str: 0.000 loss: -19.792]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -18.150 ent: -4.978 str: 0.000 loss: -23.128]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -18.150 ent: -4.978 str: 0.000 loss: -23.128]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.34it/s, atk: -19.923 ent: -4.978 str: 0.000 loss: -24.901]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.33it/s, atk: -19.923 ent: -4.978 str: 0.000 loss: -24.901]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -23.323 ent: -4.977 str: 0.000 loss: -28.300]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -23.323 ent: -4.977 str: 0.000 loss: -28.300]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -25.296 ent: -4.977 str: 0.000 loss: -30.273]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -25.296 ent: -4.977 str: 0.000 loss: -30.273]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -27.452 ent: -4.975 str: 0.000 loss: -32.427]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -27.452 ent: -4.975 str: 0.000 loss: -32.427]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -29.868 ent: -4.975 str: 0.000 loss: -34.842]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.36it/s, atk: -29.868 ent: -4.975 str: 0.000 loss: -34.842]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.36it/s, atk: -32.400 ent: -4.976 str: 0.000 loss: -37.376]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.41it/s, atk: -32.400 ent: -4.976 str: 0.000 loss: -37.376]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.41it/s, atk: -33.782 ent: -4.978 str: 0.000 loss: -38.760]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.37it/s, atk: -33.782 ent: -4.978 str: 0.000 loss: -38.760]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.37it/s, atk: -36.849 ent: -4.976 str: 0.000 loss: -41.825]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.32it/s, atk: -36.849 ent: -4.976 str: 0.000 loss: -41.825]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.32it/s, atk: -38.574 ent: -4.974 str: 0.000 loss: -43.548]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.37it/s, atk: -38.574 ent: -4.974 str: 0.000 loss: -43.548]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -41.347 ent: -4.976 str: 0.000 loss: -46.323]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -41.347 ent: -4.976 str: 0.000 loss: -46.323]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -43.004 ent: -4.976 str: 0.000 loss: -47.980]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -43.004 ent: -4.976 str: 0.000 loss: -47.980]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -46.430 ent: -4.973 str: 0.000 loss: -51.403]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.38it/s, atk: -46.430 ent: -4.973 str: 0.000 loss: -51.403]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.38it/s, atk: -48.088 ent: -4.973 str: 0.000 loss: -53.061]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.34it/s, atk: -48.088 ent: -4.973 str: 0.000 loss: -53.061]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.34it/s, atk: -51.380 ent: -4.972 str: 0.000 loss: -56.352]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.26it/s, atk: -51.380 ent: -4.972 str: 0.000 loss: -56.352]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.26it/s, atk: -52.990 ent: -4.973 str: 0.000 loss: -57.964]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.31it/s, atk: -52.990 ent: -4.973 str: 0.000 loss: -57.964]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.31it/s, atk: -53.972 ent: -4.973 str: 0.000 loss: -58.945]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.34it/s, atk: -53.972 ent: -4.973 str: 0.000 loss: -58.945]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.34it/s, atk: -56.825 ent: -4.973 str: 0.000 loss: -61.798]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.33it/s, atk: -56.825 ent: -4.973 str: 0.000 loss: -61.798]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.33it/s, atk: -59.038 ent: -4.973 str: 0.000 loss: -64.011]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.30it/s, atk: -59.038 ent: -4.973 str: 0.000 loss: -64.011]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.30it/s, atk: -60.965 ent: -4.972 str: 0.000 loss: -65.937]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -60.965 ent: -4.972 str: 0.000 loss: -65.937]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -62.938 ent: -4.970 str: 0.000 loss: -67.908]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -62.938 ent: -4.970 str: 0.000 loss: -67.908]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -64.625 ent: -4.967 str: 0.000 loss: -69.593]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.33it/s, atk: -64.625 ent: -4.967 str: 0.000 loss: -69.593]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -64.835 ent: -4.966 str: 0.000 loss: -69.801]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -64.835 ent: -4.966 str: 0.000 loss: -69.801]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -64.835 ent: -4.966 str: 0.000 loss: -69.801]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([975], device='cuda:0') tensor(0.8978, device='cuda:0')
after_true: tensor([978], device='cuda:0') tensor(0.0013, device='cuda:0')
L1: [1495.1257]	L2: [13.783838]	Linf: [0.75686276]

Accuracy on benign examples: 100.0%
gt_label: 132 pred_label: 132 pred_clean_logit 0.9417425990104675
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  6.93it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.09it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.24it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.87it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.07it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 20.52it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.92it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.39s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.40s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3067
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.708 ent: -5.912 str: 0.000 loss: -6.620]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.83s/it, atk: -0.708 ent: -5.912 str: 0.000 loss: -6.620]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.83s/it, atk: -1.168 ent: -5.908 str: 0.000 loss: -7.076]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -1.168 ent: -5.908 str: 0.000 loss: -7.076]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -2.749 ent: -5.910 str: 0.000 loss: -8.658]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.13it/s, atk: -2.749 ent: -5.910 str: 0.000 loss: -8.658]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.13it/s, atk: -3.690 ent: -5.889 str: 0.000 loss: -9.579]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.28it/s, atk: -3.690 ent: -5.889 str: 0.000 loss: -9.579]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.28it/s, atk: -7.568 ent: -5.885 str: 0.000 loss: -13.453]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.41it/s, atk: -7.568 ent: -5.885 str: 0.000 loss: -13.453]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.41it/s, atk: -12.855 ent: -5.886 str: 0.000 loss: -18.741]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.51it/s, atk: -12.855 ent: -5.886 str: 0.000 loss: -18.741]Iterations:  20%|██        | 6/30 [00:05<00:15,  1.51it/s, atk: -19.097 ent: -5.888 str: 0.000 loss: -24.985]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.54it/s, atk: -19.097 ent: -5.888 str: 0.000 loss: -24.985]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.54it/s, atk: -23.483 ent: -5.891 str: 0.000 loss: -29.373]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -23.483 ent: -5.891 str: 0.000 loss: -29.373]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -30.770 ent: -5.895 str: 0.000 loss: -36.665]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.51it/s, atk: -30.770 ent: -5.895 str: 0.000 loss: -36.665]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.51it/s, atk: -34.982 ent: -5.900 str: 0.000 loss: -40.882]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.53it/s, atk: -34.982 ent: -5.900 str: 0.000 loss: -40.882]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.53it/s, atk: -39.245 ent: -5.900 str: 0.000 loss: -45.145]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.54it/s, atk: -39.245 ent: -5.900 str: 0.000 loss: -45.145]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.54it/s, atk: -45.321 ent: -5.899 str: 0.000 loss: -51.219]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.46it/s, atk: -45.321 ent: -5.899 str: 0.000 loss: -51.219]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.46it/s, atk: -52.171 ent: -5.897 str: 0.000 loss: -58.068]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.48it/s, atk: -52.171 ent: -5.897 str: 0.000 loss: -58.068]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.48it/s, atk: -57.316 ent: -5.893 str: 0.000 loss: -63.209]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.43it/s, atk: -57.316 ent: -5.893 str: 0.000 loss: -63.209]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.43it/s, atk: -63.760 ent: -5.889 str: 0.000 loss: -69.649]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.44it/s, atk: -63.760 ent: -5.889 str: 0.000 loss: -69.649]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -69.491 ent: -5.885 str: 0.000 loss: -75.376]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.45it/s, atk: -69.491 ent: -5.885 str: 0.000 loss: -75.376]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -77.334 ent: -5.883 str: 0.000 loss: -83.217]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.45it/s, atk: -77.334 ent: -5.883 str: 0.000 loss: -83.217]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.45it/s, atk: -83.704 ent: -5.885 str: 0.000 loss: -89.589]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -83.704 ent: -5.885 str: 0.000 loss: -89.589]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.43it/s, atk: -89.451 ent: -5.883 str: 0.000 loss: -95.334]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.44it/s, atk: -89.451 ent: -5.883 str: 0.000 loss: -95.334]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.44it/s, atk: -94.419 ent: -5.887 str: 0.000 loss: -100.306]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.43it/s, atk: -94.419 ent: -5.887 str: 0.000 loss: -100.306]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.43it/s, atk: -100.530 ent: -5.887 str: 0.000 loss: -106.417]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -100.530 ent: -5.887 str: 0.000 loss: -106.417]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.51it/s, atk: -106.345 ent: -5.886 str: 0.000 loss: -112.232]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.51it/s, atk: -106.345 ent: -5.886 str: 0.000 loss: -112.232]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.51it/s, atk: -112.249 ent: -5.882 str: 0.000 loss: -118.131]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.49it/s, atk: -112.249 ent: -5.882 str: 0.000 loss: -118.131]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.49it/s, atk: -119.053 ent: -5.884 str: 0.000 loss: -124.936]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -119.053 ent: -5.884 str: 0.000 loss: -124.936]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -121.320 ent: -5.882 str: 0.000 loss: -127.201]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.39it/s, atk: -121.320 ent: -5.882 str: 0.000 loss: -127.201]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -128.411 ent: -5.882 str: 0.000 loss: -134.293]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.45it/s, atk: -128.411 ent: -5.882 str: 0.000 loss: -134.293]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.45it/s, atk: -132.860 ent: -5.883 str: 0.000 loss: -138.744]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.41it/s, atk: -132.860 ent: -5.883 str: 0.000 loss: -138.744]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.41it/s, atk: -138.219 ent: -5.886 str: 0.000 loss: -144.104]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.45it/s, atk: -138.219 ent: -5.886 str: 0.000 loss: -144.104]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -144.141 ent: -5.886 str: 0.000 loss: -150.027]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.45it/s, atk: -144.141 ent: -5.886 str: 0.000 loss: -150.027]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -147.875 ent: -5.888 str: 0.000 loss: -153.763]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.47it/s, atk: -147.875 ent: -5.888 str: 0.000 loss: -153.763]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.41it/s, atk: -147.875 ent: -5.888 str: 0.000 loss: -153.763]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([129], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([132], device='cuda:0') tensor(1.9252e-07, device='cuda:0')
L1: [1772.8862]	L2: [13.165106]	Linf: [0.7058823]

Accuracy on benign examples: 100.0%
gt_label: 335 pred_label: 335 pred_clean_logit 0.9727007150650024
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.70it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.75it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.49it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.87it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.46it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.42it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.53it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.00it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.54it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.22s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.35s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2858
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.339 ent: -5.710 str: 0.000 loss: -6.049]Iterations:   3%|▎         | 1/30 [00:01<00:54,  1.90s/it, atk: -0.339 ent: -5.710 str: 0.000 loss: -6.049]Iterations:   3%|▎         | 1/30 [00:02<00:54,  1.90s/it, atk: -1.281 ent: -5.723 str: 0.000 loss: -7.004]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -1.281 ent: -5.723 str: 0.000 loss: -7.004]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -5.463 ent: -5.709 str: 0.000 loss: -11.172]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -5.463 ent: -5.709 str: 0.000 loss: -11.172]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -13.413 ent: -5.708 str: 0.000 loss: -19.121]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.18it/s, atk: -13.413 ent: -5.708 str: 0.000 loss: -19.121]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.18it/s, atk: -13.954 ent: -5.697 str: 0.000 loss: -19.651]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.22it/s, atk: -13.954 ent: -5.697 str: 0.000 loss: -19.651]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.22it/s, atk: -23.402 ent: -5.710 str: 0.000 loss: -29.112]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.22it/s, atk: -23.402 ent: -5.710 str: 0.000 loss: -29.112]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.22it/s, atk: -32.137 ent: -5.710 str: 0.000 loss: -37.846]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -32.137 ent: -5.710 str: 0.000 loss: -37.846]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -41.206 ent: -5.695 str: 0.000 loss: -46.900]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -41.206 ent: -5.695 str: 0.000 loss: -46.900]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -50.551 ent: -5.692 str: 0.000 loss: -56.244]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.25it/s, atk: -50.551 ent: -5.692 str: 0.000 loss: -56.244]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.25it/s, atk: -59.897 ent: -5.695 str: 0.000 loss: -65.592]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.25it/s, atk: -59.897 ent: -5.695 str: 0.000 loss: -65.592]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.25it/s, atk: -65.049 ent: -5.701 str: 0.000 loss: -70.751]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.29it/s, atk: -65.049 ent: -5.701 str: 0.000 loss: -70.751]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.29it/s, atk: -74.311 ent: -5.708 str: 0.000 loss: -80.019]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.24it/s, atk: -74.311 ent: -5.708 str: 0.000 loss: -80.019]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.24it/s, atk: -80.694 ent: -5.706 str: 0.000 loss: -86.400]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.37it/s, atk: -80.694 ent: -5.706 str: 0.000 loss: -86.400]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -89.900 ent: -5.717 str: 0.000 loss: -95.617]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -89.900 ent: -5.717 str: 0.000 loss: -95.617]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.36it/s, atk: -97.370 ent: -5.719 str: 0.000 loss: -103.089]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.30it/s, atk: -97.370 ent: -5.719 str: 0.000 loss: -103.089]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.30it/s, atk: -106.220 ent: -5.722 str: 0.000 loss: -111.942]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.31it/s, atk: -106.220 ent: -5.722 str: 0.000 loss: -111.942]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.31it/s, atk: -111.495 ent: -5.723 str: 0.000 loss: -117.217]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.38it/s, atk: -111.495 ent: -5.723 str: 0.000 loss: -117.217]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.38it/s, atk: -117.088 ent: -5.720 str: 0.000 loss: -122.808]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -117.088 ent: -5.720 str: 0.000 loss: -122.808]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.34it/s, atk: -123.850 ent: -5.719 str: 0.000 loss: -129.569]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.30it/s, atk: -123.850 ent: -5.719 str: 0.000 loss: -129.569]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.30it/s, atk: -130.749 ent: -5.717 str: 0.000 loss: -136.466]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -130.749 ent: -5.717 str: 0.000 loss: -136.466]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -137.229 ent: -5.715 str: 0.000 loss: -142.943]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -137.229 ent: -5.715 str: 0.000 loss: -142.943]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.39it/s, atk: -143.397 ent: -5.715 str: 0.000 loss: -149.112]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -143.397 ent: -5.715 str: 0.000 loss: -149.112]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -149.950 ent: -5.714 str: 0.000 loss: -155.664]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -149.950 ent: -5.714 str: 0.000 loss: -155.664]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.37it/s, atk: -155.734 ent: -5.711 str: 0.000 loss: -161.445]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.39it/s, atk: -155.734 ent: -5.711 str: 0.000 loss: -161.445]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -161.965 ent: -5.714 str: 0.000 loss: -167.678]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -161.965 ent: -5.714 str: 0.000 loss: -167.678]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.41it/s, atk: -167.335 ent: -5.713 str: 0.000 loss: -173.048]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.34it/s, atk: -167.335 ent: -5.713 str: 0.000 loss: -173.048]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.34it/s, atk: -172.269 ent: -5.714 str: 0.000 loss: -177.983]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -172.269 ent: -5.714 str: 0.000 loss: -177.983]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.34it/s, atk: -177.504 ent: -5.714 str: 0.000 loss: -183.217]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -177.504 ent: -5.714 str: 0.000 loss: -183.217]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.35it/s, atk: -182.612 ent: -5.718 str: 0.000 loss: -188.331]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.37it/s, atk: -182.612 ent: -5.718 str: 0.000 loss: -188.331]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.37it/s, atk: -188.283 ent: -5.722 str: 0.000 loss: -194.004]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.41it/s, atk: -188.283 ent: -5.722 str: 0.000 loss: -194.004]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -188.283 ent: -5.722 str: 0.000 loss: -194.004]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([104], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([335], device='cuda:0') tensor(4.5600e-09, device='cuda:0')
L1: [1827.0079]	L2: [11.770879]	Linf: [0.81960785]

Accuracy on benign examples: 100.0%
gt_label: 143 pred_label: 143 pred_clean_logit 0.8915490508079529
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.29it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.35it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.10it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.40it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.12it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.88it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 17.72it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 20.49it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.13it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.35s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3925
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.222 ent: -5.577 str: 0.000 loss: -5.799]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.32s/it, atk: -0.222 ent: -5.577 str: 0.000 loss: -5.799]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.32s/it, atk: -1.378 ent: -5.555 str: 0.000 loss: -6.933]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.03s/it, atk: -1.378 ent: -5.555 str: 0.000 loss: -6.933]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.03s/it, atk: -3.545 ent: -5.542 str: 0.000 loss: -9.087]Iterations:  10%|█         | 3/30 [00:02<00:24,  1.10it/s, atk: -3.545 ent: -5.542 str: 0.000 loss: -9.087]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.10it/s, atk: -8.792 ent: -5.549 str: 0.000 loss: -14.341]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.17it/s, atk: -8.792 ent: -5.549 str: 0.000 loss: -14.341]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.17it/s, atk: -14.419 ent: -5.533 str: 0.000 loss: -19.952]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.20it/s, atk: -14.419 ent: -5.533 str: 0.000 loss: -19.952]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.20it/s, atk: -20.486 ent: -5.520 str: 0.000 loss: -26.007]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.26it/s, atk: -20.486 ent: -5.520 str: 0.000 loss: -26.007]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.26it/s, atk: -27.553 ent: -5.513 str: 0.000 loss: -33.066]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.31it/s, atk: -27.553 ent: -5.513 str: 0.000 loss: -33.066]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -36.584 ent: -5.519 str: 0.000 loss: -42.103]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -36.584 ent: -5.519 str: 0.000 loss: -42.103]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -45.119 ent: -5.519 str: 0.000 loss: -50.638]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.34it/s, atk: -45.119 ent: -5.519 str: 0.000 loss: -50.638]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.34it/s, atk: -53.063 ent: -5.515 str: 0.000 loss: -58.578]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.40it/s, atk: -53.063 ent: -5.515 str: 0.000 loss: -58.578]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -59.482 ent: -5.512 str: 0.000 loss: -64.994]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.42it/s, atk: -59.482 ent: -5.512 str: 0.000 loss: -64.994]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -66.039 ent: -5.515 str: 0.000 loss: -71.554]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -66.039 ent: -5.515 str: 0.000 loss: -71.554]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.41it/s, atk: -71.001 ent: -5.515 str: 0.000 loss: -76.516]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -71.001 ent: -5.515 str: 0.000 loss: -76.516]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -76.910 ent: -5.517 str: 0.000 loss: -82.427]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.47it/s, atk: -76.910 ent: -5.517 str: 0.000 loss: -82.427]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.47it/s, atk: -82.591 ent: -5.517 str: 0.000 loss: -88.108]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -82.591 ent: -5.517 str: 0.000 loss: -88.108]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.44it/s, atk: -87.777 ent: -5.519 str: 0.000 loss: -93.297]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -87.777 ent: -5.519 str: 0.000 loss: -93.297]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -93.718 ent: -5.519 str: 0.000 loss: -99.237]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.42it/s, atk: -93.718 ent: -5.519 str: 0.000 loss: -99.237]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.42it/s, atk: -99.085 ent: -5.517 str: 0.000 loss: -104.602]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -99.085 ent: -5.517 str: 0.000 loss: -104.602]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.42it/s, atk: -103.763 ent: -5.519 str: 0.000 loss: -109.282]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -103.763 ent: -5.519 str: 0.000 loss: -109.282]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -108.382 ent: -5.520 str: 0.000 loss: -113.902]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.37it/s, atk: -108.382 ent: -5.520 str: 0.000 loss: -113.902]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.37it/s, atk: -112.852 ent: -5.521 str: 0.000 loss: -118.373]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.36it/s, atk: -112.852 ent: -5.521 str: 0.000 loss: -118.373]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.36it/s, atk: -118.024 ent: -5.515 str: 0.000 loss: -123.539]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.38it/s, atk: -118.024 ent: -5.515 str: 0.000 loss: -123.539]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.38it/s, atk: -124.039 ent: -5.515 str: 0.000 loss: -129.554]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -124.039 ent: -5.515 str: 0.000 loss: -129.554]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -129.691 ent: -5.513 str: 0.000 loss: -135.204]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.44it/s, atk: -129.691 ent: -5.513 str: 0.000 loss: -135.204]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -134.731 ent: -5.511 str: 0.000 loss: -140.242]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -134.731 ent: -5.511 str: 0.000 loss: -140.242]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.42it/s, atk: -138.792 ent: -5.510 str: 0.000 loss: -144.302]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -138.792 ent: -5.510 str: 0.000 loss: -144.302]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.43it/s, atk: -142.545 ent: -5.512 str: 0.000 loss: -148.057]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -142.545 ent: -5.512 str: 0.000 loss: -148.057]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.42it/s, atk: -146.924 ent: -5.509 str: 0.000 loss: -152.434]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.42it/s, atk: -146.924 ent: -5.509 str: 0.000 loss: -152.434]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -150.539 ent: -5.514 str: 0.000 loss: -156.053]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.47it/s, atk: -150.539 ent: -5.514 str: 0.000 loss: -156.053]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.47it/s, atk: -154.254 ent: -5.519 str: 0.000 loss: -159.773]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.42it/s, atk: -154.254 ent: -5.519 str: 0.000 loss: -159.773]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -154.254 ent: -5.519 str: 0.000 loss: -159.773]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([128], device='cuda:0') tensor(0.9793, device='cuda:0')
after_true: tensor([143], device='cuda:0') tensor(1.1430e-07, device='cuda:0')
L1: [1823.4512]	L2: [14.039069]	Linf: [0.8117647]

Accuracy on benign examples: 0.0%
gt_label: 921 pred_label: 585 pred_clean_logit 0.05675796791911125
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 19.71it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.78it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.72it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.43it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.36it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.38it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 19.92it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.09it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.20s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.28s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.79s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.63s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4768
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -22.616 ent: -5.143 str: 0.000 loss: -27.759]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.46s/it, atk: -22.616 ent: -5.143 str: 0.000 loss: -27.759]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.46s/it, atk: -32.093 ent: -5.129 str: 0.000 loss: -37.222]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -32.093 ent: -5.129 str: 0.000 loss: -37.222]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -46.033 ent: -5.122 str: 0.000 loss: -51.155]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.17it/s, atk: -46.033 ent: -5.122 str: 0.000 loss: -51.155]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.17it/s, atk: -55.283 ent: -5.114 str: 0.000 loss: -60.397]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -55.283 ent: -5.114 str: 0.000 loss: -60.397]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -63.544 ent: -5.111 str: 0.000 loss: -68.655]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.32it/s, atk: -63.544 ent: -5.111 str: 0.000 loss: -68.655]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.32it/s, atk: -75.099 ent: -5.110 str: 0.000 loss: -80.209]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.36it/s, atk: -75.099 ent: -5.110 str: 0.000 loss: -80.209]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -83.343 ent: -5.110 str: 0.000 loss: -88.453]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.33it/s, atk: -83.343 ent: -5.110 str: 0.000 loss: -88.453]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.33it/s, atk: -90.907 ent: -5.108 str: 0.000 loss: -96.015]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -90.907 ent: -5.108 str: 0.000 loss: -96.015]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -99.169 ent: -5.103 str: 0.000 loss: -104.272]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.43it/s, atk: -99.169 ent: -5.103 str: 0.000 loss: -104.272]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.43it/s, atk: -105.724 ent: -5.103 str: 0.000 loss: -110.827]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.45it/s, atk: -105.724 ent: -5.103 str: 0.000 loss: -110.827]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.45it/s, atk: -113.598 ent: -5.101 str: 0.000 loss: -118.699]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -113.598 ent: -5.101 str: 0.000 loss: -118.699]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -120.721 ent: -5.100 str: 0.000 loss: -125.821]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -120.721 ent: -5.100 str: 0.000 loss: -125.821]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -127.693 ent: -5.101 str: 0.000 loss: -132.794]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.42it/s, atk: -127.693 ent: -5.101 str: 0.000 loss: -132.794]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -134.986 ent: -5.102 str: 0.000 loss: -140.088]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.36it/s, atk: -134.986 ent: -5.102 str: 0.000 loss: -140.088]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.36it/s, atk: -143.094 ent: -5.103 str: 0.000 loss: -148.197]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.31it/s, atk: -143.094 ent: -5.103 str: 0.000 loss: -148.197]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.31it/s, atk: -151.290 ent: -5.102 str: 0.000 loss: -156.393]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.36it/s, atk: -151.290 ent: -5.102 str: 0.000 loss: -156.393]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.36it/s, atk: -159.636 ent: -5.100 str: 0.000 loss: -164.736]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.37it/s, atk: -159.636 ent: -5.100 str: 0.000 loss: -164.736]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -166.319 ent: -5.101 str: 0.000 loss: -171.420]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -166.319 ent: -5.101 str: 0.000 loss: -171.420]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.40it/s, atk: -171.162 ent: -5.102 str: 0.000 loss: -176.264]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -171.162 ent: -5.102 str: 0.000 loss: -176.264]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -179.127 ent: -5.099 str: 0.000 loss: -184.226]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.39it/s, atk: -179.127 ent: -5.099 str: 0.000 loss: -184.226]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.39it/s, atk: -185.554 ent: -5.096 str: 0.000 loss: -190.649]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.41it/s, atk: -185.554 ent: -5.096 str: 0.000 loss: -190.649]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -191.365 ent: -5.093 str: 0.000 loss: -196.458]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -191.365 ent: -5.093 str: 0.000 loss: -196.458]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.41it/s, atk: -198.421 ent: -5.092 str: 0.000 loss: -203.513]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.35it/s, atk: -198.421 ent: -5.092 str: 0.000 loss: -203.513]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.35it/s, atk: -206.183 ent: -5.092 str: 0.000 loss: -211.274]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -206.183 ent: -5.092 str: 0.000 loss: -211.274]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -212.897 ent: -5.092 str: 0.000 loss: -217.989]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -212.897 ent: -5.092 str: 0.000 loss: -217.989]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -219.468 ent: -5.091 str: 0.000 loss: -224.559]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -219.468 ent: -5.091 str: 0.000 loss: -224.559]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -225.237 ent: -5.090 str: 0.000 loss: -230.327]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -225.237 ent: -5.090 str: 0.000 loss: -230.327]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -232.019 ent: -5.088 str: 0.000 loss: -237.107]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -232.019 ent: -5.088 str: 0.000 loss: -237.107]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -238.555 ent: -5.087 str: 0.000 loss: -243.642]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -238.555 ent: -5.087 str: 0.000 loss: -243.642]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.48it/s, atk: -244.898 ent: -5.085 str: 0.000 loss: -249.983]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.51it/s, atk: -244.898 ent: -5.085 str: 0.000 loss: -249.983]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.37it/s, atk: -244.898 ent: -5.085 str: 0.000 loss: -249.983]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([585], device='cuda:0') tensor(0.9930, device='cuda:0')
after_true: tensor([921], device='cuda:0') tensor(1.2826e-11, device='cuda:0')
L1: [3436.6355]	L2: [23.647133]	Linf: [0.79607844]

Accuracy on benign examples: 100.0%
gt_label: 562 pred_label: 562 pred_clean_logit 0.9989420771598816
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.96it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.65it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.01it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.00it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.05it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.98it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 16.06it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.61it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.77it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.39s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.55s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5936
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.006 ent: -2.563 str: 0.000 loss: -2.569]Iterations:   3%|▎         | 1/30 [00:01<00:57,  1.97s/it, atk: -0.006 ent: -2.563 str: 0.000 loss: -2.569]Iterations:   3%|▎         | 1/30 [00:02<00:57,  1.97s/it, atk: -0.009 ent: -2.567 str: 0.000 loss: -2.576]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.25s/it, atk: -0.009 ent: -2.567 str: 0.000 loss: -2.576]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.25s/it, atk: -0.025 ent: -2.570 str: 0.000 loss: -2.595]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -0.025 ent: -2.570 str: 0.000 loss: -2.595]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -0.054 ent: -2.574 str: 0.000 loss: -2.628]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -0.054 ent: -2.574 str: 0.000 loss: -2.628]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -0.157 ent: -2.576 str: 0.000 loss: -2.733]Iterations:  17%|█▋        | 5/30 [00:04<00:21,  1.18it/s, atk: -0.157 ent: -2.576 str: 0.000 loss: -2.733]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -0.301 ent: -2.573 str: 0.000 loss: -2.875]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.24it/s, atk: -0.301 ent: -2.573 str: 0.000 loss: -2.875]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.24it/s, atk: -0.542 ent: -2.575 str: 0.000 loss: -3.117]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.23it/s, atk: -0.542 ent: -2.575 str: 0.000 loss: -3.117]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.23it/s, atk: -1.465 ent: -2.574 str: 0.000 loss: -4.039]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -1.465 ent: -2.574 str: 0.000 loss: -4.039]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.27it/s, atk: -3.037 ent: -2.572 str: 0.000 loss: -5.608]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -3.037 ent: -2.572 str: 0.000 loss: -5.608]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.27it/s, atk: -3.295 ent: -2.570 str: 0.000 loss: -5.865]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.26it/s, atk: -3.295 ent: -2.570 str: 0.000 loss: -5.865]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.26it/s, atk: -6.716 ent: -2.570 str: 0.000 loss: -9.286]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -6.716 ent: -2.570 str: 0.000 loss: -9.286]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.36it/s, atk: -14.147 ent: -2.571 str: 0.000 loss: -16.718]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.37it/s, atk: -14.147 ent: -2.571 str: 0.000 loss: -16.718]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.37it/s, atk: -23.490 ent: -2.571 str: 0.000 loss: -26.061]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.36it/s, atk: -23.490 ent: -2.571 str: 0.000 loss: -26.061]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -25.655 ent: -2.571 str: 0.000 loss: -28.227]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.43it/s, atk: -25.655 ent: -2.571 str: 0.000 loss: -28.227]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.43it/s, atk: -28.968 ent: -2.571 str: 0.000 loss: -31.539]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -28.968 ent: -2.571 str: 0.000 loss: -31.539]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -34.258 ent: -2.570 str: 0.000 loss: -36.828]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.36it/s, atk: -34.258 ent: -2.570 str: 0.000 loss: -36.828]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.36it/s, atk: -42.203 ent: -2.569 str: 0.000 loss: -44.771]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.43it/s, atk: -42.203 ent: -2.569 str: 0.000 loss: -44.771]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.43it/s, atk: -47.269 ent: -2.567 str: 0.000 loss: -49.837]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -47.269 ent: -2.567 str: 0.000 loss: -49.837]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -54.625 ent: -2.566 str: 0.000 loss: -57.191]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -54.625 ent: -2.566 str: 0.000 loss: -57.191]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -60.876 ent: -2.565 str: 0.000 loss: -63.441]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -60.876 ent: -2.565 str: 0.000 loss: -63.441]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.49it/s, atk: -66.578 ent: -2.564 str: 0.000 loss: -69.142]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.50it/s, atk: -66.578 ent: -2.564 str: 0.000 loss: -69.142]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.50it/s, atk: -71.818 ent: -2.564 str: 0.000 loss: -74.382]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -71.818 ent: -2.564 str: 0.000 loss: -74.382]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -76.322 ent: -2.563 str: 0.000 loss: -78.885]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.52it/s, atk: -76.322 ent: -2.563 str: 0.000 loss: -78.885]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.52it/s, atk: -83.672 ent: -2.562 str: 0.000 loss: -86.234]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -83.672 ent: -2.562 str: 0.000 loss: -86.234]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.49it/s, atk: -89.093 ent: -2.561 str: 0.000 loss: -91.654]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.52it/s, atk: -89.093 ent: -2.561 str: 0.000 loss: -91.654]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.52it/s, atk: -94.997 ent: -2.561 str: 0.000 loss: -97.558]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.48it/s, atk: -94.997 ent: -2.561 str: 0.000 loss: -97.558]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.48it/s, atk: -100.711 ent: -2.561 str: 0.000 loss: -103.272]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.39it/s, atk: -100.711 ent: -2.561 str: 0.000 loss: -103.272]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.39it/s, atk: -105.097 ent: -2.562 str: 0.000 loss: -107.659]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -105.097 ent: -2.562 str: 0.000 loss: -107.659]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -109.925 ent: -2.562 str: 0.000 loss: -112.487]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -109.925 ent: -2.562 str: 0.000 loss: -112.487]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.33it/s, atk: -114.615 ent: -2.562 str: 0.000 loss: -117.176]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -114.615 ent: -2.562 str: 0.000 loss: -117.176]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -114.615 ent: -2.562 str: 0.000 loss: -117.176]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([819], device='cuda:0') tensor(0.9914, device='cuda:0')
after_true: tensor([562], device='cuda:0') tensor(7.1094e-06, device='cuda:0')
L1: [4707.153]	L2: [33.129536]	Linf: [0.9490196]

Accuracy on benign examples: 100.0%
gt_label: 321 pred_label: 321 pred_clean_logit 0.9903130531311035
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.72it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.21it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.99it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.89it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.51it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.18it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.67it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.95it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.83it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.20s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.28s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5178
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.083 ent: -2.586 str: 0.000 loss: -2.669]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.94s/it, atk: -0.083 ent: -2.586 str: 0.000 loss: -2.669]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.94s/it, atk: -0.249 ent: -2.582 str: 0.000 loss: -2.831]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -0.249 ent: -2.582 str: 0.000 loss: -2.831]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -0.622 ent: -2.576 str: 0.000 loss: -3.199]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.08s/it, atk: -0.622 ent: -2.576 str: 0.000 loss: -3.199]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.08s/it, atk: -1.028 ent: -2.569 str: 0.000 loss: -3.597]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.00it/s, atk: -1.028 ent: -2.569 str: 0.000 loss: -3.597]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.00it/s, atk: -1.941 ent: -2.566 str: 0.000 loss: -4.507]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -1.941 ent: -2.566 str: 0.000 loss: -4.507]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.17it/s, atk: -2.508 ent: -2.563 str: 0.000 loss: -5.072]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.25it/s, atk: -2.508 ent: -2.563 str: 0.000 loss: -5.072]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.25it/s, atk: -4.202 ent: -2.561 str: 0.000 loss: -6.763]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -4.202 ent: -2.561 str: 0.000 loss: -6.763]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.26it/s, atk: -6.661 ent: -2.558 str: 0.000 loss: -9.219]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -6.661 ent: -2.558 str: 0.000 loss: -9.219]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -9.753 ent: -2.557 str: 0.000 loss: -12.310]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.33it/s, atk: -9.753 ent: -2.557 str: 0.000 loss: -12.310]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.33it/s, atk: -12.898 ent: -2.558 str: 0.000 loss: -15.456]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.31it/s, atk: -12.898 ent: -2.558 str: 0.000 loss: -15.456]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.31it/s, atk: -16.824 ent: -2.558 str: 0.000 loss: -19.382]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -16.824 ent: -2.558 str: 0.000 loss: -19.382]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -21.013 ent: -2.558 str: 0.000 loss: -23.571]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -21.013 ent: -2.558 str: 0.000 loss: -23.571]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.45it/s, atk: -24.306 ent: -2.559 str: 0.000 loss: -26.865]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.41it/s, atk: -24.306 ent: -2.559 str: 0.000 loss: -26.865]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.41it/s, atk: -27.639 ent: -2.561 str: 0.000 loss: -30.199]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -27.639 ent: -2.561 str: 0.000 loss: -30.199]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -31.116 ent: -2.562 str: 0.000 loss: -33.679]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.46it/s, atk: -31.116 ent: -2.562 str: 0.000 loss: -33.679]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.46it/s, atk: -34.836 ent: -2.560 str: 0.000 loss: -37.397]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.43it/s, atk: -34.836 ent: -2.560 str: 0.000 loss: -37.397]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.43it/s, atk: -37.803 ent: -2.560 str: 0.000 loss: -40.363]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.46it/s, atk: -37.803 ent: -2.560 str: 0.000 loss: -40.363]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.46it/s, atk: -41.289 ent: -2.558 str: 0.000 loss: -43.847]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -41.289 ent: -2.558 str: 0.000 loss: -43.847]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.41it/s, atk: -44.589 ent: -2.558 str: 0.000 loss: -47.147]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.41it/s, atk: -44.589 ent: -2.558 str: 0.000 loss: -47.147]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.41it/s, atk: -44.738 ent: -2.563 str: 0.000 loss: -47.301]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -44.738 ent: -2.563 str: 0.000 loss: -47.301]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -42.334 ent: -2.563 str: 0.000 loss: -44.896]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -42.334 ent: -2.563 str: 0.000 loss: -44.896]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.40it/s, atk: -40.551 ent: -2.562 str: 0.000 loss: -43.114]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -40.551 ent: -2.562 str: 0.000 loss: -43.114]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.34it/s, atk: -39.837 ent: -2.565 str: 0.000 loss: -42.402]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.30it/s, atk: -39.837 ent: -2.565 str: 0.000 loss: -42.402]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.30it/s, atk: -41.540 ent: -2.566 str: 0.000 loss: -44.105]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.30it/s, atk: -41.540 ent: -2.566 str: 0.000 loss: -44.105]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.30it/s, atk: -43.961 ent: -2.566 str: 0.000 loss: -46.527]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.27it/s, atk: -43.961 ent: -2.566 str: 0.000 loss: -46.527]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.27it/s, atk: -45.766 ent: -2.566 str: 0.000 loss: -48.332]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.28it/s, atk: -45.766 ent: -2.566 str: 0.000 loss: -48.332]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.28it/s, atk: -47.630 ent: -2.566 str: 0.000 loss: -50.196]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.30it/s, atk: -47.630 ent: -2.566 str: 0.000 loss: -50.196]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.30it/s, atk: -50.990 ent: -2.565 str: 0.000 loss: -53.555]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.25it/s, atk: -50.990 ent: -2.565 str: 0.000 loss: -53.555]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.25it/s, atk: -53.412 ent: -2.564 str: 0.000 loss: -55.976]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.27it/s, atk: -53.412 ent: -2.564 str: 0.000 loss: -55.976]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.27it/s, atk: -55.868 ent: -2.563 str: 0.000 loss: -58.431]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.40it/s, atk: -55.868 ent: -2.563 str: 0.000 loss: -58.431]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.29it/s, atk: -55.868 ent: -2.563 str: 0.000 loss: -58.431]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([323], device='cuda:0') tensor(0.9695, device='cuda:0')
after_true: tensor([321], device='cuda:0') tensor(0.0031, device='cuda:0')
L1: [3189.761]	L2: [21.990929]	Linf: [0.79607844]

Accuracy on benign examples: 100.0%
gt_label: 879 pred_label: 879 pred_clean_logit 0.9995773434638977
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:04,  4.15it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:02,  7.94it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 10.24it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 12.90it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 13.95it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.42it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 16.49it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 16.36it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 17.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.26s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.44s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.61s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3925
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.001 ent: -2.597 str: 0.000 loss: -2.598]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.43s/it, atk: -0.001 ent: -2.597 str: 0.000 loss: -2.598]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.43s/it, atk: -0.004 ent: -2.620 str: 0.000 loss: -2.624]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -0.004 ent: -2.620 str: 0.000 loss: -2.624]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -0.013 ent: -2.638 str: 0.000 loss: -2.651]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.16it/s, atk: -0.013 ent: -2.638 str: 0.000 loss: -2.651]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.16it/s, atk: -0.048 ent: -2.650 str: 0.000 loss: -2.699]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.24it/s, atk: -0.048 ent: -2.650 str: 0.000 loss: -2.699]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.24it/s, atk: -0.217 ent: -2.656 str: 0.000 loss: -2.873]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.35it/s, atk: -0.217 ent: -2.656 str: 0.000 loss: -2.873]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.35it/s, atk: -0.122 ent: -2.655 str: 0.000 loss: -2.777]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.31it/s, atk: -0.122 ent: -2.655 str: 0.000 loss: -2.777]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -0.213 ent: -2.653 str: 0.000 loss: -2.866]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.35it/s, atk: -0.213 ent: -2.653 str: 0.000 loss: -2.866]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.35it/s, atk: -0.502 ent: -2.652 str: 0.000 loss: -3.154]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -0.502 ent: -2.652 str: 0.000 loss: -3.154]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.41it/s, atk: -1.547 ent: -2.650 str: 0.000 loss: -4.197]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -1.547 ent: -2.650 str: 0.000 loss: -4.197]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.37it/s, atk: -5.496 ent: -2.652 str: 0.000 loss: -8.147]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.47it/s, atk: -5.496 ent: -2.652 str: 0.000 loss: -8.147]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.47it/s, atk: -11.539 ent: -2.651 str: 0.000 loss: -14.190]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.40it/s, atk: -11.539 ent: -2.651 str: 0.000 loss: -14.190]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.40it/s, atk: -11.907 ent: -2.647 str: 0.000 loss: -14.555]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -11.907 ent: -2.647 str: 0.000 loss: -14.555]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.37it/s, atk: -19.245 ent: -2.647 str: 0.000 loss: -21.892]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.31it/s, atk: -19.245 ent: -2.647 str: 0.000 loss: -21.892]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.31it/s, atk: -25.356 ent: -2.648 str: 0.000 loss: -28.004]Iterations:  47%|████▋     | 14/30 [00:10<00:12,  1.31it/s, atk: -25.356 ent: -2.648 str: 0.000 loss: -28.004]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.31it/s, atk: -30.444 ent: -2.646 str: 0.000 loss: -33.090]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.36it/s, atk: -30.444 ent: -2.646 str: 0.000 loss: -33.090]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.36it/s, atk: -34.266 ent: -2.644 str: 0.000 loss: -36.911]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -34.266 ent: -2.644 str: 0.000 loss: -36.911]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -38.353 ent: -2.644 str: 0.000 loss: -40.998]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.36it/s, atk: -38.353 ent: -2.644 str: 0.000 loss: -40.998]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.36it/s, atk: -42.174 ent: -2.643 str: 0.000 loss: -44.817]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.35it/s, atk: -42.174 ent: -2.643 str: 0.000 loss: -44.817]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.35it/s, atk: -46.035 ent: -2.641 str: 0.000 loss: -48.677]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -46.035 ent: -2.641 str: 0.000 loss: -48.677]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.39it/s, atk: -49.972 ent: -2.641 str: 0.000 loss: -52.613]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.32it/s, atk: -49.972 ent: -2.641 str: 0.000 loss: -52.613]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.32it/s, atk: -53.276 ent: -2.640 str: 0.000 loss: -55.916]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.33it/s, atk: -53.276 ent: -2.640 str: 0.000 loss: -55.916]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.33it/s, atk: -55.866 ent: -2.639 str: 0.000 loss: -58.505]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.33it/s, atk: -55.866 ent: -2.639 str: 0.000 loss: -58.505]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.33it/s, atk: -59.549 ent: -2.639 str: 0.000 loss: -62.188]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.34it/s, atk: -59.549 ent: -2.639 str: 0.000 loss: -62.188]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.34it/s, atk: -62.844 ent: -2.638 str: 0.000 loss: -65.482]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.40it/s, atk: -62.844 ent: -2.638 str: 0.000 loss: -65.482]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.40it/s, atk: -66.865 ent: -2.638 str: 0.000 loss: -69.503]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.39it/s, atk: -66.865 ent: -2.638 str: 0.000 loss: -69.503]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.39it/s, atk: -71.780 ent: -2.637 str: 0.000 loss: -74.417]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.37it/s, atk: -71.780 ent: -2.637 str: 0.000 loss: -74.417]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -76.824 ent: -2.636 str: 0.000 loss: -79.459]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -76.824 ent: -2.636 str: 0.000 loss: -79.459]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.37it/s, atk: -81.438 ent: -2.635 str: 0.000 loss: -84.073]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.40it/s, atk: -81.438 ent: -2.635 str: 0.000 loss: -84.073]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.40it/s, atk: -85.389 ent: -2.634 str: 0.000 loss: -88.023]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.37it/s, atk: -85.389 ent: -2.634 str: 0.000 loss: -88.023]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.37it/s, atk: -87.962 ent: -2.632 str: 0.000 loss: -90.594]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.37it/s, atk: -87.962 ent: -2.632 str: 0.000 loss: -90.594]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.33it/s, atk: -87.962 ent: -2.632 str: 0.000 loss: -90.594]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([974], device='cuda:0') tensor(0.8717, device='cuda:0')
after_true: tensor([879], device='cuda:0') tensor(9.6032e-05, device='cuda:0')
L1: [2131.306]	L2: [14.959862]	Linf: [0.69411767]

Accuracy on benign examples: 100.0%
gt_label: 303 pred_label: 303 pred_clean_logit 0.9704939126968384
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.32it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.35it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.25it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.40it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.94it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.22it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 17.93it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.09it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.67it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.24s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.33s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4448
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.164 ent: -9.830 str: 0.000 loss: -9.994]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.48s/it, atk: -0.164 ent: -9.830 str: 0.000 loss: -9.994]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.48s/it, atk: -0.789 ent: -9.850 str: 0.000 loss: -10.638]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.02s/it, atk: -0.789 ent: -9.850 str: 0.000 loss: -10.638]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.02s/it, atk: -2.537 ent: -9.853 str: 0.000 loss: -12.390]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.18it/s, atk: -2.537 ent: -9.853 str: 0.000 loss: -12.390]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.18it/s, atk: -7.088 ent: -9.842 str: 0.000 loss: -16.930]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -7.088 ent: -9.842 str: 0.000 loss: -16.930]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -13.822 ent: -9.837 str: 0.000 loss: -23.659]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -13.822 ent: -9.837 str: 0.000 loss: -23.659]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -17.312 ent: -9.847 str: 0.000 loss: -27.159]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -17.312 ent: -9.847 str: 0.000 loss: -27.159]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -29.042 ent: -9.844 str: 0.000 loss: -38.885]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.29it/s, atk: -29.042 ent: -9.844 str: 0.000 loss: -38.885]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -41.030 ent: -9.841 str: 0.000 loss: -50.870]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -41.030 ent: -9.841 str: 0.000 loss: -50.870]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -53.452 ent: -9.838 str: 0.000 loss: -63.290]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.32it/s, atk: -53.452 ent: -9.838 str: 0.000 loss: -63.290]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.32it/s, atk: -66.149 ent: -9.834 str: 0.000 loss: -75.983]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -66.149 ent: -9.834 str: 0.000 loss: -75.983]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -78.322 ent: -9.830 str: 0.000 loss: -88.151]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -78.322 ent: -9.830 str: 0.000 loss: -88.151]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.37it/s, atk: -89.804 ent: -9.827 str: 0.000 loss: -99.631]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -89.804 ent: -9.827 str: 0.000 loss: -99.631]Iterations:  40%|████      | 12/30 [00:09<00:13,  1.36it/s, atk: -99.480 ent: -9.820 str: 0.000 loss: -109.300]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.31it/s, atk: -99.480 ent: -9.820 str: 0.000 loss: -109.300]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.31it/s, atk: -107.604 ent: -9.819 str: 0.000 loss: -117.423]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -107.604 ent: -9.819 str: 0.000 loss: -117.423]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.33it/s, atk: -113.881 ent: -9.820 str: 0.000 loss: -123.701]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.26it/s, atk: -113.881 ent: -9.820 str: 0.000 loss: -123.701]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.26it/s, atk: -119.418 ent: -9.812 str: 0.000 loss: -129.229]Iterations:  53%|█████▎    | 16/30 [00:12<00:11,  1.25it/s, atk: -119.418 ent: -9.812 str: 0.000 loss: -129.229]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.25it/s, atk: -121.442 ent: -9.812 str: 0.000 loss: -131.254]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -121.442 ent: -9.812 str: 0.000 loss: -131.254]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.37it/s, atk: -127.676 ent: -9.815 str: 0.000 loss: -137.491]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.36it/s, atk: -127.676 ent: -9.815 str: 0.000 loss: -137.491]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.36it/s, atk: -135.959 ent: -9.813 str: 0.000 loss: -145.772]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.29it/s, atk: -135.959 ent: -9.813 str: 0.000 loss: -145.772]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.29it/s, atk: -143.168 ent: -9.809 str: 0.000 loss: -152.978]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.29it/s, atk: -143.168 ent: -9.809 str: 0.000 loss: -152.978]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.29it/s, atk: -148.099 ent: -9.806 str: 0.000 loss: -157.904]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -148.099 ent: -9.806 str: 0.000 loss: -157.904]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -153.401 ent: -9.805 str: 0.000 loss: -163.206]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -153.401 ent: -9.805 str: 0.000 loss: -163.206]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -158.456 ent: -9.805 str: 0.000 loss: -168.261]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.36it/s, atk: -158.456 ent: -9.805 str: 0.000 loss: -168.261]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.36it/s, atk: -164.245 ent: -9.804 str: 0.000 loss: -174.049]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -164.245 ent: -9.804 str: 0.000 loss: -174.049]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -170.877 ent: -9.803 str: 0.000 loss: -180.680]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.38it/s, atk: -170.877 ent: -9.803 str: 0.000 loss: -180.680]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.38it/s, atk: -176.941 ent: -9.800 str: 0.000 loss: -186.742]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.37it/s, atk: -176.941 ent: -9.800 str: 0.000 loss: -186.742]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -182.238 ent: -9.797 str: 0.000 loss: -192.035]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -182.238 ent: -9.797 str: 0.000 loss: -192.035]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.41it/s, atk: -185.872 ent: -9.797 str: 0.000 loss: -195.669]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -185.872 ent: -9.797 str: 0.000 loss: -195.669]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -189.853 ent: -9.795 str: 0.000 loss: -199.648]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.40it/s, atk: -189.853 ent: -9.795 str: 0.000 loss: -199.648]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.40it/s, atk: -194.452 ent: -9.794 str: 0.000 loss: -204.246]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.43it/s, atk: -194.452 ent: -9.794 str: 0.000 loss: -204.246]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.32it/s, atk: -194.452 ent: -9.794 str: 0.000 loss: -204.246]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([304], device='cuda:0') tensor(0.9980, device='cuda:0')
after_true: tensor([303], device='cuda:0') tensor(2.4458e-09, device='cuda:0')
L1: [2265.196]	L2: [16.347471]	Linf: [0.5882353]

Accuracy on benign examples: 100.0%
gt_label: 355 pred_label: 355 pred_clean_logit 0.9981250166893005
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.40it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 22.90it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 24.03it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.68it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.54it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.23it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.08s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.34s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2092
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -9.454 ent: -2.980 str: 0.000 loss: -12.434]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -9.454 ent: -2.980 str: 0.000 loss: -12.434]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.05s/it, atk: -32.126 ent: -3.005 str: 0.000 loss: -35.131]Iterations:   7%|▋         | 2/30 [00:01<00:24,  1.13it/s, atk: -32.126 ent: -3.005 str: 0.000 loss: -35.131]Iterations:   7%|▋         | 2/30 [00:02<00:24,  1.13it/s, atk: -57.149 ent: -3.002 str: 0.000 loss: -60.151]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.22it/s, atk: -57.149 ent: -3.002 str: 0.000 loss: -60.151]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.22it/s, atk: -74.127 ent: -2.992 str: 0.000 loss: -77.119]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -74.127 ent: -2.992 str: 0.000 loss: -77.119]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -85.315 ent: -2.988 str: 0.000 loss: -88.303]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -85.315 ent: -2.988 str: 0.000 loss: -88.303]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -95.543 ent: -2.983 str: 0.000 loss: -98.526]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.31it/s, atk: -95.543 ent: -2.983 str: 0.000 loss: -98.526]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -106.711 ent: -2.978 str: 0.000 loss: -109.689]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.30it/s, atk: -106.711 ent: -2.978 str: 0.000 loss: -109.689]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -116.824 ent: -2.970 str: 0.000 loss: -119.794]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -116.824 ent: -2.970 str: 0.000 loss: -119.794]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.31it/s, atk: -129.003 ent: -2.966 str: 0.000 loss: -131.969]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.28it/s, atk: -129.003 ent: -2.966 str: 0.000 loss: -131.969]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.28it/s, atk: -138.296 ent: -2.963 str: 0.000 loss: -141.258]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.34it/s, atk: -138.296 ent: -2.963 str: 0.000 loss: -141.258]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.34it/s, atk: -152.750 ent: -2.962 str: 0.000 loss: -155.712]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.39it/s, atk: -152.750 ent: -2.962 str: 0.000 loss: -155.712]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.39it/s, atk: -167.020 ent: -2.963 str: 0.000 loss: -169.983]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -167.020 ent: -2.963 str: 0.000 loss: -169.983]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -176.105 ent: -2.965 str: 0.000 loss: -179.071]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.42it/s, atk: -176.105 ent: -2.965 str: 0.000 loss: -179.071]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -185.564 ent: -2.965 str: 0.000 loss: -188.529]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -185.564 ent: -2.965 str: 0.000 loss: -188.529]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -194.496 ent: -2.963 str: 0.000 loss: -197.459]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -194.496 ent: -2.963 str: 0.000 loss: -197.459]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -200.684 ent: -2.961 str: 0.000 loss: -203.645]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.47it/s, atk: -200.684 ent: -2.961 str: 0.000 loss: -203.645]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.47it/s, atk: -209.368 ent: -2.962 str: 0.000 loss: -212.330]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -209.368 ent: -2.962 str: 0.000 loss: -212.330]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -217.678 ent: -2.961 str: 0.000 loss: -220.639]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -217.678 ent: -2.961 str: 0.000 loss: -220.639]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -226.364 ent: -2.958 str: 0.000 loss: -229.322]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.45it/s, atk: -226.364 ent: -2.958 str: 0.000 loss: -229.322]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.45it/s, atk: -234.349 ent: -2.956 str: 0.000 loss: -237.305]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.45it/s, atk: -234.349 ent: -2.956 str: 0.000 loss: -237.305]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.45it/s, atk: -244.108 ent: -2.954 str: 0.000 loss: -247.062]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -244.108 ent: -2.954 str: 0.000 loss: -247.062]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.45it/s, atk: -253.485 ent: -2.953 str: 0.000 loss: -256.439]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -253.485 ent: -2.953 str: 0.000 loss: -256.439]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -257.664 ent: -2.954 str: 0.000 loss: -260.618]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.44it/s, atk: -257.664 ent: -2.954 str: 0.000 loss: -260.618]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.44it/s, atk: -264.722 ent: -2.953 str: 0.000 loss: -267.675]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.43it/s, atk: -264.722 ent: -2.953 str: 0.000 loss: -267.675]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.43it/s, atk: -274.644 ent: -2.951 str: 0.000 loss: -277.595]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.36it/s, atk: -274.644 ent: -2.951 str: 0.000 loss: -277.595]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.36it/s, atk: -286.452 ent: -2.950 str: 0.000 loss: -289.402]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.37it/s, atk: -286.452 ent: -2.950 str: 0.000 loss: -289.402]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.37it/s, atk: -293.643 ent: -2.949 str: 0.000 loss: -296.592]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.41it/s, atk: -293.643 ent: -2.949 str: 0.000 loss: -296.592]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.41it/s, atk: -301.981 ent: -2.947 str: 0.000 loss: -304.928]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.34it/s, atk: -301.981 ent: -2.947 str: 0.000 loss: -304.928]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.34it/s, atk: -310.068 ent: -2.944 str: 0.000 loss: -313.012]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.36it/s, atk: -310.068 ent: -2.944 str: 0.000 loss: -313.012]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.36it/s, atk: -317.560 ent: -2.943 str: 0.000 loss: -320.503]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -317.560 ent: -2.943 str: 0.000 loss: -320.503]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.38it/s, atk: -317.560 ent: -2.943 str: 0.000 loss: -320.503]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([348], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([355], device='cuda:0') tensor(6.9636e-15, device='cuda:0')
L1: [2525.8706]	L2: [16.035187]	Linf: [0.50980395]

Accuracy on benign examples: 100.0%
gt_label: 436 pred_label: 436 pred_clean_logit 0.9633122682571411
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.95it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.58it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 19.78it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.46it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.23it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.94it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.96it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.22s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.27s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.46s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.50s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5428
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.219 ent: -5.553 str: 0.000 loss: -5.772]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.47s/it, atk: -0.219 ent: -5.553 str: 0.000 loss: -5.772]Iterations:   3%|▎         | 1/30 [00:01<00:42,  1.47s/it, atk: -0.693 ent: -5.561 str: 0.000 loss: -6.254]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.01s/it, atk: -0.693 ent: -5.561 str: 0.000 loss: -6.254]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.01s/it, atk: -2.085 ent: -5.566 str: 0.000 loss: -7.650]Iterations:  10%|█         | 3/30 [00:02<00:24,  1.11it/s, atk: -2.085 ent: -5.566 str: 0.000 loss: -7.650]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.11it/s, atk: -6.794 ent: -5.565 str: 0.000 loss: -12.358]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.15it/s, atk: -6.794 ent: -5.565 str: 0.000 loss: -12.358]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -11.880 ent: -5.570 str: 0.000 loss: -17.449]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.22it/s, atk: -11.880 ent: -5.570 str: 0.000 loss: -17.449]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.22it/s, atk: -19.802 ent: -5.569 str: 0.000 loss: -25.371]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -19.802 ent: -5.569 str: 0.000 loss: -25.371]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -27.039 ent: -5.569 str: 0.000 loss: -32.608]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.40it/s, atk: -27.039 ent: -5.569 str: 0.000 loss: -32.608]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.40it/s, atk: -33.610 ent: -5.567 str: 0.000 loss: -39.178]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.47it/s, atk: -33.610 ent: -5.567 str: 0.000 loss: -39.178]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.47it/s, atk: -40.424 ent: -5.565 str: 0.000 loss: -45.989]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -40.424 ent: -5.565 str: 0.000 loss: -45.989]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -46.343 ent: -5.564 str: 0.000 loss: -51.907]Iterations:  33%|███▎      | 10/30 [00:07<00:14,  1.36it/s, atk: -46.343 ent: -5.564 str: 0.000 loss: -51.907]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.36it/s, atk: -52.653 ent: -5.562 str: 0.000 loss: -58.216]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -52.653 ent: -5.562 str: 0.000 loss: -58.216]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.37it/s, atk: -59.773 ent: -5.560 str: 0.000 loss: -65.333]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -59.773 ent: -5.560 str: 0.000 loss: -65.333]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -65.169 ent: -5.559 str: 0.000 loss: -70.728]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.42it/s, atk: -65.169 ent: -5.559 str: 0.000 loss: -70.728]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.42it/s, atk: -70.806 ent: -5.558 str: 0.000 loss: -76.364]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.39it/s, atk: -70.806 ent: -5.558 str: 0.000 loss: -76.364]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.39it/s, atk: -75.731 ent: -5.556 str: 0.000 loss: -81.288]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -75.731 ent: -5.556 str: 0.000 loss: -81.288]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -80.678 ent: -5.554 str: 0.000 loss: -86.233]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -80.678 ent: -5.554 str: 0.000 loss: -86.233]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.45it/s, atk: -84.587 ent: -5.552 str: 0.000 loss: -90.139]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.44it/s, atk: -84.587 ent: -5.552 str: 0.000 loss: -90.139]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.44it/s, atk: -88.440 ent: -5.551 str: 0.000 loss: -93.991]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.41it/s, atk: -88.440 ent: -5.551 str: 0.000 loss: -93.991]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.41it/s, atk: -92.502 ent: -5.554 str: 0.000 loss: -98.055]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -92.502 ent: -5.554 str: 0.000 loss: -98.055]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.43it/s, atk: -95.638 ent: -5.555 str: 0.000 loss: -101.192]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.44it/s, atk: -95.638 ent: -5.555 str: 0.000 loss: -101.192]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -99.697 ent: -5.553 str: 0.000 loss: -105.250]Iterations:  70%|███████   | 21/30 [00:15<00:07,  1.27it/s, atk: -99.697 ent: -5.553 str: 0.000 loss: -105.250]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.27it/s, atk: -103.043 ent: -5.552 str: 0.000 loss: -108.595]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.31it/s, atk: -103.043 ent: -5.552 str: 0.000 loss: -108.595]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.31it/s, atk: -106.524 ent: -5.552 str: 0.000 loss: -112.076]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -106.524 ent: -5.552 str: 0.000 loss: -112.076]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.37it/s, atk: -109.478 ent: -5.554 str: 0.000 loss: -115.032]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -109.478 ent: -5.554 str: 0.000 loss: -115.032]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.41it/s, atk: -113.427 ent: -5.552 str: 0.000 loss: -118.978]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -113.427 ent: -5.552 str: 0.000 loss: -118.978]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.41it/s, atk: -117.099 ent: -5.548 str: 0.000 loss: -122.648]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -117.099 ent: -5.548 str: 0.000 loss: -122.648]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.39it/s, atk: -119.848 ent: -5.546 str: 0.000 loss: -125.394]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -119.848 ent: -5.546 str: 0.000 loss: -125.394]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -123.764 ent: -5.545 str: 0.000 loss: -129.309]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.33it/s, atk: -123.764 ent: -5.545 str: 0.000 loss: -129.309]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.33it/s, atk: -126.781 ent: -5.544 str: 0.000 loss: -132.325]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.38it/s, atk: -126.781 ent: -5.544 str: 0.000 loss: -132.325]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.38it/s, atk: -129.632 ent: -5.543 str: 0.000 loss: -135.175]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -129.632 ent: -5.543 str: 0.000 loss: -135.175]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -129.632 ent: -5.543 str: 0.000 loss: -135.175]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([656], device='cuda:0') tensor(0.9986, device='cuda:0')
after_true: tensor([436], device='cuda:0') tensor(1.8128e-06, device='cuda:0')
L1: [3221.2512]	L2: [23.156382]	Linf: [0.7490196]

Accuracy on benign examples: 100.0%
gt_label: 99 pred_label: 99 pred_clean_logit 0.9855273962020874
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.25it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.97it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.80it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 13.71it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 13.70it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 13.61it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 15.10it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 17.40it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.31it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.54s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.66s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2966
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.593 ent: -2.759 str: 0.000 loss: -3.352]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.73s/it, atk: -0.593 ent: -2.759 str: 0.000 loss: -3.352]Iterations:   3%|▎         | 1/30 [00:02<00:50,  1.73s/it, atk: -2.828 ent: -2.741 str: 0.000 loss: -5.569]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -2.828 ent: -2.741 str: 0.000 loss: -5.569]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.08s/it, atk: -14.981 ent: -2.730 str: 0.000 loss: -17.711]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.13it/s, atk: -14.981 ent: -2.730 str: 0.000 loss: -17.711]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.13it/s, atk: -33.317 ent: -2.717 str: 0.000 loss: -36.034]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -33.317 ent: -2.717 str: 0.000 loss: -36.034]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -55.420 ent: -2.706 str: 0.000 loss: -58.126]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -55.420 ent: -2.706 str: 0.000 loss: -58.126]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -69.840 ent: -2.696 str: 0.000 loss: -72.536]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -69.840 ent: -2.696 str: 0.000 loss: -72.536]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -78.057 ent: -2.689 str: 0.000 loss: -80.745]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.35it/s, atk: -78.057 ent: -2.689 str: 0.000 loss: -80.745]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -88.977 ent: -2.687 str: 0.000 loss: -91.663]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.38it/s, atk: -88.977 ent: -2.687 str: 0.000 loss: -91.663]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.38it/s, atk: -99.627 ent: -2.688 str: 0.000 loss: -102.315]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -99.627 ent: -2.688 str: 0.000 loss: -102.315]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.39it/s, atk: -111.483 ent: -2.689 str: 0.000 loss: -114.172]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.33it/s, atk: -111.483 ent: -2.689 str: 0.000 loss: -114.172]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.33it/s, atk: -122.541 ent: -2.691 str: 0.000 loss: -125.233]Iterations:  37%|███▋      | 11/30 [00:08<00:14,  1.30it/s, atk: -122.541 ent: -2.691 str: 0.000 loss: -125.233]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.30it/s, atk: -134.282 ent: -2.693 str: 0.000 loss: -136.975]Iterations:  40%|████      | 12/30 [00:09<00:14,  1.27it/s, atk: -134.282 ent: -2.693 str: 0.000 loss: -136.975]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.27it/s, atk: -145.321 ent: -2.693 str: 0.000 loss: -148.014]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -145.321 ent: -2.693 str: 0.000 loss: -148.014]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.32it/s, atk: -150.687 ent: -2.693 str: 0.000 loss: -153.380]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -150.687 ent: -2.693 str: 0.000 loss: -153.380]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -162.653 ent: -2.692 str: 0.000 loss: -165.345]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.41it/s, atk: -162.653 ent: -2.692 str: 0.000 loss: -165.345]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -167.230 ent: -2.691 str: 0.000 loss: -169.921]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.33it/s, atk: -167.230 ent: -2.691 str: 0.000 loss: -169.921]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.33it/s, atk: -171.743 ent: -2.692 str: 0.000 loss: -174.436]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -171.743 ent: -2.692 str: 0.000 loss: -174.436]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.40it/s, atk: -176.001 ent: -2.693 str: 0.000 loss: -178.694]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.37it/s, atk: -176.001 ent: -2.693 str: 0.000 loss: -178.694]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.37it/s, atk: -182.586 ent: -2.694 str: 0.000 loss: -185.280]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -182.586 ent: -2.694 str: 0.000 loss: -185.280]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.35it/s, atk: -187.563 ent: -2.694 str: 0.000 loss: -190.256]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -187.563 ent: -2.694 str: 0.000 loss: -190.256]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.44it/s, atk: -194.824 ent: -2.692 str: 0.000 loss: -197.516]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -194.824 ent: -2.692 str: 0.000 loss: -197.516]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.43it/s, atk: -201.451 ent: -2.691 str: 0.000 loss: -204.143]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.36it/s, atk: -201.451 ent: -2.691 str: 0.000 loss: -204.143]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.36it/s, atk: -208.676 ent: -2.691 str: 0.000 loss: -211.366]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.43it/s, atk: -208.676 ent: -2.691 str: 0.000 loss: -211.366]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.43it/s, atk: -215.757 ent: -2.690 str: 0.000 loss: -218.447]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -215.757 ent: -2.690 str: 0.000 loss: -218.447]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.44it/s, atk: -222.943 ent: -2.689 str: 0.000 loss: -225.631]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.48it/s, atk: -222.943 ent: -2.689 str: 0.000 loss: -225.631]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.48it/s, atk: -226.652 ent: -2.687 str: 0.000 loss: -229.340]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.44it/s, atk: -226.652 ent: -2.687 str: 0.000 loss: -229.340]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.44it/s, atk: -231.483 ent: -2.688 str: 0.000 loss: -234.171]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -231.483 ent: -2.688 str: 0.000 loss: -234.171]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -235.759 ent: -2.688 str: 0.000 loss: -238.447]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.46it/s, atk: -235.759 ent: -2.688 str: 0.000 loss: -238.447]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.46it/s, atk: -241.294 ent: -2.688 str: 0.000 loss: -243.982]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -241.294 ent: -2.688 str: 0.000 loss: -243.982]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.42it/s, atk: -247.917 ent: -2.688 str: 0.000 loss: -250.606]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.46it/s, atk: -247.917 ent: -2.688 str: 0.000 loss: -250.606]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.34it/s, atk: -247.917 ent: -2.688 str: 0.000 loss: -250.606]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([266], device='cuda:0') tensor(0.7013, device='cuda:0')
after_true: tensor([99], device='cuda:0') tensor(1.0040e-11, device='cuda:0')
L1: [2973.7175]	L2: [19.625378]	Linf: [0.70980394]

Accuracy on benign examples: 100.0%
gt_label: 919 pred_label: 919 pred_clean_logit 0.8463060259819031
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.17it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.46it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.33it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.65it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.31it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.95it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 14.04it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.75it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.99s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.56s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.51s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5210
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.730 ent: -4.851 str: 0.000 loss: -6.581]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -1.730 ent: -4.851 str: 0.000 loss: -6.581]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -1.894 ent: -4.839 str: 0.000 loss: -6.733]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.25s/it, atk: -1.894 ent: -4.839 str: 0.000 loss: -6.733]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.25s/it, atk: -3.319 ent: -4.843 str: 0.000 loss: -8.162]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -3.319 ent: -4.843 str: 0.000 loss: -8.162]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -3.929 ent: -4.839 str: 0.000 loss: -8.768]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -3.929 ent: -4.839 str: 0.000 loss: -8.768]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -5.054 ent: -4.845 str: 0.000 loss: -9.899]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.28it/s, atk: -5.054 ent: -4.845 str: 0.000 loss: -9.899]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.28it/s, atk: -5.412 ent: -4.830 str: 0.000 loss: -10.241]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -5.412 ent: -4.830 str: 0.000 loss: -10.241]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -6.776 ent: -4.828 str: 0.000 loss: -11.605]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -6.776 ent: -4.828 str: 0.000 loss: -11.605]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.49it/s, atk: -8.641 ent: -4.830 str: 0.000 loss: -13.471]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -8.641 ent: -4.830 str: 0.000 loss: -13.471]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -10.592 ent: -4.835 str: 0.000 loss: -15.427]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.57it/s, atk: -10.592 ent: -4.835 str: 0.000 loss: -15.427]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.57it/s, atk: -13.267 ent: -4.837 str: 0.000 loss: -18.103]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.58it/s, atk: -13.267 ent: -4.837 str: 0.000 loss: -18.103]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.58it/s, atk: -15.585 ent: -4.838 str: 0.000 loss: -20.424]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.47it/s, atk: -15.585 ent: -4.838 str: 0.000 loss: -20.424]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.47it/s, atk: -19.752 ent: -4.840 str: 0.000 loss: -24.591]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.52it/s, atk: -19.752 ent: -4.840 str: 0.000 loss: -24.591]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.52it/s, atk: -23.028 ent: -4.841 str: 0.000 loss: -27.869]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -23.028 ent: -4.841 str: 0.000 loss: -27.869]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -28.623 ent: -4.841 str: 0.000 loss: -33.464]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.48it/s, atk: -28.623 ent: -4.841 str: 0.000 loss: -33.464]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.48it/s, atk: -34.421 ent: -4.840 str: 0.000 loss: -39.260]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.34it/s, atk: -34.421 ent: -4.840 str: 0.000 loss: -39.260]Iterations:  50%|█████     | 15/30 [00:11<00:11,  1.34it/s, atk: -39.685 ent: -4.839 str: 0.000 loss: -44.524]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -39.685 ent: -4.839 str: 0.000 loss: -44.524]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.39it/s, atk: -51.405 ent: -4.840 str: 0.000 loss: -56.244]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.41it/s, atk: -51.405 ent: -4.840 str: 0.000 loss: -56.244]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -60.913 ent: -4.842 str: 0.000 loss: -65.756]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.44it/s, atk: -60.913 ent: -4.842 str: 0.000 loss: -65.756]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -68.628 ent: -4.846 str: 0.000 loss: -73.474]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.30it/s, atk: -68.628 ent: -4.846 str: 0.000 loss: -73.474]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.30it/s, atk: -73.655 ent: -4.845 str: 0.000 loss: -78.500]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.32it/s, atk: -73.655 ent: -4.845 str: 0.000 loss: -78.500]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.32it/s, atk: -79.488 ent: -4.848 str: 0.000 loss: -84.336]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.31it/s, atk: -79.488 ent: -4.848 str: 0.000 loss: -84.336]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.31it/s, atk: -96.171 ent: -4.848 str: 0.000 loss: -101.019]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.31it/s, atk: -96.171 ent: -4.848 str: 0.000 loss: -101.019]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.31it/s, atk: -105.390 ent: -4.844 str: 0.000 loss: -110.233]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.38it/s, atk: -105.390 ent: -4.844 str: 0.000 loss: -110.233]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.38it/s, atk: -114.143 ent: -4.842 str: 0.000 loss: -118.985]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.35it/s, atk: -114.143 ent: -4.842 str: 0.000 loss: -118.985]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.35it/s, atk: -112.051 ent: -4.843 str: 0.000 loss: -116.894]Iterations:  83%|████████▎ | 25/30 [00:19<00:04,  1.23it/s, atk: -112.051 ent: -4.843 str: 0.000 loss: -116.894]Iterations:  83%|████████▎ | 25/30 [00:19<00:04,  1.23it/s, atk: -100.362 ent: -4.842 str: 0.000 loss: -105.204]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.24it/s, atk: -100.362 ent: -4.842 str: 0.000 loss: -105.204]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.24it/s, atk: -99.874 ent: -4.843 str: 0.000 loss: -104.717] Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.19it/s, atk: -99.874 ent: -4.843 str: 0.000 loss: -104.717]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.19it/s, atk: -106.517 ent: -4.839 str: 0.000 loss: -111.356]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.17it/s, atk: -106.517 ent: -4.839 str: 0.000 loss: -111.356]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.17it/s, atk: -113.124 ent: -4.836 str: 0.000 loss: -117.960]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.13it/s, atk: -113.124 ent: -4.836 str: 0.000 loss: -117.960]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.13it/s, atk: -119.072 ent: -4.838 str: 0.000 loss: -123.910]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.12it/s, atk: -119.072 ent: -4.838 str: 0.000 loss: -123.910]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -119.072 ent: -4.838 str: 0.000 loss: -123.910]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([519], device='cuda:0') tensor(0.9977, device='cuda:0')
after_true: tensor([919], device='cuda:0') tensor(2.9743e-06, device='cuda:0')
L1: [2623.6194]	L2: [19.262161]	Linf: [0.9882353]

Accuracy on benign examples: 100.0%
gt_label: 283 pred_label: 283 pred_clean_logit 0.9998476505279541
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.85it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.28it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.84it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.91it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.56it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.29it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.10it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.36s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.29s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5407
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -4.765 str: 0.000 loss: -4.767]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.27s/it, atk: -0.003 ent: -4.765 str: 0.000 loss: -4.767]Iterations:   3%|▎         | 1/30 [00:02<01:05,  2.27s/it, atk: -0.002 ent: -4.829 str: 0.000 loss: -4.831]Iterations:   7%|▋         | 2/30 [00:02<00:36,  1.29s/it, atk: -0.002 ent: -4.829 str: 0.000 loss: -4.831]Iterations:   7%|▋         | 2/30 [00:03<00:36,  1.29s/it, atk: -0.003 ent: -4.880 str: 0.000 loss: -4.883]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.003 ent: -4.880 str: 0.000 loss: -4.883]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.01s/it, atk: -0.007 ent: -4.922 str: 0.000 loss: -4.929]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -0.007 ent: -4.922 str: 0.000 loss: -4.929]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.06it/s, atk: -0.008 ent: -4.964 str: 0.000 loss: -4.973]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.20it/s, atk: -0.008 ent: -4.964 str: 0.000 loss: -4.973]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.20it/s, atk: -0.016 ent: -4.998 str: 0.000 loss: -5.014]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.33it/s, atk: -0.016 ent: -4.998 str: 0.000 loss: -5.014]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.33it/s, atk: -0.068 ent: -5.018 str: 0.000 loss: -5.086]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -0.068 ent: -5.018 str: 0.000 loss: -5.086]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -0.222 ent: -5.021 str: 0.000 loss: -5.243]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -0.222 ent: -5.021 str: 0.000 loss: -5.243]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -0.697 ent: -5.016 str: 0.000 loss: -5.712]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.31it/s, atk: -0.697 ent: -5.016 str: 0.000 loss: -5.712]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.31it/s, atk: -2.968 ent: -5.014 str: 0.000 loss: -7.982]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -2.968 ent: -5.014 str: 0.000 loss: -7.982]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -7.775 ent: -5.009 str: 0.000 loss: -12.784]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -7.775 ent: -5.009 str: 0.000 loss: -12.784]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.46it/s, atk: -10.891 ent: -5.001 str: 0.000 loss: -15.893]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.47it/s, atk: -10.891 ent: -5.001 str: 0.000 loss: -15.893]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.47it/s, atk: -18.868 ent: -5.000 str: 0.000 loss: -23.868]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -18.868 ent: -5.000 str: 0.000 loss: -23.868]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -22.951 ent: -5.001 str: 0.000 loss: -27.952]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -22.951 ent: -5.001 str: 0.000 loss: -27.952]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -29.281 ent: -5.003 str: 0.000 loss: -34.284]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.54it/s, atk: -29.281 ent: -5.003 str: 0.000 loss: -34.284]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.54it/s, atk: -34.307 ent: -4.998 str: 0.000 loss: -39.306]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -34.307 ent: -4.998 str: 0.000 loss: -39.306]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.52it/s, atk: -42.389 ent: -5.000 str: 0.000 loss: -47.388]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -42.389 ent: -5.000 str: 0.000 loss: -47.388]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -47.048 ent: -4.995 str: 0.000 loss: -52.043]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.38it/s, atk: -47.048 ent: -4.995 str: 0.000 loss: -52.043]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.38it/s, atk: -53.563 ent: -4.992 str: 0.000 loss: -58.555]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.35it/s, atk: -53.563 ent: -4.992 str: 0.000 loss: -58.555]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.35it/s, atk: -60.743 ent: -4.990 str: 0.000 loss: -65.733]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -60.743 ent: -4.990 str: 0.000 loss: -65.733]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -66.106 ent: -4.986 str: 0.000 loss: -71.092]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -66.106 ent: -4.986 str: 0.000 loss: -71.092]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -71.535 ent: -4.984 str: 0.000 loss: -76.519]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.43it/s, atk: -71.535 ent: -4.984 str: 0.000 loss: -76.519]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.43it/s, atk: -77.512 ent: -4.983 str: 0.000 loss: -82.495]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -77.512 ent: -4.983 str: 0.000 loss: -82.495]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.49it/s, atk: -82.843 ent: -4.980 str: 0.000 loss: -87.823]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.50it/s, atk: -82.843 ent: -4.980 str: 0.000 loss: -87.823]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.50it/s, atk: -87.294 ent: -4.980 str: 0.000 loss: -92.275]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.47it/s, atk: -87.294 ent: -4.980 str: 0.000 loss: -92.275]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.47it/s, atk: -90.377 ent: -4.978 str: 0.000 loss: -95.355]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -90.377 ent: -4.978 str: 0.000 loss: -95.355]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -94.827 ent: -4.978 str: 0.000 loss: -99.804]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -94.827 ent: -4.978 str: 0.000 loss: -99.804]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.47it/s, atk: -97.162 ent: -4.978 str: 0.000 loss: -102.140]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.47it/s, atk: -97.162 ent: -4.978 str: 0.000 loss: -102.140]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.47it/s, atk: -99.270 ent: -4.975 str: 0.000 loss: -104.246]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -99.270 ent: -4.975 str: 0.000 loss: -104.246]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.49it/s, atk: -103.814 ent: -4.977 str: 0.000 loss: -108.791]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.53it/s, atk: -103.814 ent: -4.977 str: 0.000 loss: -108.791]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.36it/s, atk: -103.814 ent: -4.977 str: 0.000 loss: -108.791]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([285], device='cuda:0') tensor(0.9624, device='cuda:0')
after_true: tensor([283], device='cuda:0') tensor(2.2272e-05, device='cuda:0')
L1: [2948.7295]	L2: [17.971098]	Linf: [0.454902]

Accuracy on benign examples: 100.0%
gt_label: 541 pred_label: 541 pred_clean_logit 0.5553991794586182
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 11.46it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.90it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.42it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.24it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 14.68it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.99it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.75it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.57s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.49s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.59s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.88s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4422
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -2.461 ent: -2.606 str: 0.000 loss: -5.067]Iterations:   3%|▎         | 1/30 [00:02<01:21,  2.81s/it, atk: -2.461 ent: -2.606 str: 0.000 loss: -5.067]Iterations:   3%|▎         | 1/30 [00:03<01:21,  2.81s/it, atk: -13.586 ent: -2.609 str: 0.000 loss: -16.195]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.55s/it, atk: -13.586 ent: -2.609 str: 0.000 loss: -16.195]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.55s/it, atk: -27.539 ent: -2.616 str: 0.000 loss: -30.155]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -27.539 ent: -2.616 str: 0.000 loss: -30.155]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -52.431 ent: -2.616 str: 0.000 loss: -55.048]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.01it/s, atk: -52.431 ent: -2.616 str: 0.000 loss: -55.048]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.01it/s, atk: -62.456 ent: -2.613 str: 0.000 loss: -65.068]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.09it/s, atk: -62.456 ent: -2.613 str: 0.000 loss: -65.068]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.09it/s, atk: -77.039 ent: -2.607 str: 0.000 loss: -79.646]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -77.039 ent: -2.607 str: 0.000 loss: -79.646]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.18it/s, atk: -81.717 ent: -2.601 str: 0.000 loss: -84.318]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -81.717 ent: -2.601 str: 0.000 loss: -84.318]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -87.854 ent: -2.598 str: 0.000 loss: -90.452]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -87.854 ent: -2.598 str: 0.000 loss: -90.452]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.33it/s, atk: -88.978 ent: -2.599 str: 0.000 loss: -91.577]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -88.978 ent: -2.599 str: 0.000 loss: -91.577]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.35it/s, atk: -94.921 ent: -2.598 str: 0.000 loss: -97.520]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -94.921 ent: -2.598 str: 0.000 loss: -97.520]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.33it/s, atk: -94.205 ent: -2.597 str: 0.000 loss: -96.803]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.33it/s, atk: -94.205 ent: -2.597 str: 0.000 loss: -96.803]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.33it/s, atk: -104.463 ent: -2.597 str: 0.000 loss: -107.060]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.34it/s, atk: -104.463 ent: -2.597 str: 0.000 loss: -107.060]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.34it/s, atk: -108.961 ent: -2.596 str: 0.000 loss: -111.556]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -108.961 ent: -2.596 str: 0.000 loss: -111.556]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -111.875 ent: -2.595 str: 0.000 loss: -114.470]Iterations:  47%|████▋     | 14/30 [00:12<00:10,  1.47it/s, atk: -111.875 ent: -2.595 str: 0.000 loss: -114.470]Iterations:  47%|████▋     | 14/30 [00:12<00:10,  1.47it/s, atk: -114.205 ent: -2.597 str: 0.000 loss: -116.801]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -114.205 ent: -2.597 str: 0.000 loss: -116.801]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.40it/s, atk: -117.608 ent: -2.597 str: 0.000 loss: -120.205]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -117.608 ent: -2.597 str: 0.000 loss: -120.205]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -122.709 ent: -2.598 str: 0.000 loss: -125.307]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.47it/s, atk: -122.709 ent: -2.598 str: 0.000 loss: -125.307]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.47it/s, atk: -126.577 ent: -2.598 str: 0.000 loss: -129.175]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -126.577 ent: -2.598 str: 0.000 loss: -129.175]Iterations:  60%|██████    | 18/30 [00:15<00:07,  1.52it/s, atk: -131.308 ent: -2.600 str: 0.000 loss: -133.908]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -131.308 ent: -2.600 str: 0.000 loss: -133.908]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.44it/s, atk: -135.702 ent: -2.600 str: 0.000 loss: -138.302]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.49it/s, atk: -135.702 ent: -2.600 str: 0.000 loss: -138.302]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.49it/s, atk: -140.060 ent: -2.599 str: 0.000 loss: -142.659]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.58it/s, atk: -140.060 ent: -2.599 str: 0.000 loss: -142.659]Iterations:  70%|███████   | 21/30 [00:17<00:05,  1.58it/s, atk: -144.150 ent: -2.598 str: 0.000 loss: -146.748]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.58it/s, atk: -144.150 ent: -2.598 str: 0.000 loss: -146.748]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.58it/s, atk: -148.047 ent: -2.598 str: 0.000 loss: -150.645]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.50it/s, atk: -148.047 ent: -2.598 str: 0.000 loss: -150.645]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.50it/s, atk: -150.855 ent: -2.598 str: 0.000 loss: -153.453]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.48it/s, atk: -150.855 ent: -2.598 str: 0.000 loss: -153.453]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.48it/s, atk: -154.037 ent: -2.598 str: 0.000 loss: -156.635]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -154.037 ent: -2.598 str: 0.000 loss: -156.635]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.45it/s, atk: -159.923 ent: -2.597 str: 0.000 loss: -162.520]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -159.923 ent: -2.597 str: 0.000 loss: -162.520]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.44it/s, atk: -161.458 ent: -2.596 str: 0.000 loss: -164.054]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -161.458 ent: -2.596 str: 0.000 loss: -164.054]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.43it/s, atk: -166.840 ent: -2.596 str: 0.000 loss: -169.436]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.41it/s, atk: -166.840 ent: -2.596 str: 0.000 loss: -169.436]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.41it/s, atk: -169.930 ent: -2.596 str: 0.000 loss: -172.526]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.39it/s, atk: -169.930 ent: -2.596 str: 0.000 loss: -172.526]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.39it/s, atk: -174.295 ent: -2.595 str: 0.000 loss: -176.890]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.44it/s, atk: -174.295 ent: -2.595 str: 0.000 loss: -176.890]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -174.295 ent: -2.595 str: 0.000 loss: -176.890]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([555], device='cuda:0') tensor(0.8610, device='cuda:0')
after_true: tensor([541], device='cuda:0') tensor(1.9745e-08, device='cuda:0')
L1: [5117.0938]	L2: [32.71083]	Linf: [0.78039217]

Accuracy on benign examples: 100.0%
gt_label: 317 pred_label: 317 pred_clean_logit 0.40864115953445435
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.91it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 20.73it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 20.36it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.67it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.83it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 12.31it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.66it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.36s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.17s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.27s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.39s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.43s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3694
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -5.220 ent: -5.149 str: 0.000 loss: -10.369]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.67s/it, atk: -5.220 ent: -5.149 str: 0.000 loss: -10.369]Iterations:   3%|▎         | 1/30 [00:02<00:48,  1.67s/it, atk: -16.484 ent: -5.158 str: 0.000 loss: -21.642]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -16.484 ent: -5.158 str: 0.000 loss: -21.642]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -29.086 ent: -5.156 str: 0.000 loss: -34.242]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.19it/s, atk: -29.086 ent: -5.156 str: 0.000 loss: -34.242]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.19it/s, atk: -39.458 ent: -5.147 str: 0.000 loss: -44.605]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -39.458 ent: -5.147 str: 0.000 loss: -44.605]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -47.849 ent: -5.135 str: 0.000 loss: -52.984]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -47.849 ent: -5.135 str: 0.000 loss: -52.984]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.33it/s, atk: -57.994 ent: -5.144 str: 0.000 loss: -63.137]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.48it/s, atk: -57.994 ent: -5.144 str: 0.000 loss: -63.137]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.48it/s, atk: -67.891 ent: -5.148 str: 0.000 loss: -73.039]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.57it/s, atk: -67.891 ent: -5.148 str: 0.000 loss: -73.039]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.57it/s, atk: -72.957 ent: -5.155 str: 0.000 loss: -78.112]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.63it/s, atk: -72.957 ent: -5.155 str: 0.000 loss: -78.112]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.63it/s, atk: -75.047 ent: -5.153 str: 0.000 loss: -80.200]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.61it/s, atk: -75.047 ent: -5.153 str: 0.000 loss: -80.200]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.61it/s, atk: -88.754 ent: -5.154 str: 0.000 loss: -93.908]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -88.754 ent: -5.154 str: 0.000 loss: -93.908]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -98.928 ent: -5.154 str: 0.000 loss: -104.082]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.64it/s, atk: -98.928 ent: -5.154 str: 0.000 loss: -104.082]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.64it/s, atk: -107.685 ent: -5.147 str: 0.000 loss: -112.833]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.67it/s, atk: -107.685 ent: -5.147 str: 0.000 loss: -112.833]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.67it/s, atk: -117.270 ent: -5.146 str: 0.000 loss: -122.416]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.62it/s, atk: -117.270 ent: -5.146 str: 0.000 loss: -122.416]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.62it/s, atk: -124.945 ent: -5.140 str: 0.000 loss: -130.085]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.66it/s, atk: -124.945 ent: -5.140 str: 0.000 loss: -130.085]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.66it/s, atk: -133.826 ent: -5.138 str: 0.000 loss: -138.964]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.57it/s, atk: -133.826 ent: -5.138 str: 0.000 loss: -138.964]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.57it/s, atk: -142.417 ent: -5.136 str: 0.000 loss: -147.553]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.62it/s, atk: -142.417 ent: -5.136 str: 0.000 loss: -147.553]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.62it/s, atk: -151.112 ent: -5.134 str: 0.000 loss: -156.246]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.66it/s, atk: -151.112 ent: -5.134 str: 0.000 loss: -156.246]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.66it/s, atk: -158.470 ent: -5.133 str: 0.000 loss: -163.603]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.61it/s, atk: -158.470 ent: -5.133 str: 0.000 loss: -163.603]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.61it/s, atk: -161.786 ent: -5.133 str: 0.000 loss: -166.919]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.58it/s, atk: -161.786 ent: -5.133 str: 0.000 loss: -166.919]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.58it/s, atk: -168.068 ent: -5.133 str: 0.000 loss: -173.201]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.53it/s, atk: -168.068 ent: -5.133 str: 0.000 loss: -173.201]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.53it/s, atk: -171.893 ent: -5.131 str: 0.000 loss: -177.024]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.57it/s, atk: -171.893 ent: -5.131 str: 0.000 loss: -177.024]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.57it/s, atk: -176.453 ent: -5.130 str: 0.000 loss: -181.583]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.57it/s, atk: -176.453 ent: -5.130 str: 0.000 loss: -181.583]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.57it/s, atk: -182.352 ent: -5.131 str: 0.000 loss: -187.483]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.60it/s, atk: -182.352 ent: -5.131 str: 0.000 loss: -187.483]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.60it/s, atk: -187.935 ent: -5.131 str: 0.000 loss: -193.066]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.38it/s, atk: -187.935 ent: -5.131 str: 0.000 loss: -193.066]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.38it/s, atk: -193.083 ent: -5.130 str: 0.000 loss: -198.214]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.37it/s, atk: -193.083 ent: -5.130 str: 0.000 loss: -198.214]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.37it/s, atk: -198.654 ent: -5.130 str: 0.000 loss: -203.784]Iterations:  87%|████████▋ | 26/30 [00:17<00:03,  1.29it/s, atk: -198.654 ent: -5.130 str: 0.000 loss: -203.784]Iterations:  87%|████████▋ | 26/30 [00:18<00:03,  1.29it/s, atk: -204.560 ent: -5.129 str: 0.000 loss: -209.689]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.30it/s, atk: -204.560 ent: -5.129 str: 0.000 loss: -209.689]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.30it/s, atk: -209.911 ent: -5.129 str: 0.000 loss: -215.040]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.42it/s, atk: -209.911 ent: -5.129 str: 0.000 loss: -215.040]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.42it/s, atk: -215.197 ent: -5.129 str: 0.000 loss: -220.326]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.53it/s, atk: -215.197 ent: -5.129 str: 0.000 loss: -220.326]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.53it/s, atk: -221.062 ent: -5.129 str: 0.000 loss: -226.190]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.58it/s, atk: -221.062 ent: -5.129 str: 0.000 loss: -226.190]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.48it/s, atk: -221.062 ent: -5.129 str: 0.000 loss: -226.190]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([314], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([317], device='cuda:0') tensor(1.7285e-10, device='cuda:0')
L1: [3283.498]	L2: [21.162504]	Linf: [0.6117647]

Accuracy on benign examples: 100.0%
gt_label: 754 pred_label: 754 pred_clean_logit 0.3479346036911011
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.71it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.27it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.50it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.34it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.87it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 23.17it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 24.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.92it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.60s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.49s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4700
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -9.319 ent: -2.659 str: 0.000 loss: -11.979]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.60s/it, atk: -9.319 ent: -2.659 str: 0.000 loss: -11.979]Iterations:   3%|▎         | 1/30 [00:02<01:15,  2.60s/it, atk: -12.167 ent: -2.677 str: 0.000 loss: -14.844]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.45s/it, atk: -12.167 ent: -2.677 str: 0.000 loss: -14.844]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.45s/it, atk: -19.800 ent: -2.662 str: 0.000 loss: -22.462]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -19.800 ent: -2.662 str: 0.000 loss: -22.462]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -25.336 ent: -2.656 str: 0.000 loss: -27.992]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -25.336 ent: -2.656 str: 0.000 loss: -27.992]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.16it/s, atk: -33.099 ent: -2.647 str: 0.000 loss: -35.745]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.32it/s, atk: -33.099 ent: -2.647 str: 0.000 loss: -35.745]Iterations:  17%|█▋        | 5/30 [00:05<00:18,  1.32it/s, atk: -34.375 ent: -2.635 str: 0.000 loss: -37.011]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -34.375 ent: -2.635 str: 0.000 loss: -37.011]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -38.080 ent: -2.636 str: 0.000 loss: -40.716]Iterations:  23%|██▎       | 7/30 [00:06<00:14,  1.54it/s, atk: -38.080 ent: -2.636 str: 0.000 loss: -40.716]Iterations:  23%|██▎       | 7/30 [00:06<00:14,  1.54it/s, atk: -42.435 ent: -2.625 str: 0.000 loss: -45.060]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.50it/s, atk: -42.435 ent: -2.625 str: 0.000 loss: -45.060]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.50it/s, atk: -46.100 ent: -2.621 str: 0.000 loss: -48.720]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.52it/s, atk: -46.100 ent: -2.621 str: 0.000 loss: -48.720]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.52it/s, atk: -50.759 ent: -2.617 str: 0.000 loss: -53.377]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -50.759 ent: -2.617 str: 0.000 loss: -53.377]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.51it/s, atk: -56.683 ent: -2.616 str: 0.000 loss: -59.299]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.47it/s, atk: -56.683 ent: -2.616 str: 0.000 loss: -59.299]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -62.385 ent: -2.617 str: 0.000 loss: -65.002]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.57it/s, atk: -62.385 ent: -2.617 str: 0.000 loss: -65.002]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.57it/s, atk: -68.229 ent: -2.616 str: 0.000 loss: -70.845]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.56it/s, atk: -68.229 ent: -2.616 str: 0.000 loss: -70.845]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.56it/s, atk: -71.370 ent: -2.617 str: 0.000 loss: -73.987]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.51it/s, atk: -71.370 ent: -2.617 str: 0.000 loss: -73.987]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.51it/s, atk: -76.413 ent: -2.618 str: 0.000 loss: -79.031]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.58it/s, atk: -76.413 ent: -2.618 str: 0.000 loss: -79.031]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.58it/s, atk: -80.513 ent: -2.618 str: 0.000 loss: -83.132]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.61it/s, atk: -80.513 ent: -2.618 str: 0.000 loss: -83.132]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.61it/s, atk: -85.932 ent: -2.620 str: 0.000 loss: -88.551]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.62it/s, atk: -85.932 ent: -2.620 str: 0.000 loss: -88.551]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.62it/s, atk: -90.540 ent: -2.621 str: 0.000 loss: -93.161]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.64it/s, atk: -90.540 ent: -2.621 str: 0.000 loss: -93.161]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.64it/s, atk: -94.357 ent: -2.621 str: 0.000 loss: -96.979]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.57it/s, atk: -94.357 ent: -2.621 str: 0.000 loss: -96.979]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.57it/s, atk: -97.607 ent: -2.622 str: 0.000 loss: -100.229]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.55it/s, atk: -97.607 ent: -2.622 str: 0.000 loss: -100.229]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.55it/s, atk: -101.746 ent: -2.623 str: 0.000 loss: -104.368]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.48it/s, atk: -101.746 ent: -2.623 str: 0.000 loss: -104.368]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.48it/s, atk: -105.563 ent: -2.623 str: 0.000 loss: -108.187]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.50it/s, atk: -105.563 ent: -2.623 str: 0.000 loss: -108.187]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.50it/s, atk: -109.892 ent: -2.623 str: 0.000 loss: -112.515]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.55it/s, atk: -109.892 ent: -2.623 str: 0.000 loss: -112.515]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.55it/s, atk: -114.283 ent: -2.623 str: 0.000 loss: -116.906]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.59it/s, atk: -114.283 ent: -2.623 str: 0.000 loss: -116.906]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.59it/s, atk: -117.855 ent: -2.623 str: 0.000 loss: -120.478]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -117.855 ent: -2.623 str: 0.000 loss: -120.478]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.63it/s, atk: -121.032 ent: -2.622 str: 0.000 loss: -123.655]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.60it/s, atk: -121.032 ent: -2.622 str: 0.000 loss: -123.655]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.60it/s, atk: -124.481 ent: -2.622 str: 0.000 loss: -127.102]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.51it/s, atk: -124.481 ent: -2.622 str: 0.000 loss: -127.102]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.51it/s, atk: -128.353 ent: -2.621 str: 0.000 loss: -130.975]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.51it/s, atk: -128.353 ent: -2.621 str: 0.000 loss: -130.975]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.51it/s, atk: -132.213 ent: -2.621 str: 0.000 loss: -134.834]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.57it/s, atk: -132.213 ent: -2.621 str: 0.000 loss: -134.834]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.57it/s, atk: -135.556 ent: -2.621 str: 0.000 loss: -138.176]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.60it/s, atk: -135.556 ent: -2.621 str: 0.000 loss: -138.176]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.44it/s, atk: -135.556 ent: -2.621 str: 0.000 loss: -138.176]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([609], device='cuda:0') tensor(0.9833, device='cuda:0')
after_true: tensor([754], device='cuda:0') tensor(8.6305e-07, device='cuda:0')
L1: [4190.537]	L2: [28.111845]	Linf: [0.7882353]

Accuracy on benign examples: 100.0%
gt_label: 404 pred_label: 404 pred_clean_logit 0.9870098829269409
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  4.58it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.62it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.92it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.48it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.77it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.86it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 20.23it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.92it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.50s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.33s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.34s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.46s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.48s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4705
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.116 ent: -5.236 str: 0.000 loss: -5.352]Iterations:   3%|▎         | 1/30 [00:01<00:52,  1.82s/it, atk: -0.116 ent: -5.236 str: 0.000 loss: -5.352]Iterations:   3%|▎         | 1/30 [00:02<00:52,  1.82s/it, atk: -0.192 ent: -5.250 str: 0.000 loss: -5.442]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.07s/it, atk: -0.192 ent: -5.250 str: 0.000 loss: -5.442]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.07s/it, atk: -0.289 ent: -5.263 str: 0.000 loss: -5.552]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -0.289 ent: -5.263 str: 0.000 loss: -5.552]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -0.454 ent: -5.270 str: 0.000 loss: -5.724]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -0.454 ent: -5.270 str: 0.000 loss: -5.724]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -0.445 ent: -5.288 str: 0.000 loss: -5.733]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.45it/s, atk: -0.445 ent: -5.288 str: 0.000 loss: -5.733]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.45it/s, atk: -0.665 ent: -5.286 str: 0.000 loss: -5.951]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.54it/s, atk: -0.665 ent: -5.286 str: 0.000 loss: -5.951]Iterations:  20%|██        | 6/30 [00:05<00:15,  1.54it/s, atk: -0.852 ent: -5.277 str: 0.000 loss: -6.129]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.59it/s, atk: -0.852 ent: -5.277 str: 0.000 loss: -6.129]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.59it/s, atk: -1.132 ent: -5.276 str: 0.000 loss: -6.408]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.62it/s, atk: -1.132 ent: -5.276 str: 0.000 loss: -6.408]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.62it/s, atk: -1.805 ent: -5.279 str: 0.000 loss: -7.084]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.60it/s, atk: -1.805 ent: -5.279 str: 0.000 loss: -7.084]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.60it/s, atk: -2.389 ent: -5.283 str: 0.000 loss: -7.671]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.59it/s, atk: -2.389 ent: -5.283 str: 0.000 loss: -7.671]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.59it/s, atk: -2.549 ent: -5.281 str: 0.000 loss: -7.829]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.58it/s, atk: -2.549 ent: -5.281 str: 0.000 loss: -7.829]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.58it/s, atk: -3.061 ent: -5.271 str: 0.000 loss: -8.332]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.55it/s, atk: -3.061 ent: -5.271 str: 0.000 loss: -8.332]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.55it/s, atk: -4.657 ent: -5.280 str: 0.000 loss: -9.937]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -4.657 ent: -5.280 str: 0.000 loss: -9.937]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.47it/s, atk: -5.182 ent: -5.279 str: 0.000 loss: -10.461]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.47it/s, atk: -5.182 ent: -5.279 str: 0.000 loss: -10.461]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.47it/s, atk: -6.446 ent: -5.286 str: 0.000 loss: -11.732]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.53it/s, atk: -6.446 ent: -5.286 str: 0.000 loss: -11.732]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.53it/s, atk: -10.182 ent: -5.286 str: 0.000 loss: -15.468]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.54it/s, atk: -10.182 ent: -5.286 str: 0.000 loss: -15.468]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.54it/s, atk: -12.915 ent: -5.273 str: 0.000 loss: -18.188]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.53it/s, atk: -12.915 ent: -5.273 str: 0.000 loss: -18.188]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.53it/s, atk: -16.313 ent: -5.272 str: 0.000 loss: -21.585]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.51it/s, atk: -16.313 ent: -5.272 str: 0.000 loss: -21.585]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.51it/s, atk: -21.678 ent: -5.281 str: 0.000 loss: -26.959]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.47it/s, atk: -21.678 ent: -5.281 str: 0.000 loss: -26.959]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.47it/s, atk: -28.086 ent: -5.288 str: 0.000 loss: -33.374]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.56it/s, atk: -28.086 ent: -5.288 str: 0.000 loss: -33.374]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.56it/s, atk: -32.555 ent: -5.287 str: 0.000 loss: -37.842]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.57it/s, atk: -32.555 ent: -5.287 str: 0.000 loss: -37.842]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.57it/s, atk: -36.992 ent: -5.291 str: 0.000 loss: -42.283]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.58it/s, atk: -36.992 ent: -5.291 str: 0.000 loss: -42.283]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.58it/s, atk: -44.416 ent: -5.285 str: 0.000 loss: -49.701]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.62it/s, atk: -44.416 ent: -5.285 str: 0.000 loss: -49.701]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.62it/s, atk: -49.642 ent: -5.275 str: 0.000 loss: -54.917]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.61it/s, atk: -49.642 ent: -5.275 str: 0.000 loss: -54.917]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.61it/s, atk: -56.356 ent: -5.268 str: 0.000 loss: -61.624]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.64it/s, atk: -56.356 ent: -5.268 str: 0.000 loss: -61.624]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.64it/s, atk: -62.220 ent: -5.265 str: 0.000 loss: -67.485]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.64it/s, atk: -62.220 ent: -5.265 str: 0.000 loss: -67.485]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.64it/s, atk: -68.836 ent: -5.263 str: 0.000 loss: -74.099]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.67it/s, atk: -68.836 ent: -5.263 str: 0.000 loss: -74.099]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.67it/s, atk: -77.198 ent: -5.261 str: 0.000 loss: -82.459]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.69it/s, atk: -77.198 ent: -5.261 str: 0.000 loss: -82.459]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.69it/s, atk: -80.554 ent: -5.256 str: 0.000 loss: -85.810]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.63it/s, atk: -80.554 ent: -5.256 str: 0.000 loss: -85.810]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.63it/s, atk: -88.589 ent: -5.257 str: 0.000 loss: -93.846]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.59it/s, atk: -88.589 ent: -5.257 str: 0.000 loss: -93.846]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.50it/s, atk: -88.589 ent: -5.257 str: 0.000 loss: -93.846]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([657], device='cuda:0') tensor(0.4924, device='cuda:0')
after_true: tensor([404], device='cuda:0') tensor(9.8144e-05, device='cuda:0')
L1: [2412.0078]	L2: [20.647892]	Linf: [0.78431374]

Accuracy on benign examples: 100.0%
gt_label: 537 pred_label: 537 pred_clean_logit 0.9992340803146362
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 13.07it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.50it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.22it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.48it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.70it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.71it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.41it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.15s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.16s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.31s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.43s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.42s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5625
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.012 ent: -5.025 str: 0.000 loss: -5.037]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.34s/it, atk: -0.012 ent: -5.025 str: 0.000 loss: -5.037]Iterations:   3%|▎         | 1/30 [00:02<01:07,  2.34s/it, atk: -0.033 ent: -5.051 str: 0.000 loss: -5.083]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -0.033 ent: -5.051 str: 0.000 loss: -5.083]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -0.052 ent: -5.072 str: 0.000 loss: -5.124]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -0.052 ent: -5.072 str: 0.000 loss: -5.124]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -0.050 ent: -5.077 str: 0.000 loss: -5.127]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -0.050 ent: -5.077 str: 0.000 loss: -5.127]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -0.098 ent: -5.085 str: 0.000 loss: -5.183]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -0.098 ent: -5.085 str: 0.000 loss: -5.183]Iterations:  17%|█▋        | 5/30 [00:05<00:18,  1.34it/s, atk: -0.533 ent: -5.090 str: 0.000 loss: -5.624]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.39it/s, atk: -0.533 ent: -5.090 str: 0.000 loss: -5.624]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.39it/s, atk: -1.058 ent: -5.087 str: 0.000 loss: -6.144]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -1.058 ent: -5.087 str: 0.000 loss: -6.144]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.50it/s, atk: -2.407 ent: -5.090 str: 0.000 loss: -7.497]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.60it/s, atk: -2.407 ent: -5.090 str: 0.000 loss: -7.497]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.60it/s, atk: -3.690 ent: -5.086 str: 0.000 loss: -8.775]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.61it/s, atk: -3.690 ent: -5.086 str: 0.000 loss: -8.775]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.61it/s, atk: -12.681 ent: -5.088 str: 0.000 loss: -17.769]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.61it/s, atk: -12.681 ent: -5.088 str: 0.000 loss: -17.769]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.61it/s, atk: -23.583 ent: -5.085 str: 0.000 loss: -28.668]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.61it/s, atk: -23.583 ent: -5.085 str: 0.000 loss: -28.668]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.61it/s, atk: -10.183 ent: -5.083 str: 0.000 loss: -15.266]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -10.183 ent: -5.083 str: 0.000 loss: -15.266]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -13.517 ent: -5.081 str: 0.000 loss: -18.598]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.48it/s, atk: -13.517 ent: -5.081 str: 0.000 loss: -18.598]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.48it/s, atk: -22.609 ent: -5.082 str: 0.000 loss: -27.691]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.55it/s, atk: -22.609 ent: -5.082 str: 0.000 loss: -27.691]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.55it/s, atk: -39.516 ent: -5.080 str: 0.000 loss: -44.597]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -39.516 ent: -5.080 str: 0.000 loss: -44.597]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.52it/s, atk: -51.783 ent: -5.077 str: 0.000 loss: -56.860]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.52it/s, atk: -51.783 ent: -5.077 str: 0.000 loss: -56.860]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.52it/s, atk: -65.242 ent: -5.076 str: 0.000 loss: -70.318]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.59it/s, atk: -65.242 ent: -5.076 str: 0.000 loss: -70.318]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.59it/s, atk: -77.581 ent: -5.078 str: 0.000 loss: -82.659]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.59it/s, atk: -77.581 ent: -5.078 str: 0.000 loss: -82.659]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.59it/s, atk: -83.633 ent: -5.079 str: 0.000 loss: -88.712]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.62it/s, atk: -83.633 ent: -5.079 str: 0.000 loss: -88.712]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.62it/s, atk: -98.141 ent: -5.076 str: 0.000 loss: -103.217]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.62it/s, atk: -98.141 ent: -5.076 str: 0.000 loss: -103.217]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.62it/s, atk: -107.414 ent: -5.075 str: 0.000 loss: -112.489]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -107.414 ent: -5.075 str: 0.000 loss: -112.489]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -120.602 ent: -5.074 str: 0.000 loss: -125.676]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.71it/s, atk: -120.602 ent: -5.074 str: 0.000 loss: -125.676]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.71it/s, atk: -131.287 ent: -5.075 str: 0.000 loss: -136.361]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.66it/s, atk: -131.287 ent: -5.075 str: 0.000 loss: -136.361]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.66it/s, atk: -143.383 ent: -5.076 str: 0.000 loss: -148.459]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.68it/s, atk: -143.383 ent: -5.076 str: 0.000 loss: -148.459]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.68it/s, atk: -152.894 ent: -5.076 str: 0.000 loss: -157.971]Iterations:  83%|████████▎ | 25/30 [00:16<00:02,  1.72it/s, atk: -152.894 ent: -5.076 str: 0.000 loss: -157.971]Iterations:  83%|████████▎ | 25/30 [00:17<00:02,  1.72it/s, atk: -166.985 ent: -5.077 str: 0.000 loss: -172.062]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.75it/s, atk: -166.985 ent: -5.077 str: 0.000 loss: -172.062]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.75it/s, atk: -175.459 ent: -5.077 str: 0.000 loss: -180.535]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.64it/s, atk: -175.459 ent: -5.077 str: 0.000 loss: -180.535]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.64it/s, atk: -187.464 ent: -5.075 str: 0.000 loss: -192.539]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.70it/s, atk: -187.464 ent: -5.075 str: 0.000 loss: -192.539]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.70it/s, atk: -199.824 ent: -5.074 str: 0.000 loss: -204.897]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.69it/s, atk: -199.824 ent: -5.074 str: 0.000 loss: -204.897]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.69it/s, atk: -207.272 ent: -5.073 str: 0.000 loss: -212.345]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.69it/s, atk: -207.272 ent: -5.073 str: 0.000 loss: -212.345]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.51it/s, atk: -207.272 ent: -5.073 str: 0.000 loss: -212.345]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([515], device='cuda:0') tensor(0.9688, device='cuda:0')
after_true: tensor([537], device='cuda:0') tensor(4.0085e-10, device='cuda:0')
L1: [3202.0435]	L2: [21.167683]	Linf: [0.6039216]

Accuracy on benign examples: 100.0%
gt_label: 830 pred_label: 830 pred_clean_logit 0.8900375962257385
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.07it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.49it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.58it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.93it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.80it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.03it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.60s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.31s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.39s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6854
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.191 ent: -4.927 str: 0.000 loss: -6.118]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.44s/it, atk: -1.191 ent: -4.927 str: 0.000 loss: -6.118]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.44s/it, atk: -8.040 ent: -4.921 str: 0.000 loss: -12.961]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -8.040 ent: -4.921 str: 0.000 loss: -12.961]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -27.312 ent: -4.915 str: 0.000 loss: -32.226]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.26it/s, atk: -27.312 ent: -4.915 str: 0.000 loss: -32.226]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.26it/s, atk: -54.833 ent: -4.920 str: 0.000 loss: -59.753]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.25it/s, atk: -54.833 ent: -4.920 str: 0.000 loss: -59.753]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.25it/s, atk: -71.572 ent: -4.922 str: 0.000 loss: -76.494]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.39it/s, atk: -71.572 ent: -4.922 str: 0.000 loss: -76.494]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.39it/s, atk: -84.975 ent: -4.926 str: 0.000 loss: -89.901]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.47it/s, atk: -84.975 ent: -4.926 str: 0.000 loss: -89.901]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.47it/s, atk: -92.743 ent: -4.930 str: 0.000 loss: -97.673]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.48it/s, atk: -92.743 ent: -4.930 str: 0.000 loss: -97.673]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.48it/s, atk: -98.737 ent: -4.933 str: 0.000 loss: -103.670]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -98.737 ent: -4.933 str: 0.000 loss: -103.670]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -114.758 ent: -4.934 str: 0.000 loss: -119.692]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.57it/s, atk: -114.758 ent: -4.934 str: 0.000 loss: -119.692]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.57it/s, atk: -125.775 ent: -4.935 str: 0.000 loss: -130.711]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.55it/s, atk: -125.775 ent: -4.935 str: 0.000 loss: -130.711]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.55it/s, atk: -137.127 ent: -4.937 str: 0.000 loss: -142.064]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.56it/s, atk: -137.127 ent: -4.937 str: 0.000 loss: -142.064]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.56it/s, atk: -147.101 ent: -4.937 str: 0.000 loss: -152.038]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.58it/s, atk: -147.101 ent: -4.937 str: 0.000 loss: -152.038]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.58it/s, atk: -158.780 ent: -4.937 str: 0.000 loss: -163.716]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.63it/s, atk: -158.780 ent: -4.937 str: 0.000 loss: -163.716]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.63it/s, atk: -166.790 ent: -4.937 str: 0.000 loss: -171.727]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.55it/s, atk: -166.790 ent: -4.937 str: 0.000 loss: -171.727]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.55it/s, atk: -176.695 ent: -4.937 str: 0.000 loss: -181.633]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.46it/s, atk: -176.695 ent: -4.937 str: 0.000 loss: -181.633]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.46it/s, atk: -186.454 ent: -4.936 str: 0.000 loss: -191.390]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -186.454 ent: -4.936 str: 0.000 loss: -191.390]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -194.012 ent: -4.934 str: 0.000 loss: -198.946]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.54it/s, atk: -194.012 ent: -4.934 str: 0.000 loss: -198.946]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.54it/s, atk: -201.939 ent: -4.934 str: 0.000 loss: -206.873]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.57it/s, atk: -201.939 ent: -4.934 str: 0.000 loss: -206.873]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.57it/s, atk: -208.519 ent: -4.933 str: 0.000 loss: -213.452]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.64it/s, atk: -208.519 ent: -4.933 str: 0.000 loss: -213.452]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.64it/s, atk: -214.640 ent: -4.933 str: 0.000 loss: -219.573]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.68it/s, atk: -214.640 ent: -4.933 str: 0.000 loss: -219.573]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.68it/s, atk: -220.107 ent: -4.932 str: 0.000 loss: -225.039]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.66it/s, atk: -220.107 ent: -4.932 str: 0.000 loss: -225.039]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.66it/s, atk: -229.287 ent: -4.933 str: 0.000 loss: -234.220]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.66it/s, atk: -229.287 ent: -4.933 str: 0.000 loss: -234.220]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.66it/s, atk: -234.429 ent: -4.932 str: 0.000 loss: -239.361]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.59it/s, atk: -234.429 ent: -4.932 str: 0.000 loss: -239.361]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.59it/s, atk: -240.458 ent: -4.931 str: 0.000 loss: -245.389]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -240.458 ent: -4.931 str: 0.000 loss: -245.389]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -247.462 ent: -4.931 str: 0.000 loss: -252.392]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.53it/s, atk: -247.462 ent: -4.931 str: 0.000 loss: -252.392]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.53it/s, atk: -252.457 ent: -4.931 str: 0.000 loss: -257.387]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.57it/s, atk: -252.457 ent: -4.931 str: 0.000 loss: -257.387]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.57it/s, atk: -257.384 ent: -4.930 str: 0.000 loss: -262.314]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.58it/s, atk: -257.384 ent: -4.930 str: 0.000 loss: -262.314]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.58it/s, atk: -262.884 ent: -4.931 str: 0.000 loss: -267.814]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.62it/s, atk: -262.884 ent: -4.931 str: 0.000 loss: -267.814]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.62it/s, atk: -267.225 ent: -4.930 str: 0.000 loss: -272.156]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.64it/s, atk: -267.225 ent: -4.930 str: 0.000 loss: -272.156]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.64it/s, atk: -270.480 ent: -4.930 str: 0.000 loss: -275.410]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.61it/s, atk: -270.480 ent: -4.930 str: 0.000 loss: -275.410]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.52it/s, atk: -270.480 ent: -4.930 str: 0.000 loss: -275.410]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([424], device='cuda:0') tensor(0.9962, device='cuda:0')
after_true: tensor([830], device='cuda:0') tensor(1.0496e-12, device='cuda:0')
L1: [4213.271]	L2: [28.498053]	Linf: [0.90588236]

Accuracy on benign examples: 100.0%
gt_label: 308 pred_label: 308 pred_clean_logit 0.9986304044723511
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.22it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.12it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.25it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.85it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.66it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 17.73it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.24it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.12it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.25s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.28s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.48s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2274
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.045 ent: -2.945 str: 0.000 loss: -2.990]Iterations:   3%|▎         | 1/30 [00:02<01:19,  2.73s/it, atk: -0.045 ent: -2.945 str: 0.000 loss: -2.990]Iterations:   3%|▎         | 1/30 [00:03<01:19,  2.73s/it, atk: -0.321 ent: -2.936 str: 0.000 loss: -3.257]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -0.321 ent: -2.936 str: 0.000 loss: -3.257]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.47s/it, atk: -0.643 ent: -2.945 str: 0.000 loss: -3.588]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.09s/it, atk: -0.643 ent: -2.945 str: 0.000 loss: -3.588]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.09s/it, atk: -12.145 ent: -2.943 str: 0.000 loss: -15.088]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -12.145 ent: -2.943 str: 0.000 loss: -15.088]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.13it/s, atk: -19.808 ent: -2.941 str: 0.000 loss: -22.749]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -19.808 ent: -2.941 str: 0.000 loss: -22.749]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.27it/s, atk: -33.909 ent: -2.928 str: 0.000 loss: -36.837]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -33.909 ent: -2.928 str: 0.000 loss: -36.837]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -37.434 ent: -2.922 str: 0.000 loss: -40.356]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.42it/s, atk: -37.434 ent: -2.922 str: 0.000 loss: -40.356]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.42it/s, atk: -36.244 ent: -2.914 str: 0.000 loss: -39.158]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.47it/s, atk: -36.244 ent: -2.914 str: 0.000 loss: -39.158]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.47it/s, atk: -50.241 ent: -2.905 str: 0.000 loss: -53.146]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -50.241 ent: -2.905 str: 0.000 loss: -53.146]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -60.026 ent: -2.895 str: 0.000 loss: -62.921]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -60.026 ent: -2.895 str: 0.000 loss: -62.921]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -73.314 ent: -2.892 str: 0.000 loss: -76.206]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.59it/s, atk: -73.314 ent: -2.892 str: 0.000 loss: -76.206]Iterations:  37%|███▋      | 11/30 [00:09<00:11,  1.59it/s, atk: -84.185 ent: -2.890 str: 0.000 loss: -87.074]Iterations:  40%|████      | 12/30 [00:09<00:10,  1.64it/s, atk: -84.185 ent: -2.890 str: 0.000 loss: -87.074]Iterations:  40%|████      | 12/30 [00:09<00:10,  1.64it/s, atk: -95.521 ent: -2.886 str: 0.000 loss: -98.406]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.67it/s, atk: -95.521 ent: -2.886 str: 0.000 loss: -98.406]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.67it/s, atk: -103.860 ent: -2.883 str: 0.000 loss: -106.743]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.72it/s, atk: -103.860 ent: -2.883 str: 0.000 loss: -106.743]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.72it/s, atk: -110.503 ent: -2.879 str: 0.000 loss: -113.382]Iterations:  50%|█████     | 15/30 [00:11<00:08,  1.70it/s, atk: -110.503 ent: -2.879 str: 0.000 loss: -113.382]Iterations:  50%|█████     | 15/30 [00:11<00:08,  1.70it/s, atk: -116.290 ent: -2.875 str: 0.000 loss: -119.166]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.74it/s, atk: -116.290 ent: -2.875 str: 0.000 loss: -119.166]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.74it/s, atk: -121.666 ent: -2.871 str: 0.000 loss: -124.537]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.70it/s, atk: -121.666 ent: -2.871 str: 0.000 loss: -124.537]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.70it/s, atk: -126.406 ent: -2.868 str: 0.000 loss: -129.274]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.65it/s, atk: -126.406 ent: -2.868 str: 0.000 loss: -129.274]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.65it/s, atk: -129.852 ent: -2.865 str: 0.000 loss: -132.716]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.64it/s, atk: -129.852 ent: -2.865 str: 0.000 loss: -132.716]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.64it/s, atk: -133.256 ent: -2.862 str: 0.000 loss: -136.119]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.62it/s, atk: -133.256 ent: -2.862 str: 0.000 loss: -136.119]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.62it/s, atk: -136.770 ent: -2.860 str: 0.000 loss: -139.630]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -136.770 ent: -2.860 str: 0.000 loss: -139.630]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.62it/s, atk: -140.789 ent: -2.857 str: 0.000 loss: -143.646]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.67it/s, atk: -140.789 ent: -2.857 str: 0.000 loss: -143.646]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.67it/s, atk: -144.146 ent: -2.855 str: 0.000 loss: -147.001]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -144.146 ent: -2.855 str: 0.000 loss: -147.001]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.50it/s, atk: -148.186 ent: -2.852 str: 0.000 loss: -151.038]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.56it/s, atk: -148.186 ent: -2.852 str: 0.000 loss: -151.038]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -150.239 ent: -2.849 str: 0.000 loss: -153.088]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.53it/s, atk: -150.239 ent: -2.849 str: 0.000 loss: -153.088]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.53it/s, atk: -154.342 ent: -2.848 str: 0.000 loss: -157.190]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.52it/s, atk: -154.342 ent: -2.848 str: 0.000 loss: -157.190]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.52it/s, atk: -159.053 ent: -2.849 str: 0.000 loss: -161.902]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.43it/s, atk: -159.053 ent: -2.849 str: 0.000 loss: -161.902]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.43it/s, atk: -162.180 ent: -2.849 str: 0.000 loss: -165.030]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.36it/s, atk: -162.180 ent: -2.849 str: 0.000 loss: -165.030]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.36it/s, atk: -166.237 ent: -2.846 str: 0.000 loss: -169.083]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.41it/s, atk: -166.237 ent: -2.846 str: 0.000 loss: -169.083]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.41it/s, atk: -168.895 ent: -2.844 str: 0.000 loss: -171.739]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.43it/s, atk: -168.895 ent: -2.844 str: 0.000 loss: -171.739]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -168.895 ent: -2.844 str: 0.000 loss: -171.739]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([302], device='cuda:0') tensor(0.9202, device='cuda:0')
after_true: tensor([308], device='cuda:0') tensor(3.2315e-08, device='cuda:0')
L1: [2513.8904]	L2: [17.164267]	Linf: [0.7529412]

Accuracy on benign examples: 100.0%
gt_label: 931 pred_label: 931 pred_clean_logit 0.9787788987159729
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.69it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 13.62it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 16.88it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.49it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.53it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 21.89it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 23.13it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.30it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.99s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.59s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.58s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.62s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.69s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6553
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.289 ent: -2.974 str: 0.000 loss: -3.263]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.67s/it, atk: -0.289 ent: -2.974 str: 0.000 loss: -3.263]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.67s/it, atk: -5.022 ent: -2.975 str: 0.000 loss: -7.997]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.02s/it, atk: -5.022 ent: -2.975 str: 0.000 loss: -7.997]Iterations:   7%|▋         | 2/30 [00:02<00:28,  1.02s/it, atk: -17.351 ent: -2.967 str: 0.000 loss: -20.318]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.22it/s, atk: -17.351 ent: -2.967 str: 0.000 loss: -20.318]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.22it/s, atk: -24.883 ent: -2.965 str: 0.000 loss: -27.848]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.30it/s, atk: -24.883 ent: -2.965 str: 0.000 loss: -27.848]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.30it/s, atk: -31.810 ent: -2.962 str: 0.000 loss: -34.772]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -31.810 ent: -2.962 str: 0.000 loss: -34.772]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -36.362 ent: -2.957 str: 0.000 loss: -39.319]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.43it/s, atk: -36.362 ent: -2.957 str: 0.000 loss: -39.319]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.43it/s, atk: -41.187 ent: -2.953 str: 0.000 loss: -44.140]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.48it/s, atk: -41.187 ent: -2.953 str: 0.000 loss: -44.140]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.48it/s, atk: -44.909 ent: -2.950 str: 0.000 loss: -47.859]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.48it/s, atk: -44.909 ent: -2.950 str: 0.000 loss: -47.859]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.48it/s, atk: -51.760 ent: -2.947 str: 0.000 loss: -54.707]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.41it/s, atk: -51.760 ent: -2.947 str: 0.000 loss: -54.707]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -58.686 ent: -2.946 str: 0.000 loss: -61.631]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.50it/s, atk: -58.686 ent: -2.946 str: 0.000 loss: -61.631]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.50it/s, atk: -65.508 ent: -2.942 str: 0.000 loss: -68.451]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.61it/s, atk: -65.508 ent: -2.942 str: 0.000 loss: -68.451]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.61it/s, atk: -71.300 ent: -2.941 str: 0.000 loss: -74.241]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.61it/s, atk: -71.300 ent: -2.941 str: 0.000 loss: -74.241]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.61it/s, atk: -77.912 ent: -2.940 str: 0.000 loss: -80.852]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.61it/s, atk: -77.912 ent: -2.940 str: 0.000 loss: -80.852]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.61it/s, atk: -83.285 ent: -2.939 str: 0.000 loss: -86.224]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.61it/s, atk: -83.285 ent: -2.939 str: 0.000 loss: -86.224]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.61it/s, atk: -88.341 ent: -2.938 str: 0.000 loss: -91.279]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.65it/s, atk: -88.341 ent: -2.938 str: 0.000 loss: -91.279]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.65it/s, atk: -93.398 ent: -2.937 str: 0.000 loss: -96.335]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.48it/s, atk: -93.398 ent: -2.937 str: 0.000 loss: -96.335]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.48it/s, atk: -99.898 ent: -2.935 str: 0.000 loss: -102.834]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.56it/s, atk: -99.898 ent: -2.935 str: 0.000 loss: -102.834]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -106.296 ent: -2.934 str: 0.000 loss: -109.230]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.60it/s, atk: -106.296 ent: -2.934 str: 0.000 loss: -109.230]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.60it/s, atk: -108.759 ent: -2.932 str: 0.000 loss: -111.691]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.54it/s, atk: -108.759 ent: -2.932 str: 0.000 loss: -111.691]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.54it/s, atk: -114.898 ent: -2.930 str: 0.000 loss: -117.828]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.60it/s, atk: -114.898 ent: -2.930 str: 0.000 loss: -117.828]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.60it/s, atk: -121.960 ent: -2.928 str: 0.000 loss: -124.889]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -121.960 ent: -2.928 str: 0.000 loss: -124.889]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -125.873 ent: -2.928 str: 0.000 loss: -128.801]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.63it/s, atk: -125.873 ent: -2.928 str: 0.000 loss: -128.801]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.63it/s, atk: -130.884 ent: -2.928 str: 0.000 loss: -133.812]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.62it/s, atk: -130.884 ent: -2.928 str: 0.000 loss: -133.812]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.62it/s, atk: -134.604 ent: -2.928 str: 0.000 loss: -137.532]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.57it/s, atk: -134.604 ent: -2.928 str: 0.000 loss: -137.532]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.57it/s, atk: -139.860 ent: -2.926 str: 0.000 loss: -142.787]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.55it/s, atk: -139.860 ent: -2.926 str: 0.000 loss: -142.787]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.55it/s, atk: -144.747 ent: -2.925 str: 0.000 loss: -147.672]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.37it/s, atk: -144.747 ent: -2.925 str: 0.000 loss: -147.672]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.37it/s, atk: -148.239 ent: -2.925 str: 0.000 loss: -151.164]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.26it/s, atk: -148.239 ent: -2.925 str: 0.000 loss: -151.164]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.26it/s, atk: -152.074 ent: -2.925 str: 0.000 loss: -154.999]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.33it/s, atk: -152.074 ent: -2.925 str: 0.000 loss: -154.999]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.33it/s, atk: -156.405 ent: -2.925 str: 0.000 loss: -159.330]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.36it/s, atk: -156.405 ent: -2.925 str: 0.000 loss: -159.330]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.36it/s, atk: -159.280 ent: -2.924 str: 0.000 loss: -162.204]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.40it/s, atk: -159.280 ent: -2.924 str: 0.000 loss: -162.204]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.45it/s, atk: -159.280 ent: -2.924 str: 0.000 loss: -162.204]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([962], device='cuda:0') tensor(0.9992, device='cuda:0')
after_true: tensor([931], device='cuda:0') tensor(9.4337e-08, device='cuda:0')
L1: [3099.6]	L2: [19.305864]	Linf: [0.5529412]

Accuracy on benign examples: 100.0%
gt_label: 489 pred_label: 489 pred_clean_logit 0.7993342280387878
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.63it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.24it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.35it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.85it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 23.32it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 23.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.34it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.20s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.88s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6321
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.998 ent: -7.320 str: 0.000 loss: -11.318]Iterations:   3%|▎         | 1/30 [00:02<01:24,  2.93s/it, atk: -3.998 ent: -7.320 str: 0.000 loss: -11.318]Iterations:   3%|▎         | 1/30 [00:03<01:24,  2.93s/it, atk: -4.344 ent: -7.296 str: 0.000 loss: -11.640]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.62s/it, atk: -4.344 ent: -7.296 str: 0.000 loss: -11.640]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.62s/it, atk: -6.222 ent: -7.289 str: 0.000 loss: -13.511]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -6.222 ent: -7.289 str: 0.000 loss: -13.511]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -10.062 ent: -7.286 str: 0.000 loss: -17.347]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.08it/s, atk: -10.062 ent: -7.286 str: 0.000 loss: -17.347]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.08it/s, atk: -18.440 ent: -7.283 str: 0.000 loss: -25.723]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -18.440 ent: -7.283 str: 0.000 loss: -25.723]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -23.232 ent: -7.288 str: 0.000 loss: -30.520]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.36it/s, atk: -23.232 ent: -7.288 str: 0.000 loss: -30.520]Iterations:  20%|██        | 6/30 [00:06<00:17,  1.36it/s, atk: -26.082 ent: -7.289 str: 0.000 loss: -33.371]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.34it/s, atk: -26.082 ent: -7.289 str: 0.000 loss: -33.371]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.34it/s, atk: -32.958 ent: -7.292 str: 0.000 loss: -40.250]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.46it/s, atk: -32.958 ent: -7.292 str: 0.000 loss: -40.250]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.46it/s, atk: -39.278 ent: -7.291 str: 0.000 loss: -46.569]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.54it/s, atk: -39.278 ent: -7.291 str: 0.000 loss: -46.569]Iterations:  30%|███       | 9/30 [00:08<00:13,  1.54it/s, atk: -45.528 ent: -7.291 str: 0.000 loss: -52.819]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -45.528 ent: -7.291 str: 0.000 loss: -52.819]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -50.474 ent: -7.293 str: 0.000 loss: -57.767]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.54it/s, atk: -50.474 ent: -7.293 str: 0.000 loss: -57.767]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.54it/s, atk: -57.251 ent: -7.289 str: 0.000 loss: -64.540]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.58it/s, atk: -57.251 ent: -7.289 str: 0.000 loss: -64.540]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.58it/s, atk: -62.604 ent: -7.287 str: 0.000 loss: -69.890]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.57it/s, atk: -62.604 ent: -7.287 str: 0.000 loss: -69.890]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.57it/s, atk: -69.622 ent: -7.288 str: 0.000 loss: -76.910]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.56it/s, atk: -69.622 ent: -7.288 str: 0.000 loss: -76.910]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.56it/s, atk: -75.021 ent: -7.289 str: 0.000 loss: -82.310]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -75.021 ent: -7.289 str: 0.000 loss: -82.310]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.47it/s, atk: -79.970 ent: -7.285 str: 0.000 loss: -87.255]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -79.970 ent: -7.285 str: 0.000 loss: -87.255]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -83.734 ent: -7.284 str: 0.000 loss: -91.018]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.52it/s, atk: -83.734 ent: -7.284 str: 0.000 loss: -91.018]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.52it/s, atk: -87.381 ent: -7.283 str: 0.000 loss: -94.664]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.52it/s, atk: -87.381 ent: -7.283 str: 0.000 loss: -94.664]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.52it/s, atk: -90.541 ent: -7.281 str: 0.000 loss: -97.822]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -90.541 ent: -7.281 str: 0.000 loss: -97.822]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.47it/s, atk: -90.741 ent: -7.281 str: 0.000 loss: -98.023]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.54it/s, atk: -90.741 ent: -7.281 str: 0.000 loss: -98.023]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.54it/s, atk: -96.010 ent: -7.280 str: 0.000 loss: -103.291]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -96.010 ent: -7.280 str: 0.000 loss: -103.291]Iterations:  70%|███████   | 21/30 [00:16<00:05,  1.54it/s, atk: -100.110 ent: -7.283 str: 0.000 loss: -107.394]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.53it/s, atk: -100.110 ent: -7.283 str: 0.000 loss: -107.394]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.53it/s, atk: -103.110 ent: -7.286 str: 0.000 loss: -110.396]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -103.110 ent: -7.286 str: 0.000 loss: -110.396]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.54it/s, atk: -108.112 ent: -7.287 str: 0.000 loss: -115.399]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.57it/s, atk: -108.112 ent: -7.287 str: 0.000 loss: -115.399]Iterations:  80%|████████  | 24/30 [00:18<00:03,  1.57it/s, atk: -113.769 ent: -7.284 str: 0.000 loss: -121.054]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -113.769 ent: -7.284 str: 0.000 loss: -121.054]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -118.386 ent: -7.285 str: 0.000 loss: -125.671]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.56it/s, atk: -118.386 ent: -7.285 str: 0.000 loss: -125.671]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.56it/s, atk: -120.572 ent: -7.287 str: 0.000 loss: -127.859]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.54it/s, atk: -120.572 ent: -7.287 str: 0.000 loss: -127.859]Iterations:  90%|█████████ | 27/30 [00:20<00:01,  1.54it/s, atk: -123.846 ent: -7.283 str: 0.000 loss: -131.129]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -123.846 ent: -7.283 str: 0.000 loss: -131.129]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.54it/s, atk: -126.845 ent: -7.282 str: 0.000 loss: -134.128]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.64it/s, atk: -126.845 ent: -7.282 str: 0.000 loss: -134.128]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.64it/s, atk: -129.893 ent: -7.282 str: 0.000 loss: -137.175]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.62it/s, atk: -129.893 ent: -7.282 str: 0.000 loss: -137.175]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -129.893 ent: -7.282 str: 0.000 loss: -137.175]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([791], device='cuda:0') tensor(0.9807, device='cuda:0')
after_true: tensor([489], device='cuda:0') tensor(1.8217e-06, device='cuda:0')
L1: [3021.9766]	L2: [23.03234]	Linf: [0.7176471]

Accuracy on benign examples: 100.0%
gt_label: 406 pred_label: 406 pred_clean_logit 0.9606586694717407
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.47it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.66it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.20it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.09it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.92it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.96it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.54it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.53it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.65s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.44s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3221
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.794 ent: -2.505 str: 0.000 loss: -3.299]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.794 ent: -2.505 str: 0.000 loss: -3.299]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -2.021 ent: -2.501 str: 0.000 loss: -4.521]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -2.021 ent: -2.501 str: 0.000 loss: -4.521]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -2.875 ent: -2.495 str: 0.000 loss: -5.370]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -2.875 ent: -2.495 str: 0.000 loss: -5.370]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -4.499 ent: -2.500 str: 0.000 loss: -7.000]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -4.499 ent: -2.500 str: 0.000 loss: -7.000]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.26it/s, atk: -7.369 ent: -2.499 str: 0.000 loss: -9.868]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -7.369 ent: -2.499 str: 0.000 loss: -9.868]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -9.714 ent: -2.493 str: 0.000 loss: -12.207]Iterations:  20%|██        | 6/30 [00:05<00:15,  1.50it/s, atk: -9.714 ent: -2.493 str: 0.000 loss: -12.207]Iterations:  20%|██        | 6/30 [00:05<00:15,  1.50it/s, atk: -12.148 ent: -2.489 str: 0.000 loss: -14.637]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -12.148 ent: -2.489 str: 0.000 loss: -14.637]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.31it/s, atk: -15.806 ent: -2.493 str: 0.000 loss: -18.300]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -15.806 ent: -2.493 str: 0.000 loss: -18.300]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -19.818 ent: -2.493 str: 0.000 loss: -22.311]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -19.818 ent: -2.493 str: 0.000 loss: -22.311]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.42it/s, atk: -23.077 ent: -2.491 str: 0.000 loss: -25.569]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.52it/s, atk: -23.077 ent: -2.491 str: 0.000 loss: -25.569]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -28.275 ent: -2.489 str: 0.000 loss: -30.764]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -28.275 ent: -2.489 str: 0.000 loss: -30.764]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -32.312 ent: -2.488 str: 0.000 loss: -34.800]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -32.312 ent: -2.488 str: 0.000 loss: -34.800]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -36.169 ent: -2.486 str: 0.000 loss: -38.656]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.57it/s, atk: -36.169 ent: -2.486 str: 0.000 loss: -38.656]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.57it/s, atk: -39.540 ent: -2.486 str: 0.000 loss: -42.026]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.56it/s, atk: -39.540 ent: -2.486 str: 0.000 loss: -42.026]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.56it/s, atk: -44.861 ent: -2.487 str: 0.000 loss: -47.348]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.53it/s, atk: -44.861 ent: -2.487 str: 0.000 loss: -47.348]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.53it/s, atk: -48.710 ent: -2.486 str: 0.000 loss: -51.196]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.59it/s, atk: -48.710 ent: -2.486 str: 0.000 loss: -51.196]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.59it/s, atk: -52.730 ent: -2.486 str: 0.000 loss: -55.216]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.59it/s, atk: -52.730 ent: -2.486 str: 0.000 loss: -55.216]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.59it/s, atk: -56.353 ent: -2.486 str: 0.000 loss: -58.838]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.56it/s, atk: -56.353 ent: -2.486 str: 0.000 loss: -58.838]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.56it/s, atk: -59.588 ent: -2.484 str: 0.000 loss: -62.072]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -59.588 ent: -2.484 str: 0.000 loss: -62.072]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -62.384 ent: -2.484 str: 0.000 loss: -64.868]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.67it/s, atk: -62.384 ent: -2.484 str: 0.000 loss: -64.868]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.67it/s, atk: -64.857 ent: -2.484 str: 0.000 loss: -67.340]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -64.857 ent: -2.484 str: 0.000 loss: -67.340]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.62it/s, atk: -67.758 ent: -2.483 str: 0.000 loss: -70.241]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.48it/s, atk: -67.758 ent: -2.483 str: 0.000 loss: -70.241]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.48it/s, atk: -71.495 ent: -2.483 str: 0.000 loss: -73.978]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.53it/s, atk: -71.495 ent: -2.483 str: 0.000 loss: -73.978]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.53it/s, atk: -76.063 ent: -2.482 str: 0.000 loss: -78.546]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.56it/s, atk: -76.063 ent: -2.482 str: 0.000 loss: -78.546]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.56it/s, atk: -79.379 ent: -2.482 str: 0.000 loss: -81.861]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -79.379 ent: -2.482 str: 0.000 loss: -81.861]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -82.298 ent: -2.482 str: 0.000 loss: -84.780]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.51it/s, atk: -82.298 ent: -2.482 str: 0.000 loss: -84.780]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.51it/s, atk: -85.045 ent: -2.481 str: 0.000 loss: -87.525]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.61it/s, atk: -85.045 ent: -2.481 str: 0.000 loss: -87.525]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.61it/s, atk: -87.898 ent: -2.481 str: 0.000 loss: -90.379]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.63it/s, atk: -87.898 ent: -2.481 str: 0.000 loss: -90.379]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.63it/s, atk: -91.338 ent: -2.481 str: 0.000 loss: -93.819]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -91.338 ent: -2.481 str: 0.000 loss: -93.819]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.55it/s, atk: -95.371 ent: -2.480 str: 0.000 loss: -97.851]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.58it/s, atk: -95.371 ent: -2.480 str: 0.000 loss: -97.851]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.46it/s, atk: -95.371 ent: -2.480 str: 0.000 loss: -97.851]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([854], device='cuda:0') tensor(0.9942, device='cuda:0')
after_true: tensor([406], device='cuda:0') tensor(5.4330e-05, device='cuda:0')
L1: [2991.]	L2: [20.074081]	Linf: [0.64705884]

Accuracy on benign examples: 100.0%
gt_label: 597 pred_label: 597 pred_clean_logit 0.7883328199386597
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.24it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.30it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 20.57it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 21.23it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.66it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 22.43it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.13it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.65s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5306
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.752 ent: -5.079 str: 0.000 loss: -5.831]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.95s/it, atk: -0.752 ent: -5.079 str: 0.000 loss: -5.831]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.95s/it, atk: -3.378 ent: -5.066 str: 0.000 loss: -8.445]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.17s/it, atk: -3.378 ent: -5.066 str: 0.000 loss: -8.445]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.17s/it, atk: -6.583 ent: -5.066 str: 0.000 loss: -11.649]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -6.583 ent: -5.066 str: 0.000 loss: -11.649]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.08it/s, atk: -13.681 ent: -5.072 str: 0.000 loss: -18.753]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -13.681 ent: -5.072 str: 0.000 loss: -18.753]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -21.387 ent: -5.074 str: 0.000 loss: -26.461]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -21.387 ent: -5.074 str: 0.000 loss: -26.461]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -27.950 ent: -5.076 str: 0.000 loss: -33.027]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -27.950 ent: -5.076 str: 0.000 loss: -33.027]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -34.241 ent: -5.078 str: 0.000 loss: -39.319]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.36it/s, atk: -34.241 ent: -5.078 str: 0.000 loss: -39.319]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -42.081 ent: -5.078 str: 0.000 loss: -47.159]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.49it/s, atk: -42.081 ent: -5.078 str: 0.000 loss: -47.159]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.49it/s, atk: -46.758 ent: -5.074 str: 0.000 loss: -51.832]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.56it/s, atk: -46.758 ent: -5.074 str: 0.000 loss: -51.832]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.56it/s, atk: -51.281 ent: -5.071 str: 0.000 loss: -56.352]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.53it/s, atk: -51.281 ent: -5.071 str: 0.000 loss: -56.352]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.53it/s, atk: -57.139 ent: -5.067 str: 0.000 loss: -62.207]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.58it/s, atk: -57.139 ent: -5.067 str: 0.000 loss: -62.207]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.58it/s, atk: -60.754 ent: -5.068 str: 0.000 loss: -65.822]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.59it/s, atk: -60.754 ent: -5.068 str: 0.000 loss: -65.822]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -65.866 ent: -5.065 str: 0.000 loss: -70.932]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.65it/s, atk: -65.866 ent: -5.065 str: 0.000 loss: -70.932]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.65it/s, atk: -70.197 ent: -5.063 str: 0.000 loss: -75.260]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.60it/s, atk: -70.197 ent: -5.063 str: 0.000 loss: -75.260]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.60it/s, atk: -73.490 ent: -5.060 str: 0.000 loss: -78.549]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.66it/s, atk: -73.490 ent: -5.060 str: 0.000 loss: -78.549]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.66it/s, atk: -76.832 ent: -5.056 str: 0.000 loss: -81.888]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.61it/s, atk: -76.832 ent: -5.056 str: 0.000 loss: -81.888]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.61it/s, atk: -79.802 ent: -5.055 str: 0.000 loss: -84.858]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.58it/s, atk: -79.802 ent: -5.055 str: 0.000 loss: -84.858]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.58it/s, atk: -83.728 ent: -5.057 str: 0.000 loss: -88.786]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.67it/s, atk: -83.728 ent: -5.057 str: 0.000 loss: -88.786]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.67it/s, atk: -86.512 ent: -5.057 str: 0.000 loss: -91.569]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.66it/s, atk: -86.512 ent: -5.057 str: 0.000 loss: -91.569]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.66it/s, atk: -89.592 ent: -5.056 str: 0.000 loss: -94.648]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.66it/s, atk: -89.592 ent: -5.056 str: 0.000 loss: -94.648]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.66it/s, atk: -93.030 ent: -5.058 str: 0.000 loss: -98.088]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -93.030 ent: -5.058 str: 0.000 loss: -98.088]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -96.917 ent: -5.057 str: 0.000 loss: -101.974]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.58it/s, atk: -96.917 ent: -5.057 str: 0.000 loss: -101.974]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.58it/s, atk: -99.787 ent: -5.056 str: 0.000 loss: -104.842]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.66it/s, atk: -99.787 ent: -5.056 str: 0.000 loss: -104.842]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.66it/s, atk: -103.784 ent: -5.055 str: 0.000 loss: -108.839]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.66it/s, atk: -103.784 ent: -5.055 str: 0.000 loss: -108.839]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.66it/s, atk: -107.029 ent: -5.055 str: 0.000 loss: -112.083]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.63it/s, atk: -107.029 ent: -5.055 str: 0.000 loss: -112.083]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -109.552 ent: -5.053 str: 0.000 loss: -114.605]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.62it/s, atk: -109.552 ent: -5.053 str: 0.000 loss: -114.605]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.62it/s, atk: -112.229 ent: -5.050 str: 0.000 loss: -117.279]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.68it/s, atk: -112.229 ent: -5.050 str: 0.000 loss: -117.279]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.68it/s, atk: -115.798 ent: -5.048 str: 0.000 loss: -120.846]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.65it/s, atk: -115.798 ent: -5.048 str: 0.000 loss: -120.846]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.65it/s, atk: -119.725 ent: -5.045 str: 0.000 loss: -124.770]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.63it/s, atk: -119.725 ent: -5.045 str: 0.000 loss: -124.770]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.63it/s, atk: -123.153 ent: -5.044 str: 0.000 loss: -128.197]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.60it/s, atk: -123.153 ent: -5.044 str: 0.000 loss: -128.197]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.50it/s, atk: -123.153 ent: -5.044 str: 0.000 loss: -128.197]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([414], device='cuda:0') tensor(0.6085, device='cuda:0')
after_true: tensor([597], device='cuda:0') tensor(3.2843e-06, device='cuda:0')
L1: [3224.2002]	L2: [22.746313]	Linf: [0.75686276]

Accuracy on benign examples: 100.0%
gt_label: 919 pred_label: 919 pred_clean_logit 0.9906142950057983
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:05,  3.47it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  8.43it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 13.26it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 15.26it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.22it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 16.94it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.81it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.07it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.50s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.42s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6065
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.132 ent: -5.132 str: 0.000 loss: -5.264]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.40s/it, atk: -0.132 ent: -5.132 str: 0.000 loss: -5.264]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.40s/it, atk: -0.379 ent: -5.100 str: 0.000 loss: -5.479]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -0.379 ent: -5.100 str: 0.000 loss: -5.479]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.07it/s, atk: -0.935 ent: -5.100 str: 0.000 loss: -6.034]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.26it/s, atk: -0.935 ent: -5.100 str: 0.000 loss: -6.034]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.26it/s, atk: -2.932 ent: -5.104 str: 0.000 loss: -8.036]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.36it/s, atk: -2.932 ent: -5.104 str: 0.000 loss: -8.036]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.36it/s, atk: -5.544 ent: -5.096 str: 0.000 loss: -10.639]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.45it/s, atk: -5.544 ent: -5.096 str: 0.000 loss: -10.639]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.45it/s, atk: -8.652 ent: -5.098 str: 0.000 loss: -13.750]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.53it/s, atk: -8.652 ent: -5.098 str: 0.000 loss: -13.750]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.53it/s, atk: -9.300 ent: -5.092 str: 0.000 loss: -14.391]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -9.300 ent: -5.092 str: 0.000 loss: -14.391]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.39it/s, atk: -10.975 ent: -5.087 str: 0.000 loss: -16.062]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.44it/s, atk: -10.975 ent: -5.087 str: 0.000 loss: -16.062]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.44it/s, atk: -15.789 ent: -5.082 str: 0.000 loss: -20.872]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.48it/s, atk: -15.789 ent: -5.082 str: 0.000 loss: -20.872]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.48it/s, atk: -22.203 ent: -5.082 str: 0.000 loss: -27.285]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.59it/s, atk: -22.203 ent: -5.082 str: 0.000 loss: -27.285]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.59it/s, atk: -26.848 ent: -5.083 str: 0.000 loss: -31.931]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.63it/s, atk: -26.848 ent: -5.083 str: 0.000 loss: -31.931]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.63it/s, atk: -29.451 ent: -5.081 str: 0.000 loss: -34.533]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.59it/s, atk: -29.451 ent: -5.081 str: 0.000 loss: -34.533]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.59it/s, atk: -37.246 ent: -5.079 str: 0.000 loss: -42.325]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.57it/s, atk: -37.246 ent: -5.079 str: 0.000 loss: -42.325]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.57it/s, atk: -42.001 ent: -5.078 str: 0.000 loss: -47.078]Iterations:  47%|████▋     | 14/30 [00:09<00:11,  1.42it/s, atk: -42.001 ent: -5.078 str: 0.000 loss: -47.078]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.42it/s, atk: -48.368 ent: -5.075 str: 0.000 loss: -53.443]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.42it/s, atk: -48.368 ent: -5.075 str: 0.000 loss: -53.443]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.42it/s, atk: -54.225 ent: -5.073 str: 0.000 loss: -59.297]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.46it/s, atk: -54.225 ent: -5.073 str: 0.000 loss: -59.297]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.46it/s, atk: -59.316 ent: -5.072 str: 0.000 loss: -64.387]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.54it/s, atk: -59.316 ent: -5.072 str: 0.000 loss: -64.387]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.54it/s, atk: -63.657 ent: -5.069 str: 0.000 loss: -68.726]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -63.657 ent: -5.069 str: 0.000 loss: -68.726]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -69.346 ent: -5.070 str: 0.000 loss: -74.415]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.61it/s, atk: -69.346 ent: -5.070 str: 0.000 loss: -74.415]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -73.300 ent: -5.070 str: 0.000 loss: -78.370]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.60it/s, atk: -73.300 ent: -5.070 str: 0.000 loss: -78.370]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.60it/s, atk: -77.578 ent: -5.070 str: 0.000 loss: -82.648]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.61it/s, atk: -77.578 ent: -5.070 str: 0.000 loss: -82.648]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.61it/s, atk: -79.642 ent: -5.068 str: 0.000 loss: -84.711]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.56it/s, atk: -79.642 ent: -5.068 str: 0.000 loss: -84.711]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.56it/s, atk: -83.400 ent: -5.063 str: 0.000 loss: -88.463]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.53it/s, atk: -83.400 ent: -5.063 str: 0.000 loss: -88.463]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.53it/s, atk: -89.161 ent: -5.063 str: 0.000 loss: -94.223]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -89.161 ent: -5.063 str: 0.000 loss: -94.223]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -94.108 ent: -5.065 str: 0.000 loss: -99.172]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.56it/s, atk: -94.108 ent: -5.065 str: 0.000 loss: -99.172]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -98.729 ent: -5.068 str: 0.000 loss: -103.798]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.53it/s, atk: -98.729 ent: -5.068 str: 0.000 loss: -103.798]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.53it/s, atk: -104.288 ent: -5.068 str: 0.000 loss: -109.355]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.51it/s, atk: -104.288 ent: -5.068 str: 0.000 loss: -109.355]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.51it/s, atk: -110.345 ent: -5.066 str: 0.000 loss: -115.412]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.49it/s, atk: -110.345 ent: -5.066 str: 0.000 loss: -115.412]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.49it/s, atk: -116.078 ent: -5.066 str: 0.000 loss: -121.144]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -116.078 ent: -5.066 str: 0.000 loss: -121.144]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.55it/s, atk: -120.292 ent: -5.068 str: 0.000 loss: -125.360]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.45it/s, atk: -120.292 ent: -5.068 str: 0.000 loss: -125.360]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.48it/s, atk: -120.292 ent: -5.068 str: 0.000 loss: -125.360]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([557], device='cuda:0') tensor(0.9789, device='cuda:0')
after_true: tensor([919], device='cuda:0') tensor(3.7420e-06, device='cuda:0')
L1: [3221.255]	L2: [22.834063]	Linf: [0.7176471]

Accuracy on benign examples: 100.0%
gt_label: 799 pred_label: 799 pred_clean_logit 0.8088855743408203
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.43it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:03,  4.65it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01,  9.22it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 12.85it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.79it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 17.94it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 19.93it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.69it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.23s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.17s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.26s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.43s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.44s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5241
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.822 ent: -4.860 str: 0.000 loss: -6.682]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.83s/it, atk: -1.822 ent: -4.860 str: 0.000 loss: -6.682]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.83s/it, atk: -1.753 ent: -4.846 str: 0.000 loss: -6.599]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -1.753 ent: -4.846 str: 0.000 loss: -6.599]Iterations:   7%|▋         | 2/30 [00:02<00:32,  1.16s/it, atk: -2.533 ent: -4.836 str: 0.000 loss: -7.369]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -2.533 ent: -4.836 str: 0.000 loss: -7.369]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -3.114 ent: -4.835 str: 0.000 loss: -7.949]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.25it/s, atk: -3.114 ent: -4.835 str: 0.000 loss: -7.949]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.25it/s, atk: -3.786 ent: -4.831 str: 0.000 loss: -8.617]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.42it/s, atk: -3.786 ent: -4.831 str: 0.000 loss: -8.617]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.42it/s, atk: -4.691 ent: -4.825 str: 0.000 loss: -9.516]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.51it/s, atk: -4.691 ent: -4.825 str: 0.000 loss: -9.516]Iterations:  20%|██        | 6/30 [00:05<00:15,  1.51it/s, atk: -5.545 ent: -4.825 str: 0.000 loss: -10.370]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -5.545 ent: -4.825 str: 0.000 loss: -10.370]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -6.959 ent: -4.820 str: 0.000 loss: -11.779]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.60it/s, atk: -6.959 ent: -4.820 str: 0.000 loss: -11.779]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.60it/s, atk: -7.549 ent: -4.825 str: 0.000 loss: -12.373]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.62it/s, atk: -7.549 ent: -4.825 str: 0.000 loss: -12.373]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.62it/s, atk: -8.936 ent: -4.828 str: 0.000 loss: -13.764]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.67it/s, atk: -8.936 ent: -4.828 str: 0.000 loss: -13.764]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.67it/s, atk: -9.663 ent: -4.822 str: 0.000 loss: -14.485]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.70it/s, atk: -9.663 ent: -4.822 str: 0.000 loss: -14.485]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.70it/s, atk: -11.821 ent: -4.816 str: 0.000 loss: -16.637]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.69it/s, atk: -11.821 ent: -4.816 str: 0.000 loss: -16.637]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.69it/s, atk: -13.688 ent: -4.814 str: 0.000 loss: -18.502]Iterations:  43%|████▎     | 13/30 [00:09<00:09,  1.72it/s, atk: -13.688 ent: -4.814 str: 0.000 loss: -18.502]Iterations:  43%|████▎     | 13/30 [00:09<00:09,  1.72it/s, atk: -14.640 ent: -4.815 str: 0.000 loss: -19.455]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.73it/s, atk: -14.640 ent: -4.815 str: 0.000 loss: -19.455]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.73it/s, atk: -16.721 ent: -4.811 str: 0.000 loss: -21.533]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.67it/s, atk: -16.721 ent: -4.811 str: 0.000 loss: -21.533]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.67it/s, atk: -19.429 ent: -4.809 str: 0.000 loss: -24.238]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.65it/s, atk: -19.429 ent: -4.809 str: 0.000 loss: -24.238]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.65it/s, atk: -21.175 ent: -4.808 str: 0.000 loss: -25.984]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.63it/s, atk: -21.175 ent: -4.808 str: 0.000 loss: -25.984]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.63it/s, atk: -21.828 ent: -4.806 str: 0.000 loss: -26.634]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.55it/s, atk: -21.828 ent: -4.806 str: 0.000 loss: -26.634]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.55it/s, atk: -21.144 ent: -4.805 str: 0.000 loss: -25.949]Iterations:  63%|██████▎   | 19/30 [00:12<00:07,  1.50it/s, atk: -21.144 ent: -4.805 str: 0.000 loss: -25.949]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.50it/s, atk: -22.406 ent: -4.799 str: 0.000 loss: -27.205]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.56it/s, atk: -22.406 ent: -4.799 str: 0.000 loss: -27.205]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.56it/s, atk: -23.486 ent: -4.802 str: 0.000 loss: -28.287]Iterations:  70%|███████   | 21/30 [00:14<00:06,  1.50it/s, atk: -23.486 ent: -4.802 str: 0.000 loss: -28.287]Iterations:  70%|███████   | 21/30 [00:14<00:06,  1.50it/s, atk: -24.035 ent: -4.800 str: 0.000 loss: -28.835]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.53it/s, atk: -24.035 ent: -4.800 str: 0.000 loss: -28.835]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.53it/s, atk: -26.652 ent: -4.798 str: 0.000 loss: -31.450]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.55it/s, atk: -26.652 ent: -4.798 str: 0.000 loss: -31.450]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.55it/s, atk: -28.779 ent: -4.796 str: 0.000 loss: -33.575]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -28.779 ent: -4.796 str: 0.000 loss: -33.575]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -28.569 ent: -4.794 str: 0.000 loss: -33.363]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.55it/s, atk: -28.569 ent: -4.794 str: 0.000 loss: -33.363]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.55it/s, atk: -31.839 ent: -4.794 str: 0.000 loss: -36.633]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.51it/s, atk: -31.839 ent: -4.794 str: 0.000 loss: -36.633]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.51it/s, atk: -33.485 ent: -4.793 str: 0.000 loss: -38.278]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -33.485 ent: -4.793 str: 0.000 loss: -38.278]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -34.091 ent: -4.793 str: 0.000 loss: -38.884]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.46it/s, atk: -34.091 ent: -4.793 str: 0.000 loss: -38.884]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.46it/s, atk: -34.601 ent: -4.794 str: 0.000 loss: -39.395]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.52it/s, atk: -34.601 ent: -4.794 str: 0.000 loss: -39.395]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.52it/s, atk: -36.499 ent: -4.794 str: 0.000 loss: -41.293]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.56it/s, atk: -36.499 ent: -4.794 str: 0.000 loss: -41.293]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.50it/s, atk: -36.499 ent: -4.794 str: 0.000 loss: -41.293]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([904], device='cuda:0') tensor(0.5220, device='cuda:0')
after_true: tensor([799], device='cuda:0') tensor(0.0196, device='cuda:0')
L1: [1856.1648]	L2: [13.163575]	Linf: [0.46666664]

Accuracy on benign examples: 0.0%
gt_label: 944 pred_label: 938 pred_clean_logit 0.043495770543813705
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.92it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.16it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.75it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.78it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.04it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.92it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.46it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.74it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.21s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.21s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.25s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.42s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.45s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5087
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -46.663 ent: -2.527 str: 0.000 loss: -49.189]Iterations:   3%|▎         | 1/30 [00:00<00:25,  1.16it/s, atk: -46.663 ent: -2.527 str: 0.000 loss: -49.189]Iterations:   3%|▎         | 1/30 [00:01<00:25,  1.16it/s, atk: -62.380 ent: -2.521 str: 0.000 loss: -64.901]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.33it/s, atk: -62.380 ent: -2.521 str: 0.000 loss: -64.901]Iterations:   7%|▋         | 2/30 [00:01<00:21,  1.33it/s, atk: -74.340 ent: -2.516 str: 0.000 loss: -76.856]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.36it/s, atk: -74.340 ent: -2.516 str: 0.000 loss: -76.856]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.36it/s, atk: -80.674 ent: -2.513 str: 0.000 loss: -83.187]Iterations:  13%|█▎        | 4/30 [00:02<00:17,  1.49it/s, atk: -80.674 ent: -2.513 str: 0.000 loss: -83.187]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.49it/s, atk: -91.165 ent: -2.513 str: 0.000 loss: -93.678]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.61it/s, atk: -91.165 ent: -2.513 str: 0.000 loss: -93.678]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.61it/s, atk: -102.352 ent: -2.517 str: 0.000 loss: -104.869]Iterations:  20%|██        | 6/30 [00:03<00:14,  1.66it/s, atk: -102.352 ent: -2.517 str: 0.000 loss: -104.869]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.66it/s, atk: -112.881 ent: -2.518 str: 0.000 loss: -115.399]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.57it/s, atk: -112.881 ent: -2.518 str: 0.000 loss: -115.399]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.57it/s, atk: -122.374 ent: -2.519 str: 0.000 loss: -124.893]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.61it/s, atk: -122.374 ent: -2.519 str: 0.000 loss: -124.893]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.61it/s, atk: -127.282 ent: -2.518 str: 0.000 loss: -129.801]Iterations:  30%|███       | 9/30 [00:05<00:12,  1.63it/s, atk: -127.282 ent: -2.518 str: 0.000 loss: -129.801]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.63it/s, atk: -134.902 ent: -2.519 str: 0.000 loss: -137.420]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.56it/s, atk: -134.902 ent: -2.519 str: 0.000 loss: -137.420]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.56it/s, atk: -140.024 ent: -2.518 str: 0.000 loss: -142.542]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.56it/s, atk: -140.024 ent: -2.518 str: 0.000 loss: -142.542]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.56it/s, atk: -145.062 ent: -2.517 str: 0.000 loss: -147.580]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.62it/s, atk: -145.062 ent: -2.517 str: 0.000 loss: -147.580]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.62it/s, atk: -147.807 ent: -2.517 str: 0.000 loss: -150.323]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.67it/s, atk: -147.807 ent: -2.517 str: 0.000 loss: -150.323]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.67it/s, atk: -153.498 ent: -2.516 str: 0.000 loss: -156.014]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.69it/s, atk: -153.498 ent: -2.516 str: 0.000 loss: -156.014]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.69it/s, atk: -159.306 ent: -2.517 str: 0.000 loss: -161.822]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.72it/s, atk: -159.306 ent: -2.517 str: 0.000 loss: -161.822]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.72it/s, atk: -163.301 ent: -2.517 str: 0.000 loss: -165.818]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.63it/s, atk: -163.301 ent: -2.517 str: 0.000 loss: -165.818]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.63it/s, atk: -168.228 ent: -2.516 str: 0.000 loss: -170.745]Iterations:  57%|█████▋    | 17/30 [00:10<00:08,  1.59it/s, atk: -168.228 ent: -2.516 str: 0.000 loss: -170.745]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.59it/s, atk: -172.349 ent: -2.516 str: 0.000 loss: -174.866]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.60it/s, atk: -172.349 ent: -2.516 str: 0.000 loss: -174.866]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.60it/s, atk: -176.794 ent: -2.516 str: 0.000 loss: -179.310]Iterations:  63%|██████▎   | 19/30 [00:11<00:06,  1.63it/s, atk: -176.794 ent: -2.516 str: 0.000 loss: -179.310]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.63it/s, atk: -182.048 ent: -2.516 str: 0.000 loss: -184.563]Iterations:  67%|██████▋   | 20/30 [00:12<00:06,  1.59it/s, atk: -182.048 ent: -2.516 str: 0.000 loss: -184.563]Iterations:  67%|██████▋   | 20/30 [00:12<00:06,  1.59it/s, atk: -185.024 ent: -2.516 str: 0.000 loss: -187.539]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.55it/s, atk: -185.024 ent: -2.516 str: 0.000 loss: -187.539]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.55it/s, atk: -190.321 ent: -2.515 str: 0.000 loss: -192.836]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.52it/s, atk: -190.321 ent: -2.515 str: 0.000 loss: -192.836]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.52it/s, atk: -194.417 ent: -2.515 str: 0.000 loss: -196.932]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.48it/s, atk: -194.417 ent: -2.515 str: 0.000 loss: -196.932]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.48it/s, atk: -198.495 ent: -2.514 str: 0.000 loss: -201.010]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.51it/s, atk: -198.495 ent: -2.514 str: 0.000 loss: -201.010]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.51it/s, atk: -202.183 ent: -2.515 str: 0.000 loss: -204.698]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.50it/s, atk: -202.183 ent: -2.515 str: 0.000 loss: -204.698]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.50it/s, atk: -205.268 ent: -2.515 str: 0.000 loss: -207.783]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.58it/s, atk: -205.268 ent: -2.515 str: 0.000 loss: -207.783]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.58it/s, atk: -208.624 ent: -2.515 str: 0.000 loss: -211.139]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.58it/s, atk: -208.624 ent: -2.515 str: 0.000 loss: -211.139]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.58it/s, atk: -212.484 ent: -2.514 str: 0.000 loss: -214.998]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.56it/s, atk: -212.484 ent: -2.514 str: 0.000 loss: -214.998]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.56it/s, atk: -216.540 ent: -2.514 str: 0.000 loss: -219.054]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.59it/s, atk: -216.540 ent: -2.514 str: 0.000 loss: -219.054]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.59it/s, atk: -219.664 ent: -2.514 str: 0.000 loss: -222.177]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.64it/s, atk: -219.664 ent: -2.514 str: 0.000 loss: -222.177]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.58it/s, atk: -219.664 ent: -2.514 str: 0.000 loss: -222.177]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([938], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([944], device='cuda:0') tensor(2.0107e-10, device='cuda:0')
L1: [3774.2747]	L2: [24.60867]	Linf: [0.8117647]

Accuracy on benign examples: 100.0%
gt_label: 97 pred_label: 97 pred_clean_logit 0.9962043166160583
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 18.61it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.47it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.23it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.24it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.44it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.72it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 22.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.94it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.87s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.58s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.68s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3737
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.024 ent: -2.555 str: 0.000 loss: -2.579]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.38s/it, atk: -0.024 ent: -2.555 str: 0.000 loss: -2.579]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.38s/it, atk: -0.053 ent: -2.570 str: 0.000 loss: -2.624]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -0.053 ent: -2.570 str: 0.000 loss: -2.624]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -0.190 ent: -2.582 str: 0.000 loss: -2.772]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.190 ent: -2.582 str: 0.000 loss: -2.772]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.01s/it, atk: -0.578 ent: -2.578 str: 0.000 loss: -3.156]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -0.578 ent: -2.578 str: 0.000 loss: -3.156]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -0.706 ent: -2.576 str: 0.000 loss: -3.282]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -0.706 ent: -2.576 str: 0.000 loss: -3.282]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.31it/s, atk: -0.529 ent: -2.579 str: 0.000 loss: -3.108]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.42it/s, atk: -0.529 ent: -2.579 str: 0.000 loss: -3.108]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.42it/s, atk: -1.066 ent: -2.573 str: 0.000 loss: -3.640]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.49it/s, atk: -1.066 ent: -2.573 str: 0.000 loss: -3.640]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.49it/s, atk: -4.040 ent: -2.565 str: 0.000 loss: -6.605]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.59it/s, atk: -4.040 ent: -2.565 str: 0.000 loss: -6.605]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.59it/s, atk: -10.923 ent: -2.558 str: 0.000 loss: -13.481]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.65it/s, atk: -10.923 ent: -2.558 str: 0.000 loss: -13.481]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.65it/s, atk: -13.255 ent: -2.565 str: 0.000 loss: -15.820]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -13.255 ent: -2.565 str: 0.000 loss: -15.820]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.63it/s, atk: -21.063 ent: -2.559 str: 0.000 loss: -23.622]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.59it/s, atk: -21.063 ent: -2.559 str: 0.000 loss: -23.622]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.59it/s, atk: -26.592 ent: -2.550 str: 0.000 loss: -29.142]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -26.592 ent: -2.550 str: 0.000 loss: -29.142]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -35.724 ent: -2.551 str: 0.000 loss: -38.275]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.60it/s, atk: -35.724 ent: -2.551 str: 0.000 loss: -38.275]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.60it/s, atk: -45.818 ent: -2.546 str: 0.000 loss: -48.364]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.59it/s, atk: -45.818 ent: -2.546 str: 0.000 loss: -48.364]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.59it/s, atk: -53.694 ent: -2.545 str: 0.000 loss: -56.239]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -53.694 ent: -2.545 str: 0.000 loss: -56.239]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.55it/s, atk: -60.247 ent: -2.545 str: 0.000 loss: -62.792]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.42it/s, atk: -60.247 ent: -2.545 str: 0.000 loss: -62.792]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.42it/s, atk: -71.024 ent: -2.544 str: 0.000 loss: -73.568]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.51it/s, atk: -71.024 ent: -2.544 str: 0.000 loss: -73.568]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.51it/s, atk: -76.554 ent: -2.543 str: 0.000 loss: -79.097]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.50it/s, atk: -76.554 ent: -2.543 str: 0.000 loss: -79.097]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.50it/s, atk: -84.901 ent: -2.541 str: 0.000 loss: -87.443]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.57it/s, atk: -84.901 ent: -2.541 str: 0.000 loss: -87.443]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.57it/s, atk: -93.893 ent: -2.541 str: 0.000 loss: -96.435]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.53it/s, atk: -93.893 ent: -2.541 str: 0.000 loss: -96.435]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.53it/s, atk: -99.297 ent: -2.541 str: 0.000 loss: -101.839]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -99.297 ent: -2.541 str: 0.000 loss: -101.839]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.62it/s, atk: -103.125 ent: -2.541 str: 0.000 loss: -105.667]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.66it/s, atk: -103.125 ent: -2.541 str: 0.000 loss: -105.667]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.66it/s, atk: -103.298 ent: -2.542 str: 0.000 loss: -105.840]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.67it/s, atk: -103.298 ent: -2.542 str: 0.000 loss: -105.840]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.67it/s, atk: -108.548 ent: -2.544 str: 0.000 loss: -111.092]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.63it/s, atk: -108.548 ent: -2.544 str: 0.000 loss: -111.092]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.63it/s, atk: -106.661 ent: -2.550 str: 0.000 loss: -109.210]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -106.661 ent: -2.550 str: 0.000 loss: -109.210]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -106.646 ent: -2.549 str: 0.000 loss: -109.195]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.54it/s, atk: -106.646 ent: -2.549 str: 0.000 loss: -109.195]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.54it/s, atk: -106.366 ent: -2.549 str: 0.000 loss: -108.915]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.59it/s, atk: -106.366 ent: -2.549 str: 0.000 loss: -108.915]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.59it/s, atk: -108.684 ent: -2.552 str: 0.000 loss: -111.235]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.62it/s, atk: -108.684 ent: -2.552 str: 0.000 loss: -111.235]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.62it/s, atk: -110.477 ent: -2.553 str: 0.000 loss: -113.030]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.59it/s, atk: -110.477 ent: -2.553 str: 0.000 loss: -113.030]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.59it/s, atk: -112.041 ent: -2.554 str: 0.000 loss: -114.595]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.67it/s, atk: -112.041 ent: -2.554 str: 0.000 loss: -114.595]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.47it/s, atk: -112.041 ent: -2.554 str: 0.000 loss: -114.595]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([148], device='cuda:0') tensor(0.9986, device='cuda:0')
after_true: tensor([97], device='cuda:0') tensor(1.0031e-05, device='cuda:0')
L1: [2564.7766]	L2: [17.410913]	Linf: [0.6745098]

Accuracy on benign examples: 100.0%
gt_label: 959 pred_label: 959 pred_clean_logit 0.7862415909767151
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.63it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.08it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.59it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.84it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.91it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.56it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.46it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.89it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.10s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.27s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.51s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5020
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.789 ent: -4.894 str: 0.000 loss: -8.682]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.32s/it, atk: -3.789 ent: -4.894 str: 0.000 loss: -8.682]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.32s/it, atk: -7.709 ent: -4.883 str: 0.000 loss: -12.592]Iterations:   7%|▋         | 2/30 [00:01<00:23,  1.18it/s, atk: -7.709 ent: -4.883 str: 0.000 loss: -12.592]Iterations:   7%|▋         | 2/30 [00:02<00:23,  1.18it/s, atk: -17.138 ent: -4.876 str: 0.000 loss: -22.014]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.40it/s, atk: -17.138 ent: -4.876 str: 0.000 loss: -22.014]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.40it/s, atk: -25.491 ent: -4.871 str: 0.000 loss: -30.363]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.45it/s, atk: -25.491 ent: -4.871 str: 0.000 loss: -30.363]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.45it/s, atk: -35.774 ent: -4.872 str: 0.000 loss: -40.646]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.61it/s, atk: -35.774 ent: -4.872 str: 0.000 loss: -40.646]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.61it/s, atk: -46.664 ent: -4.873 str: 0.000 loss: -51.536]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.68it/s, atk: -46.664 ent: -4.873 str: 0.000 loss: -51.536]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.68it/s, atk: -51.405 ent: -4.872 str: 0.000 loss: -56.277]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.60it/s, atk: -51.405 ent: -4.872 str: 0.000 loss: -56.277]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.60it/s, atk: -58.864 ent: -4.872 str: 0.000 loss: -63.736]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.61it/s, atk: -58.864 ent: -4.872 str: 0.000 loss: -63.736]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.61it/s, atk: -62.348 ent: -4.870 str: 0.000 loss: -67.218]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.58it/s, atk: -62.348 ent: -4.870 str: 0.000 loss: -67.218]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.58it/s, atk: -69.256 ent: -4.871 str: 0.000 loss: -74.127]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.59it/s, atk: -69.256 ent: -4.871 str: 0.000 loss: -74.127]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.59it/s, atk: -75.771 ent: -4.872 str: 0.000 loss: -80.643]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.65it/s, atk: -75.771 ent: -4.872 str: 0.000 loss: -80.643]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.65it/s, atk: -81.446 ent: -4.868 str: 0.000 loss: -86.314]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.63it/s, atk: -81.446 ent: -4.868 str: 0.000 loss: -86.314]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.63it/s, atk: -87.254 ent: -4.869 str: 0.000 loss: -92.123]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.61it/s, atk: -87.254 ent: -4.869 str: 0.000 loss: -92.123]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.61it/s, atk: -90.464 ent: -4.868 str: 0.000 loss: -95.332]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.60it/s, atk: -90.464 ent: -4.868 str: 0.000 loss: -95.332]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.60it/s, atk: -95.739 ent: -4.869 str: 0.000 loss: -100.609]Iterations:  50%|█████     | 15/30 [00:09<00:09,  1.58it/s, atk: -95.739 ent: -4.869 str: 0.000 loss: -100.609]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.58it/s, atk: -100.850 ent: -4.871 str: 0.000 loss: -105.721]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.65it/s, atk: -100.850 ent: -4.871 str: 0.000 loss: -105.721]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.65it/s, atk: -104.217 ent: -4.872 str: 0.000 loss: -109.089]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.69it/s, atk: -104.217 ent: -4.872 str: 0.000 loss: -109.089]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.69it/s, atk: -108.835 ent: -4.870 str: 0.000 loss: -113.704]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.65it/s, atk: -108.835 ent: -4.870 str: 0.000 loss: -113.704]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.65it/s, atk: -112.613 ent: -4.869 str: 0.000 loss: -117.482]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.69it/s, atk: -112.613 ent: -4.869 str: 0.000 loss: -117.482]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.69it/s, atk: -117.227 ent: -4.868 str: 0.000 loss: -122.094]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.71it/s, atk: -117.227 ent: -4.868 str: 0.000 loss: -122.094]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.71it/s, atk: -122.578 ent: -4.867 str: 0.000 loss: -127.445]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.69it/s, atk: -122.578 ent: -4.867 str: 0.000 loss: -127.445]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.69it/s, atk: -125.776 ent: -4.868 str: 0.000 loss: -130.644]Iterations:  73%|███████▎  | 22/30 [00:13<00:04,  1.71it/s, atk: -125.776 ent: -4.868 str: 0.000 loss: -130.644]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.71it/s, atk: -128.372 ent: -4.869 str: 0.000 loss: -133.240]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.73it/s, atk: -128.372 ent: -4.869 str: 0.000 loss: -133.240]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.73it/s, atk: -131.920 ent: -4.870 str: 0.000 loss: -136.790]Iterations:  80%|████████  | 24/30 [00:14<00:03,  1.69it/s, atk: -131.920 ent: -4.870 str: 0.000 loss: -136.790]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.69it/s, atk: -135.637 ent: -4.867 str: 0.000 loss: -140.504]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  1.69it/s, atk: -135.637 ent: -4.867 str: 0.000 loss: -140.504]Iterations:  83%|████████▎ | 25/30 [00:15<00:02,  1.69it/s, atk: -138.900 ent: -4.863 str: 0.000 loss: -143.763]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.68it/s, atk: -138.900 ent: -4.863 str: 0.000 loss: -143.763]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.68it/s, atk: -142.559 ent: -4.863 str: 0.000 loss: -147.422]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  1.64it/s, atk: -142.559 ent: -4.863 str: 0.000 loss: -147.422]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.64it/s, atk: -145.851 ent: -4.865 str: 0.000 loss: -150.717]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.61it/s, atk: -145.851 ent: -4.865 str: 0.000 loss: -150.717]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.61it/s, atk: -147.397 ent: -4.865 str: 0.000 loss: -152.262]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.69it/s, atk: -147.397 ent: -4.865 str: 0.000 loss: -152.262]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.69it/s, atk: -150.759 ent: -4.868 str: 0.000 loss: -155.627]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.71it/s, atk: -150.759 ent: -4.868 str: 0.000 loss: -155.627]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.61it/s, atk: -150.759 ent: -4.868 str: 0.000 loss: -155.627]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([937], device='cuda:0') tensor(0.9994, device='cuda:0')
after_true: tensor([959], device='cuda:0') tensor(3.7250e-07, device='cuda:0')
L1: [3000.5488]	L2: [19.533157]	Linf: [0.77254903]

Accuracy on benign examples: 100.0%
gt_label: 541 pred_label: 541 pred_clean_logit 0.9360888600349426
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.54it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.08it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.77it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.98it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.24it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.98it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 18.02it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.71it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.30s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.47s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.48s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.51s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5142
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.588 ent: -2.688 str: 0.000 loss: -3.276]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.31s/it, atk: -0.588 ent: -2.688 str: 0.000 loss: -3.276]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.31s/it, atk: -2.346 ent: -2.680 str: 0.000 loss: -5.027]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.11it/s, atk: -2.346 ent: -2.680 str: 0.000 loss: -5.027]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.11it/s, atk: -18.045 ent: -2.678 str: 0.000 loss: -20.723]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.28it/s, atk: -18.045 ent: -2.678 str: 0.000 loss: -20.723]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.28it/s, atk: -37.667 ent: -2.671 str: 0.000 loss: -40.338]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -37.667 ent: -2.671 str: 0.000 loss: -40.338]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -54.708 ent: -2.667 str: 0.000 loss: -57.375]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.50it/s, atk: -54.708 ent: -2.667 str: 0.000 loss: -57.375]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.50it/s, atk: -64.410 ent: -2.666 str: 0.000 loss: -67.077]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.55it/s, atk: -64.410 ent: -2.666 str: 0.000 loss: -67.077]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.55it/s, atk: -75.154 ent: -2.666 str: 0.000 loss: -77.819]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -75.154 ent: -2.666 str: 0.000 loss: -77.819]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.50it/s, atk: -82.280 ent: -2.665 str: 0.000 loss: -84.945]Iterations:  27%|██▋       | 8/30 [00:05<00:15,  1.46it/s, atk: -82.280 ent: -2.665 str: 0.000 loss: -84.945]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -85.569 ent: -2.663 str: 0.000 loss: -88.232]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.52it/s, atk: -85.569 ent: -2.663 str: 0.000 loss: -88.232]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.52it/s, atk: -93.731 ent: -2.662 str: 0.000 loss: -96.394]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.47it/s, atk: -93.731 ent: -2.662 str: 0.000 loss: -96.394]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.47it/s, atk: -99.128 ent: -2.663 str: 0.000 loss: -101.791]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.48it/s, atk: -99.128 ent: -2.663 str: 0.000 loss: -101.791]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.48it/s, atk: -105.676 ent: -2.661 str: 0.000 loss: -108.336]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.46it/s, atk: -105.676 ent: -2.661 str: 0.000 loss: -108.336]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.46it/s, atk: -107.795 ent: -2.658 str: 0.000 loss: -110.453]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.38it/s, atk: -107.795 ent: -2.658 str: 0.000 loss: -110.453]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.38it/s, atk: -112.837 ent: -2.657 str: 0.000 loss: -115.495]Iterations:  47%|████▋     | 14/30 [00:09<00:11,  1.45it/s, atk: -112.837 ent: -2.657 str: 0.000 loss: -115.495]Iterations:  47%|████▋     | 14/30 [00:10<00:11,  1.45it/s, atk: -118.687 ent: -2.657 str: 0.000 loss: -121.344]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.48it/s, atk: -118.687 ent: -2.657 str: 0.000 loss: -121.344]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.48it/s, atk: -122.439 ent: -2.657 str: 0.000 loss: -125.096]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -122.439 ent: -2.657 str: 0.000 loss: -125.096]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -127.533 ent: -2.657 str: 0.000 loss: -130.190]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.59it/s, atk: -127.533 ent: -2.657 str: 0.000 loss: -130.190]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.59it/s, atk: -132.034 ent: -2.657 str: 0.000 loss: -134.691]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.64it/s, atk: -132.034 ent: -2.657 str: 0.000 loss: -134.691]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.64it/s, atk: -135.621 ent: -2.657 str: 0.000 loss: -138.278]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.61it/s, atk: -135.621 ent: -2.657 str: 0.000 loss: -138.278]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -140.889 ent: -2.657 str: 0.000 loss: -143.547]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.62it/s, atk: -140.889 ent: -2.657 str: 0.000 loss: -143.547]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.62it/s, atk: -144.519 ent: -2.656 str: 0.000 loss: -147.175]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -144.519 ent: -2.656 str: 0.000 loss: -147.175]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -148.194 ent: -2.656 str: 0.000 loss: -150.850]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.65it/s, atk: -148.194 ent: -2.656 str: 0.000 loss: -150.850]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.65it/s, atk: -154.896 ent: -2.657 str: 0.000 loss: -157.552]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.53it/s, atk: -154.896 ent: -2.657 str: 0.000 loss: -157.552]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.53it/s, atk: -159.928 ent: -2.656 str: 0.000 loss: -162.585]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.60it/s, atk: -159.928 ent: -2.656 str: 0.000 loss: -162.585]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.60it/s, atk: -163.911 ent: -2.656 str: 0.000 loss: -166.566]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.56it/s, atk: -163.911 ent: -2.656 str: 0.000 loss: -166.566]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -168.849 ent: -2.656 str: 0.000 loss: -171.504]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.55it/s, atk: -168.849 ent: -2.656 str: 0.000 loss: -171.504]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.55it/s, atk: -172.801 ent: -2.655 str: 0.000 loss: -175.457]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.50it/s, atk: -172.801 ent: -2.655 str: 0.000 loss: -175.457]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.50it/s, atk: -176.741 ent: -2.656 str: 0.000 loss: -179.396]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.50it/s, atk: -176.741 ent: -2.656 str: 0.000 loss: -179.396]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.50it/s, atk: -180.960 ent: -2.655 str: 0.000 loss: -183.615]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -180.960 ent: -2.655 str: 0.000 loss: -183.615]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -185.214 ent: -2.655 str: 0.000 loss: -187.869]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.54it/s, atk: -185.214 ent: -2.655 str: 0.000 loss: -187.869]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.50it/s, atk: -185.214 ent: -2.655 str: 0.000 loss: -187.869]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([778], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([541], device='cuda:0') tensor(6.1099e-09, device='cuda:0')
L1: [4292.769]	L2: [30.25729]	Linf: [0.8509804]

Accuracy on benign examples: 100.0%
gt_label: 900 pred_label: 900 pred_clean_logit 0.975042998790741
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.65it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.20it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.82it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.05it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 20.94it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 22.88it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 24.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.08it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.37s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.41s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3763
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.440 ent: -5.146 str: 0.000 loss: -5.586]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.38s/it, atk: -0.440 ent: -5.146 str: 0.000 loss: -5.586]Iterations:   3%|▎         | 1/30 [00:02<01:08,  2.38s/it, atk: -2.369 ent: -5.139 str: 0.000 loss: -7.507]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -2.369 ent: -5.139 str: 0.000 loss: -7.507]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.36s/it, atk: -8.813 ent: -5.135 str: 0.000 loss: -13.948]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.06s/it, atk: -8.813 ent: -5.135 str: 0.000 loss: -13.948]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.06s/it, atk: -18.196 ent: -5.131 str: 0.000 loss: -23.327]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -18.196 ent: -5.131 str: 0.000 loss: -23.327]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -29.034 ent: -5.129 str: 0.000 loss: -34.162]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -29.034 ent: -5.129 str: 0.000 loss: -34.162]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -37.315 ent: -5.125 str: 0.000 loss: -42.439]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -37.315 ent: -5.125 str: 0.000 loss: -42.439]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -46.125 ent: -5.121 str: 0.000 loss: -51.247]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -46.125 ent: -5.121 str: 0.000 loss: -51.247]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.35it/s, atk: -51.923 ent: -5.116 str: 0.000 loss: -57.038]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.44it/s, atk: -51.923 ent: -5.116 str: 0.000 loss: -57.038]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.44it/s, atk: -61.037 ent: -5.116 str: 0.000 loss: -66.153]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.47it/s, atk: -61.037 ent: -5.116 str: 0.000 loss: -66.153]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.47it/s, atk: -66.165 ent: -5.114 str: 0.000 loss: -71.279]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -66.165 ent: -5.114 str: 0.000 loss: -71.279]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.52it/s, atk: -67.490 ent: -5.116 str: 0.000 loss: -72.607]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.56it/s, atk: -67.490 ent: -5.116 str: 0.000 loss: -72.607]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.56it/s, atk: -76.317 ent: -5.115 str: 0.000 loss: -81.433]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.62it/s, atk: -76.317 ent: -5.115 str: 0.000 loss: -81.433]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.62it/s, atk: -80.444 ent: -5.114 str: 0.000 loss: -85.558]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.62it/s, atk: -80.444 ent: -5.114 str: 0.000 loss: -85.558]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.62it/s, atk: -85.682 ent: -5.114 str: 0.000 loss: -90.796]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.55it/s, atk: -85.682 ent: -5.114 str: 0.000 loss: -90.796]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.55it/s, atk: -87.039 ent: -5.109 str: 0.000 loss: -92.148]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.65it/s, atk: -87.039 ent: -5.109 str: 0.000 loss: -92.148]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.65it/s, atk: -92.721 ent: -5.108 str: 0.000 loss: -97.829]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.61it/s, atk: -92.721 ent: -5.108 str: 0.000 loss: -97.829]Iterations:  53%|█████▎    | 16/30 [00:12<00:08,  1.61it/s, atk: -96.639 ent: -5.111 str: 0.000 loss: -101.750]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.61it/s, atk: -96.639 ent: -5.111 str: 0.000 loss: -101.750]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.61it/s, atk: -101.388 ent: -5.109 str: 0.000 loss: -106.497]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.63it/s, atk: -101.388 ent: -5.109 str: 0.000 loss: -106.497]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.63it/s, atk: -104.592 ent: -5.107 str: 0.000 loss: -109.699]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.65it/s, atk: -104.592 ent: -5.107 str: 0.000 loss: -109.699]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.65it/s, atk: -108.224 ent: -5.105 str: 0.000 loss: -113.329]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.63it/s, atk: -108.224 ent: -5.105 str: 0.000 loss: -113.329]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.63it/s, atk: -112.265 ent: -5.104 str: 0.000 loss: -117.368]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -112.265 ent: -5.104 str: 0.000 loss: -117.368]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.68it/s, atk: -116.887 ent: -5.102 str: 0.000 loss: -121.988]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.58it/s, atk: -116.887 ent: -5.102 str: 0.000 loss: -121.988]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.58it/s, atk: -121.225 ent: -5.100 str: 0.000 loss: -126.325]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.62it/s, atk: -121.225 ent: -5.100 str: 0.000 loss: -126.325]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.62it/s, atk: -124.591 ent: -5.098 str: 0.000 loss: -129.689]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.61it/s, atk: -124.591 ent: -5.098 str: 0.000 loss: -129.689]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.61it/s, atk: -127.680 ent: -5.097 str: 0.000 loss: -132.776]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -127.680 ent: -5.097 str: 0.000 loss: -132.776]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -130.529 ent: -5.096 str: 0.000 loss: -135.625]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.66it/s, atk: -130.529 ent: -5.096 str: 0.000 loss: -135.625]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.66it/s, atk: -132.983 ent: -5.095 str: 0.000 loss: -138.078]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.63it/s, atk: -132.983 ent: -5.095 str: 0.000 loss: -138.078]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.63it/s, atk: -135.382 ent: -5.093 str: 0.000 loss: -140.475]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.59it/s, atk: -135.382 ent: -5.093 str: 0.000 loss: -140.475]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.59it/s, atk: -138.045 ent: -5.092 str: 0.000 loss: -143.137]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.56it/s, atk: -138.045 ent: -5.092 str: 0.000 loss: -143.137]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.56it/s, atk: -140.354 ent: -5.092 str: 0.000 loss: -145.445]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.55it/s, atk: -140.354 ent: -5.092 str: 0.000 loss: -145.445]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.45it/s, atk: -140.354 ent: -5.092 str: 0.000 loss: -145.445]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([557], device='cuda:0') tensor(0.8237, device='cuda:0')
after_true: tensor([900], device='cuda:0') tensor(6.4608e-07, device='cuda:0')
L1: [2354.9294]	L2: [17.074247]	Linf: [0.76862746]

Accuracy on benign examples: 100.0%
gt_label: 865 pred_label: 865 pred_clean_logit 0.9793816804885864
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.46it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.28it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.56it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 20.31it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 21.77it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.72it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.62it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.59it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.32s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.20s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.26s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.35s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.43s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5207
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.172 ent: -4.906 str: 0.000 loss: -5.078]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.16s/it, atk: -0.172 ent: -4.906 str: 0.000 loss: -5.078]Iterations:   3%|▎         | 1/30 [00:01<00:33,  1.16s/it, atk: -0.304 ent: -4.901 str: 0.000 loss: -5.205]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.24it/s, atk: -0.304 ent: -4.901 str: 0.000 loss: -5.205]Iterations:   7%|▋         | 2/30 [00:02<00:22,  1.24it/s, atk: -0.684 ent: -4.897 str: 0.000 loss: -5.580]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.25it/s, atk: -0.684 ent: -4.897 str: 0.000 loss: -5.580]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.25it/s, atk: -1.268 ent: -4.898 str: 0.000 loss: -6.166]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -1.268 ent: -4.898 str: 0.000 loss: -6.166]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -2.589 ent: -4.893 str: 0.000 loss: -7.481]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.50it/s, atk: -2.589 ent: -4.893 str: 0.000 loss: -7.481]Iterations:  17%|█▋        | 5/30 [00:04<00:16,  1.50it/s, atk: -4.981 ent: -4.894 str: 0.000 loss: -9.875]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.54it/s, atk: -4.981 ent: -4.894 str: 0.000 loss: -9.875]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.54it/s, atk: -7.086 ent: -4.898 str: 0.000 loss: -11.984]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.54it/s, atk: -7.086 ent: -4.898 str: 0.000 loss: -11.984]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.54it/s, atk: -11.828 ent: -4.896 str: 0.000 loss: -16.724]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.61it/s, atk: -11.828 ent: -4.896 str: 0.000 loss: -16.724]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.61it/s, atk: -16.591 ent: -4.895 str: 0.000 loss: -21.486]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.59it/s, atk: -16.591 ent: -4.895 str: 0.000 loss: -21.486]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.59it/s, atk: -22.249 ent: -4.894 str: 0.000 loss: -27.142]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.59it/s, atk: -22.249 ent: -4.894 str: 0.000 loss: -27.142]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.59it/s, atk: -29.119 ent: -4.896 str: 0.000 loss: -34.016]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.63it/s, atk: -29.119 ent: -4.896 str: 0.000 loss: -34.016]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.63it/s, atk: -33.990 ent: -4.898 str: 0.000 loss: -38.888]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.64it/s, atk: -33.990 ent: -4.898 str: 0.000 loss: -38.888]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.64it/s, atk: -33.623 ent: -4.895 str: 0.000 loss: -38.518]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.67it/s, atk: -33.623 ent: -4.895 str: 0.000 loss: -38.518]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.67it/s, atk: -42.010 ent: -4.892 str: 0.000 loss: -46.902]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.67it/s, atk: -42.010 ent: -4.892 str: 0.000 loss: -46.902]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.67it/s, atk: -46.960 ent: -4.890 str: 0.000 loss: -51.850]Iterations:  50%|█████     | 15/30 [00:09<00:09,  1.63it/s, atk: -46.960 ent: -4.890 str: 0.000 loss: -51.850]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.63it/s, atk: -54.891 ent: -4.889 str: 0.000 loss: -59.780]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.61it/s, atk: -54.891 ent: -4.889 str: 0.000 loss: -59.780]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.61it/s, atk: -59.887 ent: -4.888 str: 0.000 loss: -64.776]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.68it/s, atk: -59.887 ent: -4.888 str: 0.000 loss: -64.776]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.68it/s, atk: -65.349 ent: -4.888 str: 0.000 loss: -70.237]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.68it/s, atk: -65.349 ent: -4.888 str: 0.000 loss: -70.237]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.68it/s, atk: -69.548 ent: -4.887 str: 0.000 loss: -74.435]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.58it/s, atk: -69.548 ent: -4.887 str: 0.000 loss: -74.435]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.58it/s, atk: -73.518 ent: -4.886 str: 0.000 loss: -78.404]Iterations:  67%|██████▋   | 20/30 [00:12<00:06,  1.54it/s, atk: -73.518 ent: -4.886 str: 0.000 loss: -78.404]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.54it/s, atk: -80.474 ent: -4.886 str: 0.000 loss: -85.360]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.60it/s, atk: -80.474 ent: -4.886 str: 0.000 loss: -85.360]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.60it/s, atk: -86.700 ent: -4.885 str: 0.000 loss: -91.585]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.59it/s, atk: -86.700 ent: -4.885 str: 0.000 loss: -91.585]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.59it/s, atk: -90.632 ent: -4.885 str: 0.000 loss: -95.517]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.59it/s, atk: -90.632 ent: -4.885 str: 0.000 loss: -95.517]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.59it/s, atk: -96.526 ent: -4.885 str: 0.000 loss: -101.412]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.55it/s, atk: -96.526 ent: -4.885 str: 0.000 loss: -101.412]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.55it/s, atk: -101.193 ent: -4.885 str: 0.000 loss: -106.078]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.57it/s, atk: -101.193 ent: -4.885 str: 0.000 loss: -106.078]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.57it/s, atk: -107.909 ent: -4.883 str: 0.000 loss: -112.793]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.60it/s, atk: -107.909 ent: -4.883 str: 0.000 loss: -112.793]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.60it/s, atk: -113.199 ent: -4.884 str: 0.000 loss: -118.083]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.60it/s, atk: -113.199 ent: -4.884 str: 0.000 loss: -118.083]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.60it/s, atk: -117.643 ent: -4.883 str: 0.000 loss: -122.526]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.60it/s, atk: -117.643 ent: -4.883 str: 0.000 loss: -122.526]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.60it/s, atk: -124.082 ent: -4.882 str: 0.000 loss: -128.963]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.60it/s, atk: -124.082 ent: -4.882 str: 0.000 loss: -128.963]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.60it/s, atk: -128.737 ent: -4.881 str: 0.000 loss: -133.618]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.61it/s, atk: -128.737 ent: -4.881 str: 0.000 loss: -133.618]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.56it/s, atk: -128.737 ent: -4.881 str: 0.000 loss: -133.618]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([463], device='cuda:0') tensor(0.9889, device='cuda:0')
after_true: tensor([865], device='cuda:0') tensor(1.4379e-06, device='cuda:0')
L1: [4063.106]	L2: [30.189331]	Linf: [0.9098039]

Accuracy on benign examples: 100.0%
gt_label: 33 pred_label: 33 pred_clean_logit 0.5879011750221252
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 10.92it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.08it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.41it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.67it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.68it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 19.35it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.97it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.39it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.58s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.37s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.43s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.52s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4106
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -8.016 ent: -8.481 str: 0.000 loss: -16.497]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.45s/it, atk: -8.016 ent: -8.481 str: 0.000 loss: -16.497]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.45s/it, atk: -15.007 ent: -8.416 str: 0.000 loss: -23.423]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -15.007 ent: -8.416 str: 0.000 loss: -23.423]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.03it/s, atk: -21.885 ent: -8.358 str: 0.000 loss: -30.243]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.22it/s, atk: -21.885 ent: -8.358 str: 0.000 loss: -30.243]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.22it/s, atk: -31.620 ent: -8.345 str: 0.000 loss: -39.965]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.37it/s, atk: -31.620 ent: -8.345 str: 0.000 loss: -39.965]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.37it/s, atk: -36.074 ent: -8.333 str: 0.000 loss: -44.408]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.45it/s, atk: -36.074 ent: -8.333 str: 0.000 loss: -44.408]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.45it/s, atk: -44.804 ent: -8.324 str: 0.000 loss: -53.128]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.51it/s, atk: -44.804 ent: -8.324 str: 0.000 loss: -53.128]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.51it/s, atk: -49.878 ent: -8.326 str: 0.000 loss: -58.204]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -49.878 ent: -8.326 str: 0.000 loss: -58.204]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -54.572 ent: -8.331 str: 0.000 loss: -62.902]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.54it/s, atk: -54.572 ent: -8.331 str: 0.000 loss: -62.902]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.54it/s, atk: -59.394 ent: -8.329 str: 0.000 loss: -67.723]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.56it/s, atk: -59.394 ent: -8.329 str: 0.000 loss: -67.723]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.56it/s, atk: -66.108 ent: -8.321 str: 0.000 loss: -74.429]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -66.108 ent: -8.321 str: 0.000 loss: -74.429]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -73.109 ent: -8.338 str: 0.000 loss: -81.447]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.60it/s, atk: -73.109 ent: -8.338 str: 0.000 loss: -81.447]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.60it/s, atk: -76.203 ent: -8.344 str: 0.000 loss: -84.547]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.63it/s, atk: -76.203 ent: -8.344 str: 0.000 loss: -84.547]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.63it/s, atk: -87.761 ent: -8.351 str: 0.000 loss: -96.112]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.59it/s, atk: -87.761 ent: -8.351 str: 0.000 loss: -96.112]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.59it/s, atk: -92.400 ent: -8.353 str: 0.000 loss: -100.753]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.64it/s, atk: -92.400 ent: -8.353 str: 0.000 loss: -100.753]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.64it/s, atk: -98.307 ent: -8.348 str: 0.000 loss: -106.656]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.66it/s, atk: -98.307 ent: -8.348 str: 0.000 loss: -106.656]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.66it/s, atk: -102.336 ent: -8.345 str: 0.000 loss: -110.680]Iterations:  53%|█████▎    | 16/30 [00:10<00:09,  1.52it/s, atk: -102.336 ent: -8.345 str: 0.000 loss: -110.680]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.52it/s, atk: -113.560 ent: -8.337 str: 0.000 loss: -121.897]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.54it/s, atk: -113.560 ent: -8.337 str: 0.000 loss: -121.897]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.54it/s, atk: -120.105 ent: -8.321 str: 0.000 loss: -128.426]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.60it/s, atk: -120.105 ent: -8.321 str: 0.000 loss: -128.426]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.60it/s, atk: -128.966 ent: -8.318 str: 0.000 loss: -137.284]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.58it/s, atk: -128.966 ent: -8.318 str: 0.000 loss: -137.284]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.58it/s, atk: -138.336 ent: -8.327 str: 0.000 loss: -146.663]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.63it/s, atk: -138.336 ent: -8.327 str: 0.000 loss: -146.663]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.63it/s, atk: -148.268 ent: -8.328 str: 0.000 loss: -156.597]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.67it/s, atk: -148.268 ent: -8.328 str: 0.000 loss: -156.597]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.67it/s, atk: -156.111 ent: -8.328 str: 0.000 loss: -164.439]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.56it/s, atk: -156.111 ent: -8.328 str: 0.000 loss: -164.439]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.56it/s, atk: -154.926 ent: -8.321 str: 0.000 loss: -163.248]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.58it/s, atk: -154.926 ent: -8.321 str: 0.000 loss: -163.248]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.58it/s, atk: -163.712 ent: -8.318 str: 0.000 loss: -172.031]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.57it/s, atk: -163.712 ent: -8.318 str: 0.000 loss: -172.031]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.57it/s, atk: -173.500 ent: -8.318 str: 0.000 loss: -181.819]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.55it/s, atk: -173.500 ent: -8.318 str: 0.000 loss: -181.819]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.55it/s, atk: -182.495 ent: -8.319 str: 0.000 loss: -190.815]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.51it/s, atk: -182.495 ent: -8.319 str: 0.000 loss: -190.815]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.51it/s, atk: -189.834 ent: -8.319 str: 0.000 loss: -198.153]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.56it/s, atk: -189.834 ent: -8.319 str: 0.000 loss: -198.153]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -196.962 ent: -8.317 str: 0.000 loss: -205.279]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.51it/s, atk: -196.962 ent: -8.317 str: 0.000 loss: -205.279]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.51it/s, atk: -204.102 ent: -8.312 str: 0.000 loss: -212.414]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.54it/s, atk: -204.102 ent: -8.312 str: 0.000 loss: -212.414]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.54it/s, atk: -210.430 ent: -8.305 str: 0.000 loss: -218.735]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.61it/s, atk: -210.430 ent: -8.305 str: 0.000 loss: -218.735]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.53it/s, atk: -210.430 ent: -8.305 str: 0.000 loss: -218.735]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([68], device='cuda:0') tensor(0.7081, device='cuda:0')
after_true: tensor([33], device='cuda:0') tensor(4.4865e-10, device='cuda:0')
L1: [2463.5022]	L2: [16.191837]	Linf: [0.5137255]

Accuracy on benign examples: 100.0%
gt_label: 146 pred_label: 146 pred_clean_logit 0.9989702701568604
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.21it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 12.61it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.90it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.38it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.21it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 21.50it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 23.02it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.30it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.41s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.20s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.35s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.43s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3369
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -5.038 str: 0.000 loss: -5.041]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.39s/it, atk: -0.003 ent: -5.038 str: 0.000 loss: -5.041]Iterations:   3%|▎         | 1/30 [00:01<00:40,  1.39s/it, atk: -0.002 ent: -5.059 str: 0.000 loss: -5.061]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -0.002 ent: -5.059 str: 0.000 loss: -5.061]Iterations:   7%|▋         | 2/30 [00:02<00:27,  1.01it/s, atk: -0.004 ent: -5.088 str: 0.000 loss: -5.092]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.21it/s, atk: -0.004 ent: -5.088 str: 0.000 loss: -5.092]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.21it/s, atk: -0.010 ent: -5.114 str: 0.000 loss: -5.124]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -0.010 ent: -5.114 str: 0.000 loss: -5.124]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.35it/s, atk: -0.035 ent: -5.135 str: 0.000 loss: -5.169]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.46it/s, atk: -0.035 ent: -5.135 str: 0.000 loss: -5.169]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.46it/s, atk: -0.111 ent: -5.150 str: 0.000 loss: -5.261]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.48it/s, atk: -0.111 ent: -5.150 str: 0.000 loss: -5.261]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.48it/s, atk: -0.334 ent: -5.160 str: 0.000 loss: -5.494]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -0.334 ent: -5.160 str: 0.000 loss: -5.494]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -0.879 ent: -5.163 str: 0.000 loss: -6.043]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.58it/s, atk: -0.879 ent: -5.163 str: 0.000 loss: -6.043]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.58it/s, atk: -1.797 ent: -5.165 str: 0.000 loss: -6.962]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.56it/s, atk: -1.797 ent: -5.165 str: 0.000 loss: -6.962]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.56it/s, atk: -3.045 ent: -5.162 str: 0.000 loss: -8.206]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.52it/s, atk: -3.045 ent: -5.162 str: 0.000 loss: -8.206]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.52it/s, atk: -5.222 ent: -5.161 str: 0.000 loss: -10.383]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.61it/s, atk: -5.222 ent: -5.161 str: 0.000 loss: -10.383]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.61it/s, atk: -9.235 ent: -5.158 str: 0.000 loss: -14.393]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.62it/s, atk: -9.235 ent: -5.158 str: 0.000 loss: -14.393]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.62it/s, atk: -14.321 ent: -5.157 str: 0.000 loss: -19.478]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.51it/s, atk: -14.321 ent: -5.157 str: 0.000 loss: -19.478]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.51it/s, atk: -18.999 ent: -5.157 str: 0.000 loss: -24.156]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.54it/s, atk: -18.999 ent: -5.157 str: 0.000 loss: -24.156]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -24.138 ent: -5.155 str: 0.000 loss: -29.293]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.57it/s, atk: -24.138 ent: -5.155 str: 0.000 loss: -29.293]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.57it/s, atk: -29.613 ent: -5.154 str: 0.000 loss: -34.767]Iterations:  53%|█████▎    | 16/30 [00:10<00:09,  1.55it/s, atk: -29.613 ent: -5.154 str: 0.000 loss: -34.767]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -34.734 ent: -5.152 str: 0.000 loss: -39.886]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -34.734 ent: -5.152 str: 0.000 loss: -39.886]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -39.382 ent: -5.151 str: 0.000 loss: -44.532]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -39.382 ent: -5.151 str: 0.000 loss: -44.532]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -43.701 ent: -5.149 str: 0.000 loss: -48.850]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.60it/s, atk: -43.701 ent: -5.149 str: 0.000 loss: -48.850]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.60it/s, atk: -47.473 ent: -5.148 str: 0.000 loss: -52.621]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.66it/s, atk: -47.473 ent: -5.148 str: 0.000 loss: -52.621]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.66it/s, atk: -51.159 ent: -5.147 str: 0.000 loss: -56.305]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.62it/s, atk: -51.159 ent: -5.147 str: 0.000 loss: -56.305]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.62it/s, atk: -54.731 ent: -5.145 str: 0.000 loss: -59.877]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.55it/s, atk: -54.731 ent: -5.145 str: 0.000 loss: -59.877]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.55it/s, atk: -58.502 ent: -5.143 str: 0.000 loss: -63.645]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.49it/s, atk: -58.502 ent: -5.143 str: 0.000 loss: -63.645]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.49it/s, atk: -63.125 ent: -5.142 str: 0.000 loss: -68.267]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.51it/s, atk: -63.125 ent: -5.142 str: 0.000 loss: -68.267]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.51it/s, atk: -67.091 ent: -5.140 str: 0.000 loss: -72.231]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.57it/s, atk: -67.091 ent: -5.140 str: 0.000 loss: -72.231]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.57it/s, atk: -70.966 ent: -5.137 str: 0.000 loss: -76.103]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.57it/s, atk: -70.966 ent: -5.137 str: 0.000 loss: -76.103]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.57it/s, atk: -73.615 ent: -5.134 str: 0.000 loss: -78.749]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.60it/s, atk: -73.615 ent: -5.134 str: 0.000 loss: -78.749]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.60it/s, atk: -76.836 ent: -5.135 str: 0.000 loss: -81.970]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.62it/s, atk: -76.836 ent: -5.135 str: 0.000 loss: -81.970]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.62it/s, atk: -79.378 ent: -5.134 str: 0.000 loss: -84.513]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.67it/s, atk: -79.378 ent: -5.134 str: 0.000 loss: -84.513]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.67it/s, atk: -83.106 ent: -5.134 str: 0.000 loss: -88.239]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.63it/s, atk: -83.106 ent: -5.134 str: 0.000 loss: -88.239]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.53it/s, atk: -83.106 ent: -5.134 str: 0.000 loss: -88.239]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([143], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([146], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [2158.5137]	L2: [15.80206]	Linf: [0.8]

Accuracy on benign examples: 100.0%
gt_label: 661 pred_label: 661 pred_clean_logit 0.8802207112312317
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.80it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.31it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.69it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 20.51it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.27it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.22it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.35s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.31s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5733
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.702 ent: -5.268 str: 0.000 loss: -5.970]Iterations:   3%|▎         | 1/30 [00:01<00:31,  1.10s/it, atk: -0.702 ent: -5.268 str: 0.000 loss: -5.970]Iterations:   3%|▎         | 1/30 [00:01<00:31,  1.10s/it, atk: -3.845 ent: -5.271 str: 0.000 loss: -9.116]Iterations:   7%|▋         | 2/30 [00:01<00:23,  1.20it/s, atk: -3.845 ent: -5.271 str: 0.000 loss: -9.116]Iterations:   7%|▋         | 2/30 [00:02<00:23,  1.20it/s, atk: -10.592 ent: -5.272 str: 0.000 loss: -15.864]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.34it/s, atk: -10.592 ent: -5.272 str: 0.000 loss: -15.864]Iterations:  10%|█         | 3/30 [00:02<00:20,  1.34it/s, atk: -18.110 ent: -5.272 str: 0.000 loss: -23.382]Iterations:  13%|█▎        | 4/30 [00:02<00:17,  1.44it/s, atk: -18.110 ent: -5.272 str: 0.000 loss: -23.382]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.44it/s, atk: -24.962 ent: -5.274 str: 0.000 loss: -30.236]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.44it/s, atk: -24.962 ent: -5.274 str: 0.000 loss: -30.236]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.44it/s, atk: -30.461 ent: -5.267 str: 0.000 loss: -35.728]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.40it/s, atk: -30.461 ent: -5.267 str: 0.000 loss: -35.728]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.40it/s, atk: -35.592 ent: -5.265 str: 0.000 loss: -40.857]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -35.592 ent: -5.265 str: 0.000 loss: -40.857]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -42.711 ent: -5.267 str: 0.000 loss: -47.979]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.53it/s, atk: -42.711 ent: -5.267 str: 0.000 loss: -47.979]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.53it/s, atk: -47.471 ent: -5.270 str: 0.000 loss: -52.741]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.54it/s, atk: -47.471 ent: -5.270 str: 0.000 loss: -52.741]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.54it/s, atk: -51.377 ent: -5.271 str: 0.000 loss: -56.648]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.48it/s, atk: -51.377 ent: -5.271 str: 0.000 loss: -56.648]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.48it/s, atk: -55.136 ent: -5.271 str: 0.000 loss: -60.408]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.57it/s, atk: -55.136 ent: -5.271 str: 0.000 loss: -60.408]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.57it/s, atk: -59.114 ent: -5.270 str: 0.000 loss: -64.384]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.56it/s, atk: -59.114 ent: -5.270 str: 0.000 loss: -64.384]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.56it/s, atk: -62.727 ent: -5.268 str: 0.000 loss: -67.995]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.59it/s, atk: -62.727 ent: -5.268 str: 0.000 loss: -67.995]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.59it/s, atk: -65.324 ent: -5.266 str: 0.000 loss: -70.590]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.57it/s, atk: -65.324 ent: -5.266 str: 0.000 loss: -70.590]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.57it/s, atk: -68.307 ent: -5.265 str: 0.000 loss: -73.572]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -68.307 ent: -5.265 str: 0.000 loss: -73.572]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -70.598 ent: -5.265 str: 0.000 loss: -75.863]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.64it/s, atk: -70.598 ent: -5.265 str: 0.000 loss: -75.863]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.64it/s, atk: -73.213 ent: -5.264 str: 0.000 loss: -78.478]Iterations:  57%|█████▋    | 17/30 [00:11<00:09,  1.43it/s, atk: -73.213 ent: -5.264 str: 0.000 loss: -78.478]Iterations:  57%|█████▋    | 17/30 [00:11<00:09,  1.43it/s, atk: -75.974 ent: -5.263 str: 0.000 loss: -81.237]Iterations:  60%|██████    | 18/30 [00:12<00:08,  1.48it/s, atk: -75.974 ent: -5.263 str: 0.000 loss: -81.237]Iterations:  60%|██████    | 18/30 [00:12<00:08,  1.48it/s, atk: -79.218 ent: -5.263 str: 0.000 loss: -84.482]Iterations:  63%|██████▎   | 19/30 [00:12<00:07,  1.56it/s, atk: -79.218 ent: -5.263 str: 0.000 loss: -84.482]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.56it/s, atk: -81.687 ent: -5.263 str: 0.000 loss: -86.950]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.62it/s, atk: -81.687 ent: -5.263 str: 0.000 loss: -86.950]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.62it/s, atk: -84.144 ent: -5.263 str: 0.000 loss: -89.407]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.64it/s, atk: -84.144 ent: -5.263 str: 0.000 loss: -89.407]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.64it/s, atk: -86.698 ent: -5.263 str: 0.000 loss: -91.961]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.66it/s, atk: -86.698 ent: -5.263 str: 0.000 loss: -91.961]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.66it/s, atk: -89.441 ent: -5.263 str: 0.000 loss: -94.705]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.59it/s, atk: -89.441 ent: -5.263 str: 0.000 loss: -94.705]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.59it/s, atk: -92.083 ent: -5.264 str: 0.000 loss: -97.346]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.59it/s, atk: -92.083 ent: -5.264 str: 0.000 loss: -97.346]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.59it/s, atk: -94.733 ent: -5.264 str: 0.000 loss: -99.996]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.58it/s, atk: -94.733 ent: -5.264 str: 0.000 loss: -99.996]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.58it/s, atk: -97.422 ent: -5.264 str: 0.000 loss: -102.686]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.60it/s, atk: -97.422 ent: -5.264 str: 0.000 loss: -102.686]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.60it/s, atk: -99.893 ent: -5.265 str: 0.000 loss: -105.158]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.59it/s, atk: -99.893 ent: -5.265 str: 0.000 loss: -105.158]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.59it/s, atk: -102.611 ent: -5.265 str: 0.000 loss: -107.877]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.61it/s, atk: -102.611 ent: -5.265 str: 0.000 loss: -107.877]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.61it/s, atk: -105.454 ent: -5.265 str: 0.000 loss: -110.719]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.66it/s, atk: -105.454 ent: -5.265 str: 0.000 loss: -110.719]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.66it/s, atk: -108.120 ent: -5.265 str: 0.000 loss: -113.385]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.63it/s, atk: -108.120 ent: -5.265 str: 0.000 loss: -113.385]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.54it/s, atk: -108.120 ent: -5.265 str: 0.000 loss: -113.385]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([511], device='cuda:0') tensor(0.9626, device='cuda:0')
after_true: tensor([661], device='cuda:0') tensor(1.6191e-05, device='cuda:0')
L1: [2687.506]	L2: [20.043955]	Linf: [0.7372549]

Accuracy on benign examples: 100.0%
gt_label: 995 pred_label: 995 pred_clean_logit 0.45755332708358765
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 22.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 22.94it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 23.09it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 22.99it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 23.62it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.87it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.09it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.52s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.35s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.51s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5081
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -7.494 ent: -4.758 str: 0.000 loss: -12.252]Iterations:   3%|▎         | 1/30 [00:01<00:47,  1.63s/it, atk: -7.494 ent: -4.758 str: 0.000 loss: -12.252]Iterations:   3%|▎         | 1/30 [00:02<00:47,  1.63s/it, atk: -17.137 ent: -4.767 str: 0.000 loss: -21.904]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.04s/it, atk: -17.137 ent: -4.767 str: 0.000 loss: -21.904]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.04s/it, atk: -25.417 ent: -4.765 str: 0.000 loss: -30.182]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.19it/s, atk: -25.417 ent: -4.765 str: 0.000 loss: -30.182]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.19it/s, atk: -33.869 ent: -4.763 str: 0.000 loss: -38.632]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -33.869 ent: -4.763 str: 0.000 loss: -38.632]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.32it/s, atk: -40.073 ent: -4.762 str: 0.000 loss: -44.835]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.44it/s, atk: -40.073 ent: -4.762 str: 0.000 loss: -44.835]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.44it/s, atk: -45.990 ent: -4.763 str: 0.000 loss: -50.753]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.49it/s, atk: -45.990 ent: -4.763 str: 0.000 loss: -50.753]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.49it/s, atk: -51.744 ent: -4.763 str: 0.000 loss: -56.507]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -51.744 ent: -4.763 str: 0.000 loss: -56.507]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -54.930 ent: -4.764 str: 0.000 loss: -59.694]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -54.930 ent: -4.764 str: 0.000 loss: -59.694]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -60.521 ent: -4.762 str: 0.000 loss: -65.284]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.52it/s, atk: -60.521 ent: -4.762 str: 0.000 loss: -65.284]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.52it/s, atk: -62.066 ent: -4.760 str: 0.000 loss: -66.826]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.50it/s, atk: -62.066 ent: -4.760 str: 0.000 loss: -66.826]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.50it/s, atk: -67.482 ent: -4.759 str: 0.000 loss: -72.241]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.59it/s, atk: -67.482 ent: -4.759 str: 0.000 loss: -72.241]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.59it/s, atk: -72.000 ent: -4.759 str: 0.000 loss: -76.759]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.64it/s, atk: -72.000 ent: -4.759 str: 0.000 loss: -76.759]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.64it/s, atk: -76.069 ent: -4.760 str: 0.000 loss: -80.829]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.67it/s, atk: -76.069 ent: -4.760 str: 0.000 loss: -80.829]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.67it/s, atk: -79.635 ent: -4.760 str: 0.000 loss: -84.395]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.72it/s, atk: -79.635 ent: -4.760 str: 0.000 loss: -84.395]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.72it/s, atk: -82.485 ent: -4.761 str: 0.000 loss: -87.246]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.73it/s, atk: -82.485 ent: -4.761 str: 0.000 loss: -87.246]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.73it/s, atk: -85.955 ent: -4.761 str: 0.000 loss: -90.716]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.71it/s, atk: -85.955 ent: -4.761 str: 0.000 loss: -90.716]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.71it/s, atk: -89.995 ent: -4.761 str: 0.000 loss: -94.756]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.72it/s, atk: -89.995 ent: -4.761 str: 0.000 loss: -94.756]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.72it/s, atk: -93.110 ent: -4.761 str: 0.000 loss: -97.871]Iterations:  60%|██████    | 18/30 [00:11<00:06,  1.75it/s, atk: -93.110 ent: -4.761 str: 0.000 loss: -97.871]Iterations:  60%|██████    | 18/30 [00:12<00:06,  1.75it/s, atk: -96.088 ent: -4.761 str: 0.000 loss: -100.849]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.67it/s, atk: -96.088 ent: -4.761 str: 0.000 loss: -100.849]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.67it/s, atk: -99.794 ent: -4.761 str: 0.000 loss: -104.555]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.63it/s, atk: -99.794 ent: -4.761 str: 0.000 loss: -104.555]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.63it/s, atk: -103.185 ent: -4.761 str: 0.000 loss: -107.946]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.65it/s, atk: -103.185 ent: -4.761 str: 0.000 loss: -107.946]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.65it/s, atk: -107.403 ent: -4.762 str: 0.000 loss: -112.165]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.61it/s, atk: -107.403 ent: -4.762 str: 0.000 loss: -112.165]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.61it/s, atk: -111.514 ent: -4.763 str: 0.000 loss: -116.277]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.63it/s, atk: -111.514 ent: -4.763 str: 0.000 loss: -116.277]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.63it/s, atk: -114.845 ent: -4.763 str: 0.000 loss: -119.608]Iterations:  80%|████████  | 24/30 [00:15<00:04,  1.41it/s, atk: -114.845 ent: -4.763 str: 0.000 loss: -119.608]Iterations:  80%|████████  | 24/30 [00:16<00:04,  1.41it/s, atk: -119.536 ent: -4.763 str: 0.000 loss: -124.299]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.46it/s, atk: -119.536 ent: -4.763 str: 0.000 loss: -124.299]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.46it/s, atk: -123.929 ent: -4.763 str: 0.000 loss: -128.692]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.54it/s, atk: -123.929 ent: -4.763 str: 0.000 loss: -128.692]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.54it/s, atk: -127.917 ent: -4.764 str: 0.000 loss: -132.681]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.52it/s, atk: -127.917 ent: -4.764 str: 0.000 loss: -132.681]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.52it/s, atk: -131.702 ent: -4.764 str: 0.000 loss: -136.466]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.60it/s, atk: -131.702 ent: -4.764 str: 0.000 loss: -136.466]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.60it/s, atk: -135.056 ent: -4.764 str: 0.000 loss: -139.820]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.58it/s, atk: -135.056 ent: -4.764 str: 0.000 loss: -139.820]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.58it/s, atk: -138.379 ent: -4.763 str: 0.000 loss: -143.143]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.60it/s, atk: -138.379 ent: -4.763 str: 0.000 loss: -143.143]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.53it/s, atk: -138.379 ent: -4.763 str: 0.000 loss: -143.143]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([539], device='cuda:0') tensor(0.7262, device='cuda:0')
after_true: tensor([995], device='cuda:0') tensor(7.2091e-07, device='cuda:0')
L1: [3466.7021]	L2: [22.49554]	Linf: [0.78431374]

Accuracy on benign examples: 100.0%
gt_label: 32 pred_label: 32 pred_clean_logit 0.9590469598770142
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 22.48it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 20.90it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 22.42it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.83it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 22.17it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 21.07it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.69it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.16s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.58s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.46s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.71s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4981
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.277 ent: -6.099 str: 0.000 loss: -6.376]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -0.277 ent: -6.099 str: 0.000 loss: -6.376]Iterations:   3%|▎         | 1/30 [00:02<00:59,  2.05s/it, atk: -0.593 ent: -6.136 str: 0.000 loss: -6.729]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.18s/it, atk: -0.593 ent: -6.136 str: 0.000 loss: -6.729]Iterations:   7%|▋         | 2/30 [00:02<00:33,  1.18s/it, atk: -1.637 ent: -6.132 str: 0.000 loss: -7.769]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -1.637 ent: -6.132 str: 0.000 loss: -7.769]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -2.479 ent: -6.130 str: 0.000 loss: -8.609]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.20it/s, atk: -2.479 ent: -6.130 str: 0.000 loss: -8.609]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -4.544 ent: -6.119 str: 0.000 loss: -10.664]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.36it/s, atk: -4.544 ent: -6.119 str: 0.000 loss: -10.664]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.36it/s, atk: -8.031 ent: -6.121 str: 0.000 loss: -14.152]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -8.031 ent: -6.121 str: 0.000 loss: -14.152]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -12.381 ent: -6.127 str: 0.000 loss: -18.507]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -12.381 ent: -6.127 str: 0.000 loss: -18.507]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.49it/s, atk: -15.445 ent: -6.124 str: 0.000 loss: -21.569]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.58it/s, atk: -15.445 ent: -6.124 str: 0.000 loss: -21.569]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.58it/s, atk: -19.248 ent: -6.135 str: 0.000 loss: -25.383]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.53it/s, atk: -19.248 ent: -6.135 str: 0.000 loss: -25.383]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.53it/s, atk: -24.291 ent: -6.139 str: 0.000 loss: -30.429]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.53it/s, atk: -24.291 ent: -6.139 str: 0.000 loss: -30.429]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.53it/s, atk: -29.960 ent: -6.136 str: 0.000 loss: -36.096]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.53it/s, atk: -29.960 ent: -6.136 str: 0.000 loss: -36.096]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.53it/s, atk: -34.490 ent: -6.136 str: 0.000 loss: -40.626]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.59it/s, atk: -34.490 ent: -6.136 str: 0.000 loss: -40.626]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.59it/s, atk: -37.833 ent: -6.140 str: 0.000 loss: -43.972]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.62it/s, atk: -37.833 ent: -6.140 str: 0.000 loss: -43.972]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.62it/s, atk: -41.547 ent: -6.140 str: 0.000 loss: -47.687]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.57it/s, atk: -41.547 ent: -6.140 str: 0.000 loss: -47.687]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.57it/s, atk: -44.247 ent: -6.138 str: 0.000 loss: -50.385]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.51it/s, atk: -44.247 ent: -6.138 str: 0.000 loss: -50.385]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -48.364 ent: -6.140 str: 0.000 loss: -54.504]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -48.364 ent: -6.140 str: 0.000 loss: -54.504]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -51.096 ent: -6.143 str: 0.000 loss: -57.239]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.54it/s, atk: -51.096 ent: -6.143 str: 0.000 loss: -57.239]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.54it/s, atk: -54.265 ent: -6.139 str: 0.000 loss: -60.404]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.54it/s, atk: -54.265 ent: -6.139 str: 0.000 loss: -60.404]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.54it/s, atk: -58.370 ent: -6.137 str: 0.000 loss: -64.507]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.59it/s, atk: -58.370 ent: -6.137 str: 0.000 loss: -64.507]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.59it/s, atk: -63.279 ent: -6.136 str: 0.000 loss: -69.415]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.47it/s, atk: -63.279 ent: -6.136 str: 0.000 loss: -69.415]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.47it/s, atk: -67.483 ent: -6.134 str: 0.000 loss: -73.617]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.54it/s, atk: -67.483 ent: -6.134 str: 0.000 loss: -73.617]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -70.360 ent: -6.133 str: 0.000 loss: -76.493]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.51it/s, atk: -70.360 ent: -6.133 str: 0.000 loss: -76.493]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.51it/s, atk: -72.854 ent: -6.132 str: 0.000 loss: -78.986]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.54it/s, atk: -72.854 ent: -6.132 str: 0.000 loss: -78.986]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.54it/s, atk: -75.682 ent: -6.130 str: 0.000 loss: -81.813]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -75.682 ent: -6.130 str: 0.000 loss: -81.813]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -78.142 ent: -6.129 str: 0.000 loss: -84.271]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.58it/s, atk: -78.142 ent: -6.129 str: 0.000 loss: -84.271]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.58it/s, atk: -80.697 ent: -6.128 str: 0.000 loss: -86.826]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.60it/s, atk: -80.697 ent: -6.128 str: 0.000 loss: -86.826]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.60it/s, atk: -83.653 ent: -6.128 str: 0.000 loss: -89.781]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -83.653 ent: -6.128 str: 0.000 loss: -89.781]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -86.569 ent: -6.127 str: 0.000 loss: -92.696]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.63it/s, atk: -86.569 ent: -6.127 str: 0.000 loss: -92.696]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.63it/s, atk: -89.375 ent: -6.127 str: 0.000 loss: -95.502]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.61it/s, atk: -89.375 ent: -6.127 str: 0.000 loss: -95.502]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.61it/s, atk: -91.826 ent: -6.126 str: 0.000 loss: -97.952]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.64it/s, atk: -91.826 ent: -6.126 str: 0.000 loss: -97.952]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.47it/s, atk: -91.826 ent: -6.126 str: 0.000 loss: -97.952]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([30], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([32], device='cuda:0') tensor(8.3052e-05, device='cuda:0')
L1: [3874.851]	L2: [25.600348]	Linf: [0.7921569]

Accuracy on benign examples: 100.0%
gt_label: 718 pred_label: 718 pred_clean_logit 0.9676162600517273
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.16it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.97it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 20.47it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.79it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 19.11it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.96it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 16.86it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.37it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.93it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.44s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.33s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.40s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.49s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4198
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.362 ent: -2.710 str: 0.000 loss: -4.071]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.70s/it, atk: -1.362 ent: -2.710 str: 0.000 loss: -4.071]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.70s/it, atk: -4.392 ent: -2.716 str: 0.000 loss: -7.108]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.57s/it, atk: -4.392 ent: -2.716 str: 0.000 loss: -7.108]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.57s/it, atk: -9.304 ent: -2.701 str: 0.000 loss: -12.005]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -9.304 ent: -2.701 str: 0.000 loss: -12.005]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.15s/it, atk: -16.640 ent: -2.707 str: 0.000 loss: -19.346]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -16.640 ent: -2.707 str: 0.000 loss: -19.346]Iterations:  13%|█▎        | 4/30 [00:05<00:24,  1.05it/s, atk: -25.050 ent: -2.706 str: 0.000 loss: -27.756]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -25.050 ent: -2.706 str: 0.000 loss: -27.756]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -31.945 ent: -2.708 str: 0.000 loss: -34.653]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -31.945 ent: -2.708 str: 0.000 loss: -34.653]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.27it/s, atk: -41.644 ent: -2.709 str: 0.000 loss: -44.353]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -41.644 ent: -2.709 str: 0.000 loss: -44.353]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.32it/s, atk: -52.267 ent: -2.706 str: 0.000 loss: -54.973]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -52.267 ent: -2.706 str: 0.000 loss: -54.973]Iterations:  27%|██▋       | 8/30 [00:07<00:15,  1.39it/s, atk: -62.189 ent: -2.707 str: 0.000 loss: -64.896]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -62.189 ent: -2.707 str: 0.000 loss: -64.896]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.42it/s, atk: -71.210 ent: -2.706 str: 0.000 loss: -73.916]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.43it/s, atk: -71.210 ent: -2.706 str: 0.000 loss: -73.916]Iterations:  33%|███▎      | 10/30 [00:09<00:13,  1.43it/s, atk: -81.530 ent: -2.706 str: 0.000 loss: -84.236]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.46it/s, atk: -81.530 ent: -2.706 str: 0.000 loss: -84.236]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.46it/s, atk: -91.993 ent: -2.709 str: 0.000 loss: -94.702]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.51it/s, atk: -91.993 ent: -2.709 str: 0.000 loss: -94.702]Iterations:  40%|████      | 12/30 [00:10<00:11,  1.51it/s, atk: -103.007 ent: -2.709 str: 0.000 loss: -105.717]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.57it/s, atk: -103.007 ent: -2.709 str: 0.000 loss: -105.717]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.57it/s, atk: -113.006 ent: -2.710 str: 0.000 loss: -115.716]Iterations:  47%|████▋     | 14/30 [00:11<00:09,  1.61it/s, atk: -113.006 ent: -2.710 str: 0.000 loss: -115.716]Iterations:  47%|████▋     | 14/30 [00:11<00:09,  1.61it/s, atk: -123.195 ent: -2.709 str: 0.000 loss: -125.904]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.60it/s, atk: -123.195 ent: -2.709 str: 0.000 loss: -125.904]Iterations:  50%|█████     | 15/30 [00:12<00:09,  1.60it/s, atk: -131.460 ent: -2.709 str: 0.000 loss: -134.169]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -131.460 ent: -2.709 str: 0.000 loss: -134.169]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -139.073 ent: -2.708 str: 0.000 loss: -141.782]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.57it/s, atk: -139.073 ent: -2.708 str: 0.000 loss: -141.782]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.57it/s, atk: -146.148 ent: -2.708 str: 0.000 loss: -148.856]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.63it/s, atk: -146.148 ent: -2.708 str: 0.000 loss: -148.856]Iterations:  60%|██████    | 18/30 [00:14<00:07,  1.63it/s, atk: -154.596 ent: -2.707 str: 0.000 loss: -157.303]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.64it/s, atk: -154.596 ent: -2.707 str: 0.000 loss: -157.303]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.64it/s, atk: -161.136 ent: -2.707 str: 0.000 loss: -163.844]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.64it/s, atk: -161.136 ent: -2.707 str: 0.000 loss: -163.844]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.64it/s, atk: -167.962 ent: -2.708 str: 0.000 loss: -170.670]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -167.962 ent: -2.708 str: 0.000 loss: -170.670]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -176.488 ent: -2.708 str: 0.000 loss: -179.196]Iterations:  73%|███████▎  | 22/30 [00:16<00:04,  1.60it/s, atk: -176.488 ent: -2.708 str: 0.000 loss: -179.196]Iterations:  73%|███████▎  | 22/30 [00:16<00:04,  1.60it/s, atk: -186.123 ent: -2.708 str: 0.000 loss: -188.831]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.57it/s, atk: -186.123 ent: -2.708 str: 0.000 loss: -188.831]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.57it/s, atk: -192.721 ent: -2.708 str: 0.000 loss: -195.429]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.61it/s, atk: -192.721 ent: -2.708 str: 0.000 loss: -195.429]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.61it/s, atk: -199.633 ent: -2.709 str: 0.000 loss: -202.342]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.65it/s, atk: -199.633 ent: -2.709 str: 0.000 loss: -202.342]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.65it/s, atk: -205.891 ent: -2.709 str: 0.000 loss: -208.600]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.63it/s, atk: -205.891 ent: -2.709 str: 0.000 loss: -208.600]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.63it/s, atk: -212.295 ent: -2.710 str: 0.000 loss: -215.005]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.67it/s, atk: -212.295 ent: -2.710 str: 0.000 loss: -215.005]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.67it/s, atk: -219.611 ent: -2.709 str: 0.000 loss: -222.320]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.62it/s, atk: -219.611 ent: -2.709 str: 0.000 loss: -222.320]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.62it/s, atk: -226.169 ent: -2.708 str: 0.000 loss: -228.877]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.63it/s, atk: -226.169 ent: -2.708 str: 0.000 loss: -228.877]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.63it/s, atk: -231.544 ent: -2.707 str: 0.000 loss: -234.251]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.65it/s, atk: -231.544 ent: -2.707 str: 0.000 loss: -234.251]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -231.544 ent: -2.707 str: 0.000 loss: -234.251]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([920], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([718], device='cuda:0') tensor(4.6166e-11, device='cuda:0')
L1: [2362.8079]	L2: [18.323381]	Linf: [0.8627451]

Accuracy on benign examples: 100.0%
gt_label: 107 pred_label: 107 pred_clean_logit 0.9261446595191956
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.79it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.94it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 20.19it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.68it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.53it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 21.08it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.67it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.55it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.71it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.18s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.25s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.33s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.47s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4558
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.596 ent: -2.436 str: 0.000 loss: -3.031]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.19s/it, atk: -0.596 ent: -2.436 str: 0.000 loss: -3.031]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.19s/it, atk: -1.213 ent: -2.422 str: 0.000 loss: -3.635]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.25s/it, atk: -1.213 ent: -2.422 str: 0.000 loss: -3.635]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.25s/it, atk: -3.541 ent: -2.418 str: 0.000 loss: -5.959]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.01it/s, atk: -3.541 ent: -2.418 str: 0.000 loss: -5.959]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.01it/s, atk: -8.277 ent: -2.415 str: 0.000 loss: -10.692]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -8.277 ent: -2.415 str: 0.000 loss: -10.692]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -14.400 ent: -2.414 str: 0.000 loss: -16.814]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -14.400 ent: -2.414 str: 0.000 loss: -16.814]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.31it/s, atk: -16.985 ent: -2.414 str: 0.000 loss: -19.399]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.43it/s, atk: -16.985 ent: -2.414 str: 0.000 loss: -19.399]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.43it/s, atk: -17.931 ent: -2.417 str: 0.000 loss: -20.348]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.42it/s, atk: -17.931 ent: -2.417 str: 0.000 loss: -20.348]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.42it/s, atk: -25.243 ent: -2.414 str: 0.000 loss: -27.656]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -25.243 ent: -2.414 str: 0.000 loss: -27.656]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -29.462 ent: -2.413 str: 0.000 loss: -31.876]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.59it/s, atk: -29.462 ent: -2.413 str: 0.000 loss: -31.876]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.59it/s, atk: -36.131 ent: -2.413 str: 0.000 loss: -38.544]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.66it/s, atk: -36.131 ent: -2.413 str: 0.000 loss: -38.544]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.66it/s, atk: -41.895 ent: -2.412 str: 0.000 loss: -44.307]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.62it/s, atk: -41.895 ent: -2.412 str: 0.000 loss: -44.307]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.62it/s, atk: -45.872 ent: -2.411 str: 0.000 loss: -48.283]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.66it/s, atk: -45.872 ent: -2.411 str: 0.000 loss: -48.283]Iterations:  40%|████      | 12/30 [00:09<00:10,  1.66it/s, atk: -47.763 ent: -2.411 str: 0.000 loss: -50.174]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.68it/s, atk: -47.763 ent: -2.411 str: 0.000 loss: -50.174]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.68it/s, atk: -55.448 ent: -2.411 str: 0.000 loss: -57.859]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.71it/s, atk: -55.448 ent: -2.411 str: 0.000 loss: -57.859]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.71it/s, atk: -57.553 ent: -2.412 str: 0.000 loss: -59.965]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.63it/s, atk: -57.553 ent: -2.412 str: 0.000 loss: -59.965]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.63it/s, atk: -60.976 ent: -2.414 str: 0.000 loss: -63.390]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.69it/s, atk: -60.976 ent: -2.414 str: 0.000 loss: -63.390]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.69it/s, atk: -67.023 ent: -2.413 str: 0.000 loss: -69.436]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.69it/s, atk: -67.023 ent: -2.413 str: 0.000 loss: -69.436]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.69it/s, atk: -71.722 ent: -2.413 str: 0.000 loss: -74.135]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.66it/s, atk: -71.722 ent: -2.413 str: 0.000 loss: -74.135]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.66it/s, atk: -77.583 ent: -2.411 str: 0.000 loss: -79.994]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -77.583 ent: -2.411 str: 0.000 loss: -79.994]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -86.531 ent: -2.411 str: 0.000 loss: -88.942]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.68it/s, atk: -86.531 ent: -2.411 str: 0.000 loss: -88.942]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.68it/s, atk: -91.241 ent: -2.411 str: 0.000 loss: -93.652]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -91.241 ent: -2.411 str: 0.000 loss: -93.652]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.68it/s, atk: -96.313 ent: -2.410 str: 0.000 loss: -98.723]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.64it/s, atk: -96.313 ent: -2.410 str: 0.000 loss: -98.723]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.64it/s, atk: -103.097 ent: -2.411 str: 0.000 loss: -105.509]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.58it/s, atk: -103.097 ent: -2.411 str: 0.000 loss: -105.509]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.58it/s, atk: -109.483 ent: -2.411 str: 0.000 loss: -111.894]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.63it/s, atk: -109.483 ent: -2.411 str: 0.000 loss: -111.894]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.63it/s, atk: -113.407 ent: -2.411 str: 0.000 loss: -115.819]Iterations:  83%|████████▎ | 25/30 [00:16<00:02,  1.68it/s, atk: -113.407 ent: -2.411 str: 0.000 loss: -115.819]Iterations:  83%|████████▎ | 25/30 [00:17<00:02,  1.68it/s, atk: -119.282 ent: -2.411 str: 0.000 loss: -121.693]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.69it/s, atk: -119.282 ent: -2.411 str: 0.000 loss: -121.693]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.69it/s, atk: -118.386 ent: -2.409 str: 0.000 loss: -120.796]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.71it/s, atk: -118.386 ent: -2.409 str: 0.000 loss: -120.796]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.71it/s, atk: -122.714 ent: -2.409 str: 0.000 loss: -125.123]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.69it/s, atk: -122.714 ent: -2.409 str: 0.000 loss: -125.123]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.69it/s, atk: -129.414 ent: -2.408 str: 0.000 loss: -131.823]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.68it/s, atk: -129.414 ent: -2.408 str: 0.000 loss: -131.823]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.68it/s, atk: -137.089 ent: -2.408 str: 0.000 loss: -139.497]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.57it/s, atk: -137.089 ent: -2.408 str: 0.000 loss: -139.497]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.52it/s, atk: -137.089 ent: -2.408 str: 0.000 loss: -139.497]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([996], device='cuda:0') tensor(0.9850, device='cuda:0')
after_true: tensor([107], device='cuda:0') tensor(2.9577e-06, device='cuda:0')
L1: [2288.8396]	L2: [14.74992]	Linf: [0.57254905]

Accuracy on benign examples: 100.0%
gt_label: 679 pred_label: 679 pred_clean_logit 0.997147262096405
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.16it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.67it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.82it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.29it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 21.45it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 21.33it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.01it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.86it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.15s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.32s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.44s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4669
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.113 ent: -2.706 str: 0.000 loss: -2.820]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.43s/it, atk: -0.113 ent: -2.706 str: 0.000 loss: -2.820]Iterations:   3%|▎         | 1/30 [00:01<00:41,  1.43s/it, atk: -0.541 ent: -2.710 str: 0.000 loss: -3.251]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.05s/it, atk: -0.541 ent: -2.710 str: 0.000 loss: -3.251]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.05s/it, atk: -0.744 ent: -2.705 str: 0.000 loss: -3.449]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.20it/s, atk: -0.744 ent: -2.705 str: 0.000 loss: -3.449]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.20it/s, atk: -0.740 ent: -2.707 str: 0.000 loss: -3.447]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -0.740 ent: -2.707 str: 0.000 loss: -3.447]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -1.966 ent: -2.707 str: 0.000 loss: -4.674]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.37it/s, atk: -1.966 ent: -2.707 str: 0.000 loss: -4.674]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.37it/s, atk: -3.562 ent: -2.703 str: 0.000 loss: -6.265]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.34it/s, atk: -3.562 ent: -2.703 str: 0.000 loss: -6.265]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.34it/s, atk: -6.418 ent: -2.701 str: 0.000 loss: -9.118]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.41it/s, atk: -6.418 ent: -2.701 str: 0.000 loss: -9.118]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.41it/s, atk: -10.054 ent: -2.700 str: 0.000 loss: -12.754]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -10.054 ent: -2.700 str: 0.000 loss: -12.754]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -14.287 ent: -2.702 str: 0.000 loss: -16.989]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.51it/s, atk: -14.287 ent: -2.702 str: 0.000 loss: -16.989]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.51it/s, atk: -18.832 ent: -2.704 str: 0.000 loss: -21.536]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.54it/s, atk: -18.832 ent: -2.704 str: 0.000 loss: -21.536]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.54it/s, atk: -23.406 ent: -2.702 str: 0.000 loss: -26.107]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.56it/s, atk: -23.406 ent: -2.702 str: 0.000 loss: -26.107]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.56it/s, atk: -27.677 ent: -2.701 str: 0.000 loss: -30.377]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.45it/s, atk: -27.677 ent: -2.701 str: 0.000 loss: -30.377]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -32.015 ent: -2.701 str: 0.000 loss: -34.716]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.51it/s, atk: -32.015 ent: -2.701 str: 0.000 loss: -34.716]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.51it/s, atk: -35.115 ent: -2.701 str: 0.000 loss: -37.816]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.53it/s, atk: -35.115 ent: -2.701 str: 0.000 loss: -37.816]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.53it/s, atk: -35.877 ent: -2.700 str: 0.000 loss: -38.577]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.56it/s, atk: -35.877 ent: -2.700 str: 0.000 loss: -38.577]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.56it/s, atk: -42.607 ent: -2.700 str: 0.000 loss: -45.307]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.58it/s, atk: -42.607 ent: -2.700 str: 0.000 loss: -45.307]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.58it/s, atk: -45.275 ent: -2.699 str: 0.000 loss: -47.974]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.64it/s, atk: -45.275 ent: -2.699 str: 0.000 loss: -47.974]Iterations:  57%|█████▋    | 17/30 [00:12<00:07,  1.64it/s, atk: -49.669 ent: -2.696 str: 0.000 loss: -52.366]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.62it/s, atk: -49.669 ent: -2.696 str: 0.000 loss: -52.366]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.62it/s, atk: -53.091 ent: -2.694 str: 0.000 loss: -55.785]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -53.091 ent: -2.694 str: 0.000 loss: -55.785]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.61it/s, atk: -57.095 ent: -2.692 str: 0.000 loss: -59.787]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.60it/s, atk: -57.095 ent: -2.692 str: 0.000 loss: -59.787]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.60it/s, atk: -61.541 ent: -2.690 str: 0.000 loss: -64.232]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.54it/s, atk: -61.541 ent: -2.690 str: 0.000 loss: -64.232]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.54it/s, atk: -65.372 ent: -2.689 str: 0.000 loss: -68.061]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.52it/s, atk: -65.372 ent: -2.689 str: 0.000 loss: -68.061]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.52it/s, atk: -69.029 ent: -2.688 str: 0.000 loss: -71.716]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.62it/s, atk: -69.029 ent: -2.688 str: 0.000 loss: -71.716]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.62it/s, atk: -72.213 ent: -2.687 str: 0.000 loss: -74.900]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.56it/s, atk: -72.213 ent: -2.687 str: 0.000 loss: -74.900]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.56it/s, atk: -76.160 ent: -2.688 str: 0.000 loss: -78.848]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.56it/s, atk: -76.160 ent: -2.688 str: 0.000 loss: -78.848]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.56it/s, atk: -80.192 ent: -2.686 str: 0.000 loss: -82.878]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.52it/s, atk: -80.192 ent: -2.686 str: 0.000 loss: -82.878]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.52it/s, atk: -84.324 ent: -2.686 str: 0.000 loss: -87.010]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -84.324 ent: -2.686 str: 0.000 loss: -87.010]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.56it/s, atk: -88.098 ent: -2.686 str: 0.000 loss: -90.784]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.59it/s, atk: -88.098 ent: -2.686 str: 0.000 loss: -90.784]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.59it/s, atk: -90.637 ent: -2.685 str: 0.000 loss: -93.322]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -90.637 ent: -2.685 str: 0.000 loss: -93.322]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -94.771 ent: -2.686 str: 0.000 loss: -97.457]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.53it/s, atk: -94.771 ent: -2.686 str: 0.000 loss: -97.457]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.48it/s, atk: -94.771 ent: -2.686 str: 0.000 loss: -97.457]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([488], device='cuda:0') tensor(0.9998, device='cuda:0')
after_true: tensor([679], device='cuda:0') tensor(5.2439e-05, device='cuda:0')
L1: [3684.361]	L2: [24.636713]	Linf: [0.79607844]

Accuracy on benign examples: 100.0%
gt_label: 814 pred_label: 814 pred_clean_logit 0.9960327744483948
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 21.18it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 22.52it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.76it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.81it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.41it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 18.81it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.74it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.64s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.31s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.37s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.52s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.45s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6576
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.069 ent: -5.758 str: 0.000 loss: -5.827]Iterations:   3%|▎         | 1/30 [00:01<00:43,  1.50s/it, atk: -0.069 ent: -5.758 str: 0.000 loss: -5.827]Iterations:   3%|▎         | 1/30 [00:01<00:43,  1.50s/it, atk: -0.185 ent: -5.776 str: 0.000 loss: -5.961]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.185 ent: -5.776 str: 0.000 loss: -5.961]Iterations:   7%|▋         | 2/30 [00:02<00:26,  1.06it/s, atk: -0.316 ent: -5.783 str: 0.000 loss: -6.099]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.23it/s, atk: -0.316 ent: -5.783 str: 0.000 loss: -6.099]Iterations:  10%|█         | 3/30 [00:03<00:21,  1.23it/s, atk: -0.579 ent: -5.789 str: 0.000 loss: -6.368]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.30it/s, atk: -0.579 ent: -5.789 str: 0.000 loss: -6.368]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.30it/s, atk: -1.092 ent: -5.793 str: 0.000 loss: -6.885]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.43it/s, atk: -1.092 ent: -5.793 str: 0.000 loss: -6.885]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.43it/s, atk: -1.887 ent: -5.793 str: 0.000 loss: -7.679]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.45it/s, atk: -1.887 ent: -5.793 str: 0.000 loss: -7.679]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -3.011 ent: -5.792 str: 0.000 loss: -8.803]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.46it/s, atk: -3.011 ent: -5.792 str: 0.000 loss: -8.803]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.46it/s, atk: -4.849 ent: -5.793 str: 0.000 loss: -10.641]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.53it/s, atk: -4.849 ent: -5.793 str: 0.000 loss: -10.641]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.53it/s, atk: -7.136 ent: -5.791 str: 0.000 loss: -12.927]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.54it/s, atk: -7.136 ent: -5.791 str: 0.000 loss: -12.927]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.54it/s, atk: -9.628 ent: -5.790 str: 0.000 loss: -15.419]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.55it/s, atk: -9.628 ent: -5.790 str: 0.000 loss: -15.419]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.55it/s, atk: -12.746 ent: -5.790 str: 0.000 loss: -18.536]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.54it/s, atk: -12.746 ent: -5.790 str: 0.000 loss: -18.536]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.54it/s, atk: -16.361 ent: -5.788 str: 0.000 loss: -22.149]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.47it/s, atk: -16.361 ent: -5.788 str: 0.000 loss: -22.149]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.47it/s, atk: -20.351 ent: -5.784 str: 0.000 loss: -26.135]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.54it/s, atk: -20.351 ent: -5.784 str: 0.000 loss: -26.135]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.54it/s, atk: -24.861 ent: -5.781 str: 0.000 loss: -30.642]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.58it/s, atk: -24.861 ent: -5.781 str: 0.000 loss: -30.642]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.58it/s, atk: -29.286 ent: -5.778 str: 0.000 loss: -35.064]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.55it/s, atk: -29.286 ent: -5.778 str: 0.000 loss: -35.064]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.55it/s, atk: -33.686 ent: -5.777 str: 0.000 loss: -39.464]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.57it/s, atk: -33.686 ent: -5.777 str: 0.000 loss: -39.464]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.57it/s, atk: -36.901 ent: -5.776 str: 0.000 loss: -42.677]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.53it/s, atk: -36.901 ent: -5.776 str: 0.000 loss: -42.677]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.53it/s, atk: -41.608 ent: -5.775 str: 0.000 loss: -47.383]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.58it/s, atk: -41.608 ent: -5.775 str: 0.000 loss: -47.383]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.58it/s, atk: -45.428 ent: -5.773 str: 0.000 loss: -51.201]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.63it/s, atk: -45.428 ent: -5.773 str: 0.000 loss: -51.201]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.63it/s, atk: -48.347 ent: -5.773 str: 0.000 loss: -54.120]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.65it/s, atk: -48.347 ent: -5.773 str: 0.000 loss: -54.120]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.65it/s, atk: -50.617 ent: -5.771 str: 0.000 loss: -56.389]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.58it/s, atk: -50.617 ent: -5.771 str: 0.000 loss: -56.389]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.58it/s, atk: -53.121 ent: -5.771 str: 0.000 loss: -58.892]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.66it/s, atk: -53.121 ent: -5.771 str: 0.000 loss: -58.892]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.66it/s, atk: -56.076 ent: -5.771 str: 0.000 loss: -61.847]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.66it/s, atk: -56.076 ent: -5.771 str: 0.000 loss: -61.847]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.66it/s, atk: -59.177 ent: -5.770 str: 0.000 loss: -64.948]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.63it/s, atk: -59.177 ent: -5.770 str: 0.000 loss: -64.948]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.63it/s, atk: -62.056 ent: -5.768 str: 0.000 loss: -67.824]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.55it/s, atk: -62.056 ent: -5.768 str: 0.000 loss: -67.824]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.55it/s, atk: -65.420 ent: -5.767 str: 0.000 loss: -71.188]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.56it/s, atk: -65.420 ent: -5.767 str: 0.000 loss: -71.188]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.56it/s, atk: -68.519 ent: -5.766 str: 0.000 loss: -74.286]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.59it/s, atk: -68.519 ent: -5.766 str: 0.000 loss: -74.286]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.59it/s, atk: -72.311 ent: -5.765 str: 0.000 loss: -78.076]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.61it/s, atk: -72.311 ent: -5.765 str: 0.000 loss: -78.076]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.61it/s, atk: -75.623 ent: -5.764 str: 0.000 loss: -81.386]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -75.623 ent: -5.764 str: 0.000 loss: -81.386]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -78.483 ent: -5.760 str: 0.000 loss: -84.243]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.55it/s, atk: -78.483 ent: -5.760 str: 0.000 loss: -84.243]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.51it/s, atk: -78.483 ent: -5.760 str: 0.000 loss: -84.243]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([409], device='cuda:0') tensor(0.3201, device='cuda:0')
after_true: tensor([814], device='cuda:0') tensor(0.0003, device='cuda:0')
L1: [2194.7258]	L2: [17.534182]	Linf: [0.7607843]

Accuracy on benign examples: 0.0%
gt_label: 526 pred_label: 892 pred_clean_logit 0.044194187968969345
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:03,  5.31it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 10.24it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 13.84it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 16.43it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 16.27it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 18.43it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 17.90it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.21it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.32s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.19s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.22s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.32s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.38s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4781
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -30.051 ent: -2.679 str: 0.000 loss: -32.731]Iterations:   3%|▎         | 1/30 [00:01<00:49,  1.72s/it, atk: -30.051 ent: -2.679 str: 0.000 loss: -32.731]Iterations:   3%|▎         | 1/30 [00:02<00:49,  1.72s/it, atk: -36.057 ent: -2.661 str: 0.000 loss: -38.718]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.10s/it, atk: -36.057 ent: -2.661 str: 0.000 loss: -38.718]Iterations:   7%|▋         | 2/30 [00:02<00:30,  1.10s/it, atk: -40.468 ent: -2.656 str: 0.000 loss: -43.124]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.15it/s, atk: -40.468 ent: -2.656 str: 0.000 loss: -43.124]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.15it/s, atk: -45.702 ent: -2.655 str: 0.000 loss: -48.356]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.28it/s, atk: -45.702 ent: -2.655 str: 0.000 loss: -48.356]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.28it/s, atk: -51.806 ent: -2.654 str: 0.000 loss: -54.460]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.38it/s, atk: -51.806 ent: -2.654 str: 0.000 loss: -54.460]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.38it/s, atk: -58.539 ent: -2.655 str: 0.000 loss: -61.193]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.46it/s, atk: -58.539 ent: -2.655 str: 0.000 loss: -61.193]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.46it/s, atk: -62.133 ent: -2.653 str: 0.000 loss: -64.786]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -62.133 ent: -2.653 str: 0.000 loss: -64.786]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.49it/s, atk: -66.692 ent: -2.650 str: 0.000 loss: -69.342]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.52it/s, atk: -66.692 ent: -2.650 str: 0.000 loss: -69.342]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.52it/s, atk: -70.737 ent: -2.648 str: 0.000 loss: -73.385]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.60it/s, atk: -70.737 ent: -2.648 str: 0.000 loss: -73.385]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.60it/s, atk: -74.601 ent: -2.647 str: 0.000 loss: -77.248]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -74.601 ent: -2.647 str: 0.000 loss: -77.248]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -77.280 ent: -2.648 str: 0.000 loss: -79.928]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -77.280 ent: -2.648 str: 0.000 loss: -79.928]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -80.120 ent: -2.649 str: 0.000 loss: -82.769]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.52it/s, atk: -80.120 ent: -2.649 str: 0.000 loss: -82.769]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.52it/s, atk: -86.269 ent: -2.649 str: 0.000 loss: -88.918]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.60it/s, atk: -86.269 ent: -2.649 str: 0.000 loss: -88.918]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.60it/s, atk: -91.467 ent: -2.648 str: 0.000 loss: -94.115]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.68it/s, atk: -91.467 ent: -2.648 str: 0.000 loss: -94.115]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.68it/s, atk: -97.012 ent: -2.648 str: 0.000 loss: -99.660]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.71it/s, atk: -97.012 ent: -2.648 str: 0.000 loss: -99.660]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.71it/s, atk: -101.875 ent: -2.649 str: 0.000 loss: -104.524]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.68it/s, atk: -101.875 ent: -2.649 str: 0.000 loss: -104.524]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.68it/s, atk: -106.051 ent: -2.650 str: 0.000 loss: -108.701]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -106.051 ent: -2.650 str: 0.000 loss: -108.701]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -110.659 ent: -2.649 str: 0.000 loss: -113.309]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.61it/s, atk: -110.659 ent: -2.649 str: 0.000 loss: -113.309]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.61it/s, atk: -114.771 ent: -2.649 str: 0.000 loss: -117.420]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.64it/s, atk: -114.771 ent: -2.649 str: 0.000 loss: -117.420]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.64it/s, atk: -119.452 ent: -2.649 str: 0.000 loss: -122.100]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.66it/s, atk: -119.452 ent: -2.649 str: 0.000 loss: -122.100]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.66it/s, atk: -124.803 ent: -2.649 str: 0.000 loss: -127.451]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.72it/s, atk: -124.803 ent: -2.649 str: 0.000 loss: -127.451]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.72it/s, atk: -128.276 ent: -2.648 str: 0.000 loss: -130.924]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.69it/s, atk: -128.276 ent: -2.648 str: 0.000 loss: -130.924]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.69it/s, atk: -135.247 ent: -2.648 str: 0.000 loss: -137.895]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.53it/s, atk: -135.247 ent: -2.648 str: 0.000 loss: -137.895]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.53it/s, atk: -141.941 ent: -2.648 str: 0.000 loss: -144.589]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -141.941 ent: -2.648 str: 0.000 loss: -144.589]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.54it/s, atk: -147.614 ent: -2.648 str: 0.000 loss: -150.263]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.40it/s, atk: -147.614 ent: -2.648 str: 0.000 loss: -150.263]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.40it/s, atk: -155.893 ent: -2.648 str: 0.000 loss: -158.541]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.50it/s, atk: -155.893 ent: -2.648 str: 0.000 loss: -158.541]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.50it/s, atk: -162.724 ent: -2.648 str: 0.000 loss: -165.372]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.49it/s, atk: -162.724 ent: -2.648 str: 0.000 loss: -165.372]Iterations:  90%|█████████ | 27/30 [00:18<00:02,  1.49it/s, atk: -170.176 ent: -2.648 str: 0.000 loss: -172.824]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.54it/s, atk: -170.176 ent: -2.648 str: 0.000 loss: -172.824]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.54it/s, atk: -179.169 ent: -2.648 str: 0.000 loss: -181.818]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -179.169 ent: -2.648 str: 0.000 loss: -181.818]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -186.750 ent: -2.649 str: 0.000 loss: -189.398]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.50it/s, atk: -186.750 ent: -2.649 str: 0.000 loss: -189.398]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.50it/s, atk: -186.750 ent: -2.649 str: 0.000 loss: -189.398]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([764], device='cuda:0') tensor(0.9304, device='cuda:0')
after_true: tensor([526], device='cuda:0') tensor(3.4760e-09, device='cuda:0')
L1: [3178.4548]	L2: [21.782564]	Linf: [0.7058824]

Accuracy on benign examples: 100.0%
gt_label: 1 pred_label: 1 pred_clean_logit 0.4511968791484833
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.36it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.11it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 12.90it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 14.50it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.46it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.30it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.44it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.77it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.83it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.31s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.29s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.28s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.38s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.46s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3823
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -5.419 ent: -2.631 str: 0.000 loss: -8.050]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -5.419 ent: -2.631 str: 0.000 loss: -8.050]Iterations:   3%|▎         | 1/30 [00:02<01:00,  2.08s/it, atk: -14.186 ent: -2.611 str: 0.000 loss: -16.798]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.24s/it, atk: -14.186 ent: -2.611 str: 0.000 loss: -16.798]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.24s/it, atk: -28.009 ent: -2.596 str: 0.000 loss: -30.605]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.06it/s, atk: -28.009 ent: -2.596 str: 0.000 loss: -30.605]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.06it/s, atk: -34.627 ent: -2.595 str: 0.000 loss: -37.222]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.26it/s, atk: -34.627 ent: -2.595 str: 0.000 loss: -37.222]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.26it/s, atk: -38.311 ent: -2.593 str: 0.000 loss: -40.904]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -38.311 ent: -2.593 str: 0.000 loss: -40.904]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.40it/s, atk: -48.330 ent: -2.598 str: 0.000 loss: -50.928]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -48.330 ent: -2.598 str: 0.000 loss: -50.928]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -50.190 ent: -2.600 str: 0.000 loss: -52.790]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -50.190 ent: -2.600 str: 0.000 loss: -52.790]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -58.296 ent: -2.594 str: 0.000 loss: -60.890]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.62it/s, atk: -58.296 ent: -2.594 str: 0.000 loss: -60.890]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.62it/s, atk: -65.484 ent: -2.589 str: 0.000 loss: -68.073]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.65it/s, atk: -65.484 ent: -2.589 str: 0.000 loss: -68.073]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.65it/s, atk: -70.995 ent: -2.583 str: 0.000 loss: -73.579]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.67it/s, atk: -70.995 ent: -2.583 str: 0.000 loss: -73.579]Iterations:  33%|███▎      | 10/30 [00:07<00:11,  1.67it/s, atk: -77.438 ent: -2.579 str: 0.000 loss: -80.017]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.72it/s, atk: -77.438 ent: -2.579 str: 0.000 loss: -80.017]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.72it/s, atk: -83.090 ent: -2.577 str: 0.000 loss: -85.668]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.74it/s, atk: -83.090 ent: -2.577 str: 0.000 loss: -85.668]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.74it/s, atk: -87.460 ent: -2.578 str: 0.000 loss: -90.038]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.66it/s, atk: -87.460 ent: -2.578 str: 0.000 loss: -90.038]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.66it/s, atk: -92.563 ent: -2.579 str: 0.000 loss: -95.141]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.66it/s, atk: -92.563 ent: -2.579 str: 0.000 loss: -95.141]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.66it/s, atk: -99.408 ent: -2.579 str: 0.000 loss: -101.987]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.70it/s, atk: -99.408 ent: -2.579 str: 0.000 loss: -101.987]Iterations:  50%|█████     | 15/30 [00:10<00:08,  1.70it/s, atk: -105.703 ent: -2.580 str: 0.000 loss: -108.283]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.65it/s, atk: -105.703 ent: -2.580 str: 0.000 loss: -108.283]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.65it/s, atk: -110.858 ent: -2.580 str: 0.000 loss: -113.438]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.63it/s, atk: -110.858 ent: -2.580 str: 0.000 loss: -113.438]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.63it/s, atk: -117.466 ent: -2.582 str: 0.000 loss: -120.048]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.68it/s, atk: -117.466 ent: -2.582 str: 0.000 loss: -120.048]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.68it/s, atk: -126.289 ent: -2.581 str: 0.000 loss: -128.871]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.67it/s, atk: -126.289 ent: -2.581 str: 0.000 loss: -128.871]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.67it/s, atk: -134.678 ent: -2.581 str: 0.000 loss: -137.259]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.68it/s, atk: -134.678 ent: -2.581 str: 0.000 loss: -137.259]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.68it/s, atk: -143.392 ent: -2.580 str: 0.000 loss: -145.972]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.72it/s, atk: -143.392 ent: -2.580 str: 0.000 loss: -145.972]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.72it/s, atk: -153.093 ent: -2.578 str: 0.000 loss: -155.671]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.71it/s, atk: -153.093 ent: -2.578 str: 0.000 loss: -155.671]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.71it/s, atk: -158.816 ent: -2.577 str: 0.000 loss: -161.393]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.63it/s, atk: -158.816 ent: -2.577 str: 0.000 loss: -161.393]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.63it/s, atk: -166.883 ent: -2.577 str: 0.000 loss: -169.460]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.61it/s, atk: -166.883 ent: -2.577 str: 0.000 loss: -169.460]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.61it/s, atk: -171.841 ent: -2.578 str: 0.000 loss: -174.419]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.61it/s, atk: -171.841 ent: -2.578 str: 0.000 loss: -174.419]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.61it/s, atk: -180.386 ent: -2.579 str: 0.000 loss: -182.965]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.58it/s, atk: -180.386 ent: -2.579 str: 0.000 loss: -182.965]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.58it/s, atk: -187.841 ent: -2.579 str: 0.000 loss: -190.421]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.62it/s, atk: -187.841 ent: -2.579 str: 0.000 loss: -190.421]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.62it/s, atk: -194.346 ent: -2.580 str: 0.000 loss: -196.925]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.62it/s, atk: -194.346 ent: -2.580 str: 0.000 loss: -196.925]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.62it/s, atk: -201.964 ent: -2.580 str: 0.000 loss: -204.544]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.35it/s, atk: -201.964 ent: -2.580 str: 0.000 loss: -204.544]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.35it/s, atk: -208.004 ent: -2.579 str: 0.000 loss: -210.583]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.34it/s, atk: -208.004 ent: -2.579 str: 0.000 loss: -210.583]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.50it/s, atk: -208.004 ent: -2.579 str: 0.000 loss: -210.583]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([723], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([1], device='cuda:0') tensor(5.1304e-10, device='cuda:0')
L1: [2267.8079]	L2: [14.82125]	Linf: [0.627451]

Accuracy on benign examples: 100.0%
gt_label: 873 pred_label: 873 pred_clean_logit 0.9516159892082214
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:06,  2.76it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  9.65it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 11.98it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 14.61it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.67it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:01<00:00, 15.44it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 18.45it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.84it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.08it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.75s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.52s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.62s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6510
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.797 ent: -10.716 str: 0.000 loss: -11.514]Iterations:   3%|▎         | 1/30 [00:02<01:06,  2.28s/it, atk: -0.797 ent: -10.716 str: 0.000 loss: -11.514]Iterations:   3%|▎         | 1/30 [00:02<01:06,  2.28s/it, atk: -2.923 ent: -10.750 str: 0.000 loss: -13.673]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.32s/it, atk: -2.923 ent: -10.750 str: 0.000 loss: -13.673]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.32s/it, atk: -5.547 ent: -10.761 str: 0.000 loss: -16.308]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.01it/s, atk: -5.547 ent: -10.761 str: 0.000 loss: -16.308]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.01it/s, atk: -8.127 ent: -10.749 str: 0.000 loss: -18.876]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -8.127 ent: -10.749 str: 0.000 loss: -18.876]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.21it/s, atk: -12.900 ent: -10.749 str: 0.000 loss: -23.648]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.35it/s, atk: -12.900 ent: -10.749 str: 0.000 loss: -23.648]Iterations:  17%|█▋        | 5/30 [00:05<00:18,  1.35it/s, atk: -15.665 ent: -10.744 str: 0.000 loss: -26.409]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.44it/s, atk: -15.665 ent: -10.744 str: 0.000 loss: -26.409]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.44it/s, atk: -19.872 ent: -10.740 str: 0.000 loss: -30.613]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.44it/s, atk: -19.872 ent: -10.740 str: 0.000 loss: -30.613]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.44it/s, atk: -23.997 ent: -10.741 str: 0.000 loss: -34.738]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.51it/s, atk: -23.997 ent: -10.741 str: 0.000 loss: -34.738]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.51it/s, atk: -29.334 ent: -10.735 str: 0.000 loss: -40.069]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -29.334 ent: -10.735 str: 0.000 loss: -40.069]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -32.061 ent: -10.731 str: 0.000 loss: -42.791]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.53it/s, atk: -32.061 ent: -10.731 str: 0.000 loss: -42.791]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.53it/s, atk: -37.112 ent: -10.728 str: 0.000 loss: -47.840]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.60it/s, atk: -37.112 ent: -10.728 str: 0.000 loss: -47.840]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.60it/s, atk: -43.081 ent: -10.727 str: 0.000 loss: -53.808]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.50it/s, atk: -43.081 ent: -10.727 str: 0.000 loss: -53.808]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.50it/s, atk: -51.390 ent: -10.724 str: 0.000 loss: -62.114]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.55it/s, atk: -51.390 ent: -10.724 str: 0.000 loss: -62.114]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.55it/s, atk: -58.299 ent: -10.728 str: 0.000 loss: -69.027]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.53it/s, atk: -58.299 ent: -10.728 str: 0.000 loss: -69.027]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.53it/s, atk: -63.475 ent: -10.735 str: 0.000 loss: -74.210]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -63.475 ent: -10.735 str: 0.000 loss: -74.210]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.48it/s, atk: -68.540 ent: -10.740 str: 0.000 loss: -79.279]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.55it/s, atk: -68.540 ent: -10.740 str: 0.000 loss: -79.279]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.55it/s, atk: -72.162 ent: -10.741 str: 0.000 loss: -82.902]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.61it/s, atk: -72.162 ent: -10.741 str: 0.000 loss: -82.902]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.61it/s, atk: -72.563 ent: -10.742 str: 0.000 loss: -83.306]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -72.563 ent: -10.742 str: 0.000 loss: -83.306]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.63it/s, atk: -77.916 ent: -10.750 str: 0.000 loss: -88.666]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.63it/s, atk: -77.916 ent: -10.750 str: 0.000 loss: -88.666]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.63it/s, atk: -81.331 ent: -10.749 str: 0.000 loss: -92.080]Iterations:  67%|██████▋   | 20/30 [00:14<00:05,  1.67it/s, atk: -81.331 ent: -10.749 str: 0.000 loss: -92.080]Iterations:  67%|██████▋   | 20/30 [00:14<00:05,  1.67it/s, atk: -87.716 ent: -10.749 str: 0.000 loss: -98.465]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.64it/s, atk: -87.716 ent: -10.749 str: 0.000 loss: -98.465]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.64it/s, atk: -94.984 ent: -10.745 str: 0.000 loss: -105.728]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.66it/s, atk: -94.984 ent: -10.745 str: 0.000 loss: -105.728]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.66it/s, atk: -99.631 ent: -10.736 str: 0.000 loss: -110.367]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.63it/s, atk: -99.631 ent: -10.736 str: 0.000 loss: -110.367]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.63it/s, atk: -106.161 ent: -10.732 str: 0.000 loss: -116.893]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.69it/s, atk: -106.161 ent: -10.732 str: 0.000 loss: -116.893]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.69it/s, atk: -112.158 ent: -10.723 str: 0.000 loss: -122.881]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.64it/s, atk: -112.158 ent: -10.723 str: 0.000 loss: -122.881]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.64it/s, atk: -118.332 ent: -10.715 str: 0.000 loss: -129.047]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.66it/s, atk: -118.332 ent: -10.715 str: 0.000 loss: -129.047]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.66it/s, atk: -125.890 ent: -10.715 str: 0.000 loss: -136.605]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.71it/s, atk: -125.890 ent: -10.715 str: 0.000 loss: -136.605]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.71it/s, atk: -134.348 ent: -10.723 str: 0.000 loss: -145.071]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.73it/s, atk: -134.348 ent: -10.723 str: 0.000 loss: -145.071]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.73it/s, atk: -136.195 ent: -10.730 str: 0.000 loss: -146.925]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.61it/s, atk: -136.195 ent: -10.730 str: 0.000 loss: -146.925]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.61it/s, atk: -145.950 ent: -10.733 str: 0.000 loss: -156.683]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.45it/s, atk: -145.950 ent: -10.733 str: 0.000 loss: -156.683]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.47it/s, atk: -145.950 ent: -10.733 str: 0.000 loss: -156.683]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([856], device='cuda:0') tensor(0.3685, device='cuda:0')
after_true: tensor([873], device='cuda:0') tensor(2.4808e-07, device='cuda:0')
L1: [3556.757]	L2: [23.725636]	Linf: [0.8980392]

Accuracy on benign examples: 100.0%
gt_label: 338 pred_label: 338 pred_clean_logit 0.9081203937530518
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.25it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.47it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 17.32it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.49it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 21.75it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 23.03it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 23.27it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.45it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.55s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.48s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.44s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.50s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3803
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.974 ent: -5.077 str: 0.000 loss: -9.051]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.59s/it, atk: -3.974 ent: -5.077 str: 0.000 loss: -9.051]Iterations:   3%|▎         | 1/30 [00:02<00:46,  1.59s/it, atk: -16.689 ent: -5.063 str: 0.000 loss: -21.753]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.05s/it, atk: -16.689 ent: -5.063 str: 0.000 loss: -21.753]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.05s/it, atk: -26.147 ent: -5.097 str: 0.000 loss: -31.244]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.17it/s, atk: -26.147 ent: -5.097 str: 0.000 loss: -31.244]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.17it/s, atk: -43.627 ent: -5.092 str: 0.000 loss: -48.720]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.34it/s, atk: -43.627 ent: -5.092 str: 0.000 loss: -48.720]Iterations:  13%|█▎        | 4/30 [00:03<00:19,  1.34it/s, atk: -56.753 ent: -5.077 str: 0.000 loss: -61.830]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.41it/s, atk: -56.753 ent: -5.077 str: 0.000 loss: -61.830]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.41it/s, atk: -65.867 ent: -5.064 str: 0.000 loss: -70.931]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.42it/s, atk: -65.867 ent: -5.064 str: 0.000 loss: -70.931]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.42it/s, atk: -75.876 ent: -5.060 str: 0.000 loss: -80.936]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -75.876 ent: -5.060 str: 0.000 loss: -80.936]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -88.905 ent: -5.059 str: 0.000 loss: -93.964]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -88.905 ent: -5.059 str: 0.000 loss: -93.964]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.42it/s, atk: -100.015 ent: -5.053 str: 0.000 loss: -105.068]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.44it/s, atk: -100.015 ent: -5.053 str: 0.000 loss: -105.068]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.44it/s, atk: -112.111 ent: -5.047 str: 0.000 loss: -117.157]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.56it/s, atk: -112.111 ent: -5.047 str: 0.000 loss: -117.157]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.56it/s, atk: -121.038 ent: -5.037 str: 0.000 loss: -126.075]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.58it/s, atk: -121.038 ent: -5.037 str: 0.000 loss: -126.075]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.58it/s, atk: -125.251 ent: -5.037 str: 0.000 loss: -130.288]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.56it/s, atk: -125.251 ent: -5.037 str: 0.000 loss: -130.288]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.56it/s, atk: -137.292 ent: -5.032 str: 0.000 loss: -142.325]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.56it/s, atk: -137.292 ent: -5.032 str: 0.000 loss: -142.325]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.56it/s, atk: -143.249 ent: -5.033 str: 0.000 loss: -148.282]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.54it/s, atk: -143.249 ent: -5.033 str: 0.000 loss: -148.282]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -150.670 ent: -5.037 str: 0.000 loss: -155.707]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.49it/s, atk: -150.670 ent: -5.037 str: 0.000 loss: -155.707]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.49it/s, atk: -156.460 ent: -5.041 str: 0.000 loss: -161.501]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.42it/s, atk: -156.460 ent: -5.041 str: 0.000 loss: -161.501]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.42it/s, atk: -161.188 ent: -5.043 str: 0.000 loss: -166.231]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -161.188 ent: -5.043 str: 0.000 loss: -166.231]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.48it/s, atk: -168.627 ent: -5.041 str: 0.000 loss: -173.667]Iterations:  60%|██████    | 18/30 [00:12<00:08,  1.39it/s, atk: -168.627 ent: -5.041 str: 0.000 loss: -173.667]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.39it/s, atk: -174.376 ent: -5.038 str: 0.000 loss: -179.413]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.47it/s, atk: -174.376 ent: -5.038 str: 0.000 loss: -179.413]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.47it/s, atk: -180.175 ent: -5.036 str: 0.000 loss: -185.211]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.57it/s, atk: -180.175 ent: -5.036 str: 0.000 loss: -185.211]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.57it/s, atk: -186.027 ent: -5.036 str: 0.000 loss: -191.063]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.59it/s, atk: -186.027 ent: -5.036 str: 0.000 loss: -191.063]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.59it/s, atk: -191.601 ent: -5.038 str: 0.000 loss: -196.639]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.56it/s, atk: -191.601 ent: -5.038 str: 0.000 loss: -196.639]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.56it/s, atk: -197.267 ent: -5.038 str: 0.000 loss: -202.305]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.53it/s, atk: -197.267 ent: -5.038 str: 0.000 loss: -202.305]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.53it/s, atk: -201.904 ent: -5.038 str: 0.000 loss: -206.942]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.56it/s, atk: -201.904 ent: -5.038 str: 0.000 loss: -206.942]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.56it/s, atk: -206.808 ent: -5.040 str: 0.000 loss: -211.848]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.57it/s, atk: -206.808 ent: -5.040 str: 0.000 loss: -211.848]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.57it/s, atk: -211.478 ent: -5.041 str: 0.000 loss: -216.519]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.64it/s, atk: -211.478 ent: -5.041 str: 0.000 loss: -216.519]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.64it/s, atk: -216.486 ent: -5.040 str: 0.000 loss: -221.527]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.63it/s, atk: -216.486 ent: -5.040 str: 0.000 loss: -221.527]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.63it/s, atk: -221.410 ent: -5.042 str: 0.000 loss: -226.452]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.65it/s, atk: -221.410 ent: -5.042 str: 0.000 loss: -226.452]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.65it/s, atk: -226.494 ent: -5.046 str: 0.000 loss: -231.540]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.62it/s, atk: -226.494 ent: -5.046 str: 0.000 loss: -231.540]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.62it/s, atk: -230.605 ent: -5.049 str: 0.000 loss: -235.654]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.59it/s, atk: -230.605 ent: -5.049 str: 0.000 loss: -235.654]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.48it/s, atk: -230.605 ent: -5.049 str: 0.000 loss: -235.654]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([283], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([338], device='cuda:0') tensor(6.3712e-11, device='cuda:0')
L1: [2297.5493]	L2: [14.681323]	Linf: [0.5294118]

Accuracy on benign examples: 100.0%
gt_label: 718 pred_label: 718 pred_clean_logit 0.6015207767486572
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.15it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 21.87it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.88it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 20.76it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 20.84it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 21.96it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.29it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.21s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.18s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.57s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4930
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -11.474 ent: -2.743 str: 0.000 loss: -14.216]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -11.474 ent: -2.743 str: 0.000 loss: -14.216]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -23.165 ent: -2.745 str: 0.000 loss: -25.910]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.22s/it, atk: -23.165 ent: -2.745 str: 0.000 loss: -25.910]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.22s/it, atk: -40.210 ent: -2.738 str: 0.000 loss: -42.948]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -40.210 ent: -2.738 str: 0.000 loss: -42.948]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.03it/s, atk: -59.989 ent: -2.730 str: 0.000 loss: -62.719]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -59.989 ent: -2.730 str: 0.000 loss: -62.719]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.20it/s, atk: -67.906 ent: -2.730 str: 0.000 loss: -70.636]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -67.906 ent: -2.730 str: 0.000 loss: -70.636]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.31it/s, atk: -83.140 ent: -2.730 str: 0.000 loss: -85.870]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.41it/s, atk: -83.140 ent: -2.730 str: 0.000 loss: -85.870]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.41it/s, atk: -97.122 ent: -2.730 str: 0.000 loss: -99.852]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -97.122 ent: -2.730 str: 0.000 loss: -99.852]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -107.869 ent: -2.731 str: 0.000 loss: -110.600]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.48it/s, atk: -107.869 ent: -2.731 str: 0.000 loss: -110.600]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.48it/s, atk: -118.819 ent: -2.732 str: 0.000 loss: -121.551]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -118.819 ent: -2.732 str: 0.000 loss: -121.551]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.49it/s, atk: -130.489 ent: -2.731 str: 0.000 loss: -133.220]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.54it/s, atk: -130.489 ent: -2.731 str: 0.000 loss: -133.220]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.54it/s, atk: -139.228 ent: -2.731 str: 0.000 loss: -141.959]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.42it/s, atk: -139.228 ent: -2.731 str: 0.000 loss: -141.959]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -148.318 ent: -2.732 str: 0.000 loss: -151.050]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -148.318 ent: -2.732 str: 0.000 loss: -151.050]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -155.040 ent: -2.733 str: 0.000 loss: -157.773]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.52it/s, atk: -155.040 ent: -2.733 str: 0.000 loss: -157.773]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.52it/s, atk: -162.370 ent: -2.734 str: 0.000 loss: -165.103]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.57it/s, atk: -162.370 ent: -2.734 str: 0.000 loss: -165.103]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.57it/s, atk: -168.610 ent: -2.733 str: 0.000 loss: -171.343]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -168.610 ent: -2.733 str: 0.000 loss: -171.343]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.51it/s, atk: -175.342 ent: -2.733 str: 0.000 loss: -178.075]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -175.342 ent: -2.733 str: 0.000 loss: -178.075]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.51it/s, atk: -180.954 ent: -2.733 str: 0.000 loss: -183.687]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.57it/s, atk: -180.954 ent: -2.733 str: 0.000 loss: -183.687]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.57it/s, atk: -187.585 ent: -2.732 str: 0.000 loss: -190.317]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.65it/s, atk: -187.585 ent: -2.732 str: 0.000 loss: -190.317]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.65it/s, atk: -192.304 ent: -2.733 str: 0.000 loss: -195.037]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.63it/s, atk: -192.304 ent: -2.733 str: 0.000 loss: -195.037]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.63it/s, atk: -196.939 ent: -2.736 str: 0.000 loss: -199.675]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.56it/s, atk: -196.939 ent: -2.736 str: 0.000 loss: -199.675]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.56it/s, atk: -202.362 ent: -2.739 str: 0.000 loss: -205.101]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.63it/s, atk: -202.362 ent: -2.739 str: 0.000 loss: -205.101]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.63it/s, atk: -206.140 ent: -2.740 str: 0.000 loss: -208.880]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.61it/s, atk: -206.140 ent: -2.740 str: 0.000 loss: -208.880]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.61it/s, atk: -210.465 ent: -2.741 str: 0.000 loss: -213.205]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.65it/s, atk: -210.465 ent: -2.741 str: 0.000 loss: -213.205]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.65it/s, atk: -214.211 ent: -2.742 str: 0.000 loss: -216.954]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.61it/s, atk: -214.211 ent: -2.742 str: 0.000 loss: -216.954]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.61it/s, atk: -218.654 ent: -2.744 str: 0.000 loss: -221.398]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -218.654 ent: -2.744 str: 0.000 loss: -221.398]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -223.010 ent: -2.744 str: 0.000 loss: -225.754]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.58it/s, atk: -223.010 ent: -2.744 str: 0.000 loss: -225.754]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.58it/s, atk: -226.209 ent: -2.744 str: 0.000 loss: -228.953]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.63it/s, atk: -226.209 ent: -2.744 str: 0.000 loss: -228.953]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.63it/s, atk: -230.376 ent: -2.744 str: 0.000 loss: -233.121]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.61it/s, atk: -230.376 ent: -2.744 str: 0.000 loss: -233.121]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.61it/s, atk: -234.244 ent: -2.745 str: 0.000 loss: -236.989]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -234.244 ent: -2.745 str: 0.000 loss: -236.989]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.55it/s, atk: -238.408 ent: -2.744 str: 0.000 loss: -241.153]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.65it/s, atk: -238.408 ent: -2.744 str: 0.000 loss: -241.153]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.47it/s, atk: -238.408 ent: -2.744 str: 0.000 loss: -241.153]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([525], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([718], device='cuda:0') tensor(3.3980e-11, device='cuda:0')
L1: [4553.4585]	L2: [29.460295]	Linf: [0.74509805]

Accuracy on benign examples: 100.0%
gt_label: 839 pred_label: 839 pred_clean_logit 0.9976487755775452
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.67it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.65it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 20.44it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.23it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.46it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.19it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.88it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.21s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.26s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.26s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.39s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.51s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.42s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5101
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.036 ent: -4.943 str: 0.000 loss: -4.979]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.75s/it, atk: -0.036 ent: -4.943 str: 0.000 loss: -4.979]Iterations:   3%|▎         | 1/30 [00:02<00:50,  1.75s/it, atk: -0.177 ent: -4.958 str: 0.000 loss: -5.135]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -0.177 ent: -4.958 str: 0.000 loss: -5.135]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.11s/it, atk: -0.597 ent: -4.961 str: 0.000 loss: -5.558]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -0.597 ent: -4.961 str: 0.000 loss: -5.558]Iterations:  10%|█         | 3/30 [00:03<00:24,  1.12it/s, atk: -1.659 ent: -4.955 str: 0.000 loss: -6.614]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.25it/s, atk: -1.659 ent: -4.955 str: 0.000 loss: -6.614]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.25it/s, atk: -4.827 ent: -4.944 str: 0.000 loss: -9.771]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -4.827 ent: -4.944 str: 0.000 loss: -9.771]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -7.057 ent: -4.941 str: 0.000 loss: -11.997]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.40it/s, atk: -7.057 ent: -4.941 str: 0.000 loss: -11.997]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.40it/s, atk: -12.983 ent: -4.936 str: 0.000 loss: -17.920]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.46it/s, atk: -12.983 ent: -4.936 str: 0.000 loss: -17.920]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.46it/s, atk: -18.384 ent: -4.930 str: 0.000 loss: -23.314]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -18.384 ent: -4.930 str: 0.000 loss: -23.314]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -26.472 ent: -4.928 str: 0.000 loss: -31.400]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -26.472 ent: -4.928 str: 0.000 loss: -31.400]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.46it/s, atk: -34.392 ent: -4.928 str: 0.000 loss: -39.320]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.49it/s, atk: -34.392 ent: -4.928 str: 0.000 loss: -39.320]Iterations:  33%|███▎      | 10/30 [00:08<00:13,  1.49it/s, atk: -40.830 ent: -4.929 str: 0.000 loss: -45.759]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -40.830 ent: -4.929 str: 0.000 loss: -45.759]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -47.741 ent: -4.930 str: 0.000 loss: -52.671]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.55it/s, atk: -47.741 ent: -4.930 str: 0.000 loss: -52.671]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.55it/s, atk: -54.182 ent: -4.933 str: 0.000 loss: -59.115]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.57it/s, atk: -54.182 ent: -4.933 str: 0.000 loss: -59.115]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.57it/s, atk: -62.045 ent: -4.929 str: 0.000 loss: -66.973]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.58it/s, atk: -62.045 ent: -4.929 str: 0.000 loss: -66.973]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.58it/s, atk: -68.522 ent: -4.929 str: 0.000 loss: -73.451]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.50it/s, atk: -68.522 ent: -4.929 str: 0.000 loss: -73.451]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -76.682 ent: -4.928 str: 0.000 loss: -81.610]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -76.682 ent: -4.928 str: 0.000 loss: -81.610]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.51it/s, atk: -83.966 ent: -4.928 str: 0.000 loss: -88.894]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -83.966 ent: -4.928 str: 0.000 loss: -88.894]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -94.114 ent: -4.929 str: 0.000 loss: -99.043]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.61it/s, atk: -94.114 ent: -4.929 str: 0.000 loss: -99.043]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.61it/s, atk: -102.292 ent: -4.926 str: 0.000 loss: -107.218]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.69it/s, atk: -102.292 ent: -4.926 str: 0.000 loss: -107.218]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.69it/s, atk: -109.237 ent: -4.926 str: 0.000 loss: -114.162]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.70it/s, atk: -109.237 ent: -4.926 str: 0.000 loss: -114.162]Iterations:  67%|██████▋   | 20/30 [00:14<00:05,  1.70it/s, atk: -107.469 ent: -4.925 str: 0.000 loss: -112.394]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.66it/s, atk: -107.469 ent: -4.925 str: 0.000 loss: -112.394]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.66it/s, atk: -124.074 ent: -4.928 str: 0.000 loss: -129.002]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.65it/s, atk: -124.074 ent: -4.928 str: 0.000 loss: -129.002]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.65it/s, atk: -128.806 ent: -4.930 str: 0.000 loss: -133.736]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.67it/s, atk: -128.806 ent: -4.930 str: 0.000 loss: -133.736]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.67it/s, atk: -135.608 ent: -4.932 str: 0.000 loss: -140.540]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.70it/s, atk: -135.608 ent: -4.932 str: 0.000 loss: -140.540]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.70it/s, atk: -140.503 ent: -4.932 str: 0.000 loss: -145.435]Iterations:  83%|████████▎ | 25/30 [00:16<00:02,  1.69it/s, atk: -140.503 ent: -4.932 str: 0.000 loss: -145.435]Iterations:  83%|████████▎ | 25/30 [00:17<00:02,  1.69it/s, atk: -144.064 ent: -4.931 str: 0.000 loss: -148.995]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.65it/s, atk: -144.064 ent: -4.931 str: 0.000 loss: -148.995]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.65it/s, atk: -151.966 ent: -4.929 str: 0.000 loss: -156.895]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.61it/s, atk: -151.966 ent: -4.929 str: 0.000 loss: -156.895]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.61it/s, atk: -155.935 ent: -4.930 str: 0.000 loss: -160.865]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.64it/s, atk: -155.935 ent: -4.930 str: 0.000 loss: -160.865]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.64it/s, atk: -161.860 ent: -4.929 str: 0.000 loss: -166.789]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.62it/s, atk: -161.860 ent: -4.929 str: 0.000 loss: -166.789]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.62it/s, atk: -167.527 ent: -4.930 str: 0.000 loss: -172.457]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.64it/s, atk: -167.527 ent: -4.930 str: 0.000 loss: -172.457]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.51it/s, atk: -167.527 ent: -4.930 str: 0.000 loss: -172.457]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([853], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([839], device='cuda:0') tensor(2.9022e-08, device='cuda:0')
L1: [3658.106]	L2: [24.951746]	Linf: [0.7411765]

Accuracy on benign examples: 100.0%
gt_label: 975 pred_label: 975 pred_clean_logit 0.347047358751297
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.69it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.61it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.10it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.47it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.02it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.59it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.52it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.73it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.11it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.57s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.30s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.33s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.45s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.55s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.48s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3551
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -9.049 ent: -2.657 str: 0.000 loss: -11.706]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -9.049 ent: -2.657 str: 0.000 loss: -11.706]Iterations:   3%|▎         | 1/30 [00:01<00:34,  1.19s/it, atk: -14.087 ent: -2.641 str: 0.000 loss: -16.728]Iterations:   7%|▋         | 2/30 [00:01<00:22,  1.22it/s, atk: -14.087 ent: -2.641 str: 0.000 loss: -16.728]Iterations:   7%|▋         | 2/30 [00:02<00:22,  1.22it/s, atk: -17.062 ent: -2.597 str: 0.000 loss: -19.659]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.37it/s, atk: -17.062 ent: -2.597 str: 0.000 loss: -19.659]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.37it/s, atk: -16.934 ent: -2.630 str: 0.000 loss: -19.564]Iterations:  13%|█▎        | 4/30 [00:02<00:17,  1.49it/s, atk: -16.934 ent: -2.630 str: 0.000 loss: -19.564]Iterations:  13%|█▎        | 4/30 [00:03<00:17,  1.49it/s, atk: -20.933 ent: -2.621 str: 0.000 loss: -23.554]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.57it/s, atk: -20.933 ent: -2.621 str: 0.000 loss: -23.554]Iterations:  17%|█▋        | 5/30 [00:03<00:15,  1.57it/s, atk: -24.409 ent: -2.618 str: 0.000 loss: -27.026]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.57it/s, atk: -24.409 ent: -2.618 str: 0.000 loss: -27.026]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.57it/s, atk: -32.203 ent: -2.576 str: 0.000 loss: -34.780]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.56it/s, atk: -32.203 ent: -2.576 str: 0.000 loss: -34.780]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.56it/s, atk: -35.514 ent: -2.576 str: 0.000 loss: -38.089]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.56it/s, atk: -35.514 ent: -2.576 str: 0.000 loss: -38.089]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.56it/s, atk: -42.587 ent: -2.577 str: 0.000 loss: -45.164]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.63it/s, atk: -42.587 ent: -2.577 str: 0.000 loss: -45.164]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.63it/s, atk: -47.427 ent: -2.579 str: 0.000 loss: -50.005]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.57it/s, atk: -47.427 ent: -2.579 str: 0.000 loss: -50.005]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.57it/s, atk: -52.125 ent: -2.580 str: 0.000 loss: -54.705]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.64it/s, atk: -52.125 ent: -2.580 str: 0.000 loss: -54.705]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.64it/s, atk: -55.707 ent: -2.582 str: 0.000 loss: -58.289]Iterations:  40%|████      | 12/30 [00:07<00:10,  1.64it/s, atk: -55.707 ent: -2.582 str: 0.000 loss: -58.289]Iterations:  40%|████      | 12/30 [00:08<00:10,  1.64it/s, atk: -60.429 ent: -2.584 str: 0.000 loss: -63.013]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.70it/s, atk: -60.429 ent: -2.584 str: 0.000 loss: -63.013]Iterations:  43%|████▎     | 13/30 [00:08<00:09,  1.70it/s, atk: -64.876 ent: -2.584 str: 0.000 loss: -67.460]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.74it/s, atk: -64.876 ent: -2.584 str: 0.000 loss: -67.460]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.74it/s, atk: -66.968 ent: -2.582 str: 0.000 loss: -69.549]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.77it/s, atk: -66.968 ent: -2.582 str: 0.000 loss: -69.549]Iterations:  50%|█████     | 15/30 [00:09<00:08,  1.77it/s, atk: -67.841 ent: -2.581 str: 0.000 loss: -70.422]Iterations:  53%|█████▎    | 16/30 [00:10<00:07,  1.77it/s, atk: -67.841 ent: -2.581 str: 0.000 loss: -70.422]Iterations:  53%|█████▎    | 16/30 [00:10<00:07,  1.77it/s, atk: -72.089 ent: -2.579 str: 0.000 loss: -74.668]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.69it/s, atk: -72.089 ent: -2.579 str: 0.000 loss: -74.668]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.69it/s, atk: -75.599 ent: -2.575 str: 0.000 loss: -78.174]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.70it/s, atk: -75.599 ent: -2.575 str: 0.000 loss: -78.174]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.70it/s, atk: -78.780 ent: -2.575 str: 0.000 loss: -81.355]Iterations:  63%|██████▎   | 19/30 [00:11<00:06,  1.76it/s, atk: -78.780 ent: -2.575 str: 0.000 loss: -81.355]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.76it/s, atk: -80.884 ent: -2.578 str: 0.000 loss: -83.463]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.72it/s, atk: -80.884 ent: -2.578 str: 0.000 loss: -83.463]Iterations:  67%|██████▋   | 20/30 [00:12<00:05,  1.72it/s, atk: -83.661 ent: -2.579 str: 0.000 loss: -86.240]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.55it/s, atk: -83.661 ent: -2.579 str: 0.000 loss: -86.240]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.55it/s, atk: -86.702 ent: -2.577 str: 0.000 loss: -89.278]Iterations:  73%|███████▎  | 22/30 [00:13<00:05,  1.59it/s, atk: -86.702 ent: -2.577 str: 0.000 loss: -89.278]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.59it/s, atk: -88.355 ent: -2.576 str: 0.000 loss: -90.931]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.63it/s, atk: -88.355 ent: -2.576 str: 0.000 loss: -90.931]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.63it/s, atk: -90.466 ent: -2.576 str: 0.000 loss: -93.042]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.56it/s, atk: -90.466 ent: -2.576 str: 0.000 loss: -93.042]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.56it/s, atk: -92.858 ent: -2.576 str: 0.000 loss: -95.434]Iterations:  83%|████████▎ | 25/30 [00:15<00:03,  1.63it/s, atk: -92.858 ent: -2.576 str: 0.000 loss: -95.434]Iterations:  83%|████████▎ | 25/30 [00:15<00:03,  1.63it/s, atk: -95.346 ent: -2.577 str: 0.000 loss: -97.922]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.63it/s, atk: -95.346 ent: -2.577 str: 0.000 loss: -97.922]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.63it/s, atk: -97.894 ent: -2.575 str: 0.000 loss: -100.469]Iterations:  90%|█████████ | 27/30 [00:16<00:01,  1.61it/s, atk: -97.894 ent: -2.575 str: 0.000 loss: -100.469]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.61it/s, atk: -100.350 ent: -2.573 str: 0.000 loss: -102.923]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.61it/s, atk: -100.350 ent: -2.573 str: 0.000 loss: -102.923]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.61it/s, atk: -102.520 ent: -2.572 str: 0.000 loss: -105.092]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.64it/s, atk: -102.520 ent: -2.572 str: 0.000 loss: -105.092]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.64it/s, atk: -104.609 ent: -2.571 str: 0.000 loss: -107.180]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.61it/s, atk: -104.609 ent: -2.571 str: 0.000 loss: -107.180]Iterations: 100%|██████████| 30/30 [00:18<00:00,  1.60it/s, atk: -104.609 ent: -2.571 str: 0.000 loss: -107.180]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([417], device='cuda:0') tensor(0.7954, device='cuda:0')
after_true: tensor([975], device='cuda:0') tensor(2.3472e-05, device='cuda:0')
L1: [2994.9731]	L2: [19.8667]	Linf: [0.7882353]

Accuracy on benign examples: 100.0%
gt_label: 396 pred_label: 396 pred_clean_logit 0.9905920624732971
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.31it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.15it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 21.33it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.83it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.82it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.56it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.21it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.46s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.37s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.37s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.44s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.54s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.48s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4512
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.146 ent: -5.326 str: 0.000 loss: -5.472]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.67s/it, atk: -0.146 ent: -5.326 str: 0.000 loss: -5.472]Iterations:   3%|▎         | 1/30 [00:02<00:48,  1.67s/it, atk: -1.777 ent: -5.329 str: 0.000 loss: -7.106]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -1.777 ent: -5.329 str: 0.000 loss: -7.106]Iterations:   7%|▋         | 2/30 [00:02<00:29,  1.06s/it, atk: -8.129 ent: -5.308 str: 0.000 loss: -13.437]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.14it/s, atk: -8.129 ent: -5.308 str: 0.000 loss: -13.437]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.14it/s, atk: -29.054 ent: -5.318 str: 0.000 loss: -34.372]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -29.054 ent: -5.318 str: 0.000 loss: -34.372]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.29it/s, atk: -40.670 ent: -5.326 str: 0.000 loss: -45.996]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.41it/s, atk: -40.670 ent: -5.326 str: 0.000 loss: -45.996]Iterations:  17%|█▋        | 5/30 [00:04<00:17,  1.41it/s, atk: -49.802 ent: -5.314 str: 0.000 loss: -55.116]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.43it/s, atk: -49.802 ent: -5.314 str: 0.000 loss: -55.116]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.43it/s, atk: -58.450 ent: -5.315 str: 0.000 loss: -63.764]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.45it/s, atk: -58.450 ent: -5.315 str: 0.000 loss: -63.764]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.45it/s, atk: -63.777 ent: -5.315 str: 0.000 loss: -69.093]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.55it/s, atk: -63.777 ent: -5.315 str: 0.000 loss: -69.093]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.55it/s, atk: -69.600 ent: -5.314 str: 0.000 loss: -74.915]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.63it/s, atk: -69.600 ent: -5.314 str: 0.000 loss: -74.915]Iterations:  30%|███       | 9/30 [00:06<00:12,  1.63it/s, atk: -74.797 ent: -5.317 str: 0.000 loss: -80.114]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -74.797 ent: -5.317 str: 0.000 loss: -80.114]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.63it/s, atk: -80.356 ent: -5.318 str: 0.000 loss: -85.674]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.56it/s, atk: -80.356 ent: -5.318 str: 0.000 loss: -85.674]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.56it/s, atk: -85.188 ent: -5.312 str: 0.000 loss: -90.499]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.62it/s, atk: -85.188 ent: -5.312 str: 0.000 loss: -90.499]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.62it/s, atk: -90.712 ent: -5.313 str: 0.000 loss: -96.025]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.68it/s, atk: -90.712 ent: -5.313 str: 0.000 loss: -96.025]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.68it/s, atk: -94.051 ent: -5.311 str: 0.000 loss: -99.362]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.67it/s, atk: -94.051 ent: -5.311 str: 0.000 loss: -99.362]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.67it/s, atk: -99.597 ent: -5.314 str: 0.000 loss: -104.911]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.56it/s, atk: -99.597 ent: -5.314 str: 0.000 loss: -104.911]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.56it/s, atk: -104.773 ent: -5.317 str: 0.000 loss: -110.090]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.63it/s, atk: -104.773 ent: -5.317 str: 0.000 loss: -110.090]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.63it/s, atk: -109.090 ent: -5.318 str: 0.000 loss: -114.408]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.68it/s, atk: -109.090 ent: -5.318 str: 0.000 loss: -114.408]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.68it/s, atk: -114.528 ent: -5.318 str: 0.000 loss: -119.845]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -114.528 ent: -5.318 str: 0.000 loss: -119.845]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.63it/s, atk: -119.256 ent: -5.315 str: 0.000 loss: -124.571]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.66it/s, atk: -119.256 ent: -5.315 str: 0.000 loss: -124.571]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.66it/s, atk: -124.411 ent: -5.312 str: 0.000 loss: -129.724]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.70it/s, atk: -124.411 ent: -5.312 str: 0.000 loss: -129.724]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.70it/s, atk: -128.567 ent: -5.309 str: 0.000 loss: -133.877]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.64it/s, atk: -128.567 ent: -5.309 str: 0.000 loss: -133.877]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.64it/s, atk: -133.174 ent: -5.311 str: 0.000 loss: -138.484]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.68it/s, atk: -133.174 ent: -5.311 str: 0.000 loss: -138.484]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.68it/s, atk: -136.560 ent: -5.311 str: 0.000 loss: -141.871]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.75it/s, atk: -136.560 ent: -5.311 str: 0.000 loss: -141.871]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.75it/s, atk: -140.344 ent: -5.311 str: 0.000 loss: -145.654]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.73it/s, atk: -140.344 ent: -5.311 str: 0.000 loss: -145.654]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.73it/s, atk: -144.007 ent: -5.314 str: 0.000 loss: -149.321]Iterations:  83%|████████▎ | 25/30 [00:16<00:02,  1.74it/s, atk: -144.007 ent: -5.314 str: 0.000 loss: -149.321]Iterations:  83%|████████▎ | 25/30 [00:16<00:02,  1.74it/s, atk: -148.535 ent: -5.310 str: 0.000 loss: -153.846]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.69it/s, atk: -148.535 ent: -5.310 str: 0.000 loss: -153.846]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.69it/s, atk: -151.488 ent: -5.308 str: 0.000 loss: -156.797]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.59it/s, atk: -151.488 ent: -5.308 str: 0.000 loss: -156.797]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.59it/s, atk: -155.750 ent: -5.310 str: 0.000 loss: -161.060]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.57it/s, atk: -155.750 ent: -5.310 str: 0.000 loss: -161.060]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.57it/s, atk: -159.425 ent: -5.312 str: 0.000 loss: -164.737]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.55it/s, atk: -159.425 ent: -5.312 str: 0.000 loss: -164.737]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.55it/s, atk: -162.247 ent: -5.309 str: 0.000 loss: -167.556]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.51it/s, atk: -162.247 ent: -5.309 str: 0.000 loss: -167.556]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.53it/s, atk: -162.247 ent: -5.309 str: 0.000 loss: -167.556]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([115], device='cuda:0') tensor(0.9999, device='cuda:0')
after_true: tensor([396], device='cuda:0') tensor(6.3344e-08, device='cuda:0')
L1: [4463.3174]	L2: [30.813412]	Linf: [0.84705883]

Accuracy on benign examples: 100.0%
gt_label: 884 pred_label: 884 pred_clean_logit 0.9667505025863647
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.77it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.80it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 20.87it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 22.01it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 22.89it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 22.58it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.94it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.42s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.26s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.26s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.36s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.45s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:06<00:00,  1.39s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4960
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.200 ent: -2.475 str: 0.000 loss: -2.675]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.06s/it, atk: -0.200 ent: -2.475 str: 0.000 loss: -2.675]Iterations:   3%|▎         | 1/30 [00:01<00:30,  1.06s/it, atk: -0.246 ent: -2.466 str: 0.000 loss: -2.712]Iterations:   7%|▋         | 2/30 [00:01<00:23,  1.17it/s, atk: -0.246 ent: -2.466 str: 0.000 loss: -2.712]Iterations:   7%|▋         | 2/30 [00:02<00:23,  1.17it/s, atk: -0.458 ent: -2.465 str: 0.000 loss: -2.924]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.27it/s, atk: -0.458 ent: -2.465 str: 0.000 loss: -2.924]Iterations:  10%|█         | 3/30 [00:02<00:21,  1.27it/s, atk: -0.692 ent: -2.463 str: 0.000 loss: -3.155]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.43it/s, atk: -0.692 ent: -2.463 str: 0.000 loss: -3.155]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.43it/s, atk: -1.007 ent: -2.463 str: 0.000 loss: -3.469]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.56it/s, atk: -1.007 ent: -2.463 str: 0.000 loss: -3.469]Iterations:  17%|█▋        | 5/30 [00:03<00:16,  1.56it/s, atk: -1.417 ent: -2.463 str: 0.000 loss: -3.879]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.63it/s, atk: -1.417 ent: -2.463 str: 0.000 loss: -3.879]Iterations:  20%|██        | 6/30 [00:04<00:14,  1.63it/s, atk: -2.236 ent: -2.463 str: 0.000 loss: -4.698]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.58it/s, atk: -2.236 ent: -2.463 str: 0.000 loss: -4.698]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.58it/s, atk: -3.117 ent: -2.463 str: 0.000 loss: -5.580]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.49it/s, atk: -3.117 ent: -2.463 str: 0.000 loss: -5.580]Iterations:  27%|██▋       | 8/30 [00:05<00:14,  1.49it/s, atk: -4.337 ent: -2.463 str: 0.000 loss: -6.800]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.52it/s, atk: -4.337 ent: -2.463 str: 0.000 loss: -6.800]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.52it/s, atk: -4.834 ent: -2.464 str: 0.000 loss: -7.298]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.58it/s, atk: -4.834 ent: -2.464 str: 0.000 loss: -7.298]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.58it/s, atk: -6.374 ent: -2.462 str: 0.000 loss: -8.836]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.55it/s, atk: -6.374 ent: -2.462 str: 0.000 loss: -8.836]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.55it/s, atk: -8.760 ent: -2.460 str: 0.000 loss: -11.220]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.56it/s, atk: -8.760 ent: -2.460 str: 0.000 loss: -11.220]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.56it/s, atk: -11.808 ent: -2.458 str: 0.000 loss: -14.266]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.57it/s, atk: -11.808 ent: -2.458 str: 0.000 loss: -14.266]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.57it/s, atk: -15.332 ent: -2.457 str: 0.000 loss: -17.789]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.60it/s, atk: -15.332 ent: -2.457 str: 0.000 loss: -17.789]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.60it/s, atk: -19.439 ent: -2.458 str: 0.000 loss: -21.897]Iterations:  50%|█████     | 15/30 [00:09<00:09,  1.59it/s, atk: -19.439 ent: -2.458 str: 0.000 loss: -21.897]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.59it/s, atk: -23.133 ent: -2.457 str: 0.000 loss: -25.591]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.58it/s, atk: -23.133 ent: -2.457 str: 0.000 loss: -25.591]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.58it/s, atk: -27.669 ent: -2.458 str: 0.000 loss: -30.127]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -27.669 ent: -2.458 str: 0.000 loss: -30.127]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -29.815 ent: -2.460 str: 0.000 loss: -32.275]Iterations:  60%|██████    | 18/30 [00:11<00:07,  1.64it/s, atk: -29.815 ent: -2.460 str: 0.000 loss: -32.275]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.64it/s, atk: -34.069 ent: -2.461 str: 0.000 loss: -36.529]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.66it/s, atk: -34.069 ent: -2.461 str: 0.000 loss: -36.529]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.66it/s, atk: -38.966 ent: -2.460 str: 0.000 loss: -41.426]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.61it/s, atk: -38.966 ent: -2.460 str: 0.000 loss: -41.426]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.61it/s, atk: -42.399 ent: -2.459 str: 0.000 loss: -44.858]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.60it/s, atk: -42.399 ent: -2.459 str: 0.000 loss: -44.858]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.60it/s, atk: -45.951 ent: -2.460 str: 0.000 loss: -48.411]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.65it/s, atk: -45.951 ent: -2.460 str: 0.000 loss: -48.411]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.65it/s, atk: -49.500 ent: -2.460 str: 0.000 loss: -51.960]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.71it/s, atk: -49.500 ent: -2.460 str: 0.000 loss: -51.960]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.71it/s, atk: -52.292 ent: -2.460 str: 0.000 loss: -54.752]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.69it/s, atk: -52.292 ent: -2.460 str: 0.000 loss: -54.752]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.69it/s, atk: -51.136 ent: -2.459 str: 0.000 loss: -53.594]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.59it/s, atk: -51.136 ent: -2.459 str: 0.000 loss: -53.594]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.59it/s, atk: -51.518 ent: -2.458 str: 0.000 loss: -53.976]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.62it/s, atk: -51.518 ent: -2.458 str: 0.000 loss: -53.976]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.62it/s, atk: -55.361 ent: -2.457 str: 0.000 loss: -57.818]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.65it/s, atk: -55.361 ent: -2.457 str: 0.000 loss: -57.818]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.65it/s, atk: -56.177 ent: -2.456 str: 0.000 loss: -58.633]Iterations:  93%|█████████▎| 28/30 [00:17<00:01,  1.64it/s, atk: -56.177 ent: -2.456 str: 0.000 loss: -58.633]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.64it/s, atk: -60.968 ent: -2.455 str: 0.000 loss: -63.423]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.55it/s, atk: -60.968 ent: -2.455 str: 0.000 loss: -63.423]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.55it/s, atk: -64.138 ent: -2.455 str: 0.000 loss: -66.593]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.54it/s, atk: -64.138 ent: -2.455 str: 0.000 loss: -66.593]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.56it/s, atk: -64.138 ent: -2.455 str: 0.000 loss: -66.593]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([741], device='cuda:0') tensor(0.9412, device='cuda:0')
after_true: tensor([884], device='cuda:0') tensor(0.0010, device='cuda:0')
L1: [2760.2239]	L2: [18.056622]	Linf: [0.52156866]

Accuracy on benign examples: 100.0%
gt_label: 57 pred_label: 57 pred_clean_logit 0.9336503744125366
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 16.65it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.53it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.59it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 16.69it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.30it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.55it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.15it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.85it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.47s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.32s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.38s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.43s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.47s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3974
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -1.925 ent: -4.820 str: 0.000 loss: -6.745]Iterations:   3%|▎         | 1/30 [00:01<00:35,  1.24s/it, atk: -1.925 ent: -4.820 str: 0.000 loss: -6.745]Iterations:   3%|▎         | 1/30 [00:01<00:35,  1.24s/it, atk: -5.396 ent: -4.823 str: 0.000 loss: -10.219]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.12it/s, atk: -5.396 ent: -4.823 str: 0.000 loss: -10.219]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.12it/s, atk: -9.892 ent: -4.820 str: 0.000 loss: -14.712]Iterations:  10%|█         | 3/30 [00:02<00:23,  1.16it/s, atk: -9.892 ent: -4.820 str: 0.000 loss: -14.712]Iterations:  10%|█         | 3/30 [00:03<00:23,  1.16it/s, atk: -14.395 ent: -4.818 str: 0.000 loss: -19.214]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -14.395 ent: -4.818 str: 0.000 loss: -19.214]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.21it/s, atk: -19.116 ent: -4.814 str: 0.000 loss: -23.930]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -19.116 ent: -4.814 str: 0.000 loss: -23.930]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.31it/s, atk: -22.283 ent: -4.819 str: 0.000 loss: -27.102]Iterations:  20%|██        | 6/30 [00:04<00:16,  1.45it/s, atk: -22.283 ent: -4.819 str: 0.000 loss: -27.102]Iterations:  20%|██        | 6/30 [00:05<00:16,  1.45it/s, atk: -24.868 ent: -4.812 str: 0.000 loss: -29.680]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -24.868 ent: -4.812 str: 0.000 loss: -29.680]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.51it/s, atk: -30.628 ent: -4.809 str: 0.000 loss: -35.437]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.48it/s, atk: -30.628 ent: -4.809 str: 0.000 loss: -35.437]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.48it/s, atk: -37.720 ent: -4.807 str: 0.000 loss: -42.528]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.57it/s, atk: -37.720 ent: -4.807 str: 0.000 loss: -42.528]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.57it/s, atk: -42.992 ent: -4.806 str: 0.000 loss: -47.798]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.60it/s, atk: -42.992 ent: -4.806 str: 0.000 loss: -47.798]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.60it/s, atk: -49.437 ent: -4.804 str: 0.000 loss: -54.241]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.65it/s, atk: -49.437 ent: -4.804 str: 0.000 loss: -54.241]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.65it/s, atk: -51.424 ent: -4.805 str: 0.000 loss: -56.229]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.59it/s, atk: -51.424 ent: -4.805 str: 0.000 loss: -56.229]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.59it/s, atk: -60.528 ent: -4.805 str: 0.000 loss: -65.333]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.50it/s, atk: -60.528 ent: -4.805 str: 0.000 loss: -65.333]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.50it/s, atk: -66.958 ent: -4.805 str: 0.000 loss: -71.763]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.60it/s, atk: -66.958 ent: -4.805 str: 0.000 loss: -71.763]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.60it/s, atk: -75.675 ent: -4.804 str: 0.000 loss: -80.479]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -75.675 ent: -4.804 str: 0.000 loss: -80.479]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -86.369 ent: -4.803 str: 0.000 loss: -91.172]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.62it/s, atk: -86.369 ent: -4.803 str: 0.000 loss: -91.172]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.62it/s, atk: -92.614 ent: -4.802 str: 0.000 loss: -97.416]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.66it/s, atk: -92.614 ent: -4.802 str: 0.000 loss: -97.416]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.66it/s, atk: -98.969 ent: -4.801 str: 0.000 loss: -103.770]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.68it/s, atk: -98.969 ent: -4.801 str: 0.000 loss: -103.770]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.68it/s, atk: -106.767 ent: -4.800 str: 0.000 loss: -111.566]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.73it/s, atk: -106.767 ent: -4.800 str: 0.000 loss: -111.566]Iterations:  63%|██████▎   | 19/30 [00:12<00:06,  1.73it/s, atk: -111.705 ent: -4.798 str: 0.000 loss: -116.503]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.74it/s, atk: -111.705 ent: -4.798 str: 0.000 loss: -116.503]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.74it/s, atk: -117.839 ent: -4.797 str: 0.000 loss: -122.635]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.75it/s, atk: -117.839 ent: -4.797 str: 0.000 loss: -122.635]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.75it/s, atk: -124.079 ent: -4.795 str: 0.000 loss: -128.873]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.70it/s, atk: -124.079 ent: -4.795 str: 0.000 loss: -128.873]Iterations:  73%|███████▎  | 22/30 [00:14<00:04,  1.70it/s, atk: -130.375 ent: -4.794 str: 0.000 loss: -135.169]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.67it/s, atk: -130.375 ent: -4.794 str: 0.000 loss: -135.169]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.67it/s, atk: -139.476 ent: -4.791 str: 0.000 loss: -144.267]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.63it/s, atk: -139.476 ent: -4.791 str: 0.000 loss: -144.267]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.63it/s, atk: -149.539 ent: -4.790 str: 0.000 loss: -154.328]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.65it/s, atk: -149.539 ent: -4.790 str: 0.000 loss: -154.328]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.65it/s, atk: -155.160 ent: -4.790 str: 0.000 loss: -159.950]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.58it/s, atk: -155.160 ent: -4.790 str: 0.000 loss: -159.950]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.58it/s, atk: -152.866 ent: -4.791 str: 0.000 loss: -157.657]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.62it/s, atk: -152.866 ent: -4.791 str: 0.000 loss: -157.657]Iterations:  90%|█████████ | 27/30 [00:17<00:01,  1.62it/s, atk: -165.326 ent: -4.790 str: 0.000 loss: -170.116]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.63it/s, atk: -165.326 ent: -4.790 str: 0.000 loss: -170.116]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.63it/s, atk: -165.799 ent: -4.789 str: 0.000 loss: -170.587]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.71it/s, atk: -165.799 ent: -4.789 str: 0.000 loss: -170.587]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.71it/s, atk: -174.960 ent: -4.789 str: 0.000 loss: -179.749]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.71it/s, atk: -174.960 ent: -4.789 str: 0.000 loss: -179.749]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.57it/s, atk: -174.960 ent: -4.789 str: 0.000 loss: -179.749]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([489], device='cuda:0') tensor(0.9948, device='cuda:0')
after_true: tensor([57], device='cuda:0') tensor(1.1502e-08, device='cuda:0')
L1: [5831.981]	L2: [36.2638]	Linf: [0.9372549]

Accuracy on benign examples: 100.0%
gt_label: 243 pred_label: 243 pred_clean_logit 0.8913249969482422
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.83it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.67it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 21.32it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 22.72it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 22.99it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.78it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.69it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.98it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.88s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.65s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.67s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3393
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.365 ent: -5.518 str: 0.000 loss: -7.883]Iterations:   3%|▎         | 1/30 [00:01<00:53,  1.86s/it, atk: -2.365 ent: -5.518 str: 0.000 loss: -7.883]Iterations:   3%|▎         | 1/30 [00:02<00:53,  1.86s/it, atk: -7.936 ent: -5.515 str: 0.000 loss: -13.451]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.13s/it, atk: -7.936 ent: -5.515 str: 0.000 loss: -13.451]Iterations:   7%|▋         | 2/30 [00:02<00:31,  1.13s/it, atk: -18.461 ent: -5.509 str: 0.000 loss: -23.970]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -18.461 ent: -5.509 str: 0.000 loss: -23.970]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -25.119 ent: -5.503 str: 0.000 loss: -30.623]Iterations:  13%|█▎        | 4/30 [00:03<00:20,  1.24it/s, atk: -25.119 ent: -5.503 str: 0.000 loss: -30.623]Iterations:  13%|█▎        | 4/30 [00:04<00:20,  1.24it/s, atk: -35.684 ent: -5.504 str: 0.000 loss: -41.188]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.35it/s, atk: -35.684 ent: -5.504 str: 0.000 loss: -41.188]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.35it/s, atk: -45.581 ent: -5.496 str: 0.000 loss: -51.077]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -45.581 ent: -5.496 str: 0.000 loss: -51.077]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.35it/s, atk: -57.047 ent: -5.492 str: 0.000 loss: -62.539]Iterations:  23%|██▎       | 7/30 [00:05<00:16,  1.43it/s, atk: -57.047 ent: -5.492 str: 0.000 loss: -62.539]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.43it/s, atk: -70.069 ent: -5.494 str: 0.000 loss: -75.563]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.51it/s, atk: -70.069 ent: -5.494 str: 0.000 loss: -75.563]Iterations:  27%|██▋       | 8/30 [00:06<00:14,  1.51it/s, atk: -82.594 ent: -5.494 str: 0.000 loss: -88.089]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.59it/s, atk: -82.594 ent: -5.494 str: 0.000 loss: -88.089]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.59it/s, atk: -93.352 ent: -5.492 str: 0.000 loss: -98.844]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.56it/s, atk: -93.352 ent: -5.492 str: 0.000 loss: -98.844]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.56it/s, atk: -102.115 ent: -5.490 str: 0.000 loss: -107.605]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.62it/s, atk: -102.115 ent: -5.490 str: 0.000 loss: -107.605]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.62it/s, atk: -109.204 ent: -5.495 str: 0.000 loss: -114.699]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.63it/s, atk: -109.204 ent: -5.495 str: 0.000 loss: -114.699]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.63it/s, atk: -116.389 ent: -5.496 str: 0.000 loss: -121.884]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.61it/s, atk: -116.389 ent: -5.496 str: 0.000 loss: -121.884]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.61it/s, atk: -124.180 ent: -5.492 str: 0.000 loss: -129.673]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.63it/s, atk: -124.180 ent: -5.492 str: 0.000 loss: -129.673]Iterations:  47%|████▋     | 14/30 [00:10<00:09,  1.63it/s, atk: -130.451 ent: -5.486 str: 0.000 loss: -135.937]Iterations:  50%|█████     | 15/30 [00:10<00:10,  1.47it/s, atk: -130.451 ent: -5.486 str: 0.000 loss: -135.937]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.47it/s, atk: -134.806 ent: -5.481 str: 0.000 loss: -140.287]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.57it/s, atk: -134.806 ent: -5.481 str: 0.000 loss: -140.287]Iterations:  53%|█████▎    | 16/30 [00:11<00:08,  1.57it/s, atk: -140.607 ent: -5.482 str: 0.000 loss: -146.090]Iterations:  57%|█████▋    | 17/30 [00:11<00:08,  1.60it/s, atk: -140.607 ent: -5.482 str: 0.000 loss: -146.090]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.60it/s, atk: -146.136 ent: -5.488 str: 0.000 loss: -151.624]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.62it/s, atk: -146.136 ent: -5.488 str: 0.000 loss: -151.624]Iterations:  60%|██████    | 18/30 [00:12<00:07,  1.62it/s, atk: -149.825 ent: -5.493 str: 0.000 loss: -155.318]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.69it/s, atk: -149.825 ent: -5.493 str: 0.000 loss: -155.318]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.69it/s, atk: -153.882 ent: -5.495 str: 0.000 loss: -159.376]Iterations:  67%|██████▋   | 20/30 [00:13<00:05,  1.69it/s, atk: -153.882 ent: -5.495 str: 0.000 loss: -159.376]Iterations:  67%|██████▋   | 20/30 [00:14<00:05,  1.69it/s, atk: -158.060 ent: -5.493 str: 0.000 loss: -163.553]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.65it/s, atk: -158.060 ent: -5.493 str: 0.000 loss: -163.553]Iterations:  70%|███████   | 21/30 [00:14<00:05,  1.65it/s, atk: -161.669 ent: -5.494 str: 0.000 loss: -167.162]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.61it/s, atk: -161.669 ent: -5.494 str: 0.000 loss: -167.162]Iterations:  73%|███████▎  | 22/30 [00:15<00:04,  1.61it/s, atk: -165.338 ent: -5.496 str: 0.000 loss: -170.834]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.56it/s, atk: -165.338 ent: -5.496 str: 0.000 loss: -170.834]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.56it/s, atk: -169.392 ent: -5.498 str: 0.000 loss: -174.890]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.63it/s, atk: -169.392 ent: -5.498 str: 0.000 loss: -174.890]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.63it/s, atk: -173.448 ent: -5.499 str: 0.000 loss: -178.947]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.63it/s, atk: -173.448 ent: -5.499 str: 0.000 loss: -178.947]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.63it/s, atk: -177.175 ent: -5.498 str: 0.000 loss: -182.673]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.63it/s, atk: -177.175 ent: -5.498 str: 0.000 loss: -182.673]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.63it/s, atk: -180.550 ent: -5.496 str: 0.000 loss: -186.046]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.59it/s, atk: -180.550 ent: -5.496 str: 0.000 loss: -186.046]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.59it/s, atk: -184.149 ent: -5.497 str: 0.000 loss: -189.646]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.59it/s, atk: -184.149 ent: -5.497 str: 0.000 loss: -189.646]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.59it/s, atk: -187.677 ent: -5.500 str: 0.000 loss: -193.177]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.64it/s, atk: -187.677 ent: -5.500 str: 0.000 loss: -193.177]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.64it/s, atk: -190.829 ent: -5.503 str: 0.000 loss: -196.332]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.64it/s, atk: -190.829 ent: -5.503 str: 0.000 loss: -196.332]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.50it/s, atk: -190.829 ent: -5.503 str: 0.000 loss: -196.332]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([159], device='cuda:0') tensor(0.9688, device='cuda:0')
after_true: tensor([243], device='cuda:0') tensor(3.5625e-09, device='cuda:0')
L1: [3253.7024]	L2: [21.295536]	Linf: [0.74509805]

Accuracy on benign examples: 100.0%
gt_label: 770 pred_label: 770 pred_clean_logit 0.925714373588562
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 25.20it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 23.15it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 23.66it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 23.51it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 22.28it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 22.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 22.98it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.28s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.26s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.34s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.43s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.60s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.49s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5957
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -1.042 ent: -5.422 str: 0.000 loss: -6.464]Iterations:   3%|▎         | 1/30 [00:02<01:12,  2.52s/it, atk: -1.042 ent: -5.422 str: 0.000 loss: -6.464]Iterations:   3%|▎         | 1/30 [00:02<01:12,  2.52s/it, atk: -1.004 ent: -5.434 str: 0.000 loss: -6.438]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.43s/it, atk: -1.004 ent: -5.434 str: 0.000 loss: -6.438]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.43s/it, atk: -1.667 ent: -5.438 str: 0.000 loss: -7.105]Iterations:  10%|█         | 3/30 [00:03<00:27,  1.02s/it, atk: -1.667 ent: -5.438 str: 0.000 loss: -7.105]Iterations:  10%|█         | 3/30 [00:04<00:27,  1.02s/it, atk: -1.641 ent: -5.433 str: 0.000 loss: -7.074]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -1.641 ent: -5.433 str: 0.000 loss: -7.074]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -2.094 ent: -5.437 str: 0.000 loss: -7.531]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.29it/s, atk: -2.094 ent: -5.437 str: 0.000 loss: -7.531]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.29it/s, atk: -3.154 ent: -5.441 str: 0.000 loss: -8.595]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.39it/s, atk: -3.154 ent: -5.441 str: 0.000 loss: -8.595]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.39it/s, atk: -4.741 ent: -5.447 str: 0.000 loss: -10.188]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.51it/s, atk: -4.741 ent: -5.447 str: 0.000 loss: -10.188]Iterations:  23%|██▎       | 7/30 [00:06<00:15,  1.51it/s, atk: -6.497 ent: -5.448 str: 0.000 loss: -11.944]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.61it/s, atk: -6.497 ent: -5.448 str: 0.000 loss: -11.944]Iterations:  27%|██▋       | 8/30 [00:06<00:13,  1.61it/s, atk: -9.296 ent: -5.447 str: 0.000 loss: -14.743]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.65it/s, atk: -9.296 ent: -5.447 str: 0.000 loss: -14.743]Iterations:  30%|███       | 9/30 [00:07<00:12,  1.65it/s, atk: -11.613 ent: -5.446 str: 0.000 loss: -17.059]Iterations:  33%|███▎      | 10/30 [00:07<00:12,  1.62it/s, atk: -11.613 ent: -5.446 str: 0.000 loss: -17.059]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.62it/s, atk: -15.321 ent: -5.443 str: 0.000 loss: -20.764]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.54it/s, atk: -15.321 ent: -5.443 str: 0.000 loss: -20.764]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.54it/s, atk: -18.323 ent: -5.441 str: 0.000 loss: -23.764]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.58it/s, atk: -18.323 ent: -5.441 str: 0.000 loss: -23.764]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.58it/s, atk: -21.319 ent: -5.438 str: 0.000 loss: -26.757]Iterations:  43%|████▎     | 13/30 [00:09<00:10,  1.61it/s, atk: -21.319 ent: -5.438 str: 0.000 loss: -26.757]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.61it/s, atk: -24.493 ent: -5.441 str: 0.000 loss: -29.934]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -24.493 ent: -5.441 str: 0.000 loss: -29.934]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.54it/s, atk: -28.904 ent: -5.439 str: 0.000 loss: -34.343]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -28.904 ent: -5.439 str: 0.000 loss: -34.343]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.43it/s, atk: -33.655 ent: -5.440 str: 0.000 loss: -39.095]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -33.655 ent: -5.440 str: 0.000 loss: -39.095]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.35it/s, atk: -36.358 ent: -5.444 str: 0.000 loss: -41.802]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.45it/s, atk: -36.358 ent: -5.444 str: 0.000 loss: -41.802]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -43.019 ent: -5.443 str: 0.000 loss: -48.462]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.49it/s, atk: -43.019 ent: -5.443 str: 0.000 loss: -48.462]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.49it/s, atk: -46.929 ent: -5.441 str: 0.000 loss: -52.370]Iterations:  63%|██████▎   | 19/30 [00:13<00:07,  1.56it/s, atk: -46.929 ent: -5.441 str: 0.000 loss: -52.370]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.56it/s, atk: -51.532 ent: -5.440 str: 0.000 loss: -56.972]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.52it/s, atk: -51.532 ent: -5.440 str: 0.000 loss: -56.972]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.52it/s, atk: -55.003 ent: -5.441 str: 0.000 loss: -60.444]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -55.003 ent: -5.441 str: 0.000 loss: -60.444]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.54it/s, atk: -59.062 ent: -5.440 str: 0.000 loss: -64.503]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.51it/s, atk: -59.062 ent: -5.440 str: 0.000 loss: -64.503]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.51it/s, atk: -62.451 ent: -5.438 str: 0.000 loss: -67.889]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.58it/s, atk: -62.451 ent: -5.438 str: 0.000 loss: -67.889]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.58it/s, atk: -65.857 ent: -5.438 str: 0.000 loss: -71.295]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.63it/s, atk: -65.857 ent: -5.438 str: 0.000 loss: -71.295]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.63it/s, atk: -68.303 ent: -5.439 str: 0.000 loss: -73.741]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.59it/s, atk: -68.303 ent: -5.439 str: 0.000 loss: -73.741]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.59it/s, atk: -70.670 ent: -5.440 str: 0.000 loss: -76.110]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.56it/s, atk: -70.670 ent: -5.440 str: 0.000 loss: -76.110]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.56it/s, atk: -73.711 ent: -5.440 str: 0.000 loss: -79.151]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -73.711 ent: -5.440 str: 0.000 loss: -79.151]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.56it/s, atk: -76.602 ent: -5.441 str: 0.000 loss: -82.042]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.64it/s, atk: -76.602 ent: -5.441 str: 0.000 loss: -82.042]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.64it/s, atk: -78.763 ent: -5.441 str: 0.000 loss: -84.204]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.48it/s, atk: -78.763 ent: -5.441 str: 0.000 loss: -84.204]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.48it/s, atk: -81.666 ent: -5.442 str: 0.000 loss: -87.108]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.47it/s, atk: -81.666 ent: -5.442 str: 0.000 loss: -87.108]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.42it/s, atk: -81.666 ent: -5.442 str: 0.000 loss: -87.108]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([748], device='cuda:0') tensor(0.4056, device='cuda:0')
after_true: tensor([770], device='cuda:0') tensor(0.0002, device='cuda:0')
L1: [1295.6039]	L2: [9.904509]	Linf: [0.8666667]

Accuracy on benign examples: 100.0%
gt_label: 820 pred_label: 820 pred_clean_logit 0.7132763266563416
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.12it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.65it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 13.92it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 16.86it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.11it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 20.91it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 21.86it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.19it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.66s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.43s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.56s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4771
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -7.156 ent: -4.871 str: 0.000 loss: -12.027]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.52s/it, atk: -7.156 ent: -4.871 str: 0.000 loss: -12.027]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.52s/it, atk: -15.398 ent: -4.872 str: 0.000 loss: -20.270]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -15.398 ent: -4.872 str: 0.000 loss: -20.270]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.41s/it, atk: -24.564 ent: -4.869 str: 0.000 loss: -29.432]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.08s/it, atk: -24.564 ent: -4.869 str: 0.000 loss: -29.432]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.08s/it, atk: -25.166 ent: -4.855 str: 0.000 loss: -30.021]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.13it/s, atk: -25.166 ent: -4.855 str: 0.000 loss: -30.021]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.13it/s, atk: -29.511 ent: -4.850 str: 0.000 loss: -34.361]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -29.511 ent: -4.850 str: 0.000 loss: -34.361]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -36.707 ent: -4.850 str: 0.000 loss: -41.557]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.28it/s, atk: -36.707 ent: -4.850 str: 0.000 loss: -41.557]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.28it/s, atk: -42.113 ent: -4.852 str: 0.000 loss: -46.965]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.41it/s, atk: -42.113 ent: -4.852 str: 0.000 loss: -46.965]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.41it/s, atk: -47.538 ent: -4.855 str: 0.000 loss: -52.393]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.51it/s, atk: -47.538 ent: -4.855 str: 0.000 loss: -52.393]Iterations:  27%|██▋       | 8/30 [00:07<00:14,  1.51it/s, atk: -52.831 ent: -4.855 str: 0.000 loss: -57.686]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.57it/s, atk: -52.831 ent: -4.855 str: 0.000 loss: -57.686]Iterations:  30%|███       | 9/30 [00:07<00:13,  1.57it/s, atk: -58.590 ent: -4.855 str: 0.000 loss: -63.445]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.61it/s, atk: -58.590 ent: -4.855 str: 0.000 loss: -63.445]Iterations:  33%|███▎      | 10/30 [00:08<00:12,  1.61it/s, atk: -63.295 ent: -4.854 str: 0.000 loss: -68.149]Iterations:  37%|███▋      | 11/30 [00:08<00:11,  1.61it/s, atk: -63.295 ent: -4.854 str: 0.000 loss: -68.149]Iterations:  37%|███▋      | 11/30 [00:09<00:11,  1.61it/s, atk: -69.409 ent: -4.854 str: 0.000 loss: -74.263]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -69.409 ent: -4.854 str: 0.000 loss: -74.263]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.54it/s, atk: -74.613 ent: -4.853 str: 0.000 loss: -79.466]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.56it/s, atk: -74.613 ent: -4.853 str: 0.000 loss: -79.466]Iterations:  43%|████▎     | 13/30 [00:10<00:10,  1.56it/s, atk: -77.728 ent: -4.853 str: 0.000 loss: -82.581]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.57it/s, atk: -77.728 ent: -4.853 str: 0.000 loss: -82.581]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.57it/s, atk: -81.640 ent: -4.853 str: 0.000 loss: -86.493]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.56it/s, atk: -81.640 ent: -4.853 str: 0.000 loss: -86.493]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.56it/s, atk: -81.890 ent: -4.854 str: 0.000 loss: -86.744]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.53it/s, atk: -81.890 ent: -4.854 str: 0.000 loss: -86.744]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.53it/s, atk: -88.256 ent: -4.852 str: 0.000 loss: -93.108]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.56it/s, atk: -88.256 ent: -4.852 str: 0.000 loss: -93.108]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.56it/s, atk: -94.539 ent: -4.850 str: 0.000 loss: -99.389]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.61it/s, atk: -94.539 ent: -4.850 str: 0.000 loss: -99.389]Iterations:  60%|██████    | 18/30 [00:13<00:07,  1.61it/s, atk: -101.067 ent: -4.851 str: 0.000 loss: -105.918]Iterations:  63%|██████▎   | 19/30 [00:13<00:06,  1.59it/s, atk: -101.067 ent: -4.851 str: 0.000 loss: -105.918]Iterations:  63%|██████▎   | 19/30 [00:14<00:06,  1.59it/s, atk: -106.615 ent: -4.851 str: 0.000 loss: -111.466]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -106.615 ent: -4.851 str: 0.000 loss: -111.466]Iterations:  67%|██████▋   | 20/30 [00:14<00:06,  1.54it/s, atk: -113.526 ent: -4.851 str: 0.000 loss: -118.377]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.61it/s, atk: -113.526 ent: -4.851 str: 0.000 loss: -118.377]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.61it/s, atk: -121.548 ent: -4.852 str: 0.000 loss: -126.399]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.48it/s, atk: -121.548 ent: -4.852 str: 0.000 loss: -126.399]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.48it/s, atk: -128.755 ent: -4.853 str: 0.000 loss: -133.609]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.57it/s, atk: -128.755 ent: -4.853 str: 0.000 loss: -133.609]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.57it/s, atk: -133.934 ent: -4.856 str: 0.000 loss: -138.790]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.61it/s, atk: -133.934 ent: -4.856 str: 0.000 loss: -138.790]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.61it/s, atk: -141.809 ent: -4.857 str: 0.000 loss: -146.666]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.61it/s, atk: -141.809 ent: -4.857 str: 0.000 loss: -146.666]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.61it/s, atk: -149.098 ent: -4.857 str: 0.000 loss: -153.955]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.59it/s, atk: -149.098 ent: -4.857 str: 0.000 loss: -153.955]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.59it/s, atk: -156.158 ent: -4.856 str: 0.000 loss: -161.014]Iterations:  90%|█████████ | 27/30 [00:18<00:01,  1.63it/s, atk: -156.158 ent: -4.856 str: 0.000 loss: -161.014]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.63it/s, atk: -161.702 ent: -4.857 str: 0.000 loss: -166.559]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.64it/s, atk: -161.702 ent: -4.857 str: 0.000 loss: -166.559]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.64it/s, atk: -168.478 ent: -4.858 str: 0.000 loss: -173.336]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.70it/s, atk: -168.478 ent: -4.858 str: 0.000 loss: -173.336]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.70it/s, atk: -174.364 ent: -4.857 str: 0.000 loss: -179.221]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.66it/s, atk: -174.364 ent: -4.857 str: 0.000 loss: -179.221]Iterations: 100%|██████████| 30/30 [00:20<00:00,  1.45it/s, atk: -174.364 ent: -4.857 str: 0.000 loss: -179.221]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([695], device='cuda:0') tensor(0.7329, device='cuda:0')
after_true: tensor([820], device='cuda:0') tensor(1.3356e-08, device='cuda:0')
L1: [2540.5298]	L2: [18.089302]	Linf: [0.8156863]

Accuracy on benign examples: 100.0%
gt_label: 479 pred_label: 479 pred_clean_logit 0.7805743217468262
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.51it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 10.27it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 12.70it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 14.08it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.20it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.63it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 17.04it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.86it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.43it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.12s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.15s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:03<00:02,  1.29s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.53s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.50s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6004
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.779 ent: -4.991 str: 0.000 loss: -9.769]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.34s/it, atk: -4.779 ent: -4.991 str: 0.000 loss: -9.769]Iterations:   3%|▎         | 1/30 [00:01<00:38,  1.34s/it, atk: -15.101 ent: -4.990 str: 0.000 loss: -20.091]Iterations:   7%|▋         | 2/30 [00:01<00:25,  1.10it/s, atk: -15.101 ent: -4.990 str: 0.000 loss: -20.091]Iterations:   7%|▋         | 2/30 [00:02<00:25,  1.10it/s, atk: -27.250 ent: -4.988 str: 0.000 loss: -32.238]Iterations:  10%|█         | 3/30 [00:02<00:22,  1.20it/s, atk: -27.250 ent: -4.988 str: 0.000 loss: -32.238]Iterations:  10%|█         | 3/30 [00:03<00:22,  1.20it/s, atk: -42.721 ent: -4.984 str: 0.000 loss: -47.705]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.14it/s, atk: -42.721 ent: -4.984 str: 0.000 loss: -47.705]Iterations:  13%|█▎        | 4/30 [00:03<00:22,  1.14it/s, atk: -52.532 ent: -4.984 str: 0.000 loss: -57.516]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -52.532 ent: -4.984 str: 0.000 loss: -57.516]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -64.871 ent: -4.984 str: 0.000 loss: -69.855]Iterations:  20%|██        | 6/30 [00:04<00:17,  1.34it/s, atk: -64.871 ent: -4.984 str: 0.000 loss: -69.855]Iterations:  20%|██        | 6/30 [00:05<00:17,  1.34it/s, atk: -73.394 ent: -4.986 str: 0.000 loss: -78.381]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.44it/s, atk: -73.394 ent: -4.986 str: 0.000 loss: -78.381]Iterations:  23%|██▎       | 7/30 [00:05<00:15,  1.44it/s, atk: -81.330 ent: -4.984 str: 0.000 loss: -86.313]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -81.330 ent: -4.984 str: 0.000 loss: -86.313]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.39it/s, atk: -88.655 ent: -4.982 str: 0.000 loss: -93.636]Iterations:  30%|███       | 9/30 [00:06<00:14,  1.45it/s, atk: -88.655 ent: -4.982 str: 0.000 loss: -93.636]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.45it/s, atk: -95.119 ent: -4.978 str: 0.000 loss: -100.098]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.49it/s, atk: -95.119 ent: -4.978 str: 0.000 loss: -100.098]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.49it/s, atk: -100.719 ent: -4.974 str: 0.000 loss: -105.693]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.53it/s, atk: -100.719 ent: -4.974 str: 0.000 loss: -105.693]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.53it/s, atk: -105.431 ent: -4.972 str: 0.000 loss: -110.403]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.45it/s, atk: -105.431 ent: -4.972 str: 0.000 loss: -110.403]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.45it/s, atk: -107.861 ent: -4.971 str: 0.000 loss: -112.832]Iterations:  43%|████▎     | 13/30 [00:09<00:12,  1.35it/s, atk: -107.861 ent: -4.971 str: 0.000 loss: -112.832]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.35it/s, atk: -108.047 ent: -4.971 str: 0.000 loss: -113.017]Iterations:  47%|████▋     | 14/30 [00:10<00:12,  1.27it/s, atk: -108.047 ent: -4.971 str: 0.000 loss: -113.017]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.27it/s, atk: -117.345 ent: -4.969 str: 0.000 loss: -122.315]Iterations:  50%|█████     | 15/30 [00:11<00:12,  1.20it/s, atk: -117.345 ent: -4.969 str: 0.000 loss: -122.315]Iterations:  50%|█████     | 15/30 [00:12<00:12,  1.20it/s, atk: -117.588 ent: -4.973 str: 0.000 loss: -122.562]Iterations:  53%|█████▎    | 16/30 [00:12<00:11,  1.25it/s, atk: -117.588 ent: -4.973 str: 0.000 loss: -122.562]Iterations:  53%|█████▎    | 16/30 [00:12<00:11,  1.25it/s, atk: -124.626 ent: -4.977 str: 0.000 loss: -129.603]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.25it/s, atk: -124.626 ent: -4.977 str: 0.000 loss: -129.603]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.25it/s, atk: -126.269 ent: -4.980 str: 0.000 loss: -131.249]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.30it/s, atk: -126.269 ent: -4.980 str: 0.000 loss: -131.249]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.30it/s, atk: -122.129 ent: -4.982 str: 0.000 loss: -127.111]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -122.129 ent: -4.982 str: 0.000 loss: -127.111]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.38it/s, atk: -127.137 ent: -4.982 str: 0.000 loss: -132.119]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -127.137 ent: -4.982 str: 0.000 loss: -132.119]Iterations:  67%|██████▋   | 20/30 [00:15<00:06,  1.49it/s, atk: -133.445 ent: -4.982 str: 0.000 loss: -138.427]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.56it/s, atk: -133.445 ent: -4.982 str: 0.000 loss: -138.427]Iterations:  70%|███████   | 21/30 [00:15<00:05,  1.56it/s, atk: -138.853 ent: -4.982 str: 0.000 loss: -143.834]Iterations:  73%|███████▎  | 22/30 [00:16<00:04,  1.61it/s, atk: -138.853 ent: -4.982 str: 0.000 loss: -143.834]Iterations:  73%|███████▎  | 22/30 [00:16<00:04,  1.61it/s, atk: -143.261 ent: -4.981 str: 0.000 loss: -148.242]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.58it/s, atk: -143.261 ent: -4.981 str: 0.000 loss: -148.242]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.58it/s, atk: -146.388 ent: -4.980 str: 0.000 loss: -151.367]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -146.388 ent: -4.980 str: 0.000 loss: -151.367]Iterations:  80%|████████  | 24/30 [00:17<00:03,  1.54it/s, atk: -149.873 ent: -4.978 str: 0.000 loss: -154.851]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -149.873 ent: -4.978 str: 0.000 loss: -154.851]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.57it/s, atk: -154.834 ent: -4.977 str: 0.000 loss: -159.811]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.55it/s, atk: -154.834 ent: -4.977 str: 0.000 loss: -159.811]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.55it/s, atk: -160.557 ent: -4.975 str: 0.000 loss: -165.532]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.60it/s, atk: -160.557 ent: -4.975 str: 0.000 loss: -165.532]Iterations:  90%|█████████ | 27/30 [00:19<00:01,  1.60it/s, atk: -166.956 ent: -4.974 str: 0.000 loss: -171.929]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.50it/s, atk: -166.956 ent: -4.974 str: 0.000 loss: -171.929]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.50it/s, atk: -172.362 ent: -4.973 str: 0.000 loss: -177.335]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.45it/s, atk: -172.362 ent: -4.973 str: 0.000 loss: -177.335]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -178.248 ent: -4.971 str: 0.000 loss: -183.219]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.48it/s, atk: -178.248 ent: -4.971 str: 0.000 loss: -183.219]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.40it/s, atk: -178.248 ent: -4.971 str: 0.000 loss: -183.219]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([399], device='cuda:0') tensor(0.9861, device='cuda:0')
after_true: tensor([479], device='cuda:0') tensor(1.0716e-08, device='cuda:0')
L1: [1969.0316]	L2: [15.908131]	Linf: [0.92156863]

Accuracy on benign examples: 100.0%
gt_label: 820 pred_label: 820 pred_clean_logit 0.974668025970459
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.62it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 20.60it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 22.66it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 19.66it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 15.83it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.80it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.80s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.48s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.6415
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.249 ent: -5.353 str: 0.000 loss: -5.602]Iterations:   3%|▎         | 1/30 [00:01<00:29,  1.01s/it, atk: -0.249 ent: -5.353 str: 0.000 loss: -5.602]Iterations:   3%|▎         | 1/30 [00:01<00:29,  1.01s/it, atk: -1.066 ent: -5.346 str: 0.000 loss: -6.412]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.38it/s, atk: -1.066 ent: -5.346 str: 0.000 loss: -6.412]Iterations:   7%|▋         | 2/30 [00:01<00:20,  1.38it/s, atk: -1.419 ent: -5.340 str: 0.000 loss: -6.759]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.38it/s, atk: -1.419 ent: -5.340 str: 0.000 loss: -6.759]Iterations:  10%|█         | 3/30 [00:02<00:19,  1.38it/s, atk: -1.711 ent: -5.326 str: 0.000 loss: -7.037]Iterations:  13%|█▎        | 4/30 [00:02<00:18,  1.41it/s, atk: -1.711 ent: -5.326 str: 0.000 loss: -7.037]Iterations:  13%|█▎        | 4/30 [00:03<00:18,  1.41it/s, atk: -3.622 ent: -5.316 str: 0.000 loss: -8.938]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.43it/s, atk: -3.622 ent: -5.316 str: 0.000 loss: -8.938]Iterations:  17%|█▋        | 5/30 [00:03<00:17,  1.43it/s, atk: -5.875 ent: -5.314 str: 0.000 loss: -11.189]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.57it/s, atk: -5.875 ent: -5.314 str: 0.000 loss: -11.189]Iterations:  20%|██        | 6/30 [00:04<00:15,  1.57it/s, atk: -10.264 ent: -5.336 str: 0.000 loss: -15.600]Iterations:  23%|██▎       | 7/30 [00:04<00:14,  1.60it/s, atk: -10.264 ent: -5.336 str: 0.000 loss: -15.600]Iterations:  23%|██▎       | 7/30 [00:05<00:14,  1.60it/s, atk: -16.798 ent: -5.328 str: 0.000 loss: -22.126]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.62it/s, atk: -16.798 ent: -5.328 str: 0.000 loss: -22.126]Iterations:  27%|██▋       | 8/30 [00:05<00:13,  1.62it/s, atk: -22.740 ent: -5.335 str: 0.000 loss: -28.075]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.55it/s, atk: -22.740 ent: -5.335 str: 0.000 loss: -28.075]Iterations:  30%|███       | 9/30 [00:06<00:13,  1.55it/s, atk: -31.932 ent: -5.339 str: 0.000 loss: -37.271]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.59it/s, atk: -31.932 ent: -5.339 str: 0.000 loss: -37.271]Iterations:  33%|███▎      | 10/30 [00:06<00:12,  1.59it/s, atk: -38.833 ent: -5.342 str: 0.000 loss: -44.175]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.63it/s, atk: -38.833 ent: -5.342 str: 0.000 loss: -44.175]Iterations:  37%|███▋      | 11/30 [00:07<00:11,  1.63it/s, atk: -48.497 ent: -5.342 str: 0.000 loss: -53.839]Iterations:  40%|████      | 12/30 [00:07<00:11,  1.63it/s, atk: -48.497 ent: -5.342 str: 0.000 loss: -53.839]Iterations:  40%|████      | 12/30 [00:08<00:11,  1.63it/s, atk: -57.131 ent: -5.347 str: 0.000 loss: -62.478]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.65it/s, atk: -57.131 ent: -5.347 str: 0.000 loss: -62.478]Iterations:  43%|████▎     | 13/30 [00:08<00:10,  1.65it/s, atk: -61.370 ent: -5.342 str: 0.000 loss: -66.712]Iterations:  47%|████▋     | 14/30 [00:08<00:09,  1.68it/s, atk: -61.370 ent: -5.342 str: 0.000 loss: -66.712]Iterations:  47%|████▋     | 14/30 [00:09<00:09,  1.68it/s, atk: -73.135 ent: -5.342 str: 0.000 loss: -78.477]Iterations:  50%|█████     | 15/30 [00:09<00:09,  1.62it/s, atk: -73.135 ent: -5.342 str: 0.000 loss: -78.477]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.62it/s, atk: -80.471 ent: -5.346 str: 0.000 loss: -85.817]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.63it/s, atk: -80.471 ent: -5.346 str: 0.000 loss: -85.817]Iterations:  53%|█████▎    | 16/30 [00:10<00:08,  1.63it/s, atk: -89.244 ent: -5.347 str: 0.000 loss: -94.591]Iterations:  57%|█████▋    | 17/30 [00:10<00:07,  1.68it/s, atk: -89.244 ent: -5.347 str: 0.000 loss: -94.591]Iterations:  57%|█████▋    | 17/30 [00:11<00:07,  1.68it/s, atk: -99.420 ent: -5.347 str: 0.000 loss: -104.766]Iterations:  60%|██████    | 18/30 [00:11<00:08,  1.46it/s, atk: -99.420 ent: -5.347 str: 0.000 loss: -104.766]Iterations:  60%|██████    | 18/30 [00:12<00:08,  1.46it/s, atk: -108.228 ent: -5.342 str: 0.000 loss: -113.570]Iterations:  63%|██████▎   | 19/30 [00:12<00:07,  1.52it/s, atk: -108.228 ent: -5.342 str: 0.000 loss: -113.570]Iterations:  63%|██████▎   | 19/30 [00:12<00:07,  1.52it/s, atk: -122.007 ent: -5.341 str: 0.000 loss: -127.348]Iterations:  67%|██████▋   | 20/30 [00:12<00:06,  1.54it/s, atk: -122.007 ent: -5.341 str: 0.000 loss: -127.348]Iterations:  67%|██████▋   | 20/30 [00:13<00:06,  1.54it/s, atk: -126.160 ent: -5.342 str: 0.000 loss: -131.503]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.53it/s, atk: -126.160 ent: -5.342 str: 0.000 loss: -131.503]Iterations:  70%|███████   | 21/30 [00:13<00:05,  1.53it/s, atk: -135.052 ent: -5.341 str: 0.000 loss: -140.393]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.59it/s, atk: -135.052 ent: -5.341 str: 0.000 loss: -140.393]Iterations:  73%|███████▎  | 22/30 [00:14<00:05,  1.59it/s, atk: -143.477 ent: -5.340 str: 0.000 loss: -148.817]Iterations:  77%|███████▋  | 23/30 [00:14<00:04,  1.51it/s, atk: -143.477 ent: -5.340 str: 0.000 loss: -148.817]Iterations:  77%|███████▋  | 23/30 [00:15<00:04,  1.51it/s, atk: -153.289 ent: -5.344 str: 0.000 loss: -158.633]Iterations:  80%|████████  | 24/30 [00:15<00:03,  1.51it/s, atk: -153.289 ent: -5.344 str: 0.000 loss: -158.633]Iterations:  80%|████████  | 24/30 [00:16<00:03,  1.51it/s, atk: -162.691 ent: -5.345 str: 0.000 loss: -168.036]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.48it/s, atk: -162.691 ent: -5.345 str: 0.000 loss: -168.036]Iterations:  83%|████████▎ | 25/30 [00:16<00:03,  1.48it/s, atk: -173.690 ent: -5.342 str: 0.000 loss: -179.031]Iterations:  87%|████████▋ | 26/30 [00:16<00:02,  1.52it/s, atk: -173.690 ent: -5.342 str: 0.000 loss: -179.031]Iterations:  87%|████████▋ | 26/30 [00:17<00:02,  1.52it/s, atk: -185.259 ent: -5.336 str: 0.000 loss: -190.595]Iterations:  90%|█████████ | 27/30 [00:17<00:02,  1.49it/s, atk: -185.259 ent: -5.336 str: 0.000 loss: -190.595]Iterations:  90%|█████████ | 27/30 [00:17<00:02,  1.49it/s, atk: -199.845 ent: -5.333 str: 0.000 loss: -205.178]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.50it/s, atk: -199.845 ent: -5.333 str: 0.000 loss: -205.178]Iterations:  93%|█████████▎| 28/30 [00:18<00:01,  1.50it/s, atk: -205.345 ent: -5.332 str: 0.000 loss: -210.678]Iterations:  97%|█████████▋| 29/30 [00:18<00:00,  1.56it/s, atk: -205.345 ent: -5.332 str: 0.000 loss: -210.678]Iterations:  97%|█████████▋| 29/30 [00:19<00:00,  1.56it/s, atk: -209.969 ent: -5.330 str: 0.000 loss: -215.299]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.58it/s, atk: -209.969 ent: -5.330 str: 0.000 loss: -215.299]Iterations: 100%|██████████| 30/30 [00:19<00:00,  1.54it/s, atk: -209.969 ent: -5.330 str: 0.000 loss: -215.299]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([812], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([820], device='cuda:0') tensor(1.9328e-10, device='cuda:0')
L1: [3733.7534]	L2: [24.218716]	Linf: [0.64705884]

Accuracy on benign examples: 100.0%
gt_label: 320 pred_label: 320 pred_clean_logit 0.7174971699714661
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.91it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 16.98it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.09it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 20.83it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 22.20it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 21.25it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 21.70it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 20.55it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.62s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.34s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.43s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3797
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -3.925 ent: -7.239 str: 0.000 loss: -11.164]Iterations:   3%|▎         | 1/30 [00:01<00:50,  1.72s/it, atk: -3.925 ent: -7.239 str: 0.000 loss: -11.164]Iterations:   3%|▎         | 1/30 [00:02<00:50,  1.72s/it, atk: -4.855 ent: -7.201 str: 0.000 loss: -12.056]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -4.855 ent: -7.201 str: 0.000 loss: -12.056]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -8.831 ent: -7.190 str: 0.000 loss: -16.021]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.07s/it, atk: -8.831 ent: -7.190 str: 0.000 loss: -16.021]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.07s/it, atk: -15.638 ent: -7.178 str: 0.000 loss: -22.816]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.03it/s, atk: -15.638 ent: -7.178 str: 0.000 loss: -22.816]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.03it/s, atk: -36.291 ent: -7.174 str: 0.000 loss: -43.465]Iterations:  17%|█▋        | 5/30 [00:05<00:23,  1.08it/s, atk: -36.291 ent: -7.174 str: 0.000 loss: -43.465]Iterations:  17%|█▋        | 5/30 [00:05<00:23,  1.08it/s, atk: -48.066 ent: -7.174 str: 0.000 loss: -55.240]Iterations:  20%|██        | 6/30 [00:06<00:23,  1.04it/s, atk: -48.066 ent: -7.174 str: 0.000 loss: -55.240]Iterations:  20%|██        | 6/30 [00:06<00:23,  1.04it/s, atk: -53.672 ent: -7.163 str: 0.000 loss: -60.835]Iterations:  23%|██▎       | 7/30 [00:06<00:20,  1.12it/s, atk: -53.672 ent: -7.163 str: 0.000 loss: -60.835]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.12it/s, atk: -63.645 ent: -7.153 str: 0.000 loss: -70.798]Iterations:  27%|██▋       | 8/30 [00:07<00:20,  1.09it/s, atk: -63.645 ent: -7.153 str: 0.000 loss: -70.798]Iterations:  27%|██▋       | 8/30 [00:08<00:20,  1.09it/s, atk: -74.453 ent: -7.149 str: 0.000 loss: -81.602]Iterations:  30%|███       | 9/30 [00:08<00:17,  1.21it/s, atk: -74.453 ent: -7.149 str: 0.000 loss: -81.602]Iterations:  30%|███       | 9/30 [00:08<00:17,  1.21it/s, atk: -79.566 ent: -7.141 str: 0.000 loss: -86.707]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.26it/s, atk: -79.566 ent: -7.141 str: 0.000 loss: -86.707]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.26it/s, atk: -89.875 ent: -7.140 str: 0.000 loss: -97.015]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.28it/s, atk: -89.875 ent: -7.140 str: 0.000 loss: -97.015]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.28it/s, atk: -98.705 ent: -7.143 str: 0.000 loss: -105.849]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.28it/s, atk: -98.705 ent: -7.143 str: 0.000 loss: -105.849]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.28it/s, atk: -105.348 ent: -7.143 str: 0.000 loss: -112.491]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.22it/s, atk: -105.348 ent: -7.143 str: 0.000 loss: -112.491]Iterations:  43%|████▎     | 13/30 [00:12<00:13,  1.22it/s, atk: -113.175 ent: -7.142 str: 0.000 loss: -120.318]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.28it/s, atk: -113.175 ent: -7.142 str: 0.000 loss: -120.318]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.28it/s, atk: -118.973 ent: -7.140 str: 0.000 loss: -126.113]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.28it/s, atk: -118.973 ent: -7.140 str: 0.000 loss: -126.113]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.28it/s, atk: -124.174 ent: -7.136 str: 0.000 loss: -131.311]Iterations:  53%|█████▎    | 16/30 [00:14<00:11,  1.17it/s, atk: -124.174 ent: -7.136 str: 0.000 loss: -131.311]Iterations:  53%|█████▎    | 16/30 [00:14<00:11,  1.17it/s, atk: -129.312 ent: -7.133 str: 0.000 loss: -136.445]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.28it/s, atk: -129.312 ent: -7.133 str: 0.000 loss: -136.445]Iterations:  57%|█████▋    | 17/30 [00:15<00:10,  1.28it/s, atk: -135.762 ent: -7.132 str: 0.000 loss: -142.894]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.36it/s, atk: -135.762 ent: -7.132 str: 0.000 loss: -142.894]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.36it/s, atk: -140.783 ent: -7.133 str: 0.000 loss: -147.915]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.35it/s, atk: -140.783 ent: -7.133 str: 0.000 loss: -147.915]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.35it/s, atk: -144.884 ent: -7.134 str: 0.000 loss: -152.018]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.39it/s, atk: -144.884 ent: -7.134 str: 0.000 loss: -152.018]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.39it/s, atk: -148.834 ent: -7.134 str: 0.000 loss: -155.968]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.42it/s, atk: -148.834 ent: -7.134 str: 0.000 loss: -155.968]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.42it/s, atk: -153.220 ent: -7.133 str: 0.000 loss: -160.353]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.46it/s, atk: -153.220 ent: -7.133 str: 0.000 loss: -160.353]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.46it/s, atk: -158.743 ent: -7.133 str: 0.000 loss: -165.876]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.47it/s, atk: -158.743 ent: -7.133 str: 0.000 loss: -165.876]Iterations:  77%|███████▋  | 23/30 [00:19<00:04,  1.47it/s, atk: -163.628 ent: -7.133 str: 0.000 loss: -170.761]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.47it/s, atk: -163.628 ent: -7.133 str: 0.000 loss: -170.761]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.47it/s, atk: -168.985 ent: -7.133 str: 0.000 loss: -176.118]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.41it/s, atk: -168.985 ent: -7.133 str: 0.000 loss: -176.118]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.41it/s, atk: -172.790 ent: -7.132 str: 0.000 loss: -179.922]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.45it/s, atk: -172.790 ent: -7.132 str: 0.000 loss: -179.922]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.45it/s, atk: -177.712 ent: -7.130 str: 0.000 loss: -184.842]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -177.712 ent: -7.130 str: 0.000 loss: -184.842]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -183.960 ent: -7.129 str: 0.000 loss: -191.089]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.46it/s, atk: -183.960 ent: -7.129 str: 0.000 loss: -191.089]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.46it/s, atk: -189.425 ent: -7.127 str: 0.000 loss: -196.552]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -189.425 ent: -7.127 str: 0.000 loss: -196.552]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -195.197 ent: -7.125 str: 0.000 loss: -202.322]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.31it/s, atk: -195.197 ent: -7.125 str: 0.000 loss: -202.322]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.25it/s, atk: -195.197 ent: -7.125 str: 0.000 loss: -202.322]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([310], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([320], device='cuda:0') tensor(2.1644e-09, device='cuda:0')
L1: [2177.8]	L2: [14.730486]	Linf: [0.8784314]

Accuracy on benign examples: 100.0%
gt_label: 630 pred_label: 630 pred_clean_logit 0.4246177077293396
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.36it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.55it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.68it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 18.71it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.93it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 19.40it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 19.20it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.58it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.81it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.87s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.68s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.68s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3094
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -5.321 ent: -5.620 str: 0.000 loss: -10.941]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.46s/it, atk: -5.321 ent: -5.620 str: 0.000 loss: -10.941]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.46s/it, atk: -12.481 ent: -5.608 str: 0.000 loss: -18.089]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -12.481 ent: -5.608 str: 0.000 loss: -18.089]Iterations:   7%|▋         | 2/30 [00:03<00:39,  1.42s/it, atk: -27.001 ent: -5.625 str: 0.000 loss: -32.626]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.12s/it, atk: -27.001 ent: -5.625 str: 0.000 loss: -32.626]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -36.160 ent: -5.625 str: 0.000 loss: -41.785]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -36.160 ent: -5.625 str: 0.000 loss: -41.785]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -48.275 ent: -5.607 str: 0.000 loss: -53.882]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -48.275 ent: -5.607 str: 0.000 loss: -53.882]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.18it/s, atk: -60.913 ent: -5.611 str: 0.000 loss: -66.523]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -60.913 ent: -5.611 str: 0.000 loss: -66.523]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.20it/s, atk: -66.949 ent: -5.604 str: 0.000 loss: -72.554]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -66.949 ent: -5.604 str: 0.000 loss: -72.554]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.25it/s, atk: -88.254 ent: -5.609 str: 0.000 loss: -93.863]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -88.254 ent: -5.609 str: 0.000 loss: -93.863]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -109.501 ent: -5.605 str: 0.000 loss: -115.106]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -109.501 ent: -5.605 str: 0.000 loss: -115.106]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -117.600 ent: -5.618 str: 0.000 loss: -123.218]Iterations:  33%|███▎      | 10/30 [00:09<00:17,  1.14it/s, atk: -117.600 ent: -5.618 str: 0.000 loss: -123.218]Iterations:  33%|███▎      | 10/30 [00:09<00:17,  1.14it/s, atk: -132.740 ent: -5.625 str: 0.000 loss: -138.365]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.21it/s, atk: -132.740 ent: -5.625 str: 0.000 loss: -138.365]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.21it/s, atk: -149.542 ent: -5.624 str: 0.000 loss: -155.166]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.25it/s, atk: -149.542 ent: -5.624 str: 0.000 loss: -155.166]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.25it/s, atk: -165.732 ent: -5.625 str: 0.000 loss: -171.357]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.33it/s, atk: -165.732 ent: -5.625 str: 0.000 loss: -171.357]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.33it/s, atk: -177.957 ent: -5.622 str: 0.000 loss: -183.579]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.37it/s, atk: -177.957 ent: -5.622 str: 0.000 loss: -183.579]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.37it/s, atk: -188.674 ent: -5.623 str: 0.000 loss: -194.297]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.37it/s, atk: -188.674 ent: -5.623 str: 0.000 loss: -194.297]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.37it/s, atk: -201.528 ent: -5.619 str: 0.000 loss: -207.147]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.40it/s, atk: -201.528 ent: -5.619 str: 0.000 loss: -207.147]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.40it/s, atk: -214.206 ent: -5.614 str: 0.000 loss: -219.819]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.40it/s, atk: -214.206 ent: -5.614 str: 0.000 loss: -219.819]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.40it/s, atk: -224.257 ent: -5.610 str: 0.000 loss: -229.867]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.26it/s, atk: -224.257 ent: -5.610 str: 0.000 loss: -229.867]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.26it/s, atk: -234.593 ent: -5.614 str: 0.000 loss: -240.207]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.31it/s, atk: -234.593 ent: -5.614 str: 0.000 loss: -240.207]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.31it/s, atk: -242.538 ent: -5.619 str: 0.000 loss: -248.157]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.19it/s, atk: -242.538 ent: -5.619 str: 0.000 loss: -248.157]Iterations:  67%|██████▋   | 20/30 [00:17<00:08,  1.19it/s, atk: -253.417 ent: -5.614 str: 0.000 loss: -259.032]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.22it/s, atk: -253.417 ent: -5.614 str: 0.000 loss: -259.032]Iterations:  70%|███████   | 21/30 [00:18<00:07,  1.22it/s, atk: -257.727 ent: -5.610 str: 0.000 loss: -263.337]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.30it/s, atk: -257.727 ent: -5.610 str: 0.000 loss: -263.337]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.30it/s, atk: -261.921 ent: -5.607 str: 0.000 loss: -267.528]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.34it/s, atk: -261.921 ent: -5.607 str: 0.000 loss: -267.528]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.34it/s, atk: -268.282 ent: -5.611 str: 0.000 loss: -273.893]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.38it/s, atk: -268.282 ent: -5.611 str: 0.000 loss: -273.893]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.38it/s, atk: -275.091 ent: -5.611 str: 0.000 loss: -280.702]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.38it/s, atk: -275.091 ent: -5.611 str: 0.000 loss: -280.702]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.38it/s, atk: -284.289 ent: -5.609 str: 0.000 loss: -289.898]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.31it/s, atk: -284.289 ent: -5.609 str: 0.000 loss: -289.898]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.31it/s, atk: -292.105 ent: -5.606 str: 0.000 loss: -297.711]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.35it/s, atk: -292.105 ent: -5.606 str: 0.000 loss: -297.711]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.35it/s, atk: -299.032 ent: -5.602 str: 0.000 loss: -304.634]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.36it/s, atk: -299.032 ent: -5.602 str: 0.000 loss: -304.634]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.36it/s, atk: -303.195 ent: -5.598 str: 0.000 loss: -308.793]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.22it/s, atk: -303.195 ent: -5.598 str: 0.000 loss: -308.793]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.22it/s, atk: -309.219 ent: -5.601 str: 0.000 loss: -314.820]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.28it/s, atk: -309.219 ent: -5.601 str: 0.000 loss: -314.820]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.23it/s, atk: -309.219 ent: -5.601 str: 0.000 loss: -314.820]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([791], device='cuda:0') tensor(0.9997, device='cuda:0')
after_true: tensor([630], device='cuda:0') tensor(1.9132e-14, device='cuda:0')
L1: [1311.7803]	L2: [8.842171]	Linf: [0.40784314]

Accuracy on benign examples: 100.0%
gt_label: 113 pred_label: 113 pred_clean_logit 0.9981268048286438
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:04,  4.06it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01,  9.04it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 11.72it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 13.17it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 13.64it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 12.59it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 15.12it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 16.12it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.17it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.10it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.56s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.62s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.63s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.87s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.77s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2390
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -1.339 ent: -2.829 str: 0.000 loss: -4.168]Iterations:   3%|▎         | 1/30 [00:01<00:56,  1.93s/it, atk: -1.339 ent: -2.829 str: 0.000 loss: -4.168]Iterations:   3%|▎         | 1/30 [00:02<00:56,  1.93s/it, atk: -8.367 ent: -2.827 str: 0.000 loss: -11.194]Iterations:   7%|▋         | 2/30 [00:02<00:37,  1.34s/it, atk: -8.367 ent: -2.827 str: 0.000 loss: -11.194]Iterations:   7%|▋         | 2/30 [00:03<00:37,  1.34s/it, atk: -20.538 ent: -2.815 str: 0.000 loss: -23.354]Iterations:  10%|█         | 3/30 [00:03<00:28,  1.05s/it, atk: -20.538 ent: -2.815 str: 0.000 loss: -23.354]Iterations:  10%|█         | 3/30 [00:04<00:28,  1.05s/it, atk: -42.416 ent: -2.804 str: 0.000 loss: -45.220]Iterations:  13%|█▎        | 4/30 [00:04<00:27,  1.06s/it, atk: -42.416 ent: -2.804 str: 0.000 loss: -45.220]Iterations:  13%|█▎        | 4/30 [00:04<00:27,  1.06s/it, atk: -55.255 ent: -2.800 str: 0.000 loss: -58.055]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -55.255 ent: -2.800 str: 0.000 loss: -58.055]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -72.581 ent: -2.803 str: 0.000 loss: -75.384]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.22it/s, atk: -72.581 ent: -2.803 str: 0.000 loss: -75.384]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.22it/s, atk: -77.381 ent: -2.804 str: 0.000 loss: -80.185]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -77.381 ent: -2.804 str: 0.000 loss: -80.185]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.28it/s, atk: -86.766 ent: -2.805 str: 0.000 loss: -89.571]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -86.766 ent: -2.805 str: 0.000 loss: -89.571]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.32it/s, atk: -96.335 ent: -2.805 str: 0.000 loss: -99.139]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.41it/s, atk: -96.335 ent: -2.805 str: 0.000 loss: -99.139]Iterations:  30%|███       | 9/30 [00:08<00:14,  1.41it/s, atk: -103.536 ent: -2.807 str: 0.000 loss: -106.344]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.41it/s, atk: -103.536 ent: -2.807 str: 0.000 loss: -106.344]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.41it/s, atk: -108.733 ent: -2.802 str: 0.000 loss: -111.534]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -108.733 ent: -2.802 str: 0.000 loss: -111.534]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -97.271 ent: -2.790 str: 0.000 loss: -100.061] Iterations:  40%|████      | 12/30 [00:09<00:12,  1.48it/s, atk: -97.271 ent: -2.790 str: 0.000 loss: -100.061]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.48it/s, atk: -109.875 ent: -2.788 str: 0.000 loss: -112.663]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.51it/s, atk: -109.875 ent: -2.788 str: 0.000 loss: -112.663]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.51it/s, atk: -119.088 ent: -2.784 str: 0.000 loss: -121.872]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -119.088 ent: -2.784 str: 0.000 loss: -121.872]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -124.800 ent: -2.783 str: 0.000 loss: -127.583]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -124.800 ent: -2.783 str: 0.000 loss: -127.583]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.41it/s, atk: -132.136 ent: -2.784 str: 0.000 loss: -134.919]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.49it/s, atk: -132.136 ent: -2.784 str: 0.000 loss: -134.919]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.49it/s, atk: -140.840 ent: -2.784 str: 0.000 loss: -143.624]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.52it/s, atk: -140.840 ent: -2.784 str: 0.000 loss: -143.624]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.52it/s, atk: -146.439 ent: -2.788 str: 0.000 loss: -149.227]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.47it/s, atk: -146.439 ent: -2.788 str: 0.000 loss: -149.227]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.47it/s, atk: -150.620 ent: -2.789 str: 0.000 loss: -153.409]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.28it/s, atk: -150.620 ent: -2.789 str: 0.000 loss: -153.409]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.28it/s, atk: -155.151 ent: -2.791 str: 0.000 loss: -157.942]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.17it/s, atk: -155.151 ent: -2.791 str: 0.000 loss: -157.942]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.17it/s, atk: -161.255 ent: -2.792 str: 0.000 loss: -164.047]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.14it/s, atk: -161.255 ent: -2.792 str: 0.000 loss: -164.047]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.14it/s, atk: -166.312 ent: -2.794 str: 0.000 loss: -169.106]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.19it/s, atk: -166.312 ent: -2.794 str: 0.000 loss: -169.106]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.19it/s, atk: -170.271 ent: -2.794 str: 0.000 loss: -173.065]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.31it/s, atk: -170.271 ent: -2.794 str: 0.000 loss: -173.065]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.31it/s, atk: -174.411 ent: -2.794 str: 0.000 loss: -177.204]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -174.411 ent: -2.794 str: 0.000 loss: -177.204]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -175.881 ent: -2.793 str: 0.000 loss: -178.674]Iterations:  83%|████████▎ | 25/30 [00:20<00:04,  1.21it/s, atk: -175.881 ent: -2.793 str: 0.000 loss: -178.674]Iterations:  83%|████████▎ | 25/30 [00:20<00:04,  1.21it/s, atk: -183.154 ent: -2.794 str: 0.000 loss: -185.948]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.27it/s, atk: -183.154 ent: -2.794 str: 0.000 loss: -185.948]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.27it/s, atk: -187.833 ent: -2.795 str: 0.000 loss: -190.628]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.32it/s, atk: -187.833 ent: -2.795 str: 0.000 loss: -190.628]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.32it/s, atk: -192.171 ent: -2.794 str: 0.000 loss: -194.965]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.32it/s, atk: -192.171 ent: -2.794 str: 0.000 loss: -194.965]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.32it/s, atk: -196.384 ent: -2.793 str: 0.000 loss: -199.176]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -196.384 ent: -2.793 str: 0.000 loss: -199.176]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -198.750 ent: -2.791 str: 0.000 loss: -201.542]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.19it/s, atk: -198.750 ent: -2.791 str: 0.000 loss: -201.542]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.25it/s, atk: -198.750 ent: -2.791 str: 0.000 loss: -201.542]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([988], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([113], device='cuda:0') tensor(1.5954e-09, device='cuda:0')
L1: [3703.3887]	L2: [23.164225]	Linf: [0.6]

Accuracy on benign examples: 100.0%
gt_label: 873 pred_label: 873 pred_clean_logit 0.8567291498184204
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.56it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 15.54it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.74it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.62it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.51it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 16.25it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 14.29it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.42it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.44it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.68s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.58s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.67s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5068
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -2.508 ent: -10.080 str: 0.000 loss: -12.588]Iterations:   3%|▎         | 1/30 [00:02<01:17,  2.69s/it, atk: -2.508 ent: -10.080 str: 0.000 loss: -12.588]Iterations:   3%|▎         | 1/30 [00:03<01:17,  2.69s/it, atk: -20.818 ent: -10.009 str: 0.000 loss: -30.828]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.50s/it, atk: -20.818 ent: -10.009 str: 0.000 loss: -30.828]Iterations:   7%|▋         | 2/30 [00:03<00:41,  1.50s/it, atk: -29.381 ent: -10.065 str: 0.000 loss: -39.446]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -29.381 ent: -10.065 str: 0.000 loss: -39.446]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.19s/it, atk: -43.859 ent: -10.084 str: 0.000 loss: -53.942]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.02s/it, atk: -43.859 ent: -10.084 str: 0.000 loss: -53.942]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.02s/it, atk: -55.124 ent: -10.078 str: 0.000 loss: -65.203]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -55.124 ent: -10.078 str: 0.000 loss: -65.203]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -62.853 ent: -10.077 str: 0.000 loss: -72.930]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.16it/s, atk: -62.853 ent: -10.077 str: 0.000 loss: -72.930]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.16it/s, atk: -71.947 ent: -10.077 str: 0.000 loss: -82.024]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -71.947 ent: -10.077 str: 0.000 loss: -82.024]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.26it/s, atk: -77.674 ent: -10.076 str: 0.000 loss: -87.751]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -77.674 ent: -10.076 str: 0.000 loss: -87.751]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.28it/s, atk: -82.873 ent: -10.077 str: 0.000 loss: -92.950]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.28it/s, atk: -82.873 ent: -10.077 str: 0.000 loss: -92.950]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.28it/s, atk: -85.102 ent: -10.076 str: 0.000 loss: -95.178]Iterations:  33%|███▎      | 10/30 [00:09<00:16,  1.19it/s, atk: -85.102 ent: -10.076 str: 0.000 loss: -95.178]Iterations:  33%|███▎      | 10/30 [00:10<00:16,  1.19it/s, atk: -90.812 ent: -10.077 str: 0.000 loss: -100.889]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.21it/s, atk: -90.812 ent: -10.077 str: 0.000 loss: -100.889]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.21it/s, atk: -94.213 ent: -10.076 str: 0.000 loss: -104.289]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.30it/s, atk: -94.213 ent: -10.076 str: 0.000 loss: -104.289]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.30it/s, atk: -96.612 ent: -10.074 str: 0.000 loss: -106.686]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -96.612 ent: -10.074 str: 0.000 loss: -106.686]Iterations:  43%|████▎     | 13/30 [00:12<00:12,  1.37it/s, atk: -100.653 ent: -10.072 str: 0.000 loss: -110.725]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -100.653 ent: -10.072 str: 0.000 loss: -110.725]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -104.018 ent: -10.070 str: 0.000 loss: -114.088]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.37it/s, atk: -104.018 ent: -10.070 str: 0.000 loss: -114.088]Iterations:  50%|█████     | 15/30 [00:13<00:10,  1.37it/s, atk: -107.889 ent: -10.069 str: 0.000 loss: -117.958]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.45it/s, atk: -107.889 ent: -10.069 str: 0.000 loss: -117.958]Iterations:  53%|█████▎    | 16/30 [00:14<00:09,  1.45it/s, atk: -110.799 ent: -10.069 str: 0.000 loss: -120.868]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.50it/s, atk: -110.799 ent: -10.069 str: 0.000 loss: -120.868]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.50it/s, atk: -112.545 ent: -10.071 str: 0.000 loss: -122.615]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.49it/s, atk: -112.545 ent: -10.071 str: 0.000 loss: -122.615]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.49it/s, atk: -115.062 ent: -10.073 str: 0.000 loss: -125.134]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.34it/s, atk: -115.062 ent: -10.073 str: 0.000 loss: -125.134]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.34it/s, atk: -117.685 ent: -10.074 str: 0.000 loss: -127.759]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.36it/s, atk: -117.685 ent: -10.074 str: 0.000 loss: -127.759]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.36it/s, atk: -119.672 ent: -10.075 str: 0.000 loss: -129.747]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.46it/s, atk: -119.672 ent: -10.075 str: 0.000 loss: -129.747]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.46it/s, atk: -121.618 ent: -10.077 str: 0.000 loss: -131.695]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.42it/s, atk: -121.618 ent: -10.077 str: 0.000 loss: -131.695]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.42it/s, atk: -123.419 ent: -10.079 str: 0.000 loss: -133.498]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -123.419 ent: -10.079 str: 0.000 loss: -133.498]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.32it/s, atk: -125.069 ent: -10.079 str: 0.000 loss: -135.148]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.38it/s, atk: -125.069 ent: -10.079 str: 0.000 loss: -135.148]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.38it/s, atk: -126.877 ent: -10.080 str: 0.000 loss: -136.958]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.44it/s, atk: -126.877 ent: -10.080 str: 0.000 loss: -136.958]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.44it/s, atk: -128.564 ent: -10.079 str: 0.000 loss: -138.643]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.41it/s, atk: -128.564 ent: -10.079 str: 0.000 loss: -138.643]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.41it/s, atk: -130.296 ent: -10.079 str: 0.000 loss: -140.375]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.45it/s, atk: -130.296 ent: -10.079 str: 0.000 loss: -140.375]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.45it/s, atk: -132.119 ent: -10.079 str: 0.000 loss: -142.199]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -132.119 ent: -10.079 str: 0.000 loss: -142.199]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -134.558 ent: -10.079 str: 0.000 loss: -144.637]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.43it/s, atk: -134.558 ent: -10.079 str: 0.000 loss: -144.637]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.43it/s, atk: -136.476 ent: -10.080 str: 0.000 loss: -146.556]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.47it/s, atk: -136.476 ent: -10.080 str: 0.000 loss: -146.556]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.27it/s, atk: -136.476 ent: -10.080 str: 0.000 loss: -146.556]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([698], device='cuda:0') tensor(0.9942, device='cuda:0')
after_true: tensor([873], device='cuda:0') tensor(9.7145e-07, device='cuda:0')
L1: [2490.3647]	L2: [17.255157]	Linf: [0.80784315]

Accuracy on benign examples: 100.0%
gt_label: 429 pred_label: 429 pred_clean_logit 0.9999029636383057
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.63it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.79it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 16.37it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.04it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 17.81it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 19.18it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.17it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:00<00:00, 20.61it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.66it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.81s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.47s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.55s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.66s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3311
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.003 ent: -3.234 str: 0.000 loss: -3.237]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -0.003 ent: -3.234 str: 0.000 loss: -3.237]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -0.002 ent: -3.266 str: 0.000 loss: -3.268]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.44s/it, atk: -0.002 ent: -3.266 str: 0.000 loss: -3.268]Iterations:   7%|▋         | 2/30 [00:03<00:40,  1.44s/it, atk: -0.002 ent: -3.300 str: 0.000 loss: -3.302]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.12s/it, atk: -0.002 ent: -3.300 str: 0.000 loss: -3.302]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -0.003 ent: -3.325 str: 0.000 loss: -3.328]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -0.003 ent: -3.325 str: 0.000 loss: -3.328]Iterations:  13%|█▎        | 4/30 [00:04<00:23,  1.09it/s, atk: -0.003 ent: -3.348 str: 0.000 loss: -3.351]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.21it/s, atk: -0.003 ent: -3.348 str: 0.000 loss: -3.351]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.21it/s, atk: -0.004 ent: -3.367 str: 0.000 loss: -3.371]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -0.004 ent: -3.367 str: 0.000 loss: -3.371]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.31it/s, atk: -0.004 ent: -3.385 str: 0.000 loss: -3.389]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -0.004 ent: -3.385 str: 0.000 loss: -3.389]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.29it/s, atk: -0.004 ent: -3.402 str: 0.000 loss: -3.407]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -0.004 ent: -3.402 str: 0.000 loss: -3.407]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -0.005 ent: -3.419 str: 0.000 loss: -3.424]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.26it/s, atk: -0.005 ent: -3.419 str: 0.000 loss: -3.424]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.26it/s, atk: -0.005 ent: -3.436 str: 0.000 loss: -3.441]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.32it/s, atk: -0.005 ent: -3.436 str: 0.000 loss: -3.441]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.32it/s, atk: -0.006 ent: -3.450 str: 0.000 loss: -3.456]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.34it/s, atk: -0.006 ent: -3.450 str: 0.000 loss: -3.456]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.34it/s, atk: -0.006 ent: -3.465 str: 0.000 loss: -3.471]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -0.006 ent: -3.465 str: 0.000 loss: -3.471]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.42it/s, atk: -0.007 ent: -3.480 str: 0.000 loss: -3.487]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.42it/s, atk: -0.007 ent: -3.480 str: 0.000 loss: -3.487]Iterations:  43%|████▎     | 13/30 [00:11<00:11,  1.42it/s, atk: -0.008 ent: -3.492 str: 0.000 loss: -3.500]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -0.008 ent: -3.492 str: 0.000 loss: -3.500]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.44it/s, atk: -0.009 ent: -3.504 str: 0.000 loss: -3.512]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.27it/s, atk: -0.009 ent: -3.504 str: 0.000 loss: -3.512]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.27it/s, atk: -0.009 ent: -3.514 str: 0.000 loss: -3.523]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.24it/s, atk: -0.009 ent: -3.514 str: 0.000 loss: -3.523]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.24it/s, atk: -0.010 ent: -3.524 str: 0.000 loss: -3.534]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.23it/s, atk: -0.010 ent: -3.524 str: 0.000 loss: -3.534]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.23it/s, atk: -0.010 ent: -3.534 str: 0.000 loss: -3.544]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.24it/s, atk: -0.010 ent: -3.534 str: 0.000 loss: -3.544]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.24it/s, atk: -0.011 ent: -3.543 str: 0.000 loss: -3.554]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.26it/s, atk: -0.011 ent: -3.543 str: 0.000 loss: -3.554]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.26it/s, atk: -0.012 ent: -3.551 str: 0.000 loss: -3.563]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.35it/s, atk: -0.012 ent: -3.551 str: 0.000 loss: -3.563]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.35it/s, atk: -0.011 ent: -3.561 str: 0.000 loss: -3.572]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -0.011 ent: -3.561 str: 0.000 loss: -3.572]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.41it/s, atk: -0.012 ent: -3.570 str: 0.000 loss: -3.582]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -0.012 ent: -3.570 str: 0.000 loss: -3.582]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.46it/s, atk: -0.014 ent: -3.578 str: 0.000 loss: -3.592]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -0.014 ent: -3.578 str: 0.000 loss: -3.592]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.42it/s, atk: -0.016 ent: -3.585 str: 0.000 loss: -3.601]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -0.016 ent: -3.585 str: 0.000 loss: -3.601]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.39it/s, atk: -0.019 ent: -3.592 str: 0.000 loss: -3.611]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.26it/s, atk: -0.019 ent: -3.592 str: 0.000 loss: -3.611]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.26it/s, atk: -0.021 ent: -3.599 str: 0.000 loss: -3.620]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.31it/s, atk: -0.021 ent: -3.599 str: 0.000 loss: -3.620]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.31it/s, atk: -0.025 ent: -3.605 str: 0.000 loss: -3.630]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.30it/s, atk: -0.025 ent: -3.605 str: 0.000 loss: -3.630]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.30it/s, atk: -0.029 ent: -3.609 str: 0.000 loss: -3.638]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.28it/s, atk: -0.029 ent: -3.609 str: 0.000 loss: -3.638]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.28it/s, atk: -0.038 ent: -3.613 str: 0.000 loss: -3.652]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.32it/s, atk: -0.038 ent: -3.613 str: 0.000 loss: -3.652]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.32it/s, atk: -0.049 ent: -3.617 str: 0.000 loss: -3.666]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.37it/s, atk: -0.049 ent: -3.617 str: 0.000 loss: -3.666]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -0.049 ent: -3.617 str: 0.000 loss: -3.666]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 100.0%
after_pred: tensor([429], device='cuda:0') tensor(0.9938, device='cuda:0')
after_true: tensor([429], device='cuda:0') tensor(0.9938, device='cuda:0')
L1: [3016.2976]	L2: [24.84731]	Linf: [0.9843137]

Accuracy on benign examples: 100.0%
gt_label: 970 pred_label: 970 pred_clean_logit 0.9500624537467957
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.01it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 10.39it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 13.17it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 14.25it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 15.49it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 17.96it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 19.51it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 19.66it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.85it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.31s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.54s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.53s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.61s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.65s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3391
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:00<?, ?it/s, atk: -0.121 ent: -2.519 str: 0.000 loss: -2.640]Iterations:   3%|▎         | 1/30 [00:00<00:21,  1.37it/s, atk: -0.121 ent: -2.519 str: 0.000 loss: -2.640]Iterations:   3%|▎         | 1/30 [00:01<00:21,  1.37it/s, atk: -0.383 ent: -2.521 str: 0.000 loss: -2.904]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.51it/s, atk: -0.383 ent: -2.521 str: 0.000 loss: -2.904]Iterations:   7%|▋         | 2/30 [00:01<00:18,  1.51it/s, atk: -1.007 ent: -2.520 str: 0.000 loss: -3.527]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.46it/s, atk: -1.007 ent: -2.520 str: 0.000 loss: -3.527]Iterations:  10%|█         | 3/30 [00:02<00:18,  1.46it/s, atk: -2.220 ent: -2.516 str: 0.000 loss: -4.736]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.22it/s, atk: -2.220 ent: -2.516 str: 0.000 loss: -4.736]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.22it/s, atk: -4.691 ent: -2.512 str: 0.000 loss: -7.203]Iterations:  17%|█▋        | 5/30 [00:03<00:19,  1.27it/s, atk: -4.691 ent: -2.512 str: 0.000 loss: -7.203]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.27it/s, atk: -3.848 ent: -2.503 str: 0.000 loss: -6.351]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.28it/s, atk: -3.848 ent: -2.503 str: 0.000 loss: -6.351]Iterations:  20%|██        | 6/30 [00:04<00:18,  1.28it/s, atk: -5.511 ent: -2.505 str: 0.000 loss: -8.016]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.34it/s, atk: -5.511 ent: -2.505 str: 0.000 loss: -8.016]Iterations:  23%|██▎       | 7/30 [00:05<00:17,  1.34it/s, atk: -7.229 ent: -2.507 str: 0.000 loss: -9.736]Iterations:  27%|██▋       | 8/30 [00:05<00:16,  1.36it/s, atk: -7.229 ent: -2.507 str: 0.000 loss: -9.736]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -10.191 ent: -2.508 str: 0.000 loss: -12.699]Iterations:  30%|███       | 9/30 [00:06<00:15,  1.40it/s, atk: -10.191 ent: -2.508 str: 0.000 loss: -12.699]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.40it/s, atk: -13.817 ent: -2.510 str: 0.000 loss: -16.326]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.43it/s, atk: -13.817 ent: -2.510 str: 0.000 loss: -16.326]Iterations:  33%|███▎      | 10/30 [00:07<00:13,  1.43it/s, atk: -15.771 ent: -2.509 str: 0.000 loss: -18.280]Iterations:  37%|███▋      | 11/30 [00:07<00:12,  1.48it/s, atk: -15.771 ent: -2.509 str: 0.000 loss: -18.280]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.48it/s, atk: -18.634 ent: -2.510 str: 0.000 loss: -21.144]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.48it/s, atk: -18.634 ent: -2.510 str: 0.000 loss: -21.144]Iterations:  40%|████      | 12/30 [00:08<00:12,  1.48it/s, atk: -26.599 ent: -2.510 str: 0.000 loss: -29.109]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.43it/s, atk: -26.599 ent: -2.510 str: 0.000 loss: -29.109]Iterations:  43%|████▎     | 13/30 [00:09<00:11,  1.43it/s, atk: -32.360 ent: -2.509 str: 0.000 loss: -34.870]Iterations:  47%|████▋     | 14/30 [00:09<00:10,  1.49it/s, atk: -32.360 ent: -2.509 str: 0.000 loss: -34.870]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.49it/s, atk: -38.597 ent: -2.509 str: 0.000 loss: -41.106]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.53it/s, atk: -38.597 ent: -2.509 str: 0.000 loss: -41.106]Iterations:  50%|█████     | 15/30 [00:10<00:09,  1.53it/s, atk: -47.497 ent: -2.510 str: 0.000 loss: -50.007]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.53it/s, atk: -47.497 ent: -2.510 str: 0.000 loss: -50.007]Iterations:  53%|█████▎    | 16/30 [00:11<00:09,  1.53it/s, atk: -52.257 ent: -2.510 str: 0.000 loss: -54.767]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.38it/s, atk: -52.257 ent: -2.510 str: 0.000 loss: -54.767]Iterations:  57%|█████▋    | 17/30 [00:12<00:09,  1.38it/s, atk: -61.376 ent: -2.510 str: 0.000 loss: -63.885]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.29it/s, atk: -61.376 ent: -2.510 str: 0.000 loss: -63.885]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.29it/s, atk: -67.029 ent: -2.510 str: 0.000 loss: -69.539]Iterations:  63%|██████▎   | 19/30 [00:13<00:08,  1.33it/s, atk: -67.029 ent: -2.510 str: 0.000 loss: -69.539]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.33it/s, atk: -75.883 ent: -2.510 str: 0.000 loss: -78.392]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.31it/s, atk: -75.883 ent: -2.510 str: 0.000 loss: -78.392]Iterations:  67%|██████▋   | 20/30 [00:14<00:07,  1.31it/s, atk: -82.712 ent: -2.510 str: 0.000 loss: -85.222]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.37it/s, atk: -82.712 ent: -2.510 str: 0.000 loss: -85.222]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.37it/s, atk: -89.320 ent: -2.510 str: 0.000 loss: -91.830]Iterations:  73%|███████▎  | 22/30 [00:15<00:05,  1.42it/s, atk: -89.320 ent: -2.510 str: 0.000 loss: -91.830]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.42it/s, atk: -95.200 ent: -2.509 str: 0.000 loss: -97.709]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -95.200 ent: -2.509 str: 0.000 loss: -97.709]Iterations:  77%|███████▋  | 23/30 [00:16<00:04,  1.45it/s, atk: -102.336 ent: -2.508 str: 0.000 loss: -104.844]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -102.336 ent: -2.508 str: 0.000 loss: -104.844]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.41it/s, atk: -108.455 ent: -2.507 str: 0.000 loss: -110.963]Iterations:  83%|████████▎ | 25/30 [00:17<00:03,  1.46it/s, atk: -108.455 ent: -2.507 str: 0.000 loss: -110.963]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.46it/s, atk: -115.070 ent: -2.507 str: 0.000 loss: -117.577]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -115.070 ent: -2.507 str: 0.000 loss: -117.577]Iterations:  87%|████████▋ | 26/30 [00:18<00:02,  1.46it/s, atk: -119.452 ent: -2.508 str: 0.000 loss: -121.960]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.39it/s, atk: -119.452 ent: -2.508 str: 0.000 loss: -121.960]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.39it/s, atk: -126.392 ent: -2.507 str: 0.000 loss: -128.899]Iterations:  93%|█████████▎| 28/30 [00:19<00:01,  1.47it/s, atk: -126.392 ent: -2.507 str: 0.000 loss: -128.899]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.47it/s, atk: -131.570 ent: -2.506 str: 0.000 loss: -134.077]Iterations:  97%|█████████▋| 29/30 [00:20<00:00,  1.42it/s, atk: -131.570 ent: -2.506 str: 0.000 loss: -134.077]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.42it/s, atk: -136.224 ent: -2.507 str: 0.000 loss: -138.730]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.32it/s, atk: -136.224 ent: -2.507 str: 0.000 loss: -138.730]Iterations: 100%|██████████| 30/30 [00:21<00:00,  1.39it/s, atk: -136.224 ent: -2.507 str: 0.000 loss: -138.730]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([349], device='cuda:0') tensor(0.6314, device='cuda:0')
after_true: tensor([970], device='cuda:0') tensor(6.9422e-07, device='cuda:0')
L1: [2223.5571]	L2: [14.931559]	Linf: [0.63529414]

Accuracy on benign examples: 100.0%
gt_label: 967 pred_label: 967 pred_clean_logit 0.7007756233215332
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:06,  2.88it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:04,  3.50it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:03,  4.07it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:02,  6.80it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:01<00:01, 10.89it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:01<00:00, 12.38it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:01<00:00, 12.19it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 13.72it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 13.41it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 14.47it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 10.61it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.77s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.56s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.66s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.64s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.89s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.78s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3917
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -2.779 ent: -2.729 str: 0.000 loss: -5.508]Iterations:   3%|▎         | 1/30 [00:02<01:13,  2.53s/it, atk: -2.779 ent: -2.729 str: 0.000 loss: -5.508]Iterations:   3%|▎         | 1/30 [00:03<01:13,  2.53s/it, atk: -8.514 ent: -2.708 str: 0.000 loss: -11.222]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.66s/it, atk: -8.514 ent: -2.708 str: 0.000 loss: -11.222]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.66s/it, atk: -14.549 ent: -2.715 str: 0.000 loss: -17.264]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.20s/it, atk: -14.549 ent: -2.715 str: 0.000 loss: -17.264]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.20s/it, atk: -21.298 ent: -2.717 str: 0.000 loss: -24.015]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.01it/s, atk: -21.298 ent: -2.717 str: 0.000 loss: -24.015]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.01it/s, atk: -25.844 ent: -2.719 str: 0.000 loss: -28.563]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -25.844 ent: -2.719 str: 0.000 loss: -28.563]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -32.187 ent: -2.715 str: 0.000 loss: -34.902]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.23it/s, atk: -32.187 ent: -2.715 str: 0.000 loss: -34.902]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.23it/s, atk: -37.348 ent: -2.710 str: 0.000 loss: -40.058]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.28it/s, atk: -37.348 ent: -2.710 str: 0.000 loss: -40.058]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.28it/s, atk: -42.107 ent: -2.706 str: 0.000 loss: -44.813]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.31it/s, atk: -42.107 ent: -2.706 str: 0.000 loss: -44.813]Iterations:  27%|██▋       | 8/30 [00:08<00:16,  1.31it/s, atk: -47.141 ent: -2.705 str: 0.000 loss: -49.846]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -47.141 ent: -2.705 str: 0.000 loss: -49.846]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.37it/s, atk: -50.704 ent: -2.705 str: 0.000 loss: -53.409]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.41it/s, atk: -50.704 ent: -2.705 str: 0.000 loss: -53.409]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.41it/s, atk: -54.351 ent: -2.704 str: 0.000 loss: -57.055]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.47it/s, atk: -54.351 ent: -2.704 str: 0.000 loss: -57.055]Iterations:  37%|███▋      | 11/30 [00:10<00:12,  1.47it/s, atk: -59.376 ent: -2.701 str: 0.000 loss: -62.077]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.47it/s, atk: -59.376 ent: -2.701 str: 0.000 loss: -62.077]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.47it/s, atk: -64.740 ent: -2.700 str: 0.000 loss: -67.440]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.24it/s, atk: -64.740 ent: -2.700 str: 0.000 loss: -67.440]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.24it/s, atk: -62.152 ent: -2.702 str: 0.000 loss: -64.853]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.31it/s, atk: -62.152 ent: -2.702 str: 0.000 loss: -64.853]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.31it/s, atk: -73.988 ent: -2.700 str: 0.000 loss: -76.689]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.29it/s, atk: -73.988 ent: -2.700 str: 0.000 loss: -76.689]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.29it/s, atk: -79.132 ent: -2.701 str: 0.000 loss: -81.833]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.31it/s, atk: -79.132 ent: -2.701 str: 0.000 loss: -81.833]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.31it/s, atk: -85.584 ent: -2.702 str: 0.000 loss: -88.285]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.35it/s, atk: -85.584 ent: -2.702 str: 0.000 loss: -88.285]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.35it/s, atk: -92.270 ent: -2.703 str: 0.000 loss: -94.973]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.42it/s, atk: -92.270 ent: -2.703 str: 0.000 loss: -94.973]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.42it/s, atk: -99.428 ent: -2.703 str: 0.000 loss: -102.132]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.36it/s, atk: -99.428 ent: -2.703 str: 0.000 loss: -102.132]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.36it/s, atk: -107.208 ent: -2.703 str: 0.000 loss: -109.911]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.42it/s, atk: -107.208 ent: -2.703 str: 0.000 loss: -109.911]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.42it/s, atk: -114.759 ent: -2.703 str: 0.000 loss: -117.462]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.45it/s, atk: -114.759 ent: -2.703 str: 0.000 loss: -117.462]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.45it/s, atk: -123.406 ent: -2.701 str: 0.000 loss: -126.107]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.38it/s, atk: -123.406 ent: -2.701 str: 0.000 loss: -126.107]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.38it/s, atk: -131.405 ent: -2.699 str: 0.000 loss: -134.105]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.22it/s, atk: -131.405 ent: -2.699 str: 0.000 loss: -134.105]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.22it/s, atk: -139.898 ent: -2.699 str: 0.000 loss: -142.597]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.28it/s, atk: -139.898 ent: -2.699 str: 0.000 loss: -142.597]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.28it/s, atk: -148.013 ent: -2.701 str: 0.000 loss: -150.714]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.32it/s, atk: -148.013 ent: -2.701 str: 0.000 loss: -150.714]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.32it/s, atk: -157.127 ent: -2.701 str: 0.000 loss: -159.828]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.36it/s, atk: -157.127 ent: -2.701 str: 0.000 loss: -159.828]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.36it/s, atk: -166.558 ent: -2.701 str: 0.000 loss: -169.260]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -166.558 ent: -2.701 str: 0.000 loss: -169.260]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.36it/s, atk: -174.830 ent: -2.700 str: 0.000 loss: -177.530]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -174.830 ent: -2.700 str: 0.000 loss: -177.530]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.39it/s, atk: -182.442 ent: -2.700 str: 0.000 loss: -185.141]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.38it/s, atk: -182.442 ent: -2.700 str: 0.000 loss: -185.141]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.38it/s, atk: -190.049 ent: -2.698 str: 0.000 loss: -192.748]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.38it/s, atk: -190.049 ent: -2.698 str: 0.000 loss: -192.748]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -190.049 ent: -2.698 str: 0.000 loss: -192.748]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([691], device='cuda:0') tensor(0.9934, device='cuda:0')
after_true: tensor([967], device='cuda:0') tensor(2.1759e-09, device='cuda:0')
L1: [2911.9763]	L2: [18.390818]	Linf: [0.5490196]

Accuracy on benign examples: 100.0%
gt_label: 976 pred_label: 976 pred_clean_logit 0.9334723353385925
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.31it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 17.73it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 15.63it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 14.33it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 16.69it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 17.04it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 16.08it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.80it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.04it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.22s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.51s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.57s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.64s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5188
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.482 ent: -7.402 str: 0.000 loss: -7.883]Iterations:   3%|▎         | 1/30 [00:01<00:46,  1.62s/it, atk: -0.482 ent: -7.402 str: 0.000 loss: -7.883]Iterations:   3%|▎         | 1/30 [00:02<00:46,  1.62s/it, atk: -0.526 ent: -7.382 str: 0.000 loss: -7.908]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.22s/it, atk: -0.526 ent: -7.382 str: 0.000 loss: -7.908]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.22s/it, atk: -0.641 ent: -7.386 str: 0.000 loss: -8.027]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -0.641 ent: -7.386 str: 0.000 loss: -8.027]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -0.791 ent: -7.386 str: 0.000 loss: -8.177]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.19it/s, atk: -0.791 ent: -7.386 str: 0.000 loss: -8.177]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.19it/s, atk: -1.010 ent: -7.389 str: 0.000 loss: -8.400]Iterations:  17%|█▋        | 5/30 [00:04<00:19,  1.26it/s, atk: -1.010 ent: -7.389 str: 0.000 loss: -8.400]Iterations:  17%|█▋        | 5/30 [00:05<00:19,  1.26it/s, atk: -1.246 ent: -7.389 str: 0.000 loss: -8.634]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -1.246 ent: -7.389 str: 0.000 loss: -8.634]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -1.538 ent: -7.385 str: 0.000 loss: -8.923]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -1.538 ent: -7.385 str: 0.000 loss: -8.923]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.32it/s, atk: -1.923 ent: -7.382 str: 0.000 loss: -9.304]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.36it/s, atk: -1.923 ent: -7.382 str: 0.000 loss: -9.304]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -2.434 ent: -7.376 str: 0.000 loss: -9.809]Iterations:  30%|███       | 9/30 [00:07<00:16,  1.24it/s, atk: -2.434 ent: -7.376 str: 0.000 loss: -9.809]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.24it/s, atk: -2.857 ent: -7.370 str: 0.000 loss: -10.228]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.30it/s, atk: -2.857 ent: -7.370 str: 0.000 loss: -10.228]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.30it/s, atk: -3.629 ent: -7.372 str: 0.000 loss: -11.000]Iterations:  37%|███▋      | 11/30 [00:09<00:16,  1.18it/s, atk: -3.629 ent: -7.372 str: 0.000 loss: -11.000]Iterations:  37%|███▋      | 11/30 [00:09<00:16,  1.18it/s, atk: -4.447 ent: -7.373 str: 0.000 loss: -11.820]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.26it/s, atk: -4.447 ent: -7.373 str: 0.000 loss: -11.820]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.26it/s, atk: -5.213 ent: -7.374 str: 0.000 loss: -12.587]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.31it/s, atk: -5.213 ent: -7.374 str: 0.000 loss: -12.587]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.31it/s, atk: -6.082 ent: -7.378 str: 0.000 loss: -13.460]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.28it/s, atk: -6.082 ent: -7.378 str: 0.000 loss: -13.460]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.28it/s, atk: -6.648 ent: -7.377 str: 0.000 loss: -14.025]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.33it/s, atk: -6.648 ent: -7.377 str: 0.000 loss: -14.025]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.33it/s, atk: -7.504 ent: -7.379 str: 0.000 loss: -14.883]Iterations:  53%|█████▎    | 16/30 [00:12<00:10,  1.38it/s, atk: -7.504 ent: -7.379 str: 0.000 loss: -14.883]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -8.660 ent: -7.374 str: 0.000 loss: -16.034]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.34it/s, atk: -8.660 ent: -7.374 str: 0.000 loss: -16.034]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.34it/s, atk: -9.670 ent: -7.368 str: 0.000 loss: -17.037]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -9.670 ent: -7.368 str: 0.000 loss: -17.037]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -11.088 ent: -7.371 str: 0.000 loss: -18.458]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.28it/s, atk: -11.088 ent: -7.371 str: 0.000 loss: -18.458]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.28it/s, atk: -12.040 ent: -7.373 str: 0.000 loss: -19.413]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.19it/s, atk: -12.040 ent: -7.373 str: 0.000 loss: -19.413]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.19it/s, atk: -13.168 ent: -7.371 str: 0.000 loss: -20.539]Iterations:  70%|███████   | 21/30 [00:16<00:07,  1.27it/s, atk: -13.168 ent: -7.371 str: 0.000 loss: -20.539]Iterations:  70%|███████   | 21/30 [00:17<00:07,  1.27it/s, atk: -14.520 ent: -7.371 str: 0.000 loss: -21.891]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.32it/s, atk: -14.520 ent: -7.371 str: 0.000 loss: -21.891]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.32it/s, atk: -16.226 ent: -7.369 str: 0.000 loss: -23.595]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -16.226 ent: -7.369 str: 0.000 loss: -23.595]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.32it/s, atk: -17.783 ent: -7.363 str: 0.000 loss: -25.146]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.37it/s, atk: -17.783 ent: -7.363 str: 0.000 loss: -25.146]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.37it/s, atk: -18.758 ent: -7.365 str: 0.000 loss: -26.123]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.42it/s, atk: -18.758 ent: -7.365 str: 0.000 loss: -26.123]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.42it/s, atk: -19.716 ent: -7.361 str: 0.000 loss: -27.077]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -19.716 ent: -7.361 str: 0.000 loss: -27.077]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.38it/s, atk: -22.104 ent: -7.360 str: 0.000 loss: -29.464]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.43it/s, atk: -22.104 ent: -7.360 str: 0.000 loss: -29.464]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.43it/s, atk: -23.167 ent: -7.359 str: 0.000 loss: -30.526]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.37it/s, atk: -23.167 ent: -7.359 str: 0.000 loss: -30.526]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.37it/s, atk: -25.127 ent: -7.364 str: 0.000 loss: -32.490]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.29it/s, atk: -25.127 ent: -7.364 str: 0.000 loss: -32.490]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.29it/s, atk: -27.823 ent: -7.361 str: 0.000 loss: -35.183]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.22it/s, atk: -27.823 ent: -7.361 str: 0.000 loss: -35.183]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -27.823 ent: -7.361 str: 0.000 loss: -35.183]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([460], device='cuda:0') tensor(0.5557, device='cuda:0')
after_true: tensor([976], device='cuda:0') tensor(0.0430, device='cuda:0')
L1: [2295.5452]	L2: [16.260479]	Linf: [0.7254902]

Accuracy on benign examples: 100.0%
gt_label: 603 pred_label: 603 pred_clean_logit 0.9902576208114624
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  7.22it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:02,  8.02it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01,  9.90it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 14.05it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 15.49it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.73it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 14.15it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 13.64it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 14.72it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.09it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.50it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:07,  1.80s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:02,  1.42s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:05<00:01,  1.47s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.63s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.58s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4528
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.143 ent: -5.316 str: 0.000 loss: -5.459]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.03s/it, atk: -0.143 ent: -5.316 str: 0.000 loss: -5.459]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.03s/it, atk: -0.503 ent: -5.311 str: 0.000 loss: -5.814]Iterations:   7%|▋         | 2/30 [00:02<00:34,  1.23s/it, atk: -0.503 ent: -5.311 str: 0.000 loss: -5.814]Iterations:   7%|▋         | 2/30 [00:03<00:34,  1.23s/it, atk: -2.768 ent: -5.298 str: 0.000 loss: -8.066]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -2.768 ent: -5.298 str: 0.000 loss: -8.066]Iterations:  10%|█         | 3/30 [00:03<00:25,  1.05it/s, atk: -6.689 ent: -5.296 str: 0.000 loss: -11.986]Iterations:  13%|█▎        | 4/30 [00:03<00:21,  1.23it/s, atk: -6.689 ent: -5.296 str: 0.000 loss: -11.986]Iterations:  13%|█▎        | 4/30 [00:04<00:21,  1.23it/s, atk: -11.542 ent: -5.301 str: 0.000 loss: -16.842]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -11.542 ent: -5.301 str: 0.000 loss: -16.842]Iterations:  17%|█▋        | 5/30 [00:04<00:18,  1.34it/s, atk: -18.555 ent: -5.306 str: 0.000 loss: -23.861]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -18.555 ent: -5.306 str: 0.000 loss: -23.861]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.27it/s, atk: -29.022 ent: -5.299 str: 0.000 loss: -34.322]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.28it/s, atk: -29.022 ent: -5.299 str: 0.000 loss: -34.322]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.28it/s, atk: -36.819 ent: -5.294 str: 0.000 loss: -42.113]Iterations:  27%|██▋       | 8/30 [00:06<00:16,  1.35it/s, atk: -36.819 ent: -5.294 str: 0.000 loss: -42.113]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -49.435 ent: -5.291 str: 0.000 loss: -54.727]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -49.435 ent: -5.291 str: 0.000 loss: -54.727]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -56.517 ent: -5.291 str: 0.000 loss: -61.808]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.41it/s, atk: -56.517 ent: -5.291 str: 0.000 loss: -61.808]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.41it/s, atk: -65.136 ent: -5.288 str: 0.000 loss: -70.424]Iterations:  37%|███▋      | 11/30 [00:08<00:12,  1.49it/s, atk: -65.136 ent: -5.288 str: 0.000 loss: -70.424]Iterations:  37%|███▋      | 11/30 [00:09<00:12,  1.49it/s, atk: -72.523 ent: -5.285 str: 0.000 loss: -77.808]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.46it/s, atk: -72.523 ent: -5.285 str: 0.000 loss: -77.808]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.46it/s, atk: -76.715 ent: -5.285 str: 0.000 loss: -82.000]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -76.715 ent: -5.285 str: 0.000 loss: -82.000]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.46it/s, atk: -80.009 ent: -5.284 str: 0.000 loss: -85.293]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.46it/s, atk: -80.009 ent: -5.284 str: 0.000 loss: -85.293]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.46it/s, atk: -85.890 ent: -5.282 str: 0.000 loss: -91.172]Iterations:  50%|█████     | 15/30 [00:11<00:10,  1.42it/s, atk: -85.890 ent: -5.282 str: 0.000 loss: -91.172]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.42it/s, atk: -92.341 ent: -5.281 str: 0.000 loss: -97.622]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.42it/s, atk: -92.341 ent: -5.281 str: 0.000 loss: -97.622]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.42it/s, atk: -97.640 ent: -5.278 str: 0.000 loss: -102.918]Iterations:  57%|█████▋    | 17/30 [00:12<00:08,  1.47it/s, atk: -97.640 ent: -5.278 str: 0.000 loss: -102.918]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.47it/s, atk: -102.999 ent: -5.274 str: 0.000 loss: -108.273]Iterations:  60%|██████    | 18/30 [00:13<00:08,  1.48it/s, atk: -102.999 ent: -5.274 str: 0.000 loss: -108.273]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.48it/s, atk: -107.712 ent: -5.271 str: 0.000 loss: -112.983]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.28it/s, atk: -107.712 ent: -5.271 str: 0.000 loss: -112.983]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.28it/s, atk: -111.640 ent: -5.269 str: 0.000 loss: -116.909]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.25it/s, atk: -111.640 ent: -5.269 str: 0.000 loss: -116.909]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.25it/s, atk: -115.670 ent: -5.267 str: 0.000 loss: -120.937]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.29it/s, atk: -115.670 ent: -5.267 str: 0.000 loss: -120.937]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.29it/s, atk: -119.769 ent: -5.264 str: 0.000 loss: -125.032]Iterations:  73%|███████▎  | 22/30 [00:16<00:06,  1.32it/s, atk: -119.769 ent: -5.264 str: 0.000 loss: -125.032]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.32it/s, atk: -124.006 ent: -5.261 str: 0.000 loss: -129.267]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.38it/s, atk: -124.006 ent: -5.261 str: 0.000 loss: -129.267]Iterations:  77%|███████▋  | 23/30 [00:17<00:05,  1.38it/s, atk: -128.614 ent: -5.258 str: 0.000 loss: -133.872]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -128.614 ent: -5.258 str: 0.000 loss: -133.872]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.45it/s, atk: -132.538 ent: -5.255 str: 0.000 loss: -137.793]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.44it/s, atk: -132.538 ent: -5.255 str: 0.000 loss: -137.793]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.44it/s, atk: -136.863 ent: -5.252 str: 0.000 loss: -142.115]Iterations:  87%|████████▋ | 26/30 [00:19<00:03,  1.24it/s, atk: -136.863 ent: -5.252 str: 0.000 loss: -142.115]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.24it/s, atk: -141.039 ent: -5.252 str: 0.000 loss: -146.291]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -141.039 ent: -5.252 str: 0.000 loss: -146.291]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.33it/s, atk: -144.097 ent: -5.253 str: 0.000 loss: -149.350]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -144.097 ent: -5.253 str: 0.000 loss: -149.350]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.35it/s, atk: -146.451 ent: -5.255 str: 0.000 loss: -151.706]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.21it/s, atk: -146.451 ent: -5.255 str: 0.000 loss: -151.706]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.21it/s, atk: -148.483 ent: -5.257 str: 0.000 loss: -153.740]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.28it/s, atk: -148.483 ent: -5.257 str: 0.000 loss: -153.740]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -148.483 ent: -5.257 str: 0.000 loss: -153.740]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([690], device='cuda:0') tensor(0.9899, device='cuda:0')
after_true: tensor([603], device='cuda:0') tensor(2.4054e-07, device='cuda:0')
L1: [2850.8547]	L2: [19.888582]	Linf: [0.6666667]

Accuracy on benign examples: 100.0%
gt_label: 570 pred_label: 570 pred_clean_logit 0.9371019601821899
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 12.82it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 11.12it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.34it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 11.83it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.27it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.22it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 15.76it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:01<00:00, 16.16it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 16.34it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.66it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.57s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.46s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.69s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.73s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.82s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3452
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -4.105 ent: -5.407 str: 0.000 loss: -9.512]Iterations:   3%|▎         | 1/30 [00:01<00:55,  1.92s/it, atk: -4.105 ent: -5.407 str: 0.000 loss: -9.512]Iterations:   3%|▎         | 1/30 [00:02<00:55,  1.92s/it, atk: -12.967 ent: -5.415 str: 0.000 loss: -18.382]Iterations:   7%|▋         | 2/30 [00:02<00:38,  1.38s/it, atk: -12.967 ent: -5.415 str: 0.000 loss: -18.382]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.38s/it, atk: -31.348 ent: -5.408 str: 0.000 loss: -36.756]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.08s/it, atk: -31.348 ent: -5.408 str: 0.000 loss: -36.756]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.08s/it, atk: -51.466 ent: -5.410 str: 0.000 loss: -56.875]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -51.466 ent: -5.410 str: 0.000 loss: -56.875]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -63.486 ent: -5.412 str: 0.000 loss: -68.899]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -63.486 ent: -5.412 str: 0.000 loss: -68.899]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -76.749 ent: -5.409 str: 0.000 loss: -82.158]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.21it/s, atk: -76.749 ent: -5.409 str: 0.000 loss: -82.158]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -86.004 ent: -5.405 str: 0.000 loss: -91.408]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -86.004 ent: -5.405 str: 0.000 loss: -91.408]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -92.537 ent: -5.402 str: 0.000 loss: -97.939]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -92.537 ent: -5.402 str: 0.000 loss: -97.939]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -101.026 ent: -5.400 str: 0.000 loss: -106.426]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.34it/s, atk: -101.026 ent: -5.400 str: 0.000 loss: -106.426]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.34it/s, atk: -109.528 ent: -5.398 str: 0.000 loss: -114.926]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.37it/s, atk: -109.528 ent: -5.398 str: 0.000 loss: -114.926]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -116.961 ent: -5.395 str: 0.000 loss: -122.356]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -116.961 ent: -5.395 str: 0.000 loss: -122.356]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.38it/s, atk: -123.253 ent: -5.393 str: 0.000 loss: -128.646]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.37it/s, atk: -123.253 ent: -5.393 str: 0.000 loss: -128.646]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.37it/s, atk: -128.099 ent: -5.393 str: 0.000 loss: -133.492]Iterations:  43%|████▎     | 13/30 [00:10<00:12,  1.38it/s, atk: -128.099 ent: -5.393 str: 0.000 loss: -133.492]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.38it/s, atk: -133.632 ent: -5.395 str: 0.000 loss: -139.028]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -133.632 ent: -5.395 str: 0.000 loss: -139.028]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.40it/s, atk: -134.585 ent: -5.399 str: 0.000 loss: -139.984]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -134.585 ent: -5.399 str: 0.000 loss: -139.984]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.40it/s, atk: -145.775 ent: -5.398 str: 0.000 loss: -151.173]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.25it/s, atk: -145.775 ent: -5.398 str: 0.000 loss: -151.173]Iterations:  53%|█████▎    | 16/30 [00:13<00:11,  1.25it/s, atk: -149.893 ent: -5.399 str: 0.000 loss: -155.292]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.26it/s, atk: -149.893 ent: -5.399 str: 0.000 loss: -155.292]Iterations:  57%|█████▋    | 17/30 [00:14<00:10,  1.26it/s, atk: -153.963 ent: -5.399 str: 0.000 loss: -159.363]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.24it/s, atk: -153.963 ent: -5.399 str: 0.000 loss: -159.363]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.24it/s, atk: -158.586 ent: -5.399 str: 0.000 loss: -163.985]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.33it/s, atk: -158.586 ent: -5.399 str: 0.000 loss: -163.985]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.33it/s, atk: -164.065 ent: -5.398 str: 0.000 loss: -169.462]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -164.065 ent: -5.398 str: 0.000 loss: -169.462]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.38it/s, atk: -169.489 ent: -5.397 str: 0.000 loss: -174.886]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.42it/s, atk: -169.489 ent: -5.397 str: 0.000 loss: -174.886]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.42it/s, atk: -174.226 ent: -5.396 str: 0.000 loss: -179.622]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -174.226 ent: -5.396 str: 0.000 loss: -179.622]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -179.642 ent: -5.395 str: 0.000 loss: -185.037]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.49it/s, atk: -179.642 ent: -5.395 str: 0.000 loss: -185.037]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.49it/s, atk: -183.652 ent: -5.395 str: 0.000 loss: -189.047]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.50it/s, atk: -183.652 ent: -5.395 str: 0.000 loss: -189.047]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.50it/s, atk: -187.450 ent: -5.395 str: 0.000 loss: -192.845]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -187.450 ent: -5.395 str: 0.000 loss: -192.845]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.41it/s, atk: -191.396 ent: -5.396 str: 0.000 loss: -196.792]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -191.396 ent: -5.396 str: 0.000 loss: -196.792]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -194.854 ent: -5.397 str: 0.000 loss: -200.250]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.43it/s, atk: -194.854 ent: -5.397 str: 0.000 loss: -200.250]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.43it/s, atk: -198.836 ent: -5.397 str: 0.000 loss: -204.233]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.31it/s, atk: -198.836 ent: -5.397 str: 0.000 loss: -204.233]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.31it/s, atk: -202.817 ent: -5.397 str: 0.000 loss: -208.214]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.25it/s, atk: -202.817 ent: -5.397 str: 0.000 loss: -208.214]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.25it/s, atk: -206.350 ent: -5.396 str: 0.000 loss: -211.746]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -206.350 ent: -5.396 str: 0.000 loss: -211.746]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.28it/s, atk: -206.350 ent: -5.396 str: 0.000 loss: -211.746]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([643], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([570], device='cuda:0') tensor(7.9709e-10, device='cuda:0')
L1: [3700.6118]	L2: [26.999916]	Linf: [0.8627451]

Accuracy on benign examples: 100.0%
gt_label: 853 pred_label: 853 pred_clean_logit 0.9751507043838501
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.21it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 14.40it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.08it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.70it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 20.73it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.37it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.65it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.07s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:03,  1.23s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.50s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:07<00:00,  1.59s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5535
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.274 ent: -4.924 str: 0.000 loss: -5.197]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.274 ent: -4.924 str: 0.000 loss: -5.197]Iterations:   3%|▎         | 1/30 [00:02<01:03,  2.20s/it, atk: -0.364 ent: -4.912 str: 0.000 loss: -5.275]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -0.364 ent: -4.912 str: 0.000 loss: -5.275]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.53s/it, atk: -0.434 ent: -4.908 str: 0.000 loss: -5.342]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.15s/it, atk: -0.434 ent: -4.908 str: 0.000 loss: -5.342]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.15s/it, atk: -0.890 ent: -4.913 str: 0.000 loss: -5.803]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -0.890 ent: -4.913 str: 0.000 loss: -5.803]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.05it/s, atk: -1.210 ent: -4.902 str: 0.000 loss: -6.112]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -1.210 ent: -4.902 str: 0.000 loss: -6.112]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.19it/s, atk: -2.139 ent: -4.903 str: 0.000 loss: -7.042]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.29it/s, atk: -2.139 ent: -4.903 str: 0.000 loss: -7.042]Iterations:  20%|██        | 6/30 [00:06<00:18,  1.29it/s, atk: -4.293 ent: -4.903 str: 0.000 loss: -9.196]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.36it/s, atk: -4.293 ent: -4.903 str: 0.000 loss: -9.196]Iterations:  23%|██▎       | 7/30 [00:07<00:16,  1.36it/s, atk: -8.494 ent: -4.903 str: 0.000 loss: -13.397]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -8.494 ent: -4.903 str: 0.000 loss: -13.397]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.33it/s, atk: -8.866 ent: -4.907 str: 0.000 loss: -13.773]Iterations:  30%|███       | 9/30 [00:08<00:17,  1.24it/s, atk: -8.866 ent: -4.907 str: 0.000 loss: -13.773]Iterations:  30%|███       | 9/30 [00:08<00:17,  1.24it/s, atk: -16.525 ent: -4.908 str: 0.000 loss: -21.433]Iterations:  33%|███▎      | 10/30 [00:08<00:15,  1.27it/s, atk: -16.525 ent: -4.908 str: 0.000 loss: -21.433]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.27it/s, atk: -21.998 ent: -4.909 str: 0.000 loss: -26.907]Iterations:  37%|███▋      | 11/30 [00:09<00:15,  1.19it/s, atk: -21.998 ent: -4.909 str: 0.000 loss: -26.907]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.19it/s, atk: -24.063 ent: -4.912 str: 0.000 loss: -28.975]Iterations:  40%|████      | 12/30 [00:10<00:14,  1.22it/s, atk: -24.063 ent: -4.912 str: 0.000 loss: -28.975]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.22it/s, atk: -23.971 ent: -4.921 str: 0.000 loss: -28.892]Iterations:  43%|████▎     | 13/30 [00:11<00:14,  1.18it/s, atk: -23.971 ent: -4.921 str: 0.000 loss: -28.892]Iterations:  43%|████▎     | 13/30 [00:12<00:14,  1.18it/s, atk: -26.097 ent: -4.919 str: 0.000 loss: -31.016]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.27it/s, atk: -26.097 ent: -4.919 str: 0.000 loss: -31.016]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.27it/s, atk: -33.034 ent: -4.920 str: 0.000 loss: -37.954]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.33it/s, atk: -33.034 ent: -4.920 str: 0.000 loss: -37.954]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.33it/s, atk: -38.048 ent: -4.918 str: 0.000 loss: -42.966]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -38.048 ent: -4.918 str: 0.000 loss: -42.966]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.37it/s, atk: -44.050 ent: -4.914 str: 0.000 loss: -48.964]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.41it/s, atk: -44.050 ent: -4.914 str: 0.000 loss: -48.964]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.41it/s, atk: -47.652 ent: -4.913 str: 0.000 loss: -52.566]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.24it/s, atk: -47.652 ent: -4.913 str: 0.000 loss: -52.566]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.24it/s, atk: -49.610 ent: -4.912 str: 0.000 loss: -54.522]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.28it/s, atk: -49.610 ent: -4.912 str: 0.000 loss: -54.522]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.28it/s, atk: -53.626 ent: -4.911 str: 0.000 loss: -58.537]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.34it/s, atk: -53.626 ent: -4.911 str: 0.000 loss: -58.537]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.34it/s, atk: -54.667 ent: -4.912 str: 0.000 loss: -59.579]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.33it/s, atk: -54.667 ent: -4.912 str: 0.000 loss: -59.579]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.33it/s, atk: -51.570 ent: -4.915 str: 0.000 loss: -56.485]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.30it/s, atk: -51.570 ent: -4.915 str: 0.000 loss: -56.485]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.30it/s, atk: -58.713 ent: -4.913 str: 0.000 loss: -63.626]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.27it/s, atk: -58.713 ent: -4.913 str: 0.000 loss: -63.626]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.27it/s, atk: -62.451 ent: -4.912 str: 0.000 loss: -67.363]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.27it/s, atk: -62.451 ent: -4.912 str: 0.000 loss: -67.363]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.27it/s, atk: -65.050 ent: -4.913 str: 0.000 loss: -69.963]Iterations:  83%|████████▎ | 25/30 [00:20<00:04,  1.23it/s, atk: -65.050 ent: -4.913 str: 0.000 loss: -69.963]Iterations:  83%|████████▎ | 25/30 [00:21<00:04,  1.23it/s, atk: -66.899 ent: -4.914 str: 0.000 loss: -71.813]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.15it/s, atk: -66.899 ent: -4.914 str: 0.000 loss: -71.813]Iterations:  87%|████████▋ | 26/30 [00:22<00:03,  1.15it/s, atk: -68.101 ent: -4.915 str: 0.000 loss: -73.016]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.26it/s, atk: -68.101 ent: -4.915 str: 0.000 loss: -73.016]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.26it/s, atk: -71.042 ent: -4.918 str: 0.000 loss: -75.959]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.34it/s, atk: -71.042 ent: -4.918 str: 0.000 loss: -75.959]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.34it/s, atk: -73.978 ent: -4.920 str: 0.000 loss: -78.899]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.35it/s, atk: -73.978 ent: -4.920 str: 0.000 loss: -78.899]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.35it/s, atk: -76.107 ent: -4.923 str: 0.000 loss: -81.031]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.35it/s, atk: -76.107 ent: -4.923 str: 0.000 loss: -81.031]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.22it/s, atk: -76.107 ent: -4.923 str: 0.000 loss: -81.031]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([415], device='cuda:0') tensor(0.4999, device='cuda:0')
after_true: tensor([853], device='cuda:0') tensor(0.0004, device='cuda:0')
L1: [2276.596]	L2: [17.30758]	Linf: [0.6784314]

Accuracy on benign examples: 100.0%
gt_label: 229 pred_label: 229 pred_clean_logit 0.9028643369674683
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 22.09it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.16it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 17.12it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 13.41it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.48it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.31it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 13.99it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 15.27it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.12it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.00s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.82s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.82s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.78s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.83s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.2724
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.662 ent: -10.147 str: 0.000 loss: -10.810]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -0.662 ent: -10.147 str: 0.000 loss: -10.810]Iterations:   3%|▎         | 1/30 [00:02<01:01,  2.13s/it, atk: -6.805 ent: -10.099 str: 0.000 loss: -16.904]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.27s/it, atk: -6.805 ent: -10.099 str: 0.000 loss: -16.904]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.27s/it, atk: -30.282 ent: -10.083 str: 0.000 loss: -40.365]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -30.282 ent: -10.083 str: 0.000 loss: -40.365]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.02it/s, atk: -54.658 ent: -10.076 str: 0.000 loss: -64.734]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -54.658 ent: -10.076 str: 0.000 loss: -64.734]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -73.993 ent: -10.080 str: 0.000 loss: -84.073]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.24it/s, atk: -73.993 ent: -10.080 str: 0.000 loss: -84.073]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.24it/s, atk: -86.130 ent: -10.071 str: 0.000 loss: -96.201]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.21it/s, atk: -86.130 ent: -10.071 str: 0.000 loss: -96.201]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -95.664 ent: -10.074 str: 0.000 loss: -105.738]Iterations:  23%|██▎       | 7/30 [00:06<00:18,  1.25it/s, atk: -95.664 ent: -10.074 str: 0.000 loss: -105.738]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.25it/s, atk: -103.788 ent: -10.080 str: 0.000 loss: -113.868]Iterations:  27%|██▋       | 8/30 [00:07<00:19,  1.14it/s, atk: -103.788 ent: -10.080 str: 0.000 loss: -113.868]Iterations:  27%|██▋       | 8/30 [00:07<00:19,  1.14it/s, atk: -111.752 ent: -10.082 str: 0.000 loss: -121.834]Iterations:  30%|███       | 9/30 [00:08<00:19,  1.10it/s, atk: -111.752 ent: -10.082 str: 0.000 loss: -121.834]Iterations:  30%|███       | 9/30 [00:08<00:19,  1.10it/s, atk: -118.394 ent: -10.082 str: 0.000 loss: -128.476]Iterations:  33%|███▎      | 10/30 [00:09<00:16,  1.20it/s, atk: -118.394 ent: -10.082 str: 0.000 loss: -128.476]Iterations:  33%|███▎      | 10/30 [00:09<00:16,  1.20it/s, atk: -125.007 ent: -10.082 str: 0.000 loss: -135.088]Iterations:  37%|███▋      | 11/30 [00:09<00:14,  1.29it/s, atk: -125.007 ent: -10.082 str: 0.000 loss: -135.088]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.29it/s, atk: -130.524 ent: -10.080 str: 0.000 loss: -140.605]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.32it/s, atk: -130.524 ent: -10.080 str: 0.000 loss: -140.605]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.32it/s, atk: -133.636 ent: -10.080 str: 0.000 loss: -143.715]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.38it/s, atk: -133.636 ent: -10.080 str: 0.000 loss: -143.715]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.38it/s, atk: -136.358 ent: -10.080 str: 0.000 loss: -146.438]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.42it/s, atk: -136.358 ent: -10.080 str: 0.000 loss: -146.438]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.42it/s, atk: -139.069 ent: -10.081 str: 0.000 loss: -149.150]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -139.069 ent: -10.081 str: 0.000 loss: -149.150]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.38it/s, atk: -141.818 ent: -10.082 str: 0.000 loss: -151.900]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -141.818 ent: -10.082 str: 0.000 loss: -151.900]Iterations:  53%|█████▎    | 16/30 [00:13<00:09,  1.44it/s, atk: -144.877 ent: -10.085 str: 0.000 loss: -154.963]Iterations:  57%|█████▋    | 17/30 [00:13<00:08,  1.45it/s, atk: -144.877 ent: -10.085 str: 0.000 loss: -154.963]Iterations:  57%|█████▋    | 17/30 [00:14<00:08,  1.45it/s, atk: -148.548 ent: -10.088 str: 0.000 loss: -158.637]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.34it/s, atk: -148.548 ent: -10.088 str: 0.000 loss: -158.637]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.34it/s, atk: -152.670 ent: -10.091 str: 0.000 loss: -162.761]Iterations:  63%|██████▎   | 19/30 [00:15<00:09,  1.18it/s, atk: -152.670 ent: -10.091 str: 0.000 loss: -162.761]Iterations:  63%|██████▎   | 19/30 [00:16<00:09,  1.18it/s, atk: -155.348 ent: -10.092 str: 0.000 loss: -165.440]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.22it/s, atk: -155.348 ent: -10.092 str: 0.000 loss: -165.440]Iterations:  67%|██████▋   | 20/30 [00:16<00:08,  1.22it/s, atk: -158.146 ent: -10.092 str: 0.000 loss: -168.238]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.29it/s, atk: -158.146 ent: -10.092 str: 0.000 loss: -168.238]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.29it/s, atk: -160.719 ent: -10.093 str: 0.000 loss: -170.811]Iterations:  73%|███████▎  | 22/30 [00:17<00:06,  1.30it/s, atk: -160.719 ent: -10.093 str: 0.000 loss: -170.811]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.30it/s, atk: -163.190 ent: -10.095 str: 0.000 loss: -173.285]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.31it/s, atk: -163.190 ent: -10.095 str: 0.000 loss: -173.285]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.31it/s, atk: -165.138 ent: -10.097 str: 0.000 loss: -175.236]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -165.138 ent: -10.097 str: 0.000 loss: -175.236]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.34it/s, atk: -167.270 ent: -10.099 str: 0.000 loss: -177.369]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.26it/s, atk: -167.270 ent: -10.099 str: 0.000 loss: -177.369]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.26it/s, atk: -169.691 ent: -10.099 str: 0.000 loss: -179.790]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.14it/s, atk: -169.691 ent: -10.099 str: 0.000 loss: -179.790]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.14it/s, atk: -171.828 ent: -10.099 str: 0.000 loss: -181.927]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.21it/s, atk: -171.828 ent: -10.099 str: 0.000 loss: -181.927]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.21it/s, atk: -173.626 ent: -10.101 str: 0.000 loss: -183.727]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.15it/s, atk: -173.626 ent: -10.101 str: 0.000 loss: -183.727]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.15it/s, atk: -175.494 ent: -10.103 str: 0.000 loss: -185.597]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.22it/s, atk: -175.494 ent: -10.103 str: 0.000 loss: -185.597]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.22it/s, atk: -177.195 ent: -10.105 str: 0.000 loss: -187.300]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.19it/s, atk: -177.195 ent: -10.105 str: 0.000 loss: -187.300]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.21it/s, atk: -177.195 ent: -10.105 str: 0.000 loss: -187.300]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([257], device='cuda:0') tensor(0.9948, device='cuda:0')
after_true: tensor([229], device='cuda:0') tensor(1.7128e-08, device='cuda:0')
L1: [2762.5256]	L2: [18.41736]	Linf: [0.63529414]

Accuracy on benign examples: 100.0%
gt_label: 945 pred_label: 945 pred_clean_logit 0.9980691075325012
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 17.25it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 18.33it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 18.13it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 15.36it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 12.88it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 12.06it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:01<00:00, 12.21it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 13.02it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 14.59it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.40it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:04,  1.25s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.38s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.54s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.72s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5737
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.016 ent: -5.315 str: 0.000 loss: -5.330]Iterations:   3%|▎         | 1/30 [00:02<01:19,  2.76s/it, atk: -0.016 ent: -5.315 str: 0.000 loss: -5.330]Iterations:   3%|▎         | 1/30 [00:03<01:19,  2.76s/it, atk: -0.018 ent: -5.332 str: 0.000 loss: -5.350]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.52s/it, atk: -0.018 ent: -5.332 str: 0.000 loss: -5.350]Iterations:   7%|▋         | 2/30 [00:03<00:42,  1.52s/it, atk: -0.023 ent: -5.355 str: 0.000 loss: -5.378]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.14s/it, atk: -0.023 ent: -5.355 str: 0.000 loss: -5.378]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.14s/it, atk: -0.040 ent: -5.376 str: 0.000 loss: -5.416]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.04it/s, atk: -0.040 ent: -5.376 str: 0.000 loss: -5.416]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.04it/s, atk: -0.090 ent: -5.393 str: 0.000 loss: -5.484]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.10it/s, atk: -0.090 ent: -5.393 str: 0.000 loss: -5.484]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.10it/s, atk: -0.269 ent: -5.404 str: 0.000 loss: -5.674]Iterations:  20%|██        | 6/30 [00:06<00:22,  1.07it/s, atk: -0.269 ent: -5.404 str: 0.000 loss: -5.674]Iterations:  20%|██        | 6/30 [00:07<00:22,  1.07it/s, atk: -1.017 ent: -5.400 str: 0.000 loss: -6.417]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.15it/s, atk: -1.017 ent: -5.400 str: 0.000 loss: -6.417]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.15it/s, atk: -1.918 ent: -5.393 str: 0.000 loss: -7.311]Iterations:  27%|██▋       | 8/30 [00:08<00:19,  1.15it/s, atk: -1.918 ent: -5.393 str: 0.000 loss: -7.311]Iterations:  27%|██▋       | 8/30 [00:08<00:19,  1.15it/s, atk: -6.610 ent: -5.386 str: 0.000 loss: -11.996]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.25it/s, atk: -6.610 ent: -5.386 str: 0.000 loss: -11.996]Iterations:  30%|███       | 9/30 [00:09<00:16,  1.25it/s, atk: -16.259 ent: -5.384 str: 0.000 loss: -21.643]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.31it/s, atk: -16.259 ent: -5.384 str: 0.000 loss: -21.643]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.31it/s, atk: -28.624 ent: -5.384 str: 0.000 loss: -34.008]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -28.624 ent: -5.384 str: 0.000 loss: -34.008]Iterations:  37%|███▋      | 11/30 [00:10<00:14,  1.32it/s, atk: -46.898 ent: -5.383 str: 0.000 loss: -52.281]Iterations:  40%|████      | 12/30 [00:10<00:13,  1.36it/s, atk: -46.898 ent: -5.383 str: 0.000 loss: -52.281]Iterations:  40%|████      | 12/30 [00:11<00:13,  1.36it/s, atk: -61.459 ent: -5.379 str: 0.000 loss: -66.838]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.25it/s, atk: -61.459 ent: -5.379 str: 0.000 loss: -66.838]Iterations:  43%|████▎     | 13/30 [00:12<00:13,  1.25it/s, atk: -75.341 ent: -5.372 str: 0.000 loss: -80.713]Iterations:  47%|████▋     | 14/30 [00:12<00:13,  1.21it/s, atk: -75.341 ent: -5.372 str: 0.000 loss: -80.713]Iterations:  47%|████▋     | 14/30 [00:13<00:13,  1.21it/s, atk: -84.688 ent: -5.364 str: 0.000 loss: -90.052]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.25it/s, atk: -84.688 ent: -5.364 str: 0.000 loss: -90.052]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.25it/s, atk: -95.339 ent: -5.367 str: 0.000 loss: -100.706]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.32it/s, atk: -95.339 ent: -5.367 str: 0.000 loss: -100.706]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.32it/s, atk: -107.343 ent: -5.371 str: 0.000 loss: -112.714]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.37it/s, atk: -107.343 ent: -5.371 str: 0.000 loss: -112.714]Iterations:  57%|█████▋    | 17/30 [00:15<00:09,  1.37it/s, atk: -117.923 ent: -5.377 str: 0.000 loss: -123.300]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.45it/s, atk: -117.923 ent: -5.377 str: 0.000 loss: -123.300]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.45it/s, atk: -130.560 ent: -5.371 str: 0.000 loss: -135.930]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.34it/s, atk: -130.560 ent: -5.371 str: 0.000 loss: -135.930]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.34it/s, atk: -140.829 ent: -5.370 str: 0.000 loss: -146.199]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.31it/s, atk: -140.829 ent: -5.370 str: 0.000 loss: -146.199]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.31it/s, atk: -151.102 ent: -5.370 str: 0.000 loss: -156.472]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.32it/s, atk: -151.102 ent: -5.370 str: 0.000 loss: -156.472]Iterations:  70%|███████   | 21/30 [00:18<00:06,  1.32it/s, atk: -161.653 ent: -5.369 str: 0.000 loss: -167.022]Iterations:  73%|███████▎  | 22/30 [00:18<00:06,  1.20it/s, atk: -161.653 ent: -5.369 str: 0.000 loss: -167.022]Iterations:  73%|███████▎  | 22/30 [00:19<00:06,  1.20it/s, atk: -172.407 ent: -5.370 str: 0.000 loss: -177.777]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.24it/s, atk: -172.407 ent: -5.370 str: 0.000 loss: -177.777]Iterations:  77%|███████▋  | 23/30 [00:20<00:05,  1.24it/s, atk: -183.192 ent: -5.370 str: 0.000 loss: -188.561]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.30it/s, atk: -183.192 ent: -5.370 str: 0.000 loss: -188.561]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.30it/s, atk: -194.297 ent: -5.369 str: 0.000 loss: -199.666]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.39it/s, atk: -194.297 ent: -5.369 str: 0.000 loss: -199.666]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.39it/s, atk: -204.815 ent: -5.368 str: 0.000 loss: -210.183]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.43it/s, atk: -204.815 ent: -5.368 str: 0.000 loss: -210.183]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.43it/s, atk: -215.975 ent: -5.366 str: 0.000 loss: -221.342]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.45it/s, atk: -215.975 ent: -5.366 str: 0.000 loss: -221.342]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.45it/s, atk: -224.435 ent: -5.363 str: 0.000 loss: -229.798]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.51it/s, atk: -224.435 ent: -5.363 str: 0.000 loss: -229.798]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.51it/s, atk: -234.083 ent: -5.360 str: 0.000 loss: -239.443]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.46it/s, atk: -234.083 ent: -5.360 str: 0.000 loss: -239.443]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.46it/s, atk: -242.705 ent: -5.356 str: 0.000 loss: -248.061]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.48it/s, atk: -242.705 ent: -5.356 str: 0.000 loss: -248.061]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.24it/s, atk: -242.705 ent: -5.356 str: 0.000 loss: -248.061]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([929], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([945], device='cuda:0') tensor(1.2656e-11, device='cuda:0')
L1: [2244.3257]	L2: [17.236502]	Linf: [0.80784315]

Accuracy on benign examples: 100.0%
gt_label: 319 pred_label: 319 pred_clean_logit 0.7997479438781738
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 15.79it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 19.69it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.72it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 20.00it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 20.72it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 20.99it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.81it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.90it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.69s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.70s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.59s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.80s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4485
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -2.822 ent: -3.071 str: 0.000 loss: -5.893]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.01s/it, atk: -2.822 ent: -3.071 str: 0.000 loss: -5.893]Iterations:   3%|▎         | 1/30 [00:02<00:58,  2.01s/it, atk: -6.425 ent: -3.061 str: 0.000 loss: -9.486]Iterations:   7%|▋         | 2/30 [00:02<00:38,  1.37s/it, atk: -6.425 ent: -3.061 str: 0.000 loss: -9.486]Iterations:   7%|▋         | 2/30 [00:03<00:38,  1.37s/it, atk: -10.824 ent: -3.067 str: 0.000 loss: -13.891]Iterations:  10%|█         | 3/30 [00:03<00:30,  1.12s/it, atk: -10.824 ent: -3.067 str: 0.000 loss: -13.891]Iterations:  10%|█         | 3/30 [00:04<00:30,  1.12s/it, atk: -14.648 ent: -3.066 str: 0.000 loss: -17.714]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -14.648 ent: -3.066 str: 0.000 loss: -17.714]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.07it/s, atk: -17.974 ent: -3.061 str: 0.000 loss: -21.035]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -17.974 ent: -3.061 str: 0.000 loss: -21.035]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -24.524 ent: -3.053 str: 0.000 loss: -27.577]Iterations:  20%|██        | 6/30 [00:05<00:19,  1.26it/s, atk: -24.524 ent: -3.053 str: 0.000 loss: -27.577]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.26it/s, atk: -27.958 ent: -3.044 str: 0.000 loss: -31.002]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -27.958 ent: -3.044 str: 0.000 loss: -31.002]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -31.505 ent: -3.046 str: 0.000 loss: -34.551]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -31.505 ent: -3.046 str: 0.000 loss: -34.551]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.36it/s, atk: -34.945 ent: -3.039 str: 0.000 loss: -37.984]Iterations:  30%|███       | 9/30 [00:07<00:15,  1.38it/s, atk: -34.945 ent: -3.039 str: 0.000 loss: -37.984]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -39.428 ent: -3.037 str: 0.000 loss: -42.466]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -39.428 ent: -3.037 str: 0.000 loss: -42.466]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.40it/s, atk: -44.264 ent: -3.037 str: 0.000 loss: -47.301]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -44.264 ent: -3.037 str: 0.000 loss: -47.301]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.44it/s, atk: -48.794 ent: -3.036 str: 0.000 loss: -51.830]Iterations:  40%|████      | 12/30 [00:09<00:12,  1.40it/s, atk: -48.794 ent: -3.036 str: 0.000 loss: -51.830]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -52.353 ent: -3.035 str: 0.000 loss: -55.388]Iterations:  43%|████▎     | 13/30 [00:10<00:13,  1.25it/s, atk: -52.353 ent: -3.035 str: 0.000 loss: -55.388]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.25it/s, atk: -55.824 ent: -3.033 str: 0.000 loss: -58.857]Iterations:  47%|████▋     | 14/30 [00:11<00:12,  1.31it/s, atk: -55.824 ent: -3.033 str: 0.000 loss: -58.857]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.31it/s, atk: -59.005 ent: -3.031 str: 0.000 loss: -62.036]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.37it/s, atk: -59.005 ent: -3.031 str: 0.000 loss: -62.036]Iterations:  50%|█████     | 15/30 [00:12<00:10,  1.37it/s, atk: -62.170 ent: -3.029 str: 0.000 loss: -65.199]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -62.170 ent: -3.029 str: 0.000 loss: -65.199]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.38it/s, atk: -64.770 ent: -3.028 str: 0.000 loss: -67.798]Iterations:  57%|█████▋    | 17/30 [00:13<00:09,  1.41it/s, atk: -64.770 ent: -3.028 str: 0.000 loss: -67.798]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.41it/s, atk: -67.150 ent: -3.028 str: 0.000 loss: -70.178]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -67.150 ent: -3.028 str: 0.000 loss: -70.178]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.44it/s, atk: -69.596 ent: -3.026 str: 0.000 loss: -72.622]Iterations:  63%|██████▎   | 19/30 [00:14<00:07,  1.48it/s, atk: -69.596 ent: -3.026 str: 0.000 loss: -72.622]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.48it/s, atk: -71.576 ent: -3.024 str: 0.000 loss: -74.600]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.40it/s, atk: -71.576 ent: -3.024 str: 0.000 loss: -74.600]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.40it/s, atk: -73.761 ent: -3.023 str: 0.000 loss: -76.784]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -73.761 ent: -3.023 str: 0.000 loss: -76.784]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.39it/s, atk: -75.045 ent: -3.024 str: 0.000 loss: -78.069]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -75.045 ent: -3.024 str: 0.000 loss: -78.069]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.46it/s, atk: -76.926 ent: -3.025 str: 0.000 loss: -79.951]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.25it/s, atk: -76.926 ent: -3.025 str: 0.000 loss: -79.951]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.25it/s, atk: -78.928 ent: -3.026 str: 0.000 loss: -81.954]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.25it/s, atk: -78.928 ent: -3.026 str: 0.000 loss: -81.954]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.25it/s, atk: -81.135 ent: -3.025 str: 0.000 loss: -84.161]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.29it/s, atk: -81.135 ent: -3.025 str: 0.000 loss: -84.161]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.29it/s, atk: -83.253 ent: -3.024 str: 0.000 loss: -86.278]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -83.253 ent: -3.024 str: 0.000 loss: -86.278]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.37it/s, atk: -85.493 ent: -3.024 str: 0.000 loss: -88.517]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -85.493 ent: -3.024 str: 0.000 loss: -88.517]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.36it/s, atk: -87.267 ent: -3.023 str: 0.000 loss: -90.290]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.42it/s, atk: -87.267 ent: -3.023 str: 0.000 loss: -90.290]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.42it/s, atk: -89.464 ent: -3.024 str: 0.000 loss: -92.489]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -89.464 ent: -3.024 str: 0.000 loss: -92.489]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.44it/s, atk: -91.742 ent: -3.026 str: 0.000 loss: -94.768]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.45it/s, atk: -91.742 ent: -3.026 str: 0.000 loss: -94.768]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.30it/s, atk: -91.742 ent: -3.026 str: 0.000 loss: -94.768]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([320], device='cuda:0') tensor(0.9994, device='cuda:0')
after_true: tensor([319], device='cuda:0') tensor(8.1253e-05, device='cuda:0')
L1: [3628.5608]	L2: [23.130625]	Linf: [0.74509805]

Accuracy on benign examples: 100.0%
gt_label: 535 pred_label: 535 pred_clean_logit 0.933960497379303
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:03,  5.97it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 11.70it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:01, 13.51it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:01, 11.73it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 12.97it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 14.42it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 15.10it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:01<00:00, 14.48it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.53it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 14.18it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.48s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.57s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.52s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.85s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  2.07s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.88s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4692
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -3.331 ent: -5.344 str: 0.000 loss: -8.676]Iterations:   3%|▎         | 1/30 [00:02<01:18,  2.70s/it, atk: -3.331 ent: -5.344 str: 0.000 loss: -8.676]Iterations:   3%|▎         | 1/30 [00:03<01:18,  2.70s/it, atk: -8.954 ent: -5.363 str: 0.000 loss: -14.317]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.54s/it, atk: -8.954 ent: -5.363 str: 0.000 loss: -14.317]Iterations:   7%|▋         | 2/30 [00:03<00:43,  1.54s/it, atk: -18.531 ent: -5.370 str: 0.000 loss: -23.901]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.16s/it, atk: -18.531 ent: -5.370 str: 0.000 loss: -23.901]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.16s/it, atk: -30.836 ent: -5.368 str: 0.000 loss: -36.204]Iterations:  13%|█▎        | 4/30 [00:04<00:25,  1.02it/s, atk: -30.836 ent: -5.368 str: 0.000 loss: -36.204]Iterations:  13%|█▎        | 4/30 [00:05<00:25,  1.02it/s, atk: -44.548 ent: -5.376 str: 0.000 loss: -49.924]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -44.548 ent: -5.376 str: 0.000 loss: -49.924]Iterations:  17%|█▋        | 5/30 [00:05<00:21,  1.16it/s, atk: -52.850 ent: -5.372 str: 0.000 loss: -58.222]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -52.850 ent: -5.372 str: 0.000 loss: -58.222]Iterations:  20%|██        | 6/30 [00:06<00:20,  1.19it/s, atk: -60.872 ent: -5.371 str: 0.000 loss: -66.243]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -60.872 ent: -5.371 str: 0.000 loss: -66.243]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.24it/s, atk: -67.671 ent: -5.365 str: 0.000 loss: -73.036]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -67.671 ent: -5.365 str: 0.000 loss: -73.036]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.28it/s, atk: -73.962 ent: -5.359 str: 0.000 loss: -79.322]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.29it/s, atk: -73.962 ent: -5.359 str: 0.000 loss: -79.322]Iterations:  30%|███       | 9/30 [00:09<00:16,  1.29it/s, atk: -80.386 ent: -5.358 str: 0.000 loss: -85.744]Iterations:  33%|███▎      | 10/30 [00:09<00:16,  1.22it/s, atk: -80.386 ent: -5.358 str: 0.000 loss: -85.744]Iterations:  33%|███▎      | 10/30 [00:10<00:16,  1.22it/s, atk: -86.890 ent: -5.356 str: 0.000 loss: -92.246]Iterations:  37%|███▋      | 11/30 [00:10<00:16,  1.19it/s, atk: -86.890 ent: -5.356 str: 0.000 loss: -92.246]Iterations:  37%|███▋      | 11/30 [00:10<00:16,  1.19it/s, atk: -92.206 ent: -5.354 str: 0.000 loss: -97.560]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.22it/s, atk: -92.206 ent: -5.354 str: 0.000 loss: -97.560]Iterations:  40%|████      | 12/30 [00:11<00:14,  1.22it/s, atk: -96.728 ent: -5.348 str: 0.000 loss: -102.075]Iterations:  43%|████▎     | 13/30 [00:11<00:13,  1.28it/s, atk: -96.728 ent: -5.348 str: 0.000 loss: -102.075]Iterations:  43%|████▎     | 13/30 [00:12<00:13,  1.28it/s, atk: -101.287 ent: -5.344 str: 0.000 loss: -106.631]Iterations:  47%|████▋     | 14/30 [00:12<00:13,  1.23it/s, atk: -101.287 ent: -5.344 str: 0.000 loss: -106.631]Iterations:  47%|████▋     | 14/30 [00:13<00:13,  1.23it/s, atk: -106.274 ent: -5.344 str: 0.000 loss: -111.618]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.31it/s, atk: -106.274 ent: -5.344 str: 0.000 loss: -111.618]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.31it/s, atk: -112.732 ent: -5.342 str: 0.000 loss: -118.074]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.32it/s, atk: -112.732 ent: -5.342 str: 0.000 loss: -118.074]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.32it/s, atk: -119.295 ent: -5.347 str: 0.000 loss: -124.641]Iterations:  57%|█████▋    | 17/30 [00:15<00:10,  1.21it/s, atk: -119.295 ent: -5.347 str: 0.000 loss: -124.641]Iterations:  57%|█████▋    | 17/30 [00:15<00:10,  1.21it/s, atk: -127.714 ent: -5.347 str: 0.000 loss: -133.061]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.27it/s, atk: -127.714 ent: -5.347 str: 0.000 loss: -133.061]Iterations:  60%|██████    | 18/30 [00:16<00:09,  1.27it/s, atk: -136.644 ent: -5.348 str: 0.000 loss: -141.992]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.30it/s, atk: -136.644 ent: -5.348 str: 0.000 loss: -141.992]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.30it/s, atk: -144.488 ent: -5.349 str: 0.000 loss: -149.837]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.37it/s, atk: -144.488 ent: -5.349 str: 0.000 loss: -149.837]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.37it/s, atk: -152.369 ent: -5.351 str: 0.000 loss: -157.721]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.40it/s, atk: -152.369 ent: -5.351 str: 0.000 loss: -157.721]Iterations:  70%|███████   | 21/30 [00:18<00:06,  1.40it/s, atk: -161.514 ent: -5.354 str: 0.000 loss: -166.868]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.42it/s, atk: -161.514 ent: -5.354 str: 0.000 loss: -166.868]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.42it/s, atk: -169.289 ent: -5.357 str: 0.000 loss: -174.647]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.39it/s, atk: -169.289 ent: -5.357 str: 0.000 loss: -174.647]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.39it/s, atk: -174.638 ent: -5.351 str: 0.000 loss: -179.989]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.41it/s, atk: -174.638 ent: -5.351 str: 0.000 loss: -179.989]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.41it/s, atk: -180.633 ent: -5.363 str: 0.000 loss: -185.995]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.35it/s, atk: -180.633 ent: -5.363 str: 0.000 loss: -185.995]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.35it/s, atk: -181.855 ent: -5.357 str: 0.000 loss: -187.212]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.22it/s, atk: -181.855 ent: -5.357 str: 0.000 loss: -187.212]Iterations:  87%|████████▋ | 26/30 [00:22<00:03,  1.22it/s, atk: -191.242 ent: -5.357 str: 0.000 loss: -196.598]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.26it/s, atk: -191.242 ent: -5.357 str: 0.000 loss: -196.598]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.26it/s, atk: -192.102 ent: -5.361 str: 0.000 loss: -197.462]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.33it/s, atk: -192.102 ent: -5.361 str: 0.000 loss: -197.462]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.33it/s, atk: -201.681 ent: -5.363 str: 0.000 loss: -207.044]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.35it/s, atk: -201.681 ent: -5.363 str: 0.000 loss: -207.044]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.35it/s, atk: -207.373 ent: -5.367 str: 0.000 loss: -212.740]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.36it/s, atk: -207.373 ent: -5.367 str: 0.000 loss: -212.740]Iterations: 100%|██████████| 30/30 [00:24<00:00,  1.22it/s, atk: -207.373 ent: -5.367 str: 0.000 loss: -212.740]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([485], device='cuda:0') tensor(0.9910, device='cuda:0')
after_true: tensor([535], device='cuda:0') tensor(6.2270e-10, device='cuda:0')
L1: [2706.0315]	L2: [19.652943]	Linf: [0.70980394]

Accuracy on benign examples: 100.0%
gt_label: 656 pred_label: 656 pred_clean_logit 0.9218392372131348
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:   5%|▌         | 1/19 [00:00<00:02,  8.36it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:01, 14.01it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 17.52it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 19.21it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 18.11it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 18.03it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.49it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.29it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.05it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.30it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.55s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:04,  1.58s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.60s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.81s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.98s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.84s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4918
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.923 ent: -5.258 str: 0.000 loss: -6.182]Iterations:   3%|▎         | 1/30 [00:02<01:11,  2.46s/it, atk: -0.923 ent: -5.258 str: 0.000 loss: -6.182]Iterations:   3%|▎         | 1/30 [00:03<01:11,  2.46s/it, atk: -2.497 ent: -5.259 str: 0.000 loss: -7.755]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.67s/it, atk: -2.497 ent: -5.259 str: 0.000 loss: -7.755]Iterations:   7%|▋         | 2/30 [00:03<00:46,  1.67s/it, atk: -4.902 ent: -5.252 str: 0.000 loss: -10.154]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -4.902 ent: -5.252 str: 0.000 loss: -10.154]Iterations:  10%|█         | 3/30 [00:04<00:32,  1.21s/it, atk: -7.634 ent: -5.251 str: 0.000 loss: -12.885]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.01s/it, atk: -7.634 ent: -5.251 str: 0.000 loss: -12.885]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.01s/it, atk: -8.595 ent: -5.253 str: 0.000 loss: -13.848]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.11it/s, atk: -8.595 ent: -5.253 str: 0.000 loss: -13.848]Iterations:  17%|█▋        | 5/30 [00:06<00:22,  1.11it/s, atk: -12.198 ent: -5.248 str: 0.000 loss: -17.447]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -12.198 ent: -5.248 str: 0.000 loss: -17.447]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.21it/s, atk: -16.378 ent: -5.245 str: 0.000 loss: -21.623]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -16.378 ent: -5.245 str: 0.000 loss: -21.623]Iterations:  23%|██▎       | 7/30 [00:07<00:18,  1.27it/s, atk: -18.741 ent: -5.242 str: 0.000 loss: -23.984]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.28it/s, atk: -18.741 ent: -5.242 str: 0.000 loss: -23.984]Iterations:  27%|██▋       | 8/30 [00:08<00:17,  1.28it/s, atk: -22.015 ent: -5.243 str: 0.000 loss: -27.258]Iterations:  30%|███       | 9/30 [00:08<00:17,  1.23it/s, atk: -22.015 ent: -5.243 str: 0.000 loss: -27.258]Iterations:  30%|███       | 9/30 [00:09<00:17,  1.23it/s, atk: -25.770 ent: -5.243 str: 0.000 loss: -31.013]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.29it/s, atk: -25.770 ent: -5.243 str: 0.000 loss: -31.013]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.29it/s, atk: -28.902 ent: -5.242 str: 0.000 loss: -34.144]Iterations:  37%|███▋      | 11/30 [00:10<00:16,  1.16it/s, atk: -28.902 ent: -5.242 str: 0.000 loss: -34.144]Iterations:  37%|███▋      | 11/30 [00:11<00:16,  1.16it/s, atk: -31.446 ent: -5.242 str: 0.000 loss: -36.688]Iterations:  40%|████      | 12/30 [00:11<00:15,  1.14it/s, atk: -31.446 ent: -5.242 str: 0.000 loss: -36.688]Iterations:  40%|████      | 12/30 [00:11<00:15,  1.14it/s, atk: -34.475 ent: -5.243 str: 0.000 loss: -39.718]Iterations:  43%|████▎     | 13/30 [00:12<00:13,  1.22it/s, atk: -34.475 ent: -5.243 str: 0.000 loss: -39.718]Iterations:  43%|████▎     | 13/30 [00:12<00:13,  1.22it/s, atk: -36.887 ent: -5.244 str: 0.000 loss: -42.131]Iterations:  47%|████▋     | 14/30 [00:12<00:12,  1.25it/s, atk: -36.887 ent: -5.244 str: 0.000 loss: -42.131]Iterations:  47%|████▋     | 14/30 [00:13<00:12,  1.25it/s, atk: -39.700 ent: -5.243 str: 0.000 loss: -44.943]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.30it/s, atk: -39.700 ent: -5.243 str: 0.000 loss: -44.943]Iterations:  50%|█████     | 15/30 [00:14<00:11,  1.30it/s, atk: -42.744 ent: -5.242 str: 0.000 loss: -47.986]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.27it/s, atk: -42.744 ent: -5.242 str: 0.000 loss: -47.986]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.27it/s, atk: -45.608 ent: -5.239 str: 0.000 loss: -50.847]Iterations:  57%|█████▋    | 17/30 [00:15<00:09,  1.30it/s, atk: -45.608 ent: -5.239 str: 0.000 loss: -50.847]Iterations:  57%|█████▋    | 17/30 [00:15<00:09,  1.30it/s, atk: -48.804 ent: -5.237 str: 0.000 loss: -54.041]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.33it/s, atk: -48.804 ent: -5.237 str: 0.000 loss: -54.041]Iterations:  60%|██████    | 18/30 [00:16<00:09,  1.33it/s, atk: -51.630 ent: -5.236 str: 0.000 loss: -56.865]Iterations:  63%|██████▎   | 19/30 [00:16<00:09,  1.20it/s, atk: -51.630 ent: -5.236 str: 0.000 loss: -56.865]Iterations:  63%|██████▎   | 19/30 [00:17<00:09,  1.20it/s, atk: -54.284 ent: -5.234 str: 0.000 loss: -59.518]Iterations:  67%|██████▋   | 20/30 [00:17<00:08,  1.25it/s, atk: -54.284 ent: -5.234 str: 0.000 loss: -59.518]Iterations:  67%|██████▋   | 20/30 [00:17<00:08,  1.25it/s, atk: -56.642 ent: -5.233 str: 0.000 loss: -61.875]Iterations:  70%|███████   | 21/30 [00:18<00:06,  1.30it/s, atk: -56.642 ent: -5.233 str: 0.000 loss: -61.875]Iterations:  70%|███████   | 21/30 [00:18<00:06,  1.30it/s, atk: -59.252 ent: -5.232 str: 0.000 loss: -64.484]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.37it/s, atk: -59.252 ent: -5.232 str: 0.000 loss: -64.484]Iterations:  73%|███████▎  | 22/30 [00:19<00:05,  1.37it/s, atk: -61.606 ent: -5.231 str: 0.000 loss: -66.837]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.32it/s, atk: -61.606 ent: -5.231 str: 0.000 loss: -66.837]Iterations:  77%|███████▋  | 23/30 [00:20<00:05,  1.32it/s, atk: -63.934 ent: -5.227 str: 0.000 loss: -69.161]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.35it/s, atk: -63.934 ent: -5.227 str: 0.000 loss: -69.161]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.35it/s, atk: -66.168 ent: -5.224 str: 0.000 loss: -71.392]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.34it/s, atk: -66.168 ent: -5.224 str: 0.000 loss: -71.392]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.34it/s, atk: -68.710 ent: -5.222 str: 0.000 loss: -73.932]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.33it/s, atk: -68.710 ent: -5.222 str: 0.000 loss: -73.932]Iterations:  87%|████████▋ | 26/30 [00:22<00:02,  1.33it/s, atk: -71.010 ent: -5.221 str: 0.000 loss: -76.230]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.29it/s, atk: -71.010 ent: -5.221 str: 0.000 loss: -76.230]Iterations:  90%|█████████ | 27/30 [00:23<00:02,  1.29it/s, atk: -72.994 ent: -5.220 str: 0.000 loss: -78.214]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.21it/s, atk: -72.994 ent: -5.220 str: 0.000 loss: -78.214]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.21it/s, atk: -74.930 ent: -5.220 str: 0.000 loss: -80.150]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.26it/s, atk: -74.930 ent: -5.220 str: 0.000 loss: -80.150]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.26it/s, atk: -76.949 ent: -5.220 str: 0.000 loss: -82.169]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.25it/s, atk: -76.949 ent: -5.220 str: 0.000 loss: -82.169]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.19it/s, atk: -76.949 ent: -5.220 str: 0.000 loss: -82.169]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([654], device='cuda:0') tensor(0.9811, device='cuda:0')
after_true: tensor([656], device='cuda:0') tensor(0.0004, device='cuda:0')
L1: [2292.9607]	L2: [17.247757]	Linf: [0.5686275]

Accuracy on benign examples: 100.0%
gt_label: 144 pred_label: 144 pred_clean_logit 0.678248941898346
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:00, 19.77it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 19.76it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 15.34it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.53it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.57it/s]DDIM_inverse:  68%|██████▊   | 13/19 [00:00<00:00, 17.61it/s]DDIM_inverse:  79%|███████▉  | 15/19 [00:00<00:00, 18.27it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 18.06it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.38it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 17.95it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:08,  2.03s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.84s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.78s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.80s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.81s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4682
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -8.278 ent: -2.719 str: 0.000 loss: -10.997]Iterations:   3%|▎         | 1/30 [00:01<00:55,  1.91s/it, atk: -8.278 ent: -2.719 str: 0.000 loss: -10.997]Iterations:   3%|▎         | 1/30 [00:02<00:55,  1.91s/it, atk: -17.119 ent: -2.718 str: 0.000 loss: -19.838]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.25s/it, atk: -17.119 ent: -2.718 str: 0.000 loss: -19.838]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.25s/it, atk: -25.655 ent: -2.722 str: 0.000 loss: -28.377]Iterations:  10%|█         | 3/30 [00:03<00:29,  1.09s/it, atk: -25.655 ent: -2.722 str: 0.000 loss: -28.377]Iterations:  10%|█         | 3/30 [00:04<00:29,  1.09s/it, atk: -29.846 ent: -2.715 str: 0.000 loss: -32.562]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.04it/s, atk: -29.846 ent: -2.715 str: 0.000 loss: -32.562]Iterations:  13%|█▎        | 4/30 [00:04<00:24,  1.04it/s, atk: -40.672 ent: -2.716 str: 0.000 loss: -43.388]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.09it/s, atk: -40.672 ent: -2.716 str: 0.000 loss: -43.388]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.09it/s, atk: -45.104 ent: -2.710 str: 0.000 loss: -47.814]Iterations:  20%|██        | 6/30 [00:06<00:23,  1.04it/s, atk: -45.104 ent: -2.710 str: 0.000 loss: -47.814]Iterations:  20%|██        | 6/30 [00:06<00:23,  1.04it/s, atk: -52.774 ent: -2.706 str: 0.000 loss: -55.479]Iterations:  23%|██▎       | 7/30 [00:06<00:20,  1.14it/s, atk: -52.774 ent: -2.706 str: 0.000 loss: -55.479]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.14it/s, atk: -58.345 ent: -2.702 str: 0.000 loss: -61.047]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.23it/s, atk: -58.345 ent: -2.702 str: 0.000 loss: -61.047]Iterations:  27%|██▋       | 8/30 [00:07<00:17,  1.23it/s, atk: -64.311 ent: -2.699 str: 0.000 loss: -67.010]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -64.311 ent: -2.699 str: 0.000 loss: -67.010]Iterations:  30%|███       | 9/30 [00:08<00:16,  1.30it/s, atk: -70.377 ent: -2.697 str: 0.000 loss: -73.074]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.38it/s, atk: -70.377 ent: -2.697 str: 0.000 loss: -73.074]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.38it/s, atk: -78.121 ent: -2.693 str: 0.000 loss: -80.815]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -78.121 ent: -2.693 str: 0.000 loss: -80.815]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -85.934 ent: -2.693 str: 0.000 loss: -88.627]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -85.934 ent: -2.693 str: 0.000 loss: -88.627]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.40it/s, atk: -91.601 ent: -2.691 str: 0.000 loss: -94.292]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -91.601 ent: -2.691 str: 0.000 loss: -94.292]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.37it/s, atk: -99.545 ent: -2.692 str: 0.000 loss: -102.237]Iterations:  47%|████▋     | 14/30 [00:11<00:11,  1.38it/s, atk: -99.545 ent: -2.692 str: 0.000 loss: -102.237]Iterations:  47%|████▋     | 14/30 [00:12<00:11,  1.38it/s, atk: -106.354 ent: -2.689 str: 0.000 loss: -109.043]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.35it/s, atk: -106.354 ent: -2.689 str: 0.000 loss: -109.043]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.35it/s, atk: -114.128 ent: -2.686 str: 0.000 loss: -116.813]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -114.128 ent: -2.686 str: 0.000 loss: -116.813]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.37it/s, atk: -118.386 ent: -2.687 str: 0.000 loss: -121.073]Iterations:  57%|█████▋    | 17/30 [00:14<00:11,  1.15it/s, atk: -118.386 ent: -2.687 str: 0.000 loss: -121.073]Iterations:  57%|█████▋    | 17/30 [00:14<00:11,  1.15it/s, atk: -122.464 ent: -2.686 str: 0.000 loss: -125.150]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.23it/s, atk: -122.464 ent: -2.686 str: 0.000 loss: -125.150]Iterations:  60%|██████    | 18/30 [00:15<00:09,  1.23it/s, atk: -123.992 ent: -2.689 str: 0.000 loss: -126.681]Iterations:  63%|██████▎   | 19/30 [00:15<00:08,  1.31it/s, atk: -123.992 ent: -2.689 str: 0.000 loss: -126.681]Iterations:  63%|██████▎   | 19/30 [00:16<00:08,  1.31it/s, atk: -126.997 ent: -2.691 str: 0.000 loss: -129.689]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -126.997 ent: -2.691 str: 0.000 loss: -129.689]Iterations:  67%|██████▋   | 20/30 [00:16<00:07,  1.33it/s, atk: -132.722 ent: -2.692 str: 0.000 loss: -135.414]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.40it/s, atk: -132.722 ent: -2.692 str: 0.000 loss: -135.414]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.40it/s, atk: -135.659 ent: -2.693 str: 0.000 loss: -138.352]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.39it/s, atk: -135.659 ent: -2.693 str: 0.000 loss: -138.352]Iterations:  73%|███████▎  | 22/30 [00:18<00:05,  1.39it/s, atk: -140.166 ent: -2.693 str: 0.000 loss: -142.860]Iterations:  77%|███████▋  | 23/30 [00:18<00:05,  1.39it/s, atk: -140.166 ent: -2.693 str: 0.000 loss: -142.860]Iterations:  77%|███████▋  | 23/30 [00:19<00:05,  1.39it/s, atk: -144.753 ent: -2.693 str: 0.000 loss: -147.446]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -144.753 ent: -2.693 str: 0.000 loss: -147.446]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.42it/s, atk: -149.959 ent: -2.694 str: 0.000 loss: -152.652]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.40it/s, atk: -149.959 ent: -2.694 str: 0.000 loss: -152.652]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.40it/s, atk: -154.101 ent: -2.693 str: 0.000 loss: -156.794]Iterations:  87%|████████▋ | 26/30 [00:20<00:02,  1.42it/s, atk: -154.101 ent: -2.693 str: 0.000 loss: -156.794]Iterations:  87%|████████▋ | 26/30 [00:21<00:02,  1.42it/s, atk: -158.366 ent: -2.693 str: 0.000 loss: -161.059]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.42it/s, atk: -158.366 ent: -2.693 str: 0.000 loss: -161.059]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.42it/s, atk: -162.918 ent: -2.693 str: 0.000 loss: -165.611]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.40it/s, atk: -162.918 ent: -2.693 str: 0.000 loss: -165.611]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.40it/s, atk: -168.790 ent: -2.692 str: 0.000 loss: -171.481]Iterations:  97%|█████████▋| 29/30 [00:22<00:00,  1.39it/s, atk: -168.790 ent: -2.692 str: 0.000 loss: -171.481]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.39it/s, atk: -174.660 ent: -2.690 str: 0.000 loss: -177.350]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.22it/s, atk: -174.660 ent: -2.690 str: 0.000 loss: -177.350]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.25it/s, atk: -174.660 ent: -2.690 str: 0.000 loss: -177.350]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([146], device='cuda:0') tensor(1.0000, device='cuda:0')
after_true: tensor([144], device='cuda:0') tensor(1.4895e-08, device='cuda:0')
L1: [1219.0707]	L2: [10.110948]	Linf: [0.5882353]

Accuracy on benign examples: 100.0%
gt_label: 919 pred_label: 919 pred_clean_logit 0.9403451085090637
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.52it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:01, 12.82it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:01, 12.88it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 13.45it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 15.00it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 15.28it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 14.96it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 15.40it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 16.34it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 15.17it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:06,  1.65s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.71s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.58s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.65s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.75s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.70s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4986
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s, atk: -0.907 ent: -4.958 str: 0.000 loss: -5.865]Iterations:   3%|▎         | 1/30 [00:01<00:48,  1.69s/it, atk: -0.907 ent: -4.958 str: 0.000 loss: -5.865]Iterations:   3%|▎         | 1/30 [00:02<00:48,  1.69s/it, atk: -3.508 ent: -4.952 str: 0.000 loss: -8.460]Iterations:   7%|▋         | 2/30 [00:02<00:35,  1.26s/it, atk: -3.508 ent: -4.952 str: 0.000 loss: -8.460]Iterations:   7%|▋         | 2/30 [00:03<00:35,  1.26s/it, atk: -7.425 ent: -4.939 str: 0.000 loss: -12.364]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.00it/s, atk: -7.425 ent: -4.939 str: 0.000 loss: -12.364]Iterations:  10%|█         | 3/30 [00:03<00:26,  1.00it/s, atk: -8.099 ent: -4.948 str: 0.000 loss: -13.047]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -8.099 ent: -4.948 str: 0.000 loss: -13.047]Iterations:  13%|█▎        | 4/30 [00:04<00:22,  1.15it/s, atk: -11.687 ent: -4.944 str: 0.000 loss: -16.631]Iterations:  17%|█▋        | 5/30 [00:04<00:20,  1.25it/s, atk: -11.687 ent: -4.944 str: 0.000 loss: -16.631]Iterations:  17%|█▋        | 5/30 [00:05<00:20,  1.25it/s, atk: -15.988 ent: -4.936 str: 0.000 loss: -20.924]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -15.988 ent: -4.936 str: 0.000 loss: -20.924]Iterations:  20%|██        | 6/30 [00:05<00:18,  1.31it/s, atk: -20.000 ent: -4.930 str: 0.000 loss: -24.930]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -20.000 ent: -4.930 str: 0.000 loss: -24.930]Iterations:  23%|██▎       | 7/30 [00:06<00:16,  1.37it/s, atk: -24.524 ent: -4.928 str: 0.000 loss: -29.452]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -24.524 ent: -4.928 str: 0.000 loss: -29.452]Iterations:  27%|██▋       | 8/30 [00:06<00:15,  1.46it/s, atk: -28.357 ent: -4.925 str: 0.000 loss: -33.282]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.48it/s, atk: -28.357 ent: -4.925 str: 0.000 loss: -33.282]Iterations:  30%|███       | 9/30 [00:07<00:14,  1.48it/s, atk: -33.100 ent: -4.927 str: 0.000 loss: -38.027]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.42it/s, atk: -33.100 ent: -4.927 str: 0.000 loss: -38.027]Iterations:  33%|███▎      | 10/30 [00:08<00:14,  1.42it/s, atk: -37.204 ent: -4.927 str: 0.000 loss: -42.131]Iterations:  37%|███▋      | 11/30 [00:08<00:13,  1.41it/s, atk: -37.204 ent: -4.927 str: 0.000 loss: -42.131]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.41it/s, atk: -41.881 ent: -4.925 str: 0.000 loss: -46.806]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.51it/s, atk: -41.881 ent: -4.925 str: 0.000 loss: -46.806]Iterations:  40%|████      | 12/30 [00:09<00:11,  1.51it/s, atk: -46.175 ent: -4.924 str: 0.000 loss: -51.099]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -46.175 ent: -4.924 str: 0.000 loss: -51.099]Iterations:  43%|████▎     | 13/30 [00:10<00:11,  1.47it/s, atk: -50.361 ent: -4.926 str: 0.000 loss: -55.286]Iterations:  47%|████▋     | 14/30 [00:10<00:10,  1.50it/s, atk: -50.361 ent: -4.926 str: 0.000 loss: -55.286]Iterations:  47%|████▋     | 14/30 [00:11<00:10,  1.50it/s, atk: -55.322 ent: -4.925 str: 0.000 loss: -60.247]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -55.322 ent: -4.925 str: 0.000 loss: -60.247]Iterations:  50%|█████     | 15/30 [00:11<00:09,  1.50it/s, atk: -59.611 ent: -4.923 str: 0.000 loss: -64.534]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.50it/s, atk: -59.611 ent: -4.923 str: 0.000 loss: -64.534]Iterations:  53%|█████▎    | 16/30 [00:12<00:09,  1.50it/s, atk: -62.500 ent: -4.926 str: 0.000 loss: -67.425]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.25it/s, atk: -62.500 ent: -4.926 str: 0.000 loss: -67.425]Iterations:  57%|█████▋    | 17/30 [00:13<00:10,  1.25it/s, atk: -67.397 ent: -4.924 str: 0.000 loss: -72.321]Iterations:  60%|██████    | 18/30 [00:13<00:09,  1.31it/s, atk: -67.397 ent: -4.924 str: 0.000 loss: -72.321]Iterations:  60%|██████    | 18/30 [00:14<00:09,  1.31it/s, atk: -71.691 ent: -4.923 str: 0.000 loss: -76.614]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -71.691 ent: -4.923 str: 0.000 loss: -76.614]Iterations:  63%|██████▎   | 19/30 [00:14<00:08,  1.37it/s, atk: -75.798 ent: -4.923 str: 0.000 loss: -80.721]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.42it/s, atk: -75.798 ent: -4.923 str: 0.000 loss: -80.721]Iterations:  67%|██████▋   | 20/30 [00:15<00:07,  1.42it/s, atk: -78.477 ent: -4.922 str: 0.000 loss: -83.400]Iterations:  70%|███████   | 21/30 [00:15<00:06,  1.41it/s, atk: -78.477 ent: -4.922 str: 0.000 loss: -83.400]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.41it/s, atk: -83.962 ent: -4.921 str: 0.000 loss: -88.883]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.42it/s, atk: -83.962 ent: -4.921 str: 0.000 loss: -88.883]Iterations:  73%|███████▎  | 22/30 [00:16<00:05,  1.42it/s, atk: -87.326 ent: -4.920 str: 0.000 loss: -92.246]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -87.326 ent: -4.920 str: 0.000 loss: -92.246]Iterations:  77%|███████▋  | 23/30 [00:17<00:04,  1.42it/s, atk: -93.117 ent: -4.919 str: 0.000 loss: -98.036]Iterations:  80%|████████  | 24/30 [00:17<00:04,  1.42it/s, atk: -93.117 ent: -4.919 str: 0.000 loss: -98.036]Iterations:  80%|████████  | 24/30 [00:18<00:04,  1.42it/s, atk: -97.544 ent: -4.919 str: 0.000 loss: -102.463]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -97.544 ent: -4.919 str: 0.000 loss: -102.463]Iterations:  83%|████████▎ | 25/30 [00:18<00:03,  1.43it/s, atk: -101.868 ent: -4.921 str: 0.000 loss: -106.789]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -101.868 ent: -4.921 str: 0.000 loss: -106.789]Iterations:  87%|████████▋ | 26/30 [00:19<00:02,  1.45it/s, atk: -107.165 ent: -4.923 str: 0.000 loss: -112.088]Iterations:  90%|█████████ | 27/30 [00:19<00:02,  1.45it/s, atk: -107.165 ent: -4.923 str: 0.000 loss: -112.088]Iterations:  90%|█████████ | 27/30 [00:20<00:02,  1.45it/s, atk: -111.219 ent: -4.922 str: 0.000 loss: -116.140]Iterations:  93%|█████████▎| 28/30 [00:20<00:01,  1.45it/s, atk: -111.219 ent: -4.922 str: 0.000 loss: -116.140]Iterations:  93%|█████████▎| 28/30 [00:21<00:01,  1.45it/s, atk: -116.911 ent: -4.921 str: 0.000 loss: -121.832]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -116.911 ent: -4.921 str: 0.000 loss: -121.832]Iterations:  97%|█████████▋| 29/30 [00:21<00:00,  1.45it/s, atk: -122.536 ent: -4.920 str: 0.000 loss: -127.456]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.31it/s, atk: -122.536 ent: -4.920 str: 0.000 loss: -127.456]Iterations: 100%|██████████| 30/30 [00:22<00:00,  1.35it/s, atk: -122.536 ent: -4.920 str: 0.000 loss: -127.456]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([999], device='cuda:0') tensor(0.7073, device='cuda:0')
after_true: tensor([919], device='cuda:0') tensor(2.6306e-06, device='cuda:0')
L1: [3017.3293]	L2: [20.66188]	Linf: [0.6]

Accuracy on benign examples: 100.0%
gt_label: 917 pred_label: 917 pred_clean_logit 0.9721025228500366
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 16.92it/s]DDIM_inverse:  21%|██        | 4/19 [00:00<00:00, 17.37it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 19.85it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 19.53it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 14.65it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 11.66it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:01<00:00, 12.17it/s]DDIM_inverse:  95%|█████████▍| 18/19 [00:01<00:00, 11.52it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 13.35it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.48s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.42s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.58s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.83s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.88s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.76s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.4459
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -0.208 ent: -4.988 str: 0.000 loss: -5.196]Iterations:   3%|▎         | 1/30 [00:02<01:12,  2.50s/it, atk: -0.208 ent: -4.988 str: 0.000 loss: -5.196]Iterations:   3%|▎         | 1/30 [00:03<01:12,  2.50s/it, atk: -0.895 ent: -4.996 str: 0.000 loss: -5.891]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.62s/it, atk: -0.895 ent: -4.996 str: 0.000 loss: -5.891]Iterations:   7%|▋         | 2/30 [00:03<00:45,  1.62s/it, atk: -1.752 ent: -4.995 str: 0.000 loss: -6.747]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.17s/it, atk: -1.752 ent: -4.995 str: 0.000 loss: -6.747]Iterations:  10%|█         | 3/30 [00:04<00:31,  1.17s/it, atk: -2.302 ent: -4.988 str: 0.000 loss: -7.290]Iterations:  13%|█▎        | 4/30 [00:04<00:26,  1.00s/it, atk: -2.302 ent: -4.988 str: 0.000 loss: -7.290]Iterations:  13%|█▎        | 4/30 [00:05<00:26,  1.00s/it, atk: -5.208 ent: -4.986 str: 0.000 loss: -10.194]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -5.208 ent: -4.986 str: 0.000 loss: -10.194]Iterations:  17%|█▋        | 5/30 [00:05<00:22,  1.13it/s, atk: -11.555 ent: -4.991 str: 0.000 loss: -16.545]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.25it/s, atk: -11.555 ent: -4.991 str: 0.000 loss: -16.545]Iterations:  20%|██        | 6/30 [00:06<00:19,  1.25it/s, atk: -18.374 ent: -4.995 str: 0.000 loss: -23.368]Iterations:  23%|██▎       | 7/30 [00:06<00:17,  1.30it/s, atk: -18.374 ent: -4.995 str: 0.000 loss: -23.368]Iterations:  23%|██▎       | 7/30 [00:07<00:17,  1.30it/s, atk: -27.374 ent: -4.994 str: 0.000 loss: -32.368]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -27.374 ent: -4.994 str: 0.000 loss: -32.368]Iterations:  27%|██▋       | 8/30 [00:07<00:16,  1.35it/s, atk: -34.123 ent: -4.993 str: 0.000 loss: -39.116]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -34.123 ent: -4.993 str: 0.000 loss: -39.116]Iterations:  30%|███       | 9/30 [00:08<00:15,  1.38it/s, atk: -41.297 ent: -4.994 str: 0.000 loss: -46.291]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -41.297 ent: -4.994 str: 0.000 loss: -46.291]Iterations:  33%|███▎      | 10/30 [00:09<00:14,  1.37it/s, atk: -46.886 ent: -4.992 str: 0.000 loss: -51.878]Iterations:  37%|███▋      | 11/30 [00:09<00:13,  1.42it/s, atk: -46.886 ent: -4.992 str: 0.000 loss: -51.878]Iterations:  37%|███▋      | 11/30 [00:10<00:13,  1.42it/s, atk: -56.708 ent: -4.992 str: 0.000 loss: -61.700]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -56.708 ent: -4.992 str: 0.000 loss: -61.700]Iterations:  40%|████      | 12/30 [00:10<00:12,  1.41it/s, atk: -66.942 ent: -4.992 str: 0.000 loss: -71.934]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -66.942 ent: -4.992 str: 0.000 loss: -71.934]Iterations:  43%|████▎     | 13/30 [00:11<00:12,  1.36it/s, atk: -76.365 ent: -4.990 str: 0.000 loss: -81.355]Iterations:  47%|████▋     | 14/30 [00:12<00:13,  1.16it/s, atk: -76.365 ent: -4.990 str: 0.000 loss: -81.355]Iterations:  47%|████▋     | 14/30 [00:12<00:13,  1.16it/s, atk: -85.280 ent: -4.991 str: 0.000 loss: -90.271]Iterations:  50%|█████     | 15/30 [00:12<00:11,  1.27it/s, atk: -85.280 ent: -4.991 str: 0.000 loss: -90.271]Iterations:  50%|█████     | 15/30 [00:13<00:11,  1.27it/s, atk: -94.637 ent: -4.991 str: 0.000 loss: -99.629]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -94.637 ent: -4.991 str: 0.000 loss: -99.629]Iterations:  53%|█████▎    | 16/30 [00:13<00:10,  1.33it/s, atk: -104.102 ent: -4.992 str: 0.000 loss: -109.093]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.36it/s, atk: -104.102 ent: -4.992 str: 0.000 loss: -109.093]Iterations:  57%|█████▋    | 17/30 [00:14<00:09,  1.36it/s, atk: -115.812 ent: -4.991 str: 0.000 loss: -120.803]Iterations:  60%|██████    | 18/30 [00:14<00:08,  1.40it/s, atk: -115.812 ent: -4.991 str: 0.000 loss: -120.803]Iterations:  60%|██████    | 18/30 [00:15<00:08,  1.40it/s, atk: -128.525 ent: -4.990 str: 0.000 loss: -133.515]Iterations:  63%|██████▎   | 19/30 [00:15<00:07,  1.39it/s, atk: -128.525 ent: -4.990 str: 0.000 loss: -133.515]Iterations:  63%|██████▎   | 19/30 [00:16<00:07,  1.39it/s, atk: -140.088 ent: -4.989 str: 0.000 loss: -145.078]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.44it/s, atk: -140.088 ent: -4.989 str: 0.000 loss: -145.078]Iterations:  67%|██████▋   | 20/30 [00:16<00:06,  1.44it/s, atk: -152.790 ent: -4.990 str: 0.000 loss: -157.780]Iterations:  70%|███████   | 21/30 [00:16<00:06,  1.49it/s, atk: -152.790 ent: -4.990 str: 0.000 loss: -157.780]Iterations:  70%|███████   | 21/30 [00:17<00:06,  1.49it/s, atk: -166.165 ent: -4.986 str: 0.000 loss: -171.151]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -166.165 ent: -4.986 str: 0.000 loss: -171.151]Iterations:  73%|███████▎  | 22/30 [00:17<00:05,  1.50it/s, atk: -178.608 ent: -4.984 str: 0.000 loss: -183.592]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.51it/s, atk: -178.608 ent: -4.984 str: 0.000 loss: -183.592]Iterations:  77%|███████▋  | 23/30 [00:18<00:04,  1.51it/s, atk: -190.878 ent: -4.982 str: 0.000 loss: -195.860]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.40it/s, atk: -190.878 ent: -4.982 str: 0.000 loss: -195.860]Iterations:  80%|████████  | 24/30 [00:19<00:04,  1.40it/s, atk: -204.555 ent: -4.981 str: 0.000 loss: -209.535]Iterations:  83%|████████▎ | 25/30 [00:19<00:03,  1.30it/s, atk: -204.555 ent: -4.981 str: 0.000 loss: -209.535]Iterations:  83%|████████▎ | 25/30 [00:20<00:03,  1.30it/s, atk: -217.445 ent: -4.980 str: 0.000 loss: -222.425]Iterations:  87%|████████▋ | 26/30 [00:20<00:03,  1.21it/s, atk: -217.445 ent: -4.980 str: 0.000 loss: -222.425]Iterations:  87%|████████▋ | 26/30 [00:21<00:03,  1.21it/s, atk: -228.524 ent: -4.981 str: 0.000 loss: -233.505]Iterations:  90%|█████████ | 27/30 [00:21<00:02,  1.25it/s, atk: -228.524 ent: -4.981 str: 0.000 loss: -233.505]Iterations:  90%|█████████ | 27/30 [00:22<00:02,  1.25it/s, atk: -243.050 ent: -4.980 str: 0.000 loss: -248.030]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.31it/s, atk: -243.050 ent: -4.980 str: 0.000 loss: -248.030]Iterations:  93%|█████████▎| 28/30 [00:22<00:01,  1.31it/s, atk: -252.917 ent: -4.980 str: 0.000 loss: -257.896]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.31it/s, atk: -252.917 ent: -4.980 str: 0.000 loss: -257.896]Iterations:  97%|█████████▋| 29/30 [00:23<00:00,  1.31it/s, atk: -261.991 ent: -4.979 str: 0.000 loss: -266.970]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.37it/s, atk: -261.991 ent: -4.979 str: 0.000 loss: -266.970]Iterations: 100%|██████████| 30/30 [00:23<00:00,  1.26it/s, atk: -261.991 ent: -4.979 str: 0.000 loss: -266.970]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([971], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([917], device='cuda:0') tensor(1.3158e-12, device='cuda:0')
L1: [3401.957]	L2: [22.383337]	Linf: [0.78431374]

Accuracy on benign examples: 100.0%
gt_label: 883 pred_label: 883 pred_clean_logit 0.5418263077735901
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  16%|█▌        | 3/19 [00:00<00:00, 20.56it/s]DDIM_inverse:  32%|███▏      | 6/19 [00:00<00:00, 19.35it/s]DDIM_inverse:  42%|████▏     | 8/19 [00:00<00:00, 18.15it/s]DDIM_inverse:  53%|█████▎    | 10/19 [00:00<00:00, 18.23it/s]DDIM_inverse:  63%|██████▎   | 12/19 [00:00<00:00, 18.42it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.79it/s]DDIM_inverse:  84%|████████▍ | 16/19 [00:00<00:00, 18.29it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 19.38it/s]DDIM_inverse: 100%|██████████| 19/19 [00:01<00:00, 18.93it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:01<00:05,  1.27s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:02<00:04,  1.50s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:04<00:03,  1.64s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:06<00:01,  1.69s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.86s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:08<00:00,  1.74s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.5169
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:02<?, ?it/s, atk: -8.166 ent: -2.541 str: 0.000 loss: -10.707]Iterations:   3%|▎         | 1/30 [00:02<01:19,  2.74s/it, atk: -8.166 ent: -2.541 str: 0.000 loss: -10.707]Iterations:   3%|▎         | 1/30 [00:03<01:19,  2.74s/it, atk: -27.767 ent: -2.528 str: 0.000 loss: -30.295]Iterations:   7%|▋         | 2/30 [00:03<00:47,  1.71s/it, atk: -27.767 ent: -2.528 str: 0.000 loss: -30.295]Iterations:   7%|▋         | 2/30 [00:04<00:47,  1.71s/it, atk: -47.753 ent: -2.521 str: 0.000 loss: -50.274]Iterations:  10%|█         | 3/30 [00:04<00:36,  1.36s/it, atk: -47.753 ent: -2.521 str: 0.000 loss: -50.274]Iterations:  10%|█         | 3/30 [00:05<00:36,  1.36s/it, atk: -63.227 ent: -2.520 str: 0.000 loss: -65.747]Iterations:  13%|█▎        | 4/30 [00:05<00:28,  1.08s/it, atk: -63.227 ent: -2.520 str: 0.000 loss: -65.747]Iterations:  13%|█▎        | 4/30 [00:05<00:28,  1.08s/it, atk: -78.414 ent: -2.519 str: 0.000 loss: -80.933]Iterations:  17%|█▋        | 5/30 [00:06<00:26,  1.04s/it, atk: -78.414 ent: -2.519 str: 0.000 loss: -80.933]Iterations:  17%|█▋        | 5/30 [00:06<00:26,  1.04s/it, atk: -90.837 ent: -2.520 str: 0.000 loss: -93.356]Iterations:  20%|██        | 6/30 [00:07<00:23,  1.03it/s, atk: -90.837 ent: -2.520 str: 0.000 loss: -93.356]Iterations:  20%|██        | 6/30 [00:07<00:23,  1.03it/s, atk: -106.488 ent: -2.521 str: 0.000 loss: -109.009]Iterations:  23%|██▎       | 7/30 [00:07<00:20,  1.12it/s, atk: -106.488 ent: -2.521 str: 0.000 loss: -109.009]Iterations:  23%|██▎       | 7/30 [00:08<00:20,  1.12it/s, atk: -115.345 ent: -2.521 str: 0.000 loss: -117.865]Iterations:  27%|██▋       | 8/30 [00:08<00:18,  1.22it/s, atk: -115.345 ent: -2.521 str: 0.000 loss: -117.865]Iterations:  27%|██▋       | 8/30 [00:08<00:18,  1.22it/s, atk: -126.249 ent: -2.523 str: 0.000 loss: -128.771]Iterations:  30%|███       | 9/30 [00:09<00:16,  1.28it/s, atk: -126.249 ent: -2.523 str: 0.000 loss: -128.771]Iterations:  30%|███       | 9/30 [00:09<00:16,  1.28it/s, atk: -136.641 ent: -2.522 str: 0.000 loss: -139.164]Iterations:  33%|███▎      | 10/30 [00:09<00:15,  1.32it/s, atk: -136.641 ent: -2.522 str: 0.000 loss: -139.164]Iterations:  33%|███▎      | 10/30 [00:10<00:15,  1.32it/s, atk: -143.789 ent: -2.522 str: 0.000 loss: -146.311]Iterations:  37%|███▋      | 11/30 [00:10<00:15,  1.21it/s, atk: -143.789 ent: -2.522 str: 0.000 loss: -146.311]Iterations:  37%|███▋      | 11/30 [00:11<00:15,  1.21it/s, atk: -151.790 ent: -2.522 str: 0.000 loss: -154.312]Iterations:  40%|████      | 12/30 [00:11<00:15,  1.17it/s, atk: -151.790 ent: -2.522 str: 0.000 loss: -154.312]Iterations:  40%|████      | 12/30 [00:12<00:15,  1.17it/s, atk: -158.491 ent: -2.523 str: 0.000 loss: -161.015]Iterations:  43%|████▎     | 13/30 [00:12<00:14,  1.14it/s, atk: -158.491 ent: -2.523 str: 0.000 loss: -161.015]Iterations:  43%|████▎     | 13/30 [00:13<00:14,  1.14it/s, atk: -166.169 ent: -2.522 str: 0.000 loss: -168.691]Iterations:  47%|████▋     | 14/30 [00:13<00:13,  1.22it/s, atk: -166.169 ent: -2.522 str: 0.000 loss: -168.691]Iterations:  47%|████▋     | 14/30 [00:13<00:13,  1.22it/s, atk: -172.452 ent: -2.521 str: 0.000 loss: -174.972]Iterations:  50%|█████     | 15/30 [00:14<00:11,  1.30it/s, atk: -172.452 ent: -2.521 str: 0.000 loss: -174.972]Iterations:  50%|█████     | 15/30 [00:14<00:11,  1.30it/s, atk: -177.973 ent: -2.520 str: 0.000 loss: -180.494]Iterations:  53%|█████▎    | 16/30 [00:14<00:10,  1.32it/s, atk: -177.973 ent: -2.520 str: 0.000 loss: -180.494]Iterations:  53%|█████▎    | 16/30 [00:15<00:10,  1.32it/s, atk: -183.826 ent: -2.520 str: 0.000 loss: -186.346]Iterations:  57%|█████▋    | 17/30 [00:15<00:09,  1.38it/s, atk: -183.826 ent: -2.520 str: 0.000 loss: -186.346]Iterations:  57%|█████▋    | 17/30 [00:15<00:09,  1.38it/s, atk: -188.550 ent: -2.519 str: 0.000 loss: -191.069]Iterations:  60%|██████    | 18/30 [00:16<00:08,  1.38it/s, atk: -188.550 ent: -2.519 str: 0.000 loss: -191.069]Iterations:  60%|██████    | 18/30 [00:16<00:08,  1.38it/s, atk: -194.394 ent: -2.519 str: 0.000 loss: -196.913]Iterations:  63%|██████▎   | 19/30 [00:17<00:08,  1.27it/s, atk: -194.394 ent: -2.519 str: 0.000 loss: -196.913]Iterations:  63%|██████▎   | 19/30 [00:17<00:08,  1.27it/s, atk: -200.622 ent: -2.518 str: 0.000 loss: -203.141]Iterations:  67%|██████▋   | 20/30 [00:17<00:07,  1.35it/s, atk: -200.622 ent: -2.518 str: 0.000 loss: -203.141]Iterations:  67%|██████▋   | 20/30 [00:18<00:07,  1.35it/s, atk: -207.190 ent: -2.517 str: 0.000 loss: -209.707]Iterations:  70%|███████   | 21/30 [00:18<00:06,  1.38it/s, atk: -207.190 ent: -2.517 str: 0.000 loss: -209.707]Iterations:  70%|███████   | 21/30 [00:18<00:06,  1.38it/s, atk: -211.419 ent: -2.517 str: 0.000 loss: -213.935]Iterations:  73%|███████▎  | 22/30 [00:19<00:06,  1.29it/s, atk: -211.419 ent: -2.517 str: 0.000 loss: -213.935]Iterations:  73%|███████▎  | 22/30 [00:19<00:06,  1.29it/s, atk: -217.687 ent: -2.517 str: 0.000 loss: -220.204]Iterations:  77%|███████▋  | 23/30 [00:20<00:05,  1.22it/s, atk: -217.687 ent: -2.517 str: 0.000 loss: -220.204]Iterations:  77%|███████▋  | 23/30 [00:20<00:05,  1.22it/s, atk: -223.053 ent: -2.517 str: 0.000 loss: -225.570]Iterations:  80%|████████  | 24/30 [00:20<00:04,  1.28it/s, atk: -223.053 ent: -2.517 str: 0.000 loss: -225.570]Iterations:  80%|████████  | 24/30 [00:21<00:04,  1.28it/s, atk: -228.522 ent: -2.517 str: 0.000 loss: -231.039]Iterations:  83%|████████▎ | 25/30 [00:21<00:03,  1.33it/s, atk: -228.522 ent: -2.517 str: 0.000 loss: -231.039]Iterations:  83%|████████▎ | 25/30 [00:22<00:03,  1.33it/s, atk: -234.414 ent: -2.517 str: 0.000 loss: -236.931]Iterations:  87%|████████▋ | 26/30 [00:22<00:02,  1.38it/s, atk: -234.414 ent: -2.517 str: 0.000 loss: -236.931]Iterations:  87%|████████▋ | 26/30 [00:22<00:02,  1.38it/s, atk: -239.191 ent: -2.516 str: 0.000 loss: -241.707]Iterations:  90%|█████████ | 27/30 [00:23<00:02,  1.33it/s, atk: -239.191 ent: -2.516 str: 0.000 loss: -241.707]Iterations:  90%|█████████ | 27/30 [00:23<00:02,  1.33it/s, atk: -244.077 ent: -2.516 str: 0.000 loss: -246.593]Iterations:  93%|█████████▎| 28/30 [00:23<00:01,  1.32it/s, atk: -244.077 ent: -2.516 str: 0.000 loss: -246.593]Iterations:  93%|█████████▎| 28/30 [00:24<00:01,  1.32it/s, atk: -249.643 ent: -2.516 str: 0.000 loss: -252.159]Iterations:  97%|█████████▋| 29/30 [00:24<00:00,  1.34it/s, atk: -249.643 ent: -2.516 str: 0.000 loss: -252.159]Iterations:  97%|█████████▋| 29/30 [00:25<00:00,  1.34it/s, atk: -254.091 ent: -2.516 str: 0.000 loss: -256.606]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.27it/s, atk: -254.091 ent: -2.516 str: 0.000 loss: -256.606]Iterations: 100%|██████████| 30/30 [00:25<00:00,  1.18it/s, atk: -254.091 ent: -2.516 str: 0.000 loss: -256.606]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Accuracy on adversarial examples: 0.0%
after_pred: tensor([470], device='cuda:0') tensor(1., device='cuda:0')
after_true: tensor([883], device='cuda:0') tensor(7.0925e-12, device='cuda:0')
L1: [2272.047]	L2: [15.114819]	Linf: [0.67450976]

Accuracy on benign examples: 0.0%
gt_label: 73 pred_label: 74 pred_clean_logit 0.38380372524261475
DDIM_inverse:   0%|          | 0/19 [00:00<?, ?it/s]DDIM_inverse:  11%|█         | 2/19 [00:00<00:01, 14.85it/s]DDIM_inverse:  26%|██▋       | 5/19 [00:00<00:00, 18.69it/s]DDIM_inverse:  37%|███▋      | 7/19 [00:00<00:00, 18.48it/s]DDIM_inverse:  47%|████▋     | 9/19 [00:00<00:00, 17.07it/s]DDIM_inverse:  58%|█████▊    | 11/19 [00:00<00:00, 17.69it/s]DDIM_inverse:  74%|███████▎  | 14/19 [00:00<00:00, 18.45it/s]DDIM_inverse:  89%|████████▉ | 17/19 [00:00<00:00, 20.01it/s]DDIM_inverse: 100%|██████████| 19/19 [00:00<00:00, 19.44it/s]
Optimize_uncond_embed:   0%|          | 0/5 [00:00<?, ?it/s]Optimize_uncond_embed:  20%|██        | 1/5 [00:02<00:09,  2.25s/it]Optimize_uncond_embed:  40%|████      | 2/5 [00:03<00:05,  1.83s/it]Optimize_uncond_embed:  60%|██████    | 3/5 [00:05<00:03,  1.68s/it]Optimize_uncond_embed:  80%|████████  | 4/5 [00:07<00:01,  1.72s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.85s/it]Optimize_uncond_embed: 100%|██████████| 5/5 [00:09<00:00,  1.83s/it]
✓ Patched controller.forward to store 4x4 to 32x32 attention maps

==================================================
After forward: cur_step=5, num_att_layers=32
ATTENTION STORE CONTENTS:
  down_cross: 6 maps
    [0] shape=torch.Size([10, 784, 77]) -> 28x28
    [1] shape=torch.Size([10, 784, 77]) -> 28x28
    [2] shape=torch.Size([20, 196, 77]) -> 14x14
  mid_cross: 1 maps
    [0] shape=torch.Size([40, 16, 77]) -> 4x4
  up_cross: 9 maps
    [0] shape=torch.Size([40, 49, 77]) -> 7x7
    [1] shape=torch.Size([40, 49, 77]) -> 7x7
    [2] shape=torch.Size([40, 49, 77]) -> 7x7
==================================================

Mask generated successfully:
  - Maps aggregated: 16
  - Attention range: [0.0000, 1.0000]
  - Threshold: 0.3843
  - Object coverage: 30.1%
Iterations:   0%|          | 0/30 [00:00<?, ?it/s]Iterations:   0%|          | 0/30 [00:01<?, ?it/s]
\nDEBUG iter 0:
  attention_store: 6 keys, 32 total maps
  step_store: 6 keys, 0 total maps
    down_cross: 6 maps, shape=torch.Size([10, 784, 77]), requires_grad=True
    mid_cross: 1 maps, shape=torch.Size([40, 16, 77]), requires_grad=True
    up_cross: 9 maps, shape=torch.Size([40, 49, 77]), requires_grad=True
    down_self: 6 maps, shape=torch.Size([10, 784, 784]), requires_grad=True
    mid_self: 1 maps, shape=torch.Size([40, 16, 16]), requires_grad=True
    up_self: 9 maps, shape=torch.Size([40, 49, 49]), requires_grad=True
Traceback (most recent call last):
  File "main.py", line 173, in <module>
    adv_image, clean_acc, adv_acc = run_diffusion_attack(tmp_image, label[ind:ind + 1],
  File "main.py", line 72, in run_diffusion_attack
    adv_image, clean_acc, adv_acc = diff_latent_attack.diffattack(diffusion_model, label, controller,
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/datastore/clc_hcmus/npctri/DiffAttack/diff_latent_attack.py", line 706, in diffattack
    pred = classifier(out_image)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torchvision/models/resnet.py", line 285, in forward
    return self._forward_impl(x)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torchvision/models/resnet.py", line 275, in _forward_impl
    x = self.layer3(x)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/modules/container.py", line 139, in forward
    input = module(input)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torchvision/models/resnet.py", line 155, in forward
    out = self.bn3(out)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/modules/module.py", line 1130, in _call_impl
    return forward_call(*input, **kwargs)
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/modules/batchnorm.py", line 168, in forward
    return F.batch_norm(
  File "/datastore/clc_hcmus/miniconda3/envs/py38/lib/python3.8/site-packages/torch/nn/functional.py", line 2438, in batch_norm
    return torch.batch_norm(
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 0; 79.15 GiB total capacity; 14.01 GiB already allocated; 9.38 MiB free; 18.75 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF
